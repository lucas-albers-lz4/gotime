/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Dashboard
 * (C) Copyright IBM Corp. 2016, 2021
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,_toPropertyKey(n.key),n)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _wrapNativeSuper(e){var t="function"==typeof Map?new Map:void 0;return(_wrapNativeSuper=function(e){if(null===e||!_isNativeFunction(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return _construct(e,arguments,_getPrototypeOf(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),_setPrototypeOf(i,e)})(e)}function _construct(e,t,i){return(_construct=_isNativeReflectConstruct()?Reflect.construct.bind():function(e,t,i){var n=[null];n.push.apply(n,t);var a=new(Function.bind.apply(e,n));return i&&_setPrototypeOf(a,i.prototype),a}).apply(null,arguments)}function _isNativeReflectConstruct(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function _isNativeFunction(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _getPrototypeOf(e){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _createForOfIteratorHelperLoose(e,t){var i="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(i)return(i=i.call(e)).next.bind(i);if(Array.isArray(e)||(i=_unsupportedIterableToArray(e))||t&&e&&"number"==typeof e.length){i&&(e=i);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(e,t):void 0}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _assertThisInitialized(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function _inheritsLoose(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,_setPrototypeOf(e,t)}function _setPrototypeOf(e,t){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e}).apply(this,arguments)}define("dashboard-analytics/lib/@waca/dashboard-common/dist/utils/ObjectHelper",[],(function(){"use strict";var e=function(e){return function(e){return e&&"object"===(void 0===e?"undefined":_typeof(e))}(e)&&!Object.isFrozen(e)};return function(){function t(){_classCallCheck(this,t)}return t.deepFreezeObject=function(i){if(e(i)){Object.freeze(i);var n=Array.isArray(i)?Object.keys(i):Object.getOwnPropertyNames(i),a=Array.isArray(n),o=0;for(n=a?n:n[Symbol.iterator]();;){var s;if(a){if(o>=n.length)break;s=n[o++]}else{if((o=n.next()).done)break;s=o.value}var r=i[s];t.deepFreezeObject(r)}}return i},t}()})),define("dashboard-analytics/visualizations/definitions/providers/BaseProvider",["underscore","../../../lib/@waca/core-client/js/core-client/ui/core/Class","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/dashboard-common/dist/utils/ObjectHelper"],(function(e,t,i,n){return t.extend({init:function(e){this.dashboardApi=e.dashboardApi,this.ajax=e.ajax,this.preFetch=e.preFetch,this.definitionIds={},this.icon_root=this.dashboardApi&&this.dashboardApi.getConfiguration("liveWidgetImagesRoot")||"dashboard-analytics/images/",this.icon_root.lastIndexOf("/")!==this.icon_root.length-1&&(this.icon_root+="/")},clear:function(){},contains:function(t){return 0===e.size(this.definitionIds)?this.getDefinition(t).then((function(e){return!!e})):Promise.resolve(!!this.definitionIds[t])},refreshProvider:function(){},setDefinitions:function(t){var i=this;0===e.size(this.definitionIds)&&e.each(t,(function(e){i.definitionIds[e.id]=!0}))},getDefinitions:function(){return Promise.resolve([])},getDefinition:function(t){return this.getDefinitions().then((function(i){return e.find(i,(function(e){return e.id===t}))}))},_rewriteVisUri:function(e){return this.dashboardApi.getGlassSvc(".Ajax",(function(t){e.uri&&(e.uri=t.rewriteUrl(e.uri)),e.icon&&(e.icon=t.rewriteUrl(e.icon)),e.iconUri&&(e.iconUri=t.rewriteUrl(e.iconUri)),e.specification&&e.specification.template&&(e.specification.template=t.rewriteUrl(e.specification.template))})),e},_getProductLocale:function(){return this.dashboardApi.getGlassCoreSvc(".UserProfile").preferences.productLocale||"en"},_getLocalizedValue:function(e,t){var n=i.get(e);return-1!==n.indexOf("__NOT_TRANSLATED__")&&(n=t),n},_getTooltipSlotCaption:function(e,t){var n=e.find((function(e){return e.name===t.datasetIdList[0]}));return n&&n.tooltipCaption&&i.get(n.tooltipCaption)||i.get("tooltipSlotDefaultCaption")},_areTooltipSlotsDisabled:function(){var e=this.dashboardApi&&this.dashboardApi.getGlassCoreSvc(".FeatureChecker");return!e||e.checkValue("dashboard","TooltipSlot","disabled")},addTooltipSlots:function(e){var t=this;if(!this._areTooltipSlotsDisabled()){var i=[],n={},a=e.datasets;e.dataSlots.forEach((function(e){if(e.datasetIdList&&1===e.datasetIdList.length){var o={datasetIdList:e.datasetIdList,id:"tooltip."+e.datasetIdList[0],type:"ordinal",icon:"values",caption:t._getTooltipSlotCaption(a,e),repeats:!0,sortable:!1,stackItems:!1,optional:!0,role:"response"},s=o.id;if(n[s])return;n[s]=!0,i.push(o)}})),e.dataSlots.push.apply(e.dataSlots,i)}},freezeDefinitions:function(e){void 0===e&&(e=[]),e.forEach((function(e,t,i){i[t]=n.deepFreezeObject(e)}))},massageDefinitions:function(){}})})),define("dashboard-analytics/visualizations/properties/PropertiesCreator",["underscore","dashboard-analytics/widgets/livewidget/nls/StringResources"],(function(e,t){"use strict";var i;return i=null,{getInstance:function(){return i||(i={createCheckboxProperty:function(e){var t=!!(e.defaultValue?e.defaultValue:e.value);return{id:e.name,type:"ToggleButton",propertyType:"CheckBox",label:e.caption,ariaLabel:e.caption,public:this._isPropertyPublic(e),name:e.name,displayPos:this._isPropertyValidNumber(e.displayPos)?e.displayPos:10,checked:t,defaultValue:t,active:!!e.active&&e.active}},createTextInputProperty:function(e){return{id:e.name,type:"InputLabel",propertyType:"InputLabel",label:e.caption,ariaLabel:e.caption,public:!0,name:e.name,handleReturnKey:!0,displayPos:10,defaultValue:e.defaultValue?e.defaultValue:"",active:!!e.active&&e.active,multilingual:!!e.multilingual&&e.multilingual}},createFontSizeProperty:function(e){var i=[{value:"auto",label:t.get("fontSizeAuto")},{value:"12",label:"12"},{value:"14",label:"14"},{value:"16",label:"16"},{value:"24",label:"24"}];return{type:"DropDown",id:e.name,name:e.name,label:e.caption,propertyType:"font",defaultValue:e.defaultValue?e.defaultValue:"auto",public:!1,active:!!e.active&&e.active,options:i}},createNumberProperty:function(t){var n=!1!==t.percentage&&e.isNumber(t.minValue)&&e.isNumber(t.maxValue)?{type:"../UiSlider",module:"../ui/UiSlider",sliderType:"percentage",id:t.name,label:t.caption,defaultValue:t.defaultValue?t.defaultValue:0,value:t.value?t.value:0,active:!!t.active&&t.active,ariaLabel:t.caption,range:{min:t.percentage?100*t.minValue:t.minValue,max:t.percentage?100*t.maxValue:t.maxValue},noInputView:!0,connect:[!0,!1],step:t.percentage?100*t.step:t.step,start:[100],format:{decimals:0,postfix:t.percentage?"%":void 0}}:{type:"InputLabel",inputType:"text",id:t.name,label:t.caption,defaultValue:t.defaultValue?t.defaultValue:null,ariaLabel:t.caption,displayMultiplier:t.displayMultiplier,value:t.value?t.value:null,active:!!t.active&&t.active,public:this._isPropertyPublic(t),parseFloat:!0,handleReturnKey:!0};return t.supportsValidationChecks&&t.validationInfo&&i._addValidationChecksForNumberProp(t,n),n},_isAValidFloat:function(e){return!(isNaN(e)||isNaN(Number.parseFloat(e)))},_addValidationChecksForNumberProp:function(e,n){n.showInlineError=!0,e.validationInfo&&e.validationInfo.placeHolderTextId&&(n.placeHolderText=t.get(e.validationInfo.placeHolderTextId)),n.customValidatorCallback=function(n){return{isValid:(e.validationInfo.supportsFloats?i._isAValidFloat(n):Number.isInteger(n))||""===n&&e.allowNull,message:t.get(e.validationInfo.messageId)}}},_getDefaultValueForEnum:function(e){return e.hasOwnProperty("def")&&e.def.hasOwnProperty("defaultValue")&&e.def.defaultValue?e.def.defaultValue.name:e.hasOwnProperty("defaultValue")?e.defaultValue&&e.defaultValue.name?e.defaultValue.name:e.defaultValue:e.value},createEnumProperty:function(t){var n=[];e.each(t.possibleValues,(function(e){var t={label:e.caption,value:e.name};n.push(t)}));var a=i._getDefaultValueForEnum(t);return{type:"DropDown",id:t.name,label:t.caption,ariaLabel:t.caption,defaultValue:a,options:n,active:!!t.active&&t.active,public:this._isPropertyPublic(t)}},_isPropertyPublic:function(e){return void 0===e.public||e.public},_isPropertyValidNumber:function(e){return"number"==typeof e},getMaintainAxisScaleProperty:function(){return{type:"ToggleButton",id:"maintainAxisScales",name:"maintainAxisScales",label:t.get("propMaintainAxisScales"),ariaLabel:t.get("propMaintainAxisScales"),public:!0,defautValue:!1,displayPos:0,active:!0}},getTransparencyPropertyForLayer:function(e){return e?{name:e.name,id:e.name,label:e.caption,ariaLabel:e.caption,type:null,module:"../../core-client/ui/UiSlider",sliderType:"percentage",connect:[!0,!1],defaultValue:e.value||e.defaultValue?e.value||e.defaultValue:.2,range:{min:0,max:100},step:1,format:{decimals:1,postfix:"%"},displayPos:19,noInputView:!0,active:!!e.active&&e.active}:null}}),i}}})),define("dashboard-analytics/visualizations/vipr/properties/ColorPropertiesCreator",["underscore","dashboard-analytics/widgets/livewidget/nls/StringResources","dashboard-analytics/visualizations/vipr/VIPRUtils","dashboard-analytics/visualizations/vipr/VIPRConfig"],(function(e,t,i,n){"use strict";var a;return a=null,{getInstance:function(){return a||(a={createColorProperty:function(e){return{id:e.name,type:"Color",propertyType:"Color",label:e.caption,ariaLabel:e.caption,public:!1,sectionName:t.get("sectionName_colorPalette"),tabName:t.get("tabName_visualization"),name:e.name,displayPos:10,active:!!e.active&&e.active}},getCategoricalColorPalettePropertyDesc:function(){return{id:"colorPalette",name:"colorPalette",type:"NewPalette",sectionLabel:t.get("propColorPalette"),newPaletteLabel:t.get("propNewColorPaletteLabel"),linkLabel:t.get("propColorPaletteChangeLabel"),enableReorder:!1,ariaLabel:t.get("propColorPalette"),sectionName:t.get("sectionName_colorPalette"),tabName:t.get("tabName_visualization"),public:!0,paletteType:"ColorPalette",displayPos:0,reversePalettePropName:"heatScalePalette",active:!0}},getDataLayerIdFromPaletteAndSlots:function(t,i){var n=t&&t.slot&&t.slot.name,a=n&&e.find(i,(function(e){return n===e.getId()})),o=a&&a.getDefinition().getDatasetIdList()[0];return"data"===o||"dataset"===o?null:o},getContinuousColorPalettePropertyNameWithLayer:function(e){return e?"contColorPalette_"+e:"contColorPalette"},_getCategoricalColorPalettePropertyNameWithLayer:function(e){return e?"colorPalette_"+e:"colorPalette"},getHeatScalePalettePropertyNameWithLayer:function(e){return e?"heatScalePalette_"+e:"heatScalePalette"},getHeatScalePalettePropertySectionNameWithLayer:function(e){return t.get(e&&e.colorRelatedProps.sectionNameId||"sectionName_colorPalette")},_getLayerDescriptionUsingId:function(t,i){return e.find(t.layerDescriptions,(function(e){return e.id===i}))},_getCategoricalColorPalettePropertyDescWithLayerId:function(i,n){var o=a._getCategoricalColorPalettePropertyNameWithLayer(n),s=a.getHeatScalePalettePropertyNameWithLayer(n),r=a._getLayerDescriptionUsingId(i,n),l=[{id:o,name:o,type:"NewPalette",sectionLabel:t.get(r&&r.colorRelatedProps.labelId||"propColorPalette"),newPaletteLabel:t.get("propNewColorPaletteLabel"),linkLabel:t.get("propColorPaletteChangeLabel"),enableReorder:!1,ariaLabel:t.get(r&&r.colorRelatedProps.labelId||"propColorPalette"),sectionName:a.getHeatScalePalettePropertySectionNameWithLayer(r),tabName:t.get("tabName_visualization"),public:!0,paletteType:"ColorPalette",displayPos:0,reversePalettePropName:s,defaultValue:r?r.colorRelatedProps.defaultPaletteValue:null,active:!0}];return r&&e.has(r.colorRelatedProps,"defaultColorIndex")&&l.push({id:o+"_defaultIndex",displayPos:1,type:"ColorPicker",public:!0,showHexValue:!0,sectionName:t.get("sectionName_colorPalette"),tabName:t.get("tabName_visualization"),palettePropertyName:o,paletteType:"ColorPalette",defaultValue:r.colorRelatedProps.defaultColorIndex.defaultValue||0,label:t.get(r.colorRelatedProps.defaultColorIndex.labelId),ariaLabel:t.get(r.colorRelatedProps.defaultColorIndex.labelId),active:!0,addMissingBaseColors:!1}),l},_getContinuousColorPalettePropertyDescWithLayerId:function(e,i){var n=a.getContinuousColorPalettePropertyNameWithLayer(i),o=a.getHeatScalePalettePropertyNameWithLayer(i),s=a._getLayerDescriptionUsingId(e,i);return{id:n,name:n,type:"NewPalette",sectionLabel:t.get(s&&(s.colorRelatedProps.contLabelId||s.colorRelatedProps.labelId)||"propHeatScalePalette"),newPaletteLabel:t.get("propNewHeatPaletteLabel"),linkLabel:t.get("propHeatPaletteChangeLabel"),open:!1,ariaLabel:t.get(s&&(s.colorRelatedProps.contLabelId||s.colorRelatedProps.labelId)||"propHeatScalePalette"),enableReorder:!0,paletteType:"HeatPalette",sectionName:a.getHeatScalePalettePropertySectionNameWithLayer(s),tabName:t.get("tabName_visualization"),reversePalettePropName:o,defaultValue:s?s.colorRelatedProps.defaultPaletteValue:null,active:!0}},_getHeatScaleOrderPropertyDescriptionWithLayerId:function(e,i){var n=e&&a._getLayerDescriptionUsingId(e,i);return{id:a.getHeatScalePalettePropertyNameWithLayer(i),public:!1,active:!0,sectionName:a.getHeatScalePalettePropertySectionNameWithLayer(n),tabName:t.get("tabName_visualization")}},_getHeatScaleOrderPropertyDescription:function(){return a._getHeatScaleOrderPropertyDescriptionWithLayerId(null)},_getColorPalettePropertiesForLayersFromVisId:function(e){var t=[];return e.layerDescriptions.forEach((function(i){t.push.apply(t,a._getCategoricalColorPalettePropertyDescWithLayerId(e,i.id)),t.push(a._getContinuousColorPalettePropertyDescWithLayerId(e,i.id));var n={name:i.colorRelatedProps.transparencyProp,active:!0},o=a.getTransparencyPropertyForLayer(n);o&&t.push(o);var s=a._getHeatScaleOrderPropertyDescriptionWithLayerId(e,i.id);s&&t.push(s)})),t},_getColorPalettePropertyForLayer:function(e,t,i,n){switch(e){case"cat":i.push.apply(i,a._getCategoricalColorPalettePropertyDescWithLayerId(t,n)),i.push(a._getHeatScaleOrderPropertyDescriptionWithLayerId(t,n));break;case"cont":i.push(a._getContinuousColorPalettePropertyDescWithLayerId(t,n)),i.push(a._getHeatScaleOrderPropertyDescriptionWithLayerId(t,n));break;case"single":i.push(a._getCategoricalColorPalettePropertyDesc())}},getTransparencyPropertyForLayer:function(e){return e?{name:e.name,id:e.name,label:e.caption,ariaLabel:e.caption,type:null,module:"lib/@waca/core-client/js/core-client/ui/UiSlider",sliderType:"percentage",description:t.get("propTransparencyDescription"),connect:[!0,!1],defaultValue:e.value||e.defaultValue?e.value||e.defaultValue:.2,range:{min:0,max:100},step:1,format:{decimals:1,postfix:"%"},displayPos:19,noInputView:!0,sectionName:t.get("sectionName_colorPalette"),tabName:t.get("tabName_visualization"),active:!!e.active&&e.active}:null},_getColorPaletteLayerTransparencyPropertyForLayer:function(t,i,n,o,s){var r=a.getDataLayerIdFromPaletteAndSlots(n,o),l=e.find(i.layerDescriptions,(function(e){return e.id===r})),c=t.get(l.colorRelatedProps.transparencyProp),u=a.getTransparencyPropertyForLayer(c);u&&s.push(u)},_getColorPaletteProperties:function(e,t,o){var s=[],r=n.getConfig(o);return r&&r.supportsLayers?i.getPalettes(e,o).forEach(function(i){var n=a.getDataLayerIdFromPaletteAndSlots(i,t);n&&(a._getColorPalettePropertyForLayer(i.paletteType,r,s,n),a._getColorPaletteLayerTransparencyPropertyForLayer(e,r,i,t,s))}.bind(a)):r&&i.getPalettes(e,o).forEach((function(e){switch(e.paletteType){case"cat":case"customcat":s.push(a._getCategoricalColorPalettePropertyDesc()),s.push(a._getHeatScaleOrderPropertyDescription());break;case"cont":case"customcont":s.push(a._getContinuousColorPalettePropertyDescWithLayerId(r)),s.push(a._getHeatScaleOrderPropertyDescription())}})),s},_includesPalettesOfType:function(e,t){return e.some((function(e){return e&&e.paletteType===t}))},getDefaultPaletteIndexProperty:function(){return{id:"defaultPaletteIndex",displayPos:1,type:"ColorPicker",public:!0,showHexValue:!0,sectionName:t.get("sectionName_colorPalette"),tabName:t.get("tabName_visualization"),palettePropertyName:"colorPalette",paletteType:"ColorPalette",defaultColorIndex:0,label:t.get("propElementColor"),ariaLabel:t.get("propElementColor"),active:!0,addMissingBaseColors:!1}},getSinglePaletteColorProperty:function(e){return{id:e.id,displayPos:1,type:"ColorPicker",public:!0,showHexValue:!0,sectionName:t.get("sectionName_colorPalette"),tabName:t.get("tabName_visualization"),palettePropertyName:"colorPalette",paletteType:"ColorPalette",defaultColorIndex:e.defaultColorIndex,label:t.get(e.labelId),ariaLabel:t.get(e.labelId),active:!0,addMissingBaseColors:!1}},_isColorSlotEncoded:function(e){void 0===e&&(e=[]);var t=e.find((function(e){return"color"===e.getId()}));return!(!t||!t.getDataItemList().length)},_getCategoricalColorPalettePropertyDesc:function(){return{id:"colorPalette",name:"colorPalette",type:"NewPalette",sectionLabel:t.get("propColorPalette"),newPaletteLabel:t.get("propNewColorPaletteLabel"),linkLabel:t.get("propColorPaletteChangeLabel"),enableReorder:!1,ariaLabel:t.get("propColorPalette"),sectionName:t.get("sectionName_colorPalette"),tabName:t.get("tabName_visualization"),public:!0,paletteType:"ColorPalette",displayPos:0,reversePalettePropName:"heatScalePalette",active:!0}},_addCategoricalPalletePropForSinglePalletesIfNeeded:function(e,t,o){var s=a._includesPalettesOfType(i.getPalettes(t,o),"cat"),r=n.getConfig(o);if(!s&&!r.doesNotSupportCategoricalPalette){var l=a._getCategoricalColorPalettePropertyDesc();e[l.id]=l}},addColorRelatedProperties:function(e,n,o,s,r,l,c){a._getColorPaletteProperties(n,o,s).forEach((function(t){e[t.id]=t}));var u=[];if(i.getSinglePalettes(n,s).length>0){a._addCategoricalPalletePropForSinglePalletesIfNeeded(e,n,s);var d=i.getSinglePaletteProperties(s)||{};Object.values(d).forEach((function(t){var i=a.getSinglePaletteColorProperty(t);e[i.id]=i,u.push(i.id)}))}else if(!a._isColorSlotEncoded(o)&&!i.doesConfigPropertyMatchExpected(s,"ignoreElementColor",!0)){var h=a.getDefaultPaletteIndexProperty();e[h.id]=h,u.push(h.id)}if(c){var p=l.getFeature("Colors");u.forEach((function(i){var n=e[i];n.paletteTitle=t.get("colorPaletteTitle"),n.paletteId=n.palettePropertyName?a._getColorPalettePropertyValue(r,p,n.palettePropertyName,n.paletteType):p.getColorSetId()}))}},_getColorPalettePropertyValue:function(e,t,i,n){return e.getPropertyValue(i)||t.getDefaultPaletteName(n)},getColorPalettePropertiesFromVisId:function(e){var t=n.getConfig(e);if(t&&t.supportsLayers)return a._getColorPalettePropertiesForLayersFromVisId(t);var i=[];return t&&(i.push(a.getCategoricalColorPalettePropertyDesc(t)),i.push(a._getContinuousColorPalettePropertyDescWithLayerId(t)),i.push(a._getHeatScaleOrderPropertyDescription())),i}}),a}}})),define("dashboard-analytics/visualizations/vipr/properties/PropertiesCreatorFromVisDefinition",["underscore","dashboard-analytics/widgets/livewidget/nls/StringResources","dashboard-analytics/visualizations/properties/PropertiesCreator","dashboard-analytics/visualizations/vipr/properties/ColorPropertiesCreator","dashboard-analytics/visualizations/vipr/VIPRUtils","../VIPRConfig"],(function(e,t,i,n,a,o){"use strict";var s;return s=null,{getInstance:function(){return s||(s={_createGenericProperty:function(e){return{id:e,name:e}},getPropertiesFromDefintion:function(e){var t=i.getInstance(),r=n.getInstance(),l=[],c=o.getConfig(e)||{};c&&c.config&&c.config.include&&c.config.include.forEach((function(t){var i=s._createGenericProperty(t),n=a.overrideProperty(e,i,t);l.push(n)})),l.push(t.getMaintainAxisScaleProperty());var u=a.getSinglePaletteProperties(e);u?Object.values(u).forEach((function(e){l.push(r.getSinglePaletteColorProperty(e))})):l.push(r.getDefaultPaletteIndexProperty());var d=r.getColorPalettePropertiesFromVisId(e);return d&&d.length&&(l=l.concat(d)),c.propertyList&&(l=l.concat(c.propertyList)),l},getVizDefPropertiesFromDefinition:function(t){var i=[],n=o.getConfig(t.id)||{};return n&&n.config&&n.config.include&&n.config.include.forEach((function(n){var o=s._createGenericProperty(n),r=t.vizDef.getProperty(n)||{};o.active=!0,o=e.extend(r,o);var l=a.overrideProperty(t.id,o,n);i.push(l)})),i.get=function(e){return i.find((function(t){return t.id===e}))},i}}),s}}})),define("dashboard-analytics/visualizations/definitions/providers/VIPR3Provider",["underscore","./BaseProvider","../../vipr/VIPR","../../vipr/VIPRUtils","../../vipr/VIPRConfig","../../vipr/VIPRLibraries","../../vipr/properties/PropertiesCreatorFromVisDefinition","../../../lib/@waca/dashboard-common/dist/utils/ObjectHelper","../../../widgets/livewidget/nls/StringResources","../../../widgets/livewidget/util/VisUtil"],(function(e,t,i,n,a,o,s,r,l,c){"use strict";var u="dashboard-analytics/visualizations/renderer/vipr3/VIPRView",d=t.extend({init:function(){d.inherited("init",this,arguments),this.viprdefinitionsPromises=null,this.createDefinitionsMap={},this.loadedVipr3Bundles={},this.enableCustomVisualizations=this.dashboardApi.getConfiguration("enableCustomVisualizations"),this.initPromise=i.initialize({dashboardApi:this.dashboardApi,ajax:this.ajax,preFetch:this.preFetch,enableCustomVisualizations:this.enableCustomVisualizations})},contains:function(e){return this.initPromise.then((function(){var t=i.getLibraries();return Promise.resolve(!!t[e])}))},clear:function(e){var t=this;if(void 0===e&&(e=o.LIB_TYPE_ALL),e===o.LIB_TYPE_ALL)this.viprdefinitionsPromises=null,this.createDefinitionsMap={},this.loadedVipr3Bundles={};else if(this.viprdefinitionsPromises){var n=[];e===o.LIB_TYPE_SYSTEM?n=i.getSystemLibIds():e===o.LIB_TYPE_CUSTOM&&(n=i.getCustomLibIds()),n.forEach((function(e){delete t.viprdefinitionsPromises[e],delete t.createDefinitionsMap[e],delete t.loadedVipr3Bundles[e],a.removeCustomVisConfiguration(e)}))}},_visualizationPreviewWasLoaded:function(){return!!this.loadedVipr3Bundles.visualizationPreview},refreshProvider:function(t){var n=this,a=this._visualizationPreviewWasLoaded();return this.clear(o.LIB_TYPE_CUSTOM),this.initPromise=i.initialize({dashboardApi:t,refresh:!0,ajax:this.ajax,preFetch:this.preFetch,enableCustomVisualizations:this.enableCustomVisualizations}),this.initPromise.then(this._getVIPRDefinitions.bind(this,o.LIB_TYPE_CUSTOM,a)).then((function(){var t=Object.values(n.viprdefinitionsPromises);return Promise.all(t).then((function(t){return e.chain(t).map((function(e){return e?n.createDefinition(e,!0):null})).filter((function(e){return!!e})).value()}))}))},getDefinition:function(e){var t=this;return this.initPromise.then((function(){return t._getVIPRDefinition(e).then((function(i){return i?(t.createDefinitionsMap[e]||(t.createDefinitionsMap[e]=t.createDefinition(i,!0)),t.createDefinitionsMap[e]):Promise.reject(c.createVisDefinitionLoadingError(e))}))}))},getDefinitions:function(e){var t=this,i=e?o.LIB_TYPE_SYSTEM:o.LIB_TYPE_ALL;return this.initPromise.then((function(){return t._getVIPRDefinitions(i).then((function(e){return t._createDefinitions(e,!0)}))}))},_createDefinitions:function(t,i){var n=this;return this.createDefinitionsMap||(this.createDefinitionsMap={}),e.chain(t).map((function(e){if(!n.createDefinitionsMap[e.id])return n.createDefinitionsMap[e.id]=n.createDefinition(e,i),n.createDefinitionsMap[e.id]})).filter((function(e){return!!e})).value()},refresh:function(e){var t=this;return i.unloadBundle(e),this._loadVIPRDefinition(e).then((function(i){return t.createDefinitionsMap||(t.createDefinitionsMap={}),t.createDefinitionsMap[e]=i?t.createDefinition(i,!0):{id:e,renderer:u,empty:!0},t.createDefinitionsMap[e]}))},_loadVIPRDefinition:function(e){var t=this;return i.loadBundle(e).then((function(i){return t.loadedVipr3Bundles[e]=i,i})).catch((function(e){console.error(e)}))},_getVIPRDefinition:function(e){return this.viprdefinitionsPromises||(this.viprdefinitionsPromises={}),this.viprdefinitionsPromises[e]||(this.viprdefinitionsPromises[e]=this._loadVIPRDefinition(e)),this.viprdefinitionsPromises[e]},_getVIPRDefinitions:function(t,n){var a,s=this;void 0===t&&(t=o.LIB_TYPE_SYSTEM),void 0===n&&(n=!1),a=n?i.getBundleIds(t):e.without(i.getBundleIds(t),"visualizationPreview");var r=e.map(a,(function(e){return s._getVIPRDefinition(e)}));return Promise.all(r.map((function(e){return e.catch((function(e){return e}))}))).then((function(t){return e.filter(t,(function(e){return!!e}))})).catch((function(e){console.error(e)}))},_getViprDefinitionProperties:function(e){return e.vizDef.properties},_getCaption:function(e,t,i,n){return e.userData.name&&"customVisTestVisualization"!==e.userData.name?i?e.userData.name:n&&"schematicTestCaption"!==e.userData.name?t.name:l.get(e.userData.name):t.name},_doesViprDefinitionSupportTooltipSlots:function(e){return!(n.noDataQuery(e.id)||n.doesConfigPropertyMatchExpected(e.id,"doesNotSupportTooltipSlot",!0))},createDefinition:function(e,t){var i=a.getConfig(e.id),o=i&&i.type||e.userData.type,l=i&&i.isSchematic,c=i&&i.isCustomVis,d=i&&i.usages,h=this._getPlaceholder(e,c,l),p=this._getCaption(e,i,c,l),g=i&&i.dataSetConfig,m=l?i.icon:e.userData.icon,f=l?i.assetId:e.userData.assetId;n.includeAllProperties(e)&&this._setViprConfigDefinition(i,e,[],{});var v=s.getInstance().getVizDefPropertiesFromDefinition(e),_=s.getInstance().getPropertiesFromDefintion(e.id);(c||l)&&this._convertVIPRCustomColorDefaultValues(_);var b={type:o,isSchematic:l,isCustomVis:c,id:e.id,supportsSortAction:n.supportsSortAction(e.id),supportsContextualTopBottomAction:n.supportsContextualTopBottomAction(e.id),supportsNonContextualTopBottomAction:n.supportsNonContextualTopBottomAction(e.id),supportsFormatAction:n.supportsFormatAction(e.id),supportsMaintainAxisScale:n.supportsMaintainAxisScale(e.id),supportsCustomGroupAction:n.supportsCustomGroupAction(e.id),supportsCustomDataSelection:n.supportsCustomDataSelection(e.id),supportsAnnotations:n.supportsAnnotations(e.id),supportsForecasts:n.doesConfigPropertyMatchExpected(e.id,"supportsForecasts",!0),datasets:this._getDatasets(e.vizDef.dataSets,g),geo:n.isGeospatial(e.id),name:e.id,caption:p,label:p,icon:m,assetId:f,tabs:n.getVisualizationTabs(e.id),placeholderIcon:h,isRecommendable:n.isRecommendable(e.id),noDataQuery:n.noDataQuery(e.id),isMultilayersWidget:n.doesConfigPropertyMatchExpected(e.id,"isMultilayersWidget",!0),useFPDAsInsightsInput:n.useFPDAsInsightsInput(e.id),disablePan:n.isDisablePan(e.id),renderWithoutCompletingMapping:n.isRenderWithoutCompletingMapping(e.id),aggregateAndSortOnClient:n.aggregateAndSortOnClient(e.id),dataSlots:n.createDataSlots(e),metaDataEntries:n.createMetaDataEntries(e.vizDef),properties:_,vizDefProperties:v,propertyPrefixes:n.getPropertyPrefixes(e),listenForPropChanges:n.getListenForPropChanges(e),groupedProperty:n.getGroupedProperty(e),elementStyle:n.getElementStyleProperty(e),renderer:u,scope:"default",queryHints:n.getQueryHints(e.id),binningConfig:n.getBinningConfig(e.id),supportsOLAP:!n.doesConfigPropertyMatchExpected(e.id,"doesNotSupportOLAP",!0),usages:d};l&&(b.getSchematicContent=i.schematicVis.getSchematicContent.bind(i.schematicVis));var y=n.getDataRowLimit(e.id);y&&(b.dataRowLimit=y);var I=n.getDataRowLimitIE(e.id);return I&&(b.dataRowLimitIE=I),this._doesViprDefinitionSupportTooltipSlots(b)&&this.addTooltipSlots(b),t?r.deepFreezeObject(b):b},_convertVIPRCustomColorDefaultValues:function(e){return e&&e.forEach((function(e){"color"===e.type&&e.defaultValue&&(e.defaultValue=e.defaultValue.toString())})),e},_setViprConfigDefinition:function(e,t,o,s){n.getViprProperiesAndGroups(t,o,s);var r={viprProperties:o,viprGroupProperties:_extends({},s),dataSets:t.vizDef.dataSets};a.setAllViprConfigProperties(e,r),t.userData.config={properties:{exclude:[],include:e.bundleInclude}},i.updateCustomLibrary(t.id)},_getPlaceholder:function(e,t,i){var n=i&&"com.ibm.vis.schematicsPreview"!==e.id,a=t&&"visualizationPreview"!==e.id,o=this.icon_root,s=e.userData.placeholderIcon;return e.userData.icon?(a||n)&&(o=e.userData.placeholderIcon,s=e.userData.icon):t?s="placeholders/custom-visual.svg":i&&(s="placeholders/custom-schematic.svg"),o+s},_getDatasets:function(t,i){void 0===i&&(i={});var n=1===t.length;return e.map(t,(function(e){var t=n&&!e.name?"data":e.name,a=i&&i[t]&&i[t].tooltipSlotCaption;return{id:t,name:t,optional:e.optional,suppressMissing:e.suppressMissing,needsSorted:e.needsSorted,requiresValues:e.requiresValues,caption:e.caption,tooltipCaption:a}}))}});return d})),define("dashboard-analytics/visualizations/definitions/providers/LocalProvider",["underscore","./BaseProvider","../../../DynamicFileLoader","dashboard-analytics/widgets/livewidget/nls/StringResources"],(function(e,t,i,n){var a=/{{ICON:.*}}/,o=t.extend({definitionsPromise:null,init:function(e){o.inherited("init",this,arguments),this.logger=e.dashboardApi.getGlassCoreSvc(".Logger"),this.localDefinitions=[]},clear:function(){this.definitionsPromise=null},_fetchIconId:function(e){var t=this,n=[],o=function(o){if("object"==typeof e[o]&&null!==e[o])n.push.apply(n,t._fetchIconId(e[o]));else if("string"==typeof e[o]&&a.test(e[o])){var s=e[o].slice(7,-2).split("."),r=s[0],l=s.slice(1),c="dashboard-analytics/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/"+r;n.push(i.load([c]).then((function(t){var i=t[0];l.forEach((function(e){i=i[e]})),e[o]=i})))}};for(var s in e)o(s);return n},_isCustomUri:function(e){return/v[0-9]*\/.*$/.test(e)},_preprocessDefinitions:function(e){var t=this,i=this.dashboardApi&&this.dashboardApi.getGlassCoreSvc(".FeatureChecker"),a=i&&i.checkValue("dashboard","PropertiesV2","enabled"),o=[];return e.forEach((function(e){(e.id=e.id.replace("com.ibm.bi.dashboard.",""),a)&&(e.propertyList||[]).forEach((function(e){if(e.editor)if("visualization.chart"===e.editor.sectionId)e.editor.sectionId="chart";else if("visualization.color"===e.editor.sectionId){e.editor.sectionId="color";var t=e.editor.uiControl;t&&"DashboardColorSet"===t.paletteType&&(t.paletteTitle=n.get("colorPaletteTitle"),"elementColor"===e.id&&(t.ignoreTransparentColor=!0,e.defaultValue="#161616"))}}));var i=t._isCustomUri(e.placeholderIcon);e.placeholderIcon=(i?"":t.icon_root)+e.placeholderIcon,o.push.apply(o,t._fetchIconId(e))})),Promise.all(o).then((function(){return e}))},getDefinitions:function(){var e=this;return this.definitionsPromise||(this.definitionsPromise=new Promise((function(t){e.dashboardApi.findGlassCollection("com.ibm.bi.dashboard.live-visualizations").then((function(t){return e._preprocessDefinitions(t)})).then((function(i){var n;e.setDefinitions(i),e.massageDefinitions(i),e.freezeDefinitions(i),i=i||[],(n=e.localDefinitions).push.apply(n,i),t(e.localDefinitions)})).catch((function(i){e.logger.error("Error: unable to query local definitions",i),t([])}))}))),this.definitionsPromise},massageDefinitions:function(e){void 0===e&&(e=[]),e.forEach((function(e){var t=e.datasets;t&&t.forEach((function(e){e.getId=function(){return e.name}}))}))},refreshProvider:function(){return Promise.resolve(this.localDefinitions)},refresh:function(){throw new Error("refresh is not supported for local provider")}});return o})),define("dashboard-analytics/visualizations/vipr/properties/VIPRPropertiesOrderer",["underscore"],(function(e){"use strict";var t;return t=null,{getInstance:function(){return t||(t={_setPropertyDescLevel:function(e,t,i){var n=e[t];n&&(n.displayPos=i)},_setLevel0To4:function(e){t._setPropertyDescLevel(e,"itemAxis.title.visible",0),t._setPropertyDescLevel(e,"valueAxis.title.visible",0),t._setPropertyDescLevel(e,"valueAxis.column.title.visible",0),t._setPropertyDescLevel(e,"itemAxis.ticks.labels.visible",0),t._setPropertyDescLevel(e,"valueAxis.ticks.labels.visible",0),t._setPropertyDescLevel(e,"valueAxis.line.visible",1),t._setPropertyDescLevel(e,"valueAxis.column.line.visible",1),t._setPropertyDescLevel(e,"valueAxis.line.line.visible",1),t._setPropertyDescLevel(e,"itemAxis.line.visible",1),t._setPropertyDescLevel(e,"itemAxis.tickInterval",1),t._setPropertyDescLevel(e,"colorPalette",0),t._setPropertyDescLevel(e,"colorPalette_column_defaultIndex",0),t._setPropertyDescLevel(e,"itemAxis.ticks.visible",1),t._setPropertyDescLevel(e,"valueAxis.ticks.visible",1),t._setPropertyDescLevel(e,"valueAxis.tickInterval",2),t._setPropertyDescLevel(e,"defaultPaletteIndex",1),t._setPropertyDescLevel(e,"valueAxis.column.title",1),t._setPropertyDescLevel(e,"valueAxis.column.title.font",2),t._setPropertyDescLevel(e,"valueAxis.column.ticks.labels.font",2),t._setPropertyDescLevel(e,"lineColor",2),t._setPropertyDescLevel(e,"valueAxis.column.title.color",4),t._setPropertyDescLevel(e,"valueAxis.line.color",4),t._setPropertyDescLevel(e,"itemAxis.line.color",4),t._setPropertyDescLevel(e,"valueAxis.column.line.color",4),t._setPropertyDescLevel(e,"valueAxis.line.line.color",4),t._setPropertyDescLevel(e,"valueAxis.line.title.visible",5),t._setPropertyDescLevel(e,"valueAxis.line.title",6),t._setPropertyDescLevel(e,"valueAxis.line.title.font",7),t._setPropertyDescLevel(e,"valueAxis.line.title.color",9)},_setBooleanDefaultOrder:function(t){e.each(t,(function(e){"CheckBox"===e.type&&(e.displayPos=6)}))},_setLevel10To14:function(e){t._setPropertyDescLevel(e,"valueAxis.minValue",5),t._setPropertyDescLevel(e,"valueAxis.maxValue",6),t._setPropertyDescLevel(e,"valueAxis.line.minValue",5),t._setPropertyDescLevel(e,"valueAxis.line.maxValue",6),t._setPropertyDescLevel(e,"valueAxis.column.minValue",7),t._setPropertyDescLevel(e,"valueAxis.column.maxValue",8),t._setPropertyDescLevel(e,"itemAxis.minValue",7),t._setPropertyDescLevel(e,"itemAxis.maxValue",8),t._setPropertyDescLevel(e,"start.min",12),t._setPropertyDescLevel(e,"end.min",12),t._setPropertyDescLevel(e,"legendlabel.min",12),t._setPropertyDescLevel(e,"start.mid",12),t._setPropertyDescLevel(e,"end.mid",12),t._setPropertyDescLevel(e,"legendlabel.mid",12),t._setPropertyDescLevel(e,"start.max",12),t._setPropertyDescLevel(e,"end.max",12),t._setPropertyDescLevel(e,"legendlabel.max",12),t._setPropertyDescLevel(e,"itemAxis.labels.layoutMode",13),t._setPropertyDescLevel(e,"itemAxis.ticks.labels.rotateAngle",14),t._setPropertyDescLevel(e,"axis.x.alignment",14),t._setPropertyDescLevel(e,"itemAxis.alignment",14)},_setLevel15To19:function(e){t._setPropertyDescLevel(e,"stacked",15),t._setPropertyDescLevel(e,"stacked.percent",16),t._setPropertyDescLevel(e,"itemAxis.gridLines.color",16),t._setPropertyDescLevel(e,"valueAxis.gridLines.color",17),t._setPropertyDescLevel(e,"valueAxis.column.gridLines.color",17)},_setLevel20To24:function(e){t._setPropertyDescLevel(e,"target.marker.color",0),t._setPropertyDescLevel(e,"target.marker.thickness",1),t._setPropertyDescLevel(e,"bar.relativePadding",5),t._setPropertyDescLevel(e,"bar.direction.vertical",8),t._setPropertyDescLevel(e,"lineWithPoints.nullValuesHandling",9),t._setPropertyDescLevel(e,"lineWithPoints.interpolate",9),t._setPropertyDescLevel(e,"lineWithPoints.width",9),t._setPropertyDescLevel(e,"intermediate.labels.visible",10),t._setPropertyDescLevel(e,"labelLocation",11),t._setPropertyDescLevel(e,"renderingMode",12),t._setPropertyDescLevel(e,"valueAxis.logarithmic",13),t._setPropertyDescLevel(e,"valueAxis.line.logarithmic",13),t._setPropertyDescLevel(e,"transpose",13),t._setPropertyDescLevel(e,"valueAxis.column.logarithmic",14),t._setPropertyDescLevel(e,"totalColumn.visible",0),t._setPropertyDescLevel(e,"totalColumn.label",1),t._setPropertyDescLevel(e,"subcategory.values",2),t._setPropertyDescLevel(e,"subcategory.totals",3),t._setPropertyDescLevel(e,"bubble.size",3),t._setPropertyDescLevel(e,"bubble.size.minValue",4),t._setPropertyDescLevel(e,"bubble.size.maxValue",5)},_setValueLabelProps:function(e){t._setPropertyDescLevel(e,"valueLabels.visible",60),t._setPropertyDescLevel(e,"valueLabels.location",61),t._setPropertyDescLevel(e,"valueLabels.orientation",62),t._setPropertyDescLevel(e,"valueLabels.format",63),t._setPropertyDescLevel(e,"valueLabels.size",64),t._setPropertyDescLevel(e,"valueLabels.color",65),t._setPropertyDescLevel(e,"valueLabels.font",66),t._setPropertyDescLevel(e,"valueLabelsTitle.font",67),t._setPropertyDescLevel(e,"valueLabelsTitle.color",68),t._setPropertyDescLevel(e,"column.valueLabels.visible",60),t._setPropertyDescLevel(e,"column.valueLabels.location",61),t._setPropertyDescLevel(e,"column.valueLabels.orientation",62),t._setPropertyDescLevel(e,"column.valueLabels.format",63),t._setPropertyDescLevel(e,"column.valueLabels.color",64),t._setPropertyDescLevel(e,"column.valueLabels.font",65),t._setPropertyDescLevel(e,"lineWithPoints.valueLabels.visible",66),t._setPropertyDescLevel(e,"lineWithPoints.valueLabels.format",67),t._setPropertyDescLevel(e,"lineWithPoints.valueLabels.color",68),t._setPropertyDescLevel(e,"lineWithPoints.valueLabels.font",69),t._setPropertyDescLevel(e,"valueLabels.contrast.color",70),t._setPropertyDescLevel(e,"contrast.label.color",70),t._setPropertyDescLevel(e,"label.shadow",71),t._setPropertyDescLevel(e,"leaf.labels.visible",60),t._setPropertyDescLevel(e,"labels.visible",60),t._setPropertyDescLevel(e,"label.location",61),t._setPropertyDescLevel(e,"label.percentage",62),t._setPropertyDescLevel(e,"labels.format",63),t._setPropertyDescLevel(e,"label.color",65),t._setPropertyDescLevel(e,"labels.color",65),t._setPropertyDescLevel(e,"inner.label.visible",60),t._setPropertyDescLevel(e,"inner.label.value.font",68),t._setPropertyDescLevel(e,"inner.label.value.color",69),t._setPropertyDescLevel(e,"inner.label.title",70),t._setPropertyDescLevel(e,"inner.label.title.font",71),t._setPropertyDescLevel(e,"inner.label.title.color",72)},_setLevel25To29:function(e){t._setPropertyDescLevel(e,"lines.visible",25),t._setPropertyDescLevel(e,"symbol.shape",27),t._setPropertyDescLevel(e,"symbolShape",27),t._setPropertyDescLevel(e,"markers.visible",28),t._setPropertyDescLevel(e,"lineWithPoints.display",28),t._setPropertyDescLevel(e,"lineWithPoints.symbol",29)},_setLevel30To34:function(e){t._setPropertyDescLevel(e,"pie.has.hole",30),t._setPropertyDescLevel(e,"donut.hole.radius",31),t._setPropertyDescLevel(e,"startAngle",34),t._setPropertyDescLevel(e,"endAngle",34)},_setLevel35To39:function(e){t._setPropertyDescLevel(e,"pointSize.title",35),t._setPropertyDescLevel(e,"pointColor.title",36),t._setPropertyDescLevel(e,"latlongSize.title",37),t._setPropertyDescLevel(e,"latlongColor.title",38),t._setPropertyDescLevel(e,"widget.legend.display",32),t._setPropertyDescLevel(e,"widget.legend.splitter",33),t._setPropertyDescLevel(e,"widget.legend.position",34),t._setPropertyDescLevel(e,"widget.legend.swatch.symbol.default",35),t._setPropertyDescLevel(e,"widget.legend.titleVisible",36),t._setPropertyDescLevel(e,"widget.legend.titleColor",37),t._setPropertyDescLevel(e,"widget.legend.titleFont",38),t._setPropertyDescLevel(e,"widget.legend.color",39),t._setPropertyDescLevel(e,"widget.legend.font",40),t._setPropertyDescLevel(e,"locationColor.title",34),t._setPropertyDescLevel(e,"totalColumn.legend.label.positive",40),t._setPropertyDescLevel(e,"itemAxis.title.font",40),t._setPropertyDescLevel(e,"itemAxis.ticks.labels.font",40),t._setPropertyDescLevel(e,"valueAxis.title.font",40),t._setPropertyDescLevel(e,"valueAxis.ticks.labels.font",40),t._setPropertyDescLevel(e,"valueAxis.line.ticks.labels.font",40),t._setPropertyDescLevel(e,"firstColumn.positive.label",41),t._setPropertyDescLevel(e,"firstColumn.negative.label",41),t._setPropertyDescLevel(e,"value.positive.label",42),t._setPropertyDescLevel(e,"value.negative.label",42),t._setPropertyDescLevel(e,"color.title",45),t._setPropertyDescLevel(e,"pointcolor.title",45),t._setPropertyDescLevel(e,"series.title",45),t._setPropertyDescLevel(e,"categories.title",45),t._setPropertyDescLevel(e,"columnColor.title",45),t._setPropertyDescLevel(e,"lineColor.title",45),t._setPropertyDescLevel(e,"values.title",46),t._setPropertyDescLevel(e,"size.title",47),t._setPropertyDescLevel(e,"color.min",48),t._setPropertyDescLevel(e,"color.mid",49),t._setPropertyDescLevel(e,"color.max",50)},orderProperties:function(e){t._setLevel0To4(e),t._setBooleanDefaultOrder(e),t._setLevel10To14(e),t._setLevel15To19(e),t._setLevel20To24(e),t._setLevel25To29(e),t._setLevel30To34(e),t._setLevel35To39(e),t._setValueLabelProps(e)}}),t}}})),define("dashboard-analytics/visualizations/properties/PropertySectioner",["underscore","dashboard-analytics/widgets/livewidget/nls/StringResources"],(function(e,t){"use strict";var i,n,a,o;return i=null,n={colorPalette:1,axis:2,legend:3,chart:4},a={"itemAxis.title.visible":{sectionId:"axis.itemAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.title.visible":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.title.visible":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.title.visible":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.ticks.labels.layoutMode":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},heatScalePalette:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},colorPalette:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},contColorPalette:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},defaultPaletteIndex:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},lineColor:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},fromColor:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},goal_color:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},compositeLineColor:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},maintainAxisScales:{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.line.color":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.gridLines.color":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.gridLines.color":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.gridLines.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.gridLines.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.gridLines.color":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.color":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.line.color":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.line.color":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.line.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.line.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.line.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.minValue":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.maxValue":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.minValue":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.maxValue":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.minValue":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.maxValue":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.minValue":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.maxValue":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"widget.repeatHorizontal.labels.font":{sectionId:"axis.repeatColumnTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"widget.repeatHorizontal.labels.color":{sectionId:"axis.repeatColumnTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"widget.repeatVertical.labels.font":{sectionId:"axis.repeatRowTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"widget.repeatVertical.labels.color":{sectionId:"axis.repeatRowTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.display":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.titleVisible":{sectionId:"legend.legendTitle",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.aggregateTypeVisible":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.swatch.symbol.default":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.position":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"color.title":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"pointcolor.title":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"series.title":{sectionId:"legend.legendTitle",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"values.title":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"categories.title":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"size.title":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"columnColor.title":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"lineColor.title":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"gridLines.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.ticks.labels.color":{sectionId:"axis.itemAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.ticks.labels.color":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabels.font":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabels.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"labels.color":{sectionId:"chart",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabelsTitle.font":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabelsTitle.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabels.contrast.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabels.size":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabels.format":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.tickInterval":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.tickInterval":{sectionId:"axis.itemAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.ticks.labels.font":{sectionId:"axis.itemAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.ticks.labels.font":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.title.color":{sectionId:"axis.itemAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.title.color":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.title":{sectionId:"axis.itemAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.title":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.title.font":{sectionId:"axis.itemAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.ticks.labels.visible":{sectionId:"axis.itemAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.ticks.visible":{sectionId:"axis.itemAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.ticks.labels.rotateAngle":{sectionId:"axis.itemAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.ticks.labels.visible":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.ticks.visible":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.title.font":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.logarithmic":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.logarithmic":{sectionId:"axis",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.logarithmic":{sectionId:"axis",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.labels.layoutMode":{sectionId:"axis.itemAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"axis.x.alignment":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.alignment":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},gridlineColor:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},labelColor:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},backgroundColor:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},colorPalette_column:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},colorPalette_column_defaultIndex:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},contColorPalette_column:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},colorPalette_line:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},colorPalette_line_defaultIndex:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},optimizeSize:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"widget.iterator":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"mapLabels.localLanguage":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"border.width":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"border.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.color":{sectionId:"legend.legendLabels",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.splitter":{sectionId:"legend",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.font":{sectionId:"legend.legendLabels",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.titleColor":{sectionId:"legend.legendTitle",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"widget.legend.titleFont":{sectionId:"legend.legendTitle",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.labels.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.labels.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.zeroOrigin":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},transpose:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"start.min":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"end.min":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"legendlabel.min":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"start.mid":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"end.mid":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"legendlabel.mid":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"start.max":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"end.max":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"legendlabel.max":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"area.interpolate":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"data.handling":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"contrast.axes.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"contrast.text.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"axis.title.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"axis.indicators.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"axis.labels.visible":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"target.title.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"target.title.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"target.marker.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"target.marker.thickness":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"axis.label.color":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"axis.title.color":{sectionId:"axis",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},targetVisibility:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"effect.duration":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},tableAreaBackground:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},tableContentBackground:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},contrastText:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},showMinimap:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},actions:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},showInsights:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},treeMode:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},topBottomN:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},topBottomTargetValue:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"leaf.labels.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"contrast.label.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"label.shadow":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"intermediate.labels.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"donut.hole.radius":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},startAngle:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},endAngle:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"label.percentage":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"labels.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"inner.label.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"inner.label.title":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"inner.label.value.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"inner.label.value.font":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"inner.label.title.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"inner.label.title.font":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},labelLocation:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},sort:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},dataHandling:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"bubble.size":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"bubble.size.minValue":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"bubble.size.maxValue":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},symbolShape:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"stacked.percent":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"column.border.width":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"column.border.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabels.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"column.valueLabels.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"column.valueLabels.location":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"column.valueLabels.orientation":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"column.valueLabels.format":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"column.valueLabels.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"column.valueLabels.font":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lineWithPoints.valueLabels.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lineWithPoints.valueLabels.format":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lineWithPoints.valueLabels.color":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lineWithPoints.valueLabels.font":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"color.min":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"color.mid":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"color.max":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"labels.format":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabels.location":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueLabels.orientation":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"itemAxis.labels.vertical":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lines.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"markers.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},nullValuesHandling:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lineWithPoints.nullValuesHandling":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lineWithPoints.interpolate":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lineWithPoints.symbol":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"line.interpolate":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"effect.entry.line.type":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"effect.entry.line.delay":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"effect.entry.line.stagger":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"effect.entry.line.duration":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"word.orientation":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"dial.roundedEnds":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"dial.maxValue":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"dial.propotionalwidths":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"dial.showAsPercentage":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"bar.padding":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"bar.relativePadding":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"bar.direction.vertical":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},stacked:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"effect.entry.bar.type":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"effect.entry.bar.delay":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"effect.entry.bar.stagger":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"effect.entry.bar.duration":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lines.smooth":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.title":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.title.color":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.title.font":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.title":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.title.color":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.title.font":{sectionId:"axis.valueAxisTitle",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.ticks.labels.visible":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.ticks.visible":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.ticks.labels.visible":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.ticks.visible":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.ticks.labels.font":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.column.ticks.labels.color":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.ticks.labels.font":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},"valueAxis.line.ticks.labels.color":{sectionId:"axis.valueAxisLabel",sectionResource:"sectionName_axis",tabId:"visualization",tabResource:"tabName_visualization"},sortX:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},useSingleAxis:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},syncAxes:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},alignZero:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"lineWithPoints.display":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},swapLineColumn:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"zoom.bar.enable":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"network.links.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"totalColumn.visible":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"totalColumn.label":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"totalColumn.positive.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"totalColumn.negative.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"firstColumn.positive.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"firstColumn.negative.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"column.positive.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"column.negative.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette",tabId:"visualization",tabResource:"tabName_visualization"},"totalColumn.legend.label.positive":{sectionId:"chart",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"totalColumn.legend.label.negative":{sectionId:"chart",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"firstColumn.positive.label":{sectionId:"chart",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"firstColumn.negative.label":{sectionId:"chart",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"value.positive.label":{sectionId:"chart",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"value.negative.label":{sectionId:"chart",sectionResource:"sectionName_legend",tabId:"visualization",tabResource:"tabName_visualization"},"map.style.2":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"map.style.url":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"Mapbox.worldView":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},autoZoom:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},maxZoom:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"views.hidden":{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},enableLayerControl:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},enableFeatureSearchControl:{sectionId:"chart",sectionResource:"sectionName_chart",tabId:"visualization",tabResource:"tabName_visualization"},"region.visible":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"region.transparency":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"region.minHeight":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"region.maxHeight":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"region.custom.mapId":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"region.custom.layerName":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"region.custom.propertyName":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"locationColor.title":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.visible":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.defaultSize":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.minSize":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.maxSize":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.transparency":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.staticZeroValueSize":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.custom.mapId":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.custom.layerName":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.custom.propertyName":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.grouping.mode":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.grouping.transition":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.grouping.heat.weight":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.grouping.cluster.radius":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.grouping.cluster.groups":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.grouping.hexbin.radius":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.grouping.hexbin.minExtrudeHeight":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.grouping.hexbin.maxExtrudeHeight":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"pointSize.title":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"pointColor.title":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"point.sizeScaling":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latlongSize.title":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latlongColor.title":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.visible":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.defaultSize":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.minSize":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.maxSize":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.transparency":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.staticZeroValueSize":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.grouping.mode":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.grouping.transition":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.grouping.heat.weight":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.grouping.cluster.radius":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.grouping.cluster.groups":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.grouping.hexbin.radius":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.grouping.hexbin.minExtrudeHeight":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"latLong.grouping.hexbin.maxExtrudeHeight":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"colorPalette_data.region":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"colorPalette_data.point":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"colorPalette_data.latlong":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"contColorPalette_data.region":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"contColorPalette_data.point":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer",tabId:"visualization",tabResource:"tabName_visualization"},"contColorPalette_data.latlong":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer",tabId:"visualization",tabResource:"tabName_visualization"},"Mapbox.accountName":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"},"Mapbox.token":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer",tabId:"visualization",tabResource:"tabName_visualization"}},o={itemAxisTitle:{active:!0,collapsible:!1,id:"itemAxisTitle",label:t.get("sectionItemAxisTitle"),type:"Section",position:20},itemAxisLabel:{active:!0,collapsible:!1,id:"itemAxisLabel",label:t.get("sectionItemAxisLabel"),type:"Section",position:21},valueAxisTitle:{active:!0,collapsible:!1,id:"valueAxisTitle",label:t.get("sectionValueAxisTitle"),type:"Section",position:22},valueAxisLabel:{active:!0,collapsible:!1,id:"valueAxisLabel",label:t.get("sectionValueAxisLabel"),type:"Section",position:23},repeatColumnTitle:{active:!0,collapsible:!1,id:"repeatColumnTitle",label:t.get("sectionRepeatColumnTitle"),type:"Section",position:24},repeatRowTitle:{active:!0,collapsible:!1,id:"repeatRowTitle",label:t.get("sectionRepeatRowTitle"),type:"Section",position:25},legendTitle:{active:!0,collapsible:!1,id:"legendTitle",label:t.get("sectionName_legendTitle"),type:"Section",position:37},legendLabels:{active:!0,collapsible:!1,id:"legendLabels",label:t.get("sectionName_legendLabels"),type:"Section",position:39}},{getInstance:function(){return i||(i={getSectionInformationForPropertyId:function(i){var o;return a&&a[i]?((o=a[i]).tabName=t.get(o.tabResource),o.sectionName=t.get(o.sectionResource),o.sectionPosition=n[o.sectionId.split(".")[0]],e.omit(o,"tabResource","sectionResource")):((o={}).tabId="visualization",o.tabName=t.get("tabName_visualization"),o.sectionId="chart",o.sectionName=t.get("sectionName_chart"),o.sectionPosition=n[o.sectionId.split(".")[0]],o)},getSection:function(e){return o[e]}}),i}}})),define("dashboard-analytics/visualizations/properties/PropertySectionerV2",["underscore","dashboard-analytics/widgets/livewidget/nls/StringResources"],(function(e,t){return function(){var e=null,i=["mapStyle","regionLayer","pointLayer","latLongLayer","colorPalette","chart","dataValueLabels","innerValueLabel","itemAxis","itemAxisTitle","itemAxisLabel","valueAxis","valueAxisTitle","valueAxisLabel","columnValueAxis","columnValueAxisTitle","columnValueAxisLabel","lineValueAxis","lineValueAxisTitle","lineValueAxisLabel","legend","title"],n={titleMode:{sectionId:"title",sectionResource:"sectionName_title"},responsiveTitle:{sectionId:"title",sectionResource:"sectionName_title"},"column.valueLabels.visible":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"column.valueLabels.color":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"valueLabels.format":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"valueLabels.location":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"valueLabels.color":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"valueLabels.size":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"valueLabels.font":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"contrast.label.color":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"valueLabels.orientation":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"valueLabels.visible":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"label.shadow":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"intermediate.labels.visible":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},contrastText:{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"lineWithPoints.valueLabels.visible":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"lineWithPoints.valueLabels.color":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"labels.format":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"label.percentage":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"labels.visible":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},labelLocation:{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"contrast.axes.color":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"contrast.text.color":{sectionId:"dataValueLabels",sectionResource:"sectionName_dataValueLabels"},"inner.label.visible":{sectionId:"innerValueLabel",sectionResource:"sectionName_innerValueLabel"},"inner.label.title":{sectionId:"innerValueLabel",sectionResource:"sectionName_innerValueLabel"},"inner.label.value.font":{sectionId:"innerValueLabel",sectionResource:"sectionName_innerValueLabel"},"inner.label.title.font":{sectionId:"innerValueLabel",sectionResource:"sectionName_innerValueLabel"},"itemAxis.minValue":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.maxValue":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.alignment":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.labels.vertical":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.gridLines.visible":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.ticks.visible":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.line.visible":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.line.color":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.tickInterval":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.gridLines.color":{sectionId:"itemAxis",sectionResource:"sectionName_xAxis"},"itemAxis.title.visible":{sectionId:"itemAxisTitle",sectionResource:"sectionName_xAxis_title"},"itemAxis.title":{sectionId:"itemAxisTitle",sectionResource:"sectionName_xAxis_title"},"itemAxis.title.font":{sectionId:"itemAxisTitle",sectionResource:"sectionName_xAxis_title"},"itemAxis.title.color":{sectionId:"itemAxisTitle",sectionResource:"sectionName_xAxis_title"},"itemAxis.labels.visible":{sectionId:"itemAxisLabel",sectionResource:"sectionName_xAxis_label"},"itemAxis.labels.layoutMode":{sectionId:"itemAxisLabel",sectionResource:"sectionName_xAxis_label"},"itemAxis.ticks.labels.visible":{sectionId:"itemAxisLabel",sectionResource:"sectionName_xAxis_label"},"itemAxis.ticks.labels.rotateAngle":{sectionId:"itemAxisLabel",sectionResource:"sectionName_xAxis_label"},"itemAxis.ticks.labels.font":{sectionId:"itemAxisLabel",sectionResource:"sectionName_xAxis_label"},"itemAxis.ticks.labels.layoutMode":{sectionId:"itemAxisLabel",sectionResource:"sectionName_xAxis_label"},"itemAxis.ticks.labels.color":{sectionId:"itemAxisLabel",sectionResource:"sectionName_xAxis_label"},maintainAxisScales:{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.logarithmic":{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.minValue":{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.maxValue":{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.zeroOrigin":{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.ticks.visible":{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.tickInterval":{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.gridLines.visible":{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.line.visible":{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.line.color":{sectionId:"valueAxis",sectionResource:"sectionName_yAxis"},"valueAxis.title.visible":{sectionId:"valueAxisTitle",sectionResource:"sectionName_yAxis_title"},"valueAxis.title":{sectionId:"valueAxisTitle",sectionResource:"sectionName_yAxis_title"},"valueAxis.title.font":{sectionId:"valueAxisTitle",sectionResource:"sectionName_yAxis_title"},"valueAxis.title.color":{sectionId:"valueAxisTitle",sectionResource:"sectionName_yAxis_title"},"valueAxis.labels.visible":{sectionId:"valueAxisLabel",sectionResource:"sectionName_yAxis_label"},"valueAxis.ticks.labels.visible":{sectionId:"valueAxisLabel",sectionResource:"sectionName_yAxis_label"},"valueAxis.ticks.labels.font":{sectionId:"valueAxisLabel",sectionResource:"sectionName_yAxis_label"},"valueAxis.ticks.labels.color":{sectionId:"valueAxisLabel",sectionResource:"sectionName_yAxis_label"},"valueAxis.column.title.visible":{sectionId:"columnValueAxisTitle",sectionResource:"sectionName_column_yAxis_title"},"valueAxis.column.title":{sectionId:"columnValueAxisTitle",sectionResource:"sectionName_column_yAxis_title"},"valueAxis.column.title.color":{sectionId:"columnValueAxisTitle",sectionResource:"sectionName_column_yAxis_title"},"valueAxis.column.title.font":{sectionId:"columnValueAxisTitle",sectionResource:"sectionName_column_yAxis_title"},"valueAxis.column.ticks.labels.visible":{sectionId:"columnValueAxisLabel",sectionResource:"sectionName_column_yAxis_label"},"valueAxis.column.ticks.visible":{sectionId:"columnValueAxisLabel",sectionResource:"sectionName_column_yAxis_label"},"valueAxis.column.ticks.labels.font":{sectionId:"columnValueAxisLabel",sectionResource:"sectionName_column_yAxis_label"},"valueAxis.column.ticks.labels.color":{sectionId:"columnValueAxisLabel",sectionResource:"sectionName_column_yAxis_label"},"valueAxis.column.minValue":{sectionId:"columnValueAxis",sectionResource:"sectionName_column_yAxis"},"valueAxis.column.maxValue":{sectionId:"columnValueAxis",sectionResource:"sectionName_column_yAxis"},"valueAxis.column.logarithmic":{sectionId:"columnValueAxis",sectionResource:"sectionName_column_yAxis"},"valueAxis.line.title.visible":{sectionId:"lineValueAxisTitle",sectionResource:"sectionName_line_yAxis_title"},"valueAxis.line.title":{sectionId:"lineValueAxisTitle",sectionResource:"sectionName_line_yAxis_title"},"valueAxis.line.title.color":{sectionId:"lineValueAxisTitle",sectionResource:"sectionName_line_yAxis_title"},"valueAxis.line.title.font":{sectionId:"lineValueAxisTitle",sectionResource:"sectionName_line_yAxis_title"},"valueAxis.line.ticks.labels.visible":{sectionId:"lineValueAxisLabel",sectionResource:"sectionName_line_yAxis_label"},"valueAxis.line.ticks.visible":{sectionId:"lineValueAxisLabel",sectionResource:"sectionName_line_yAxis_label"},"valueAxis.line.ticks.labels.font":{sectionId:"lineValueAxisLabel",sectionResource:"sectionName_line_yAxis_label"},"valueAxis.line.ticks.labels.color":{sectionId:"lineValueAxisLabel",sectionResource:"sectionName_line_yAxis_label"},"valueAxis.line.minValue":{sectionId:"lineValueAxis",sectionResource:"sectionName_line_yAxis"},"valueAxis.line.maxValue":{sectionId:"lineValueAxis",sectionResource:"sectionName_line_yAxis"},"valueAxis.line.logarithmic":{sectionId:"lineValueAxis",sectionResource:"sectionName_line_yAxis"},heatScalePalette:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},colorPalette:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},contColorPalette:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},defaultPaletteIndex:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},lineColor:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},fromColor:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},goal_color:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},compositeLineColor:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},backgroundColor:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},colorPalette_column:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},colorPalette_column_defaultIndex:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},contColorPalette_column:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},colorPalette_line:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},colorPalette_line_defaultIndex:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},tableAreaBackground:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},tableContentBackground:{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"color.min":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"color.mid":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"color.max":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"network.links.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"totalColumn.positive.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"totalColumn.negative.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"firstColumn.positive.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"firstColumn.negative.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"column.positive.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"column.negative.color":{sectionId:"colorPalette",sectionResource:"sectionName_colorPalette"},"widget.legend.position":{sectionId:"legend",sectionResource:"sectionName_legend"},"widget.legend.swatch.symbol.default":{sectionId:"legend",sectionResource:"sectionName_legend"},"widget.legend.titleVisible":{sectionId:"legend",sectionResource:"sectionName_legend"},"widget.legend.display":{sectionId:"legend",sectionResource:"sectionName_legend"},"widget.legend.splitter":{sectionId:"legend",sectionResource:"sectionName_legend"},"widget.legend.aggregateTypeVisible":{sectionId:"legend",sectionResource:"sectionName_legend"},"color.title":{sectionId:"legend",sectionResource:"sectionName_legend"},"pointcolor.title":{sectionId:"legend",sectionResource:"sectionName_legend"},"series.title":{sectionId:"legend",sectionResource:"sectionName_legend"},"values.title":{sectionId:"legend",sectionResource:"sectionName_legend"},"categories.title":{sectionId:"legend",sectionResource:"sectionName_legend"},"size.title":{sectionId:"legend",sectionResource:"sectionName_legend"},"columnColor.title":{sectionId:"legend",sectionResource:"sectionName_legend"},"lineColor.title":{sectionId:"legend",sectionResource:"sectionName_legend"},"widget.legend.color":{sectionId:"legend",sectionResource:"sectionName_legend"},"widget.legend.font":{sectionId:"legend",sectionResource:"sectionName_legend"},"totalColumn.legend.label.positive":{sectionId:"legend",sectionResource:"sectionName_legend"},"totalColumn.legend.label.negative":{sectionId:"legend",sectionResource:"sectionName_legend"},"firstColumn.positive.label":{sectionId:"legend",sectionResource:"sectionName_legend"},"firstColumn.negative.label":{sectionId:"legend",sectionResource:"sectionName_legend"},"value.positive.label":{sectionId:"legend",sectionResource:"sectionName_legend"},"value.negative.label":{sectionId:"legend",sectionResource:"sectionName_legend"},gridlineColor:{sectionId:"chart",sectionResource:"sectionName_chart"},labelColor:{sectionId:"chart",sectionResource:"sectionName_chart"},optimizeSize:{sectionId:"chart",sectionResource:"sectionName_chart"},"widget.iterator":{sectionId:"chart",sectionResource:"sectionName_chart"},"mapLabels.localLanguage":{sectionId:"chart",sectionResource:"sectionName_chart"},"border.width":{sectionId:"chart",sectionResource:"sectionName_chart"},"border.color":{sectionId:"chart",sectionResource:"sectionName_chart"},transpose:{sectionId:"chart",sectionResource:"sectionName_chart"},"area.interpolate":{sectionId:"chart",sectionResource:"sectionName_chart"},"data.handling":{sectionId:"chart",sectionResource:"sectionName_chart"},targetVisibility:{sectionId:"chart",sectionResource:"sectionName_chart"},"target.title.visible":{sectionId:"chart",sectionResource:"sectionName_chart"},"target.title.color":{sectionId:"chart",sectionResource:"sectionName_chart"},"target.marker.color":{sectionId:"chart",sectionResource:"sectionName_chart"},"target.marker.thickness":{sectionId:"chart",sectionResource:"sectionName_chart"},"effect.duration":{sectionId:"chart",sectionResource:"sectionName_chart"},showMinimap:{sectionId:"chart",sectionResource:"sectionName_chart"},actions:{sectionId:"chart",sectionResource:"sectionName_chart"},showInsights:{sectionId:"chart",sectionResource:"sectionName_chart"},treeMode:{sectionId:"chart",sectionResource:"sectionName_chart"},topBottomN:{sectionId:"chart",sectionResource:"sectionName_chart"},topBottomTargetValue:{sectionId:"chart",sectionResource:"sectionName_chart"},"leaf.labels.visible":{sectionId:"chart",sectionResource:"sectionName_chart"},"donut.hole.radius":{sectionId:"chart",sectionResource:"sectionName_chart"},startAngle:{sectionId:"chart",sectionResource:"sectionName_chart"},endAngle:{sectionId:"chart",sectionResource:"sectionName_chart"},sort:{sectionId:"chart",sectionResource:"sectionName_chart"},dataHandling:{sectionId:"chart",sectionResource:"sectionName_chart"},symbolShape:{sectionId:"chart",sectionResource:"sectionName_chart"},"stacked.percent":{sectionId:"chart",sectionResource:"sectionName_chart"},"gridlines.visible":{sectionId:"chart",sectionResource:"sectionName_chart"},"column.border.width":{sectionId:"chart",sectionResource:"sectionName_chart"},"column.border.color":{sectionId:"chart",sectionResource:"sectionName_chart"},"lines.visible":{sectionId:"chart",sectionResource:"sectionName_chart"},"markers.visible":{sectionId:"chart",sectionResource:"sectionName_chart"},"lineWithPoints.interpolate":{sectionId:"chart",sectionResource:"sectionName_chart"},"lineWithPoints.symbol":{sectionId:"chart",sectionResource:"sectionName_chart"},"line.interpolate":{sectionId:"chart",sectionResource:"sectionName_chart"},"effect.entry.line.type":{sectionId:"chart",sectionResource:"sectionName_chart"},"effect.entry.line.delay":{sectionId:"chart",sectionResource:"sectionName_chart"},"effect.entry.line.stagger":{sectionId:"chart",sectionResource:"sectionName_chart"},"effect.entry.line.duration":{sectionId:"chart",sectionResource:"sectionName_chart"},"word.orientation":{sectionId:"chart",sectionResource:"sectionName_chart"},"dial.roundedEnds":{sectionId:"chart",sectionResource:"sectionName_chart"},"dial.maxValue":{sectionId:"chart",sectionResource:"sectionName_chart"},"dial.propotionalwidths":{sectionId:"chart",sectionResource:"sectionName_chart"},"dial.showAsPercentage":{sectionId:"chart",sectionResource:"sectionName_chart"},"bar.padding":{sectionId:"chart",sectionResource:"sectionName_chart"},"bar.relativePadding":{sectionId:"chart",sectionResource:"sectionName_chart"},"bar.direction.vertical":{sectionId:"chart",sectionResource:"sectionName_chart"},stacked:{sectionId:"chart",sectionResource:"sectionName_chart"},"effect.entry.bar.type":{sectionId:"chart",sectionResource:"sectionName_chart"},"effect.entry.bar.delay":{sectionId:"chart",sectionResource:"sectionName_chart"},"effect.entry.bar.stagger":{sectionId:"chart",sectionResource:"sectionName_chart"},"effect.entry.bar.duration":{sectionId:"chart",sectionResource:"sectionName_chart"},"lines.smooth":{sectionId:"chart",sectionResource:"sectionName_chart"},sortX:{sectionId:"chart",sectionResource:"sectionName_chart"},useSingleAxis:{sectionId:"chart",sectionResource:"sectionName_chart"},syncAxes:{sectionId:"chart",sectionResource:"sectionName_chart"},"lineWithPoints.display":{sectionId:"chart",sectionResource:"sectionName_chart"},swapLineColumn:{sectionId:"chart",sectionResource:"sectionName_chart"},autoZoom:{sectionId:"chart",sectionResource:"sectionName_chart"},maxZoom:{sectionId:"chart",sectionResource:"sectionName_chart"},"views.hidden":{sectionId:"chart",sectionResource:"sectionName_chart"},enableLayerControl:{sectionId:"chart",sectionResource:"sectionName_chart"},enableFeatureSearchControl:{sectionId:"chart",sectionResource:"sectionName_chart"},"totalColumn.visible":{sectionId:"chart",sectionResource:"sectionName_chart"},"totalColumn.label":{sectionId:"chart",sectionResource:"sectionName_chart"},"map.style.2":{sectionId:"mapStyle",sectionResource:"sectionName_style"},"map.style.url":{sectionId:"mapStyle",sectionResource:"sectionName_style"},"Mapbox.worldView":{sectionId:"chart",sectionResource:"sectionName_chart"},"region.visible":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"region.transparency":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"region.minHeight":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"region.maxHeight":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"region.custom.mapId":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"region.custom.layerName":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"region.custom.propertyName":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"locationColor.title":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"colorPalette_data.region":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"contColorPalette_data.region":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"Mapbox.accountName":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"Mapbox.token":{sectionId:"regionLayer",sectionResource:"sectionName_regionLayer"},"point.visible":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.defaultSize":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.minSize":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.maxSize":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.transparency":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.staticZeroValueSize":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.custom.mapId":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.custom.layerName":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.custom.propertyName":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.grouping.mode":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.grouping.transition":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.grouping.heat.weight":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.grouping.cluster.radius":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.grouping.cluster.groups":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.grouping.hexbin.radius":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.grouping.hexbin.minExtrudeHeight":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.grouping.hexbin.maxExtrudeHeight":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"pointSize.title":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"pointColor.title":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"point.sizeScaling":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"colorPalette_data.point":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"contColorPalette_data.point":{sectionId:"pointLayer",sectionResource:"sectionName_pointLayer"},"latlongSize.title":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latlongColor.title":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.visible":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.defaultSize":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.minSize":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.maxSize":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.transparency":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.staticZeroValueSize":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.grouping.mode":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.grouping.transition":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.grouping.heat.weight":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.grouping.cluster.radius":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.grouping.cluster.groups":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.grouping.hexbin.radius":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.grouping.hexbin.minExtrudeHeight":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"latLong.grouping.hexbin.maxExtrudeHeight":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"colorPalette_data.latlong":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"},"contColorPalette_data.latlong":{sectionId:"latLongLayer",sectionResource:"sectionName_latLongLayer"}},a=20,o={chart:{active:!0,toggable:!0,id:"chart",label:t.get("sectionName_chart"),type:"Section",position:a++},dataValueLabels:{active:!0,toggable:!0,id:"dataValueLabels",label:t.get("sectionName_dataValueLabels"),type:"Section",position:a++},innerValueLabel:{active:!0,toggable:!0,id:"innerValueLabel",label:t.get("sectionName_innerValueLabel"),type:"Section",position:a++},itemAxis:{active:!0,toggable:!1,id:"itemAxis",label:t.get("sectionName_xAxis"),type:"Section",position:a++},itemAxisTitle:{active:!0,toggable:!0,id:"itemAxisTitle",label:t.get("sectionName_xAxis_title"),type:"Section",position:a++},itemAxisLabel:{active:!0,toggable:!0,id:"itemAxisLabel",label:t.get("sectionName_xAxis_label"),type:"Section",position:a++},valueAxis:{active:!0,toggable:!1,id:"valueAxis",label:t.get("sectionName_yAxis"),type:"Section",position:a++},valueAxisTitle:{active:!0,toggable:!0,id:"valueAxisTitle",label:t.get("sectionName_yAxis_title"),type:"Section",position:a++},valueAxisLabel:{active:!0,toggable:!0,id:"valueAxisLabel",label:t.get("sectionName_yAxis_label"),type:"Section",position:a++},columnValueAxis:{active:!0,toggable:!1,id:"columnValueAxis",label:t.get("sectionName_column_yAxis"),type:"Section",position:a++},columnValueAxisTitle:{active:!0,toggable:!0,id:"columnValueAxisTitle",label:t.get("sectionName_column_yAxis_title"),type:"Section",position:a++},columnValueAxisLabel:{active:!0,toggable:!0,id:"columnValueAxisLabel",label:t.get("sectionName_column_yAxis_label"),type:"Section",position:a++},lineValueAxis:{active:!0,toggable:!1,id:"lineValueAxis",label:t.get("sectionName_line_yAxis"),type:"Section",position:a++},lineValueAxisTitle:{active:!0,toggable:!0,id:"lineValueAxisTitle",label:t.get("sectionName_line_yAxis_title"),type:"Section",position:a++},lineValueAxisLabel:{active:!0,toggable:!0,id:"lineValueAxisLabel",label:t.get("sectionName_line_yAxis_label"),type:"Section",position:a++},legend:{active:!0,toggable:!0,id:"legend",label:t.get("sectionName_legend"),type:"Section",position:a++},title:{active:!0,toggable:!0,id:"title",label:t.get("sectionName_title"),type:"Section",position:a++},positionAndStyle:{active:!0,toggable:!0,id:"positionAndStyle",label:t.get("sectionName_positionAndStyle"),type:"Section",position:a++}},s={itemAxis:"sectionName_yAxis",itemAxisTitle:"sectionName_yAxis_title",itemAxisLabel:"sectionName_yAxis_label",valueAxis:"sectionName_xAxis",valueAxisTitle:"sectionName_xAxis_title",valueAxisLabel:"sectionName_xAxis_label"};function r(){return{getSectionInformationForPropertyId:function(e,a){var o;return n&&n[e]?((o=n[e]).sectionName=function(e,i,n){var a=i;return n&&(a=s[e]||a),t.get(a)}(o.sectionId,o.sectionResource,a),o.sectionPosition=i.indexOf(o.sectionId.split(".")[0])+1,o):((o={}).sectionId="chart",o.sectionName=t.get("sectionName_chart"),o.sectionPosition=i.indexOf(o.sectionId.split(".")[0])+1,o)},getSection:function(e){return o[e]}}}return{getInstance:function(){return e||(e=r()),e}}}()})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/utils/TextEditorConstants",["../nls/StringResources"],(function(e){return{FONT_FAMILY_CHOICES:Object.freeze([{value:"anton",label:"Anton",cssClass:"rt_fontFamilyAnton"},{value:"cherrycreamsoda",label:"Cherry Cream Soda",cssClass:"rt_fontFamilyCherryCreamSoda"},{value:"condiment",label:"Condiment",cssClass:"rt_fontFamilyCondiment-Regular"},{value:"didactgothic",label:"Didact Gothic",cssClass:"rt_fontFamilyDidactGothic"},{value:"euphoriascript",label:"Euphoria Script",cssClass:"rt_fontFamilyEuphoriaScript-Regular"},{value:"helvneueforibm",label:"Helvetica Neue",cssClass:"rt_fontFamilyHelvNeueforIBM-Regular",subCssClasses:[{value:"light",label:e.get("textFontFamilySubClassLight"),cssClass:"rt_fontFamilyHelvNeueforIBM-Light"},{value:"lightitalic",label:e.get("textFontFamilySubClassLightItalic"),cssClass:"rt_fontFamilyHelvNeueforIBM-LightItalic"},{value:"regular",label:e.get("textFontFamilySubClassRegular"),cssClass:"rt_fontFamilyHelvNeueforIBM-Regular"},{value:"italic",label:e.get("textFontFamilySubClassItalic"),cssClass:"rt_fontFamilyHelvNeueforIBM-Italic"},{value:"medium",label:e.get("textFontFamilySubClassMedium"),cssClass:"rt_fontFamilyHelvNeueforIBM-Medium"},{value:"mediumitalic",label:e.get("textFontFamilySubClassMediumItalic"),cssClass:"rt_fontFamilyHelvNeueforIBM-MediumItalic"},{value:"bold",label:e.get("textFontFamilySubClassBold"),cssClass:"rt_fontFamilyHelvNeueforIBM-Bold"},{value:"bolditalic",label:e.get("textFontFamilySubClassBoldItalic"),cssClass:"rt_fontFamilyHelvNeueforIBM-BoldItalic"}]},{value:"kaushanscript",label:"Kaushan Script",cssClass:"rt_fontFamilyKaushanScript-Regular"},{value:"lobster",label:"Lobster",cssClass:"rt_fontFamilyLobster"},{value:"merriweather",label:"Merriweather",cssClass:"rt_fontFamilyMerriweather-Regular",subCssClasses:[{value:"italic",label:e.get("textFontFamilySubClassItalic"),cssClass:"rt_fontFamilyMerriweather-Italic"},{value:"light",label:e.get("textFontFamilySubClassLight"),cssClass:"rt_fontFamilyMerriweather-Light"},{value:"regular",label:e.get("textFontFamilySubClassRegular"),cssClass:"rt_fontFamilyMerriweather-Regular"},{value:"bold",label:e.get("textFontFamilySubClassBold"),cssClass:"rt_fontFamilyMerriweather-Bold"},{value:"bolditalic",label:e.get("textFontFamilySubClassBoldItalic"),cssClass:"rt_fontFamilyMerriweather-BoldItalic"},{value:"black",label:e.get("textFontFamilySubClassBlack"),cssClass:"rt_fontFamilyMerriweather-Black"},{value:"lightitalic",label:e.get("textFontFamilySubClassLightItalic"),cssClass:"rt_fontFamilyMerriweather-LightItalic"},{value:"heavyitalic",label:e.get("textFontFamilySubClassHeavyItalic"),cssClass:"rt_fontFamilyMerriweather-HeavyItalic"}]},{value:"merriweathersans",label:"Merriweather Sans",cssClass:"rt_fontFamilyMerriweatherSans-Regular",subCssClasses:[{value:"italic",label:e.get("textFontFamilySubClassItalic"),cssClass:"rt_fontFamilyMerriweatherSans-Italic"},{value:"light",label:e.get("textFontFamilySubClassLight"),cssClass:"rt_fontFamilyMerriweatherSans-Light"},{value:"lightitalic",label:e.get("textFontFamilySubClassLightItalic"),cssClass:"rt_fontFamilyMerriweatherSans-LightItalic"},{value:"regular",label:e.get("textFontFamilySubClassRegular"),cssClass:"rt_fontFamilyMerriweatherSans-Regular"},{value:"bold",label:e.get("textFontFamilySubClassBold"),cssClass:"rt_fontFamilyMerriweatherSans-Bold"},{value:"bolditalic",label:e.get("textFontFamilySubClassBoldItalic"),cssClass:"rt_fontFamilyMerriweatherSans-BoldItalic"},{value:"extrabold",label:e.get("textFontFamilySubClassExtraBold"),cssClass:"rt_fontFamilyMerriweatherSans-ExtraBold"},{value:"extrabolditalic",label:e.get("textFontFamilySubClassExtraBoldItalic"),cssClass:"rt_fontFamilyMerriweatherSans-ExtraBoldItalic"}]},{value:"monoton",label:"Monoton",cssClass:"rt_fontFamilyMonoton-Regular"},{value:"montserrat",label:"Montserrat",cssClass:"rt_fontFamilyMontserrat-Regular",subCssClasses:[{value:"hairline",label:e.get("textFontFamilySubClassHairline"),cssClass:"rt_fontFamilyMontserrat-Hairline"},{value:"light",label:e.get("textFontFamilySubClassLight"),cssClass:"rt_fontFamilyMontserrat-Light"},{value:"regular",label:e.get("textFontFamilySubClassRegular"),cssClass:"rt_fontFamilyMontserrat-Regular"},{value:"bold",label:e.get("textFontFamilySubClassBold"),cssClass:"rt_fontFamilyMontserrat-Bold"},{value:"black",label:e.get("textFontFamilySubClassBlack"),cssClass:"rt_fontFamilyMontserrat-Black"}]},{value:"opensanscondensed",label:"Open Sans Condensed",cssClass:"rt_fontFamilyOpenSansCondensed-Light",subCssClasses:[{value:"light",label:e.get("textFontFamilySubClassLight"),cssClass:"rt_fontFamilyOpenSansCondensed-Light"},{value:"lightitalic",label:e.get("textFontFamilySubClassLightItalic"),cssClass:"rt_fontFamilyOpenSansCondensed-LightItalic"},{value:"bold",label:e.get("textFontFamilySubClassBold"),cssClass:"rt_fontFamilyOpenSansCondensed-Bold"}]},{value:"oswald",label:"Oswald",cssClass:"rt_fontFamilyOswald-Regular",subCssClasses:[{value:"extralight",label:e.get("textFontFamilySubClassExtraLight"),cssClass:"rt_fontFamilyOswald-ExtraLight"},{value:"extralightitalic",label:e.get("textFontFamilySubClassExtraLightItalic"),cssClass:"rt_fontFamilyOswald-ExtraLightItalic"},{value:"light",label:e.get("textFontFamilySubClassLight"),cssClass:"rt_fontFamilyOswald-Light"},{value:"lightitalic",label:e.get("textFontFamilySubClassLightItalic"),cssClass:"rt_fontFamilyOswald-LightItalic"},{value:"regular",label:e.get("textFontFamilySubClassRegular"),cssClass:"rt_fontFamilyOswald-Regular"},{value:"regularitalic",label:e.get("textFontFamilySubClassRegularItalic"),cssClass:"rt_fontFamilyOswald-RegularItalic"},{value:"medium",label:e.get("textFontFamilySubClassMedium"),cssClass:"rt_fontFamilyOswald-Medium"},{value:"mediumitalic",label:e.get("textFontFamilySubClassMediumItalic"),cssClass:"rt_fontFamilyOswald-MediumItalic"},{value:"demibold",label:e.get("textFontFamilySubClassDemiBold"),cssClass:"rt_fontFamilyOswald-DemiBold"},{value:"demibolditalic",label:e.get("textFontFamilySubClassDemiBoldItalic"),cssClass:"rt_fontFamilyOswald-DemiBoldItalic"},{value:"bold",label:e.get("textFontFamilySubClassBold"),cssClass:"rt_fontFamilyOswald-Bold"},{value:"bolditalic",label:e.get("textFontFamilySubClassBoldItalic"),cssClass:"rt_fontFamilyOswald-BoldItalic"},{value:"heavy",label:e.get("textFontFamilySubClassHeavy"),cssClass:"rt_fontFamilyOswald-Heavy"},{value:"heavyitalic",label:e.get("textFontFamilySubClassHeavyItalic"),cssClass:"rt_fontFamilyOswald-HeavyItalic"},{value:"stencil",label:e.get("textFontFamilySubClassStencil"),cssClass:"rt_fontFamilyOswald-Stencil"}]},{value:"playball",label:"Playball",cssClass:"rt_fontFamilyPlayball"},{value:"ibmplexsans",label:"IBM Plex",default:!0,cssClass:"rt_fontFamilyIBMPlexSans-Regular",subCssClasses:[{value:"light",label:e.get("textFontFamilySubClassLight"),cssClass:"rt_fontFamilyIBMPlexSans-Light"},{value:"lightitalic",label:e.get("textFontFamilySubClassLightItalic"),cssClass:"rt_fontFamilyIBMPlexSans-LightItalic"},{value:"regular",label:e.get("textFontFamilySubClassRegular"),cssClass:"rt_fontFamilyIBMPlexSans-Regular"},{value:"italic",label:e.get("textFontFamilySubClassItalic"),cssClass:"rt_fontFamilyIBMPlexSans-Italic"},{value:"medium",label:e.get("textFontFamilySubClassMedium"),cssClass:"rt_fontFamilyIBMPlexSans-Medium"},{value:"mediumitalic",label:e.get("textFontFamilySubClassMediumItalic"),cssClass:"rt_fontFamilyIBMPlexSans-MediumItalic"},{value:"bold",label:e.get("textFontFamilySubClassBold"),cssClass:"rt_fontFamilyIBMPlexSans-Bold"},{value:"bolditalic",label:e.get("textFontFamilySubClassBoldItalic"),cssClass:"rt_fontFamilyIBMPlexSans-BoldItalic"}]},{value:"roboto",label:"Roboto",cssClass:"rt_fontFamilyRoboto-Regular",subCssClasses:[{value:"thin",label:e.get("textFontFamilySubClassThin"),cssClass:"rt_fontFamilyRoboto-Thin"},{value:"thinitalic",label:e.get("textFontFamilySubClassThinItalic"),cssClass:"rt_fontFamilyRoboto-ThinItalic"},{value:"light",label:e.get("textFontFamilySubClassLight"),cssClass:"rt_fontFamilyRoboto-Light"},{value:"lightitalic",label:e.get("textFontFamilySubClassLightItalic"),cssClass:"rt_fontFamilyRoboto-LightItalic"},{value:"regular",label:e.get("textFontFamilySubClassRegular"),cssClass:"rt_fontFamilyRoboto-Regular"},{value:"italic",label:e.get("textFontFamilySubClassItalic"),cssClass:"rt_fontFamilyRoboto-Italic"},{value:"medium",label:e.get("textFontFamilySubClassMedium"),cssClass:"rt_fontFamilyRoboto-Medium"},{value:"mediumitalic",label:e.get("textFontFamilySubClassMediumItalic"),cssClass:"rt_fontFamilyRoboto-MediumItalic"},{value:"bold",label:e.get("textFontFamilySubClassBold"),cssClass:"rt_fontFamilyRoboto-Bold"},{value:"bolditalic",label:e.get("textFontFamilySubClassBoldItalic"),cssClass:"rt_fontFamilyRoboto-BoldItalic"},{value:"black",label:e.get("textFontFamilySubClassBlack"),cssClass:"rt_fontFamilyRoboto-Black"},{value:"blackitalic",label:e.get("textFontFamilySubClassBlackItalic"),cssClass:"rt_fontFamilyRoboto-BlackItalic"}]},{value:"sortsmillgoudy",label:"Sorts Mill Goudy",cssClass:"rt_fontFamilySortsMillGoudy-Regular",subCssClasses:[{value:"regular",label:e.get("textFontFamilySubClassRegular"),cssClass:"rt_fontFamilySortsMillGoudy-Regular"},{value:"italic",label:e.get("textFontFamilySubClassItalic"),cssClass:"rt_fontFamilySortsMillGoudy-Italic"}]},{value:"specialelite",label:"Special Elite",cssClass:"rt_fontFamilySpecialElite"}]),FONT_SIZE_CHOICES:Object.freeze([{value:"auto",label:e.get("textDefaultFontSize")},{value:"6",label:"6"},{value:"7",label:"7"},{value:"8",label:"8"},{value:"9",label:"9"},{value:"10",label:"10"},{value:"11",label:"11"},{value:"12",label:"12"},{value:"14",label:"14"},{value:"16",label:"16"},{value:"18",label:"18"},{value:"20",label:"20"},{value:"22",label:"22"},{value:"24",label:"24"},{value:"26",label:"26"},{value:"28",label:"28"},{value:"30",label:"30"},{value:"36",label:"36"},{value:"48",label:"48"},{value:"60",label:"60"},{value:"72",label:"72"},{value:"96",label:"96"},{value:"120",label:"120"},{value:"170",label:"170"},{value:"230",label:"230"}]),LINE_HEIGHT_CHOICES:Object.freeze([{value:"default",label:e.get("textDefaultFontSize")},{value:"1.0",label:"1.0"},{value:"1.5",label:"1.5"},{value:"2.0",label:"2.0"},{value:"2.5",label:"2.5"},{value:"3.0",label:"3.0"},{value:"3.5",label:"3.5"},{value:"4.0",label:"4.0"},{value:"4.5",label:"4.5"},{value:"5.0",label:"5.0"}])}})),define("dashboard-analytics/util/FontUtils",["../widgets/livewidget/nls/StringResources"],(function(e){return function(){function t(){}return t.getFontFamilyValueFromCssClass=function(e,t){return t?t.replace("rt_fontFamily",""):e},t.normalizeFonts=function(i){return i.map((function(i){var n=i.value,a=i.label,o=i.cssClass,s=i.subCssClasses;return n=t.getFontFamilyValueFromCssClass(n,o),s=(s=s||[{value:n,label:e.get("regularFontStyle"),cssClass:o}]).map((function(e){var i=e.value,n=e.label,a=e.cssClass;return{value:i=t.getFontFamilyValueFromCssClass(i,a),label:n,cssClass:a}})),{value:n,label:a,cssClass:o,subCssClasses:s}}))},t.sortByLabel=function(e){return e.sort((function(e,t){return e.label<t.label?-1:e.label>t.label?1:0}))},t}()})),define("dashboard-analytics/util/FontFamilyOptions",["../lib/@waca/dashboard-common/dist/utils/TextEditorConstants","./FontUtils"],(function(e,t){var i=null;return i||(i=t.normalizeFonts(e.FONT_FAMILY_CHOICES.concat([{value:"IBM Plex Sans,Helvetica Neue,Arial,sans-serif",label:"IBM Plex Sans",cssClass:""},{value:"IBM Plex Sans Condensed,Helvetica Neue,Arial,sans-serif",label:"IBM Plex Sans Condensed",cssClass:""}])),i=t.sortByLabel(i)),i})),define("dashboard-analytics/visualizations/vipr/properties/FontPropertiesCreator",["underscore","dashboard-analytics/widgets/livewidget/nls/StringResources","dashboard-analytics/util/FontFamilyOptions","dashboard-analytics/util/FontUtils","../../../lib/@waca/dashboard-common/dist/utils/TextEditorConstants"],(function(e,t,i,n,a){"use strict";var o,s;return o=null,s=null,{getInstance:function(){return o||(o={createFontGroupPropertyLayout:function(e){var n=e.property,a=e.context,s=a.content,r=a.dashboard,l=a.properties,c=a.viprUtils,u=a.viprConfig,d=a.sectionId,h=[].concat(i);h.unshift({value:"auto",label:t.get("automaticTypeCaption")});var p,g={id:"font.xdashboardx."+n.id,value:c.getVidaFontPropertiesPart("family",s.getPropertyValue(n.id))||t.get("automaticTypeCaption"),onChange:o._getSetFontProperty_V2("font",n.id,s,c,r,u),options:h},m={id:"fontSize.xdashboardx."+n.id,value:c.getVidaFontPropertiesPart("size",s.getPropertyValue(n.id))||t.get("automaticTypeCaption"),onChange:o._getSetFontProperty_V2("fontSize",n.id,s,c,r,u),options:o._getFontSizeOptions()},f=u.getColorPropertyAssociatedWithFont(n.id),v=l.find((function(e){return e.id===f}));if(v&&v.public){var _=Object.assign({},v),b=r.getFeature("Colors").getDashboardColorSet();p={id:f,addButton:!1,paletteTitle:t.get("colorPaletteTitle"),paletteType:"DashboardColorSet",value:null==_.value?b[0].id:_.value,onChange:_.onChange}}return[{id:n.id+".fontCombo",editor:{sectionId:d,position:n.displayPos,uiControl:{type:"FontCombo",fontFamily:g,fontSize:m,textColor:p}}}]},createFontPropertyLayout:function(a){var s=a.context,r=s.content,l=s.dashboard,c=s.viprUtils,u=s.isCustomVis,d=s.sectionId,h=s.viprConfig,p=a.property,g=l.getFeature("DashboardSettings").get("fonts")||[];g=n.normalizeFonts(g);var m=[].concat(g,i);return m.unshift({value:"auto",label:t.get("automaticTypeCaption")}),[{id:"font.xdashboardx."+p.id,editor:{position:p.displayPos,sectionId:d,uiControl:o._getPropertyUIControl({name:"font.xdashboardx."+p.id,active:!0,options:m,public:!0,ariaLabel:t.get("fontPropLabel"),label:u&&p.label?p.label+" "+t.get("fontFamily"):t.get("fontPropLabel"),type:"DropDown",onChange:o._getSetFontProperty("font",p.id,r,c,l,h),value:c.getVidaFontPropertiesPart("family",r.getPropertyValue(p.id))||t.get("automaticTypeCaption")})}},{id:"fontSize.xdashboardx."+p.id,editor:{position:p.displayPos+1,sectionId:d,uiControl:o._getPropertyUIControl(e.extend(p,{ariaLabel:t.get("fontSizePropLabel"),label:u&&p.label?p.label+" "+t.get("fontSize"):t.get("fontSizePropLabel"),type:"DropDown",options:o._getFontSizeOptions(),onChange:o._getSetFontProperty("fontSize",p.id,r,c,l,h),value:c.getVidaFontPropertiesPart("size",r.getPropertyValue(p.id))||t.get("automaticTypeCaption")}))}}]},_getPropertyUIControl:function(t){return e.omit(t,"id","public","displayPos","tabId","tabName","sectionPosition","sectionId","sectionName")},_getSetFontProperty_V2:function(e,t,i,n,a,s){var r=o._onChangeFontProperty.bind(o);return function(o,l){r({fontPart:e,propertyID:t,content:i,viprUtils:n,dashboard:a,viprConfig:s,value:o,transactionToken:l})}},_onChangeFontProperty:function(t){var i,n=t.fontPart,a=t.propertyID,o=t.content,s=t.viprUtils,r=t.viprConfig,l=t.value,c=t.transactionToken,u=o.getFeature("Visualization").getDefinition().getProperty("groupedProperty")||{},d=o.getPropertyNameList();"auto"===l&&(l=null);var h=s.buildVidaFontPropertiesFromParts(((i={})[n]=l,i),o.getPropertyValue(a)),p=[a];r.isInAllowedGroups(a)&&e.each(u[a],(function(e){-1!==d.indexOf(e)&&p.push(e)})),p.forEach((function(e){return o.setPropertyValue(e,h,c)}))},_getSetFontProperty:function(e,t,i,n,a,s){var r=o._onChangeFontProperty.bind(o);return function(o,l,c){r({fontPart:e,propertyID:t,content:i,viprUtils:n,dashboard:a,viprConfig:s,value:l,transactionToken:c})}},_getFontSizeOptions:function(){return s||(s=a.FONT_SIZE_CHOICES.map((function(e){return{value:"auto"===e.value?e.value:e.value+"px",label:e.label}}))),s}}),o}}})),define("dashboard-analytics/visualizations/vipr/properties/VIPRProperties",["underscore","jquery","../../../widgets/livewidget/nls/StringResources","../VIPRUtils","./VIPRPropertiesOrderer","com/ibm/vida/vipr","../VIPRConfig","dashboard-analytics/visualizations/properties/PropertiesCreator","dashboard-analytics/visualizations/vipr/properties/ColorPropertiesCreator","dashboard-analytics/visualizations/properties/PropertySectioner","dashboard-analytics/visualizations/properties/PropertySectionerV2","dashboard-analytics/visualizations/vipr/properties/FontPropertiesCreator","./PropertiesHelper","../../../apiHelpers/SlotAPIHelper"],(function(e,t,i,n,a,o,s,r,l,c,u,d,h,p){"use strict";var g,m=[],f=[];return g=null,{getInstance:function(){return g||(g={_getConfiguration:function(e){return s.getConfig(e)||{}},_orderProperties:function(e){a.getInstance().orderProperties(e)},_filterToActiveProperties:function(t){return e.filter(t,(function(e){return!0===e.active}))},_moveLayersProperties:function(e,t){var i=g._getConfiguration(e);i&&i.supportsLayers&&i.layerDescriptions.forEach((function(e){var i=t[e.id];i&&e.visibleLayerProps.forEach((function(e){var n=t[e];n&&(i.items.push(n),delete t[e])}))}))},_addColorRelatedProperties:function(e,t,i,n,a,o,s){l.getInstance().addColorRelatedProperties(e,t,i,n,a,o,s)},_getPropertyDescriptionForProperty:function(e,t){var i=null;return"boolean"===e.type?i=t.createCheckboxProperty(e):"enum"===e.type?i=t.createEnumProperty(e):"string"===e.type?i=t.createTextInputProperty(e):"number"===e.type||"length"===e.type?i=t.createNumberProperty(e):"font"===e.type?i=t.createFontSizeProperty(e):"color"===e.type&&(i=l.getInstance().createColorProperty(e)),i},_doesConfigSupportProp:function(e,t,i){return n.doesConfigPropertyMatchExpected(e,t,i)},_addMaintainAxisScalePropIfNeeded:function(e,t,i){g._doesConfigSupportProp(e,"supportsMaintainAxisScale",!0)&&(i.maintainAxisScales=t.getMaintainAxisScaleProperty())},_addAggTypeIfNeeded:function(t,n){var a={id:"widget.legend.aggregateTypeVisible",type:"ToggleButton",propertyType:"CheckBox",label:i.get("aggregateTypeToggler"),ariaLabel:i.get("aggregateTypeToggler"),public:!0,name:"widget.legend.aggregateTypeVisible",displayPos:38,checked:!1,defaultValue:!1,active:e.some(n,(function(e){return!0===p.isMultiMeasuresValueSlot(e)}))&&t["widget.legend.titleVisible"].active};t["widget.legend.aggregateTypeVisible"]=a},_addColorSetProperty:function(t,a,o,s,r,l){var c=n.isPropertyIncluded(r,o)?t.get(o):void 0,u=s.properties[o],d=this._isCustomVis(r);if(c){var h,p,g=!1;u&&!1===u.active?g=!1:void 0===c.active?g=!0:u&&void 0===u.active?g=c.active:u&&(g=u.active),d&&u&&u.caption?h=u.caption:u&&u.caption&&(h=i.get(u.caption)),d?p=this._hasVisPropertyValue(o,"name",a):u&&u.caption&&(p=i.get(u.caption));var m={showHexValue:!0,paletteType:"DashboardColorSet",id:o,label:h||c.caption,type:"ColorPicker",open:!1,originalGroupName:d&&this._hasVisPropertyValue(o,"originalGroupName",a)?a[o].originalGroupName:null,groupName:d&&this._hasVisPropertyValue(o,"groupName",a)?a[o].groupName:null,groupCaption:d&&this._hasVisPropertyValue(o,"groupCaption",a)?a[o].groupCaption:null,sectionName:i.get("sectionName_colorPalette"),tabName:i.get("tabName_visualization"),ariaLabel:p||s.caption,public:void 0===c.public||c.public,active:g};l&&(m.paletteTitle=i.get("colorPaletteTitle")),s.properties[o]&&(a[o]=e.extend(m,e.pick(s.properties[o],"addButton","displayPos")))}},_hasVisPropertyValue:function(e,t,i){return i[e]&&i[e][t]},isTargetThicknessInputValid:function(e){var t=e&&e.endsWith&&e.endsWith("px")?Number(e.slice(0,-2)):Number(e);return Number.isInteger(t)&&t>=2&&t<=20},_addTargetMarkerThicknessIfNeeded:function(e,t,a,o){var s=n.isPropertyIncluded(o,"target.marker.thickness")?e.get("target.marker.thickness"):void 0;if(s){var r=t.createNumberProperty(s);r.handleReturnKey=!0,r.placeHolderText=i.get("targetThicknessPlaceHolder",{min:2,max:20}),r.showInlineError=!0,r.customValidatorCallback=function(e){return{isValid:g.isTargetThicknessInputValid(e),message:i.get("targetThicknessErrorMsg",{min:2,max:20})}},a["target.marker.thickness"]=r}},_addPropsFromVIPR:function(e,t,i,n){var a=this,o=g._getConfiguration(n);o.config&&o.config.include.forEach((function(o){a._addPropertyFromVIPR(e,o,t,i,n)}))},_addCustomVisPropsFromVIPR:function(t,i,n,a){var o=this;m=[],f=[];var s=this._getGroupProperties(a);e.forEach(s,(function(e,s){e.forEach((function(e){o._addPropertyFromVIPR(t,e,i,n,a,s,!0)}))}))},_addPropertyFromVIPR:function(e,i,a,o,s,r,l){var c=e.get(i);if(c){var u=n.overrideProperty(s,c,i);if(!0!==u.hidden){var d=g._getPropertyDescriptionForProperty(u,a);if(d){if(d.name=i,d.id=i,r){var h=e.get(r).caption;d.groupName="customVis-"+t.escapeSelector(r),d.originalGroupName=r,d.groupCaption=h,l&&(e.get(r).active||(d.active=!1),this._addCustomVisAllowedGroups(d,c))}o[i]=d}}}},_addCustomVisAllowedGroups:function(e,t){"font"===e.propertyType?(-1===f.indexOf(this._getFontColorGroupName(e.id,"font"))&&f.push(this._getFontColorGroupName(e.id,"font")),m.push(e.name)):"Color"===e.propertyType&&-1===f.indexOf(this._getFontColorGroupName(e.id,"color"))&&(f.push(this._getFontColorGroupName(e.id,"color")),e.caption=t.caption)},_getFontColorGroupName:function(e,t){return e+"."+t},_isCustomVisAllowedGroups:function(e){var t=-1!==f.indexOf(this._getFontColorGroupName(e,"font")),i=-1!==f.indexOf(this._getFontColorGroupName(e,"color"));return t||i},_filterListonToActiveProperties:function(e,t){var i=this._getListenForPropChangesFromVIPRConfig(t),n=i.slice();i.forEach((function(t){if(!e.filter((function(e){return e.name===t})).length){var i=n.indexOf(t);-1!==i&&n.splice(i,1)}})),this._setListenForPropChangesForVIPRConfig(t,n)},_getPropertyListFromVIPRConfig:function(e){var t=g._getConfiguration(e);return t&&t.propertyList},_getListenForPropChangesFromVIPRConfig:function(e){var t=g._getConfiguration(e);return t&&t.listenForPropChanges},_setListenForPropChangesForVIPRConfig:function(e,t){g._getConfiguration(e).listenForPropChanges=t},_isCustomVis:function(e){var t=g._getConfiguration(e);return t&&t.isCustomVis},_isItemAxisYAxis:function(e){var t=g._getConfiguration(e);return t&&t.isItemAxisYAxis},_getGroupProperties:function(e){var t=g._getConfiguration(e);return t&&t.groupedProperty},_addColorSetProps:function(e,t,i,a){var o=g._getConfiguration(i);o.config&&o.config.include.forEach((function(s){var r=e.get(s);r&&n.overrideProperty(i,r,s).colorClass&&g._addColorSetProperty(e,t,s,o,i,a)}))},getProperties:function(t,i,n,a,o,s){var l={},c=r.getInstance(),u=this._isCustomVis(n),d=this._isItemAxisYAxis(n);u?g._addCustomVisPropsFromVIPR(t,c,l,n):g._addPropsFromVIPR(t,c,l,n),g._addMaintainAxisScalePropIfNeeded(n,c,l),g._addColorRelatedProperties(l,t,i,n,a,o,s),g._addAggTypeIfNeeded(l,i),g._addTargetMarkerThicknessIfNeeded(t,c,l,n),g._addColorSetProps(t,l,n,s),g._moveLayersProperties(n,l),g._orderProperties(l);var h=e.toArray(l),p=g._filterToActiveProperties(h);return u&&g._filterListonToActiveProperties(h,n),g._sectionalizeProperties(p,s,d)},getPropertyList:function(t,i,n,a,o){var s=n.getFeature("Visualization").getDefinition();if(s.getState().getError())return[];var r=s.getId(),l=this._isCustomVis(r),c=this.getProperties(t,i,r,n,a,o),u=g._getPropertyListFromVIPRConfig(r);return u&&!e.isEmpty(u)&&(c=c.concat(u)),this._toUIControlProperties(c,l,o)},getPropertyLayoutList:function(t,i,a,o,r){var l,p=this,g=a.getFeature("Visualization").getDefinition().getId(),f=this._isCustomVis(g),v=a.getFeature("Visualization").getDefinition().getProperty("groupedProperty")||{},_={},b=[];l=r?u.getInstance():c.getInstance();var y=this.getProperties(t,i,g,a,o,r);if(e.each(y,(function(e){if(r||(_[e.tabId]={type:"Group",id:e.tabId,label:e.tabName}),e.sectionId){var t=[];h.splitEscapedString(e.sectionId,".",t),t.forEach((function(t,i){var n={type:"Section",id:t,label:e.sectionName,position:e.sectionPosition};if(0!=i&&!(n=l.getSection(t)))throw new Error("section info not found");_[t]=n}))}var i;i=r?e.sectionId:e.sectionId?e.tabId+"."+e.sectionId:e.tabId;var c=s.isInAllowedGroups(e.id)||p._isCustomVisAllowedGroups(e.id),u=[];if(f&&c&&e.originalGroupName&&(u=v[e.originalGroupName]),s.isFontProperty(e.id)||-1!==m.indexOf(e.id)){var g={content:a,dashboard:o,properties:y,isPropertiesV2Enabled:r,isCustomVis:f,sectionId:i,viprUtils:n,viprConfig:s},I={property:e,context:g},C=d.getInstance();b=!g.isPropertiesV2Enabled||g.isCustomVis?b.concat(C.createFontPropertyLayout(I)):b.concat(C.createFontGroupPropertyLayout(I))}else{var S=f&&-1!==u.indexOf(e.id),w=r?v[e.id]&&!s.isInFontGroupProperties(e.id):v[e.id]&&c;(S||w)&&(b=b.concat(p._getGroupedPropertyLayout(e,a,o,i,r)))}})),r){var I=a.getFeature("Visualization"),C=I&&I.getDefinition(),S=C&&C.getLabel();S&&(_.banner={type:"Banner",id:"banner",value:S})}return e.values(_).concat(b)},_sectionalizeProperties:function(e,t,i){var n;return n=t?u.getInstance():c.getInstance(),e.forEach((function(e){var a=n.getSectionInformationForPropertyId(e.id,i);a&&(e.sectionId=e.groupName||a.sectionId||e.sectionId,e.sectionName=e.groupCaption||a.sectionName||e.sectionName,e.sectionPosition=a.sectionPosition||100,t||(e.tabId=a.tabId||e.tabId,e.tabName=a.tabName||e.tabName))})),e},_toUIControlProperties:function(t,i,n){var a=this;return e.map(t,(function(t){var o,s=e.pick(t,"id");return o=n?t.sectionId:t.sectionId?t.tabId+"."+t.sectionId:t.tabId,s.editor={sectionId:o,uiControl:a._getPropertyUIControl(t)},e.isNumber(t.displayPos)&&(s.editor.position=t.displayPos),a._needToHideDefaultUiControl(t,i,n)&&(s.editor.hidden=!0),s}))},_needToHideDefaultUiControl:function(e,t,i){var n=e.id,a=!1===e.public,o=s.isFontProperty(n)||-1!==m.indexOf(n),r=s.isInAllowedGroups(n)||this._isCustomVisAllowedGroups(n);return i&&!t?a||s.isInFontGroupProperties(n):a||o||r},_getGroupedPropertyLayout:function(t,i,n,a,o){var s=i.getFeature("Visualization").getDefinition().getProperty("groupedProperty")||{},r=i.getPropertyNameList(),l=!n.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","ElementStyleAction","disabled"),c={id:t.id,editor:{position:t.displayPos,sectionId:a,uiControl:this._getPropertyUIControl(e.extend(t,{onChange:function(a,o){"ColorPicker"===t.type&&(o=o.name);var c=[a];l||e.each(s[a],(function(e){-1!==r.indexOf(e)&&c.push(e)}));var u=n.getFeature("Transaction").startTransaction();c.forEach((function(e){return i.setPropertyValue(e,o,u)})),n.getFeature("Transaction").endTransaction(u)}}))}};return o&&(c.editor.uiControl.onChange=function(a){"ColorPicker"===t.type&&(a=a.name);var o=[t.id];l||e.each(s[t.id],(function(e){-1!==r.indexOf(e)&&o.push(e)}));var c=n.getFeature("Transaction").startTransaction();o.forEach((function(e){return i.setPropertyValue(e,a,c)})),n.getFeature("Transaction").endTransaction(c)}),[c]},_getPropertyUIControl:function(t){return e.omit(t,"id","public","displayPos","tabId","tabName","sectionPosition","sectionId","sectionName")},setProperty:function(e,t){e.setProperty(t.id,t.value)},_initializeFredIsRedPalette:function(t,i,n){var a={defaultIndex:n||0,colors:i.colors,colorCallback:o.Color.rgb},s=i.toString();i.getColor=function(i,n,o){var s=[];if(void 0!==i&&void 0!==n&&void 0!==o&&o>=0){var r=i&&i.items[o];s.push(r&&r.source&&r.source.unformattedValue||"")}else s=i&&e.map(i.items,(function(e){return e.source&&e.source.unformattedValue||""}));return t.getColor(a,s,n)},i.toString=function(){return"fredIsRed("+s+")"}},setPaletteResolvers:function(e,t,i,n){var a=l.getInstance().getDataLayerIdFromPaletteAndSlots(e,i);if(e.paletteType===t.type&&(!t.dataLayerId||a===t.dataLayerId)){var s=null;if(t.colors){switch(t.type){case"cat":s=new o.CatPaletteResolver(t.colors,t.defaultIndex),n&&g._initializeFredIsRedPalette(n,s,t.defaultIndex);break;case"customcat":s=new o.CustomCatPaletteResolver(t.colors);break;case"cont":s=new o.ContPaletteResolver(t.colors,null,t.isLegacy);break;case"customcont":s=new o.CustomContPaletteResolver(t.colors,null,t.isLegacy);break;default:s=null}if(s){var r=e.getValue&&e.getValue()?e.getValue():{};r.toString()===s.toString()&&r.defaultIndex===s.defaultIndex||e.setValue(s)}}}},setSinglePaletteResolvers:function(e,t){var i=new o.CatPaletteResolver(t.colors),a=t.colors.length;i.ordinal=t.defaultIndex;var s=i.ordinal<a?i.ordinal:0,r=n.getPalettes(e.properties,e._currentId)[0];if(r&&r.setValue(i.getSingleColor(i.defaultIndex+s)),r=n.getPalettes(e.properties,e._currentId)[1]){var l=t.secondaryColorIndex;l=l>=a?0:l,r.setValue(i.getSingleColor(i.defaultIndex+l))}}}),g}}})),define("dashboard-analytics/visualizations/recommender/SmartsRecommenderService",["../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e){"use strict";var t=e.extend({init:function(e){t.inherited("init",this,arguments),this.ajaxSvc=e.ajaxSvc,this.logger=e.logger},destroy:function(){this.ajaxSvc=null,this.logger=null},_executeRequest:function(e,t){var i={type:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e),processData:!1,url:t};return this.ajaxSvc.ajax(i).then((function(e){return Promise.resolve(e)}))}});return t})),define("dashboard-analytics/visualizations/recommender/SmartsRecommenderError",["../../widgets/livewidget/nls/StringResources"],(function(e){"use strict";var t=function(t){function i(e,n){var a;return(a=t.call(this,i.msg)||this).status=e,a.details=n,a}return _inheritsLoose(i,t),_createClass(i,null,[{key:"STATUS",get:function(){return{OK:0,NO_SMARTS_MODULE_SPECIFIED:1,SMARTS_MODULE_NOT_FOUND:2,SMARTS_MODULE_TIMEOUT:3,JSON_ERROR_IN_INPUT:4,UNKNOWN_CHART_TYPE:5,MISSING_REQUIRED_PARAMETERS:6,UNKNOWN_CHART_SPECIFIED:7,NO_UNBOUND_COLUMNS:8,INVALID_LEARNING_DIRECTIVE:9,INVALID_ACTION_TYPE:10,INVALID_ACTION_PAYLOAD:11,COLUMNS_NOT_FROM_SAME_OR_JOINED_DATASET:12,MISSING_ACTION:13,SMARTS_MODULE_NOT_READY:14,NO_COLUMNS:15,INVALID_BINDING:16,ERROR:100}}},{key:"msg",get:function(){return i._message||(i._message=e.get("recommendRequestFailed")),i._message}}]),i}(_wrapNativeSuper(Error));return t._message=null,t})),define("dashboard-analytics/visualizations/recommender/SmartsVisRecommenderService",["./SmartsRecommenderService","./SmartsRecommenderError"],(function(e,t){"use strict";var i=e.extend({init:function(e){i.inherited("init",this,arguments),this.ajaxSvc=e.ajaxSvc,this.logger=e.logger},getChartInfo:function(e){return this.logger.debug("getRecommendInfo"),this._executeRequest(e,"v1/smarts/visualization-recommender/chartInfo").catch(this._handleError.bind(this)).then((function(e){var i=e.data;if(i.smartsStatus!==t.STATUS.OK)throw new t(i.smartsStatus,i.details);var n=i;if(i.recommendations){var a=i.recommendations.filter((function(e){return!e.mandatorySlotsMissing}));n=a&&a.length?a[0]:i.recommendations[0]}return{title:n.title,label:n.label,description:n.description,mandatorySlotsMissing:n.mandatorySlotsMissing}}))},recommendAlternateVisualizationsOrBindings:function(e){return this.logger.debug("recommendAlternateVisualizationsOrBindings"),this._executeRequest(e,"v1/smarts/visualization-recommender/recommend").catch(this._handleError.bind(this)).then(this._processResponse.bind(this))},recommendRelatedVisualizations:function(e){var t="v1/smarts/insights/related-visualizations";return e.includeBestVisForTargetFields&&(t="v1/smarts/explore/related-visualizations"),this.logger.debug("recommendRelatedVisualizations"),this._executeRequest(e,t).catch(this._handleError.bind(this)).then(this._processResponse.bind(this))},recommendCompareVisualizations:function(e){return this.logger.debug("recommendCompareVisualizations"),this._executeRequest(e,"v1/smarts/content-recommender/comparison").catch(this._handleError.bind(this)).then(this._processCompareResponse.bind(this))},_processResponse:function(e){var i=e.data;if(i.smartsStatus===t.STATUS.OK)return i.recommendations;throw new t(i.smartsStatus,i.details)},_processCompareResponse:function(e){var i=e.data;if(i.status.code===t.STATUS.OK)return i.ircontent;throw new t(i.smartsStatus,i.details)},_handleError:function(e){var i=e.jqXHR.responseJSON;throw this.logger.debug(i),i?new t(i.smartsStatus,i.details):new t(e.jqXHR.fail().status,e.jqXHR.fail().responseText)}});return i})),define("dashboard-analytics/visualizations/recommender/SmartsToVizMapping",{Radar:{visId:"com.ibm.vis.rave2bundleradar",CATEGORY:"categories",CYCLICAL:"categories",VALUE:"values",COLOR:"series",NUMERIC_COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Area:{visId:"com.ibm.vis.rave2bundlearea",CATEGORY:"categories",VALUE:"values",COLOR:"series",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},StackedArea:{visId:"com.ibm.vis.rave2bundlearea",CATEGORY:"categories",VALUE:"values",COLOR:"series",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Bar:{visId:"com.ibm.vis.rave2bundlebar",CATEGORY:"categories",VALUE:"values",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical",TARGET_LINE:"target"},ClusteredBar:{visId:"com.ibm.vis.rave2bundlebar",CATEGORY:"categories",VALUE:"values",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical",TARGET_LINE:"target"},StackedBar:{visId:"com.ibm.vis.rave2bundlestackedbar",CATEGORY:"categories",VALUE:"values",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Bubble:{visId:"com.ibm.vis.ravebubble",X:"x",Y:"y",SIZE:"size",COLOR:"color",POINTS:"categories",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Column:{visId:"com.ibm.vis.rave2bundlecolumn",CATEGORY:"categories",VALUE:"values",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical",TARGET_LINE:"target"},ClusteredColumn:{visId:"com.ibm.vis.rave2bundlecolumn",CATEGORY:"categories",VALUE:"values",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical",TARGET_LINE:"target"},StackedColumn:{visId:"com.ibm.vis.rave2bundlestackedcolumn",CATEGORY:"categories",VALUE:"values",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Crosstab:{visId:"crosstab",VALUE:"values",COLUMN_HIERARCHY:"column_level1",ROW_HIERARCHY:"row_level1"},Heatmap:{visId:"com.ibm.vis.rave2heat",ROW:"categories",COLUMN:"series",COLOR:"color",SIZE:"size",POINTS:"points",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Line:{visId:"com.ibm.vis.rave2line",CATEGORY:"categories",VALUE:"values",COLOR:"series",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},ClusteredLine:{visId:"com.ibm.vis.rave2line",CATEGORY:"categories",VALUE:"values",COLOR:"series",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},DualAxis:{visId:"com.ibm.vis.rave2bundlecomposite",CATEGORY:"categories",Y1:"lineValue",Y2:"columnValue",COLUMN_COLOR:"columnColor",LINE_COLOR:"lineColor",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Tiledmap:{visId:"com.ibm.vis.rave2bundletiledmap",REGION_LOCATION:"locations",REGION_COLOR:"locationColor",REGION_LOCATION_EXTRUSION_HEIGHT:"locationHeight",POINT_LOCATION:"pointLocations",POINT_COLOR:"pointColor",POINT_SIZE:"pointSize",COORDINATE_LATITUDE:"latlongLocations.latitude",COORDINATE_LONGITUDE:"latlongLocations.longitude",COORDINATE_COLOR:"latlongColor",COORDINATE_SIZE:"latlongSize",COORDINATE_LABEL:"latlongLocations.caption"},PackedBubble:{visId:"com.ibm.vis.rave2bundlepackedbubble",CATEGORY:"categories",COLOR:"color",SIZE:"size",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},HierarchicalPackedBubble:{visId:"com.ibm.vis.rave2bundlehierarchicalpackedbubble",HIERARCHY:"categories",COLOR:"color",SIZE:"size",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Network:{visId:"com.ibm.vis.rave2network",TO:"series",FROM:"categories",LINK_WIDTH:"values",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Pie:{visId:"com.ibm.vis.rave2bundlepie",CATEGORY:"categories",VALUE:"values",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},HierarchicalPie:{visId:"com.ibm.vis.rave2bundlepie",HIERARCHY:"categories",VALUE:"values",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Point:{visId:"com.ibm.vis.rave2point",CATEGORY:"categories",VALUE:"values",COLOR:"series",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},ClusteredPoint:{visId:"com.ibm.vis.rave2point",CATEGORY:"categories",VALUE:"values",COLOR:"series",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Dial:{visId:"com.ibm.vis.rave2bundleradialbar",CATEGORY:"categories",VALUE:"values",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Scatter:{visId:"com.ibm.vis.ravescatter",X:"x",Y:"y",COLOR:"color",POINTS:"categories",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Singleton:{visId:"summary",VALUE:"actual"},KPI:{visId:"kpi",ACTUAL:"actual",PLANNED:"goal",CATEGORY:"sparkline.time"},List:{visId:"JQGrid",ANY:"grid_cols"},Treemap:{visId:"com.ibm.vis.rave2bundletreemap",HIERARCHY:"categories",CATEGORY:"categories",SIZE:"size",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Wordle:{visId:"com.ibm.vis.rave2bundlewordcloud",CATEGORY:"categories",SIZE:"size",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Spiral:{visId:"com.ibm.vis.spiral",TARGET:"values"},DriverAnalysis:{visId:"com.ibm.vis.rave2comet",TARGET:"values"},DecisionTree:{visId:"com.ibm.vis.decisiontree",TARGET:"values"},Sunburst:{visId:"com.ibm.vis.sunburst",TARGET:"values"},Bullet:{visId:"com.ibm.vis.rave2bundlebullet",PLANNED:"goal",ACTUAL:"actual",MINIMUM:"min",MIDDLE:"mid",MAXIMUM:"max",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Marimekko:{visId:"com.ibm.vis.rave2marimekko",BARS:"categories",LENGTH:"values",WIDTH:"width",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},Mentions:{visId:"com.ibm.vis.snippetlistbundle",POSTID:"postId",AUTHORNAME:"authorName",AUTHORNICKNAME:"authorNickname",AUTHORPROFILEURL:"authorProfileUrl",AUTHORURL:"authorProfileUrl",AUTHORAVATAR:"authorAvatar",SITETITLE:"siteTitle",TITLE:"title",DATE:"date",SOURCE:"source",URL:"url",CONVERSATIONSIZE:"conversationSize",MENTIONID:"mentionId",SNIPPET:"snippet",SENTIMENT:"sentiment"},ConversationCluster:{visId:"com.ibm.vis.convoclusterbundle",CLUSTER:"cluster",KEYWORD:"keyword",WEIGHT:"weight",BREAKDOWN:"breakdown",MENTIONS:"mentions"},Waterfall:{visId:"com.ibm.vis.rave2bundlewaterfall",CATEGORY:"categories",CUMULATIVE:"values",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"},BoxPlot:{visId:"com.ibm.vis.rave2bundleboxplot",CATEGORY:"key",VALUE:"values",BARS:"categories",COLOR:"color",MATRIX_COLUMN:"repeatHorizontal",MATRIX_ROW:"repeatVertical"}}),define("dashboard-analytics/visualizations/recommender/VisToSmartsMapping",["./SmartsToVizMapping"],(function(e){"use strict";var t={};return Object.keys(e).forEach((function(i){var n=e[i];t[n.visId]||(t[n.visId]={});var a=t[n.visId];Object.keys(e[i]).forEach((function(e){"visId"===e?a.chartType||(a.chartType=i):a[n[e]]||(a[n[e]]=e)}))})),t})),define("dashboard-analytics/visualizations/recommender/IRUtils",[],(function(){"use strict";var e={sum:"SUM"},t={pre:"PRE",post:"POST",PRE:"pre",POST:"post"};return function(){function i(){}return i.findDataItem=function(e,t){var i=-1,n=-1;for(var a in e.data.dataViews||[]){var o=e.data.dataViews[a].dataItems||[];for(var s in o)t(o[s],s)&&(i=a,n=s)}if(-1!==i&&-1!==n)return{viewIndex:i,viewItemIndex:n}},i.getColumnInfo=function(e,t,i){var n=e.find((function(e){return e.itemId===i})),a=!0;if(!n){a=!1;var o=t.getDataSource().getMetadataColumn(i);n={id:o.getId(),label:o.getLabel()}}return _extends({},n,{isProjected:a})},i.IRAggregateType=function(e){return{sum:"SUM",countdistinct:"COUNT_DISTINCT",count:"COUNT",avg:"AVERAGE",min:"MINIMUM",max:"MAXIMUM"}[e]},i.fromIRAggregateType=function(e){return{SUM:"sum",COUNT_DISTINCT:"countdistinct",COUNT:"count",AVERAGE:"avg",MINIMUM:"min",MAXIMUM:"max"}[e]},i.IRTopBottomType=function(e){return"topcount"===e||"toppercent"===e?"TOP":"BOTTOM"},i.IRTopBottomMethod=function(e){return"bottompercent"===e||"toppercent"===e?"PERCENTAGE":"COUNT"},i.IRToTopBottomType=function(e,t){return{BOTTOM:"bottom",TOP:"top"}[e]+{PERCENTAGE:"percent",COUNT:"count"}[t]},i.localFilters2IRFilters=function(i,n,a){i.forEach((function(i){var o={};if(o.filterId=i.id,o.columnId=i.columnId,!o.label&&a&&(o.label=a.getDataSource().getMetadataColumn(i.columnId).getLabel()),"in"===i.operator||"notin"===i.operator){var s=(i.values||[]).map((function(e){return{uniqueValue:e.u,displayValue:e.d}})),r=(i.excludedValues||[]).map((function(e){return{uniqueValue:e.u,displayValue:e.d}}));i.conditions&&(i.conditions.or||i.conditions.and)||i.conditions&&i.conditions.not||i.conditions||(o.type="INCLUSION_EXCLUSION",o.inclusionValues=s,o.exclusionValues=r,o.invertFlag="in"!==i.operator)}else"between"===i.operator||"notbetween"===i.operator?(o.lowValue={value:i.values[0].u,inclusive:!1},o.highValue={value:i.values[1].u,inclusive:!1},o.invertFlag="notbetween"===i.operator,o.type="NUMERICRANGE",o.filterAggregation={aggregationType:e[i.aggregationType],preOrPostAggregation:t[i.preOrPost]}):(o.type="GENERIC",o.expression="");o.type&&n.push(o)}))},i.topBottomToIRFilters=function(e,t){e.forEach((function(e){var n={};n.filterId=e.id,n.columnId=e.itemId,n.topBottomType=i.IRTopBottomType(e.selection.topBottom.type),n.method=i.IRTopBottomMethod(e.selection.topBottom.type),n.domainSize=e.selection.topBottom.value,e.selection.context&&(n.byColumn=e.selection.context[0].itemId),n.type="TOP_BOTTOM",t.push(n)}))},i.IRFilters2TopBottom=function(e,t,n,a,o){"RECOMMEND_FILTER"===a.reason?a.type="PART_TO_WHOLE":"INVERT_FILTER"===a.reason&&(a.type="INVERT_FILTER_TOP_BOTTOM");var s,r,l=i.findDataItem(t,(function(t){return t.id===e.filterId}));if(l){var c=t.data.dataViews[l.viewIndex].dataItems[l.viewItemIndex];s=c.itemLabel;var u=c.selection[0];u&&u.context&&u.context[0]&&u.context[0].aggregate&&(r=u.context[0].aggregate)}else{var d=(e.columnId||"").split(".");s=d[d.length-1]}var h={};h.id=e.filterId,h.itemId=e.columnId,h.itemLabel=s;var p=i.getColumnInfo(n,o,e.columnId);a.column=p;var g={operation:"keep",topBottom:{type:i.IRToTopBottomType(e.topBottomType,e.method),value:e.domainSize}};if(a.info=g.topBottom,e.byColumn){g.context=[{aggregate:r,itemId:e.byColumn}];var m=i.getColumnInfo(n,o,e.byColumn);a.byColumn=m}return h.selection=[g],h},i.IRFilters2LocalFilter=function(e,i,n,a,o){void 0===n&&(n=[]),void 0===a&&(a={}),"INVERT_FILTER"===a.reason&&(a.type="INVERT_FILTER_LOCAL");var s={};s.id=e.filterId,s.columnId=e.columnId;var r=n.find((function(t){return t.itemId===e.columnId}));if(r?a.column={id:e.columnId,label:r.label}:o&&(a.column={id:e.columnId,label:o.getDataSource().getMetadataColumn(e.columnId).getLabel()}),"NUMERICRANGE"===e.type){if(e.invertFlag?s.operator="notbetween":s.operator="between",s.values=[{d:e.lowValue.value,u:e.lowValue.value},{d:e.highValue.value,u:e.highValue.value}],e.filterAggregation)s.aggregationType=e.filterAggregation.aggregationType,s.preOrPost=t[e.filterAggregation.preOrPostAggregation];else if(i){var l=i.localFilters.find((function(t){return t.id===e.filterId}));s.aggregationType=l.aggregationType,s.preOrPost=l.preOrPost}}else"COMPOSITE"===e.type||("INCLUSION_EXCLUSION"!==e.type||e.filterCondition?"GENERIC"===e.type&&(s.columnId=e.columnId,s.id=e.filterId):(s.columnId=e.columnId,s.id=e.filterId,s.operator=e.invertFlag?"notin":"in",s.values=(e.inclusionValues||e.values||[]).map((function(e){return{u:e.uniqueValue,d:e.displayValue}}))));return s},i}()})),define("dashboard-analytics/visualizations/recommender/SmartsSupportedChartTypes",["bi/smarts-js/smarts.min"],(function(e){var t={};return function(){function i(){}return i.get=function(i,n){var a=JSON.stringify(n);if(!t[a]){var o=new e.SmartsService(i);t[a]=o.getSupportedChartTypes(n)}return t[a]},i}()})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/core/UniqueHashIdBuilder",["underscore"],(function(e){return function(){function t(){_classCallCheck(this,t)}return t.createUniqueHashId=function(t,i){if(i){for(var n=this._hashCode(t),a=0;i[n]||-1!==e.values(i).indexOf(n);)n=this._hashCode(n+a),a++;return n}},t._hashCode=function(e){var t=0,i=void 0;if(0===e.length)return t;for(i=0;i<e.length;i++)t=(t<<5)-t+e.charCodeAt(i),t|=0;return t=t<0?"_".concat(-t):t,"id".concat(t)},t}()})),define("dashboard-analytics/visualizations/recommender/SmartsCompareCardRecommenderHelper",["underscore","../../lib/@waca/core-client/js/core-client/ui/core/Class","./IRUtils","../../lib/@waca/dashboard-common/dist/core/UniqueHashIdBuilder","../../filters/FilterSpecHelper"],(function(e,t,i,n,a){"use strict";var o=0,s={fact:"ordinal",attribute:"category"},r=t.extend({init:function(e,t){this.columnIds=e,this.requestOptions=t,this.id="id_"+ ++o,r.inherited("init",this,arguments)},getRequestParameters:function(e){var t=this.columnIds,i=this.requestOptions,n=i.assetId,a=i.numResults,o=i.sourceType,s=i.module,r=this._getColumnsInfo(t).map((function(e){return e.id})).reduce((function(e,t){return e.concat(t)}),[]),l=e?s.copyPartialMoserModuleJSON(r):s.getTemporarySessionModuleJSON(),c=i.widgetSpec,u=i.visualization,d=this._toIRFilters(u,c),h={id:this.id,topicId:"",combinations:[{columnCombinations:this._getColumnCombinationsForIR(u),filters:d}]},p={sourceModuleId:n,sourceModule:JSON.stringify(l),sourceType:o,includedColumns:[],excludedColumns:[],shapedModule:!!s.getShapingId(),irContents:[h],maxCardsPerIR:a||10};return s.saveTemporaryModule().then((function(e){return n!==e&&(p.tempModuleId=e),p}))},_restoreHiddenCustomGroupCols:function(e,t){void 0===t&&(t=[]),0!==t.length&&Object.keys(e).forEach((function(i){e[i].forEach((function(e){(e.combinations||[]).forEach((function(e){(e.columnCombinations||[]).forEach((function(e,i){var n=t.find((function(e){return e.index===i}));n&&n.to===e.id&&(e.id=n.from)}))}))}))}))},_replaceHiddenCustomGroupCols:function(e,t){var i=this,n=t.visualization,a=t.moserDataSources,o=n.getDataSource().getId();a&&a.isConsumerGroupColumn&&e.forEach((function(t,n){var s=t.itemId;if(a.isConsumerGroupColumn(o,s)){var r=a.getCustomGroupData(o,s);if(r&&r.basedOnMoserObjectId){var l=e[n].itemId,c=r.basedOnMoserObjectId;e[n].itemId=c,i.requestOptions.hiddenCustomGroupColumnReplacements||(i.requestOptions.hiddenCustomGroupColumnReplacements=[]),i.requestOptions.hiddenCustomGroupColumnReplacements.push({index:n,from:l,to:c})}}}))},_getColumnCombinationsForIR:function(e){var t=this._getColumnCombinations(e);return this._replaceHiddenCustomGroupCols(t,{visualization:e,moserDataSources:this.requestOptions.moserDataSources}),t.map((function(e){var t={id:e.itemId};return e.aggregation&&(t.aggregation=e.aggregation),e.autoGrouping&&(t.autoGrouping=e.autoGrouping),t}))},_getColumnCombinations:function(e){var t=[];return e.getSlots().getMappedSlotList().forEach((function(e){e.getDataItemList(!0).forEach((function(e){var n,a=e.getAggregation(),o=e.getId(),r=e.getColumnId(),l=e.getMetadataColumn().getType(),c=e.getLabel(),u=s[e.getType()];"_multiMeasuresSeries"!==r&&(a&&"ordinal"===u?t.push({id:o,itemId:r,dataType:l,finalSlotType:u,label:c,aggregation:i.IRAggregateType(a)}):(e.getBinning()&&(n={size:e.getBinning().bins}),t.push({id:o,itemId:r,dataType:l,finalSlotType:u,label:c,autoGrouping:n})))}))})),t},transformCompareRecommendationResponse:function(e,t,i){var n=this.requestOptions;return this._fromIRContent(n,t,i)},_getColumnsInfo:function(e){return e.map((function(e){return{id:[e]}}))},_toIRFilters:function(e,t){var n=this._getFilters(e),a=this._getTopBottom(t),o=[];return i.localFilters2IRFilters(n,o,e),i.topBottomToIRFilters(a,o),o},_getFilters:function(e){var t=this,i=e.getLocalFilters().getFilterList();i||(i=[]);var n=[];return i.forEach((function(e){return t._collectLeafFilterEntries(e,n)})),JSON.parse(JSON.stringify(n))},_collectLeafFilterEntries:function(e,t){var i=this;a.isCompound(e)?e.values.forEach((function(e){e&&i._collectLeafFilterEntries(e,t)})):t.push(e)},_getTopBottom:function(e){var t=[];return(JSON.parse(JSON.stringify(e)).data.dataViews||[]).forEach((function(e){(e.dataItems||[]).forEach((function(e){(e.selection||[]).forEach((function(i){i&&i.topBottom&&t.push({id:e.id,itemId:e.itemId,selection:i})}))}))})),t},_fromIRContent:function(e,t,i){var n=this,a=e.visualization,o=[],s=this._getColumnCombinations(a);return this._restoreHiddenCustomGroupCols(i,e.hiddenCustomGroupColumnReplacements),i&&i[this.id]&&i[this.id].forEach((function(e){var i=n._processIRContent(e,t,s,e.details,a);o.push.apply(o,i)})),o},_processIRContent:function(e,t,n,a,o){var s=this,r=e.combinations,l=[],c={reason:a};return r.forEach((function(e){var a={local:[],topBottom:[]};(e.filters||[]).forEach((function(e){if("TOP_BOTTOM"===e.type){var s=i.IRFilters2TopBottom(e,t,n,c,o);s&&a.topBottom.push(s)}else{var r=i.IRFilters2LocalFilter(e,t,n,c,o);r&&a.local.push(r)}})),t.titleHtml=void 0,t.name=void 0;var r=s._transform2WidgetSpec(t,n,e.columnCombinations,a,c,o,{});r&&l.push({spec:r,details:c,score:e.score})})),l},_transform2WidgetSpec:function(e,t,i,n,a,o,s){var r=JSON.parse(JSON.stringify(e));return this._assimilateTopBottom(r,n.topBottom,t,s),this._assimilateFilters(r,n.local),this._assimilateComparableMeasures(r,i,t,a,o,s),r},_replaceSlotId:function(e,t,i){e.slotmapping.slots.forEach((function(n,a){var o=n.dataItems.indexOf(t);-1!==o&&(e.slotmapping.slots[a].dataItems[o]=i)}))},_assimilateTopBottom:function(e,t,i,n){var a=this;t.forEach((function(t){a._assimilateTopBottomItem(e,t,i,n)}))},_findMatchingColumnEntry:function(e,t){var i;if(t.some((function(t){if(t.id===e.id)return i=t,!0})),!i){1===t.length?i=t[0].itemId===e.itemId?t[0]:void 0:t.some((function(t){if(t.itemId===e.itemId&&function(e,t){return!t.selection[0].context||"ordinal"!==e.finalSlotType}(t,e))return i=t,!0}))}return i},_assimilateTopBottomItem:function(e,t,a,o){var s=this._findMatchingColumnEntry(t,a);if(s){var r=i.findDataItem(e,(function(e){return e.id===s.id}));if(r){var l=e.data.dataViews[r.viewIndex].dataItems[r.viewItemIndex],c=l.id,u=n.createUniqueHashId(l.itemId,o);o[u]=u,e.data.dataViews[r.viewIndex].dataItems[r.viewItemIndex]=_extends({},t,{id:u}),this._replaceSlotId(e,c,u)}}},_assimilateFilters:function(e,t){0===t.length&&void 0===e.localFilters||(e.localFilters=t)},_assimilateComparableMeasures:function(t,n,a,o,s,r){var l,c=n.map((function(e){return e.id})),u=a.map((function(e){return e.itemId})),d=e.difference(u,c)[0],h=e.difference(c,u)[0];!d&&h&&(d=u[0]),a.forEach((function(e){e.itemId!==d||"category"==e.finalSlotType||l||(l=e.id)})),l||a.forEach((function(e){e.itemId!==d||l||(l=e.id)})),"REPLACE_COMPARABLE_MEASURE"===o.reason&&(o.type="REPLACE_COMPARABLE_MEASURE",o.from=i.getColumnInfo(a,s,d),o.to=i.getColumnInfo(a,s,h)),this._assimilateComparableMeasure(t,d,h,l,r)},_assimilateComparableMeasure:function(e,t,a,o,s){var r=i.findDataItem(e,(function(e){return e.itemId===t&&e.id===o}));if(r){var l=e.data.dataViews[r.viewIndex].dataItems[r.viewItemIndex],c=l.id,u=n.createUniqueHashId(l.itemId,s);s[u]=u;var d=a.split("."),h=d[d.length-1];e.data.dataViews[r.viewIndex].dataItems[r.viewItemIndex]=_extends({},l,{itemId:a,itemLabel:h,id:u}),this._replaceSlotId(e,c,u)}}});return r})),define("dashboard-analytics/visualizations/recommender/BaseSmartsVisRecommenderWrapper",["../../lib/@waca/core-client/js/core-client/ui/core/Class","./SmartsVisRecommenderService","./SmartsToVizMapping","./VisToSmartsMapping","./IRUtils","./SmartsSupportedChartTypes","underscore","./SmartsCompareCardRecommenderHelper","../../apiHelpers/SlotAPIHelper"],(function(e,t,i,n,a,o,s,r,l){"use strict";var c=["com.ibm.vis.rave2network"],u=e.extend({init:function(e){var a=e.moserDataSources,o=e.ajaxSvc,s=e.logger,r=e.glassOptions,l=e.recommenderInternal,c=e.dataSources;u.inherited("init",this,arguments),this.moserDataSources=a,this._recommenderService=new t({ajaxSvc:o,logger:s}),this.dataSources=c,this._glassOptions=r,this._smartsToVisInfoMap=i,this._visToSmartsInfoMap=n,this._supportedVisIds=Object.keys(this._smartsToVisInfoMap),this._recommenderApi=l},destroy:function(){u.inherited("destroy",this,arguments),this._recommenderService&&(this._recommenderService.destroy(),this._recommenderService=null),this.dataSources=null,this._glassOptions=null,this._smartsToVisInfoMap=null,this._visToSmartsInfoMap=null,this._supportedVisIds=null,this._recommenderApi=null},recommendAlternateVisualizations:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t={}),this._getRequestParametersForRecommendVisualizations(e,t,!0).then(this._recommenderService.recommendAlternateVisualizationsOrBindings.bind(this._recommenderService)).then(this._transformRecommendationResponse.bind(this,t.module.getSourceId())).then(this._stripDuplicates.bind(this))},recommendRelatedVisualizations:function(e,t){return void 0===e&&(e=[]),void 0===t&&(t={}),this._getRequestParametersForRecommendVisualizations(e,t).then(this._recommenderService.recommendRelatedVisualizations.bind(this._recommenderService)).then(this._transformRecommendationResponse.bind(this,t.module.getSourceId()))},recommendCompareVisualizations:function(e,t){var i=this;void 0===e&&(e=[]);var n=new r(e,t);return n.getRequestParameters().then((function(e){return i._recommenderService.recommendCompareVisualizations(e).then(n.transformCompareRecommendationResponse.bind(n,t.module,t.widgetSpec))}))},_getIncludedCharts:function(){return o.get(this._glassOptions,this._recommenderApi.getChartTypeList())},_getRequestParametersForRecommendVisualizations:function(e,t,i){var n=this,a=t.visualization,o=t.moserDataSources;if(a&&o&&o.isConsumerGroupColumn){var s=a.getDataSource().getId();e.forEach((function(t,i){if(o.isConsumerGroupColumn(s,t)){var n=o.getCustomGroupData(s,t);n&&n.basedOnMoserObjectId&&(e[i]=n.basedOnMoserObjectId)}}))}var r={columns:this._getColumnsInfo(e)};return t.includeBestVisForTargetFields&&(r.includeBestVisForTargetFields=!0),this._getIncludedCharts().then((function(e){return e&&(r.includedCharts=e),n._addCommonRequestParameters(r,t,i)}))},recommendBindings:function(e){var t=this,i=e.visId,n=e.columnsToBind,a=e.requestOptions,o=e.boundColumnsInfo,s=e.originalVisId,r=[];if(n&&(r=r.concat(this._getColumnsInfo(n))),o){var l=this._visToSmartsInfoMap[s]||this._visToSmartsInfoMap[i];if(!l)return Promise.reject(new Error("Invalid originalVisId or visId"));r=r.concat(this._getColumnsInfoForBoundColumns(o,l))}var c={columns:r,chartType:this._visToSmartsInfoMap[i].chartType,allowBindingsWithWarnings:!0};return s&&this._visToSmartsInfoMap[s]&&(c.originalChartType=this._visToSmartsInfoMap[s].chartType),this._addCommonRequestParameters(c,a,!0).then((function(){return t._recommenderService.recommendAlternateVisualizationsOrBindings(c).then(t._transformBindingRecommendationResponse.bind(t,i,a.module))}))},getRecommendInfo:function(e){var t=this,i=e.columns,n=e.visId,a=e.requestOptions,o=this._visToSmartsInfoMap[n];if(!o)return Promise.reject(new Error(this.getUnsupportedVizErrCode()));i=this._sanitizeColumnInfo(i);var s={columns:this._getColumnsInfoForBoundColumns(i,o),chartType:this._visToSmartsInfoMap[n].chartType};return this._addCommonRequestParameters(s,a,!0).then((function(){return t._recommenderService.getChartInfo(s)}))},getSmartsToVizMappingsForVisId:function(e){return this._visToSmartsInfoMap[e]},isVisSlotKnownToSmarts:function(e,t){var i=this.getSmartsToVizMappingsForVisId(e),n=i&&s.keys(i);return!n||s.filter(n,(function(e){return e===t.getId()})).length>0},getUnsupportedVizErrCode:function(){return"ERR_CODE_UNSUPPORTED_VIS"},_isSupportedViz:function(e){return-1!==this._supportedVisIds.indexOf(e.chartType)},_addCommonRequestParameters:function(e,t,i){var n=t.assetId,a=t.numResults,o=t.sourceType,r=t.oneChartPerType,l=t.module,c=t.filters,u=e.columns.map((function(e){return e.id})).reduce((function(e,t){return e.concat(t)}),[]),d=i?l.copyPartialMoserModuleJSON(u):l.getTemporarySessionModuleJSON(),h={sourceModuleId:n,oneChartPerType:r||!0,numResults:a||10,sourceType:o,shapedModule:!!l.getShapingId()};return d&&(h.tempModule=JSON.stringify(d)),c&&(h.filters=c),l.saveTemporaryModule().then((function(t){return n!==t&&(h.tempModuleId=t),s.extend(e,h)}))},_transformRecommendationResponse:function(e,t){return t.filter(this._isSupportedViz.bind(this)).filter(this._isSupportedBinding.bind(this,e)).filter(this._hasSupportedFilter.bind(this)).map(this._transformRecommendation.bind(this))},_stripDuplicates:function(e){for(var t,i=[],n=new Map,a=_createForOfIteratorHelperLoose(e);!(t=a()).done;){var o=t.value;n.has(o.visId)||(n.set(o.visId,!0),i.push(o))}return i},_transformRecommendation:function(e){var t=e.chartType,i=e.label,n=e.description,a=e.title,o=e.columns,s=e.filters,r=e.autoGroupingMap,l=this._smartsToVisInfoMap[t];return{label:i,description:n,title:a,visId:l.visId,topBottom:this._transformTopBottomFromSmartsFilters(s),filters:this._transformFiltersFromSmartsFilters(s),autoGroup:this._transformAutoGroupFromSmartsAutoGroupingMap(r),slots:this._transformFromSmartsColumnInfo(o,l)}},_getColumnsInfo:function(e){return e.map((function(e){return{id:[e]}}))},_sanitizeColumnInfo:function(e){return e.map((function(e){return{slotId:e.slotId,columnIds:s.without(e.columnIds,l.MULTI_MEASURES_SERIES)}})).filter((function(e){return e.columnIds.length>0}))},_getColumnsInfoForBoundColumns:function(e,t){return e.map((function(e){return{slot:t[e.slotId],id:e.columnIds}}))},_transformAutoGroupFromSmartsAutoGroupingMap:function(e){return void 0===e&&(e={}),Object.keys(e).map((function(t){var i=e[t];return _extends({itemId:t},i)}))},_transformTopBottomFromSmartsFilters:function(e){return void 0===e&&(e=[]),e.filter((function(e){return"TOP_BOTTOM"===e.type})).map((function(e){return{itemId:e.columnId,spec:{type:a.IRToTopBottomType(e.topBottomType,e.method),value:e.domainSize,context:e.byColumn,aggregate:"sum"}}}))},_transformFiltersFromSmartsFilters:function(e){return void 0===e&&(e=[]),e.filter((function(e){return"TOP_BOTTOM"!==e.type})).map((function(e){return a.IRFilters2LocalFilter(e)}))},_transformFromSmartsColumnInfo:function(e,t){var i={};return e.forEach((function(e){var n=t[e.slot],a=i[n]||[];i[n]=a.concat(e.id)})),i},_getSmartsToVisMappingForUnsupportedVisualization:function(e){var t={},i=this._visToSmartsInfoMap[e];return Object.keys(i).forEach((function(n){"chartType"===n?t.visId=e:t[i[n]]=n})),t},_transformBindingRecommendationResponse:function(e,t,i){var n,a=this;return c.indexOf(e)>-1&&(n=this._getSmartsToVisMappingForUnsupportedVisualization(e)),i.map((function(t){var i=t.chartType,o=t.columns,s=t.unbound;return n=n||a._smartsToVisInfoMap[i],{visId:e||n.visId,slots:a._transformFromSmartsColumnInfo(o,n),unbound:s}}))},_isSupportedBinding:function(e,t){var i=t.chartType,n=t.columns;switch(i.toUpperCase()){case"SPIRAL":return this._isSupportedSpiral(e,n);default:return!0}},_hasSupportedFilter:function(e){if(e){var t=e.filters;if(t&&t.length>0){return!t.some((function(t){return"TOP_BOTTOM"===t.type&&(i=t.columnId,!(e.columns||[]).some((function(e){return-1!==e.id.indexOf(i)})));var i}))}}return!0},_isSupportedSpiral:function(e,t){var i=this.dataSources.getDataSource(e),n=t.some((function(e){var t=i.getMetadataColumn(e.id);return t&&t.isOlapColumn()})),a=this.moserDataSources.getModule(e);return!(n||a.isOlapPackage())}});return u})),define("dashboard-analytics/visualizations/renderer/common/EventTarget",[],(function(){var e="Must provide implementation";return function(){function t(e){void 0===e&&(e={}),this.$el=e.$el,this.visAPI=e.visAPI,this.visualization=e.visualization,this.content=e.content}var i=t.prototype;return i.canRestore=function(){return!1},i.restore=function(){},i.getTargetElement=function(){return this.$el},i.getValuesAtPoint=function(){throw new Error(e)},i.getEventTargets=function(){throw new Error(e)},i.getTargetsByCords=function(){throw new Error(e)},i.decorateTarget=function(){throw new Error(e)},i.getDecoration=function(){throw new Error(e)},i.completeDecorations=function(){throw new Error(e)},i.applyCustomDataSelection=function(){throw new Error(e)},i.getCustomDataSelections=function(){throw new Error(e)},i.canZoom=function(){throw new Error(e)},i.zoom=function(){throw new Error(e)},i.zoomStart=function(){throw new Error(e)},i.zoomEnd=function(){throw new Error(e)},i.pan=function(){throw new Error(e)},i.panStart=function(){throw new Error(e)},i.panEnd=function(){throw new Error(e)},i.processKeyDown=function(){throw new Error(e)},i.remove=function(){this.$el=null,this.visualization=null,this.visAPI=null,this.content=null},i.getAPI=function(){return{canRestore:this.canRestore.bind(this),restore:this.restore.bind(this),getTargetElement:this.getTargetElement.bind(this),getEventTargets:this.getEventTargets.bind(this),getTargetsByCords:this.getTargetsByCords.bind(this),getValuesAtPoint:this.getValuesAtPoint.bind(this),decorateTarget:this.decorateTarget.bind(this),completeDecorations:this.completeDecorations.bind(this),getDecoration:this.getDecoration.bind(this),applyCustomDataSelection:this.applyCustomDataSelection.bind(this),getCustomDataSelections:this.getCustomDataSelections.bind(this),canZoom:this.canZoom.bind(this),zoom:this.zoom.bind(this),zoomStart:this.zoomStart.bind(this),zoomEnd:this.zoomEnd.bind(this),pan:this.pan.bind(this),panStart:this.panStart.bind(this),panEnd:this.panEnd.bind(this),processKeyDown:this.processKeyDown.bind(this),remove:this.remove.bind(this)}},t}()})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/utils/EventChainLocal",["../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e){return e.extend({init:function(e){this.event=e},_getSourceEvent:function(){return this.event.gesture?this.event.gesture.srcEvent:this.event.originalEvent?this.event.originalEvent:this.event},_getPropertyMap:function(){var e=this._getSourceEvent();return e._eventChainLocalMap||(e._eventChainLocalMap={}),e._eventChainLocalMap},setProperty:function(e,t){this._getPropertyMap()[e]=t},getProperty:function(e){return this._getPropertyMap()[e]}})})),define("dashboard-analytics/visualizations/renderer/VisSelectionInfo",["underscore","../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t){"use strict";return t.extend({init:function(){this._aOrdinalSelections=[],this._aCategorySelections=[],this._slotToCategoryCount={}},getCategorySelections:function(){return this._aCategorySelections},getOrdinalSelections:function(){return this._aAdditionalOrdinalSelections?this._aOrdinalSelections.concat(this._aAdditionalOrdinalSelections):this._aOrdinalSelections},_createSelectionObject:function(e,t,i,n){return{slot:e,slotDataItem:t,value:i,isEdgeSelection:n||this._isEdgeSelection(e)}},addSelection:function(e,t,i,n){var a=t.getType();this._ordinalSelectionAdded(e,t,a)?"fact"===a&&(this._aAdditionalOrdinalSelections=this._aAdditionalOrdinalSelections||[],this._aAdditionalOrdinalSelections.push(this._createSelectionObject(e,t,i,n))):(this["fact"===a?"_aOrdinalSelections":"_aCategorySelections"].push(this._createSelectionObject(e,t,i,n)),this._registerCategoryCount(a,e,t))},_isEdgeSelection:function(e){return!(!e.getDefinition()||!e.getDefinition().treatOrdinalAsCategory)&&e.getDefinition().treatOrdinalAsCategory},_ordinalSelectionAdded:function(t,i,n){var a=!1;return"fact"===n&&(a=!!e.find(this._aOrdinalSelections,(function(e){return e.slot.getId()===t.getId()&&e.slotDataItem.getId()===i.getId()}))),a},_registerCategoryCount:function(e,t,i){if("fact"!==e){var n=this._slotToCategoryCount[t.getId()]||{count:0,dataItems:[]};-1===n.dataItems.indexOf(i.getId())&&(n.count+=1,n.dataItems.push(i.getId()),this._slotToCategoryCount[t.getId()]=n)}},getCategorySetSize:function(){var t=0,i=e.reduce(this._slotToCategoryCount,(function(e,t){return e+t.count}),0);return this._aCategorySelections.length&&(t=this._aCategorySelections.length/i),t}})})),define("dashboard-analytics/visualizations/renderer/VisTooltipInfo",["underscore","./VisSelectionInfo"],(function(e,t){"use strict";var i=t.extend({init:function(){i.inherited("init",this,arguments),this._aCustomSelections=[]},addCustomSelection:function(e,t){this._aCustomSelections.push({name:e,value:t})},getCustomLabelSelections:function(){return e.filter(this._aCustomSelections,(function(e){return"name"in e&&e.name}))},getCustomTitleSelections:function(){return e.filter(this._aCustomSelections,(function(e){return!("name"in e)||!e.name}))}});return i})),define("dashboard-analytics/visualizations/interactions/lassoSelect/LassoController",["../../../lib/@waca/core-client/js/core-client/ui/core/Events"],(function(e){var t=e.extend({init:function(e){t.inherited("init",this,arguments),this.targetElement=e.targetElement,this.cordinateResolver=e.cordinateResolver,this.isDragging=e.isDragging,this.dashboard=e.dashboard},_loadCss:function(e){var t=document.getElementsByTagName("head")[0];if(!t.querySelectorAll("[href='"+e+"']").length){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=e,i.media="all",t.appendChild(i)}},_initViews:function(){var e=this;this._views||(this._views={},(this.dashboard&&this.dashboard.getFeature("Lasso").getContributions()||[]).forEach((function(t){return e._views[t.id]=t})))},activateLassoMode:function(e,i){if(e||!1){this._initViews();var n=this._views[i]||this._views[t.DEFAULT_VIEW_ID],a=n.module,o=n.css;o&&this._loadCss(o),this.view=new a(this.targetElement,this.cordinateResolver,this.isDragging),this.view.on("all",this._handleViewEvent,this)}else this.isLassoMode()&&(this.view.off("all",this._handleViewEvent,this),this.view.remove(),this.view=null);return Promise.resolve()},isLassoMode:function(){return!!this.view},_handleViewEvent:function(e,t){this.trigger(t,e)},getCoordinates:function(){return this.view&&this.view.getCoordinates()},getCurrentViewId:function(){return this.view&&this.view.getId()},remove:function(){this.activateLassoMode(!1),t.inherited("remove",this,arguments),this.targetElement=null}});return t.DEFAULT_VIEW_ID="lw-lasso-select",t})),define("dashboard-analytics/features/content/visualizationGesture/api/VisualizationGestureAPI",[],(function(){return function(){function e(){}var t=e.prototype;return t.setLassoSelectState=function(){},t.getLassoSelectState=function(){},t.getLassoViewId=function(){},e}()})),define("dashboard-analytics/features/content/eventMapProvider/api/EventMapAPI",[],(function(){var e=function(){function e(){}var t=e.prototype;return t.registerEvents=function(){},t.getEventMapList=function(){},e}();return e.GESTURES={MOUSE_DOWN:"mousedown",MOUSE_UP:"mouseup",WHEEL:"wheel",PAN_START:"panstart",PAN_END:"panend",PAN_MOVE:"panmove",ZOOM_START:"zoomstart",ZOOM:"zoom",ZOOM_END:"zoomend",HOVER:"hover",HOVER_END:"hoverend",MENU:"menu",SELECT:"select",MULTI_SELECT:"multiselect",KEY_DOWN:"keydown",TAP:"tap"},e})),define("dashboard-analytics/visualizations/renderer/VisGestureInternalAPI",[],(function(){return function(){function e(){}var t=e.prototype;return t.onMouseLeave=function(){},t.onMouseDown=function(){},t.onMouseUp=function(){},t.onMouseWheel=function(){},t.onClickTapPanStart=function(){},t.onPanEnd=function(){},t.onPanMove=function(){},t.onPinchStart=function(){},t.onPinch=function(){},t.onPinchEnd=function(){},t.onHover=function(){},t.onClick=function(){},t.onHold=function(){},t.onKeyDown=function(){},e}()})),define("dashboard-analytics/visualizations/renderer/VisGestureHelperAPI",[],(function(){return function(){function e(){}var t=e.prototype;return t.resolveCoordinates=function(){},t.isSkipSelection=function(){},t.setEventLocalProperty=function(){},t.getTarget=function(){},t.isItemsSelected=function(){},t.isItemsHighlighed=function(){},t.handleHighlights=function(){},t.handleSelections=function(){},t.clearAll=function(){},t.getLassoController=function(){},t.getDataPayload=function(){},t.showSelectionInfo=function(){},t.titleOrElementStyleActions=function(){},t.resolveItems=function(){},e}()})),define("dashboard-analytics/visualizations/renderer/VisEventHandler",["jquery","underscore","../../lib/@waca/dashboard-common/dist/utils/EventChainLocal","../../apiHelpers/SlotAPIHelper","./VisSelectionInfo","./VisTooltipInfo","../../util/DashboardFormatter","../interactions/lassoSelect/LassoController","../../features/content/visualizationGesture/api/VisualizationGestureAPI","../../lib/@waca/dashboard-common/dist/core/APIFactory","../../features/content/eventMapProvider/api/EventMapAPI","./VisGestureInternalAPI","./VisGestureHelperAPI"],(function(e,t,i,n,a,o,s,r,l,c,u,d,h){"use strict";var p=function(){function p(e){this._init(e)}var g=p.prototype;return g._init=function(e){this._oTimerOut=null,this._lastSelected=null,this._lastHighlighted=null,this._lastImpliedSelection=[],this.dashboard=e.dashboard,this.logger=e.logger,this._target=e.target,this._targetElement=this._target.getTargetElement(),this._ownerWidget=e.ownerWidget,this.content=this._ownerWidget.content,this.state=this.content.getFeature("state"),this.visualization=this.content.getFeature("Visualization"),this._visAPI=e.visAPI,this._visController=this.content.getFeature("InteractivityController.deprecated"),this._selector=this.content.getFeature("DataPointSelections"),this._transaction=e.transaction,this.interactivitySettings=e.dashboardSettings&&e.dashboardSettings.get("interactivity")||{},this._visActionHelper=this._visController?this._visController.getActionHelper():null,this._visControlEvents=[],t.extend(this.interactivitySettings,this._visAPI.getInteractivitySettings()),this.serializeInteractivity=!!this.interactivitySettings.serialize,this._edgeSelection=!!e.edgeSelection,this.lassoCtrl=new r({targetElement:this._targetElement,cordinateResolver:this._resolveCoordinates,isDragging:this._isDragging.bind(this),dashboard:this.dashboard}),this._ownerWidget.contentFeatureLoader&&this._ownerWidget.contentFeatureLoader.registerFeature(this._ownerWidget.id,"VisualizationGesture",this),this._registerEvents()},g.getAPI=function(e){return"internal"===e?(this.internal||(this.internal=c.createAPI(this,[d,h])),this.internal):(this.api||(this.api=c.createAPI(this,[l])),this.api)},g.isReadyToInteract=function(){return!this.serializeInteractivity||this.state.getStatus()===this.state.STATUS.RENDERED},g.restoreState=function(){this._target.canRestore()&&this._target.restore(this._visAPI.getPropertyValue("interactivityState"))},g.remove=function(){var t=this;e(document).off("mouseup",this._onMouseUpHandler),e(document).off("touchend",this._onTouchEndHandler),this._targetElement&&this._visControlEvents.forEach((function(e){e.hammer?t._targetElement.hammer().off(e.key,e.callback):t._targetElement.off(e.key,null,e.callback)})),this._target&&(this._target.remove(),this._target=null),this._lastHoverEvent=null,this._tooltipItems=null,this._lastHighlighted=null,this.content=null,this.lassoCtrl&&(this._endLassoSelection(),this.lassoCtrl.remove(),this.lassoCtrl=null)},g._filterEvents=function(e){if(void 0===e&&(e=[]),this.interactivitySettings.isClickDisabled){var t=[u.GESTURES.MENU,u.GESTURES.SELECT,u.GESTURES.MULTI_SELECT],i=[u.GESTURES.KEY_DOWN];e=(e=e.filter((function(e){return!(-1!==t.indexOf(e.gesture))}))).filter((function(e){return!(-1!==i.indexOf(e.gesture))}))}if(this.interactivitySettings.isPanAndZoomDisabled){var n=[u.GESTURES.MOUSE_DOWN,u.GESTURES.MOUSE_UP,u.GESTURES.WHEEL,u.GESTURES.PAN_START,u.GESTURES.PAN_END,u.GESTURES.PAN_MOVE,u.GESTURES.ZOOM_START,u.GESTURES.ZOOM,u.GESTURES.ZOOM_END];e=e.filter((function(e){return!(-1!==n.indexOf(e.gesture))}))}if(this.interactivitySettings.isHoverDisabled){var a=[u.GESTURES.HOVER,u.GESTURES.HOVER_END];e=e.filter((function(e){return!(-1!==a.indexOf(e.gesture))}))}return e},g._registerEvents=function(){var t=this;this._visControlEvents=this._filterEvents(this.content.getFeature("EventMap").getEventMapList()),this._onMouseUpHandler=this._onDocumentMouseUp.bind(this),e(document).on("mouseup",this._onMouseUpHandler),this._onTouchEndHandler=this._onDocumentTouchEnd.bind(this),e(document).on("touchend",this._onTouchEndHandler),this._targetElement&&this._visControlEvents.forEach((function(e){e.hammer?t._targetElement.hammer&&t._targetElement.hammer(e.hammerOption).on(e.key,e.callback):e.data?t._targetElement.on(e.key,null,e.data,e.callback):t._targetElement.on(e.key,null,e.callback)}))},g.onHover=function(e){e.clientX||this._resolveCoordinates(e),this._isDragging(e)&&!this.lassoCtrl.isLassoMode()?(this._target.canZoom()&&this._target.pan&&this._target.pan(e),this._skipSelection=!0):(this._skipSelection=!this.isReadyToInteract(),this._skipHoverover=this._skipSelection);var t=this._target&&this._target.getEventTargets?this._target.getEventTargets(e):[];this._stopHoverover?this._targetElement&&(t&&t.length>0?this._targetElement.addClass("cursor-pointer"):this._targetElement.removeClass("cursor-pointer")):(this._mouseDown&&(this._clearHoverTimer(),this._visActionHelper.hideToolbarActions()),this._handleImpliedSelections(t,e.ctrlKey||e.metaKey,!1),this._handleHighlights(t),this._handleTooltips(e,t),this._triggerWidgetEvent("visevent:onmove",e,this._target,t,{mouseDown:this._mouseDown,onHold:this._onHold}))},g.onMouseLeave=function(e){e.clientX||this._resolveCoordinates(e);var t=this._target&&this._target.getEventTargets?this._target.getEventTargets(e):[];this._lastHoverEvent=e,this._tooltipItems=t,this._tooltipItems&&this._tooltipItems.length>0?this._clearHoverTimer():this._lastTooltip&&(this._lastTooltip=null,this._clearHoverTimer(),this._oTimerOut=setTimeout(this._handleMouseleaveTimeout.bind(this),500))},g._handleMouseleaveTimeout=function(){this._stopHoverover||this._visActionHelper.hideToolbarActions()},g.onClickTap=function(e){return e&&"tap"===e.type?this.onTap(e):this.onClick(e)},g.onClick=function(e){if(this._skipSelection)this.setEventLocalProperty(e,"preventDefaultContextBar",!0);else{var t=this._getOnClickData(e),i=t.shouldHandle,n=t.items,a=t.isMultiSelect;i&&n&&(n.length>0?(this._handleSelections(e,n,{isMultiSelect:a}),e.preventDefault(),this.setEventLocalProperty(e,"preventDefaultContextBar",!0)):(this._clearHoverTimer(),this._clearAll(e)))}},g.onKeyDown=function(e){if(this._target&&this._target.processKeyDown(e)){var t=this._target.getEventTargets(e);t&&t.length>0&&(this._handleSelections(e,t,{forceRightClick:!0}),e.preventDefault(),this.setEventLocalProperty(e,"preventDefaultContextBar",!0))}},g._getOnClickData=function(e){var t=this._target&&this._target.getEventTargets?this._target.getEventTargets(e):[],i=!("contextmenu"===e.type)&&this.lassoCtrl.isLassoMode();return{shouldHandle:!i,items:t,isMultiSelect:!i&&t&&t.length>1}},g.onTap=function(e){if(this._resolveCoordinates(e),this._skipSelection)this.setEventLocalProperty(e,"preventDefaultContextBar",!0);else{var t=this._target&&this._target.getEventTargets?this._target.getEventTargets(e):[];if(t)if(t.length>0){var i=this._isItemsSelected(t),n=this._isItemsHighlighed(t);this.setEventLocalProperty(e,"preventDefaultContextBar",!0),i||n?this._handleSelections(e,t,{forceCtrlClick:!0}):(this._handleHighlights(t),this._handleTooltips(e,t,!0))}else this._clearAll(e)}},g.onHold=function(e){this._resolveCoordinates(e);var t,i=!1;this._onHold=!0,this.lassoCtrl.isLassoMode()?(t=this._target&&this._target.getTargetsByCords?this._target.getTargetsByCords(this.lassoCtrl.getCoordinates(),!1):[],i=!0):t=this._target&&this._target.getEventTargets?this._target.getEventTargets(e):[],this._handleSelections(e,t,{forceRightClick:!0,isMultiSelect:i})},g._storeInteractivityState=function(e){this._ownerWidget.updateVisProperties({id:"interactivityState",value:e},{silent:!0})},g.onMouseWheel=function(e){if(this._target.canZoom()&&this._target.zoom){this._target.zoomStart(e),this._target.zoom(e);var t=this._target.zoomEnd(e);t&&this._storeInteractivityState(t),e.preventDefault()}},g.onPinchStart=function(e){this._target.canZoom()&&this._target.zoom&&(this._resolveCoordinates(e),this._target.panEnd(e),this._target.zoomStart(e))},g.onPinch=function(e){this._target.canZoom()&&this._target.zoom&&(this._resolveCoordinates(e),this._target.zoom(e),(e.gesture||e.originalEvent||e).preventDefault())},g.onPinchEnd=function(e){if(this._target.canZoom()&&this._target.zoom){this._resolveCoordinates(e);var t=this._target.zoomEnd(e);t&&this._storeInteractivityState(t)}},g.onClickTapPanStart=function(e){return"touchstart"===e.type?this.onPanStart(e):this.onClickTap(e)},g.onPanStart=function(e){this._canPan(e)&&(this._resolveCoordinates(e),this._target.panStart(e))},g.onPanEnd=function(e){this._resolveCoordinates(e);var t=this._target.panEnd(e);t&&this._storeInteractivityState(t)},g.onPanMove=function(e){var t=e.gesture||e.originalEvent||e,i=t.touches&&2===e.originalEvent.touches.length;this._canPan(e)?(this._resolveCoordinates(e),this._target.pan(e),t.preventDefault()):i&&t.preventDefault()},g.onMouseDown=function(e){var t=this._getOnClickData(e),i=t.shouldHandle,n=t.items;i&&n&&n.length>0&&this.setEventLocalProperty(e,"preventWidgetDeselect",!0),this._skipSelection=!1,this._mouseDown={X:e.pageX,Y:e.pageY},!this.lassoCtrl.isLassoMode()&&this._target.canZoom&&this._target.canZoom()&&this._target.panStart&&this._target.panStart(e)},g.onMouseUp=function(e){if(this._target.canZoom&&this._target.canZoom()&&this._target.panEnd){var t=this._target.panEnd(e);t&&this._storeInteractivityState(t)}},g.getEdgeSelection=function(){return this._edgeSelection},g._onDocumentMouseUp=function(){this._mouseDown=!1},g._onDocumentTouchEnd=function(){this._onHold&&(this._onHold=!1)},g._canPan=function(e){return this._target.canZoom&&this._target.canZoom()&&1===e.originalEvent.touches.length&&!this.lassoCtrl.isLassoMode()},g.resolveCoordinates=function(e){return this._resolveCoordinates(e)},g.isSkipSelection=function(){return this._skipSelection},g.getTarget=function(){return this._target},g.isItemsSelected=function(e){return this._isItemsSelected(e)},g.handleHighlights=function(e,t){this._handleHighlights(e,t)},g.isItemsHighlighed=function(e){return this._isItemsHighlighed(e)},g.handleSelections=function(e,t,i){this._handleSelections(e,t,i)},g.clearAll=function(e){this._clearAll(e)},g.getLassoController=function(){return this.lassoCtrl},g.getDataPayload=function(e,t){return this._getDataPayload(e,t)},g.resolveItems=function(e){return this._resolveItems(e)},g.showSelectionInfo=function(e,t,i,n,a,o,s){return this._showSelectionInfo(e,t,i,n,a,o,s)},g.titleOrElementStyleActions=function(e,t){this._titleOrElementStyleActions(e,t)},g.setEventLocalProperty=function(e,t,n){new i(e).setProperty(t,n)},g._resolveCoordinates=function(e){var t=null;if(e.targetTouches?t=e.targetTouches:e.changedTouches?t=e.changedTouches:e.originalEvent&&e.originalEvent.targetTouches?t=e.originalEvent.targetTouches:e.gesture&&(t=e.gesture.touches),t&&t.length){var i=t&&t.length?t[0]:null;i&&void 0!==i.clientX&&(e.isTouch=!0,e.clientX=i.clientX,e.clientY=i.clientY,e.pageX=i.pageX,e.pageY=i.pageY)}else e.gesture&&e.gesture.center?(e.clientX=e.clientX||e.gesture.center.clientX,e.clientY=e.clientY||e.gesture.center.clientY,e.pageX=e.pageX||e.gesture.center.pageX,e.pageY=e.pageY||e.gesture.center.pageY):e.originalEvent&&(e.clientX=e.clientX||e.originalEvent.clientX||e.originalEvent.pageX,e.clientY=e.clientY||e.originalEvent.clientY||e.originalEvent.pageY,e.pageX=e.pageX||e.originalEvent.pageX,e.pageY=e.pageY||e.originalEvent.pageY)},g._getBoundsInfoFromEvent=function(e){return{top:e.clientY,height:1,left:e.clientX-10,width:20,parent:document.body}},g._isDragging=function(e){return"touchmove"===e.type&&this.lassoCtrl.isLassoMode()?1===e.originalEvent.touches.length:this._mouseDown&&(Math.abs(this._mouseDown.X-e.pageX)>5||Math.abs(this._mouseDown.Y-e.pageY)>5)},g._clearHoverTimer=function(){null!==this._oTimerOut&&(clearTimeout(this._oTimerOut),this._oTimerOut=null)},g._clearLastHighlight=function(){this._lastHighlighted&&this._clearDecorations(this._lastHighlighted,"highlight"),this._lastHighlighted=void 0,this._skipHoverover=!1},g._clearDecorations=function(e,t){this._target&&this._target.decorateTarget&&this._target.decorateTarget(e,t,!1)},g._compareItems=function(e,i){var n=t.pluck(e,"key"),a=t.pluck(i,"key");return 0===t.difference(n,a).length&&0===t.difference(a,n).length},g._isItemsHighlighed=function(e){return this._compareItems(this._lastHighlighted,e)},g._isItemsImpliedSelected=function(e){return t.find(this._lastImpliedSelection,(function(t){return t===e}))},g._handleTooltips=function(e,t,i){var n=this,a=this._lastTooltip?this._lastTooltip:[];this._lastHoverEvent=e,this._tooltipItems=t,this._tooltipItems&&this._tooltipItems.length>0?(this._targetElement.addClass("cursor-pointer"),this._compareItems(a,this._tooltipItems)||(this._clearHoverTimer(),this._oTimerOut=setTimeout((function(){n._clearHoverTimer();var e=n._tooltipItems&&n._tooltipItems.length>0,t=!n._stopHoverover&&!n._skipHoverover;if(e&&(t||i)){var a=n._getDataPayload(n._tooltipItems,o);if(a)n._showSelectionInfo(a,n._lastHoverEvent,!1,!0,n._drillOnly,!1,{isHover:!0})&&(n._lastTooltip=n._tooltipItems),n._lastHoverEvent=null,n._tooltipItems=null}}),500))):(this._targetElement.removeClass("cursor-pointer"),this._lastTooltip&&(this._lastTooltip=null,this._clearHoverTimer(),this._oTimerOut=setTimeout((function(){n._clearHoverTimer(),n._stopHoverover||n._visActionHelper.hideToolbarActions()}),500)))},g._handleHighlights=function(e,i){var n=this._lastHighlighted?this._lastHighlighted:[];if(i){var a=t.filter(this._lastHighlighted,(function(e){return e.source&&e.source.getDecoration&&!e.source.getDecoration("selected")}));e.push.apply(e,a)}e&&e.length>0?this._isItemsHighlighed(e)||this._target&&this._target.decorateTarget&&(this._clearLastHighlight(),this._target.decorateTarget(e,"highlight")&&(this._lastHighlighted=e)):n.length>0&&this._clearLastHighlight(),!this._compareItems(n,this._lastHighlighted)&&this._target.completeDecorations&&this._target.completeDecorations()},g._handleSelections=function(e,t,i){var n=i.forceCtrlClick||e.ctrlKey||e.metaKey,a=i.forceRightClick||"contextmenu"===e.type;this._skipHoverover=!1;var s=null;if(a){this._skipHoverover=!0;var r=this._getDataPayload(t,o);if((s=this._resolveItems(t)).length>0){var l,c,u,d=t[0].selectionContext?{slots:t[0].selectionContext.slots,mapIndex:t[0].selectionContext.mapIndex,actions:t[0].selectionContext.actions}:{};return d.area=t[0].area,d.isAreaSelected=t[0].isAreaSelected,d.bRightClick=a,d.items=t,t[0].onlyGlobalActions?(l=!1,c=!0,u=!0):(l=a,c=!1,u=!1),this._showSelectionInfo(r,e,l,c,void 0,u,d),this._triggerWidgetEvent("visevent:select",e,this._target,t,{selectionInfo:r,append:n,lasso:i.isMultiSelect}),this._handleHighlights(t,n),this._select(s,!0,n,!0,t[0].isEdgeSelect,i.isMultiSelect)}this._titleOrElementStyleActions(e,t)}else{if(s=this._resolveItems(t),this._handleHighlights(t),s.length>0){var h=this._isSelected(s,t[0].isEdgeSelect),p=!h,g=n||this.lassoCtrl.isLassoMode()&&h,m=this._getDataPayload(t);return this._triggerWidgetEvent("visevent:select",e,this._target,t,{selectionInfo:m,append:g,lasso:i.isMultiSelect}),this._select(s,p,g,!1,t[0].isEdgeSelect,i.isMultiSelect)}if(t&&t.length>=1)switch(t[0].type){case"customdata":return this._handleCustomDataSelections(t,e);case"itemclass":case"summary":return this._handleImpliedSelections(t,n,!0)}}},g._isSelectionsWithCustomData=function(e){var i=t.filter(e,(function(e){return"customdata"!==e.type}));return e.length>0&&(!i||0===i.length)},g._handleImpliedSelections=function(e,t,i){var n=this._lastImpliedSelection?this._lastImpliedSelection:[];i&&e&&e.length>0?this._isItemsImpliedSelected(e)||(this._lastImpliedSelection.push(e),this._target.decorateTarget(e,"implied_selection",i,t)):n.length>0&&!t&&(this._lastImpliedSelection=[],this._clearDecorations(e,"implied_selection"))},g._handleCustomDataSelections=function(e,i){if(this._triggerWidgetEvent("visevent:customdataselection",i,this._target,e),this._target&&this._target.applyCustomDataSelection){var n=t.pluck(this._visAPI.getDecoratedCustomData("selected"),"id");this._target.applyCustomDataSelection(t.filter(e,(function(e){return!t.contains(n,e.key)})))}},g._resolveItems=function(e){var i=this,n=[];return t.each(e,(function(e){"datapoint"===e.type?n=n.concat(i._resolveDataPointItem(e)):"item"===e.type&&(n=n.concat(i._resolveEdgeItem(e)))})),n},g._processDataPointSelection=function(e,i){var a=this,o=this._getMappedSlotListByItem(i);t.each(i.values,(function(r,l){var c=i.slotAPIs?i.slotAPIs[l]:o[l];if(c){var u=0;t.each(r,(function(t,o){null===t&&(t=s.format(null));var r=a._getSlotDataItem(c,i,o+u);t.span&&(u+=t.span-1),!r||"object"==typeof t&&n.isMultiMeasuresSeriesOrValueDataItem(r)||e.addSelection(c,r,t,i.isEdgeSelect)}))}}))},g._resolveDataPointItem=function(e){var i=this._getMappedSlotListByItem(e),a=[];return t.each(e.values,(function(o,s){var r=e.slotAPIs?e.slotAPIs[s]:i[s];if(r){var l=r.getDataItemList();t.each(o,(function(e,t){var i=l[t];i&&"attribute"===i.getType()&&!n.isMultiMeasuresSeriesOrValueDataItem(i)&&a.push({dataItemId:i.getId(),itemId:i.getColumnId(),tupleItem:e})}))}})),[a]},g._resolveEdgeItem=function(e){var i=this._getMappedSlotListByItem(e),a=[];return t.each(e.values,(function(e,o){var s=i[o];if(s){var r=s.getDataItemList();t.each(e,(function(e,t){var i=r[t];n.isMultiMeasuresSeriesOrValueDataItem(i)||"attribute"!==i.getType()||"N/A"===e||a.push({dataItemId:i.getId(),itemId:i.getColumnId(),tupleItem:e})}))}})),a},g._processEdgeSelection=function(e,i){var a=this,o=this._getMappedSlotListByItem(i);i.values&&t.each(i.values,(function(s,r,l){if(s)for(var c=function(){if(void 0!==s[u]){var c,d=o[r];if(d.getDefinition().getProperty("multiMeasure")&&d.getDataItemList().length>0){var h=d.getDefinition().getDatasetIdList()[0],p=t.find(o,(function(e){return n.isMultiMeasuresSeriesSlot(e)&&e.getDefinition().getDatasetIdList()[0]===h}));p||(p=n.getMultiMeasureSeriesSlot(a.visualization,h));var g=t.indexOf(t.map(o,(function(e){return e.getId()})),p.getId()),m=t.indexOf(t.map(p.getDataItemList(),(function(e){return e.getColumnId()})),n.MULTI_MEASURES_SERIES);if(g>=0&&m>=0&&l[g]&&l[g][m]&&l[g][m].u){var f=l[g][m].u;c=t.find(d.getDataItemList(),(function(e){return e.getId()===f}))}}void 0===c&&(c=d.getDataItemList()[u]),c&&e.addSelection(d,c,s[u],i.isEdgeSelect)}},u=0;u<s.length;u++)c()}))},g._processCustomDataSelection=function(e,i){if(this._target&&this._target.getCustomDataSelections&&e.addCustomSelection){var n=this._target.getCustomDataSelections(i);t.each(n,(function(t){return e.addCustomSelection("object"==typeof t?t.label:t,"object"==typeof t?t.value:void 0)}))}},g._processDecorationTooltips=function(e,t){try{if(t&&1===t.length&&this._target&&this._target.getDecoration&&e.addCustomSelection){var i=this._target.getDecoration(t[0],p.DECORATIONS.TOOLTIP);i&&"string"==typeof i?e.addCustomSelection(i):i&&Array.isArray(i)&&i.forEach((function(t){Array.isArray(t)&&2===t.length&&e.addCustomSelection(t[0],t[1])}))}}catch(e){this.logger.error(e)}},g._getSlotDataItem=function(e,i,a){var o=e.getDataItemList();if(n.isMultiMeasuresValueSlot(e)){var s,r,l=this._getMappedSlotListByItem(i);if(t.find(l,(function(e,t){return!!n.isMultiMeasuresSeriesSlot(e)&&(s=t,!0)})),s){t.find(l[s].getDataItemList(),(function(e,t){return!!n.isMultiMeasuresSeriesOrValueDataItem(e)&&(r=t,!0)}));var c=i.values[s][r].u;return t.find(e.getDataItemList(),(function(e){return e.getId()===c}))}return e.getDataItemList()[a]}return o[a]},g._isSelected=function(e,t){var i=this._getSelectionPayload(e,!1,t);return this._selector.isSelected(i,this._edgeSelection||t)},g._isCustomDataItems=function(e){return t.chain(e).pluck("type").contains("customdata").value()},g._isCustomDataSelected=function(e){var i=t.pluck(this._visAPI.getDecoratedCustomData("selected"),"id");if(i.length>0){var n=t.chain(e).pluck("values").flatten().pluck("payload").pluck("id").value();if(n.length>0)return t.intersection(i,n).length===n.length}return!1},g._isItemsSelected=function(e){var t=!1;if(this._isCustomDataItems(e))t=this._isCustomDataSelected(e);else{var i=this._resolveItems(e);t=i.length>0&&this._isSelected(i,e[0].isEdgeSelect)}return t},g._select=function(e,t,i,n,a,o){var s=this._transaction.startTransaction(),r=n?this.content.getFeature("DataPointSelections.pending"):this.content.getFeature("DataPointSelections"),l=this._getSelectionPayload(e,o,a),c=!i||this.interactivitySettings.isMultiSelectDisabled;c&&r.clearAll(s),t?r.select(l,s):c||r.deselect(l,s),this._transaction.endTransaction(s)},g._getSelectionPayload=function(e,i,n){return void 0===n&&(n=!1),i?n?t.map(t.flatten(e),(function(e){return{categories:[{dataItemId:e.dataItemId,columnId:e.itemId,label:e.tupleItem&&e.tupleItem.d,parentId:e.tupleItem&&e.tupleItem.p&&e.tupleItem.p.u,value:e.tupleItem&&e.tupleItem.u}],edgeSelect:n}})):t.map(e,(function(e){return{categories:t.map(e,(function(e){return{dataItemId:e.dataItemId,columnId:e.itemId,label:e.tupleItem&&e.tupleItem.d,parentId:e.tupleItem&&e.tupleItem.p&&e.tupleItem.p.u,value:e.tupleItem&&e.tupleItem.u}})),edgeSelect:n}})):[{categories:t.chain(e).flatten().map((function(e){return{dataItemId:e.dataItemId,columnId:e.itemId,label:e.tupleItem&&e.tupleItem.d,parentId:e.tupleItem&&e.tupleItem.p&&e.tupleItem.p.u,value:e.tupleItem&&e.tupleItem.u}})).value(),edgeSelect:n}]},g.reduceItems=function(e){var i={itemIds:[],tuple:[]};return e.reduce((function(e,i){var n,a;return Array.isArray(i)?(n=t.map(i,(function(e){return e.itemId})),a=t.map(i,(function(e){return t.isUndefined(e.tupleItem&&e.tupleItem.u)?{u:e.tupleItem,d:e.tupleItem}:e.tupleItem}))):(n=[i.itemId],a=i.tupleItem),e.itemIds=t.uniq(e.itemIds.concat(n)),e.tuple.push(Array.isArray(a)?t.uniq(a,!1,(function(e){return e&&e.u||e})):a),e}),i),i},g._titleOrElementStyleActions=function(e,t){var i=this,n=[],a=t&&t[0]?t[0].area:void 0,o=[],s=null;if(t&&t.length){for(var r=function(){var e=t[l];if("customdata"!==e.type&&"visualitem"!==e.type){var a=i.visualization.getSlots().getMappedSlotList();e.values.forEach((function(e,t){n.find((function(e){return e.getId()===a[t].getId()}))||(n.push(a[t]),s=e&&e.length>0&&e[0]&&e[0].d)}))}else e.values.find((function(e){return"visualItem"===e.customType}))&&o.push(e)},l=0;l<t.length;l++)r();s&&o.length>0&&o.push({key:s,type:"elementTitle"});var c=t[0].selectionContext?t[0].selectionContext.mapIndex:void 0,u=t[0].selectionContext&&t[0].selectionContext.actions||[];this.setEventLocalProperty(e,"preventDefaultContextBar",!0),this._visActionHelper.showTitleOrElementStyleActions(n,{bounds:this._getBoundsInfoFromEvent(e)},null,c,a,u,o)}},g._clearAll=function(e){return this._triggerWidgetEvent("visevent:clearselection",e),this.content.getFeature("DataPointSelections").clearAll(),this.content.getFeature("DataPointSelections.pending").clearAll(),this.clearCustomDataSelection()},g.clearCustomDataSelection=function(e){this._target.applyCustomDataSelection([],e)},g._getDataPayload=function(e,i){var n=this,o=new(i||a);return t.each(e,(function(e,t){switch(e.type){case"datapoint":return n._processDataPointSelection(o,e);case"item":return n._processEdgeSelection(o,e,t);case"customdata":return n._processCustomDataSelection(o,e);default:return}})),this._processDecorationTooltips(o,e),o},g._showSelectionInfo=function(e,t,i,n,a,o,s){var r=!1;return e&&e.getCategorySelections()&&(this._visActionHelper.showDataPointActions(e,{bounds:this._getBoundsInfoFromEvent(t),targetNode:t.currentTarget},i,n,a,o,s),r=!0,this.setEventLocalProperty(t,"preventDefaultContextBar",!0)),r},g.setLassoSelectState=function(e,t){return void 0===t&&(t=r.DEFAULT_VIEW_ID),this.lassoCtrl.getCurrentViewId()&&this.lassoCtrl.getCurrentViewId()!==t&&(this._endLassoSelection(),e=!0),this.toggleLassoSelect(e,t)},g.toggleLassoSelect=function(e,t){var i=0===arguments.length?!this.lassoCtrl.isLassoMode():!!e;return this.lassoCtrl.isLassoMode()!==i&&(i?(this.lassoCtrl.activateLassoMode(!0,t),this.lassoCtrl.on("lassoSelect:done",this._handleLassoSelection,this),this.lassoCtrl.on("lassoSelect:cordsChange",this._handleLassoCordChange,this),this.lassoCtrl.on("lassoSelect:cancel",this._endLassoSelection,this)):this._endLassoSelection()),i},g.getLassoViewId=function(){return this.lassoCtrl.getCurrentViewId()},g._getLassoItems=function(e){return t.isUndefined(e.radius)?this._target&&this._target.getTargetsByCords?this._target.getTargetsByCords(e.cords,!1):[]:this._target&&this._target.getEventTargets?this._target.getEventTargets(e.event,e.radius):[]},g._handleLassoSelection=function(e){try{var t=this._getLassoItems(e);if(t){var i={isMultiSelect:!0};"touchend"===e.event.type&&(i.forceCtrlClick=!0),this._handleHighlights(t),this._handleSelections(e.event,t,i)}}catch(e){this.logger.error(e)}},g._handleLassoCordChange=function(e){try{var t=this._getLassoItems(e);t&&this._handleHighlights(t)}catch(e){this.logger.error(e)}},g._endLassoSelection=function(){this.lassoCtrl.off("lassoSelect:done",this._handleLassoSelection,this),this.lassoCtrl.off("lassoSelect:cordsChange",this._handleLassoCordChange,this),this.lassoCtrl.off("lassoSelect:cancel",this._endLassoSelection,this),this.lassoCtrl.activateLassoMode(!1)},g.isLassoSelectActive=function(){return this.lassoCtrl.isLassoMode()},g.getLassoSelectState=function(){return this.isLassoSelectActive()},g._triggerWidgetEvent=function(e,i,n,a,o){var s={sender:this._widgetApi,event:i,target:n,items:a};t.each(o,(function(e,t){s[t]=e})),this._ownerWidget.trigger(e,s)},g.setPopoverClosed=function(e){this._isHoverFlyoutShowing=!1,e&&e.isHover||(this._stopHoverover=!1)},g.setPopoverOpened=function(e){e&&e.isHover||(this._stopHoverover=!0,e&&e.isWidgetOdt&&(this._stopHoverover=!1))},g._getMappedSlotListByItem=function(e){return e&&e.datasetId?n.getMappedSlotListByDataset(this.visualization,e.datasetId):this.visualization.getSlots().getMappedSlotList()},p}();return p.DECORATIONS={HIGHLIGHT:"highlight",SELECT:"select",TOOLTIP:"tooltip"},p})),define("dashboard-analytics/visualizations/renderer/vipr3/VIPRDataPointSummarizer",["underscore","../../../apiHelpers/SlotAPIHelper"],(function(e,t){return function(){function i(e){this.slots=e&&e.getSlots()}var n=i.prototype;return n.summarizeDataPointValues=function(e,t,i){var n=this,a=this._buildHeaderLine(i,t);if(!e||!e.length||!this.slots)return a;var o={},s=i.dataset;if(s){for(var r=this.slots.getMappedSlotList().filter((function(e){return-1!==e.getDefinition().getDatasetIdList().indexOf(s.id)})),l=this._getMultiMeasureAssignment(r,i),c=function(t){var i=s.getDataItem(t);if("cont"===i.getType()){var a=i.indexes&&i.indexes.dataitem;null==a&&(a=t);var c=r[a],u=c.getDataItemList();c.getDataItemList().forEach((function(e){var t=e.getColumnId(),i=c.getId()+":"+t;o[i]||(o[i]={measureValues:[],aggregationType:e.getAggregation()||"sum"})})),e.forEach((function(e){var i=n._getMeasureIdFromDataPoint(e,u,l,c,t-a);if(i){var s=e.getValue(t);o[i].measureValues.push(s.getValue()),o[i].indexInResult=a}}))}},u=0;u<s.getDataItemCount();u++)c(u);a=this._summarizeValuesInPointsMap(a,o)}return a},n._getMultiMeasureAssignment=function(i,n){var a,o,s,r=e.find(i,(function(i,n){a=n;var r=i.getDataItemList()||[];return t.isMultiMeasuresValueSlot(i)&&(s=r.length),e.find(r,(function(e,t){return o=t,"_multiMeasuresSeries"===e.getColumnId()}))})),l=r&&n&&n.dataset&&n.dataset.dataItems[a].tuples;return r?{slotIndex:a,indexInSlot:o,tuplesInSlot:l,multiMeasureItemCount:s}:null},n._getMeasureIdFromDataPoint=function(i,n,a,o,s){var r=null;if(n.length>1&&a&&t.isMultiMeasuresValueSlot(o)){var l=i.getTupleIndex(a.slotIndex),c=a.tuplesInSlot[l].tuple[a.indexInSlot].u,u=e.find(n,(function(e){return c===e.getId()}));r=u&&u.getColumnId()}else(!a||a&&i.index%a.multiMeasureItemCount==0)&&(r=n[s].getColumnId());return r&&o.getId()+":"+r},n._summarizeValuesInPointsMap=function(e,t){for(var i in t){var n=t[i].measureValues,a=t[i].aggregationType,o=t[i].indexInResult;e[o]=e[o]||[];var s=void 0;if(n.length>1&&("avg"===a||"countdistinct"===a||"calculated"===a))s="N/A";else{s=n[0];for(var r=1;r<n.length;r++)s+=n[r]||0}e[o].push(s)}return e},n._buildHeaderLine=function(e,t){var i=[];if(void 0!==t&&void 0!==e){if(e.tuple)i[t]=e.tuple;else{var n=[];n.push({u:e.getUniqueName(),d:e.getCaption()}),i[t]=n}e.getParent&&e.getParent()&&(i[t][0].p=e.getParent())}return i},n.summarizeDataPointTargets=function(t){var i,n=-1;return e.each(t,(function(t){i?(n<0&&e.each(t.values,(function(t,a){"number"==typeof t[0]?n=a:!1===e.isEqual(e.pluck(i.values[a],"u"),e.pluck(t,"u"))&&(i.values[a]=void 0)})),e.each(i.values[n],(function(e,a){t.values[n]&&t.values[n][a]&&(i.values[n][a]+=t.values[n][a])}))):(i=_extends({},t)).values=JSON.parse(JSON.stringify(t.values))})),[i]},i}()})),define("dashboard-analytics/visualizations/renderer/vipr3/VIPREventTarget",["jquery","../common/EventTarget","../../../apiHelpers/SlotAPIHelper","underscore","../VisEventHandler","../../vipr/VIPRUtils","../../../lib/@waca/core-client/js/core-client/utils/BrowserUtils","../../vipr/data/VIPRCatContDataItem","./VIPRDataPointSummarizer"],(function(e,t,i,n,a,o,s,r,l){var c="customdata",u="datapoint",d="itemclass",h="item",p="dataitem",g="tuple",m="value",f=null,v="empty",_={KEYDRIVERSHOW:"keydriver_show",DRIVERINFO:"driverinfo",TREENODEINFO:"treenodeinfo"},b="value";return function(t){function y(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];e=t.call.apply(t,[this].concat(n))||this;var s=n[0]||{};return e.viprWidget=s.viprWidget,e.viprInteractivity=e.viprWidget.getInteractivity(),e.viprDecorations={},e.viprDecorations[a.DECORATIONS.HIGHLIGHT]="highlighted",e.viprDecorations[a.DECORATIONS.SELECT]="selected",e.viprDecorations[a.DECORATIONS.TOOLTIP]="tooltip",e.viprDataPointSummarizer=new l(e.visualization),e.getAPI()||_assertThisInitialized(e)}_inheritsLoose(y,t);var I=y.prototype;return I.remove=function(){this.viprWidget=null,t.prototype.remove.call(this)},I.canRestore=function(){return o.isPropertyIncluded(this.visualization.getDefinition().getId(),"interactivityState")&&!this.content.getPropertyValue("autoZoom")},I.restore=function(e){e&&this.canRestore()&&this.viprWidget.setState(e)},I.getEventTargets=function(e,t){var i=this._getClientX(e),n=this._getClientY(e),a=this.viprWidget.getVisCoordinate(i,n),o=this.viprWidget.getItemsAtPoint(a,t);if(o&&0!==o.length||!s.isMobile()){var r={visCoord:a};return this._processItems(o,r)}var l=this._inflateCoordinates(i,n);return this.getTargetsByCords(l,!1)},I._inflateCoordinates=function(e,t){return[{x:e-5,y:t-5},{x:e+5,y:t-5},{x:e+5,y:t+5},{x:e-5,y:t+5}]},I.getTargetsByCords=function(e,t){var i=e.map(function(e){return this.viprWidget.getVisCoordinate(e.x,e.y)}.bind(this)),n=this.viprWidget.getItemsInPolygon(i),a={summarize:t,visCoord:i};return this._processItems(n,a)},I.getValuesAtPoint=function(e,t){if(this.viprWidget&&this.viprWidget.getVisCoordinate){var i=t||0,n=this.viprWidget.getVisCoordinate(e.clientX+i,e.clientY-i);return this.viprWidget.getAxisItemsAtPoint(n)}},I.decorateTarget=function(e,t,i){var a=!1,o=this.viprDecorations[t];return o&&n.each(e,(function(e){e.source&&"function"==typeof e.source.decorate?(e.source.decorate(o,i),"highlight"===t&&e.source.decorate("text",i),a=!0):"customdata"===e.type&&(a=!0)})),a},I.getDecoration=function(e,t){var i=this.viprDecorations[t];if(i&&e.source&&"function"==typeof e.source.hasDecoration&&"function"==typeof e.source.getDecoration&&e.source.hasDecoration(i))return e.source.getDecoration(i)},I.completeDecorations=function(){this.viprWidget.render("client")},I.applyCustomDataSelection=function(e,t){var i=n.isArray(e)?e[0]:e;i&&(i.type!==c||this._isLengendAndEncodingPayload(i))||this._handleCustomDataDecorations(e,t)},I._isLengendAndEncodingPayload=function(e){if("legend"===e.area&&e.values&&1===e.values.length){var t=e.values[0].payload;return t&&"encoding"===t.type}return!1},I.getCustomDataSelections=function(e){var t=[];return e&&n.each(e.values,(function(e){var i=e.payload&&e.payload.tooltip;if(i){if(i.getLines){var n=i.getLines();n&&n.length>0&&t.push.apply(t,i.getLines())}if(i.getCaption){var a=i.getCaption();a&&t.push({value:a})}}})),t},I._handleInteractivityState=function(e){return o.isPropertyIncluded(this.visualization.getDefinition().getId(),"interactivityState")?e:void 0},I.canZoom=function(){return!!this.viprInteractivity&&this.viprInteractivity.canZoom()},I.zoomStart=function(e){if(this.viprInteractivity)try{var t=e.gesture?e.gesture.center:e,i=this.viprWidget.getVisCoordinate(this._getClientX(t),this._getClientY(t));this.viprInteractivity.startInteractivity(i),this.gestureScale=1}catch(e){console.warn(e)}},I.zoom=function(e){if(this.viprInteractivity)try{var t=e.gesture?e.gesture.center:e,i=this.viprWidget.getVisCoordinate(this._getClientX(t),this._getClientY(t)),n=this._getZoomScale(e);this.viprInteractivity.zoom(i,n)}catch(e){console.warn(e)}},I.zoomEnd=function(e){if(this.viprInteractivity)try{var t=e.gesture?e.gesture.center:e,i=this.viprWidget.getVisCoordinate(this._getClientX(t),this._getClientY(t));return this.viprInteractivity.endInteractivity(i),this.gestureScale=0,this._handleInteractivityState(this.viprWidget.getState())}catch(e){console.warn(e)}},I.panStart=function(e){if(this.viprInteractivity)try{var t=this.viprWidget.getVisCoordinate(this._getClientX(e),this._getClientY(e));this.viprInteractivity.startInteractivity(t)}catch(e){console.warn(e)}},I.pan=function(e){if(this.viprInteractivity)try{var t=this.viprWidget.getVisCoordinate(this._getClientX(e),this._getClientY(e));this.viprInteractivity.translate(t)}catch(e){console.warn(e)}},I.panEnd=function(e){if(this.viprInteractivity)try{var t=this.viprWidget.getVisCoordinate(this._getClientX(e),this._getClientY(e));return this.viprInteractivity.endInteractivity(t),this._handleInteractivityState(this.viprWidget.getState())}catch(e){console.warn(e)}},I.processKeyDown=function(){return!1},I._getClientX=function(e){return e.hasOwnProperty("clientX")?e.clientX:e.originalEvent.clientX},I._getClientY=function(e){return e.hasOwnProperty("clientY")?e.clientY:e.originalEvent.clientY},I._processItems=function(e,t){var i,a=this,s=t.summarize,r=t.visCoord,l=[];if(e){var _=o.partition(e,(function(e){return"visualItem"===e.type}));l=_.matchList,e=_.nonMatchList}switch(this._getTargetType(e)){case u:var b=o.doesConfigPropertyMatchExpected(this.visualization.getDefinition().getId(),"shouldMultiPointSelectionSummarize",!0);i=this._processDataPointTargets(e,s||b);break;case m:i=this._processValueTargets(e);break;case h:case g:i=this._processTupleItemTargets(e);break;case d:case p:i=this._processDataItemClassTargets(e);break;case c:i=this._processCustomDataTargets(e);break;case v:i=[];break;case f:default:i=null}return 0!==l.length&&(i=(i=i||[]).concat(this._processCustomDataTargets(l))),n.each(i,(function(e){r&&r.area&&(e.area=r.area,e.selectionContext={actions:{actionOptions:{TextAction:{area:r.area}}}}),e.datasetId=a._datasetId(e)})),i},I._getTargetType=function(e){return e?e.length>0?e[0].infoType:v:f},I._processValueTargets=function(e){var t=[];return n.each(e,(function(e){var i=e.source,n=i.getIndex(),a=[];a[n]=[e.value],t.push({key:"value_"+n,type:u,source:i,values:a})})),t},I._processDataPointTargets=function(e,t){var i=this,a=[];t=void 0===t||t;var o=null;return n.each(e,(function(e){var t=i._getSlotAPIsForItem(e),n=t&&t[0].getDefinition().getDatasetIdList()[0];o&&n!==o||(o=n,a.push({key:e.key+":"+n,type:u,source:e.source,values:i._itemRowToTargetValues(e.row),slotAPIs:t,onlyGlobalActions:i._isForecastData(e.source)}))})),a.length&&t&&(a=this.viprDataPointSummarizer.summarizeDataPointTargets(a)),a},I._getSlotAPIsForItem=function(e){var t=e.source&&e.source.dataset&&e.source.dataset.slotAPIs;return!t&&e.source&&e.source.dataset&&(t=i.getMappedSlotListByDataset(this.visualization,e.source.dataset.getId())),t&&this._isForecastData(e.source)?t.map((function(e){return e.getDataItemList().find((function(e){return"fact"===e.getType()}))?null:e})):t},I._datasetId=function(e){return e&&e.source&&e.source.dataset&&e.source.dataset.getId&&e.source.dataset.getId()},I._processTupleItemTargets=function(e){var t=this,i=[];return n.each(e,(function(e){var n=e.source,a=!1;n&&(n.datapoints&&n.datapoints.length>0&&(a=t._isForecastData(n.datapoints[0])||!1),i.push({key:e.key||e.source.getUniqueName(),type:h,source:n,values:t.viprDataPointSummarizer.summarizeDataPointValues(n.datapoints,n.indexes.dataitem,n),isEdgeSelect:!0,onlyGlobalActions:a}))})),e.length>1&&(i=this._mergeTupleItemTargets(i)),i},I._processDataItemClassTargets=function(e){var t=this,i=[];return n.each(e,(function(e){var a=[],o=n.map(t.visualization.getSlots().getMappedSlotList(),(function(e){return e.getId()})),s=e.slotDef?o.indexOf(e.slotDef.name):-1;s>-1&&(a[s]=[{u:e.source.getUniqueName(),d:e.getCaption("label")}],i.push({key:e.source.getUniqueName(),type:d,source:e.source,values:a}))})),i},I._processCustomDataTargets=function(e){var t=[];return n.each(e,(function(e){t.push({key:e.id,type:e.infoType,source:{},values:[{payload:e.payload,customType:e.type}]})})),t},I._itemRowToTargetValues=function(e){var t=[];return e&&e.forEach((function(a,o){if(a.infoType===b){var s=a.dataItem&&a.dataItem.source&&a.dataItem.source.indexes&&a.dataItem.source.indexes.dataitem;null==s&&(s=o),t[s]||(t[s]=[]);var l=t[s],c=n.find(e,(function(e){return e.key&&0===e.key.indexOf(i.MULTI_MEASURES_SERIES)})),u=c?c.index:l.length;a.dataItem&&a.dataItem.source instanceof r?l[u]={u:a.value,d:a.value}:l[u]=a.source&&a.source.getRawValue?a.source.getRawValue():a.value}else t[o]=n.map(a.items,(function(e){return{u:e.source.item.u,d:e.source.item.d,p:e.source.item.p}}))})),t},I._mergeTupleItemTargets=function(t){return[e.extend.apply(e,[!0,{}].concat(t))]},I._handleCustomDataDecorations=function(e,t){var i=[];n.chain(e).pluck("values").flatten().each((function(e){n.contains(_,e.customType)&&i.push({id:e.payload.id,value:!0})})),this.visAPI.setCustomDataDecoration("selected",i,t)},I._getZoomScale=function(e){if(e.gesture){var t=this.gestureScale||1;return this.gestureScale=e.gesture.scale,e.gesture.scale/t}var i=e.originalEvent.deltaMode,n=e.originalEvent.deltaY;return 1===i&&(n=100*n/3),1-.002*n},I._isForecastData=function(e){return e&&e.decorations&&e.decorations.forecast},y}(t)})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/utils/Flyout",["jquery","../lib/@waca/core-client/js/core-client/ui/AccessibleView","../lib/@waca/core-client/js/core-client/utils/Utils","../lib/@waca/core-client/js/core-client/utils/BrowserUtils","@ba/ba-ui-carbon-toolkit","react-dom","react"],(function(e,t,i,n,a,o,s){var r=t.extend({init:function(t){r.inherited("init",this,[{launchPoint:t.launchPoint}]),this.$flyoutContainer=e('<div class="dashboard-flyout-container">'),this.logger=t.logger,this.$selector=e(t.selector),this.$parent=t.parent?e(t.parent):e(document.body),this.alignment=t.alignment,this.placement=t.placement||"top",this.position={left:0,top:0},this.enableTabLooping=!0,this.flyoutClass=t.flyoutClass;var i=t.viewInstance;i||(i=new t.viewClass({popupContainer:this,content:t.content,viewOptions:t.viewOptions,logger:this.logger}),this.isDestroyContentView=!0),this.view=i},getPlacement:function(){return this.placement},reposition:function(){this._positionFlyout()},_positionFlyout:function(t,i,n,a,o,s){t=t||this.$selector[0].getBoundingClientRect(),i=i||this.$flyoutContainer[0].firstChild.getBoundingClientRect(),n=n||this.$parent[0].getBoundingClientRect(),a=a||e(window).width(),o=o||e(window).height(),"top"===(s=s||this.placement)?this.position={left:t.left,top:t.top-i.height}:"left"===s?this.position={left:t.left-i.width,top:t.top}:"right"===s?this.position={left:t.left+t.width,top:t.top}:"bottom"===s&&(this.position={left:t.left,top:t.top+t.height}),"center"===this.alignment&&("top"===s||"bottom"===s?this.position.left-=(i.width-t.width)/2:"left"!==s&&"right"!==s||(this.position.top-=(i.height-t.height)/2)),"end"===this.alignment&&("top"===s||"bottom"===s?this.position.left+=t.width:"left"!==s&&"right"!==s||(this.position.top+=t.height)),i={bottom:this.position.top+i.height,right:this.position.left+i.width,top:this.position.top,left:this.position.left,width:i.width,height:i.height};var r=this._adjustFlyoutInViewport(i,a,o,s);if(this.position={left:this.position.left-n.left+this.$parent[0].offsetLeft,top:this.position.top-n.top+this.$parent[0].offsetTop},r&&s===this.placement){var l=JSON.parse(JSON.stringify(this.position)),c={top:"bottom",right:"left",bottom:"top",left:"right"}[s];this._positionFlyout(t,i,n,a,o,c)?this.position=l:this.placement=c}return this.$flyoutContainer.css({top:this.position.top,left:this.position.left}),r},_close:function(){this.isOpen=!1,this.detachHideEvents(),o.unmountComponentAtNode(this.$flyoutContainer[0]),this.$flyoutContainer.remove(),this.flyoutComponent=null,this.view.onPopupClosed&&this.view.onPopupClosed()},open:function(){var e=this;if(!this.isOpen){this.$parent[0].appendChild(this.$flyoutContainer[0]),this.flyoutComponent=o.render(s.createElement(a.Flyout,{domNodeToAttachTo:this.$flyoutContainer[0],fixedPosition:{x:0,y:0},triggerNode:this.$selector[0],hideArrow:!0,onClose:this.close.bind(this),className:this.flyoutClass,style:{position:"relative"}},s.createElement("div",{className:"popover-content"})),this.$flyoutContainer[0]),this.flyoutComponent.isIPad=i.isIpad()||n.isMobile();var t=this.view.getRenderedHtml();this.$flyoutContent=this.$flyoutContainer.find(".popover-content"),this.$flyoutContent.append(t),this._positionFlyout(),this._bindEvents(),setTimeout((function(){e.view&&e.view.onPopupShown&&e.view.onPopupShown()}),0),this._setFocus()}this.isOpen=!0},_adjustFlyoutInViewport:function(e,t,i,n){var a=!1;if(t<e.right){var o=Math.min(e.right-t,e.left);this.position.left=e.left-o,"right"===n&&(a=!0)}if(i<e.bottom){var s=Math.min(e.bottom-i,e.top);this.position.top=e.top-s,"bottom"===n&&(a=!0)}return this.position.left<0&&(this.position.left=0,"left"===n&&(a=!0)),this.position.top<0&&(this.position.top=0,"top"===n&&(a=!0)),a},close:function(){this.isOpen&&(this._close(),this.view.trigger&&this.view.trigger("flyout:hide"),this._restoreFocus())},_restoreFocus:function(){e(this.getLaunchPoint()).focus()},destroy:function(){this._close(),this.isDestroyContentView&&this.view.destroy&&(this.view.destroy(),this.view=null)},detachHideEvents:function(){this.scrollHideEventHandler&&(e("body").off("wheel.flyoutHideEvent touchstart.flyoutHideEvent",this.scrollHideEventHandler),this.scrollHideEventHandler=null),this.keyboardHideEventHandler&&(e("body").off("keydown.flyoutHideEvent",this.keyboardHideEventHandler),this.keyboardHideEventHandler=null),e(window).off("resize.flyoutResizeListener")},_bindEvents:function(){var t=this;this.scrollHideEventHandler=function(i){e.contains(t.$flyoutContainer[0],i.target)||t.close()},this.keyboardHideEventHandler=function(e){(27===e.keyCode||219===e.keyCode&&e.ctrlKey)&&t.close()},e("body").on("wheel.flyoutHideEvent touchstart.flyoutHideEvent",this.scrollHideEventHandler),e("body").on("keydown.flyoutHideEvent",this.keyboardHideEventHandler),this.windowWidth=window.innerWidth,e(window).on("resize.flyoutResizeListener",(function(){i.isIpad()||n.isMobile()&&t.windowWidth===window.innerWidth||(t.windowWidth=window.innerWidth,t.close())})),this.$flyoutContent.on("tap",(function(e){e.stopPropagation()}))},_setFocus:function(){this.view&&this.view.setFocus&&this.view.setFocus()}});return r})),define("dashboard-analytics/util/TransactionUtil",[],(function(){return function(){function e(){}return e.transactionTokenToOptions=function(e){var t={};return e&&e.transactionId&&(t.payloadData={undoRedoTransactionId:e.transactionId,transactionToken:e}),t},e}()})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/utils/FlyoutContentBase",["../lib/@waca/core-client/js/core-client/ui/core/View"],(function(e){var t=e.extend({init:function(e){this.popupParent=e.popupContainer,this.content=e.content||"",t.inherited("init",this,arguments)},getRenderedHtml:function(){return this.content},onPopupShown:function(){},onPopupClosed:function(){}});return t})),define("text!dashboard-analytics/visualizations/renderer/filter/FilterList.html",[],(function(){return'<div class="visTopList filterList {{!it.className}}" role="region" aria-label="{{!it.title}}">\n\t<div class="filterListTitle visTopCapsule visTopListTitle">{{!it.title}}</div>\n\t<ul role="listbox">\n\t{{~it.lines :line}}\n\t\t<li role="option" aria-label="{{?line.editEnabled}}{{!line.ariaEditLabel}}{{?}} {{?line.deleteEnabled}}{{!line.ariaDeleteLabel}}{{?}} {{!line.title}} {{!line.description}}" class="visTopCapsule {{=line.type}}Entry" {{?line.dataId}}data-id="{{!line.dataId}}"{{?}} tabindex="0">\n\t\t\t{{?line.deleteEnabled}}\n\t\t\t\t<div class="filterListDelete {{=line.type}}Delete" title="{{!line.deleteLabel}}">\n\t\t\t\t\t<svg class="svgIcon" style="pointer-events:none;">\n\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#{{!it.removeIcon}}"></use>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t{{?}}\n\t\t\t{{?line.editEnabled}}\n\t\t\t\t{{?line.extraEditEnabled}}\n\t\t\t\t\t<div class="filterListEditPencil {{=line.type}}Edit" title="{{!line.editLabel}}">\n\t\t\t\t\t\t<svg class="svgIcon" style="pointer-events:none;">\n\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#{{!it.editIcon}}"></use>\n\t\t\t\t\t\t</svg>\n\t\t\t\t\t</div>\n\t\t\t\t{{?}}\n\t\t\t\t<div class="filterListEdit visTopEdit {{=line.type}}Edit" title="{{!line.editLabel}}">\n\t\t\t\t\t<svg class="svgIcon" style="pointer-events:none;">\n\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{{=line.svgHref}}"></use>\n\t\t\t\t\t</svg>\n\t\t\t\t</div>\n\t\t\t{{?}}\n\t\t\t<div class="visTopLineContent filterLineContent{{?line.editEnabled}} {{=line.type}}Selector{{?}}" title="{{!line.title}}">\n\t\t\t\t<div class="{{=line.type}}ColumnTitle visTopColumnTitle">{{!line.title}}</div>\n\t\t\t\t<div class="{{=line.type}}Summary visTopSummary" title="{{!line.toolTip}}">{{!line.description}}</div>\n\t\t\t</div>\n\t\t</li>\n\t{{~}}\n\t</ul>\n</div>\n'})),define("dashboard-analytics/util/KeyCodes",[],(function(){return{KEY_DELETE_MAC:8,KEY_TAB:9,KEY_ENTER:13,KEY_CTRL:17,KEY_ESCAPE:27,KEY_SPACE:32,KEY_END:35,KEY_HOME:36,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_SECOND:50,KEY_s:83,KEY_OPEN_BRACKET:219,KEY_CLOSE_BRACKET:221,KEY_h:72,KEY_e:69}})),define("dashboard-analytics/visualizations/renderer/filter/FilterFlyoutView",["jquery","underscore","../../../widgets/livewidget/nls/StringResources","../../../util/TransactionUtil","./FilterLabelHelper","../../../lib/@waca/dashboard-common/dist/utils/FlyoutContentBase","doT","text!./FilterList.html","../../../lib/@waca/core-client/js/core-client/utils/Utils","../../../util/KeyCodes"],(function(e,t,i,n,a,o,s,r,l,c){"use strict";var u=s.template(r),d=o.extend({init:function(e){d.inherited("init",this,arguments),this.visAPI=e.viewOptions.visAPI,this.content=e.viewOptions.content,this.dashboard=e.viewOptions.dashboard,this.config=e.viewOptions.config,this.visController=e.viewOptions.visController,this.transaction=e.viewOptions.transaction,this.visualization=e.viewOptions.visualization,this.savedPrompts=this.visualization.getSavedPrompts(),this.prompts=this.dashboard.getFeature("Prompts");var t=this.visualization.getDataSource();this._filterLabelHelper=new a({dataSource:t,visAPI:this.visAPI,dashboardApi:this.dashboard}),this.content.on("change:visualization:localFilters",this._updateFilterLabels,this),this.popOver=null,this.logger=e.logger,this.iconsFeature=this.dashboard.getFeature("Icons"),this.removeIcon=this.iconsFeature.getIcon("remove"),this.editIcon=this.iconsFeature.getIcon("common-edit")},destroy:function(){this.content.off("change:visualization:localFilters",this._updateFilterLabels,this)},_getFilterId:function(t){var i=e(t.target).parents(".filterEntry")[0]||e(t.target)[0];return i?i.getAttribute("data-id"):null},setFocus:function(){this.popOver=e(".filterPopover"),this.popOver.find("li:first-Child").focus()},_onKeyUp:function(e){e.keyCode!==c.KEY_DELETE&&e.keyCode!==c.KEY_DELETE_MAC||this.onRemoveContextFilter(e)},onPopupShown:function(){this.onPopupClosed();var t=e(".filterPopover");(t=l.embedSVGIcon(t)).on("primaryaction",".filterDelete",null,this.onRemoveContextFilter.bind(this)),t.on("primaryaction",".localFilterList .visTopCapsule.filterEntry .filterLineContent.filterSelector, .localFilterList .visTopCapsule.filterEntry .filterEdit, .localFilterList li.visTopCapsule.filterEntry",null,this.onEditContextFilter.bind(this)),t.on("keyup",".visTopCapsule.filterEntry",null,this._onKeyUp.bind(this)),t.on("primaryaction",".topBottomDelete",null,this.onRemoveContextTopBottom.bind(this)),t.on("primaryaction",".visTopCapsule.topBottomEntry, .filterLineContent.topBottomSelector, .topBottomEdit",null,this.onEditContextTopBottom.bind(this)),t.on("deleteaction",".visTopCapsule.topBottomEntry",null,this.onRemoveContextTopBottom.bind(this)),t.on("primaryaction",".visTopCapsule.promptEntry, .filterLineContent.promptSelector, .promptEdit",null,this.onEditPrompt.bind(this)),t.on("primaryaction",".drillStateDelete",null,this.onRemoveContextDrill.bind(this))},onPopupClosed:function(){e(".filterPopover").off()},onEditPrompt:function(t){var i=this;t.stopPropagation();var n=(e(t.target).parents(".promptEntry")[0]||e(t.target)[0]).getAttribute("data-id");if(!n)return this.logger.error("Could not find prompt info to edit",t),!1;var a=this.savedPrompts.getPromptSpec(n);return a?(a.rePrompt=!0,this.popupParent.close(),this.prompts.openPromptView([a],this.visualization).then((function(e){i.savedPrompts.save(e[0])}))):(this.logger.error("Could not find prompt info for "+n,this),Promise.resolve())},onEditContextFilter:function(t){var i=this;t.stopPropagation();var n=this._getFilterId(t);this._currentFilterId=n;var a=e(t.target).parents(".filterEntry")[0]||e(t.target)[0];return this.visController.getActionHelper().editLocalFilter(n,a).then((function(e){e&&(i.popupParent.detachHideEvents(),i.parentListClass=".filterList")}))},_updateFilterLabels:function(){var i=this.visAPI.getFilterInfo();t.each(i.localFilters,function(t){if(t.id===this._currentFilterId){var i=e('.filterEntry[data-id="'+t.id+'"] .filterSummary'),n=this._filterLabelHelper.getFilterDescription(t);return n||(n=""),i.text(n),void i.attr("title",n)}}.bind(this))},onRemoveContextFilter:function(e){e.stopPropagation();var t=this._getFilterId(e);if(t){var i=this.transaction.startTransaction(),n=this.dashboard.getFeature("PageContextService").getPageContext(),a=n.getPageContextItem({id:t});if(a){if("visualization"===a.getOrigin())this.content.getFeature("DataPointSelections").deselect(this._getSelectionPayload(a),i);else this.dashboard.triggerDashboardEvent("filterIndicator:removeEntry",{filterToDelete:t,pageContext:n,transactionToken:i})}else{var o={id:t};this.visualization.getLocalFilters().removeFilter(o,i)}this.transaction.endTransaction(i)}this.popupParent.close()},_getSelectionPayload:function(e){var t=[],i=e.getItemIds()||[],n=e.isDataPointType()?e.getDataPoints():e.getValues().map((function(e){return[e]}));return n&&n.forEach((function(n){var a=[];n.forEach((function(e,t){a.push({columnId:i[t]||i[0],value:e.value||e.u,label:e.label||e.d})})),e.getItemIds().length<=a.length&&t.push({categories:a})})),t},getRenderedHtml:function(){var e=this.visAPI.getFilterInfo(),t=this.visAPI.getTopBottomInfo(),n=this.visAPI.getDrillInfo(),a=this.config.localFilters&&e.localFilters.length>0,o=this.config.localTopbottoms&&t.length>0,s=this.config.drillState&&n.length>0,r=this.savedPrompts.getPromptSpecList(),l="";if(a||o||s||r.length){var c=[];a&&(c=c.concat(this._filterLabelHelper.generateFilterListItems(e.localFilters))),o&&(c=c.concat(this._filterLabelHelper.generateTopBottomListItems(t))),s&&this._generateDrillStateListItems(n,c),r.length&&this._generatePromptListItems(r,c),l+=u({title:i.get("localFilterTitle"),className:"localFilterList",lines:c,removeIcon:this.removeIcon.id,editIcon:this.editIcon.id})}if(this.config.globalFilters&&e.filters.length>0){var d;d=this._filterLabelHelper.generateFilterListItems(e.filters),l+=u({title:i.get("globalFilterTitle"),className:"globalFilterList",lines:d,removeIcon:this.removeIcon.id,editIcon:this.editIcon.id})}return l},onRemoveContextTopBottom:function(e){e.stopPropagation();var t=this._getTopBottomId(e);if(t){var i=this.visualization.getSlots().getMappingInfo(t),n=i.slot,a=i.indexInSlot;if(n&&a>=0)this.content.getFeature("topBottomAction").reset(n.getId(),a),this.popupParent.close()}},onRemoveContextDrill:function(e){e.stopPropagation();var t=this._getDrillId(e);if(t){var i=this.visualization.getSlots().getDataItem(t),a=this.transaction.startTransaction();i.clearDrill(a),this.visAPI.getLocalFilters().removeFilterEntry({id:i.getColumnId()}),this.visAPI.getLocalFilters().allFilterModificationComplete(n.transactionTokenToOptions(a)),this.transaction.endTransaction(a),this.popupParent.close()}},onEditContextTopBottom:function(t){var i=this;t.stopPropagation();var n,a=this._getTopBottomId(t),o=e(t.target).parents(".topBottomEntry")[0]||e(t.target)[0];if(a){var s=this.visualization.getSlots().getMappingInfo(a),r=s.slot,l=s.indexInSlot;n=r&&l>=0?this.visController.getActionHelper().showAction("topBottomAction",r,o,l).then((function(e){e&&(i.popupParent.detachHideEvents(),i.parentListClass=".topBottomList")})):Promise.resolve()}else n=Promise.resolve();return n},_getDrillId:function(t){var i=e(t.target).parents(".drillStateEntry")[0]||e(t.target)[0];return i?i.getAttribute("data-id"):null},_getTopBottomId:function(t){var i=e(t.target).parents(".topBottomEntry")[0]||e(t.target)[0];return i?i.getAttribute("data-id"):null},_generatePromptListItems:function(e,t){var n=this;e.forEach((function(e){var a=n._filterLabelHelper.getPromptLabel(e),o=!!e.capabilities&&e.capabilities.optional,s={type:o?"optionalPrompt":"prompt",deleteEnabled:!1,editEnabled:!o,extraEditEnabled:!o,dataId:e.name,title:e.name,description:a,toolTip:a,svgHref:"#common-filter",editLabel:i.get("editFilter"),ariaEditLabel:i.get("ariaEditPrompt")};t.push(s)}))},_generateDrillStateListItems:function(e,n){t.each(e,function(e){var t={},a=this._getDrillStateDescription(e);if(void 0!==e.columnId||void 0!==e.columnLabel){if(!a)return;t=a}e.id&&(t.deleteEnabled=e.deleteEnabled,t.editEnabled=e.editEnabled,t.dataId=e.id,t.deleteLabel=i.get("deleteDrillOperation"),t.ariaDeleteLabel=i.get("ariaDeleteDrillStateLabel")),t.type="drillState",n.push(t)}.bind(this))},_getDrillStateDescription:function(e){if(void 0!==e.columnId){var t=this._filterLabelHelper.getColumnMetadataNameFromColumnId(e.columnId);return t?(e.columnLabel=t.getLabel(),this._getDrillStateLabel(e,t)):null}},_getDrillStateLabel:function(e){var t,n;return e.children?(e.operator="in",e.values=[{d:e.columnLabel,u:e.children}],n=this._filterLabelHelper.getFilterDescription(e),t={title:i.get("drillDownStateTitle"),description:n,toolTip:n}):e.drillUp&&(e.operator="in",e.values=[{d:e.columnLabel,u:e.drillUp}],n=this._filterLabelHelper.getFilterDescription(e),t={title:i.get("drillUpStateTitle"),description:n,toolTip:n}),t}});return d})),define("text!dashboard-analytics/visualizations/renderer/filter/FilterIndicator.html",[],(function(){return'<div role="application" class="dataWidgetIcon dataWidgetFilters dataWidgetFiltersNone" tabindex="0" title="{{!it.title}}"  aria-label="{{!it.title}}" data-selector="true">\n\t<svg class="svgIcon dataWidgetFilterIcon" style="pointer-events:none;">\n\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#{{!it.iconId}}"></use>\n\t</svg>\n</div>\n'})),define("dashboard-analytics/visualizations/renderer/filter/FilterIndicator",["jquery","../../../lib/@waca/core-client/js/core-client/ui/core/Class","../../../lib/@waca/dashboard-common/dist/utils/Flyout","./FilterFlyoutView","doT","text!./FilterIndicator.html","../../../lib/@waca/dashboard-common/dist/utils/EventChainLocal","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/core-client/js/core-client/utils/Utils"],(function(e,t,i,n,a,o,s,r,l){"use strict";var c=a.template(o);return t.extend({init:function(t,i,n,a,o,s,u,d){this.visAPI=t,this.config=o,this.logger=s,this.transaction=n,this.interactivityController=a,this.visualization=i,this.savedPrompts=this.visualization.getSavedPrompts(),this.dashboard=u,this.content=d;var h=this.dashboard.getFeature("Icons").getIcon("filterApplied");this.$filter=e(c({title:r.get("widgetFiltersLabel"),iconId:h.id})),this.$filter=l.embedSVGIcon(this.$filter)},initEvents:function(){var e=this._onClick.bind(this);this.$filter.on("tap keydown click",e)},remove:function(){this.$filter&&this.$filter.off()&&this.$filter.remove(),this._clearFlyout(),this.visAPI=null,this.config=null,this.$filter=null},_clearFlyout:function(){this.flyout&&this.flyout.destroy(),this.flyout=null},setSynchronizeDataFilters:function(e){this.visAPI.setSynchronizeDataFilters(e)},update:function(){this._clearFlyout();var e=this.visAPI.getFilterInfo(),t=this.visAPI.getTopBottomInfo(),i=this.visAPI.getDrillInfo(),n=this.savedPrompts.getPromptSpecList().length,a=this.visualization.getSlots().isMappingComplete();if(e||t||n||i){var o=0,s=0,r=0,l=0;if(e){if(o=this.config.localFilters?e.localFilters.length:0)e.localFilters.find((function(e){return e.isMissing}))&&this.$filter.addClass("dataWidgetFiltersNone");s=this.config.globalFilters?e.filters.length:0}t&&(r=this.config.localTopbottoms?t.length:0),i&&(l=this.config.drillState?i.length:0),(o+s+r+l||n)&&a?this.$filter.removeClass("dataWidgetFiltersNone"):this.$filter.addClass("dataWidgetFiltersNone")}},isVisible:function(){return!this.$filter.hasClass("dataWidgetFiltersNone")},_preventWidgetContextBar:function(e){new s(e).setProperty("preventDefaultContextBar",!0)},_onClick:function(e){e.keyCode&&13!==e.keyCode||(e.gesture&&e.gesture.preventDefault(),this.flyout||(this.flyout=new i({alignment:"center",selector:this.$filter,flyoutClass:"filterPopover visTopPopover",viewClass:n,viewOptions:{visController:this.interactivityController,visAPI:this.visAPI,config:this.config,visualization:this.visualization,transaction:this.transaction,dashboard:this.dashboard,content:this.content},logger:this.logger})),this.flyout.open(),e.stopPropagation())}})})),define("text!dashboard-analytics/visualizations/renderer/refreshtimer/templates/RefreshTimerIndicator.html",[],(function(){return'<div role="application" class="dataWidgetIcon dataWidgetTimers {{?it.autoRefresh !== true}}dataWidgetTimersNone{{?}}" tabindex="0" {{?it.title}}title="{{!it.title}}" {{?}}{{?it.ariaLabel}}aria-label="{{!it.ariaLabel}}"{{?}}>\n\t<svg  class="svgIcon dataWidgetTimerIcon">\n\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#{{!it.clockIcon}}"></use>\n\t</svg>\n</div>\n'})),define("dashboard-analytics/visualizations/renderer/refreshtimer/RefreshTimerIndicator",["../../../lib/@waca/core-client/js/core-client/ui/core/View","jquery","underscore","text!./templates/RefreshTimerIndicator.html","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/dashboard-common/dist/utils/Flyout","../../../lib/@waca/core-client/js/core-client/utils/Utils"],(function(e,t,i,n,a,o,s){var r=e.extend({templateString:n,init:function(e){this.ownerWidget=e;var n=e.get("queryRefresh"),o=n||{autoRefresh:!1};i.extend(this,o),r.inherited("init",this,o),this.$icon&&this.$icon.remove(),this.ariaLabel=a.get("widgetTimer"),this.title=a.get("widgetTimer"),this.clockIcon=this.ownerWidget.dashboardApi.getFeature("Icons").getIcon("common-clock-time").id,this.$icon=t(this.dotTemplate(this))},initEvents:function(){var e=this._onClick.bind(this);this.$icon.on("mousedown tap keydown mouseup",e)},remove:function(){this.$icon&&this.$icon.off(),this.$icon=null,r.inherited("remove",this,arguments)},_onClick:function(e){var i=this;if("mouseup"!==e.type){if(!e.keyCode||13===e.keyCode){if(e.gesture&&e.gesture.preventDefault(),this.ownerWidget){var n=this.ownerWidget.get("queryRefresh").lastRefreshed,r=(new Date).getTime()-n,l=a.get("lastRefresh",{timeInterval:s.formatDuration(r)});this.flyout?(this.$flyoutContent.empty(),this.$flyoutContent.html(l)):(this.$flyoutContent=t("<div>"+l+"</div>"),this.flyout=new o({alignment:"center",selector:this.$icon,viewInstance:{getRenderedHtml:function(){return i.$flyoutContent}}})),this.flyout.open()}e.stopPropagation()}}else e.stopPropagation()}});return r})),define("text!dashboard-analytics/visualizations/renderer/templates/EmptyVisualization.template",[],(function(){return'<div class="vis-icon-view">\n\t<div class="vis-icon-view-snapshot-container">\n\t\t<img class="snapshot" src="{{= it.icon }}" alt="{{= it.caption}}"></img>\n\t</div>\n\t<div class="vis-icon-view-hint">\n\t\t<div class="title">{{= it.title }}</div>\n\t\t<div class="description">{{= it.description }}</div>\n\t</div>\n</div>\n'})),define("dashboard-analytics/visualizations/renderer/VisTabs",["jquery","underscore","../../lib/@waca/core-client/js/core-client/ui/core/View","react-dom","react","@ba/ba-ui-carbon-toolkit"],(function(e,t,i,n,a,o){"use strict";var s=o.TabPanel,r=o.Tabs,l=function(e){function i(i){var n;return(n=e.call(this,i)||this)["use strict"]=void 0,n.state=t.clone(i.state),n}_inheritsLoose(i,e);var n=i.prototype;return n.render=function(){return a.createElement(r,{selected:this.getSelectedId(),onChange:this._onChange.bind(this)},this._renderPanels())},n.select=function(e){this.setState({selectedTab:e||this.props.selectedTab})},n.getSelectedId=function(){return this.state.selectedTab},n._renderPanels=function(){return t.map(this.props.entries,(function(e){return a.createElement(s,{key:e.id,id:e.id,label:e.label})}))},n._onChange=function(e){this.select(e);var i=t.findWhere(this.props.entries,{id:e});i&&i.onChange&&i.onChange(e)},i}(a.Component),c=i.extend({className:"visTabsView",init:function(){c.inherited("init",this,arguments)},placeAt:function(t){e(t).find(".visTabsView").remove(),this.$el.prependTo(t)},createTabs:function(e,t){this.entries=e;var i={selectedTab:t||(e&&e.length?e[0].id:null)};this.ctrl=n.render(a.createElement(l,{entries:e,state:i}),this.el)},reset:function(){this.ctrl&&(n.unmountComponentAtNode(this.el),this.entries=null,this.ctrl=null)},remove:function(){this.reset(),c.inherited("remove",this,arguments)},getTabsCount:function(){return this.entries?this.entries.length:0},selectTab:function(e){this.ctrl&&this.ctrl.getSelectedId()!==e&&(this.ctrl.select(e),this.ctrl.render())}});return c})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("dashboard-analytics/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/warning--filled_24",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var i=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var n in i)("object"==typeof exports?exports:e)[n]=i[n]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([29],{"12105acffa480e98dd24":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=i("6873601dfe1d9459c1a9"),a=(i.n(n),i("d454204591914749af03"));t.default=a.a},"6873601dfe1d9459c1a9":function(t,i){t.exports=e},d454204591914749af03:function(e,t,i){"use strict";var n=i("9689a9c94ae38b47fa2c"),a=i.n(n),o=i("9ce58a7deea14f49ef01"),s=i.n(o),r=new a.a({id:"warning--filled_24_v7",use:"warning--filled_24_v7-usage",viewBox:"0 0 24 24",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" id="warning--filled_24_v7"><path d="M12,1C5.9,1,1,5.9,1,12s4.9,11,11,11s11-4.9,11-11C23,5.9,18.1,1,12,1z M11.1,6h1.8v8h-1.8V6z M12,19.2\tc-0.7,0-1.2-0.6-1.2-1.2s0.6-1.2,1.2-1.2s1.2,0.6,1.2,1.2S12.7,19.2,12,19.2z" /></symbol>'});s.a.add(r),t.a=r}},["12105acffa480e98dd24"])})),define("dashboard-analytics/visualizations/renderer/VisView",["jquery","underscore","doT","../../lib/@waca/core-client/js/core-client/ui/core/View","./filter/FilterIndicator","../../widgets/livewidget/nls/StringResources","../../lib/@waca/core-client/js/core-client/utils/Utils","./refreshtimer/RefreshTimerIndicator","text!./templates/EmptyVisualization.template","./VisTabs","../../lib/@waca/core-client/js/core-client/utils/BrowserUtils","../../widgets/livewidget/util/VisUtil","../../lib/@waca/dashboard-common/dist/utils/MemUtil","../../lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/warning--filled_24"],(function(e,t,i,n,a,o,s,r,l,c,u,d,h,p){var g=["filterIndicator","refreshTimerIndicator"],m=n.extend({DEFAULT_ANIMATION_SPEED:900,ANIMATION_TYPES:{NONE:"none",DEFAULT:"default",FADEIN:"fadein",TRANSITION:"transition",GROW:"grow",REVEAL:"reveal",BIGDATA:"bigdata"},init:function(e){m.inherited("init",this,arguments),t.extend(this,e),this.dashboard=this.dashboardApi,this.noRotate=!0,this.isMaximizable=!0,this.visualization=this.content.getFeature("Visualization"),this.transactionApi=this.dashboard.getFeature("Transaction"),this.dashboardSettings=this.dashboard.getFeature("DashboardSettings"),this.visDefinitions=this.dashboard.getFeature("VisDefinitions"),this.eventGroups=this.dashboard.getFeature("EventGroups"),this.renderSequence=this.content.getFeature("RenderSequence"),this._processTemplateString(),e.proxiedView||this._viewManagesOwnQuery()||this._initIndicators(),this.visEl=this.el.firstChild?this.el.firstChild:this.el,this.overrideDefaultAnimationSpeed=-1,this.animationType=this.ANIMATION_TYPES.NONE,this.animationSpeed=this.DEFAULT_ANIMATION_SPEED,this._renderingNewData=!1,e.proxiedView||this._viewManagesOwnQuery()||this.createView(),e.proxiedView||this._addPropertyHandler(),this.smartAnnotations=this.content.getFeature("SmartAnnotations.deprecated"),this.infoIndicator=this.content.getFeature("InfoIndicator"),this.infoIndicator&&this.infoIndicator.reset(),this.isDataFiltersEnabled()&&(this._dataPointSelections=this.content.getFeature("DataPointSelections"))},isDataFiltersEnabled:function(){var e=this.dashboard.getGlassCoreSvc(".FeatureChecker");return e&&e.checkValue("dashboard","DataFilters","enabled")},createTabs:function(){var e={};if(this.ownerWidget&&this.ownerWidget.$el){var t=this.ownerWidget.$el.find(".visTabsView");e.el=t.length?t[0]:null}this._tabs=new c(e),this._tabs.hide()},placeAt:function(e){this.createTabs(),this.$el.prependTo(e),this._tabs&&this._tabs.placeAt(e)},doesVisPropertyMatchExpected:function(){return!1},canApplyAutoBin:function(){var e=this.visualization.getDefinition().getProperty("binningConfig"),i=!e||!1!==e.auto,n=this.visualization.getSlots().getMappedSlotList();return i&&!!t.find(n,(function(e){var t,i=e.getDefinition().getRole();return"ordinal"===e.getDefinition().getType()||"explanatory"!==i&&"group"!==i||(t=e.getDataItemList().find((function(e){return"fact"===e.getMetadataColumn().getType()}))),!!t}))},_initFilterIndicator:function(){var e=this.getFilterIndicatorSpec();e&&(e.localFilters||e.globalFilters||e.localTopBottoms||e.drillState)&&(this.filterIndicator=new a(this.visModel,this.visualization,this.transactionApi,this.getController(),e,this.logger,this.dashboard,this.content),this.ownerWidget.addIcon(this.filterIndicator.$filter,"filterIcon"))},_initIndicators:function(){var e=this,i=this.content.getFeature("VisIndicators");if(i&&this.ownerWidget&&this.ownerWidget.$el){this._initRefreshIndicator(),this._initFilterIndicator();var n=i.getIndicatorList();t.each(n,(function(t){e.ownerWidget.addIcon(t.icon,t.name)}))}},_initRefreshIndicator:function(){this.refreshTimerIndicator=new r(this.ownerWidget),this.ownerWidget.addIcon(this.refreshTimerIndicator.$icon,"timerIcon")},getFilterIndicatorSpec:function(){return{localFilters:!0,globalFilters:!0,localTopbottoms:!0,drillState:!0}},getController:function(){return this.content&&this.content.getFeature("InteractivityController.deprecated")},getSelector:function(){return this.content.getFeature("DataPointSelections.deprecated")},initialize:function(){return this._noOpRenderStep("base class initialize called!")},onVisSpecReady:function(){},_hasMappedSlots:function(){return 0!==this.visualization.getSlots().getMappedSlotList().length},onDataReady:function(e){var t=e.info&&e.info.renderContext?JSON.parse(JSON.stringify(e.info.renderContext)):{};return t.taskRefreshed&&t.taskRefreshed.data&&(this.filterIndicator&&this.filterIndicator.update(),this._updateInfoIndicator()),t},_updateInfoIndicator:function(){var e,i,n,a=this.renderSequence.getTaskResult("data");if(!t.isEmpty(a)){var s=t.find(a.getQueryResultIdList(),(function(e){return a.getResult(e).hasMoreData()}));i=(e=void 0!==s)&&a.getResult(s).getRowCount(),n=a.getWarningList()}if(this.infoIndicator){var r=[];e&&(i&&r.push({id:"moreDataIndicator",label:o.get("moreDataIndicator",{threshold:i})}),this.canApplyAutoBin()&&!this.hasBinnedDataItems()&&r.push({id:"autobinSuggestion",label:o.get("autobinSuggestion"),isSubMessage:!0})),n&&n.length&&n.forEach((function(e){r.push({id:e.resourceId,label:o.get(e.resourceId,e.params),isSubMessage:!!e.isSubMessage})})),this.infoIndicator.update([{id:"data_notifications",label:o.get("dataNotifications"),items:r}])}},onSetDataReady:function(){},isSameQueryData:function(e,t){if(void 0===e&&(e={}),void 0===e.sameQueryData){var i=t&&t.getCacheValidateTag&&t.getCacheValidateTag();e.sameQueryData=this._previousTag&&this._previousTag===i,this._previousTag=i}return!!(e.sameQueryData||e.extraInfo&&e.extraInfo.annotationRequest)},updateInfoIndicator:function(e){this.infoIndicator&&this.infoIndicator.update(e)},isMappingComplete:function(){return this.visualization.getSlots().isMappingComplete()},isRenderWithoutCompletingMapping:function(){return!0===this.visualization.getDefinition().getProperty("renderWithoutCompletingMapping")},hasUnavailableMetadataColumns:function(){return this.visualization.hasUnavailableMetadataColumns()},onHighlighterReady:function(){},_getInfoIndicatorEntries:function(e,i){return[{id:e,label:o.get(e),items:t.map(i,(function(e){return{id:e.id,label:e.caption}}))}]},_setInfoIndicatorWarningsAndErrors:function(e){if(this.infoIndicator&&e){var t=e.getWarningList(),i=e.getErrorList();this.infoIndicator.update(this._getInfoIndicatorEntries("smart_warnings",t)),this.infoIndicator.update(this._getInfoIndicatorEntries("smart_errors",i))}},clearInfoIndicator:function(){if(this.infoIndicator)if(this.isMappingComplete()){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];this.infoIndicator.clearMessagesWithIds(t)}else this.infoIndicator.reset()},onPreAnnotation:function(){this.updateSmartsIndicators()},clearAnnotationErrorsAndWarnings:function(){this.clearInfoIndicator("smart_errors","smart_warnings","smart_exec_support_warnings","annotation_service_error")},onAnnotatedResultsReady:function(e){var t=e.info&&e.info.renderContext?JSON.parse(JSON.stringify(e.info.renderContext)):{};if(t.taskRefreshed&&t.taskRefreshed.annotation){var i=this.renderSequence.getTaskResult("annotation");i&&(this.clearAnnotationErrorsAndWarnings(),this._setInfoIndicatorWarningsAndErrors(i))}},onAnnotationFail:function(e){this.onPredictSuggestionsFail();var t=e.info&&e.info.renderContext?JSON.parse(JSON.stringify(e.info.renderContext)):{};t.extraInfo.annotationRequest&&this.render(t),this.updateSmartsIndicators()},onPredictSuggestionsFail:function(){this.infoIndicator&&this.infoIndicator.update([{id:"annotation_service_error",label:o.get("smart_errors"),items:[{id:"suggestions",label:o.get("smart_annotation_insight_unavailable")}]}])},onPredictSuggestionsReady:function(e){var t=e.info&&e.info.renderContext?JSON.parse(JSON.stringify(e.info.renderContext)):{};t.taskRefreshed&&t.taskRefreshed.predictSuggestions&&(this.clearInfoIndicator("annotation_service_error","suggestions"),this.smartAnnotations.clearInsightsIndicatorMessages(),this.content&&this.content.getFeature("Forecast").clearForecastIndicatorMessages())},_viewManagesOwnQuery:function(){return!!this.ownerWidget.managesOwnQueries&&!0===this.ownerWidget.managesOwnQueries},_noOpRenderStep:function(){return Promise.resolve({})},_addPropertyHandler:function(){this.ownerWidget.model.on("change:properties",this.onChangeProperties,this),this.ownerWidget.model.on("change:fillColor",this.onChangeProperties,this)},createView:function(){if(!this.visModel)throw"Invalid VisModel reference";for(var e in this.visModelEvents={"change:annotations":this.onChangeAnnotations,"change:pagecontext":this.onChangePageContext,"change:refreshTimer":this.toggleRefreshTimerIndicator},this.ownerWidget.model.on("change:searchFilters",this.onChangeLocalFilter,this),this.content.on("change:visualization:localFilters",this.onChangeLocalFilter,this),this.visModelEvents)this.visModelEvents.hasOwnProperty(e)&&this.visModel.on(e,this.visModelEvents[e],this);this.filterIndicator&&this.filterIndicator.initEvents(),this.refreshTimerIndicator&&this.refreshTimerIndicator.initEvents(),this.content.on("all",this.onAllContentChanges,this),this.content.on("change:property:fillColor",this.onFillColorChange,this),this.content.on("change:property:queryRefresh",this.onQueryRefreshChange,this),this.visDefinitions.on("refresh:definition",this.onRefreshVisDefinition,this),this.visDefinitions.on("refresh:all",this.onRefreshAllVisDefinition,this),this.eventGroups.on("all",this.onChangeEventGroup,this),this._registerRenderSequenceEvent()},_registerRenderSequenceEvent:function(){this.renderSequence.on("execution:end:data",this.onDataReady,this),this.renderSequence.on("execution:end:setData",this.onSetDataReady,this),this.renderSequence.on("execution:end:predictSuggestions",this.onPredictSuggestionsReady,this),this.renderSequence.on("execution:fail:predictSuggestions",this.onPredictSuggestionsFail,this),this.renderSequence.on("execution:end:highlighter",this.onHighlighterReady,this),this.renderSequence.on("execution:end:visSpec",this.onVisSpecReady,this),this.renderSequence.on("execution:start:annotation",this.onPreAnnotation,this),this.renderSequence.on("execution:end:annotation",this.onAnnotatedResultsReady,this),this.renderSequence.on("execution:fail:annotation",this.onAnnotationFail,this),this.renderSequence.on("execution:end:insightsNarrator",this.onInsightsReady,this)},onChangeEventGroup:function(e){e.info&&e.info.contentIds&&e.info.contentIds.indexOf(this.content.getId())>-1&&this._reRender({refresh:{dataIfQueryChanged:!0},extraInfo:{payloadData:{transactionToken:e.transactionToken}}})},onRefreshAllVisDefinition:function(){(this.visualization.getDefinition().getState().getError()||this.content.getFeature("state").getError())&&this._reRender({refreshAll:!0})},onRefreshVisDefinition:function(e){var t=this.visualization.getDefinition();t&&e&&e.info&&t.getId()===e.info.id&&this._reRender({refreshAll:!0})},onAllContentChanges:function(e){if(e&&e.info&&e.info.refresh){var i={resizing:!!e.info.resizing,refresh:t.extend({},e.info.refresh),extraInfo:{payloadData:{transactionToken:e.transactionToken}}};i.refresh.all&&(i.refreshAll=i.refresh.all);var n=e.context&&e.context.undoRedo&&"ConditionalFormatting"!==e.info.featureName;i.refresh.propertiesPane=this._refreshPropertiesPane(i,n),this._reRender(i)}},onFillColorChange:function(e){var t=e&&e.info&&e.info.value;this.ownerWidget.getAPI().getVisApi().visPropertySupport.setEffectiveBackgroundColor(t)},onQueryRefreshChange:function(e){var t=e&&e.info&&e.info.value.autoRefresh;this.ownerWidget.getAPI().getVisApi().visRenderSupport.setQueryRefresh(t)},_refreshPropertiesPane:function(e,t){return!this._isLocalViz()||e.refresh.propertiesPane||!this._isNewConditionalFormattingEnabled()||!!t},_isLocalViz:function(){var e=this.content.getFeature("Visualization").getType();return t.contains(["KPI","Singleton","Hierarchy","Crosstab","List","DataPlayer","DropdownList"],e)},_isNewConditionalFormattingEnabled:function(){var e=!this.dashboard.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","condFormat","disabled"),t=!this.dashboard.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","xtabcondFormat","disabled");return e||t},_processTemplateString:function(){if(this.templateString){var e=this.dotTemplate(this.templateString);e||(e=this.templateString),this.$el.html(e);var i=this.el.querySelectorAll("div[data-attach-point]"),n={};t.each(i,(function(e){n[e.getAttribute("data-attach-point")]=e})),t.extend(this,n)}},resize:function(e){if(e){var t=e.height||this.$el.parent().height();this._tabs&&this._tabs.getTabsCount()>0&&this.ownerWidget.allowShowTabs&&this.ownerWidget.allowShowTabs()&&this.isMappingComplete()&&(t-=this._tabs.$el.height());var i=function(e,t,i){void 0!==i&&i!==parseInt(e[t],10)&&(e[t]=i+"px")},n=this.el.style;i(n,"left",e.left),i(n,"top",e.top),i(n,"width",e.width),i(n,"height",t)}},remove:function(e){var t=this;for(var i in void 0===e&&(e=!0),this.removeIconView(),m.inherited("remove",this,arguments),g.forEach((function(e){t[e]&&t[e].remove(),t[e]=null})),this.visModelEvents)this.visModelEvents.hasOwnProperty(i)&&this.visModel.off(i,this.visModelEvents[i],this);this.ownerWidget.model.off("change:searchFilters",this.onChangeLocalFilter,this),this.ownerWidget.model.off("change:properties",this.onChangeProperties,this),this.ownerWidget.model.off("change:fillColor",this.onChangeProperties,this),this.content.off("change:visualization:localFilters",this.onChangeLocalFilter,this),this._tabs&&(this._tabs.remove(),this._tabs=null),this.content&&this.content.off("all",this.onAllContentChanges,this),this.content.off("change:property:fillColor",this.onFillColorChange,this),this.content.off("change:property:queryRefresh",this.onQueryRefreshChange,this),this.visDefinitions.off("refresh:definition",this.onRefreshVisDefinition,this),this.visDefinitions.off("refresh:all",this.onRefreshAllVisDefinition,this),this.eventGroups.off("all",this.onChangeEventGroup,this),this._unregisterRenderSequenceEvent(),e&&h.destroy(this)},_unregisterRenderSequenceEvent:function(){this.renderSequence.off("execution:end:data",this.onDataReady,this),this.renderSequence.off("execution:end:setData",this.onSetDataReady,this),this.renderSequence.off("execution:end:predictSuggestions",this.onPredictSuggestionsReady,this),this.renderSequence.off("execution:fail:predictSuggestions",this.onPredictSuggestionsFail,this),this.renderSequence.off("execution:end:highlighter",this.onHighlighterReady,this),this.renderSequence.off("execution:end:visSpec",this.onVisSpecReady,this),this.renderSequence.off("execution:start:annotation",this.onPreAnnotation,this),this.renderSequence.off("execution:end:annotation",this.onAnnotatedResultsReady,this),this.renderSequence.off("execution:fail:annotation",this.onAnnotationFail,this),this.renderSequence.off("execution:end:insightsNarrator",this.onInsightsReady,this)},onChangePageContext:function(e){var t=this;return this.onChangeFilter(e).catch((function(e){var i=e&&"dwErrorStaleRequest"===e.message?"debug":"error";t.logger[i](e)}))},_rebuildVis:function(e,t){this._rebuildPending=!0;var i=t&&t.extraInfo&&t.extraInfo.payloadData&&t.extraInfo.payloadData.transactionToken;return this.transactionApi.registerTransactionHandler(i||{},this.ownerWidget.id+"_rebuildvis",function(){var t=this;this.ownerWidget._rebuildVis(e).then((function(){t._rebuildPending=!1}))}.bind(this),t)},_getRenderTransaction:function(e){var t=e&&e.extraInfo&&e.extraInfo.payloadData&&e.extraInfo.payloadData.transactionToken;return!t||t.transactionId?t:null},_reRender:function(e){if(!this._rebuildPending)if(this.ownerWidget.isVisible()){var t=this._getRenderTransaction(e);if(!t||this.transactionApi.isValidTransaction(t))return this.transactionApi.registerTransactionHandler(t||{},this.ownerWidget.id,function(e){return this.ownerWidget?this.ownerWidget.getAPI().getVisApi().getRenderSequence().reRender(this._mergeOptions(e)):Promise.resolve()}.bind(this),e)}else this.ownerWidget.setReRenderOnShow(e);return Promise.resolve()},_mergeOptions:function(e){var t=e[0],i=e.length;if(i>1)for(var n=1;n<i;n++)t.refresh=this._mergeRefreshOptions(t.refresh,e[n].refresh),e[n].refreshAll&&(t.refreshAll=e[n].refreshAll);return t.refresh&&t.refresh.data&&t.refresh.dataIfQueryChanged&&delete t.refresh.dataIfQueryChanged,t},_mergeRefreshOptions:function(e,t){return void 0===t&&(t={}),Object.keys(t).forEach((function(i){e.hasOwnProperty(i)?e[i]=e[i]||t[i]:e[i]=t[i]})),e},onChangeFilter:function(e){var i=this,n=(e=e||{}).changeEvent,a=this.transactionApi.startTransaction(n&&n.data&&n.data.transactionToken),o=e&&e.sender;return d.validateVisDefinition(this.content,this.dashboard,{visId:this.ownerWidget.model.visId}).then((function(s){var r=!n||n.isInScope(i.ownerWidget.getScope());if(s&&r){var l,c=n&&n.senderMatches(i.content.getId()),u=n&&n.isDelete()&&n.getItems().find((function(e){return e.getEventSourceId()!==i.content.getId()})),d={refresh:{dataIfQueryChanged:!c||!!t.find(n.getItems(),(function(e){return e.getIsSticky()}))||!!u,annotation:!0}};if(c){if(n&&!n.brushingChanged()&&t.every(n.getItems(),(function(e){return 0===e.getValueCount()})))return;l={entryDuration:"zero",payloadData:{transactionToken:a}}}i._reRender(i.appendExtraInfoToRenderOptions(d,e,l)).then((function(){c&&(i.dashboard.triggerDashboardEvent("dataInVis:selected",{payloadData:i.ownerWidget,sender:i.ownerWidget.id}),i.ownerWidget.trigger("visevent:selectionchanged",{sender:i.ownerWidget.id,isSelectionOriginator:c}),i.renderFocused(!o||o===i.ownerWidget.id)),i.filterIndicator&&(i.filterIndicator.setSynchronizeDataFilters(null),i.filterIndicator.update())}))}})).finally((function(){i.transactionApi.endTransaction(a)}))},toggleRefreshTimerIndicator:function(e){this.refreshTimerIndicator.$icon&&(e.autoRefresh?this.refreshTimerIndicator.$icon.removeClass("dataWidgetTimersNone"):this.refreshTimerIndicator.$icon.addClass("dataWidgetTimersNone"))},onChangeLocalFilter:function(e){var t={refresh:{data:!0,annotation:!0}};if(this.ownerWidget.updateMissingFilters(),this._isViewSlotsEmpty())this._rebuildVis(e,this.appendExtraInfoToRenderOptions(t,e));else{this.visModel.setPendingFilters(!1);var i=e&&e.sender;this._reRender(this.appendExtraInfoToRenderOptions(t,e)),this.renderFocused(!i||i===this.ownerWidget.id),this.filterIndicator&&this.filterIndicator.update()}},onChangePendingFilter:function(){this.visModel.setPendingFilters(!0)},_isViewSlotsEmpty:function(){return!this.visualization.getSlots().getMappedSlotList().length&&this.visModel.getLocalFilters().isEmpty()},_annotationHasChanged:function(e){var t=e&&e.changeEvent&&e.changeEvent.prevValue,i=e&&e.changeEvent&&e.changeEvent.value;return!!(t&&t.selectedAnnotations&&t.selectedAnnotations.length||i&&i.selectedAnnotations&&i.selectedAnnotations.length)},onChangeAnnotations:function(e){if(this._annotationHasChanged(e)){return this._reRender(this.appendExtraInfoToRenderOptions({refresh:{dataIfQueryChanged:!0,annotation:!0},extraInfo:{annotationRequest:!0}},e))}return Promise.resolve()},onVisible:function(){},isVisible:function(){return this.$el.parent().is(":visible")},onChangeProperties:function(e){var i={name:"properties",value:e&&e.value,sender:null,changeEvent:e,refreshData:e&&e.origCollectionEvent&&e.origCollectionEvent.dataRefresh},n={refresh:{}};(i&&i.refreshData||n.refresh.data)&&t.isEmpty(n.refresh)&&(n.refresh.data=!0);var a=this.appendExtraInfoToRenderOptions(n,i);this._reRender(a)},onEnterContainer:function(){},onExitContainer:function(){},updateAnimationSettings:function(e){var t=e&&e.animationSpeed?e.animationSpeed:0;this.animationSpeed=t||this.DEFAULT_ANIMATION_SPEED,0===this.overrideDefaultAnimationSpeed||this.visModel.getSuppressViewAnimations()?this.animationSpeed=0:this.overrideDefaultAnimationSpeed>0&&0===t&&(this.animationSpeed=this.overrideDefaultAnimationSpeed)},isAnimationEnabledForNonVIPRVisualizations:function(){return this.animationType&&this.animationType!==this.ANIMATION_TYPES.NONE},animate:function(t){var i=this;if(this.visModel.renderCompleteBeforeAnimation(),this.isAnimationEnabledForNonVIPRVisualizations()){this.updateAnimationSettings(),e(this.el).fadeOut(0),e(this.el).fadeIn(this.animationSpeed,(function(){i.visModel.renderComplete(t)}))}},renderSelected:function(){},renderFocused:function(){},render:function(e,t){return void 0===t&&(t=!1),this.animate(e),t&&!this.isAnimationEnabledForNonVIPRVisualizations()&&this.visModel.renderComplete(e),Promise.resolve(this)},removeIconView:function(){this._removeMissingDataColumnWarning(),this.$iconView&&(this.$el.find('div[role="application"]').removeClass("hide"),this.$el.parent().removeClass("showIconView"),this.$iconView.remove(),this.$iconView=null),this._removeVisualizationDropZones()},_removeVisualizationDropZones:function(){var e=this.content.getFeature("DropZonesOverlayState");e&&e.hide()},_renderWarningContainer:function(t){this._removeWarningContainer(),this.$warningContainer=e("<div></div>",{class:"warningContainer"}),t.append(this.$warningContainer)},_removeWarningContainer:function(){this.$warningContainer&&(this.$warningContainer.remove(),this.$warningContainer=null)},_renderMissingDataColumnWarning:function(t){this._removeMissingDataColumnWarning(),this.hasMissingFilters()&&this.filterIndicator&&this.filterIndicator.$filter&&this.filterIndicator.$filter.addClass("dataWidgetFiltersNone"),this.$dataUnavailable=e("<div></div>",{class:"data-unavailable"}),this._renderWarningContainer(t),this.$warningContainer.append(this.$dataUnavailable);var i=e("<div></div>",{"aria-label":o.get("warning"),class:"warningIcon"});this.$dataUnavailable.append(i),s.setIcon(i,p.default.id,o.get("warning"));var n=e("<div></div>",{class:"warningText",text:o.get("datasetItemsUnavailable")});this.$dataUnavailable.append(n)},_removeMissingDataColumnWarning:function(){!this.$dataUnavailable||this.hasUnavailableMetadataColumns()||this.hasMissingFilters()||(this.$dataUnavailable.remove(),this.$dataUnavailable=null),this._removeWarningContainer()},renderIconView:function(){this._tabs&&this._tabs.hide();var e=this._prepareRenderIconView();this._renderIconView(e),this._renderVisualizationDropZones()},_renderVisualizationDropZones:function(){var e=this.content.getFeature("DropZonesOverlayDOM"),t=this.content.getFeature("DropZonesOverlayState");t&&!this.hasMissingFilters()&&(e.isMounted()?t.show():e.render())},updateSmartsIndicators:function(){var e=this,t=this.content.getFeature("SmartAnnotationProvider.suggestions");return t&&t.whenReady().then((function(){var t=e.content.getFeature("SmartsIndicator");t&&t.update();var i=e.content.getFeature("ForecastIndicator");i&&i.update()}))},updateFPDIndicator:function(){var e=this.content.getFeature("SmartsIndicator");e&&e.update()},updateInsightsIndicator:function(){var e=this.content.getFeature("InsightsIndicator");e&&e.update()},onInsightsReady:function(){this.updateInsightsIndicator()},_renderIconView:function(e){e.append(this.$iconView),this.$el.find('div[role="application"]').addClass("hide"),this.$el.parent().addClass("showIconView"),this.visModel.renderCompleteBeforeAnimation(),this.visModel.renderComplete()},getContentNode:function(){return this.contentNode?e(this.contentNode):this.$el},_prepareRenderIconView:function(){var t=this.visualization.getDefinition(),n=t.getPlaceholderIconUri(),a=t.getLabel(),s=this.getContentNode();this.hasUnavailableMetadataColumns()||this.hasMissingFilters()?this._renderMissingDataColumnWarning(s):this.$dataUnavailable&&this._removeMissingDataColumnWarning();var r=i.template(l);return this.$iconView&&this.$iconView.remove(),this.$iconView=e(r({icon:n,caption:a,title:o.get("LIVE_empty_visualization_hint_title"),description:o.get("LIVE_empty_visualization_hint_description")})),s},hasMissingFilters:function(){return this.ownerWidget.getUnavailableLocalFilter().length>0},resizeToWidget:function(e){this.resize(e.widgetSize)},getLabel:function(){var e=this.visualization.getDefinition();return e?e.getLabel():o.get("visualizationLabel")},getDescription:function(){var e=this.getLabel(),t=this._getColumnInformationForLabel();return o.get("dataWidgetDescription",{widgetLabel:e,columnNames:t})},_getColumnInformationForLabel:function(){for(var e="",t=this.visualization.getSlots().getMappingInfoList(),i=0;i<t.length;i++)i>0&&(e+=", "),e+=t[i].dataItem.getLabel();return e},getCurrentViewSelector:function(){return null},getProperties:function(){return this.visModel.getDefinition().properties?Promise.resolve(this.visModel.getDefinition().properties.slice(0)):Promise.resolve([])},hasBinnedDataItems:function(){return!!this.visualization.getSlots().getMappingInfoList().find((function(e){return!!e.dataItem.getBinning()}))},generateThumbnail:function(){var e=this,t=!1,i=!1;return this._isThumbnailDisabled()&&(t=!0),this.isMappingComplete()||(i=!0),(t||i?Promise.resolve():this.dashboard.getDashboardSvc(".Thumbnail").then((function(t){return t.generateMarkup(e.$el.get(0))}))).then((function(e){return{isMappingIncomplete:i,isDisabled:t,thumbnail:e}}))},_isThumbnailDisabled:function(){if(u.isIE()&&!u.isIEEdge()){var e=this.visModel.getDefinition();if(e&&e.thumbnailConfig){var t=e.thumbnailConfig.unsupportedBrowsers;return-1!==(void 0===t?[]:t).indexOf("IE")}}return!1},onSummaryDataCellError:function(){var e=o.get("errorCellWarning");this.infoIndicator.update([{id:"error_summary_cell",title:e,items:[{id:"error_summary_cell",label:e,isSubMessage:!0}]}])},appendExtraInfoToRenderOptions:function(e,i,n){if((i=i&&i.changeEvent||i)&&i.data&&(e.extraInfo?e.extraInfo.payloadData=i.data:e.extraInfo={payloadData:i.data}),e&&e.extraInfo&&n&&(e.extraInfo=t.extend(e.extraInfo,n)),i&&i.transactionToken){var a=e.extraInfo,o=void 0===a?{}:a;t.isEmpty(o)&&(e.extraInfo=o);var s=o.payloadData,r=void 0===s?{}:s;t.isEmpty(r)&&(e.extraInfo.payloadData=r),r.transactionToken=i.transactionToken}return e}});return m})),define("dashboard-analytics/dataSources/ModuleUtils",["underscore"],(function(e){"use strict";var t={SHAPING:{DATAITEM_CHANGED:0},updateDataItemId:function(e,t){var i=e,n=i.split(".");return i.replace(n[0],t)},getColumnPropertyValue:function(t,i){var n;return t.moserObject.getProperty&&(n=e.find(t.moserObject.getProperty(),(function(e){return e.getName()===i}))),n?n.getValue():null}};return t})),define("dashboard-analytics/widgets/livewidget/query/ServiceBase",["../../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e){"use strict";var t=e.extend({init:function(){t.inherited("init",this,arguments),this._requestIdTracking={}},getRequestId:function(e){return e&&this._requestIdTracking[e]||0},updateRequestId:function(e){return e?this._requestIdTracking[e]=this.getRequestId(e)+1:0},isActiveRequest:function(e,t){return e===this.getRequestId(t)}});return t})),define("dashboard-analytics/widgets/livewidget/query/QueryService",["./ServiceBase","underscore"],(function(e,t){"use strict";var i=e.extend({init:function(e){i.inherited("init",this,arguments),this.dashboardApi=e.dashboardApi,this.ajaxSvc=this.dashboardApi.getGlassCoreSvc(".Ajax"),this.logger=this.dashboardApi.getGlassCoreSvc(".Logger"),this.queryParameters=null},_querySpecString:function(e,i){t.isNumber(e.dataRowLimit)&&(e.querySpec.limit=e.dataRowLimit),this.queryParameters&&(e.querySpec.parameterValues=this.queryParameters);var n=i&&i.getMetadataSubsetIds();return n&&n.length>0&&(e.querySpec.queryHints=t.extend(e.querySpec.queryHints||{},{metadataSubsetIDs:n})),this.isMockServer?"\\Q"+JSON.stringify(e.querySpec)+"\\E":JSON.stringify(e.querySpec)},runQuery:function(e){return this._sendRequest(e,this.getRequestId(e.sender))},_sendRequest:function(e,i){var n=this;return e.querySpec.parameterValues||(this.queryParameters=null),this._getModule(e.sourceIdOrModule).then((function(t){var i=n._querySpecString(e,t),a=n.dashboardApi.getService(".UserProfile").userAccount,o=a&&a.id;return n._getDataSourceModifiedTime(e.sourceIdOrModule).then((function(n){return t.queryData(i,{senderId:e.senderId,lastModified:n,queryUserId:o,qfb:e.requestOptions&&e.requestOptions.qfb||"none",qfbMode:e&&e.requestOptions.qfbMode||void 0,ipaMode:e&&e.requestOptions.ipaMode||void 0,getAdditionalHeaders:e.requestOptions.getAdditionalHeaders})}))})).then((function(a){var o=a?a.data:null,s=a?a.getResponseHeader("ETag"):null,r=a?a.getResponseHeader("x-ca-requesttime"):null,l=a?a.getResponseHeader("zipi.id"):null;return n.isActiveRequest(i,e.sender)?{data:o,requestTime:r,ETag:s,zipiId:l}:Promise.reject(t.extend(new Error,{reason:"staleRequest"}))})).catch((function(e){return Promise.reject(e)}))},_getModule:function(e){var t=this;return"function"==typeof e.queryData||"function"==typeof e.queryPredictData?Promise.resolve(e):this.dashboardApi.getFeature("dataSources.deprecated").getModule(e).then((function(i){i||(i=t.dashboardApi.getFeature("DataSets.internal").getModule(e));return i||Promise.reject(new Error("Data source with ID "+e+" not found."))}))},_getDataSourceModifiedTime:function(e){var t=this.dashboardApi.getFeature("DataSources").getDataSource(e);if(!t&&!(t=this.dashboardApi.getFeature("DataSets.internal").getDataSource(e)))return Promise.reject(new Error("Datasource with source ID: "+e+" not found"));return t.getModificationTime()},runGeoQuery:function(e,t){return this.logger.debug("runGeoQuery"),this.ajaxSvc.ajax({url:t||"v1/geo/~",type:"POST",headers:{"Content-Type":"application/json"},data:JSON.stringify(e),processData:!1}).then((function(e){return e.data}))},runTopBottomQuery:function(e){return this.runQuery(e)}});return i})),define("dashboard-analytics/widgets/livewidget/query/QueryFilterSpec",["jquery","../../../lib/@waca/core-client/js/core-client/ui/core/Class","../../../filters/Filters","../../../filters/FilterEntry","underscore"],(function(e,t,i,n,a){"use strict";return t.extend({init:function(e){var t=e||[];this._queryFilterSpec=[],this._dataItemsMap={},a.each(a.values(t),function(e){a.each(e,function(t){var i=t.dataItemAPI;this._dataItemsMap[n.prototype.determineIdValue(i.getItemId(),i.getAggregationType())]=e}.bind(this))}.bind(this))},addFiltersToSpec:function(e,t){t=t||{},this.addColumnFiltersToSpec(this._mergeEdgeAndPointFiltersOnSameColumns(e,t),t)},addColumnFiltersToSpec:function(e,t){this._queryFilterSpec=this._queryFilterSpec.concat(this._toSpec(e,t))},getFilterSpec:function(){return this._queryFilterSpec},hasFilterSpec:function(){return this._queryFilterSpec.length>0},_isFilterEntryEmpty:function(e){return!e.valueDataItem&&!e.conditions&&e.values&&e.values.isEmpty()&&"notin"!==e.operator},_isFilterException:function(e,t,i,n){if(this._isFilterEntryEmpty(e))return!0;if(e.isOrdinalFilter()){var o=this._dataItemsMap[e.id];if(o){if(!a.find(o,(function(e){return e.layerId===n.layerId})))return!0}else if(n.excludeNonProjectedRangeFilters)return!0}return t[e.columnId]||t[e.id]||i&&e.isCompound()&&e.compoundFilterMatches(t)},_mergeEdgeAndPointFiltersOnSameColumns:function(t,n){var a=this._prepareDataToMergeEdgeAndPointFiltersIfNeeded(t,n);if(!a)return t;var o=new i;return t.each(function(e){if(e.isCompound()){var i=this._createFinalCompoundFilter(t,e,a);o.add(i,{silent:!0})}}.bind(this)),t.each(function(t){if(t.isOrdinalFilter()||!t.isCompound()&&a.unprocessedSimpleColumnIdMap[t.columnId]){var i=e.extend(!0,{},t);o.add(i,{silent:!0})}}.bind(this)),o},_createFinalCompoundFilter:function(t,i,o){var s=new n(i.toJSON());return s._compoundFilterFromJSON(),"or"===i.operator&&a.each(o.compoundFilterColumnIds,function(i){var n=t.getCategoryFilterKey(i),a=t.get(n);if(a){o.unprocessedSimpleColumnIdMap[i]=void 0;var r=e.extend(!0,{},a);s.values.add(r,{silent:!0})}}.bind(this)),s},_prepareDataToMergeEdgeAndPointFiltersIfNeeded:function(e,t){var i=e.getSelectedCompoundFilterColumnIds();if(0===i.length)return null;var n=e.getSelectedSimpleFilterColumnIds();if(0===n.length)return null;var o=a.intersection(n,i);if(0===o.length)return null;if(t.edgeFilterExceptions&&0===a.difference(o,t.edgeFilterExceptions).length)return null;var s={};return a.each(n,function(e){s[e]=e}.bind(this)),{simpleColumnIds:n,compoundFilterColumnIds:i,unprocessedSimpleColumnIdMap:s}},_getAssociatedDataItem:function(e,t){var i=null;return e.isRangeOperator()&&this._dataItemsMap[e.id]&&(i=a.find(this._dataItemsMap[e.id],(function(i){return i.layerId===t&&i.dataItemAPI.getAggregationType()===e.aggregationType}))),i&&i.dataItemAPI||null},_toSpec:function(e,t){var i=this._prepareFilterExceptionsMap(t),n=[];return e.each(function(e){if(!this._isFilterException(e,i,!(!t||!t.filterExceptions),t)){var o=e.toQuerySpec({associatedDataItemAPI:this._getAssociatedDataItem(e,t.layerId),shouldApplyIsNullValueExpression:t.shouldApplyIsNullValueExpression,addExtraQueryDataItem:t&&t.addExtraQueryDataItem});a.isEmpty(o.expression)||(t&&t.dsf&&(o.dsf=t.dsf),n.push(o))}}.bind(this)),n},_prepareFilterExceptionsMap:function(e){var t=e&&(e.filterExceptions||e.edgeFilterExceptions)||[],i={};return a.each(t,(function(e){i[e]=[]})),i}})})),define("dashboard-analytics/visualizations/vipr/VIPRDataRequestHandler",["underscore","../../lib/@waca/core-client/js/core-client/ui/core/Class","../../dataSources/ModuleUtils","../../widgets/livewidget/query/QueryService","../../widgets/livewidget/query/QueryFilterSpec","../../widgets/livewidget/nls/StringResources","./VIPRUtils"],(function(e,t,i,n,a,o,s){"use strict";return t.extend({CATALYST_OP:{KEYDRIVER:"GetKeyDrivers",DECISIONTREE:"GetDecisionTree"},GEO_AMBIGUOUS_ID:"geo_ambiguous",GEO_UNMATCHED_ID:"geo_unmatched",PREDICT_ERROR_ID:"predict_error",PREDICT_WARNING_ID:"predict_warning",TILED_MAP_ATLAS:"tiledMap_atlas",TYPE_ATLAS:"atlas",_lastRequestData:{},init:function(e){this.logger=e.logger,this.visAPI=e.visAPI,this.content=e.content,this.smartAnnotations=this.content.getFeature("SmartAnnotations.deprecated"),this.visView=e.visView,this.dashboardApi=this.visAPI.ownerWidget.getDashboardApi(),this.queryService=new n({dashboardApi:this.dashboardApi}),this._callbacks={Atlas:this._geoQueryCallback.bind(this),MapPolygons:this._geoQueryCallback.bind(this),Catalyst:this._fastPredictCallback.bind(this)},this._customData=e.customData||null},resetCustomData:function(){this._customData=null},_geoQueryCallback:function(t,i){if(t&&t.infoIndicator&&i){var n=[{id:this.GEO_AMBIGUOUS_ID,property:"ambiguous",resourceId:"geomapAmbiguousLocations"},{id:this.GEO_UNMATCHED_ID,property:"unmatched",resourceId:"geomapUnrecognizedLocations"}];t.infoIndicator.update(e.map(n,(function(t){return{id:t.id,label:o.get(t.resourceId),items:e.map(i[t.property],(function(e){return{id:"_"+e.replace(/\s/g,"_"),label:e}}))}})))}},_addErrorsAndWarningsForCandidates:function(t,i,n){e.each(i,(function(i){var a=n[i.property];a&&a.length&&t.infoIndicator.update([{id:i.id,label:o.get(i.resourceId),items:e.map(a,(function(e){return{id:e.id,label:e.caption}}))}])}))},_addFPDInsightMessages:function(e){if(s.doesConfigPropertyMatchExpected(this.visAPI.getVisId(),"shouldLogFPDInsightMessages",!0)&&this.smartAnnotations){var t=null;e&&e.messages&&e.messages.length>0&&(t=e.messages),this.smartAnnotations.addFPDInsightMessages(t),this.visView.updateFPDIndicator()}},_fastPredictCallback:function(e,t){if(e&&e.infoIndicator&&t&&t.predictStatus){this._addFPDInsightMessages(t.predictStatus);var i=t.predictStatus,n=[{id:this.PREDICT_ERROR_ID,property:"errors",resourceId:"predict_errors"},{id:this.PREDICT_WARNING_ID,property:"warnings",resourceId:"predict_warnings"}];this._addErrorsAndWarningsForCandidates(e,n,i)}},request:function(e){switch(e.name){case"Schematics":this._handleSchematicRequest(e);break;case"Atlas":case"MapPolygons":this._handleGeoRequest(e);break;case"Catalyst":this._handleKeyDriversRequest(e);break;default:this._requestFail(e)}},_logNotification:function(e,t,i){var n=this;switch(e){case"warn":this.logger.warn(t),i&&i.truncations&&i.truncations.forEach((function(e){n.logger.warn(e.toString())}));break;case"error":this.logger.error(t),i&&i.truncations&&i.truncations.forEach((function(e){n.logger.error(e.toString())}))}},_addNotifyMessagesToInfoIndicator:function(t,i,n,a,s){var r=this;if(this.visView&&this.visView.infoIndicator&&i){var l=[];l.push(this._getMessageLabel(i,!1,a,s)),n&&n.truncations&&n.truncations.forEach((function(e){(function(e){l.push(this._getMessageLabel(e,!0))}).bind(r)(e.toString())})),this.visView.infoIndicator.update(e.map([{id:"visualization_notifications",property:"visualizationnotifications",resourceId:"visualizationNotifications"}],(function(e){return{id:e.id,label:o.get(e.resourceId),items:l}})))}},_getMessageLabel:function(e,t,i,n){return{id:i||"_"+e.replace(/\s/g,"_"),type:n,label:e,isSubMessage:t||!1}},_isNotificationAGeoWarning:function(e,t){return"warn"===e&&t===this.TILED_MAP_ATLAS},notify:function(e){this._logNotification(e.level,e.localizedMessage,e.payload),"clear"===e.type?this._clearIndicatorWarning(e):this._isNotificationAGeoWarning(e.level,e.id)||this._addNotifyMessagesToInfoIndicator(e.level,e.localizedMessage,e.payload,e.id,e.type)},_clearIndicatorWarning:function(e){var t=this,i=this.visView.infoIndicator;i&&e.payload&&e.payload.length&&e.payload.forEach((function(e){e.id===t.TILED_MAP_ATLAS&&e.type===t.TYPE_ATLAS?i.clearMessagesWithIds([t.GEO_AMBIGUOUS_ID,t.GEO_UNMATCHED_ID]):i.clearMessagesByIdAndSubtype(e)}))},_setDefaultSelections:function(){if(this.dashboardApi.getConfiguration("enableCustomDataSelection")||s.supportsCustomDataSelection(this.visAPI.getVisId())){var e=this.visAPI.getDecoratedCustomData("selected");if(0===e.length&&this._customData.length>0){var t=this._customData[0],i=[],n=[];t.hasOwnProperty("valueFloored")?n=(i=this._customData.filter((function(e){return e.valueFloored===t.valueFloored}))).map((function(e){return{id:e.id,value:!0}})):(i.push(t),n.push({id:t.id,value:!0})),this.visAPI.setCustomDataDecoration("selected",n,{silent:!0}),e.push.apply(e,i)}e.forEach(function(e){e.setDecoration&&e.setDecoration("selected",!0)}.bind(this))}},setCustomData:function(e){this._customData=e.getItems().map((function(e){return e.payload})),this._setDefaultSelections()},getCustomData:function(){return this._customData},_invokeCallback:function(e,t){var i=this._callbacks[e];i&&i(this.visView,t)},_requestComplete:function(e,t,i){if(void 0===i&&(i=!0),i&&this.setLastRequestData(e.name,t),"Catalyst"===e.name){var n=this._getCatalystOperation(e),a=this._getFastPatternDetectionMethods(n);t=this._filterPredictResults(t,a),this.visView.filterIndicator&&this.visView.filterIndicator.update()}this._invokeCallback(e.name,t),e.complete(t)},_requestFail:function(e,t,i){void 0===i&&(i=!0),i&&this.setLastRequestData(e.name,null),this._invokeCallback(e.name,t),e.fail(t)},setLastRequestData:function(e,t){this._lastRequestData[e]=t},getLastRequestData:function(e){return this._lastRequestData[e]},_handleSchematicRequest:function(e){var t=this,i=this.visView.visualization.getDefinition().getProperty("getSchematicContent");if(i&&e.payload)return i(e.payload,this.dashboardApi).then((function(i){t._requestComplete(e,i)}),(function(i){t._requestFail(e,i)}));this._requestFail(e,new Error(o.get("schematicServiceRequestError")))},_getGeoEndpoint:function(){var e=this.dashboardApi.getConfiguration("geoService");return"CA"===e?null:e},_handleGeoRequest:function(e){var t=this.visView.infoIndicator;t&&t.clearMessagesWithIds([this.GEO_AMBIGUOUS_ID,this.GEO_UNMATCHED_ID]),this.queryService.runGeoQuery(e.payload,this._getGeoEndpoint()).then(function(t){e.payload.useMapBoxPB&&Object.defineProperty(t,"results",Object.getOwnPropertyDescriptor(t,"mapboxData")),this._requestComplete(e,t)}.bind(this),function(t){this._requestFail(e,t)}.bind(this))},_getCatalystOperation:function(e){return e&&e.payload&&e.payload.catalystOperation},_getFastPatternDetectionMethods:function(e){return e===this.CATALYST_OP.DECISIONTREE?["tree"]:["drivers","tree"]},_handleErrorPossibleKeyDriverRequest:function(e,t){var i=this.visAPI.ownerWidget.getCurrentVis();if(i&&i.infoIndicator){var n=t.error.caption,a=t.error&&t.error.categoryId?t.error.categoryId:"predict_error";i.infoIndicator.update([{id:a,label:o.get(a),items:[{id:"_"+n.replace(/\s/g,"_"),label:n}]}])}this._requestComplete(e,{result:[],predictStatus:{}})},_handleEmptyPossibleKeyDriverRequest:function(e){this._requestComplete(e,{result:[],predictStatus:{}})},_fpdRequestFailed:function(e,t){if(this.visView&&this.visView.infoIndicator){var i={label:o.get("predict_errors"),id:this.PREDICT_ERROR_ID,items:[]};t&&t.errors&&t.errors.length?t.errors.forEach((function(e){i.items.push({id:e.code,label:e.message})})):i.items.push({id:t&&t.code||500,label:o.get("catalyst_service_error")}),this.visView.infoIndicator.update([i])}this._requestFail(e,new Error(o.get("catalyst_service_internal_server_error")))},_handleKeyDriversRequest:function(e){var t=this,i=this.visView.infoIndicator;i&&i.clearMessagesWithIds([this.PREDICT_ERROR_ID,this.PREDICT_WARNING_ID]);var n=this._getTargetId(e),a=this._getCatalystOperation(e),o=this._getFastPatternDetectionMethods(a),s=this.content.getFeature("VisKeyDrivers"),r=s.getEnabledPossibleKeyDrivers(n);if(r.errorState&&r.errorState.inErrorState)this._handleErrorPossibleKeyDriverRequest(e,r.errorState);else{var l=r.possibleKeyDrivers;try{(s?s.executeFastPatternDetectionRequest(n,l,o,null,this.visAPI.ownerWidget.isPreview):this.visAPI.executeFastPatternDetectionRequest(n,l,o)).then((function(i){t._requestComplete(e,i)}),(function(i){t._fpdRequestFailed(e,i&&i.data)}))}catch(e){this.logger.error(e)}}},_getValidPredictResultTypes:function(t){var i=[];return e.each(t,(function(e){switch(e){case"tree":i.push("TREE");break;case"oneway":i.push("ONE_WAY");break;case"twoway":i.push("TWO_WAY");break;case"drivers":i.push("ONE_WAY"),i.push("TWO_WAY")}})),i},_filterPredictResults:function(t,i){var n=this._getValidPredictResultTypes(i);return n&&n.length>0&&(t.results=e.filter(t.results,(function(e){return n.indexOf(e.type)>-1}))),t},_getTargetId:function(e){var t,n=e.payload.catalystPayload.target,a=this.visAPI.getModule().getMetadataColumns((function(e){return e.getId()===n}));return a.length&&(t=i.getColumnPropertyValue(a[0],"wa_attributeUniqueName")),t||n},_addLocalFiltersToRequest:function(e){var t=this._getWidgetLocalFilters();t&&(e.sessionShapingChange=!0,e.localFilters=this._normalizeFilters(t))},_getWidgetLocalFilters:function(){var e=this.visAPI.getLocalFilters(),t=new a;return t.addFiltersToSpec(e),t.hasFilterSpec()?t.getFilterSpec():null},_normalizeFilters:function(t){var i=[];e.each(t,function(e){e=this._doSort(e),i.push(JSON.stringify(e))}.bind(this)),i.sort();var n=[];return e.each(i,(function(e){n.push(JSON.parse(e))})),n},_doSort:function(t){var i,n=[],a=e.keys(t);a&&a.length>1&&a.sort();for(var o=0;o<a.length;o++){var s=a[o];i="values"===s?t.values.sort():"object"==typeof t[s]?this._doSort(t[s]):t[s];var r={};r[s]=i,n.push(r)}return this._toSortedObject(n)},_toSortedObject:function(t){return e.extend.apply(null,t)}})})),define("dashboard-analytics/visualizations/vipr/VIPRCachedDataRequestHandler",["underscore","./VIPRDataRequestHandler"],(function(e,t){var i=t.extend({init:function(e){i.inherited("init",this,arguments),this.handler=e.handler},request:function(t){if(!this.handler)return i.inherited("request",this,arguments);var n=this.handler.getLastRequestData(t.name);if(!n)return i.inherited("request",this,arguments);var a=e.clone(n);this._requestComplete(t,a)},_requestComplete:function(e,t){return i.inherited("_requestComplete",this,[e,t,!1])},_requestFail:function(e,t){return i.inherited("_requestFail",this,[e,t,!1])},_invokeCallback:function(){}});return i})),define("dashboard-analytics/visualizations/renderer/vipr3/components/CustomVisPreviewMessage",["react","react-dom","prop-types","@ba/ba-ui-carbon-toolkit","../../../../widgets/livewidget/nls/StringResources"],(function(e,t,i,n,a){var o=e.Component,s=n.FlexLayout,r=n.FlexItem,l=n.Label,c=n.SVGIcon,u=function(t){function i(e){var i;return(i=t.call(this,e)||this).getInformation16=e.iconsFeature.getIcon("getInformation"),i}return _inheritsLoose(i,t),i.prototype.render=function(){return e.createElement(s,{direction:"row",fullHeight:!0,justifyContent:"center"},e.createElement(r,null,e.createElement(s,{wrap:"wrap",direction:"row"},e.createElement(r,null,e.createElement(c,{iconId:this.getInformation16.id,verticalAlign:"middle",className:"customVisInfoIcon"})),e.createElement(r,{wrap:"wrap","white-space":"normal"},e.createElement(l,{label:a.get("extVisPreviewMessage")})))))},i}(o);return u.propTypes={iconsFeature:i.object.isRequired},u})),define("dashboard-analytics/visualizations/renderer/vipr3/VIPRView",["jquery","underscore","./VIPREventTarget","../VisView","../VisEventHandler","dashboard-analytics/visualizations/vipr/VIPR","dashboard-analytics/visualizations/vipr/VIPRUtils","dashboard-analytics/visualizations/vipr/VIPRDataRequestHandler","dashboard-analytics/visualizations/vipr/VIPRCachedDataRequestHandler","dashboard-analytics/visualizations/vipr/properties/VIPRProperties","dashboard-analytics/visualizations/vipr/properties/ColorPropertiesCreator","dashboard-analytics/visualizations/vipr/VIPRConfig","../../../lib/@waca/core-client/js/core-client/utils/BrowserUtils","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/core-client/js/core-client/utils/PerfUtils","../../../widgets/livewidget/SdkShowError","react-dom","react","./components/CustomVisPreviewMessage","../../../util/ContentUtil","dashboard-analytics/widgets/livewidget/util/VisUtil"],(function(e,t,i,n,a,o,s,r,l,c,u,d,h,p,g,m,f,v,_,b,y){"use strict";var I={optimizeSize:!0,"gridLines.visible":!1,"markers.visible":!1,"widget.legend.size":0,"labels.visible":!1,"itemAxis.line.visible":!1,"valueAxis.line.visible":!1,"valueAxis.ticks.visible":!1,"itemAxis.ticks.visible":!1,"itemAxis.gridLines.visible":!1,"valueAxis.gridLines.visible":!1},C=["compareLine","lines"],S=n.extend({initVizPromise:null,init:function(t){S.inherited("init",this,arguments),this.$el.attr("id",this.viewId),this.$el.addClass("dataview vipr-view"),this.colorsService=this.dashboard.getFeature("Colors"),this.visAPI=t.visModel,this.predictHandler=this._createPredictHandler(r),this.highContrastEnabled=e(document.body).hasClass("highcontrast"),this.internalVisDefinitions=this.dashboard.getFeature("VisDefinitions.internal"),this.visModel.getShowTitle()&&(this._hasUserTitle=!0,this._hasAnnotationTitle=!1),this.visController={},this.viprDecorations={},this.dataItemDecorations={},this._deferredDestroyViprWidgetsList=[],this.viprControlRenderInProgress=!1,this.colorsService.on("theme:changed",this.onThemeChange,this);var i=this.dashboard.getGlassCoreSvc&&this.dashboard.getGlassCoreSvc(".FeatureChecker");this.isPropertiesV2Enabled=i&&i.checkValue("dashboard","PropertiesV2","enabled"),this.isElementStyleActionEnabled=i&&!i.checkValue("dashboard","ElementStyleAction","disabled"),this.smartAnnotations=this.content.getFeature("SmartAnnotations.deprecated")},createView:function(){S.inherited("createView",this,arguments),this.visModel.on("change:theme",this.onChangeTheme,this),this.visModel.on("change:titleMode",this.onShowTitle,this),this.visModel.on("change:customData",this.onChangeCustomData,this)},_createPredictHandler:function(e,t){var i={content:this.content,visAPI:this.visAPI,visView:this,logger:this.logger};return t&&(i.handler=t,"function"==typeof t.getCustomData&&(i.customData=t.getCustomData())),new e(i)},onChangeCustomData:function(e){var t=(e.prevValue&&e.prevValue.selected||[]).map((function(e){return e.id}));return this.visAPI.getCustomData(t).forEach((function(e){e.setDecoration&&e.setDecoration("selected",!1)})),this.visAPI.getDecoratedCustomData("selected").forEach((function(e){e.setDecoration&&e.setDecoration("selected",!0)})),this.renderVIPRControl({callRenderComplete:!0})},_createVisTabs:function(){var e=this;if(this._tabs){this._tabs.reset();var i=this.visModel.getDefinition();i.tabs&&this._tabs.createTabs(t.map(i.tabs.entries,(function(t){return{id:t.id,label:p.get(t.resource),onChange:function(e){this.visModel.ownerWidget.updateVisProperties({id:"actions",value:e})}.bind(e)}})),this.visModel.getPropertyValue("actions")||i.tabs.default),this._tabs.hide()}},getDecoratorAPI:function(e){var t=this;if(e=e||0,!this.viprData||e>this.viprData.getDataSetCount()||!this._isViprWidgetValid())return null;var i=this.viprData.getDataSetAt(e);return i?{decorateItem:function(n,a,o){t.dataItemDecorations[e]||(t.dataItemDecorations[e]={}),t.dataItemDecorations[e][n]||(t.dataItemDecorations[e][n]={});var s=i.getDataItem(n),r=s&&s.decorate(a,o);t.dataItemDecorations[e][n][a]=r},decoratePoint:function(e,t,n){var a=null,o=i.getDataPoint(e);return o&&o.decorate&&(a=o.decorate(t,n)),a},decorate:function(e,t){return i.decorate(e,t)},clearItemDecoration:function(n){var a;if(t.dataItemDecorations[e])for(a in t.dataItemDecorations[e]){var o=i.getDataItem(a);o&&o.decorate(n,void 0),delete t.dataItemDecorations[e][a][n]}},updateDecorations:function(){return t.renderVIPRControl()}}:null},getDecoratorAPIs:function(){var e=[];if(this.viprData&&this.viprData.getDataSetCount)for(var t=0;t<this.viprData.getDataSetCount();++t){var i=this.getDecoratorAPI(t);i&&e.push(i)}return e},onChangeDefinition:function(){this.initVizPromise=null,S.inherited("onChangeDefinition",this,arguments),this.infoIndicator&&this.infoIndicator.reset(),this.propChangeslistener&&(this.propChangeslistener=void 0),this._createVisTabs()},remove:function(e){void 0===e&&(e=!0),this.visModel.off("change:theme",this.onChangeTheme,this),this.visModel.off("change:titleMode",this.onShowTitle,this),this.visModel.off("change:customData",this.onChangeCustomData,this),this.colorsService.off("theme:changed",this.onThemeChange,this),this._cleanupVIPRWidget(e),S.inherited("remove",this,arguments)},_cleanupVIPRWidget:function(e){void 0===e&&(e=!0),this.eventHandler&&this.eventHandler.remove(),this.$customVisPreviewMessage&&(f.unmountComponentAtNode(this.$customVisPreviewMessage[0]),this.$customVisPreviewMessage.remove(),this.$customVisPreviewMessage=null),this._destroyCustomVisShowError(),this.viprWidget&&(e&&!this.viprControlRenderInProgress?(this.viprWidget.destroy(),this.viprWidget=null):-1===this._deferredDestroyViprWidgetsList.indexOf(this.viprWidget)&&this._deferredDestroyViprWidgetsList.push(this.viprWidget)),this.viprData&&e&&(this.viprData.destroy(),this.viprData=null)},_destroyCustomVisShowError:function(){this.sdkShowError&&(this.sdkShowError.destroy(),this.sdkShowError=null)},_deferredDestroyVIPRWidgets:function(){t.each(this._deferredDestroyViprWidgetsList,(function(e){e.destroy()})),this._deferredDestroyViprWidgetsList=[]},_createVIPRWidget:function(){var n=this;if(!this.viprWidget){var r="VIPR_"+this.viewId;this.$el.append(e('<div id="'+r+'" style="width:100%; height:100%" role="application"></div>'));var c=s.getCursor(this.visAPI.getVisId());c&&t.forEach(c,(function(e){n.$el.get(0).style.cursor=e})),this.predictData&&(this.predictHandler.setLastRequestData("Catalyst",this.predictData),this.predictHandler=this._createPredictHandler(l,this.predictHandler)),this.viprWidget=o.createWidget(r,this.predictHandler);var u=this.dashboard.getGlassCoreSvc(".UserProfile");u&&(this.viprWidget.formatLocale=u.preferences.contentLocale),this.eventHandler=new a({target:new i({$el:this.$el,viprWidget:this.viprWidget,visAPI:this.visAPI,visualization:this.visualization,content:this.content}),dashboardSettings:this.dashboardSettings,transaction:this.transactionApi,logger:this.logger,ownerWidget:this.ownerWidget,visAPI:this.visAPI,dashboard:this.dashboard});var d=this._getVisualizationThemeToken();this.setTheme(d)}},onThemeChange:function(){var e=this._getVisualizationThemeToken();this.setTheme(e)},setTheme:function(e){this.viprWidget.setTheme(e)},_getVisualizationThemeToken:function(){var e=this.colorsService.getThemeDefinition(),i=e.getId(),n=s.getVidaThemeDefinition(i);if(t.isEmpty(n)){return e.getUIElement("visualization").reduce((function(e,t){return e[t.id]=t.value,e}),{})}return n},initialize:function(){var e=this;return this.initVizPromise||(this._createVIPRWidget(),this.initVizPromise=new Promise((function(t,i){e.viprWidget.newViz(e.visAPI.getVisId(),"client").then((function(i){e.viprData=null,e.vizBundle=i,t(e.visController)})).catch((function(t){if("visualizationPreview"===e.visAPI.getVisId())return e.logger.error(t,e),e.visController;i(t)}))}))),this.initVizPromise},createViprData:function(e){var t=this.dashboard.getFeature("Formatter"),i=s.createQueryResultData(e,this.visualization,this.content,t);return i.hasMoreData=e.hasMoreData,i.queryThreshold=e.queryThreshold,i},canRender:function(){return this._hasMappedSlots()&&this.isMappingComplete()},onDataReady:function(){var e=S.inherited("onDataReady",this,arguments);if(e.taskRefreshed&&e.taskRefreshed.data&&this.canRender()&&!this.hasUnavailableMetadataColumns()&&!this.hasMissingFilters()){var t=e.sameQueryData,i=void 0!==t&&t;this._dataObject=this.renderSequence.getTaskResult("data"),i||(this.predictHandler.resetCustomData(),this._viprSlotMapping=s.createSlotMapping(this.visualization))}return e},_setModelProperty:function(e,t){if(this._shouldPropertyBeApplied(e)){var i={id:e,value:this._getPropValueWhenSaving(t,e)};this.setProperty(i)}},_setPreDataProperties:function(){var e=this,t=this.visAPI.getVisId(),i=d.getConfig(t);i&&i.propertiesToSetBeforeData&&i.propertiesToSetBeforeData.length>0&&i.propertiesToSetBeforeData.forEach((function(i){e._setModelProperty(i,t)}))},onSetDataReady:function(e){var t=e.info&&e.info.renderContext?JSON.parse(JSON.stringify(e.info.renderContext)):{};if(t.taskRefreshed&&t.taskRefreshed.setData)if(!this.canRender()||this.hasUnavailableMetadataColumns()||this.hasMissingFilters()){var i=this.isMappingComplete()&&this.visualization.getSlots().getMappingInfoList().length>0;this.isRenderWithoutCompletingMapping()&&!i&&(this.viprWidget.setData(null),this.infoIndicator&&this.infoIndicator.reset())}else{var n=t.sameQueryData,a=void 0!==n&&n,o=t.extraInfo,r=void 0===o?{}:o,l=!!!(!r||!r.queryRefresh)&&!!a;(!this.viprData||!l)&&(this.viprWidget.properties&&this._setPreDataProperties(),this._dataObject=this.renderSequence.getTaskResult("data"),this._viprSlotMapping=s.createSlotMapping(this.visualization),this._dataObject?(this.viprData=this.createViprData(this._dataObject),this.viprWidget.setData(this.viprData,this._viprSlotMapping)):this.logger.error("Unable to create VIPR data in onSetDataReady"))}},_getAnnotationMessages:function(e){return e.getMessageList()||{}},onPreAnnotation:function(){S.inherited("onPreAnnotation",this,arguments),this.smartAnnotations.resetAnnotationRenderState()},onAnnotatedResultsReady:function(e){var t=this;S.inherited("onAnnotatedResultsReady",this,arguments);var i=e.info&&e.info.renderContext?JSON.parse(JSON.stringify(e.info.renderContext)):{};if(i.taskRefreshed&&i.taskRefreshed.annotation){var n=this.renderSequence.getTaskResult("annotation");if(n){var a=this.content&&this.content.getFeature("ViprPropertyProvider");a&&a.reset&&a.reset(),this._dataObject=n,this._dataObject.getQueryResultIdList().length&&(this.viprData=this.createViprData(this._dataObject),this.viprWidget.setData(this.viprData,this._viprSlotMapping)),this.smartAnnotations.setAnnotationMessages(this._getAnnotationMessages(n))}this.render(i,!0).then((function(){return t.smartAnnotations.annotationRenderComplete()}),(function(e){return t.smartAnnotations.annotationRenderError(e)}))}this.updateSmartsIndicators()},onShowTitle:function(e){this._hasUserTitle="noTitle"!==e.value,this._hasUserTitle&&(this._hasAnnotationTitle=!1)},animate:function(){},_readyForRender:function(){return(this.canRender()||this.isRenderWithoutCompletingMapping())&&!this.hasUnavailableMetadataColumns()&&!this.hasMissingFilters()},_updateViprProp:function(e,t){void 0!==e&&void 0!==t&&this.visModel.ownerWidget.updateVisProperties({id:e,value:t&&t.name?t.name:t},{merge:!0,remove:!1,silent:!1})},_onViprPropValueChange:function(e){var t=e.property.getName(),i=e.property.getValue();"length"===e.property.type&&(i=i?i.toString():i),this._updateViprProp(t,i)},_allowShowTabs:function(){return this.ownerWidget.allowShowTabs&&this.ownerWidget.allowShowTabs()},_renderTabs:function(){this._tabs.getTabsCount()>0&&this._allowShowTabs()?(this._tabs.show(),this._tabs.selectTab(this.visModel.getPropertyValue("actions"))):this._tabs.hide()},placeAt:function(){S.inherited("placeAt",this,arguments),this._createVisTabs()},render:function(e,t){var i=this;return void 0===t&&(t=!1),S.inherited("render",this,[e,t]),this._destroyCustomVisShowError(),this.viprWidget?(this._renderCustomVisContext()&&(e.widgetSize.height=this.$el.closest(".liveWidgetContent").height()),this.resizeToWidget(e),this._readyForRender()?(this._renderTabs(),this.removeIconView(),this.propChangeslistener||this._registerListenerForPropChanges(),this._applySavedModelProperties(e).then((function(){if(i.visModel.getRenderSequence().isActive()){var t=i.visAPI.ownerWidget.model.augmentation;if(t&&t.length>0)for(var n=0;n<t.length;n++){var a=t[n];i._appendDVI(a)}return i.renderSelected(e)}}))):y.validateVisDefinition(this.content,this.dashboard,{visId:this.ownerWidget.model.visId}).then((function(e){e?i.renderIconView():(i.$el.children().detach(),i.sdkShowError=new m(i.$el[0],p.get("extVisNoSDKConnection"),p.get("extVisNoSDKPreviewMsg"),"disconnect"),i.sdkShowError.showError())}))):Promise.resolve()},_renderCustomVisContext:function(){if("visualizationPreview"===this.ownerWidget.model.visId){var t=this.dashboard.getFeature("Icons"),i=e(this.$el.closest(".widgetContentWrapper"));return i.find(".customVisPreviewMessage").length<1&&(this.$customVisPreviewMessage=e("<div>"),this.$customVisPreviewMessage.addClass("customVisPreviewMessage"),i.prepend(this.$customVisPreviewMessage),f.render(v.createElement(_,{iconsFeature:t}),this.$customVisPreviewMessage[0])),!0}return!1},reveal:function(){var e=this;if(h.isIE11()||!this._readyForRender()||!this._getEntryDurationProperty()||!this.viprData)return this.visAPI.renderCompleteBeforeAnimation(),Promise.resolve();var t=this.viprWidget.processData(this.viprData,this._viprSlotMapping).empty();return this.viprWidget.setData(t,this._viprSlotMapping),this._applyEntryDurationProperty("zero"),this.renderVIPRControl().then((function(){return e._applyEntryDurationProperty("model"),e.viprWidget.setData(e.viprData,e._viprSlotMapping),e.renderVIPRControl(),{renderControlApi:e.renderControlApi}})).catch((function(t){throw e.viprWidget.setData(e.viprData,e._viprSlotMapping),t}))},getCurrentViewSelector:function(){return this.eventHandler},_getDatapointKeyFromSmartAnnotationsResult:function(e){return e?t.filter(e.pt,(function(e){return"number"==typeof e})).toString():""},_decorateDatapoints:function(e){for(var t=this.getSelector().getSelection(b.getColumnIdList(e.slots||this.visualization.getSlots().getMappedSlotList(),"attribute")),i=0;i<e.getDataPointCount();i++){var n=e.getDataPoint(i);n.decorate&&n.hasDecoration&&(t&&t.isSelected(n.getTupleItems())?n.decorate("selected",!0):n.hasDecoration("selected")&&n.decorate("selected",!1))}return!!t},_decorateDataItems:function(e,t){for(var i=this,n=!1,a=function(){var a=e.getDataItem(o);if(a.resetDecorations(),i.dataItemDecorations[t]&&i.dataItemDecorations[t][o]){var s,r=i.dataItemDecorations[t][o];for(s in r)null!==r[s]&&void 0!==r[s]&&a.decorate(s,r[s])}if("cat"===a.getType()){for(var l=[],c=a.getItemClassSet(),u=0;u<c.getItemClassCount();u++)l.push(c.getItemClass(u).getUniqueName());for(var d=i.getSelector().getSelection(l),h={},p={},g=0;g<a.getTupleCount();g++){for(var m=a.getTuple(g),f=[],v=0;v<m.getItemCount();v++){var _=m.getItem(v);f.push(_.item),p[_.getUniqueName()]=_}if(d){var b=!!d.isSelected(f);m.decorate("selected",b),b&&m.items.forEach((function(e){h[e.getUniqueName()]=e})),n=!0}else m.decorate("selected",!1)}Object.values(h).forEach((function(e){return e.decorate("selected",!0)})),Object.keys(p).filter((function(e){return!h[e]})).forEach((function(e){p[e].decorate("selected",!1)}))}},o=0;o<e.getDataItemCount();o++)a();return n},decorateData:function(e,i){var n;void 0===i&&(i={dataPoints:!0,dataItems:!0,selection:!0,annotations:!0});for(var a=0;a<e.getDataSetCount();a++)if(n=e.getDataSetAt(a)){var o=!1;i.dataItems&&(o=this._decorateDataItems(n,a));var s=!1;if(i.dataPoints&&(s=this._decorateDatapoints(n)),i.selection&&n.decorate("hasSelection",s||o),i.annotations){var r=this.smartAnnotations&&this.smartAnnotations.getEnabledAnnotations(),l=r?t.where(r,{type:"MEANINGFUL_DIFFERENCES"}):[];n.decorate("hasKeydriver",!!l.length),n.decorate("hasAnnotations",!!l.length)}}},renderSelected:function(e){var t=this;if(!this.visModel.getRenderSequence().isActive())return Promise.resolve();this.viprData&&this.decorateData(this.viprData),this.eventHandler&&this.eventHandler.restoreState();var i="WidgetRender_"+this.visModel.getWidgetId();return g.createPerformanceMark({component:"dashboard",name:i,state:"start"}),this.renderVIPRControl({renderInfo:e}).then((function(){g.createPerformanceMark({component:"dashboard",name:i,state:"end"}),t.visModel.getRenderSequence().isActive()}))},renderVIPRControl:function(e){var t=this;void 0===e&&(e={callRenderComplete:!1});var i=e,n=i.renderInfo,a=i.callRenderComplete;return this.renderControlApi&&this.renderControlApi.complete&&this.renderControlApi.complete(),this.viprControlRenderInProgress=!0,this.renderControlApi=this.viprWidget.render("client"),this.renderControlApi.onprogress=function(e){"animating"===e.status&&t.visAPI.renderCompleteBeforeAnimation()},this.renderControlApi.then((function(){a&&t.visAPI.renderComplete(n),t._deferredDestroyVIPRWidgets(),t.viprControlRenderInProgress=!1})).catch((function(e){throw e}))},doesVisPropertyMatchExpected:function(e,t){return!(!e||!this.viprWidget)&&s.doesConfigPropertyMatchExpected(this.visualization.getDefinition().getId(),e,t)},_getDefaultContinuousPaletteName:function(){return this.colorsService.getDefaultPaletteName("HeatPalette")},_getDefaultCategoricalPaletteName:function(){return this.colorsService.getDefaultPaletteName("ColorPalette")},_getContinuousColorPaletteDesc:function(e,t){var i=this,n=u.getInstance(),a=n.getDataLayerIdFromPaletteAndSlots(e,t),o=n.getContinuousColorPalettePropertyNameWithLayer(a),s=this.visModel.getPropertyValue(o)||this._getDefaultContinuousPaletteName();return this.colorsService.getPalette({paletteId:s,type:"HeatPalette"}).then((function(e){var t={type:""};if(e){t.type="cont",t.dataLayerId=a;for(var o=[],s=n.getHeatScalePalettePropertyNameWithLayer(a),r=i.visModel.getPropertyValue(s),l=e.fills,c=l.length,u=0;u<c;u++){var d="DarkerForLowerValue"!==r?l[u].fill:l[c-u-1].fill,h=l[u].at,p=d+" "+String(100*h)+"%";o.push(p)}t.colors=o}return t}))},_getSecondaryColorIndexForCatColorPalettes:function(e){var t,i,n=s.getSinglePaletteProperties(this.visAPI.getVisId());if(n&&Object.values(n).forEach((function(e){1===e.defaultColorIndex&&(i=e)})),i){var a=this.visModel.getPropertyValue(i.id);t=(t=null!==a?a:1)<e.fills.length?t:1}return t},_getColorIndicesForCatColorPalettes:function(e,t){var i=this.visModel.getPropertyValue("defaultPaletteIndex")||this.visModel.getPropertyValue(t+"_defaultIndex")||0;return{defaultIndex:i=i<e.fills.length?i:0,secondaryIndex:this._getSecondaryColorIndexForCatColorPalettes(e)}},_getCategoricalColorPaletteDesc:function(e,t){var i=this,n=u.getInstance(),a=n.getDataLayerIdFromPaletteAndSlots(e,t),o=n._getCategoricalColorPalettePropertyNameWithLayer(a),s=this.visModel.getPropertyValue(o)||this._getDefaultCategoricalPaletteName();return this.colorsService.getPalette({paletteId:s,type:"ColorPalette"}).then((function(e){var t={type:"",colors:""},n=i._getColorIndicesForCatColorPalettes(e,o);return e&&(t.type="cat",t.colors=e.fills,t.defaultIndex=n.defaultIndex,t.secondaryColorIndex=n.secondaryIndex),t}))},_getPaletteDescForPalette:function(e,t){var i,n=this;switch(e.paletteType){case"cont":case"customcont":i=this._getContinuousColorPaletteDesc.bind(this);break;case"cat":case"single":case"customcat":i=this._getCategoricalColorPaletteDesc.bind(this);break;default:i=null}return i?i(e,t).then((function(t){var i=n.colorsService.getThemeDefinition();return t.isLegacy=!!i.getProperty("legacy"),t.type=e.paletteType,t})):Promise.resolve({})},_getEntryDurationProperty:function(){var e=null,t=d.getConfig(this.visAPI.getVisId());if(t&&t.entryDurationProperty)e=t.entryDurationProperty;else if(this.viprWidget.properties.get("effect.duration")){var i=s.getOverridenDefaultForProperty(this.visAPI.getVisId(),"effect.duration").defaultValue;null!==i&&i>=0&&(e="effect.duration")}return e},_isDurationPropertyValuePropValid:function(e){return!(void 0===e||e<0)},_applyEntryDurationProperty:function(e){var t=this._getEntryDurationProperty();if(t){var i,n=s.getOverridenDefaultForProperty(this.visAPI.getVisId(),"effect.duration").defaultValue||0;"zero"===e?(i=0,n=0):"model"===e&&(i=this.visModel.getPropertyValue(t)),this._isDurationPropertyValuePropValid(i)||(i=s.getOverridenDefaultForProperty(this.visAPI.getVisId(),t).defaultValue),this._isDurationPropertyValuePropValid(i)&&(this.setProperty({id:"effect.duration",value:n}),this.setProperty({id:t,value:i}))}},_applySavedSingleColorPalette:function(){var e=this;return this._getCategoricalColorPaletteDesc().then((function(t){return c.getInstance().setSinglePaletteResolvers(e.viprWidget,t)}))},_shouldPropertyBeApplied:function(e){var t=["legend.display","legend.position","effect.duration","effect.entry.line.duration","effect.entry.bar.duration"];return!(-1!==(t=t.concat(this._getDontApplyProperties())).indexOf(e))},_getDontApplyProperties:function(){var e=[];return s.getPalettes(this.viprWidget.properties,this.visualization.getDefinition().getId()).forEach((function(t){"colors.series"!==t.name&&e.push(t.name)})),e},_applySavedNonSingleColorPalette:function(){var e=this,t=[],i=this.visualization.getSlots().getSlotList();return s.getPalettes(this.viprWidget.properties,this.visualization.getDefinition().getId()).forEach((function(n){t.push(e._getPaletteDescForPalette(n,i).then((function(t){return t&&c.getInstance().setPaletteResolvers(n,t,i,e.visAPI.getFredIsRed()),t})))})),Promise.all(t)},_applySavedColorPalette:function(){return s.getSinglePalettes(this.viprWidget.properties,this.visualization.getDefinition().getId()).length>0?this._applySavedSingleColorPalette():this._applySavedNonSingleColorPalette()},_setOptimizedSizeProperty:function(e){var t=this._getPropValueWhenSaving(e,"optimizeSize"),i={id:"optimizeSize",value:null==t||t};this.setProperty(i)},_getDefaultBackgroundColorInHex:function(){var e=this.colorsService.getPropertyForUIElement("widget","backgroundColor").value;return t.isObject(e)&&(e=e.color),"$"===e.substring(0,1)&&(e=this.colorsService.getValueForVariable("Color",e.substr(1))),"#"===e.substring(0,1)&&!isNaN(parseInt(e.substr(1),16))||"transparent"===e?e:null},_setBackgroundColor:function(){var e=this,t=s.getBackGroudColorPropertyIdList().map((function(e){return{id:e,value:void 0}}));if(this.highContrastEnabled)t.forEach((function(t){return e.setProperty(t)}));else{var i=this.visModel.ownerWidget.model.fillColor,n=i?this.colorsService.getHexColorFromDashboardColorSet(i):this._getDefaultBackgroundColorInHex();t.forEach((function(t){t.value=n,e.setProperty(t)}))}},_getColorToSave:function(e,i){var n;return t.isString(e)?(this.colorsService.isCustomColor(e)&&this.colorsService.addCustomColor(this.colorsService.getHexColorFromClassName(e)),n=this.colorsService.getHexColorFromDashboardColorSet(e)):(i&&(e=this.colorsService.makeSureColorIsValidInModel(e)),n=e),n},_applyColorSetProperty:function(e,t,i){var n=this._getPropValueWhenSaving(e,t);if(n){var a={id:t,value:this._getColorToSave(n,i)};this.setProperty(a)}},_applyColorSetProperties:function(e,t,i){var n=this;t.forEach((function(t){var a=n.visModel.getPropertyById(t);a&&a.colorClass&&n._applyColorSetProperty(e,t,i)}))},_getLengthPropWithPxUnit:function(e){return null!=e?e&&e.endsWith&&e.endsWith("px")?e:e+"px":null},_applyTargetMarkerThicknessProperties:function(e){var t=this._getPropValueWhenSaving(e,"target.marker.thickness");if(c.getInstance().isTargetThicknessInputValid(t)){var i={id:"target.marker.thickness",value:this._getLengthPropWithPxUnit(t)};this.setProperty(i)}},_applySavedLayerTransparencies:function(){var e=d.getConfig(this.visAPI.getVisId());e&&e.supportsLayers&&e.layerDescriptions.forEach(function(e){var t=this.visModel.getPropertyValue(e.colorRelatedProps.transparencyProp);if(null!=t){var i={id:e.colorRelatedProps.transparencyProp,value:100*t};this.setProperty(i)}}.bind(this))},_isPropValueValid:function(e,t){return(!t.checkForValidValue||t.checkForValidValue(e))&&void 0!==e},_isValidReadOnlyProperty:function(e){return e&&!1===e.isActive&&!0===e.isReadOnly&&this._isPropValueValid(e.defaultValue,e)},overrideWithVidaProperty:function(e){var i=this.visModel.getPropertyById(e),n=this.viprWidget.properties.get(e);if(n&&i){var a={active:n.active,caption:n.caption,defaultValue:n.defaultValue,description:n.description,name:n.name,type:n.type,possibleValues:n.possibleValues};void 0!==i.value&&t.extend(a,{value:n.value}),t.isEmpty(n.tags)||t.extend(a,{tags:n.tags}),t.defaults(i,a)}},_getPropValueWhenSaving:function(e,t){var i=null,n=s.getOverridenDefaultForProperty(e,t);if(this._isValidReadOnlyProperty(n))i=n.defaultValue;else{this.overrideWithVidaProperty(t);var a=this.visModel.getPropertyValue(t),o=this.visModel.getPropertyById(t),r=this._getGroupPropertyName(t),l=this.visModel.getPropertyById(r);t!==r&&o&&l&&o.isDefault()&&!l.isDefault()&&(a=this.visModel.getPropertyValue(r)),i=this._isPropValueValid(a,n)?a:n.defaultValue}return i},_getGroupPropertyName:function(e){return this._getGroupedProperties().get(e)||e},_getGroupedProperties:function(){var e=this;if(!this._groupProperties){var t=this.visualization.getDefinition().getProperty("groupedProperty")||{};this._groupProperties=new Map,this.isElementStyleActionEnabled||Object.keys(t).forEach((function(i){t[i].forEach((function(t){return e._groupProperties.set(t,i)}))}))}return this._groupProperties},_registerListenerForPropChanges:function(){var e=this,i=this.visAPI.getListenForPropChangesFromDefinition();i&&(t.each(i,(function(t){e.viprWidget.properties.get(t).on("value",e._onViprPropValueChange.bind(e))})),this.propChangeslistener=!0)},_applySavedModelProperties:function(e){var t=this;return this._applySavedColorPalette().then((function(){var i=t.visAPI.getVisId(),n=d.getConfig(i),a=n&&n.config&&n.config.include?n.config.include:[];n&&n.isCustomVis&&n.bundleInclude&&(a=n.bundleInclude),a.forEach((function(e){t._setModelProperty(e,i)})),t._applySavedLayerTransparencies(),e&&e.extraInfo&&!0===e.extraInfo.preserveDrawingBuffer?t.setProperty({id:"webGL.preserveDrawingBuffer",value:!0}):t.setProperty({id:"webGL.preserveDrawingBuffer",value:!1}),t._setOptimizedSizeProperty(i),t._setBackgroundColor(),t._applyEntryDurationProperty(e&&e.extraInfo&&e.extraInfo.entryDuration),t._applyTargetMarkerThicknessProperties(i),n&&t._applyColorSetProperties(i,n.config.include,n.isCustomVis)}))},getProperties:function(){var e=this;return this.initialize().then((function(){return c.getInstance().getProperties(e.viprWidget.properties,e.visualization.getSlots().getSlotList(),e.visualization.getDefinition().getId(),e.content,e.dashboard,e.isPropertiesV2Enabled)})).then((function(t){var i=e.visModel.ownerWidget.getFeature("visPropertiesFilter");return i?i.filter(t):t}))},getPropertyList:function(){return c.getInstance().getPropertyList(this.viprWidget.properties,this.visualization.getSlots().getSlotList(),this.content,this.dashboard,this.isPropertiesV2Enabled)},getPropertyLayoutList:function(){return c.getInstance().getPropertyLayoutList(this.viprWidget.properties,this.visualization.getSlots().getSlotList(),this.content,this.dashboard,this.isPropertiesV2Enabled)},onChangeTheme:function(){this.visModel.getRenderSequence().reRender()},setProperty:function(e){c.getInstance().setProperty(this.viprWidget,e)},generateThumbnail:function(e){var t,i=this,n=void 0===e?{}:e,a=n.size,o=void 0===a?{}:a,s=n.type,r=void 0===s?"svg":s,c=this.getThumbnailConfig().enabled,u=!1,d=!(void 0===c||c);if(this.isMappingComplete()||(u=!0),d||u)t=Promise.resolve();else{var h=this.getThumbnailConfig(),p=h.type,g=h.properties,m=void 0===g?{}:g,f=o.width,v=o.height;p&&(r=p);var _=this._createPredictHandler(l,this.predictHandler);t=this.viprWidget.createHidden(f,v,r,!0,C,_).then((function(e){var t=Object.assign({},I,m);return Object.keys(t).forEach((function(i){var n=t[i];e.setProperty(i,n)})),e.render(r).then((function(t){var n;return t&&t.completed&&(n=i.processThumbnailData(t.data)),e.destroy(),n}))}))}return t.then((function(e){return{thumbnail:e,isMappingIncomplete:u,isDisabled:d}}))},processThumbnailData:function(e){var t=this;return e instanceof Blob?new Promise((function(i,n){try{var a=new FileReader,o=p.get("loadedThumbnailImage",{visType:t.visModel.getDefinition().label});a.addEventListener("loadend",(function(){i('<img src="'+a.result+'" alt="'+o+'"></img>')})),a.readAsDataURL(e)}catch(e){n(e)}})):Promise.resolve(e)},getThumbnailConfig:function(){var e=(d.getConfig(this.visAPI.getVisId())||{}).thumbnail;return void 0===e?{}:e},_isViprWidgetValid:function(){var e=this;return!this._deferredDestroyViprWidgetsList.find((function(t){return t.id===e.viprWidget.id}))}});return S})),define("dashboard-analytics/visualizations/renderer/summary/control/SummaryControl",["underscore","../../../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t){"use strict";return t.extend({domNode:null,init:function(){e.extend(this,arguments[0])}})})),define("text!dashboard-analytics/visualizations/renderer/kpi/Kpi.html",[],(function(){return'<div class="kpi-widget-content" data-attach-point="contentNode">\n\t<div class="kpi-widget-value kpi-widget-base-value"></div>\n\t<div class="kpi-widget-value kpi-widget-target-value hidden"></div>\n\t<div class="kpi-widget-sparkline widget hidden"></div>\n</div>\n'})),define("text!dashboard-analytics/visualizations/renderer/kpi/kpiSparklineSpec.json",[],(function(){return'{\n\t"type": "live",\n\t"visId": "com.ibm.vis.rave2line",\n\t"data": {},\n\t"slotmapping": {},\n\t"properties": [\n\t\t{\n\t\t\t"id": "itemAxis.gridLines.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "valueAxis.gridLines.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "itemAxis.title.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "markers.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "valueAxis.zeroOrigin",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "valueAxis.title.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "itemAxis.ticks.labels.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "itemAxis.ticks.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "valueAxis.ticks.labels.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "valueAxis.ticks.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "valueAxis.line.visible",\n\t\t\t"value": false\n\t\t},\n\t\t{\n\t\t\t"id": "itemAxis.line.visible",\n\t\t\t"value": false\n\t\t}\n\t],\n\t"fillColor":  "transparent"\n}\n'})),define("dashboard-analytics/visualizations/renderer/common/NonVIPREventTarget",["./EventTarget","jquery","../../../util/KeyCodes"],(function(e,t,i){return function(e){function n(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return e.call.apply(e,[this].concat(i))||this}_inheritsLoose(n,e);var a=n.prototype;return a.getTargetsByCords=function(){return[]},a.decorateTarget=function(){return!0},a.getDecoration=function(){},a.getValuesAtPoint=function(){},a.completeDecorations=function(){},a.applyCustomDataSelection=function(){},a.getCustomDataSelections=function(){return[]},a.canZoom=function(){return!1},a.zoom=function(){},a.zoomStart=function(){},a.zoomEnd=function(){},a.pan=function(){},a.panStart=function(){},a.panEnd=function(){},a._getKeyDownEventCoordinates=function(e){return e.clientX=t(e.target).offset().left+e.target.offsetWidth/2,e.clientY=t(e.target).offset().top+e.target.offsetHeight/2,e},a._getTargetNode=function(e){return void 0===e&&(e={}),e.gesture?e.gesture.target:e.target},a._canProcessKeyDown=function(e){return"keydown"===e.type&&e.keyCode===i.KEY_ENTER},a.processKeyDown=function(e){var t=this._canProcessKeyDown(e);return t&&this._getKeyDownEventCoordinates(e),t},a.mouseWithinBoundCheck=function(e){if(this.getTargetElement()){var t=this.getTargetElement().get(0).getBoundingClientRect();return e.pageX>t.left&&e.pageX<t.right&&e.pageY>t.top&&e.pageY<t.bottom}return!1},n}(e)})),define("dashboard-analytics/visualizations/renderer/kpi/KpiEventTarget",["jquery","../common/NonVIPREventTarget"],(function(e,t){return function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];e=t.call.apply(t,[this].concat(n))||this;var o=n[0]||{};return e.visControl=o.visControl,e.view=o.view,e.visualization=o.visualization,e.getAPI()||_assertThisInitialized(e)}_inheritsLoose(i,t);var n=i.prototype;return n.getEventTargets=function(t){var i=this._getTargetNode(t);if(!i||"click"===t.type)return[];var n=e(i);return!this.mouseWithinBoundCheck(t)||n.hasClass("kpi-widget-content")?[]:this._getTargets(t,n)},n.remove=function(){this.visControl=null,this.view=null,t.prototype.remove.call(this)},n._getTargets=function(t,i){var n=[],a=e(i.closest(".kpi-widget-value")[0]);if(!a.length)return n;var o=this._getTargetSelectionContext(a);return o&&n.push({key:i.parent().attr("class"),type:"datapoint",selectionContext:o,slotAPIs:o.slots,source:i,isEdgeSelect:!0,values:this._getTargetValues(a),area:"visualization"}),n},n._getTargetSelectionContext=function(e){var t,i=this.visualization.getSlots();if(e.hasClass("kpi-widget-base-value"))t=i.getSlot("actual");else if(e.hasClass("kpi-widget-target-value")&&0===(t=i.getSlot("goal")).getDataItemList().length)return null;return{mapIndex:0,slots:[t]}},n._getTargetValues=function(t){var i,n=[];return t.hasClass("kpi-widget-base-value")?i=this.view.getBaseValue():t.hasClass("kpi-widget-target-value")&&(i=this.view.getTargetValue()),e.isNumeric(i)&&n.push([i]),n},i}(t)})),define("text!dashboard-analytics/visualizations/renderer/common/LabeledValue.html",[],(function(){return'<div class="labeled-value-value" {{? it.valueStyle }} style="{{=it.valueStyle}}"{{?}}><span>{{!it.value||"    "}}</span>{{? it.shapeId }}<svg{{? it.shapeColor}} style="fill:{{!it.shapeColor}}"{{?}}><use xlink:href="#{{!it.shapeId}}"/></svg>{{?}}</div>\n{{? it.showLabel }}\n<div class="labeled-value-label" {{? it.labelStyle }} style="{{=it.labelStyle}}"{{?}}><span>{{!it.label||"    "}}</span></div>\n{{?}}\n'})),define("dashboard-analytics/visualizations/renderer/common/LabeledValueView",["jquery","underscore","doT","../../../lib/@waca/core-client/js/core-client/ui/core/View","text!./LabeledValue.html"],(function(e,t,i,n,a){var o=n.extend({templateString:a,init:function(e){o.inherited("init",this,arguments),this.$el.addClass("labeled-value"),this.dashboardApi=e.dashboardApi,this.iconsService=e.iconsService,this._value=e.value,this._valueStyle=e.valueStyle,this._showValueTranslationIcon=!!e.showValueTranslationIcon,this._label=e.label,this._labelStyle=e.labelStyle,this._showLabel=void 0===e.showLabel||e.showLabel,this._showLabelTranslationIcon=!!e.showLabelTranslationIcon,this._conditionalFormatting=e.conditionalFormatting},remove:function(){this.$el.removeClass("labeled-value"),o.inherited("remove",this,arguments)},render:function(){if(this.$el.empty(),this.$el.prepend(this.dotTemplate({value:this._value,valueStyle:this._valueStyle,label:this._label,labelStyle:this._labelStyle,showLabel:this._showLabel,shapeId:this.hasShape()?this.iconsService.getIcon(this._conditionalFormatting.shapeId).id:null,shapeColor:this._conditionalFormatting&&this._conditionalFormatting.color})),this._valueNode=this.$el.find(".labeled-value-value"),this._labelNode=this.$el.find(".labeled-value-label"),this.dashboardApi&&(this._showValueTranslationIcon||this._showLabelTranslationIcon)){var e=this.dashboardApi.getDashboardCoreSvc("TranslationService");this._showValueTranslationIcon&&e.appendTranslationIcon(this.$el.find(".labeled-value-value > span")),this._showLabelTranslationIcon&&this._showLabel&&e.appendTranslationIcon(this.$el.find(".labeled-value-label > span"))}return Promise.resolve(this)},setValue:function(e){this._value=e},setValueStyle:function(e){this._valueStyle=e},setShowValueTranslationIcon:function(e){this._showValueTranslationIcon=e},setLabel:function(e){this._label=e},setLabelStyle:function(e){this._labelStyle=e},setShowLabel:function(e){this._showLabel=e},setShowLabelTranslationIcon:function(e){this._showLabelTranslationIcon=e},setConditionalFormatting:function(e){this._conditionalFormatting=e},getShowLabel:function(){return this._showLabel},getValueNode:function(){return this._valueNode},getLabelNode:function(){return this._labelNode},hasShape:function(){return!(!this._conditionalFormatting||!this._conditionalFormatting.shapeId)}});return o})),define("dashboard-analytics/preview/error/ErrorView",["jquery","../../../app/nls/StringResources"],(function(e,t){return function(){function i(){}var n=i.prototype;return n.renderContainer=function(t){return e('<div class="errorContainer error">Error: '+this.makeNlsMessage(t.msg)+"</div>")},n.makeNlsMessage=function(e){return e.params?t.get(e.str,e.params):t.get(e.str)},i}()})),define("dashboard-analytics/widgets/livewidget/StandaloneLiveWidget",["./LiveWidget","../../lib/@waca/core-client/js/core-client/ui/core/Events","../../lib/@waca/core-client/js/core-client/utils/LoadCSSPromise","./nls/StringResources","underscore","dashboard-core/js/canvas/Content","dashboard-core/js/dashboard/model/LayoutModel","dashboard-core/js/features/content/InlineFeatures","./models/LiveWidgetModel"],(function(e,t,i,n,a,o,s,r,l){var c=!1;return function(){function u(e){this._destroyed=!1,this.spec=JSON.parse(JSON.stringify(e.spec)),this.spec.id=a.uniqueId("LW"),this.spec.type="live",this.board=e.board,this.node=e.node,this._glassContext=e.glassContext,this.runtimeEnv=e.runtimeEnv,this.predictData=e.predictData,this.isPredictPreview=e.isPredictPreview,this._inlineContentFeatures=e.inlineContentFeatures||[],this._queryResults=e.queryResults,this._managesOwnQueries=e.managesOwnQueries,this._LayoutModelClass=e.layoutModelClass||s,this._featuresOverride=e.featuresOverride,this.runtimeEnv&&!this.runtimeEnv.dashboardApi&&(this.runtimeEnv.dashboardApi=this._glassContext.appController.getCurrentContentView().getDashboardApi()),this.runtimeEnv&&!this.runtimeEnv.dashboardFeatureLoader&&(this.runtimeEnv.dashboardFeatureLoader=this.runtimeEnv.dashboardApi.getFeature("DashboardFeatureLoader.internal")),this._defaultEventRouter=new t,this.interactivitySettings={isClickDisabled:!e.enableClick,isPanAndZoomDisabled:!e.enablePanAndZoom,isHoverDisabled:!e.enableHover,tabNavigation:e.tabNavigation},this.featureSet=e.featureSet}var d=u.prototype;return d._createEnvironment=function(){var e=this;return this.runtimeEnv?Promise.resolve():this._glassContext.getSvc(".DashboardRuntime").then((function(t){var n={spec:t.getDefaultSpec(),profiles:["core","consume"]};return n.spec.widgets[e.spec.id]=e.spec,n.spec.name=e.board&&e.board.name||n.spec.name,n.spec.version=e.board&&e.board.version||n.spec.version,n.featuresOverride=e._featuresOverride,t.getRuntimeEnvironment(n).then((function(t){e.spec=t.boardModel.widgets[e.spec.id];var n=[];return e.runtimeEnv=t,t.cssStyles&&!c&&(c=!0,t.cssStyles.forEach((function(e){n.push(i.load(e,null,null,[{type:"text/css"}]))}))),Promise.all(n)}))}))},d.render=function(t){var i=this;return void 0===t&&(t={}),this._createEnvironment().then((function(){return i._updateModelIds()})).then((function(){return i._createContent(t)})).then((function(e){return i._queryResults&&(i._inlineContentFeatures=i._addQueryOverrideFeature()),Promise.all([e,e.registerFeatures(i._inlineContentFeatures)])})).then((function(n){var o,s=n[0];if(i._queryResults&&s.getFeature("QueryResultOverride").setQueryResults(i._queryResults),t.widgetModel=s.widgetModel,t.initialConfigJSON=s.widgetModel,t=a.extend(t,{dashboardApi:i.runtimeEnv.dashboardApi,eventRouter:i.runtimeEnv.eventRouter||i._defaultEventRouter,registry:i.runtimeEnv.dashboardApi.getWidgetRegistry?i.runtimeEnv.dashboardApi.getWidgetRegistry().live:{},contentFeatureLoader:i._createContentFeatureLoader(s),content:s}),i.widget)o=Promise.resolve();else{i.contentNode=i.contentNode||t.el,i.node.appendChild(i.contentNode);var r=i._liveWidgetClass||e;i.widget=new r(t),o=i.widget.initialize()}return o})).then((function(){if(!i._destroyed)return i.widget.onContainerReady({model:i.widget.model})})).then((function(){if(!i._destroyed)return i.widget.render(null,!1)})).then((function(){if(!i._destroyed)return i.widget.whenRenderComplete()})).catch((function(e){var t=e&&e.message;if("promptingIsDisabled"===t)throw e;var i=e&&e.datasetName;if(t&&i){var a=n.get(t,{datasetName:i});throw new Error(a)}throw e}))},d._addQueryOverrideFeature=function(){return this._inlineContentFeatures.push({containerId:"com.ibm.bi.dashboard.content-features",name:"QueryResultOverride",id:"com.ibm.bi.dashboard.content-features.queryResultOverride",class:"dashboard-analytics/features/widget/queryResultOverride/QueryResultOverride",dependencies:["SmartAnnotationProvider","VisKeyDrivers"],types:["widget.live"],profiles:["core"]}),this._inlineContentFeatures},d._createContentFeatureLoader=function(e){var t=this;return{whenContentReady:function(){return Promise.resolve()},registerFeatureCollection:function(i,n){return t.runtimeEnv.dashboardApi.findGlassCollection(n).then((function(t){return e.registerFeatures(t||[])}))},registerFeature:function(t,i,n,a){return e.registerFeature(i,n,a)},registerDeprecatedFeature:function(t,i,n){return e.registerFeature(i,n,{},!0)}}},d._createContent=function(e){var t=this,i=e.isPreview,n=e.isPredictPreview,a=this.runtimeEnv.dashboardApi;return a.findGlassCollection("com.ibm.bi.dashboard.content-features").then((function(e){var s=r.concat(e||[]),c=a.getFeature("internal").getBoardModel(),u=a.getFeature("Logger"),d=new t._LayoutModelClass({type:"widget",content:{features:{Visualization:{isPreview:!!i,isPredictPreview:!!n}}}},c,u);return t.content=new o({contentFeatureCollection:s,dashboardFeatures:t.runtimeEnv.dashboardFeatureLoader,boardModel:c,layoutModel:d,canvas:a.getCanvas(),widgetModel:new l(t.spec)}),t.content.initialize().then((function(){return t.content}))}))},d.getTitle=function(){if(!this._destroyed)return this.widget.getTitle()},d.resize=function(){if(!this._destroyed)return this.widget?this.widget.resize():void 0},d.destroy=function(){this._destroyed||(this._destroyed=!0,this.content&&(this.content.destroy(),this.content=null),this.widget&&(this.widget.destroy(),this.widget=null),this.contentNode&&(this.contentNode.parentNode&&this.contentNode.parentNode.removeChild(this.contentNode),this.contentNode=null))},d.toJSON=function(){if(!this._destroyed)return this.widget.model.toJSON()},d._updateModelIds=function(){var e=this,t=this.runtimeEnv.dashboardApi.getFeature("DataSources"),i=t.getDataSourceList()||[],n=[];return this.spec.data&&this.spec.data.dataViews&&this.spec.data.dataViews.forEach((function(o){if(!o.modelRef&&o.model){var s=a.chain(i).filter((function(e){return e.getAssetId()===o.model.assetId})).map((function(e){return e.getId()})).value();s.length>0?(o.modelRef=s[0],delete o.model):o.model.type?e._convertModelToModelRef(o,t):n.push(e._getAssetType(o.model.assetId).then((function(i){o.model.type=i,e._convertModelToModelRef(o,t)})))}})),Promise.all(n)},d._convertModelToModelRef=function(e,t){e.modelRef=t.addDataSource(e.model),delete e.model},d._getAssetType=function(e){return this.runtimeEnv.dashboardApi.getGlassCoreSvc(".Ajax").ajax({url:"v1/objects/"+e+"?fields=userInterfaces,defaultName,searchPath",type:"GET",headers:{Accept:"application/json"}}).then((function(e){if(e.data&&e.data.data&&e.data.data.length>0)return e.data.data[0].type}))},u}()})),define("dashboard-analytics/preview/LiveWidgetPreview",["./error/ErrorView","jquery","underscore","../lib/@waca/core-client/js/core-client/utils/BrowserUtils","../widgets/livewidget/StandaloneLiveWidget"],(function(e,t,i,n,a){var o={"com.ibm.vis.rave2bundletiledmap":"dashboard-analytics/images/placeholders/map.svg"};return function(i){function a(e){return i.call(this,e)||this}_inheritsLoose(a,i);var s=a.prototype;return s.render=function(){if(this.contentNode=document.createElement("div"),this.contentNode.setAttribute("class","liveWidgetPreview"),this.contentNode.setAttribute("style","width:100%;height:100%; padding:0px"),this.contentNode.setAttribute("data-vis-id",this.spec.visId),this._isStaticView()){var t=this._getStaticView();return this.contentNode.appendChild(t),this.node.appendChild(this.contentNode),Promise.resolve()}var n={id:this.spec.id,el:this.contentNode,errorView:new e,featureSet:this.featureSet||[],interactivitySettings:this.interactivitySettings,optimizeForSize:!0,forceDisabledThumbnail:!0,isPreview:!0,isPredictPreview:this.isPredictPreview,predictData:this.predictData,managesOwnQueries:this._managesOwnQueries};return i.prototype.render.call(this,n)},s._isStaticView=function(){return!(!n.isIE()||!o[this.spec.visId])},s._getStaticView=function(){if(o[this.spec.visId])return t('<div class="vis-icon-view-snapshot-container"><img class="snapshot" src="'+o[this.spec.visId]+'"></img></div>')[0]},a}(a)})),define("dashboard-analytics/visualizations/renderer/kpi/KpiViewFactory",["jquery","../common/LabeledValueView","../../../preview/LiveWidgetPreview"],(function(e,t,i){return function(){function e(){}var n=e.prototype;return n.createSparklineView=function(e){return new i(e)},n.createLabeledValueView=function(e){return new t(e)},e}()})),define("dashboard-analytics/util/TextScrambler",["../lib/@waca/core-client/js/core-client/ui/core/Class","jquery"],(function(e,t){"use strict";var i="ABCDEFGHIJKLMNOPQRSTUVWXYZ",n="abcdefghijklmnopqrstuvwxyz",a="0123456789",o="!'#$*&()%+=,-./:;<=>?@[]^_`{}|~";return e.extend({init:function(e){this.ignoreSet=e.ignoreSet,this.el=e.el,this.text=e.el.innerText},scramble:function(){var e=this._applyIgnoreSet();this.queue=[];for(var t=1;t<=e.length;t++)this.queue.push({char:e[t-1],start:Math.floor(t/this.text.length*15)});this.frame=0,this._update()},_applyIgnoreSet:function(){var e=this.text;return this.ignoreSet&&t.each(this.ignoreSet,(function(t,i){e=e.replace(new RegExp("\\"+i,"g"),"")})),e},_update:function(e){!this.startTime&&e&&(this.startTime=e);var i="",n=!1;t.each(this.queue,function(e,t){this.frame>=t.start&&(i+=this._getRandomChar(t.char))}.bind(this)),e-this.startTime>485&&(i=this.text,n=!0),this.el.innerHTML=i,n||(this.frame++,this._setTimeout(function(){this.frameRequest=this._requestAnimationFrame(this._update.bind(this))}.bind(this),25))},_requestAnimationFrame:function(e){return window.requestAnimationFrame(e)},_getRandomChar:function(e){return" "===e?e:e>="0"&&e<="9"?a[Math.floor(this._random()*a.length)]:e>="A"&&e<="Z"?i[Math.floor(this._random()*i.length)]:e>="a"&&e<="z"?n[Math.floor(this._random()*n.length)]:o[Math.floor(this._random()*n.length)]},_random:function(){return Math.random()},_setTimeout:function(e,t){return window.setTimeout(e,t)}})})),define("dashboard-analytics/features/content/dataQueryExecution/api/QueryResultsAPI",[],(function(){var e=function(){function e(){}var t=e.prototype;return t.getResult=function(){},t.getQueryResultIdList=function(){},t.getCacheValidateTag=function(){},t.getWarningList=function(){},e}();return e.QUERY_RESULT_TYPE={MAIN:"main",MINMAX:"minmax"},e})),define("dashboard-analytics/features/content/dataQueryExecution/QueryResults",["underscore","../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/QueryResultsAPI"],(function(e,t,i){return function(){function n(e,t){this._oQueryResults={},this._resultTag=e,this._warnings=t}var a=n.prototype;return a.destroy=function(){e.each(this._oQueryResults,(function(t){e.each(t,(function(e){e.destroy&&e.destroy()}))}))},a.getAPI=function(){return this.queryResultsAPI||(this.queryResultsAPI=t.createAPI(this,[i])),this.queryResultsAPI},a.addResult=function(e,t,n){void 0===t&&(t="data"),void 0===n&&(n=i.QUERY_RESULT_TYPE.MAIN),this._oQueryResults[t]||(this._oQueryResults[t]={}),this._oQueryResults[t][n]=e},a.getResult=function(e,t){void 0===e&&(e="data"),void 0===t&&(t=i.QUERY_RESULT_TYPE.MAIN);var n=this._oQueryResults[e]&&this._oQueryResults[e][t];return n&&n.getAPI?n.getAPI():n},a.removeResult=function(e,t){void 0===e&&(e="data"),void 0===t&&(t=i.QUERY_RESULT_TYPE.MAIN),this._oQueryResults[e]&&this._oQueryResults[e][t]&&delete this._oQueryResults[e][t]},a.getQueryResultIdList=function(){return this._oQueryResults&&Object.keys(this._oQueryResults)},a.getCacheValidateTag=function(){return this._resultTag},a.getWarningList=function(){return this._warnings||[]},n}()})),define("dashboard-analytics/visualizations/renderer/kpi/KpiView",["jquery","underscore","../VisView","text!./Kpi.html","text!./kpiSparklineSpec.json","../../../util/DashboardFormatter","./KpiEventTarget","./KpiViewFactory","../VisEventHandler","../../../DynamicFileLoader","../../../widgets/livewidget/nls/StringResources","../../../util/TextScrambler","../../../features/content/dataQueryExecution/QueryResults"],(function(e,t,i,n,a,o,s,r,l,c,u,d,h){"use strict";var p=i.extend({BASE_SLOT_ID:"actual",TARGET_SLOT_ID:"goal",SPARKLINE_TIME_SLOT_ID:"sparkline.time",SPARKLINE_ACTUAL_SLOT_ID:"sparkline.actual",className:"dataview kpi-widget",templateString:n,init:function(e){p.inherited("init",this,arguments),this._baseValueView=null,this._targetValueView=null,this._sparkLineView=null,this._content=e.content,this._conditionalFormattingFeature=this._content.getFeature("ConditionalFormatting"),this._colorsService=this.dashboardApi.getFeature("Colors"),this._visualizationAPI=this._content.getFeature("Visualization.internal"),this._kpiViewFactory=e.kpiViewFactory||new r,this._sparkLineRenderPromise=null},summaryReveal:function(){if(this.visModel.renderCompleteBeforeAnimation(),!this._readyToRender())return Promise.resolve();var e=this.$el.find(".kpi-widget-base-value .labeled-value-label"),t=this.$el.find(".kpi-widget-base-value .labeled-value-value");return e.length&&(this.labelScrambler=new d({el:e[0]}),this.labelScrambler.scramble()),t.length&&(this.valueScrambler=new d({ignoreSet:["-",",","."],el:t[0]}),this.valueScrambler.scramble()),Promise.resolve()},remove:function(){this.eventHandler&&(this.eventHandler.remove(),this.eventHandler=null),this._removeViews(),p.inherited("remove",this,arguments)},initialize:function(){var e=this;return this.visControl?Promise.resolve(this.visControl):c.load(["dashboard-analytics/visualizations/renderer/kpi/control/KpiControl"]).then((function(t){var i=t[0];return e.visControl=new i({domNode:e.$el.find(".kpi-widget-content")[0]}),e.eventHandler=new l({target:new s({$el:e.$el,visControl:e.visControl,view:e,visualization:e.visualization}),dashboardSettings:e.dashboardSettings,transaction:e.transactionApi,logger:e.logger,ownerWidget:e.ownerWidget,visAPI:e.visModel,edgeSelection:!0}),e.visControl}))},_removeViews:function(){this._baseValueView&&(this._baseValueView.remove(),this._baseValueView=null),this._targetValueView&&(this._targetValueView.remove(),this._targetValueView=null),this._removeSparkLine()},_initializeConditionalFormatting:function(){return this._conditionalFormattingFeature?this._conditionalFormattingFeature.initializeFeature():Promise.resolve()},render:function(t){var i=this,n=arguments;return this._initializeConditionalFormatting().then((function(){i._baseValue=null,i._targetValue=null;var n=i._getBaseSlot(),a=i._getTargetSlot();if(!i._readyToRender()||!n)return i.renderIconView(),Promise.resolve();i.removeIconView(),e(i.contentNode).css("text-align",i._getTextAlignment()||"center"),i._baseValueNode||(i._baseValueNode=i.$el.find(".kpi-widget-base-value"),i._targetValueNode=i.$el.find(".kpi-widget-target-value"),i._sparkLineNode=i._getSparklineContainer());var o=t.data.getResult();i._baseValue=i._getQueryResultValue(o,0,0),i._targetValue=i._getQueryResultValue(o,0,1);var s=i._getBaseProperties(),r=i._formatValue(n,i._baseValue),l=i._getDataItem(n),c=l.getLabel(),d=i._getTargetProperties();i._targetValueNode.addClass("hidden"),i._targetValueNode.empty();var h=[],p=i._isSlotMapped(a);if(p||(d.manualValue||0===d.manualValue)&&!isNaN(d.manualValue)){var g,m;if(p)g=a,m=i._getDataItem(a).getLabel();else g=n,m=u.get("kpiDefaultTargetLabel"),i._targetValue=Number(d.manualValue);if(d.showValue||d.showDistance){i._targetValueNode.removeClass("hidden");var f=i._getTargetValueString(d,g);h.push(i._renderLabeledValue(f,m,d,"targetValue"))}}var v=i._conditionalFormattingFeature?i._conditionalFormattingFeature.getFormatting(i._baseValue,i._targetValue,l.getColumnId()):null;h.push(i._renderLabeledValue(r,c,s,"baseValue",v));var _=t.data.getResult("sparkline"),b=i._shouldDisplaySparkline(_);return i._sparkLineNode.toggleClass("hidden",!b),b?h.push(i._renderSparkLine(t,v,s)):i._removeSparkLine(),Promise.all(h)})).then((function(){if(i._scaleSections(i._getResizeDefinition()),i._sparkLineRenderPromise){var e=i._sparkLineRenderPromise;return i._sparkLineRenderPromise=null,e}})).then((function(){return p.inherited("render",i,n)}))},_getQueryResultValue:function(e,t,i){var n=null;t<e.getRowCount()&&(i<e.getDataPointValueList()[t].pt.length&&(n=e.getValue(t,i).value));return n},_getTargetValueString:function(e,t){var i=this._formatValue(t,this._targetValue),n="";if(e.showDistance){var a=this._getFormattedTargetDistanceString(t,this._baseValue,this._targetValue);n=e.showValue?u.get("kpiTargetWithDistance",{value:i,distance:a}):a}else n=i;return n},_renderLabeledValue:function(e,t,i,n,a){var o="_"+n+"View",s="_"+n+"Node",r="";if(i.labelSize&&"auto"!==i.labelSize&&(r="font-size:"+i.labelSize+"px;"),a&&a.color)r+="color:"+a.color+";";else if(i.valueColor){var l=this._colorsService.getHexColorFromDashboardColorSet(i.valueColor);"transparent"!==l&&(r+="color:"+l+";")}var c=i.label||t,u=this[o];return u?(u.setValue(e),u.setValueStyle(r),u.setLabel(c),u.setShowLabel(i.showLabel),u.setConditionalFormatting(a)):u=this[o]=this._kpiViewFactory.createLabeledValueView({el:this[s][0],dashboardApi:this.dashboardApi,iconsService:this.dashboardApi.getFeature("Icons"),value:e,valueStyle:r,label:c,showLabel:i.showLabel,conditionalFormatting:a}),u.render()},_readyToRender:function(){return this.isMappingComplete()&&!this.hasMissingFilters()&&!this.hasUnavailableMetadataColumns()},_getResizeDefinition:function(){var e={$node:this.$el,reservedSpace:16,children:[]};return this._baseValueView&&(e.children.push({$node:this._baseValueView.getValueNode(),referenceHeight:40,minimumHeight:22.8,text:!0}),this._baseValueView.hasShape()&&(e.children[0].icon={$node:this._baseValueView.getValueNode().find("svg"),paddingDivisor:4}),this._baseValueView.getShowLabel()&&(e.reservedSpace+=8,e.children.push({$node:this._baseValueView.getLabelNode(),referenceHeight:14,minimumHeight:9.6,maximumHeight:29,text:!0})),this._targetValueNode&&!this._targetValueNode.hasClass("hidden")&&this._targetValueView&&(e.reservedSpace+=16,e.children.push({$node:this._targetValueView.getValueNode(),referenceHeight:19,minimumHeight:12,maximumHeight:39,text:!0}),this._targetValueView.getShowLabel()&&(e.reservedSpace+=8,e.children.push({$node:this._targetValueView.getLabelNode(),referenceHeight:14,minimumHeight:9.6,maximumHeight:29,text:!0}))),this._sparkLineNode&&!this._sparkLineNode.hasClass("hidden")&&this._sparkLineView&&(e.reservedSpace+=16,e.children.push({$node:this._sparkLineNode,referenceHeight:32,minimumHeight:16,text:!1}))),e},_scaleSections:function(e){if(e.children&&e.children.length){var t=0;e.reservedSpace&&(t+=e.reservedSpace),e.$node.css("overflow","hidden");var i=e.$node.height()-t,n=0;e.children.forEach((function(e){n+=e.referenceHeight}));var a=!1,o={$node:e.$node,reservedSpace:e.reservedSpace,children:[]};e.children.forEach((function(e){var t=e.referenceHeight/n*i,r=s(e,t);if(e.text){var l=e.$node.width(),c=e.$node[0].scrollWidth;c>Math.round(l)&&(c+=8,r&&(t=e.maximumHeight),r=s(e,t=t*l/c))}a=a||r,r?o.reservedSpace+=e.maximumHeight:o.children.push(e)})),e.$node.css("overflow",""),a&&this._scaleSections(o)}function s(e,t){var i=!1;e.minimumHeight&&(t=Math.max(Math.floor(t),e.minimumHeight)),e.maximumHeight&&(i=(t=Math.min(t,e.maximumHeight))===e.maximumHeight);var n=t;e.$node.css("height",n+"px");var a=t/1.2;if(e.text&&e.$node.css({"font-size":a+"px","line-height":t+"px","flex-basis":t+"px"}),e.icon){var o=a/2,s={width:o+"px",height:o+"px"};e.icon.paddingDivisor&&(s["padding-left"]=o/e.icon.paddingDivisor+"px"),e.icon.$node.css(s)}return i}},_formatValue:function(e,t){var i=this._getFormatForSlot(e);return t=o.format(t,i)},_getFormatForSlot:function(e){var t=this._getDataItem(e);return t&&t.getFormat()||{}},_getFormattedTargetDistanceString:function(e,t,i){if(0===i)return u.get("kpiDistanceUndefined");var n=(t-i)/Math.abs(i),a={convertPercent:!0,maximumFractionDigits:2,minimumFractionDigits:0,type:"percent",locale:e.locale},s=o.format(n,a);return n>0&&(s="+"+s),s},_getBaseProperties:function(){return{labelSize:this._content.getPropertyValue("baseValueSize"),showLabel:!1!==this._content.getPropertyValue("showItemLabel"),label:this._content.getPropertyValue("baseValueLabel"),valueColor:this._content.getPropertyValue("elementColor")}},_getTargetProperties:function(){return{labelSize:this._content.getPropertyValue("targetValueSize"),showLabel:!1!==this._content.getPropertyValue("showTargetLabel"),showValue:!1!==this._content.getPropertyValue("showTargetValue"),showDistance:!1!==this._content.getPropertyValue("showTargetDistance"),label:this._content.getPropertyValue("targetValueLabel"),manualValue:this._content.getPropertyValue("targetValue")}},_getTimeProperties:function(){return{showSparkline:!1!==this._content.getPropertyValue("showSparkline")}},_getTextAlignment:function(){return this._content.getPropertyValue("textAlignment")},_getBaseSlot:function(){return this._visualizationAPI.getSlots().getSlot(this.BASE_SLOT_ID)},_getTargetSlot:function(){return this._visualizationAPI.getSlots().getSlot(this.TARGET_SLOT_ID)},_getSparklineTimeSlot:function(){return this._visualizationAPI.getSlots().getSlot(this.SPARKLINE_TIME_SLOT_ID)},_getSparklineActualSlot:function(){return this._visualizationAPI.getSlots().getSlot(this.SPARKLINE_ACTUAL_SLOT_ID)},_getDataItem:function(e,t){return void 0===t&&(t=0),e.getDataItemList()[t]},_isSlotMapped:function(e){return(e&&e.getDataItemList()||[]).length>0},animate:function(){this.resizing?this.visModel.renderCompleteBeforeAnimation():p.inherited("animate",this,arguments)},resize:function(){this.isMappingComplete()?this._scaleSections(this._getResizeDefinition()):p.inherited("resize",this,arguments)},onChangeValueSizeProperty:function(e,i){var n={};"auto"===i?(n.baseValueSize="auto",n.targetValueSize="auto"):(n.baseValueSize=this._content.getPropertyValue("baseValueSize"),n.targetValueSize=this._content.getPropertyValue("targetValueSize"),"auto"===n.baseValueSize&&(n.baseValueSize="32",n.targetValueSize="16"),n[e]=i);var a=t.uniqueId("kpi_font_size");for(var o in n)this.ownerWidget.onPropertyUpdate({category:o,item:n[o],transactionId:a})},getDecoratorAPI:function(){var e=[this._baseValueView,this._targetValueView];return{decorateItem:function(t){e[t]&&e[t].setShowLabelTranslationIcon(!0)},decoratePoint:function(){return null},decorate:function(){return null},clearItemDecoration:function(){e.forEach((function(e){e&&e.setShowLabelTranslationIcon(!1)}))},updateDecorations:function(){e.forEach((function(e){e&&e.render()}))}}},getBaseValue:function(){return this._baseValue},getTargetValue:function(){return this._targetValue},_removeSparkLine:function(){this._sparkLineView&&(this._sparkLineView.destroy(),this._sparkLineView=null)},_shouldDisplaySparkline:function(e){return!!this._isSlotMapped(this._getSparklineActualSlot())&&(!!this._isSlotMapped(this._getSparklineTimeSlot())&&(!!this._getTimeProperties().showSparkline&&!!this._hasEnoughDataToRenderSparkline(e)))},_hasEnoughDataToRenderSparkline:function(e){if(!e)return!1;var t=e.getDataPointValueList(),i=t.length;if(!t||i<2)return this._addNotRenderingSparklineInfo(),!1;for(var n=0,a=0;a<i&&(null!==e.getValue(a,0).value&&n++,!(n>1));a++);return!(n<2)||(this._addNotRenderingSparklineInfo(),!1)},_addNotRenderingSparklineInfo:function(){this.infoIndicator&&this.infoIndicator.update([{id:"data_notifications",label:u.get("visualizationNotifications"),items:[{id:"sparkLineInfoLabel",label:u.get("kpiUnableDrawSparklineLabel"),isSubMessage:!1},{id:"sparkLineInfo",label:u.get("kpiUnableDrawSparklineInfo"),isSubMessage:!0}]}])},_renderSparkLine:function(e,t,i){var n="";if(t&&t.color)n=t.color;else if(i.valueColor){var a=this._colorsService.getHexColorFromDashboardColorSet(i.valueColor);"transparent"!==a&&(n=a)}this._sparkLineView&&(e.refresh&&e.refresh.data?this._removeSparkLine():this.resizing&&this._sparkLineView.resize());var o=n!==this._cachedSparkLineColor;if(this._updateCachedSparkLineColor(n),this._sparkLineView)o&&this._sparkLineView.widget.updateVisProperties(this._getSparklineColorProperty());else{var s=new h;s.addResult(e.data.getResult("sparkline")),this._sparkLineView=this._createSparkLine(s.getAPI()),this._sparkLineRenderPromise=this._sparkLineView.render()}return Promise.resolve()},_getSparklineContainer:function(){return this.$el.find(".kpi-widget-sparkline")},_addSlotDef:function(e,t,i){var n={name:t,dataItems:[]};i.getDataItemList().forEach((function(t){var i={id:t.getId(),itemId:t.getColumnId()};t.getSort()&&(i.selection=[{operation:"order",sort:t.getSort()}]),e.data.dataViews[0].dataItems.push(i),n.dataItems.push(t.getId())})),e.slotmapping.slots.push(n)},_getSparklineColorProperty:function(){return{id:"colors.series",value:this._cachedSparkLineColor}},_updateCachedSparkLineColor:function(e){this._cachedSparkLineColor=e;var t=this._getSparklineContainer();this._cachedSparkLineColor?t.removeClass("defaultColors"):t.addClass("defaultColors")},_buildSparklineSpec:function(){var e=JSON.parse(a);this._cachedSparkLineColor&&e.properties.push(this._getSparklineColorProperty()),e.data={dataViews:[{modelRef:this._visualizationAPI.getDataSource().getId(),dataItems:[]}]},e.slotmapping.slots=[],this._addSlotDef(e,"categories",this._getSparklineTimeSlot()),this._addSlotDef(e,"values",this._getSparklineActualSlot());var t=this._visualizationAPI.getLocalFilters();return e.localFilters=t.getFilterList(),e},_createSparkLine:function(e){var t=this._buildSparklineSpec(),i=this._getSparklineContainer(),n={enableHover:!0,enableClick:!1,enablePanAndZoom:!1,tabNavigation:!1,runtimeEnv:{dashboardApi:this.dashboardApi},node:i[0],spec:t,queryResults:e,managesOwnQueries:!0};return this._kpiViewFactory.createSparklineView(n)},containsSubContent:function(e){return!!(e&&this._sparkLineView&&this._sparkLineView.widget&&e===this._sparkLineView.widget.content.getId())}});return p})),define("text!dashboard-analytics/visualizations/renderer/infographic/Infographic.html",[],(function(){return'{{? it.infographic }}\n\t<div class=\'infographic\'>\n\t\t<div class = \'infographicDef\' style=\'display:none\'>\n\t\t\t<svg>\n\t\t\t\t<defs>\n\t\t\t\t\t<g id="{{=it.infographic.svgId}}">\n\t\t\t\t\t\t{{=it.infographic.content}}\n\t\t\t\t\t</g>\n\t\t\t\t</defs>\n\t\t\t</svg>\n\t\t</div>\n\n\t\t{{ for(var i=0; i<it.infographic.scaleComponents.numShapes; i++) { }}\n\t\t\t<div class=\'infographic-content coloredShape {{=it.infographic.style.colorClass}}\'>\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="staticContent" {{=it.infographic.style.coloredStyle}} height="100%" width="100%" preserveAspectRatio="none" viewBox="{{=it.infographic.viewBox}}">\n\t\t\t\t\t{{? it.infographic.doFillAnimation }}\n\t\t\t\t\t\t<use xlink:href="#{{=it.infographic.svgId}}" class="greyed{{=it.infographic.style.svgClass}}" />\n\t\t\t\t\t{{?}}\n\t\t\t\t\t<use xlink:href="#{{=it.infographic.svgId}}" {{? it.infographic.doFillAnimation }} class="animate" style="animation-delay: {{=i * it.infographic.fillDuration}}s; animation-duration: {{=it.infographic.fillDuration}}s" {{?}}/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t{{ } }}\n\n\t\t{{? it.infographic.scaleComponents.partialValue > 0 }}\n\t\t\t<div class=\'infographic-content {{=it.infographic.style.colorClass}}\'>\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="staticContent" {{=it.infographic.style.coloredStyle}} height="100%" width="100%" preserveAspectRatio="none" viewBox="{{=it.infographic.viewBox}}">\n\t\t\t\t\t<clipPath id="fill_{{=it.infographic.svgId}}_partial">\n\t\t\t\t\t\t<rect x="0" y="{{=it.infographic.clipPathLastElement.y}}" width="{{=it.infographic.clipPathLastElement.width}}" height="100%" />\n\t\t\t\t\t</clipPath>\n\t\t\t\t\t<use xlink:href="#{{=it.infographic.svgId}}" class="greyed{{=it.infographic.style.svgClass}}" />\n\t\t\t\t\t<use xlink:href="#{{=it.infographic.svgId}}" clip-path="url(#fill_{{=it.infographic.svgId}}_partial)" {{? it.infographic.doFillAnimation }} class="animate" style="animation-delay: {{=i * it.infographic.fillDuration}}s; animation-duration: {{=it.infographic.fillDuration}}s" {{?}}/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t{{?}}\n\n\t\t{{ for(var i=0; i<it.infographic.scaleComponents.numGreyedShapes; i++) { }}\n\t\t\t<div class=\'infographic-content greyed{{=it.infographic.style.svgClass}}\'>\n\t\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" class="staticContent" height="100%" width="100%" preserveAspectRatio="none" viewBox="{{=it.infographic.viewBox}}">\n\t\t\t\t\t <use xlink:href="#{{=it.infographic.svgId}}"/>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t{{ } }}\n\t</div>\n\n\t{{? it.showTitleString }}\n\t<div class=\'infographic-scale\'>\n\t\t<div class=\'infographic-scale-wrapper\'>\n\t\t\t<svg xmlns="http://www.w3.org/2000/svg" version="1.1" height="100%" width="100%" preserveAspectRatio="none" viewBox="{{=it.infographic.viewBox}}">\n\t\t\t\t<use class=\'infographicLegend{{=it.infographic.style.svgClass}}\' xlink:href="#{{=it.infographic.svgId}}"/>\n\t\t\t</svg>\n\t\t\t<span class=\'infographicLegendText\'> = {{? it.infographic.percentageScaleValue}}{{=it.infographic.percentageScaleValue}}{{??}}{{=it.infographic.abbreviatedScale}}{{?}} {{=it.label}}</span>\n\t\t</div>\n\t</div>\n\t{{?}}\n{{??}}\n<div></div>\n{{?}}\n'})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/utils/ScaleUtil",["../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e){return new(e.extend({SCALE_VALUE_FEW:0,SCALE_VALUE_DEFAULT:1,SCALE_VALUE_MANY:2,PERCENT_OPTIMAL_VALUE:.1,PERCENT_SCALE_OPTIONS:[.01,.1,1],calcOptimalValue:function(e,t){if(null===e&&(e=0),"number"!=typeof e)return null;if(t)return this.PERCENT_OPTIMAL_VALUE;var i=Math.abs(e),n=this.getSign(e)||1,a=Math.ceil(Math.log(i+1)/Math.LN10),o=1;return a>2&&(o=Math.pow(10,a-2)),o*n},getScalingProperties:function(e,t){if(null===e&&(e=0),"number"!=typeof e)return null;if(t)return{availableScales:this.PERCENT_SCALE_OPTIONS,optimalScale:this.PERCENT_OPTIMAL_VALUE,scalingOptions:[this.SCALE_VALUE_FEW,this.SCALE_VALUE_DEFAULT,this.SCALE_VALUE_MANY]};var i=Math.abs(e),n=this.getSign(e)||1,a=this.calcOptimalValue(i),o=[a*n];a>1&&o.unshift(a/10*n);var s=10*a;i/s>=1&&o.push(s*n);var r={availableScales:o,optimalScale:a*n};return r.scalingOptions=this._getScaleOptions(r,t),r},getMinMax:function(e,t){null===e&&(e=0);var i=this.getScalingProperties(e,t);return{min:i.scalingOptions[0],max:i.scalingOptions[i.scalingOptions.length-1]}},getScaleComponents:function(e,t,i){function n(e,t){for(;t<1&&t>0;)t*=10,e*=10;return e/t}null===e&&(e=0),e=Math.abs(e),t=Math.abs(t);var a,o,s=Math.floor(n(e,t)),r=n((a=e)-(o=t)*Math.floor(n(a,o)),t);return{numShapes:s,partialValue:r=parseFloat(r.toFixed(2)),numGreyedShapes:i?n(1,t)-s-Math.ceil(r):0}},_getScaleOptions:function(e){var t,i=e.availableScales.length;return 3===i?t=[this.SCALE_VALUE_FEW,this.SCALE_VALUE_DEFAULT,this.SCALE_VALUE_MANY]:1===i?t=[this.SCALE_VALUE_DEFAULT]:0===e.availableScales.indexOf(e.optimalScale)?t=[this.SCALE_VALUE_FEW,this.SCALE_VALUE_DEFAULT]:1===e.availableScales.indexOf(e.optimalScale)&&(t=[this.SCALE_VALUE_DEFAULT,this.SCALE_VALUE_MANY]),t},getSign:function(e){return e=+e,isNaN(e)?NaN:e>=0?1:-1}}))})),define("text!dashboard-analytics/lib/@waca/dashboard-common/dist/ui/templates/Slider.template",[],(function(){return'<div class="slider-container">\n\t<div class="padding">\n\t\t{{? !it.minimized}}\n\t\t{{? it.isRange }}\n\t\t<div class="left tooltipHandle">\n\t\t\t<div class="tooltip-inner"></div>\n\t\t\t<div class="tooltip-arrow"></div>\n\t\t</div>\n\t\t{{?}}\n\t\t<div class="right tooltipHandle" tabindex="-1">\n\t\t\t<div class="tooltip-inner" tabindex="-1"></div>\n\t\t\t<div class="tooltip-arrow" tabindex="-1"></div>\n\t\t</div>\n\t\t{{?}}\n\t\t<input class="slider-control" type="hidden" data-slider-handle="round"></input>\n\t\t{{? it.isRange}}\n\t\t<div class="linePanel">\n\t\t\t<div class="lineSegment top">\n\t\t\t\t<div class="linkLine top left"></div>\n\t\t\t\t<div class="linkLine top right"></div>\n\t\t\t</div>\n\t\t\t<div class="lineSegment bottom">\n\t\t\t\t<div class="linkLine bottom left"></div>\n\t\t\t\t<div class="linkLine bottom right"></div>\n\t\t\t</div>\n\t\t</div>\n\t\t{{?}}\n\t\t{{? it.showMinMax}}\n\t\t<div class="hint">\n\t\t\t<span class="minvalue"><span>{{=it.min}}</span></span>\n\t\t\t<span class="maxvalue"><span>{{=it.max}}</span></span>\n\t\t</div>\n\t\t{{?}}\n\t</div>\n</div>\n'})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/ui/Slider",["jquery","underscore","../lib/@waca/core-client/js/core-client/ui/core/View","text!./templates/Slider.template","../lib/@waca/core-client/js/core-client/i18n/Formatter","../nls/StringResources","bootstrap-slider"],(function(e,t,i,n,a,o,s){var r=i.extend({templateString:n,leftTooltip:null,leftTooltipArrow:null,leftTooltipInput:null,rightTooltip:null,rightTooltipArrow:null,rightTooltipInput:null,tooltipPadding:5,events:{"change .tooltipHandle input":"onInputChange","keyup .tooltipHandle input":"onKeyUp","keydown .tooltipHandle input":"onKeyDown","keypress .tooltipHandle input":"onKeyPress","mousedown .tooltipHandle input":"onMouseDownTooltip","focus .tooltipHandle input":"onInputFocus","blur .tooltipHandle input":"onInputBlur","keydown div.slider-handle.round":"onHandleKeyDown"},init:function(e){r.inherited("init",this,arguments),t.defaults(e,{sliderId:"slider",min:0,max:10,precision:20,value:0,inverted:!1,enabled:!0,minimized:!1,indeterminate:!1,showMinMax:!0,valueFormatter:this.valueFormatter,prettyValue:this.prettyValue,tooltipTemplate:'<input tabindex="-1" type="text" aria-label="'+o.get("sliderInputLabel")+'"></input>',style:"simple"}),e.min===e.max&&(e.enabled=!1),e.indeterminate&&(e.value=e.max,e.enabled=!1,e.minimized=!0),e.minimized&&(e.showMinMax=!1),this.options=e},valueFormatter:function(e){return e},_getKeyCode:function(e){return e.keyCode||e.which},prettyValue:function(e){return e},setFocus:function(){this.$(".slider-handle").first().focus()},render:function(){var t=this,i=!0,n=this.options.value instanceof Array;this.$el.empty();var a=this.dotTemplate({min:this.options.min,max:this.options.max,value:this.options.value,showMinMax:this.options.showMinMax,isRange:n,minimized:this.options.minimized});this.$el.attr("role","application"),this.$el.attr("aria-label",o.get("sliderRegionLabel")),this.$el.html(a);var r=this.$el.find(".slider-container");r.addClass(this.options.style);var l,c=r.find(".slider-control");c.attr("id",this.options.sliderId),this._slider=new s(c.get(0),{tooltip:"hide",value:this.options.value,min:this.options.min,max:this.options.max,step:this.options.step,precision:this.options.precision}),this.$el.find(".tooltip").remove();var u=void 0;if(this.options.minimized)r.addClass("minimized"),this.options.indeterminate&&r.addClass("indeterminate"),u=Promise.resolve();else{this._slider.on("slide",this.onSlide.bind(this)).on("slideStart",this.onSlideStart.bind(this)).on("slideStop",this.onSlideStop.bind(this));var d=this.$el.find(".tooltipHandle"),h=d.find(".tooltip-inner");if(d.css({position:"absolute"}),d.hide(),d.find(".tooltipHandle .tooltip-arrow").css({left:"0",right:"0",padding:"0","margin-left":"auto","margin-right":"auto",width:"0",height:"0"}),this.sliderSelection=this.$el.find(".slider-selection"),this.sliderTrack=this.$el.find(".slider-track"),l=this.$el.find(".slider-handle"),n&&r.hasClass("dual")){this.leftLinkLineTop=this.$el.find(".lineSegment.top .linkLine.left"),this.rightLinkLineTop=this.$el.find(".lineSegment.top .linkLine.right"),this.leftLinkLineBottom=this.$el.find(".lineSegment.bottom .linkLine.left"),this.rightLinkLineBottom=this.$el.find(".lineSegment.bottom .linkLine.right");var p=e('<div class="angle"></div>'),g=e('<div class="box"></div>');p.appendTo(l),g.appendTo(l),this.rightHandle=l.eq(1),this.leftTooltip=d.eq(0),this.rightTooltip=d.eq(1),this.leftTooltipInner=h.eq(0),this.rightTooltipInner=h.eq(1)}else this.sliderTrack.append('<div class="dummy"></div>'),this.rightHandle=l,this.rightTooltip=d,this.rightTooltipArrow=this.rightTooltip.find(".tooltip-arrow"),this.rightTooltipInner=h;this.updateTooltips(),this.updateFilterRangeInfo(),i=!1,u=new Promise((function(e,i){try{setTimeout((function(){t.layout(),t.leftTooltip&&t.leftTooltip.fadeIn(),t.rightTooltip.fadeIn(),e()}),100)}catch(e){i(e)}}))}return this.options.inverted&&this.invert(),this.setEnabled(this.options.enabled),this.setSliderAriaLabel(l),i&&(u=Promise.resolve()),u},setSliderAriaLabel:function(e){e&&e.length>0&&(e.get(0).style.left&&(e.attr("role","slider"),e.attr("aria-valuenow",o.get("a11ySliderHandleLabel",{sliderValue:this.options.prettyValue(this.getValue())}))))},getValue:function(){return this.options.value},getMin:function(){return this.options.min},getMax:function(){return this.options.max},isInverted:function(){return this.inverted},invert:function(){this.inverted=!this.inverted,this.$el.find(".slider-container").toggleClass("invert"),this.options.invertedTooltipTemplate&&(this.updateTooltips(),this.updateFilterRangeInfo(),this.layout())},isCleared:function(){if(this._applyFilter)return!1;var e=this.getValue();return e instanceof Array?!this.inverted&&(e[0]===this.getMin()&&e[1]===this.getMax()):this.inverted?e===this.getMax():e===this.getMin()},clear:function(){this.isInverted()&&this.invert();var e,t=this.getMin(),i=this.getMax();e=this.getValue()instanceof Array?[t,i]:this.inverted?t:i,this.setValue(e),this.updateFilterRangeInfo()},remove:function(){this._slider&&this._slider.destroy(),this._slider=null,r.inherited("remove",this,arguments)},updateValue:function(){this._slider&&(this.options.value=this._slider.getValue()),this.setSliderAriaLabel(this.$el.find(".slider-handle"))},updateFilterRangeInfo:function(){var e=this.$el.parents().find(".titleInfo .rangeInfo");if(this.options.value instanceof Array&&(this.options.min!==this.options.value[0]||this.options.max!==this.options.value[1])){if(this.leftTooltipInner){var t=this.leftTooltipInner.text(),i=this.rightTooltipInner.text(),n=this.options.prettyValue(this.options.value);this.inverted?e.text(t+n[0]+" "+i+n[1]):e.text(n[0]+" - "+n[1])}}else e.text("")},setValue:function(e,t){this.options.value=e,this._slider&&(this._slider.setValue(e),this.layout()),this.triggerOnChange(),t||this.triggerSlideStop()},setStep:function(e){this.options.step=e,this._slider&&this._slider.setAttribute("step",e)},setMin:function(e){this.options.min=e,this._slider&&this._slider.setAttribute("min",e)},setMax:function(e){this.options.max=e,this._slider&&this._slider.setAttribute("max",e)},setEnabled:function(e){e?(this._slider.enable(),this.$el.find(".slider-container").removeClass("disabled")):(this._slider.disable(),this.$el.find(".slider-container").addClass("disabled"))},onKeyDown:function(e){13===e.keyCode&&(e.preventDefault(),this.onInputChange(e))},onKeyUp:function(){},onKeyPress:function(){this.layoutTooltips()},onMouseDownTooltip:function(t){e(t.target).is(":focus")||(t.preventDefault(),t.stopPropagation(),t.target.select())},onInputFocus:function(t){e(t.target).parent().addClass("focus"),t.preventDefault(),t.stopPropagation()},onInputBlur:function(t){e(t.target).parent().removeClass("focus")},calculateTooltipsWidth:function(){this.leftTooltipInput&&(this.leftTooltipWidth=this.calculateTooltipWidth(this.leftTooltipInput)),this.rightTooltipWidth=this.calculateTooltipWidth(this.rightTooltipInput)},calculateTooltipWidth:function(e){var t=20+5*(e.val().length+1),i=Math.floor((this.sliderTrack.width()-this.tooltipPadding)/1.3);return t>i&&(t=i),t},updateTooltipsWidth:function(){this.leftTooltipInput&&this.updateTooltipWidth(this.leftTooltip,this.leftTooltipWidth),this.updateTooltipWidth(this.rightTooltip,this.rightTooltipWidth)},updateTooltipWidth:function(e,t){e.attr("aria-label",e.attr("value")),e.css({width:t+"px"})},onInputChange:function(t){var i,n,o=e(t.currentTarget),s=0,r=0;"left"===o.data("input")?(r=a.parseDecimal(o.val()),s=this.rightTooltipInput.data("value")?this.rightTooltipInput.data("value"):this.rightTooltipInput.val()):"right"===o.data("input")&&(this.leftTooltipInput&&(r=this.leftTooltipInput.data("value")?this.leftTooltipInput.data("value"):this.leftTooltipInput.val()),s=a.parseDecimal(o.val())),this.options.value instanceof Array?(i=this.validate(r,s),r===(i=this.options.valueFormatter(i))[0]&&s===i[1]||(n=this.options.prettyValue(i),this.leftTooltipInput.data("value",i[0]),this.leftTooltipInput.val(n[0]),this.rightTooltipInput.data("value",i[1]),this.rightTooltipInput.val(n[1]))):(i=this.validateMax(s),s!==(i=this.options.valueFormatter(i))&&(n=this.options.prettyValue(i),this.rightTooltipInput.data("value",i),this.rightTooltipInput.val(n))),i[0]<this.options.value[0]&&(this._applyFilter=!0,this.setMin(i[0])),i[1]>this.options.value[1]&&(this._applyFilter=!0,this.setMax(i[1])),this.setValue(i),this.updateFilterRangeInfo()},updateTooltips:function(){var t,i;this.options.tooltipTemplate instanceof Array?(this.inverted&&this.options.invertedTooltipTemplate?(t=this.options.invertedTooltipTemplate[0],i=this.options.invertedTooltipTemplate[1]):(t=this.options.tooltipTemplate[0],i=this.options.tooltipTemplate[1]),this.leftTooltipInner.html(e(t)),this.rightTooltipInner.html(e(i))):this.rightTooltipInner.html(e(this.options.tooltipTemplate));this.updateInputs()},updateInputs:function(){this.rightTooltipInput=this.rightTooltip.find("input"),this.rightTooltipInput.data("input","right"),this.leftTooltip&&(this.leftTooltipInput=this.leftTooltip.find("input"),this.leftTooltipInput.data("input","left"))},layoutValues:function(){this.updateValue();var e=this.options.valueFormatter(this.getValue()),t=this.options.prettyValue(e);this.leftTooltip?(this.leftTooltipInput.data("value",e[0]),this.leftTooltipInput.val(t[0]),this.rightTooltipInput.data("value",e[1]),this.rightTooltipInput.val(t[1])):(this.rightTooltipInput.data("value",e),this.rightTooltipInput.val(t))},layout:function(){this.layoutValues(),this.layoutTooltips()},layoutTooltips:function(){this.calculateTooltipsWidth(),this.calculateRightTooltip(),this.leftTooltip&&(this.calculateLeftTooltip(),this.calculateCollisions(),this.paintLines(),this.layoutTooltip(this.leftTooltip,this.leftTooltipCenter,this.leftTooltipMarginLeft)),this.layoutTooltip(this.rightTooltip,this.rightTooltipCenter,this.rightTooltipMarginLeft),this.rightTooltipArrow&&this.layoutTooltipArrow(this.rightTooltipArrow,this.rightTooltipArrowLeft),this.updateTooltipsWidth()},layoutTooltip:function(e,t,i){e.css({left:t,"margin-left":i})},layoutTooltipArrow:function(e,t){e.css({left:t})},paintLines:function(){this.leftLinkLineTop.css({left:Math.min(this.leftHandleCenter,this.leftTooltipCenter),width:this.leftHandleCenter-this.leftTooltipCenter}),this.rightLinkLineTop.css({left:this.rightHandleCenter,width:this.rightTooltipCenter-this.rightHandleCenter}),this.leftLinkLineBottom.css({left:this.leftHandleCenter}),this.rightLinkLineBottom.css({left:this.rightHandleCenter})},calculateLeftTooltip:function(){var e=this.leftTooltipWidth,t=Math.floor(this.sliderSelection.position().left);this.leftHandleCenter=t;var i=t;i=this.checkLeftBoundaryForLeftTooltip(i,e),i=this.checkRightBoundary(i,e);var n=Math.floor(-e/2);this.leftTooltipCenter=i,this.leftTooltipMarginLeft=n,this.leftTooltipWidth=e},calculateRightTooltip:function(){var e=this.rightTooltipWidth,t=Math.floor(this.rightHandle.position().left);this.rightHandleCenter=t;var i=t;i=this.checkLeftBoundaryForRightTooltip(i,e),i=this.checkRightBoundary(i,e);var n=Math.floor(-e/2);this.rightTooltipCenter=i,this.rightTooltipMarginLeft=n,this.rightTooltipArrow&&(this.rightTooltipArrowLeft=2*(t-i)),this.rightTooltipWidth=e},calculateCollisions:function(){var e=this.tooltipPadding,t=this.leftTooltipCenter+this.leftTooltipWidth/2,i=this.rightTooltipCenter-this.rightTooltipWidth/2-t-e;if(i<0){var n=Math.floor(i/2);if(this.leftTooltipCenter+=n,this.rightTooltipCenter-=n,this.leftTooltipCenter<=this.tooltipMinLeftForLeftTooltip)this.leftTooltipCenter=this.tooltipMinLeftForLeftTooltip,this.rightTooltipCenter=this.leftTooltipCenter+this.leftTooltipWidth/2+e+this.rightTooltipWidth/2;else{var a=this.rightTooltipCenter+this.rightTooltipWidth/2,o=this.sliderTrack.position().left+this.sliderTrack.width()+15;(i=a-o)>0&&(this.rightTooltipCenter=o-this.rightTooltipWidth/2,this.leftTooltipCenter=this.rightTooltipCenter-this.rightTooltipWidth/2-e-this.leftTooltipWidth/2)}this.rightTooltipCenter=Math.floor(this.rightTooltipCenter),this.leftTooltipCenter=Math.floor(this.leftTooltipCenter)}},checkLeftBoundaryForLeftTooltip:function(e,t){var i=this.sliderTrack.position().left+t/2-15;return this.tooltipMinLeftForLeftTooltip=i,e<i&&(e=i),e},checkLeftBoundaryForRightTooltip:function(e,t){var i=this.sliderTrack.position().left+t/2-15;return e<i&&(e=i),e},checkRightBoundary:function(e,t){var i=this.sliderTrack.position().left+this.sliderTrack.width()-t/2+15;return this.tooltipMaxRight=i,e>i&&(e=i),e},onSlide:function(){this.layout(),this.triggerOnChange()},onSlideStart:function(){this.sliding=!0},onSlideStop:function(){this.sliding=!1,this.updateValue(),this.updateFilterRangeInfo(),this.layout(),this.triggerOnChange(),this.triggerSlideStop()},triggerSlideStop:function(){this.trigger("action:slidestop",{})},triggerOnChange:function(){this.trigger("action:change",{})},validate:function(e,t){if(e=this.validateMin(e),void 0!==t){if((t=this.validateMax(t))<e){var i=t;t=e,e=i}return[e,t]}return e},validateMin:function(e){return isNaN(e)&&(e=this.options.min),this.validateBoundary(e)},validateMax:function(e){return isNaN(e)&&(e=this.options.max),this.validateBoundary(e)},validateBoundary:function(e){if(this.options.noMinMaxRestriction)"number"!=typeof e&&(e=Number(e));else{var t=this.options.min;if(e<=t)return t;var i=this.options.max;if(e>=i)return i}return e}});return r})),define("dashboard-analytics/visualizations/renderer/infographic/InfographicScaleView",["underscore","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/core-client/js/core-client/ui/core/View","../../../lib/@waca/dashboard-common/dist/ui/Slider","../../../lib/@waca/dashboard-common/dist/utils/ScaleUtil"],(function(e,t,i,n,a){"use strict";var o={};o[a.SCALE_VALUE_FEW]=t.get("propScaleFew"),o[a.SCALE_VALUE_DEFAULT]=t.get("propScaleDefault"),o[a.SCALE_VALUE_MANY]=t.get("propScaleMany");var s=i.extend({init:function(t){s.inherited("init",this,arguments),e.extend(this,t)},remove:function(){this.slider&&this.slider.off("action:slidestop",this._onWidgetScaleUpdate,this),s.inherited("remove",this,arguments)},render:function(){this.$el.css({height:93,width:200});var e=a.getMinMax(this.widgetValue,this.isPercent),i={el:this.$el[0],name:"scaleSlider",label:t.get("propScaleLabel"),type:"slider",description:t.get("propScaleDescription"),min:e.min,max:e.max,step:1,showMinMax:!1,value:this.currentScaleOption,style:"simple",valueFormatter:this.valueFormatter.bind(this)};return this.slider=new n(i),this.slider.render()},notifyRenderComplete:function(){this.slider&&(this.slider.layout(),this.slider.on("action:slidestop",this._onWidgetScaleUpdate,this))},_onWidgetScaleUpdate:function(){var e=this.slider.getValue();this.content.setPropertyValue("value.graphic.currentScaleOption",e)},valueFormatter:function(e){return o[e]||e},setFocus:function(){this.slider&&this.slider.setFocus()}});return s})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/ui/Toolbar",["jquery","underscore","../DynamicFileLoader","../lib/@waca/core-client/js/core-client/ui/core/View"],(function(e,t,i,n){var a=n.extend({moduleMap:[],addItemsReady:null,init:function(e){a.inherited("init",this,arguments),this.options=this.options?this.options:{},t.extend(this.options,e),this.items=e.items,this.itemMap={},this._readyArray=[],this._reactToolbarContainer=null,this._isReactToolbar=this._canRenderInReactToolbar(e.items),this._activeFlyoutView=null},addItem:function(e){return this._addItem(e)},_addItem:function(t){var i=e("<div>");return this.$el.append(i),this._renderItem(t,i)},_renderItem:function(e,t){e.type||e.module||(e.type="Menu");var i=e.type?"ui/toolbar_components/"+e.type:e.module;return this._renderItemHelper(i,e,t)},_renderItemHelper:function(e,t,n){var a=this,o=i.load([e]).then((function(e){var i=e[0];t.el=n;var o=new i(t,a.rootMenu||a.parentView,a);return a.itemMap[o.name]=o,Promise.resolve().then(o.render.bind(o))}));return this._readyArray.push(o),o},removeItem:function(e){this.itemMap[e].remove(),delete this.itemMap[e]},_canRenderInReactToolbar:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=function(e){return"SubView"!==e.type};return this.options.reactToolbar&&e.every(t)},addItems:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=this._canRenderInReactToolbar(t);return this._isReactToolbar&&!n&&this._reactToolbarContainer&&(this._reactToolbarContainer.destroy(),this._reactToolbarContainer=null),this._isReactToolbar=n,this._isReactToolbar?(this._reactToolbarContainer?(this._reactToolbarContainer.setItems(t),this.addItemsReady=Promise.resolve()):this.addItemsReady=i.load(["ui/react_toolbar/ReactToolbarContainer"]).then((function(i){var n=i[0];e._reactToolbarContainer=new n(t,e.el,e)})),this.addItemsReady.then((function(){e.itemMap=t}))):this.addItemsReady=Promise.all(t.map((function(t){return e._addItem(t)}))),this.addItemsReady},setActiveFlyoutView:function(e){this._activeFlyoutView&&e!==this._activeFlyoutView&&this._activeFlyoutView.remove&&this._activeFlyoutView.remove(),this._activeFlyoutView=e},getActiveFlyoutViewName:function(){return this._activeFlyoutView&&this._activeFlyoutView.name},clearItems:function(){t.each(this.itemMap,(function(e){e.remove&&e.remove()})),this._isReactToolbar?this._reactToolbarContainer&&this._reactToolbarContainer.clearItems():this.$el.empty(),this.itemMap={},this._readyArray=[]},render:function(){return this.$el.empty(),this.items?this.addItems(this.items):Promise.resolve()},ready:function(){var e=this;return this._isReactToolbar?this.addItemsReady.then((function(){var t=e.options.preferredVertical?"vertical":"horizontal";return t="top"===e.placement?"horizontal":t,e._reactToolbarContainer.ready(t)})):Promise.all(this._readyArray)},setFocus:function(){var e=Object.keys(this.itemMap)[0];if(e){var t=this.itemMap[e];t&&t.setFocus&&t.setFocus()}},updateButtons:function(){this.itemMap&&t.each(this.itemMap,(function(e){e.update&&e.render()}))},remove:function(){this.clearItems(),this._reactToolbarContainer&&(this._reactToolbarContainer.destroy(),this._reactToolbarContainer=null),a.inherited("remove",this,arguments)}});return a})),define("text!dashboard-analytics/lib/@waca/dashboard-common/dist/ui/templates/Labels.template",[],(function(){return'{{? it.title}}\n<div class="labelsTitle{{?it.labels && it.labels.length > 0}} borderBottom{{?}}">{{!it.title}}</div>\n{{?}}\n{{~ it.labels :label:index}}\n<div class="labelEntry{{? index !== it.labels.length-1 }} borderBottom{{?}}">\n\t<div class="labelName">{{!label.name}}</div>\n\t{{?label.value}}\n\t<div class="labelValue">{{!label.value}}</div>\n\t{{?}}\n</div>\n{{~}}\n'})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/ui/Labels",["../lib/@waca/core-client/js/core-client/ui/core/View","../lib/@waca/core-client/js/core-client/i18n/Formatter","../nls/StringResources","text!./templates/Labels.template","underscore"],(function(e,t,i,n,a){var o=e.extend({templateString:n,init:function(e){o.inherited("init",this,arguments),this.labels=e.labels,this.title=e.title,this._formatter=e.formatter||t},render:function(){var e=[];if(this.labels)for(var t=0;t<this.labels.length;t++){var n=this.labels[t],o=this._getValue(n),s=o?"toolbarLabel":"toolbarNoValueLabel";e.push({name:i.get(s,{labelName:a.escape(n.name)}),value:o})}var r=this.dotTemplate({title:a.escape(this.title),labels:e});this.$el.addClass("labels"),this.$el.html(r)},_getValue:function(e){var t=e.value,i=e.formatSpec;if(i&&!isNaN(t)){var n=i.validFormatSpec||i.formatSpec;return n&&(i=n),this._formatter.format(t,i)}return t}});return o})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/ui/CustomTooltip",["../lib/@waca/core-client/js/core-client/ui/core/View","react-dom","react"],(function(e,t,i){var n=e.extend({init:function(e,t){n.inherited("init",this,arguments),this.tooltipContentRenderer=e,this.options=t},render:function(){try{var e=this.tooltipContentRenderer.getComponentList(this.options);t.render(i.createElement("div",{className:"tooltipContainer"},e),this.$el[0])}catch(e){this.$el.append(e.toString())}}});return n})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/ui/interaction/Utils",["jquery"],(function(e){return function(){function t(){_classCallCheck(this,t)}return t.setTopLeft=function(e,t,i){e.style.left=i+"px",e.style.top=t+"px"},t.getStyleIntValue=function(e){var t=parseFloat(e);return isNaN(t)?0:Math.round(t)},t.removeEvents=function(e){for(var t=0;t<e.length;t++)e[t].off()},t.position=function(e){var t=window.getComputedStyle(e);return{top:e.offsetTop-this.getStyleIntValue(t.marginTop),left:e.offsetLeft-this.getStyleIntValue(t.marginLeft)}},t.widgetSize=function(t){var i=e(t);return{height:i.outerHeight(),width:i.outerWidth()}},t.getContentWithoutDecoration=function(t){return e(t).children("*:not(.selectionBox, .resizeEdge, .resizeBox)")},t.getAngleRadian=function(e){var t=function(e){return Math.abs(e)<1e-7?0:e},i=0;try{var n=window.getComputedStyle(e,null),a=n.getPropertyValue("-webkit-transform")||n.getPropertyValue("-moz-transform")||n.getPropertyValue("-ms-transform");if((a=a||n.getPropertyValue("-o-transform")||n.getPropertyValue("transform"))&&a.indexOf(",")>0){var o=a.split("(")[1].split(")")[0].split(","),s=t(o[1]),r=t(o[0]);i=Math.atan2(s,r)}}catch(e){console.warn(e)}return i},t.getAngleFromMatrix=function(e){var t=0;if(e&&"none"!==e){var i=e.split("(")[1];if(i){var n=i.split(")")[0].split(","),a=n[0],o=n[1];t=Math.round(this.radianToDegree(Math.atan2(o,a)))}}return(t%360+360)%360},t.getAbsoluteAngleRadian=function(t,i){for(var n=e(t).parents(),a=this.getAngleRadian(t),o=void 0,s=0,r=n.length;s<r&&(o=n[s],a+=this.getAngleRadian(o),i!==o);s++);return a},t.getAngleDegree=function(e){return this.radianToDegree(this.getAngleRadian(e))},t.radianToDegree=function(e){return e*(180/Math.PI)},t.setRotateTransform=function(e,t){var i="rotate("+t+"deg)",n=e.style;n.transform=i,n.oTransform=i,n.msTransform=i,n.mozTransform=i,n.webkitTransform=i},t.getCenter=function(e){return this.getRectCenter(e.getBoundingClientRect())},t.getRectCenter=function(e){return{left:Math.round(e.left)+Math.round(e.width)/2,top:Math.round(e.top)+Math.round(e.height)/2,height:e.height,width:e.width}},t.getRotatedCoordinates=function(e,t,i,n){var a=Math.PI/2-this.getAbsoluteAngleRadian(e),o=n?this.getRectCenter(n):this.getCenter(e),s=t-o.left,r=i-o.top,l=o.height,c=o.width;return{x:Math.round(c/2+(s*Math.sin(a)+r*Math.cos(a))),y:Math.round(l/2+(r*Math.sin(a)-s*Math.cos(a)))}},t.getMinMaxTopLeft=function(e,t){var i,n={},a=void 0,o=void 0,s=void 0;for(a=0,i=e.length;a<i;a++)s=t(e[a]),(void 0===n.minTop||s.top<n.minTop)&&(n.minTop=s.top),(void 0===n.minLeft||s.left<n.minLeft)&&(n.minLeft=s.left),o=s.top+s.height,(void 0===n.maxTop||o>n.maxTop)&&(n.maxTop=o),o=s.left+s.width,(void 0===n.maxLeft||o>n.maxLeft)&&(n.maxLeft=o);return n},t.getNodes=function(e,t){var i=[];return t&&t.length&&t.forEach((function(t){var n=e.layoutController.getLayoutView(t);n&&n.domNode&&i.push(n.domNode)})),i},t.getInnerSize=function(e){var t=window.getComputedStyle(e),i=e.clientWidth-parseFloat(t.paddingLeft)-parseFloat(t.paddingRight);return{height:e.clientHeight-parseFloat(t.paddingTop)-parseFloat(t.paddingBottom),width:i}},t}()})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/ui/AuthoringToolbar",["jquery","underscore","./Toolbar","./Labels","./CustomTooltip","./interaction/Utils","../utils/Flyout","../nls/StringResources"],(function(e,t,i,n,a,o,s,r){var l=null;return l=i.extend({baseClass:"toolbar authoringToolbar",init:function(e){this.options=e,l.inherited("init",this,arguments),this.$el.addClass(this.baseClass),this.id=t.uniqueId("authtb_"),this.selectionNodes=[],this._viewStack=[],this._savedItemSpecs=[],this.isOpened=!1,this._labelsView=null,this._labelsAsActionView=null,this._cbOnPopupClosed=this.options.cbOnPopupClosed},_addLabelsView_asAction:function(t){this._labelsAsActionView&&this._labelsAsActionView.remove(),this._labelsAsActionView=e('<div class="labelsAsActionToolBar"></div>'),this._labelsAsActionView.prepend(t)},_renderCaptionButton:function(t,i,n,a,o){t.addClass("caption");var s=e('<span class="'+i+'" tabindex="0" style="float:'+a+'"></span>');s.attr({"aria-label":r.get(n)}),t.addClass("child"),t.prepend(s),t.on("primaryaction",o)},closeFlyout:function(){this.closeButtonEnabled?this.hide(1):!1!==this.goToPreviousEnabled&&this.showPreviousView()},getRenderedHtml:function(){var t;if((t=this.options.textOnly?e('<div class="toolbarTextPopoverContent"></div>'):e('<div class="toolbarPopoverContent"></div>')).attr({role:"region","aria-label":this.name||r.get("toolbarRegionLabel")}),this.itemMap.subview&&this.itemMap.subview.subView.showBoxShadow&&t.addClass("toolbarBoxShadow"),this._reactHeadingRenderer)this._reactHeadingRenderer(t[0]),this._reactHeadingRenderer=null;else if(this.name&&this.showCaption){var i=e("<h1>").text(this.name);this.closeButtonEnabled?this._renderCaptionButton(i,"wfg_shape_x","dlg_close","right",this.hide.bind(this)):!1!==this.goToPreviousEnabled?(i.addClass("caption"),(this.options.launchView||this._viewStack.length)&&this._renderCaptionButton(i,"wfg_leftarrow","dlg_back","left",this.showPreviousView.bind(this))):i.addClass("staticNextViewCaption"),t.append(i)}return this._labelsView&&(this.itemMap.subview||t.append(this._labelsView.$el)),this._labelsAsActionView&&t.append(this._labelsAsActionView),Object.getOwnPropertyNames(this.itemMap).length>0&&(this._labelsView&&!this.options.isTextEditorOnly&&t.append('<div class="separator"></div>'),this.$el.hasClass("textOnlyToolBar")&&this.$el.removeClass("textOnlyToolBar"),t.append(this.$el)),this.options.isTextEditorOnly&&(this._labelsView&&this._labelsView.$el.addClass("textOnlyToolBar"),this.$el.addClass("textOnlyToolBar")),t},setFocus:function(){this.itemMap.subview&&this.itemMap.subview.subView.setFocus?this.itemMap.subview.subView.setFocus():this.options.noFocus||l.inherited("setFocus",this,arguments)},setLabels:function(e){this._labelsView&&(this._labelsView.remove(),this._labelsView=null),e.tooltipRenderer&&e.tooltipContext&&e.tooltipRenderer.canRender(e.tooltipContext)?(this._labelsView=new a(e.tooltipRenderer,e.tooltipContext),this._labelsView.render()):(e.labels||e.title)&&(this._labelsView=new n(e),this._labelsView.render())},setName:function(e){this.name=e||null},setShowCaption:function(e){this.showCaption=e},setReactHeadingRenderer:function(e){this._reactHeadingRenderer=e},enableGoPrevious:function(e){this.goToPreviousEnabled=!1!==e},enableClose:function(e){this.closeButtonEnabled=!!e},focusGoPrevious:function(){this.goToPreviousEnabled&&this.$el.prev().find("*[tabindex=0]").first().focus()},setOptions:function(e){this._options=e,e&&e.addClass&&("string"==typeof e.addClass?this.$el.addClass(e.addClass):this.$el.addClass(e.addClass.join(" ")))},onPopupShown:function(){this.isOpened=!0,this.$boundingRectNode&&this.$boundingRectNode.css("display","none"),this.trigger("toolbar:show",this._options)},_notifyPopupClosed:function(){this._cbOnPopupClosed&&this._cbOnPopupClosed(),this.trigger("toolbar:hide",this._options)},onPopupClosed:function(){var e=this;this.isOpened?this.hide().then((function(){e._notifyPopupClosed()})):this._notifyPopupClosed()},setSelectionContext:function(i){var n=t.union(this.selectionNodes,i).length;this.selectionNodes&&n===i.length&&n===this.selectionNodes.length&&this.lastPositionKey===this.getPositionKey(i)||this._destroyFlyout(),this.launchPoint=this._getSelector(e(i).last()),this.options.launchView&&this.options.launchView.getFlyout&&(this.launchPoint=this.options.launchView.getFlyout().getLaunchPoint()),this.lastPositionKey=this.getPositionKey(),this.selectionNodes=i.slice(),this.selectionBounds=null},_getSelector:function(e){for(var t,i=e;i.length;){var n=i[0],a=n.localName;if(!a)break;a=a.toLowerCase();var o=i.parent(),s=o.children(a);s.length>1&&(a+=":eq("+s.index(n)+")"),t=a+(t?">"+t:""),i=o}return t},getPositionKey:function(e){return t.map(e||this.selectionNodes,(function(e){return[e.offsetTop,e.offsetLeft,e.offsetWidth,e.offsetHeight].join("_")})).sort().join("_")},setSelectionBounds:function(e){this._destroyFlyout(),this.selectionBounds=e,this.selectionNodes=[]},_getFlyoutNode:function(){if(this.options.triggerNode)return this.options.triggerNode;if(this.selectionNodes.length>1||this.selectionBounds||this.options.calculateBoundingRect){if(!this.$boundingRectNode){var t=this.getSelectionBounds(),i=t.minTop,n=t.minLeft,a=document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement;if(t.parent&&t.parent!=a){var o=e(t.parent).offset();i+=o.top,n+=o.left}this.$boundingRectNode=e('<div class="widgetContextNode"></div>');var s=Math.round(t.maxTop-t.minTop),r=Math.round(t.maxLeft-t.minLeft);i=Math.round(i),n=Math.round(n);var l=e("#main");if(l.length){var c=l.height()-i;s=Math.min(s,c)}this.$boundingRectNode.css({position:"absolute",top:i+"px",left:n+"px",height:s+"px",width:r+"px"}),this.$boundingRectNode.appendTo("body"),this.applyDimensionsForBestLocation(t,this.$boundingRectNode)}return this.$boundingRectNode[0]}return 1===this.selectionNodes.length?this.selectionNodes[0]:void 0},applyDimensionsForBestLocation:function(e,t){var i=Math.round(e.maxLeft-e.minLeft),n=Math.round(e.maxTop-e.minTop),a=Math.min(i,n),o=t[0].getBoundingClientRect();if(Math.round(o.width)>i||Math.round(o.height)>n){t.css({top:e.minTop+"px",left:e.minLeft+"px",height:a+"px",width:a+"px"});var s=t[0].getBoundingClientRect();Math.round(s.top)>Math.round(o.top)&&t.css({top:e.maxTop-a+"px",left:e.maxLeft-a+"px",height:a+"px",width:a+"px"})}if(this.selectionNodes&&this.selectionNodes.length>0){var r=this.selectionNodes[0].parentNode;if(r&&r.getBoundingClientRect){var l=r.getBoundingClientRect();o=t[0].getBoundingClientRect();var c=Math.max(o.top,l.top),u=Math.min(o.bottom,l.bottom),d=Math.max(o.left,l.left),h=Math.min(o.right,l.right);t.css({top:c+"px",left:d+"px",height:u-c+"px",width:h-d+"px"})}}},getSelectionBounds:function(){return this.selectionBounds?{minTop:this.selectionBounds.top,minLeft:this.selectionBounds.left,maxTop:this.selectionBounds.top+this.selectionBounds.height,maxLeft:this.selectionBounds.left+this.selectionBounds.width,parent:this.selectionBounds.parent}:o.getMinMaxTopLeft(this.selectionNodes,(function(t){var i=e(t).offset(),n=t.scrollHeight-t.clientHeight,a=t.scrollWidth-t.clientWidth;i.top-=n/2,i.left-=a/2;var o=t.getBoundingClientRect();return i.height=Math.max(o.height,o.height+n),i.width=Math.max(o.width,o.width+a),i}))},pushItemsOnStack:function(){this._viewStack.push({name:this.name,items:this._savedItemSpecs}),this._savedItemSpecs=[]},showPreviousView:function(){var e=this;if(this._viewStack.length){var t=this._viewStack.pop();return this.hide(1).then((function(){e.clearItems(),e.setName(t.name)})).then(this.addItems.bind(this,t.items)).then(this.show.bind(this,this.placement))}return this.options.launchView&&this.options.backButtonCallback&&(this.flyout.destroy(),this.options.backButtonCallback.apply(this.options.launchView)),Promise.resolve()},clearHistory:function(){this._viewStack=[]},clearItems:function(){this._savedItemSpecs=[],this._labelsAsActionView&&(this._labelsAsActionView.remove(),this._labelsAsActionView=null),l.inherited("clearItems",this,arguments)},show:function(e){var t=this,i=this._getFlyoutNode();return i?(this._createFlyout(i,e||this.options.placement),this.ready().then((function(){t.flyout&&!t.isOpened&&(t.$boundingRectNode&&t.$boundingRectNode.css("display","block"),t.trigger("toolbar:show:before",t._options),t.flyout.open(i),t.notifyItemsOpened())}))):Promise.reject()},_createFlyout:function(e,i){if(!this.flyout){var n=t.extend({selector:e,viewInstance:this,flyoutClass:this._getPopoverClass(i),launchPoint:this.launchPoint},this.options);n.placement=i||this._getPlacement()||this.options.placement,this.flyout=new s(n),this.launchPoint||(this.launchPoint=this.flyout.getLaunchPoint()),this.options.launchView&&this.options.launchView.setFlyout&&this.options.launchView.setFlyout(this.flyout)}},_getPopoverClass:function(e){return this.options.preferredVertical&&"top"!==e?"actionToolbarPopover vertical":this.options.preferredVertical?"actionToolbarPopover horizontal":"actionToolbarPopover"},_getPlacement:function(){return this.options.preferredVertical?"left":"top"},_getTopParentNode:function(){return e(this.selectionNodes[0]).parents(".page").get(-1)||e("body")[0]},hide:function(e){return this._savedItemSpecs=[],this._destroyFlyout(e),Promise.resolve()},_restoreTitle:function(){var t=this.options&&this.options.triggerNode&&e(this.options.triggerNode);if(t){var i=t.attr("title")||t.attr("data-original-title")||"";t.attr("title",i)}},_destroyFlyout:function(e){var t=this;this.isOpened=!1,this.launchPoint=null,this.notifyItemsDestroyFlyout(),this.flyout&&(this.flyout.destroy(),this.flyout=null),t.$boundingRectNode&&(t.$boundingRectNode.remove(),t.$boundingRectNode=null),e||this.clearHistory()},notifyItemsOpened:function(){t.each(this.itemMap,(function(e){e.notifyRenderComplete&&e.notifyRenderComplete()}))},notifyItemsDestroyFlyout:function(){this._restoreTitle(),t.each(this.itemMap,(function(e){e.onFlyoutDestroyed&&e.onFlyoutDestroyed()}))},addItem:function(e){return this._updateActionHandler(e),this._isLabelOnly(e)?this._addLabelOnlyItem(e):l.inherited("addItem",this,arguments)},addItems:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this._savedItemSpecs=t;var i=[],n=[];return t.forEach((function(t){e._updateActionHandler(t),e._isLabelOnly(t)?n.push(e._addLabelOnlyItem(t)):i.push(t)})),n.push(l.inherited("addItems",this,[i])),Promise.all(n)},_addLabelOnlyItem:function(t){var i=e("<div>");return this._addLabelsView_asAction(i),this._renderItem(t,i)},_isLabelOnly:function(e){return e.labelOnly},_updateActionHandler:function(e){e.closeOnActionApplied&&(e.action&&(e.action=this._applyActionThenClose.bind(this,e.action)),e.actions&&(e.actions.apply=this._applyActionThenClose.bind(this,e.actions.apply))),e.removeOnActionApplied&&(e.action&&(e.action=this._applyActionThenRemove.bind(this,e.action)),e.actions&&(e.actions.apply=this._applyActionThenRemove.bind(this,e.actions.apply))),e.removeThenApplyAction&&(e.action&&(e.action=this._removeThenApplyAction.bind(this,e.action)),e.actions&&(e.actions.apply=this._removeThenApplyAction.bind(this,e.actions.apply)))},_applyActionThenClose:function(e){var t=[].concat(Array.prototype.slice.call(arguments));e.apply(this,t.shift()),this.hide()},_applyActionThenRemove:function(e){var t=[].concat(Array.prototype.slice.call(arguments));e.apply(this,t.shift()),this.remove(!0)},_removeThenApplyAction:function(e){this.remove(!0);var t=[].concat(Array.prototype.slice.call(arguments));e.apply(this,t.shift())},remove:function(e){this.clearItems(),this._destroyFlyout(),e&&this.trigger("toolbar:remove",this._options),l.inherited("remove",this,arguments)},focus:function(){if(this.isOpened){var t=e(this.el).find("button");if(t.length>0)return t[0].focus(),!0}return!1},updateButtons:function(){this.itemMap&&t.each(this.itemMap,(function(e){e.update&&e.render()}))}})})),define("dashboard-analytics/visualizations/renderer/infographic/InfographicEventTarget",["jquery","../common/NonVIPREventTarget"],(function(e,t){return function(t){function i(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];e=t.call.apply(t,[this].concat(n))||this;var o=n[0]||{};return e.visControl=o.visControl,e.view=o.view,e.getAPI()||_assertThisInitialized(e)}_inheritsLoose(i,t);var n=i.prototype;return n.getEventTargets=function(t){var i=this._getTargetNode(t);if(!i||"click"===t.type)return[];var n=e(i);return this.mouseWithinBoundCheck(t)?this._getTargets(t,n):[]},n.remove=function(){this.visControl=null,this.view=null,t.prototype.remove.call(this)},n._getTargets=function(e,t){var i=[];return i.push({key:"label",type:"itemclass",source:t,isEdgeSelect:!0,values:this._getTargetValues(),area:"visualization"}),i},n._getTargetValues=function(){var e=[],t=this.view.infographicValue;return t&&e.push({value:t}),e},i}(t)})),define("dashboard-analytics/visualizations/renderer/infographic/InfographicView",["jquery","underscore","../VisView","text!./Infographic.html","../../../util/DashboardFormatter","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/dashboard-common/dist/utils/ScaleUtil","./InfographicScaleView","../../../lib/@waca/dashboard-common/dist/ui/AuthoringToolbar","../../../lib/@waca/core-client/js/core-client/utils/Utils","../../../lib/@waca/core-client/js/core-client/utils/BrowserUtils","../../../lib/@waca/dashboard-common/dist/utils/EventChainLocal","../VisEventHandler","./InfographicEventTarget","../../../DynamicFileLoader"],(function(e,t,i,n,a,o,s,r,l,c,u,d,h,p,g){"use strict";var m=i.extend({className:"dataview infographic-widget",templateString:n,events:{"primaryaction .infographic-scale-wrapper":"infographicToolbar"},init:function(){m.inherited("init",this,arguments),this.animationType=this.ANIMATION_TYPES.NONE,this.toolbarShown=!1,this.isPercent=!1,this.isFirstRender=!0,this.visModel.on("change:theme",this.onChangeTheme,this),this._colorsService=this.dashboardApi.getFeature("Colors"),this._translationService=this.dashboardApi.getDashboardCoreSvc("TranslationService"),this._showTranslationIcon=!1},remove:function(){this.eventHandler&&(this.eventHandler.remove(),this.eventHandler=null),this.visModel&&this.visModel.off("change:theme",this.onChangeTheme,this),this.visControl=null,m.inherited("remove",this,arguments)},getRenderer:function(){return"dashboard-core/js/dashboard/visualizations/renderer/infographic/InfographicRenderer"},animate:function(){this.visModel.renderCompleteBeforeAnimation()},initialize:function(){var e=this;return this.visControl?Promise.resolve(this.visControl):g.load(["dashboard-analytics/visualizations/renderer/infographic/control/InfographicControl"]).then((function(t){var i=t[0];return e.visControl=new i({domNode:e.$el.find(".infographic-widget-content")[0]}),e.eventHandler=new h({target:new p({$el:e.$el,visControl:e.visControl,visAPI:e.visModel,view:e}),dashboardSettings:e.dashboardSettings,transaction:e.transactionApi,logger:e.logger,ownerWidget:e.ownerWidget,visAPI:e.visModel,edgeSelection:!0}),e.visControl}))},_readyToRender:function(){return this.isMappingComplete()&&!this.hasMissingFilters()&&!this.hasUnavailableMetadataColumns()},render:function(e){this.graphicFillColor=this.content.getPropertyValue("value.graphic.fillColor"),this.graphicCurrentScaleOption=this.content.getPropertyValue("value.graphic.currentScaleOption"),this.graphicContent=this.content.getPropertyValue("value.graphic.content");var t=!u.isIE();if(!this._readyToRender())return this.resizeToWidget(e),this.renderIconView(),Promise.resolve(this);this.removeIconView(),this.resizeToWidget(e);var i=this.buildHTML(e.data.getResult(),t);return this.addToDom(i),this.applyVisModelProperties(),c.embedSVGIcon(this.$el),this.updateTranslationIcon(),m.inherited("render",this,arguments)},_renderIconView:function(){this.$el&&this.$el.closest(".infographic-widget").empty().append(this.$iconView),this.visModel.renderCompleteBeforeAnimation(),this.visModel.renderComplete()},summaryReveal:function(){if(this.visModel.renderCompleteBeforeAnimation(),!this._readyToRender())return Promise.resolve();var e=this._fillVertically()?"fillVertical":"fillHorizontal";return this.$el.find(".animate").each((function(t,i){!function(t){t.classList.remove(e),t.clientWidth,t.classList.add(e)}(i)})),Promise.resolve()},removeIconView:function(){this.$iconView&&this.$el&&(this.$el.find('div[class="value"]').addClass("hide"),this.$el.find('div[class="label"]').addClass("hide"),this.$iconView.remove(),this.$iconView=null)},getDescription:function(){var e;if(this.infographicInfo){var t=this.getLabel(),i=o.get("infographicLabel",{label:this.infographicInfo.label,value:this.infographicInfo.v});e=o.get("WidgetLabelWithDescripion",{label:t,description:i})}else e=m.inherited("getDescription",this,arguments);return e},infographicToolbar:function(t){var i=this;if(new d(t).setProperty("preventDefaultContextBar",!0),this.graphicContent&&!this.toolbarShown){var n=new l({container:e("body"),placement:"bottom",calculateBoundingRect:!0}),a=new r({content:this.content,visModel:this.visModel,widget:this.visModel.ownerWidget,widgetValue:this.infographicValue,isPercent:this.isPercent,currentScaleOption:this.graphicCurrentScaleOption});return n.addItems([{responsive:!1,editable:!1,changedAction:null,subView:a,type:"SubView"}]),this.visModel.ownerWidget.on("expandedView:visible",this.onShowExpandedContent.bind(this,n)),this.$el.closest(".page.pageabsolute, .page.pagecontainer").on("scroll.BaseController",this.scaleToolbarOnScroll.bind(this,n)),this.toolbarShown=!0,n.on("toolbar:hide",(function(){a.remove(),i.toolbarShown=!1})),n.on("toolbar:show",(function(){a.setFocus()})),n.setSelectionContext([t.target]),n.show()}},onShowExpandedContent:function(e){this.visModel.ownerWidget.off("expandedView:visible",this.onShowExpandedContent,this),e.hide()},scaleToolbarOnScroll:function(e,t){t.target.classList.contains("page")&&(t.target.classList.contains("pageabsolute")||t.target.classList.contains("pagecontainer"))&&(this.$el.closest(".page.pageabsolute, .page.pagecontainer").off("scroll.BaseController"),e.hide())},buildHTML:function(e,t){this.infographicInfo={};var i=this.content.getFeature("Visualization").getSlots().getMappedSlotList();return i&&0!==i.length?(this.infographicValue=e&&e.getRowCount()>0?e.getValue(0,0).value:null,this.infographicInfo=this._buildHtml(i[0],this.infographicValue,t),this.dotTemplate(this.infographicInfo)):Promise.resolve("")},onChangeTheme:function(){this.visModel.getRenderSequence().reRender()},_showItemLabel:function(){return this.visModel.getPropertyValue("showItemLabel")},_getCustomLabel:function(){return this.visModel.getPropertyValue("baseValueLabel")},_fillVertically:function(){return"BottomToTop"===this.visModel.getPropertyValue("fillDirection")},_valueFormat:function(e,t){var i=e.getFormat();if((t=a.format(t,i)).length<5){var n=t.length<3?"  ":" ";t=n+t+n}return t},_getForegroundColor:function(){var e=this._colorsService.getHexColorFromDashboardColorSet(this.visModel.getPropertyValue("elementColor"));return"transparent"===e&&(e=""),e},getScaleOption:function(){return void 0!==this.graphicCurrentScaleOption?this.graphicCurrentScaleOption:s.SCALE_VALUE_DEFAULT},getScaleValue:function(e,t,i){var n;if(e&&void 0!==t){var a=e.availableScales;if(t===s.SCALE_VALUE_DEFAULT)n=e.optimalScale;else if(t===s.SCALE_VALUE_MANY){var o=a.indexOf(e.optimalScale)-1;o<0&&(o=0),n=a[o]}else{var r=a.indexOf(e.optimalScale)+1;r>a.length-1&&(r=a.length-1),n=a[r]}}else i&&(n=s.calcOptimalValue(i));return n},_calcScale:function(e){var t={},i=s.getScalingProperties(e,this.isPercent);return t.currentScaleOption=this.getScaleOption(),t.scale=this.getScaleValue(i,t.currentScaleOption,e),t.abbreviatedScale=a.format(t.scale,{decimalFormatLength:"short"}),t.scaleComponents=s.getScaleComponents(e,t.scale,this.isPercent),t},_isPercent:function(e,t){var i=e.getFormat();return i&&"percent"===i.type&&Math.abs(t)<=1},_constructShapeStyle:function(e){var t={},i="fill:",n="colorFill";return t.svgClass="Shape","transparent"===this.graphicFillColor&&(n="colorStroke",i="stroke:",t.svgClass="Line"),""!==e?(t.colorClass="",t.coloredStyle='style="'+i+e+'"'):(t.colorClass=n,t.coloredStyle=""),t},_buildHtml:function(e,i,n){var a,o=e.getDataItemList()[0],s=this._getForegroundColor(),r=this._fillVertically(),l=this._constructShapeStyle(s);this.isPercent=this._isPercent(o,i);var c=this._calcScale(i),u=c.scale,d=c.scaleComponents,h=this.graphicContent.match(RegExp('viewBox="(.*?)"')),p=h&&h[1]?h[1]:"0 0 100 100",g=this._extractSvgContent(this.graphicContent),m=this._calculateClipPath({x:p.split(" ")[0],y:p.split(" ")[1],width:p.split(" ")[2],height:p.split(" ")[3]},d,r,n);return a={content:g,scaleComponents:d,percentageScaleValue:this._getPercentageScaleValue(i,u),scale:u,abbreviatedScale:c.abbreviatedScale,viewBox:p,svgId:t.uniqueId("svgDef"),style:l,fillClass:r?"fillVertical":"fillHorizontal",doFillAnimation:n,fillDuration:.5/(d.numShapes+1),clipPathLastElement:m},this.currentScaleOption=c.currentScaleOption,this.numOfShapes=d.numShapes+d.numGreyedShapes,d.partialValue>0&&this.numOfShapes++,{v:i=this._valueFormat(o,i),showTitleString:this._showItemLabel(),label:this._getCustomLabel()||o.getLabel(),infographic:a}},_getPercentageScaleValue:function(e,t){if(!this.isPercent)return!1;var i=100*t;return e<0&&(i*=-1),a.format(i/100,{type:"percent",maximumFractionDigits:1,minimumFractionalDigits:1})},_calculateClipPath:function(e,t,i){return i?{width:"100%",y:e.height*(1-t.partialValue)+Number(e.y)}:{width:e.width*t.partialValue+Number(e.x),y:0}},_extractSvgContent:function(t){var i=e(t).children(),n=new XMLSerializer,a="";return i.each((function(){a+=n.serializeToString(this)})),a},addToDom:function(e){this.$el.empty(),this.$el.prepend(e),this.setElement(this.$el)},onVisible:function(){this.renderOnVisible&&this._resize()},applyVisModelProperties:function(){this._resizeInfographicShapes()},_resizeInfographicShapes:function(){if(0!==this.numOfShapes){var t,i,n=e(this.el).find(".infographic"),a=Math.floor(n.width()),o=Math.floor(n.height())||1,s=this.numOfShapes,r=Math.ceil(Math.sqrt(s*a/o));t=Math.floor(r*o/a)*r<s?o/Math.ceil(r*o/a):a/r;var l=Math.ceil(Math.sqrt(s*o/a));i=Math.floor(l*a/o)*l<s?a/Math.ceil(a*l/o):o/l;var c=Math.max(t,i)-8-1+"px";this.$el.find(".infographic .infographic-content").each((function(){this.style.width=this.style.height=c}))}},preRenderFillDirectionProperty:function(){return{removeProperty:!1}},setShowTranslationIcon:function(e){this._showTranslationIcon=e},updateTranslationIcon:function(){var e=this.$el.closest(".widgetContentWrapper");this._showTranslationIcon?this._translationService.appendTranslationIcon(e):this._translationService.removeTranslationIcon(e)},getDecoratorAPI:function(){var e=this;return{decorateItem:function(){e.setShowTranslationIcon(!0)},decoratePoint:function(){return null},decorate:function(){return null},clearItemDecoration:function(){e.setShowTranslationIcon(!1)},updateDecorations:function(){e.updateTranslationIcon()}}}});return m})),define("dashboard-analytics/visualizations/renderer/summary/SummaryProxyView",["jquery","underscore","../VisView","../../../util/DashboardFormatter","../kpi/KpiView","../infographic/InfographicView","../../../DynamicFileLoader","../../../lib/@waca/dashboard-common/dist/utils/MemUtil"],(function(e,t,i,n,a,o,s,r){"use strict";var l=i.extend({className:"",init:function(e){var i=this;l.inherited("init",this,arguments),this._content=e.content,this._colorsService=this.dashboardApi.getFeature("Colors"),this._visualizationAPI=this._content.getFeature("Visualization");var n=t.extend({},e,{proxiedView:!0});this._kpiView=new a(n),this._infographicView=new o(n),this.updateActiveView(),["resize","animate","_renderIconView","removeIconView","getDescription","onVisible","renderIconView"].forEach((function(e){i._createProxyFunction(e)}))},getSubView:function(e){return"kpiView"===e?this._kpiView:"infographicView"===e?this._infographicView:void 0},_createProxyFunction:function(e){this[e]=function(){return this._activeView[e].apply(this._activeView,arguments)}},reveal:function(){this._activeView&&this._activeView.summaryReveal&&this._activeView.summaryReveal()},remove:function(e){void 0===e&&(e=!0),this._kpiView.remove(e),this._infographicView.remove(e),e&&r.destroy(this)},initialize:function(){var e=this,t=[this._kpiView.initialize(),this._infographicView.initialize()];return Promise.all(t).then((function(){return e.visControl?e.visControl:s.load(["dashboard-analytics/visualizations/renderer/summary/control/SummaryControl"]).then((function(t){var i=t[0];return e.visControl=new i({domNode:e.$el[0]}),e.visControl}))}))},placeAt:function(e){this._containingElement=e,this._activeView&&this._activeView.placeAt(e)},updateActiveView:function(){this._activeView&&this._activeView.$el.detach();var e=this.isInfographic(!0);this._activeView=e?this._infographicView:this._kpiView,this.$el=this._activeView.$el,this._containingElement&&this._activeView.placeAt(this._containingElement)},getActiveView:function(){return this._activeView},render:function(e){return this.updateActiveView(),this._activeView.render(e)},isInfographic:function(e){if(void 0===e&&(e=!1),void 0===this._isInfographic||e){var t=this.content.getPropertyValue("value.graphic.content");this._isInfographic=!!t}return this._isInfographic},getDecoratorAPI:function(){return this._activeView.getDecoratorAPI?this._activeView.getDecoratorAPI():null}});return l})),define("dashboard-analytics/util/EdgeIterator",[],(function(){"use strict";return function(){function e(e,t){void 0===t&&(t=0),this.edge=e.edge,this.keys=e.sortedKeys,this.currentKeyIndex=0,this.subIterator=null,this.numberOfLeafNodes=0,this.leafnode_index_no_summary=t}var t=e.prototype;return t.next=function(e,t){var i=null;if(this._previous&&!this._previous.isSummary&&++this.leafnode_index_no_summary,this.currentKeyIndex<this.keys.length){var n=[],a=this.keys[this.currentKeyIndex],o=this.edge[a],s=void 0!==o.value?o.value:a;if(n.push(s),!this.subIterator&&o.nestedEdges&&(this._first=null,this.ancestor_or_self=e&&0!==e.length?e.concat(s):[s],this.numberOfLeafNodes=0,this.subIterator=new this.EdgeIterator(o.nestedEdges,this.leafnode_index_no_summary)),this.subIterator){var r=this.subIterator.next(this.ancestor_or_self,t);r?((r.hasLeafNode||r.isLeafNode)&&this.numberOfLeafNodes++,i=this.createNodeInfo(n,s,o,r,t)):(this.currentKeyIndex++,this.subIterator=null,this._first.noOfLeafNodes=this._previous.index+1,this._first.first=!0,i=this.next(e,t))}else i=this.createLeafNodeInfo(n,s,o,e,t),this.currentKeyIndex++}return this._first||(this._first=i),this._previous=i,i},t.createLeafNodeInfo=function(){throw new Error("EdgeIterator.createLeafNodeInfo is not implemented")},t.createNodeInfo=function(){throw new Error("EdgeIterator.createNodeInfo is not implemented")},t.rollupSummariesOfDescendents=function(e,t,i,n){var a=e.nestLevel+(n?n.descendant_or_self.length:0),o=e.isSummary&&!e.isMeasure&&Number.isInteger(i)&&a<i;if(o)for(var s=i-(n?n.descendant_or_self.length:0),r=e.nestLevel;r<s;r++)e.descendant_or_self.push(t);return o},e}()})),define("dashboard-analytics/visualizations/renderer/crosstab/CrosstabEdgeIterator",["../../../util/EdgeIterator"],(function(e){"use strict";return function(e){function t(){var i;return(i=e.apply(this,arguments)||this).EdgeIterator=t,i}_inheritsLoose(t,e);var i=t.prototype;return i.createLeafNodeInfo=function(e,t,i,n,a){var o={descendant_or_self:e,descendant_or_self_without_measures:i.isMeasure?[]:e,index:this.currentKeyIndex,value:t,type:i.type,isSummary:i.isSummary,isOverallSummary:i.isOverallSummary,isLeafNode:!0,ancestor_or_self:n?n.concat(t):[t],nestLevel:i.level,isMeasure:i.isMeasure,summaryOf:i.summaryOf,formatSpec:i.formatSpec};return i.isSummary||(o.cellIdx=i.cellIdx),this.rollupSummariesOfDescendents(o,t,a),o},i.createNodeInfo=function(e,t,i,n,a){var o={descendant_or_self:e,descendant_or_self_without_measures:i.isMeasure?n.descendant_or_self_without_measures:e.concat(n.descendant_or_self_without_measures),index:this.numberOfLeafNodes-1,value:t,type:i.type,isSummary:i.isSummary||n.isSummary,isOverallSummary:i.isOverallSummary||n.isOverallSummary,hasMeasureChildren:i.hasMeasureChildren,noOfChildren:this.subIterator.keys.length,hasLeafNode:n.isLeafNode||n.hasLeafNode,ancestor_or_self:this.ancestor_or_self,nestLevel:i.level,isMeasure:i.isMeasure,summaryOf:i.summaryOf||n.summaryOf,subCategory:n,formatSpec:i.formatSpec};return this.rollupSummariesOfDescendents(o,t,a,n),o.descendant_or_self=o.descendant_or_self.concat(n.descendant_or_self),i.isSummary||(o.cellIdx=i.cellIdx),o},t}(e)})),define("dashboard-analytics/widgets/livewidget/query/QueryResultDataUtils",["underscore"],(function(e){return function(){function t(){}return t.normalizeData=function(e){this._normalizeTuplePart(e),e&&void 0!==e.p&&this._normalizeTuplePart(e.p)},t.isRectifyNeeded=function(e){return null===e},t.getRectifiedData=function(e){return{u:e}},t._normalizeTuplePart=function(t){e.isObject(t)&&(t.hasOwnProperty("d")||(t.d=t.hasOwnProperty("u")?t.u:t.hasOwnProperty("v")?t.v:t.hasOwnProperty("value")?t.value:t),t.hasOwnProperty("u")||(t.u=t.hasOwnProperty("d")?t.d:t.hasOwnProperty("v")?t.v:t.hasOwnProperty("value")?t.value:t))},t.getFlatResolvedDataRows=function(e){for(var i=e.getResultItemList(),n=t.getDataItemCount(i),a=[],o=0;o<e.getRowCount();o++){a[o]=[];for(var s=0;s<n;s++)a[o].push(e.getValue(o,s))}return a},t.getDataItemIndex=function(t,i){var n=-1;return t&&e.find(t.dataItems,(function(e,t){if((e.itemClass&&e.itemClass.id)===i)return n=t,!0})),n},t.getDataItemCount=function(e){return e.reduce((function(e,t){return e+t.getDataItemList().length}),0)},t.getResultDataItemList=function(e){var t=[];return e.forEach((function(e){t.push.apply(t,e.getDataItemList())})),t},t}()})),define("dashboard-analytics/visualizations/renderer/crosstab/Pivot",["../../../util/DashboardFormatter","../../../widgets/livewidget/nls/StringResources","./CrosstabEdgeIterator","../../../widgets/livewidget/query/QueryResultDataUtils"],(function(e,t,i,n){"use strict";var a=t.get("summaryCaption"),o="row";return function(){function t(e){void 0===e&&(e={}),this.slots=e.slots,this.data=e.data,this.content=e.content,this.dashboard=e.dashboard,this.conditionalFormatting=e.conditionalFormatting,this.visFormatSpec=e.visFormatSpec,this.showValuesOnRows=e.showValuesOnRows,this.rowEdge={},this.columnEdge={},this.valuesMap={},this.colEdgeNestingLevel=0,this.rowEdgeNestingLevel=0,this._valuesStartIdx=0,this._measuresInfo=[],this._rowInfo=[],this._columnInfo=[],this._conditionalMeasureInfoNew=[],this.indexInfo={row:[],col:[]},this.levelInfo={row:{},col:{}},this.summaryValuePromises=[],this._isValuesOnly=!1;for(var t,i,a=this.slots.getMappedSlotList(),o=n.getResultDataItemList(this.data.getResultItemList()),s=0;s<a.length;s++)i=(t=a[s]).getDataItemList(),this._buildRowInfo(t,i,s),this._buildColumnInfo(t,i,s),this._buildValueInfo(t,i,o);this._colRowInfo=this._columnInfo.concat(this._rowInfo),this._isValuesOnly&&this._addRowEdgePlaceholderForValuesOnlyCase(),this._columnEdgeHasMeasure=!1,this._rowEdgeHasMeasure=!1,this.colEdgeNestingLevelWithMeasure=null,this.rowEdgeNestingLevelWithMeasure=null,this.showValuesOnRows?this._rowEdgeHasMeasure=this.getNumberOfMeasures()>1||0===this.rowEdgeNestingLevel:this._columnEdgeHasMeasure=this.getNumberOfMeasures()>1||0===this.colEdgeNestingLevel,this._columnEdgeHasMeasure?this.colEdgeNestingLevelWithMeasure=this.colEdgeNestingLevel+1:this._rowEdgeHasMeasure?this.rowEdgeNestingLevelWithMeasure=this.rowEdgeNestingLevel+1:this._crosstabMeasure=this.getNumberOfMeasures()?this._measuresInfo[0].label:null}var s=t.prototype;return s._buildRowInfo=function(e,t,i){if(-1!==e.getId().indexOf(o)){this._valuesStartIdx++;for(var n=0;n<t.length;n++){var a=t[n];this.rowEdgeNestingLevel++,this._addEdgeDataItemInfo(i,n,o),this._rowInfo.push({id:a.getId(),dataType:e.getDefinition().getType(),formatSpec:this._getDataItemFormatSpec(a)})}}},s._buildColumnInfo=function(e,t,i){if(-1!==e.getId().indexOf("col")){this._valuesStartIdx++;for(var n=0;n<t.length;n++){var a=t[n];this.colEdgeNestingLevel++,this._addEdgeDataItemInfo(i,n,"col"),this._columnInfo.push({id:a.getId(),dataType:e.getDefinition().getType(),formatSpec:this._getDataItemFormatSpec(a)})}}},s._buildValueInfo=function(e,t,i){var n=this;this._rowInfo.length||this._columnInfo.length||(this._isValuesOnly=!0),"ordinal"===e.getDefinition().getType()&&(t.forEach((function(t){var a=t.getAggregation(),o={id:t.getId(),label:t.getLabel(),aggregationType:a,formatSpec:n._getDataItemFormatSpec(t),columnId:t.getColumnId()};"heat"===e.getId()?(n._conditionalMeasureInfo=o,n.conditionalFormatting&&n._conditionalMeasureInfoNew.push(o)):(n._measureItemHasData(i,t)||n._isValuesOnly)&&n._measuresInfo.push(o)})),this._buildConditionalInfo())},s._buildConditionalInfo=function(){var e=this;if(this.conditionalFormatting){var t=this.conditionalFormatting.getConditionalFormatting();t&&t.conditionalFormats&&this._conditionalMeasureInfoNew.forEach((function(i){var n=t.conditionalFormats.find((function(e){return e.heatId===i.id}));n&&e._measuresInfo.forEach((function(e,t){e.columnId===n.dataItemId&&(i.measureIndex=t)}))}))}},s._addEdgeDataItemInfo=function(e,t,i){this.data&&(i===o?this.indexInfo.row.push({slotIndex:e,nestedIndex:t}):this.indexInfo.col.push({slotIndex:e,nestedIndex:t}))},s.create=function(){this._hideSummaries=this.content.getPropertyValue("hideSummaries"),this._generateEdgesAndValueMap();var e=[];return this._addColumnEdgeCategories(e),this._addRowEdgeCategoriesAndFactCells(e),this._isValuesOnly&&this._removeRowEdgeColumnForValuesOnlyCase(e),e},s.getNestingLevels=function(){return this._columnEdgeHasMeasure?{colNestingLevel:this.colEdgeNestingLevel+1,rowNestingLevel:this.rowEdgeNestingLevel}:this._rowEdgeHasMeasure?{colNestingLevel:this.colEdgeNestingLevel,rowNestingLevel:this.rowEdgeNestingLevel+1}:{colNestingLevel:this.colEdgeNestingLevel,rowNestingLevel:this.rowEdgeNestingLevel}},s.getLevelInfo=function(){return this.levelInfo},s.getCellValue=function(e,t,i){var n=this.data.getValue(e,t),o=n,s=o&&o.type===this.data.VALUE_TYPE.SUMMARY;return Array.isArray(o)&&void 0!==i&&(o=o[i]),s&&(o=o||n&&n.length&&n[n.length-1])&&((o=JSON.parse(JSON.stringify(o))).label=a,o.isSummary=!0),o},s._determineLevelInfo=function(e,t,i){if(void 0!==this.levelInfo[e][t]){var n=this.levelInfo[e][t],a=n.rootLevelnumber,o=n.maxLevelDepth;this.levelInfo[e][t]={rootLevelnumber:Math.min(a,i),maxLevelDepth:Math.max(o,i-a)}}else this.levelInfo[e][t]={rootLevelnumber:i,maxLevelDepth:0}},s._generateEdgesAndValueMap=function(){var e={},t={},i=this.data.getRowCount(),a=n.getDataItemCount(this.data.getResultItemList()),o=this._valuesStartIdx+this.getNumberOfMeasures(),s=[],r=[];if(i)for(var l=0;l<i;l++){s=[],r=[];var c=this._generateRowEdge(l,e,s,a),u=this._generateColumnEdge(l,t,r,a);c=c||u;for(var d=[],h=this._valuesStartIdx;h<o;h++)d.push(this.getCellValue(l,h));if(this.conditionalFormatting)for(var p=0;p<this._conditionalMeasureInfoNew.length;p++)this._conditionalMeasureInfoNew[p].condValue=c?void 0:this.getCellValue(l,p+o).value;this._generateValueMap(l,d,r,s,o,c)}else this._generateRowEdge(0,e,s,1),this._generateColumnEdge(0,t,r,1);this.rowEdge=this._getEdgeWithSortedKeys(e,this.indexInfo.row,this.rowEdgeNestingLevelWithMeasure||this.rowEdgeNestingLevel),this.columnEdge=this._getEdgeWithSortedKeys(t,this.indexInfo.col,this.colEdgeNestingLevelWithMeasure||this.colEdgeNestingLevel)},s._generateRowEdge=function(e,t,i,n){for(var a=!1,s=0;s<n;s++)if(void 0!==this.indexInfo.row[s]){var r=this.getCellValue(e,this.indexInfo.row[s].slotIndex,this.indexInfo.row[s].nestedIndex);if(r){a=a||r.isSummary,i.push(r);var l=r&&r.ln;void 0!==l&&this._determineLevelInfo("col",s,l)}}else this._isValuesOnly&&!i.length&&i.push(this._rowCellValue);return this._addDimensionToEdge(t,i,this.rowEdgeNestingLevel,o,this._rowEdgeHasMeasure?this._measuresInfo:void 0),a},s._generateColumnEdge=function(e,t,i,n){for(var a=!1,s=0;s<n;s++)if(void 0!==this.indexInfo.col[s]){var r=this.getCellValue(e,this.indexInfo.col[s].slotIndex,this.indexInfo.col[s].nestedIndex);if(r){a=a||r.isSummary,i.push(r);var l=r&&r.ln;void 0!==l&&this._determineLevelInfo(o,s,l)}}return this._addDimensionToEdge(t,i,this.colEdgeNestingLevel,"column",this._columnEdgeHasMeasure?this._measuresInfo:void 0),a},s._generateValueMap=function(e,t,i,n,a,o){var s,r,l=this,c=this._conditionalMeasureInfo&&!o?this.getCellValue(e,a).value:void 0;if(this._columnEdgeHasMeasure||this._rowEdgeHasMeasure)for(var u=function(e){if(l._columnEdgeHasMeasure?s=i.concat(l._measuresInfo[e].label).concat(n):l._rowEdgeHasMeasure&&(s=i.concat(n).concat(l._measuresInfo[e].label)),r=t[e]?t[e].value:t[e],l.conditionalFormatting){var a=l._conditionalMeasureInfoNew.find((function(t){return t.measureIndex===e}));c=a?a.condValue:void 0,l._addValuesToMap(s,r,l._measuresInfo[e],c,a)}else l._addValuesToMap(s,r,l._measuresInfo[e],c)},d=0;d<this.getNumberOfMeasures();d++)u(d);else s=i.concat(n),r=t[0]?t[0].value:t[0],this.conditionalFormatting?(c=this._conditionalMeasureInfoNew[0]?this._conditionalMeasureInfoNew[0].condValue:void 0,this._addValuesToMap(s,r,this._measuresInfo[0],c,this._conditionalMeasureInfoNew[0])):this._addValuesToMap(s,r,this._measuresInfo[0],c)},s._getEdgeWithSortedKeys=function(e,t,i,n,o){n=n||0;var s={edge:e,sortedKeys:this._getSortedKeys(e,t[n],o)};if(n<i-1){var r=o||[];for(var l in e)if(e.hasOwnProperty(l)){var c=e[l].nestedEdges;if(c){var u=l===a?i:n+1;r[n]=l,e[l].nestedEdges=this._getEdgeWithSortedKeys(c,t,i,u,r),0===n?r=[]:r.length&&(r=r.slice(r.length))}}}return s},s._getSortedKeys=function(e,t,i){var n=[];if(void 0===t)for(var o in e)o!==a&&e.hasOwnProperty(o)&&n.push(o);else for(var s=this.data.getResultItemList()[t.slotIndex],r=0,l=s.getRowCount();r<l;r++){var c=s.getValue(r),u=void 0===i;if(!u){u=!0;for(var d=0;d<t.nestedIndex;d++)if(void 0!==c[d]&&void 0!==i[d]&&i[d]!==c[d].value){u=!1;break}}if(u)for(var h=0;h<c.length;h++){var p=c[h].value;if(p&&e[p]&&-1===n.indexOf(p)){n.push(p);break}}}return void 0!==e[a]&&n.push(a),n},s._addColumnEdgeCategories=function(e){var t,n,a;a=this.colEdgeNestingLevelWithMeasure||this.colEdgeNestingLevel;var o=this.rowEdgeNestingLevelWithMeasure||this.rowEdgeNestingLevel;for(t=0;t<a;t++){var s=[];for(n=0;n<o;n++)s.push({type:"corner",value:this._crosstabMeasure||""});e.push(s)}for(var r,l,c,u,d=new i(this.columnEdge);r=d.next();){for(c=0,u=r;u;)l=u,e[c].push(u),c++,c+=this._handleUnbalancedCategory(u,e,c),u=u.subCategory;for(n=c;n<a;n++)e[n].push(l)}},s._addRowEdgeCategoriesAndFactCells=function(e){for(var t,n,a,o,s,r=this.rowEdgeNestingLevelWithMeasure||this.rowEdgeNestingLevel,l=new i(this.rowEdge);t=l.next();){for(n=[],e.push(n),a=t,s=0;a;)o=a,n.push(a),s+=this._handleUnbalancedCategory(a,n),a=a.subCategory,s++;for(var c=s;c<r;c++)o&&(n.push(o),t.descendant_or_self.push(o.value.value?o.value.value:o.value));this.conditionalFormatting?this._addFactCellsToPivotTableRowNewCF(t,n):this._addFactCellsToPivotTableRow(t,n)}},s._handleUnbalancedCategory=function(e,t,i){if(void 0===i&&(i=void 0),!e.isSummary&&e.value&&e.value.span){for(var n=e.value.span-1,a=0;a<n;++a){var o=JSON.parse(JSON.stringify(e));o.isUnbalanced=!0,delete o.value,void 0!==i?t[i+a].push(o):t.push(o)}return n}return 0},s._addFactCellsToPivotTableRow=function(t,n){var a,o,s,r,l,c,u,d,h,p=this,g=new i(this.columnEdge),m=this.getNestingLevels().colNestingLevel-1;for(this._conditionalMeasureInfo&&this._measuresInfo&&(h=this._measuresInfo.find((function(e){return e.label===p._conditionalMeasureInfo.label})));d=g.next(void 0,m);)a=t.isOverallSummary||d.isOverallSummary,o=this.getKeyFromDataCells(d.descendant_or_self,t.descendant_or_self),s=this.getKeyFromDataCells(d.descendant_or_self_without_measures,t.descendant_or_self_without_measures),(r=this.valuesMap[o])&&(l=r.value),c=r?l:null,u=null,null!=l&&this._conditionalMeasureInfo&&(!r||this._conditionalMeasureInfo.label!==r.label&&h||(u={value:r.conditionalValue,formatted:e.formatNull(r.conditionalValue,this._conditionalMeasureInfo.formatSpec)})),n.push({rowEdge:t,columnEdge:d,value:c,rawValue:l,key:o,tuple:s,condValue:u,isOverallSummary:a})},s._addFactCellsToPivotTableRowNewCF=function(t,n){for(var a,o,s,r,l,c,u,d,h=new i(this.columnEdge),p=this.getNestingLevels().colNestingLevel-1;d=h.next(void 0,p);){if(a=t.isOverallSummary||d.isOverallSummary,o=this.getKeyFromDataCells(d.descendant_or_self,t.descendant_or_self),s=this.getKeyFromDataCells(d.descendant_or_self_without_measures,t.descendant_or_self_without_measures),(r=this.valuesMap[o])&&(l=r.value),c=r?l:null,u=null,null!=l&&r){var g=this._conditionalMeasureInfoNew.find((function(e){return e.label===r.conditionalLabel}));g&&(u={value:r.conditionalValue,formatted:e.formatNull(r.conditionalValue,g.formatSpec)})}n.push({rowEdge:t,columnEdge:d,value:c,rawValue:l,key:o,tuple:s,condValue:u,isOverallSummary:a})}},s.getKeyFromDataCells=function(e,t){var i=[];if(Array.isArray(e))for(var n=0;n<e.length;n++)i.push(e[n].value?e[n].value:e[n]);if(Array.isArray(t))for(var a=0;a<t.length;a++)i.push(t[a].value?t[a].value:t[a]);return i.toString()},s._addValuesToMap=function(e,t,i,n,a){void 0!==t&&(this.valuesMap[this.getKeyFromDataCells(e)]={label:i?i.label:null,value:t,conditionalLabel:a?a.label:null,conditionalValue:n})},s._addDimensionToEdge=function(e,t,i,n,a,s){if(s=s||0,t&&t.length>0){var r=t[0].value;if(!e[r]){e[r]={level:s,type:n,value:t[0]},t[0].isSummary&&(e[r].isSummary=t[0].isSummary);var l=null;n!==o||this._isValuesOnly?"column"!==n||this._isValuesOnly||(l=this._columnInfo[s].formatSpec):l=this._rowInfo[s].formatSpec,e[r].formatSpec=l}var c=t.slice(1,t.length);c.length>0?(e[r].nestedEdges||(e[r].nestedEdges={}),this._addDimensionToEdge(e[r].nestedEdges,c,i,n,a,s+1)):(this._columnEdgeHasMeasure&&"column"===n||this._rowEdgeHasMeasure&&n===o)&&(e[r].nestedEdges||(e[r].nestedEdges={},e[r].hasMeasureChildren=!0),this._addMeasureToEdge(e[r].nestedEdges,a,n,s+1,!1))}else(this._columnEdgeHasMeasure&&"column"===n||this._rowEdgeHasMeasure&&n===o)&&this._addMeasureToEdge(e,a,n,s,!1)},s._addMeasureToEdge=function(e,t,i,n,a,o){if(t)for(var s,r=0;r<t.length;r++)e[s=t[r].label]||(e[s]={level:n,type:i,isMeasure:!0}),a&&(e[s].isSummary=!0,e[s].noSort=!0,o&&(e[s].isOverallSummary=!0))},s._measureItemHasData=function(e,t){if(void 0===e&&(e=[]),!t)throw new Error("Invalid dataItem provided");return!!e.find((function(e){return e.getId()===t.getId()}))},s._getDataItemFormatSpec=function(e){var t;if(e&&(t=e.getFormat(),this.visFormatSpec)){var i=this.visFormatSpec.formatSpec||this.visFormatSpec;t&&delete i.type,t=Object.assign({},t,i)}return t},s._addRowEdgePlaceholderForValuesOnlyCase=function(){this.rowEdgeNestingLevel=1,this._rowCellValue={d:"dataD",ihId:1,label:"",u:"dataU",value:"noData"}},s._removeRowEdgeColumnForValuesOnlyCase=function(e){e.forEach((function(e){e.length>1&&e.splice(0,1)})),this.rowEdgeNestingLevel=0,this.data.getRowCount()||e.splice(1,1)},s.getNumberOfMeasures=function(){return this._measuresInfo.length},t}()})),define("dashboard-analytics/visualizations/renderer/grid/GridDnDManager",["underscore","../../../dataSources/utils/ShapingConstants"],(function(e,t){return function(){function i(e){void 0===e&&(e={}),this.grid=e.grid,this.dashboardApi=e.dashboardApi,this.content=e.content,this.gridEdgeMappedToId=e.gridEdgeMappedToId,this.visualization=this.content.getFeature("Visualization")}var n=i.prototype;return n.registerElement=function(e,t){this.dashboardApi.getFeature("DashboardDnd.internal").addDropTarget(t,{accepts:this.accepts.bind(this,e,t),onDrop:this.onDrop.bind(this,e),onDragEnter:this.onDragEnter.bind(this),onDragMove:this.onDragMove.bind(this,e),onDragLeave:this.onDragLeave.bind(this,e)})},n.deregisterElement=function(e){this.dashboardApi.getFeature("DashboardDnd.internal").removeDropTarget(e)},n.accepts=function(e,i,n){if(!e||!e.props)return!1;var a,o={dropTarget:t.DROP_TARGET_OPTIONS.SLOT};i&&(o.targetNode=i),"Crosstab"===this._getContent().getFeature("Visualization").getType()&&(a=i&&this._getDropAction(e,n,i))&&(a.actionSpec.slot=this._findSlot(a.actionSpec.gridEdge),o.dropAction=a);var s=this._getVisDnDUtils().accepts(n,o);if(s){var r=this.grid.$el[0],l=r&&r.getBoundingClientRect(),c=e.ref.current,u=c&&c.getBoundingClientRect();(!l||!u||parseInt(l.bottom)<parseInt(u.bottom)||parseInt(l.right)<parseInt(u.right)&&Math.abs(u.right-l.right)>3)&&(s=!1)}return s},n._getVisDnDUtils=function(){return this.visDnDUtils||(this.visDnDUtils=this.content.getFeature("VisDnD.utils")),this.visDnDUtils},n.onDragEnter=function(){},n._findSlot=function(t){var i=this,n=this.visualization.getSlots();return e.find(n.getSlotList(),(function(e){switch(t){case"row":return e.getId()===i.gridEdgeMappedToId.row;case"column":return e.getId()===i.gridEdgeMappedToId.column;case"values":return e.getId()===i.gridEdgeMappedToId.values}}))},n._insertDataItems=function(e){var t=e.gridEdge,i=e.droppedColumns,n=e.position,a=this._findSlot(t);a&&this._getVisDnDUtils().mapColumns(a.getId(),i,{position:n,bReplace:!1})},n._replaceDataItems=function(t){var i=t.gridEdge,n=t.droppedColumns,a=t.position,o=this._findSlot(i);if(o){var s=o.getDataItemList();if(e.isEmpty(s))return;this._getVisDnDUtils().mapColumns(o.getId(),n,{position:a,bReplace:!0})}},n._findValuesSlotPosition=function(t){var i=this._findSlot("values"),n=-1;if(i){var a=i.getDataItemList();e.isEmpty(a)||(n=a.findIndex((function(e){return e.getLabel()===t.props.useValue})))}return n},n._getDropAction=function(t,i,n){var a=i.data.columns;if(e.pluck(a,"metadataColumn").length>0){var o=this._getDropZoneInfo(i,n,t),s=o.action,r=o.idx;switch(s){case"insertLeft":return this._getInsertLeftAction(t,a,r);case"insertRight":return this._getInsertRightAction(t,a,r);case"replaceRow":return this._getReplaceRowAction(t,a,r);case"insertAbove":return this._getInsertAboveAction(t,a,r);case"insertBelow":return this._getInsertBelowAction(t,a,r);case"replaceCol":return this._getReplaceColumnAction(t,a,r)}}},n.onDrop=function(e,t,i){var n=this._getDropAction(e,t,i);return this.grid.hideDropZones(),n.action(n.actionSpec)},n.onDragMove=function(e,t,i){var n=this._getDropZoneInfo(t,i,e),a=n.action,o=n.idx;switch(a){case"insertLeft":return this.grid.showLeftDropZone(o);case"insertRight":return this.grid.showRightDropZone(o);case"replaceRow":return e.props.isMeasure&&"corner"!==e.props.cellType?this.grid.showReplaceDropZone(e.props.row,"row",e.props.useValue):this.grid.showReplaceDropZone(o,"col");case"insertAbove":return this.grid.showTopDropZone(o,e.props.isMeasure);case"insertBelow":return this.grid.showBottomDropZone(o,e.props.isMeasure);case"replaceCol":return this.grid.showReplaceDropZone(o,"row")}},n.onDragLeave=function(){this.grid.hideDropZones()},n._getInsertLeftAction=function(e,t,i){var n;return(n="corner"===e.props.cellType?{gridEdge:"values",droppedColumns:t,position:0}:e.props.isMeasure?{gridEdge:"values",droppedColumns:t,position:this._findValuesSlotPosition(e)}:{gridEdge:"row",droppedColumns:t,position:parseInt(i)}).replace=!1,{actionSpec:n,action:this._insertDataItems.bind(this)}},n._getInsertRightAction=function(e,t,i){var n;return(n="corner"===e.props.cellType?{gridEdge:"values",droppedColumns:t,position:-1}:e.props.isMeasure?{gridEdge:"values",droppedColumns:t,position:this._findValuesSlotPosition(e)+1}:{gridEdge:"row",droppedColumns:t,position:parseInt(i)+1}).replace=!1,{actionSpec:n,action:this._insertDataItems.bind(this)}},n._getReplaceRowAction=function(e,t,i){var n;return(n="corner"===e.props.cellType?{gridEdge:"values",droppedColumns:t,position:0}:e.props.isMeasure?{gridEdge:"values",droppedColumns:t,position:this._findValuesSlotPosition(e)}:{gridEdge:"row",droppedColumns:t,position:parseInt(i)}).replace=!0,{actionSpec:n,action:this._replaceDataItems.bind(this)}},n._getInsertAboveAction=function(e,t,i){return{actionSpec:e.props.isMeasure?{gridEdge:"values",droppedColumns:t,position:this._findValuesSlotPosition(e),replace:!1}:{gridEdge:"column",droppedColumns:t,position:parseInt(i),replace:!1},action:this._insertDataItems.bind(this)}},n._getInsertBelowAction=function(e,t,i){return{actionSpec:e.props.isMeasure?{gridEdge:"values",droppedColumns:t,position:this._findValuesSlotPosition(e)+1,replace:!1}:{gridEdge:"column",droppedColumns:t,position:parseInt(i)+1,replace:!1},action:this._insertDataItems.bind(this)}},n._getReplaceColumnAction=function(e,t,i){var n;return(n=e.props.isMeasure?{gridEdge:"values",droppedColumns:t,position:this._findValuesSlotPosition(e)}:{gridEdge:"column",droppedColumns:t,position:parseInt(i)}).replace=!0,{actionSpec:n,action:this._replaceDataItems.bind(this)}},n._getDropZoneInfo=function(e,t,i){return"column"===i.props.cellType?this._getColumnDropZoneInfo(e,t,i):"row"===i.props.cellType?this._getRowDropZoneInfo(e,t,i):"corner"===i.props.cellType?this._getCornerDropZoneInfo(e,t,i):void 0},n._getColumnDropZoneInfo=function(e,t,i){return i.props.isMeasure?this._getRowActionInfo(e,t):this._getColumnActionInfo(e,t)},n._getRowDropZoneInfo=function(e,t,i){return i.props.isMeasure?this._getColumnActionInfo(e,t):this._getRowActionInfo(e,t)},n._getCornerDropZoneInfo=function(e,t){var i=t.getBoundingClientRect(),n=(e.position.x-i.left)/i.width*100;return n<33?{action:"insertLeft",idx:"corner"}:n>66?{action:"insertRight",idx:"corner"}:{action:"replaceRow",idx:"corner"}},n._getRowActionInfo=function(e,t){var i=t&&t.getAttribute("row"),n=t.getBoundingClientRect(),a=(e.position.y-n.top)/n.height*100;return a<33?{action:"insertAbove",idx:i}:a>66?{action:"insertBelow",idx:i}:{action:"replaceCol",idx:i}},n._getColumnActionInfo=function(e,t){var i=t&&t.getAttribute("col"),n=t.getBoundingClientRect(),a=(e.position.x-n.left)/n.width*100;return a<33?{action:"insertLeft",idx:i}:a>66?{action:"insertRight",idx:i}:{action:"replaceRow",idx:i}},n._getContent=function(){if(!this.content){var e=this.grid.gridView||this.grid.crosstabView;this.content=this.dashboardApi.getCanvas()&&this.dashboardApi.getCanvas().getContent(e.ownerWidget.getId())}return this.content},i}()})),define("dashboard-analytics/visualizations/renderer/grid/GridDataProvider",[],(function(){"use strict";return function(){function e(e){this.updateData(e)}var t=e.prototype;return t.getNumRows=function(){return this._numRows},t.getNumColumns=function(){return this._numColumns},t.getValue=function(e,t){return e<this._numRows&&t<this._numColumns?this._data[e][t]:null},t.updateData=function(e){this._data=e,this._numRows=0,this._numColumns=0,this._data&&(this._numRows=this._data.length,this._numColumns=Array.isArray(this._data[0])?this._data[0].length:0)},e}()})),define("dashboard-analytics/visualizations/renderer/grid/GridDropTarget",["react","prop-types"],(function(e,t){var i;return(i=function(t){function i(i){var n;return(n=t.call(this,i)||this).ref=e.createRef(),n}_inheritsLoose(i,t);var n=i.prototype;return n.componentDidMount=function(){this.props.dndManager.registerElement(this,this.ref.current)},n.componentWillUnmount=function(){this.props.dndManager.deregisterElement(this.ref.current)},n.render=function(){var t=_extends({},this.props);return delete t.dndManager,e.createElement("div",_extends({ref:this.ref},t))},i}(e.Component)).propTypes={dndManager:t.any},i})),define("dashboard-analytics/visualizations/renderer/grid/GridContentRenderer",["react","prop-types"],(function(e,t){var i=function(t){function i(e){return t.call(this,e)||this}return _inheritsLoose(i,t),i.prototype.render=function(){var t=this.props,i=t.displayValue,n=t.iconsFeature,a=t.shapeId,o=["dashboard-text-cell"];return"shapeId"in this.props&&(o.push("grid-shape-right"),a||o.push("noShape")),e.createElement(e.Fragment,null,e.createElement("div",{className:o.join(" ")},i),a&&e.createElement("svg",{className:"dashboard-grid-shape"},e.createElement("use",{xlinkHref:"#"+n.getIcon(a).id}),e.createElement("title",null,a)))},i}(e.Component);return i.propTypes={displayValue:t.string.isRequired,shapeId:t.string,iconsFeature:t.shape({getIcon:t.func.isRequired}).isRequired},i})),define("dashboard-analytics/visualizations/renderer/crosstab/CrosstabGridCellRenderers",["../../../widgets/livewidget/nls/StringResources","react","underscore","@ba/ba-ui-carbon-toolkit","../grid/GridDropTarget","../../../util/DashboardFormatter"],(function(e,t,i,n,a,o){"use strict";var s="summary",r={CELL:"dataValueStyles",corner:"valueHeadingStyles",row:"rowHeadingStyles",column:"columnHeadingStyles",SUMMARY:"summaryStyles",SELECTED_AREA:"selectedAreaStyles"},l={Right:"flex-end",Left:"flex-start",Center:"center"};return function(){function c(){}return c.getFixedCellRenderer=function(e){var i=e.gridInfo,n=i.crosstabGrid,o=e.location;return function(e,u,d){var h=c._getRenderInfo({rowIndex:e,colIndex:u,gridInfo:i,location:o});if(i.coveredCellSet.has(h.cellKey))return null;var p=c.captureFixedCellInfo(e,u,d,i,o);if(Object.assign(d,{useValue:p.useValue,nestlevel:p.nestLevel,row:p.currentRow,col:p.currentCol,scope:p.scope,"aria-label":p.dataCellValue,tabindex:0,area:p.area,measure:d.isMeasure}),h.isHiddenLane(p))return d.style.zIndex=h.hiddenZIndex,delete d.style[h.deleteSize],t.createElement("div",d,c.renderHiddenRowsAndColumnsHandler(p.useValue,h.hiddenLanePosition,i));var g=c._buildFixedSectionClassList(p,i,d,o);if(p.valueType){var m=r[p.valueType];Object.assign(d.style,n.textStyle[m])}var f=n._getSelectionFormattingStyles(p.useValue);f&&Object.assign(d.style,f.convertedStylesValue);var v=[c.renderTextCellOfFixedCell(p,i,o)];p.isSummary?(d.area=s,Object.assign(d.style,n.textStyle[r.SUMMARY]),c.setSummaryColor(d,i),v[0].props.style.justifyContent=l[d.style["text-align"]]):(v[0].props.style.justifyContent=l[d.style["text-align"]],n._renderEdgeSelection(p.valueType,p.dataValue,p.useValue,g),c._renderGridDropZones({children:v,location:o,cellInfo:p,gridInfo:i}));var _=c._renderExpand({cellInfo:p,gridInfo:i,gridCellProps:d,location:o,isInVisibleRange:h.isInVisibleRange,getOriginalCoords:h.getOriginalCoords});h.isOutVisibleRange(p,i)&&(i.renderedExpandedRootSet=new Set),d.className=g.join(" "),c._addResizeHandlers({children:v,cellInfo:p,gridInfo:i,renderInfo:h});var b=i.gridDnDManager?a:"div",y=t.createElement(b,_extends({dndManager:i.gridDnDManager,cellType:p.cellType,isMeasure:p.isMeasure},d),v);return t.createElement(t.Fragment,{},[].concat(_,[y]))}},c._getRenderInfo=function(e){var t=e.rowIndex,i=e.colIndex,n=e.gridInfo,a=e.location,o=n.crosstabGrid;return"row"===a?{cellKey:t+" "+(i+n.fixedColumns),isHiddenLane:function(e){return c._isHiddenLane(a,e,o)},hiddenZIndex:n.numColumns-i,deleteSize:"width",hiddenLanePosition:"left",isInVisibleRange:function(e,t){return t.visibleRanges&&t.visibleRanges.colEnd>=e.colIndex},getOriginalCoords:function(e,t){return{row:e.row,col:e.col-t.fixedColumns}},isOutVisibleRange:function(e,t){return t.visibleRanges&&t.visibleRanges.colEnd<=e.colIndex},containerClassName:"grid-fixed-row-cell",offSetParent:"ba-common-grid__top-right-grid",skipBoundOfColumnResizer:!1,skipBoundOfRowResizer:!0}:{cellKey:t+n.fixedRows+" "+i,isHiddenLane:function(e){return c._isHiddenLane(a,e,o)},hiddenZIndex:n.numRows-t,deleteSize:"height",hiddenLanePosition:"bottom",isInVisibleRange:function(e,t){return t.visibleRanges&&t.visibleRanges.rowEnd>=e.rowIndex},getOriginalCoords:function(e,t){return{row:e.row-t.fixedRows,col:e.col}},isOutVisibleRange:function(e,t){return t.visibleRanges&&t.visibleRanges.rowEnd<=e.rowIndex},containerClassName:"grid-fixed-column-cell",offSetParent:"ba-common-grid__bottom-left-grid",skipBoundOfColumnResizer:!0,skipBoundOfRowResizer:!1}},c._renderGridDropZones=function(e){var i=e.children,n=e.location,a=e.cellInfo,o=e.gridInfo;"row"===n?a.isMeasure?(i.push(t.createElement("div",{class:"grid-drop-zone left"},"")),i.push(t.createElement("div",{class:"grid-drop-zone right"},""))):(o.expandedLeafMap.has(a.currentCellKey)||i.push(t.createElement("div",{class:"grid-drop-zone top"},"")),i.push(t.createElement("div",{class:"grid-drop-zone bottom"},""))):a.isMeasure?(i.push(t.createElement("div",{class:"grid-drop-zone top"},"")),i.push(t.createElement("div",{class:"grid-drop-zone bottom"},""))):(o.expandedLeafMap.has(a.currentCellKey)||i.push(t.createElement("div",{class:"grid-drop-zone left"},"")),i.push(t.createElement("div",{class:"grid-drop-zone right"},""))),i.push(t.createElement("div",{class:"grid-drop-zone replace"},""))},c._renderExpand=function(e){var t=e.cellInfo,i=e.gridInfo,n=e.gridCellProps,a=e.location,o=e.isInVisibleRange,s=e.getOriginalCoords;t.expandOptions.isExpanded&&("row"===a?n.style["align-items"]="flex-start":(n.style.display="block",n.style["align-items"]="normal"),i.renderedExpandedRootSet.add(t.currentCellKey),i.cellProps.set(t.currentCellKey,t.baseGridCellProps));var r=[];if(i.expandedLeafMap.has(t.currentCellKey)){var l=i.expandedLeafMap.get(t.currentCellKey);o(t,i)&&l.forEach((function(e){var t=JSON.parse(e);if(!i.renderedExpandedRootSet.has(t.cellKey)){var n=c.parseCellKey(t.cellKey),o=i.cellProps.get(t.cellKey);if(o){var l=JSON.parse(o.style);l.onClick=i.cellProps.get(t.cellKey).onClick;var u=s(n,i),d=c.getFixedCellRenderer({gridInfo:i,location:a});r.push(d(u.row,u.col,l)),i.renderedExpandedRootSet.add(t.cellKey)}}}))}return r},c._addResizeHandlers=function(e){var t=e.children,i=e.cellInfo,n=e.gridInfo,a=e.renderInfo,o=a.offSetParent,s=a.containerClassName,r=a.skipBoundOfColumnResizer,l=a.skipBoundOfRowResizer,c=n.crosstabGrid,u={cellInfo:i,gridInfo:n,dataProvider:n.dataProvider,containerClassName:s,offSetParent:o,rowIndex:i.currentRow,colIndex:i.currentCol,colSpan:i.colSpan,rowSpan:i.rowSpan,fixedColumns:n.fixedColumns,fixedRows:n.fixedRows};t.push(c._renderResizeHandler(Object.assign(u,{direction:"x",className:"grid-column-resizer",defaultValue:n.fixedColumnWidth,currentValue:i.gridCellColumnWidth,bound:24,skipBound:r}))),t.push(c._renderResizeHandler(Object.assign(u,{direction:"y",className:"grid-row-resizer",defaultValue:n.fixedRowHeight,currentValue:i.gridCellRowHeight,bound:24,skipBound:l})))},c.captureFixedCellInfo=function(e,t,i,n,a){var o,s={},r="",l="";"row"===a?(s.currentRow=e,s.currentCol=t+n.fixedColumns,s.rowBound=n.fixedRows,s.colBound=n.numColumns+n.fixedColumns-1,s.scope="col",s.cellType="row",s.dataValue=n.dataProvider.getValue(s.currentRow,s.currentCol),s.isMeasure=c.getDataCellValue(s.dataValue,"isMeasure"),s.area="cell_edge_column",s.valueType=c.getDataCellValue(s.dataValue,"type"),s.isMeasure&&"column"===s.valueType&&(s.valueType="corner",s.area="values"),r="row",l=c.calculateFixedRowCellSize):(s.currentRow=e+n.fixedRows,s.currentCol=t,s.rowBound=n.numRows+n.fixedRows-1,s.colBound=n.fixedColumns,s.scope="row",s.dataValue=n.dataProvider.getValue(s.currentRow,s.currentCol),s.isMeasure=c.getDataCellValue(s.dataValue,"isMeasure"),s.cellType="column",s.area="cell_edge_row",s.valueType=c.getDataCellValue(s.dataValue,"type"),s.isMeasure&&"row"===s.valueType&&(s.valueType="corner",s.area="values"),r="columnrow",l=c.calculateFixedColumnCellSize),s.rowIndex=e,s.colIndex=t,s.baseGridCellProps={style:JSON.stringify(i),onClick:i.onClick},s.currentCellKey=s.currentRow+" "+s.currentCol,s.dataValue=s.dataValue||n.dataProvider.getValue(s.currentRow,s.currentCol),s.resizeKey=c.buildResizeKey(s.dataValue.ancestor_or_self),s.isSummary=c.isSummary(s.dataValue),s.useValue=c.getDataCellValue(s.dataValue,"useValue"),s.valueType=s.valueType||c.getDataCellValue(s.dataValue,"type"),s.dataCellValue=c.getDataCellValue(s.dataValue),s.nestLevel=c.getDataCellValue(s.dataValue,"nestlevel");var u=n.crosstabGrid._getSpanIndex({colIndex:s.currentCol,rowIndex:s.currentRow,colBound:s.colBound,rowBound:s.rowBound,dataProvider:n.dataProvider,fixedRows:n.fixedRows,fixedColumns:n.fixedColumns,dataCellValue:s.dataCellValue,useValue:s.useValue,gridCellProps:i,defaultColumnWidth:n.fixedColumnWidth,defaultRowHeight:n.fixedRowHeight,ignoreGrouping:(o={},o[r]=!s.isSummary,o),isSummaryCell:s.isSummary});return Object.assign(s,u),c.updateCoveredCellSet(s,n),s.isCellBelowInSummaryRow=c.isCellBelowInSummaryRow(s.currentRow+s.rowSpan+1,s.currentCol,n.dataProvider,!0,c.isLastSummaryMeasure(s,n)),s.expandOptions=c.getFixedCellExpandInfo(s,n,a,i),s.size=l(s,n,i),s},c.isSummaryMeasure=function(e){var t=e.dataValue.ancestor_or_self;return!!(t&&t.length>1&&t[t.length-2].isSummary)},c.isLastSummaryMeasure=function(e,t){if(c.isSummaryMeasure(e)){var i=t.dataProvider.getValue(e.currentRow,e.currentCol-1);if(i&&e.dataValue.index===i.noOfChildren-1)return!0}return!1},c.renderTextCellOfFixedCell=function(e,i,n){var a,s,r,l,u={},d={},h=["dashboard-text-cell"];"row"===n?(a="row-header-padding-right",s={position:"absolute",left:e.size.baseWidth-3,width:e.size.totalWidth-e.size.baseWidth,height:32},r="row-header-padding-bottom",l={position:"absolute",left:0,top:32,width:e.size.baseWidth,height:e.size.totalHeight-32},u["padding-top"]=0,d["min-height"]=i.crosstabGrid.textStyle.columnHeadingStyles["font-size"]):(a="column-header-padding-right",s={position:"absolute",left:21,width:e.size.totalWidth-24,height:e.size.baseHeight},r="column-header-padding-bottom",l={position:"absolute",left:0,top:e.size.baseHeight,width:24,height:e.size.totalHeight-e.size.baseHeight},u["padding-top"]=0,d["min-height"]=i.crosstabGrid.textStyle.rowHeadingStyles["font-size"]);var p=e.isSummary?null:e.dataValue?e.dataValue.formatSpec:null,g=i.isSuppressed?o.format(e.dataCellValue,p):o.formatNull(e.dataCellValue),m=[];if(void 0!==e.expandOptions.levelNumber){var f=e.expandOptions.isExpanded?c.renderCollapseButton(e.expandOptions,i):c.renderExpandButton(e.expandOptions,i);m.push(f)}var v=null,_=null;if(u.display="flex",u["align-items"]="center",e.expandOptions.isExpanded){e.expandOptions.isExpansionLineageHintSupported?(u["padding-bottom"]=0,delete u["padding-top"]):(u.height="100%",u.padding=0),Object.assign(d,{overflow:"hidden","text-overflow":"ellipsis"});var b=t.createElement("div",{style:d},[g]);m.push(b),u["box-sizeing"]="border-box",u.flex="none",h.push("expanded"),v=t.createElement("div",{class:a,style:s}),_=t.createElement("div",{class:r,style:l}),m.push(v,_)}else{u.height="100%",Object.assign(d,{height:"100%",display:"flex",alignItems:"center",overflow:"hidden"});var y=t.createElement("span",{style:{overflow:"hidden","text-overflow":"ellipsis","line-height":"1.2"}},g),I=t.createElement("div",{style:d},[y]);m.push(I)}return t.createElement("div",{class:h.join(" "),style:u},m)},c.calculateFixedRowCellSize=function(e,t,i){var n={};if(i.style.width=e.gridCellColumnWidth,(e.currentCol+e.colSpan+1>=t.numColumns||e.isSummary)&&(i.style.width=i.style.width-2),n.baseWidth=i.style.width,e.expandOptions.isExpanded&&e.expandOptions.isExpansionLineageHintSupported&&(i.style.width+=c.sumOfAllChildrenColumnWidths(e,t),t.crosstabGrid.columnWidthDeltas[e.resizeKey]&&(i.style.width+=t.crosstabGrid.columnWidthDeltas[e.resizeKey])),n.totalWidth=i.style.width,i.style.width+="px",i.style.height=e.gridCellRowHeight,e.isSummary||(i.style.height=Math.min(e.gridCellRowHeight,t.maxColHeight)),e.expandOptions.levelNumber-e.expandOptions.rootLevel>0){var a=32*(e.expandOptions.levelNumber-e.expandOptions.rootLevel);i.style.height-=a,i.style.top+=a}return n.baseHeight=i.style.height,n.totalHeight=i.style.height,i.style.height+="px",e.expandOptions&&!e.expandOptions.isExpansionLineageHintSupported&&(i.style.marginTop=i.style.top,delete i.style.top),n},c.sumOfAllChildrenColumnWidths=function(e,t){var i=0;if(e.expandOptions.isExpanded)for(var n=e.currentCol+1,a=e.currentCol+e.expandOptions.numberOfChildren;n<=a;n++)i+=t.crosstabGrid._getColumnWidth(t.dataProvider,e.currentRow,n,t.fixedColumnWidth);return i},c.calculateFixedColumnCellSize=function(e,t,i){var n={};if(i.style.width=e.gridCellColumnWidth,i.style.width&&(i.style.width-=1),e.expandOptions.levelNumber-e.expandOptions.rootLevel>0){var a=24*(e.expandOptions.levelNumber-e.expandOptions.rootLevel);i.style.width-=a,i.style.left+=a}return n.baseWidth=i.style.width,n.totalWidth=i.style.width,i.style.width+="px",e.expandOptions&&!e.expandOptions.isExpansionLineageHintSupported&&(i.style.marginLeft=i.style.left,delete i.style.left),i.style.height=Math.min(e.gridCellRowHeight,t.maxColHeight)-1,(e.isSummary||c.isLastSummaryMeasure(e,t))&&(e.isCellBelowInSummaryRow||(i.style.height-=1)),e.currentRow+e.rowSpan+1>=t.dataProvider.getNumRows()&&(i.style.height-=1),n.baseHeight=i.style.height,e.expandOptions.isExpanded&&e.expandOptions.isExpansionLineageHintSupported&&(i.numberOfChildren=e.expandOptions.numberOfChildren,i.style.height+=e.expandOptions.numberOfChildren*t.fixedRowHeight,t.crosstabGrid.rowHeightDeltas[e.resizeKey]&&(i.style.height+=t.crosstabGrid.rowHeightDeltas[e.resizeKey])),n.totalHeight=i.style.height,i.style.height+="px",n},c.updateCoveredCellSet=function(e,t){for(var i=0;i<=e.rowSpan;i++)for(var n=0;n<=e.colSpan;n++)0===i&&0===n||t.coveredCellSet.add(e.currentRow+i+" "+(e.currentCol+n))},c.isCellBelowInSummaryRow=function(e,t,i,n,a){var o;if(void 0===a&&(a=!1),i.getNumRows()>e){var s=i.getValue(e,t);o=n?(o=c.isSummary(s))||a&&c.isSummary(i.getValue(e,t-1)):c.isInSummaryRow(s)}else o=!1;return o},c.isSummary=function(e){return!!e&&(e.rowEdge&&e.columnEdge?e.columnEdge.isSummary||e.rowEdge.isSummary:e.isSummary)},c.isInSummaryRow=function(e){return e&&e.rowEdge&&e.rowEdge.isSummary},c.getFixedCellExpandInfo=function(e,t,i,n){var a,o=t.pivotTable.getLevelInfo(),s=c._getSiblingDataValue(i,e,t);if("row"===i){var r=c.getCachedDataItemInfoByIndex(t.crosstabGrid._cachedColumnDataItemInfo,e.rowIndex),l=r&&r.isProperty;a=t.isExpandable&&!l?c.getExpandOptions(e.dataValue,s,r,o.row[e.rowIndex],"top",n):{}}else{var u=c.getCachedDataItemInfoByIndex(t.crosstabGrid._cachedRowDataItemInfo,e.colIndex),d=u&&u.isProperty;a=t.isExpandable&&!d?c.getExpandOptions(e.dataValue,s,u,o.col[e.colIndex],"left",n):{}}return a.isExpanded&&(a.numberOfChildren=c.getFixedCellExpandChildren(e,t,a,i,n),a.numberOfChildren&&(a.hasChildren=!0)),a},c._getSiblingDataValue=function(e,t,i){var n;if("row"===e){var a=i.crosstabGrid.rowEdgeHasMeasures()?1:i.pivotTable.getNumberOfMeasures();n=t.colIndex+i.fixedColumns+a<i.numColumns?i.dataProvider.getValue(t.rowIndex,t.colIndex+i.fixedColumns+a):null}else{var o=i.crosstabGrid.rowEdgeHasMeasures()?i.pivotTable.getNumberOfMeasures():0;n=t.rowIndex+i.fixedRows+o<i.numRows-1?i.dataProvider.getValue(t.rowIndex+i.fixedRows+o+1,t.colIndex):null}return n},c.getFixedCellExpandChildren=function(e,t,i,n,a){var o,s,r,l,u=0;for("row"===n?(o=e.currentCol+e.colSpan+1,s=e.colBound,r=function(e,t){return{row:e.currentRow,col:t}},l=function(e,i){return{rowIndex:e.rowIndex,colIndex:e.colIndex+(i-e.currentCol),dataValue:t.dataProvider.getValue(e.currentRow,i)}}):(o=e.currentRow+e.rowSpan+1,s=e.rowBound,r=function(e,t){return{row:t,col:e.currentCol}},l=function(e,i){return{rowIndex:e.rowIndex+(i-e.currentRow),colIndex:e.colIndex,dataValue:t.dataProvider.getValue(i,e.currentCol)}});o<=s;){var d=r(e,o),h=d.row+" "+d.col,p=c.getFixedCellExpandInfo(l(e,o),t,n,a);if(!(i.rootLevel===p.rootLevel&&i.levelNumber<p.levelNumber))break;var g=JSON.stringify({cellKey:e.currentCellKey,resizeKey:e.resizeKey});t.expandedLeafMap.has(h)?-1===t.expandedLeafMap.get(h).indexOf(g)&&t.expandedLeafMap.get(h).push(g):t.expandedLeafMap.set(h,[g]),t.expandedRootMap.has(e.currentCellKey)||t.expandedRootMap.set(e.currentCellKey,[h]),u+=1,o+=1}return u},c._buildFixedSectionClassList=function(e,t,i,n){var a=i.className?[i.className]:[];return a.push("dashboard-grid-cell"),"row"===n?this._addGridFixedRowStylesToClassList(e,t,a):this._addGridFixedColumnStylesToClassList(e,t,a),a},c._addGridCornerStylesToClassList=function(e,t,i){e.valueType&&"corner"===e.valueType&&t.measureHeaderDecorations.indexOf(e.useValue)>-1&&i.push("dashboard-grid-cell-selected")},c._addGridFixedRowStylesToClassList=function(e,t,i){i.push("grid-fixed-row-cell"),this._addGridCornerStylesToClassList(e,t,i),e.isSummary&&(i.push("summary"),t.isSummaryHighlighted&&i.push("dashboard-grid-cell-selected"))},c._addGridFixedColumnStylesToClassList=function(e,t,i){i.push("grid-fixed-column-cell"),this._addGridCornerStylesToClassList(e,t,i),e.isCellBelowInSummaryRow&&e.isSummary&&i.push("above-summary-row"),(e.isSummary||c.isSummaryMeasure(e))&&(e.isSummary?i.push("summary","summary-row"):i.push("summary-measure-cell"),i.push("summary-row-top-border"),(!e.isCellBelowInSummaryRow||e.rowBound>=t.numRows)&&i.push("summary-row-bottom-border"),t.isSummaryHighlighted&&i.push("dashboard-grid-cell-selected"))},c.parseCellKey=function(e){var t=e.split(" ");return{row:parseInt(t[0]),col:parseInt(t[1])}},c.renderHiddenRowsAndColumnsHandler=function(e,i,n){return void 0===i&&(i="bottom"),t.createElement("div",{class:"grid-hidden-rowsAndColumns "+i,onDoubleClick:function(){n.content.setPropertyValue("hiddenRowsAndColumns",n.hiddenRowsAndColumns.filter((function(t){return t!==e})))}},"")},c.getDataCellValue=function(e,t){var n=function(e){if(null!=e)return e.value&&void 0!==e.value.label?e.value.label:e.value};if("tuple"===t)e=e&&e.tuple;else if("useValue"===t)e=e&&e.isMeasure?n(e):function(e){if(e&&e.type&&("column"===e.type||"row"===e.type)){var t=e.ancestor_or_self;if(t)return i.pluck(t,"value")+""}return null}(e);else if("condValue"===t)e=e&&e.condValue;else if("type"===t)e=e&&e.type;else if("isMeasure"===t)e=e&&e.isMeasure;else if("nestlevel"===t)e=e&&e.nestlevel;else if("rowEdge"===t)e=e&&e.rowEdge;else if("columnEdge"===t)e=e&&e.columnEdge;else if("ancestor_or_self"===t)e=e&&e.ancestor_or_self;else if("levelNumber"===t)e=e&&e.value&&e.value.ln;else if("parentUseValue"===t)e=e&&e.value&&e.value.pu;else{var a=n(e);e=void 0===a?"":a}return e},c.getExpandOptions=function(e,t,i,n,a,o){var s=c.getDataCellValue(e,"useValue").split(","),r=t&&c.getDataCellValue(t,"useValue").split(","),l=s[s.length-1],u=r&&r[r.length-1],d=!!(i&&i.expandMap&&i.expandMap[l]),h=!0;return o&&!1===o.isExpansionLineageHintSupported&&(h=!1),{dataItemInfo:i,parentUseValue:c.getDataCellValue(e,"parentUseValue"),currentUseValue:l,levelNumber:c.getDataCellValue(e,"levelNumber"),isExpanded:d,isExpansionLineageHintSupported:h,position:a,rootLevel:n&&n.rootLevelnumber,hasChildren:!(!t||l!==c.getDataCellValue(t,"parentUseValue")&&l!==u)}},c.renderExpandButton=function(i,a){var o=i.dataItemInfo,s=i.parentUseValue,r=i.currentUseValue,l=a.content&&a.content.getFeature("ExpandCollapse");return t.createElement(n.Button,{icon:a.crosstabGrid.iconsFeature.getIcon("add16"),iconSize:"small",variant:"icon",intent:"primary",title:e.get("expandBtnLabel"),hasIconOnly:!1,onClick:function(e){l.expand(o.dataitemUniqueId,s,r),e.stopPropagation()}})},c.renderCollapseButton=function(i,a){var o=i.dataItemInfo,s=i.parentUseValue,r=i.currentUseValue,l=i.hasChildren,c=a.content&&a.content.getFeature("ExpandCollapse");return t.createElement(n.Button,{icon:a.crosstabGrid.iconsFeature.getIcon("subtract"),iconSize:"small",variant:"icon",intent:"primary",title:e.get("collapseBtnLabel"),hasIconOnly:!1,onClick:function(e){c.collapse(o.dataitemUniqueId,s,r),e.stopPropagation()},style:l?{}:{visibility:"hidden"}})},c.buildResizeKey=function(e){var t="";return i.each(e,(function(e){e.value?t+=e.value+",":t+=e+","})),t.slice(0,-1)},c.getCachedDataItemInfoByIndex=function(e,t,i){var n=e&&e[t];return i?n&&n[i]:n},c.setSummaryColor=function(e,t){var n=t.conditionalFormatting&&t.conditionalFormatting.getSummaryFillColor();n&&i.extend(e.style,{"background-color":n})},c._isHiddenLane=function(e,t,i){return"row"===e?i._cachedHiddenCol[t.currentCol]&&(0===t.gridCellColumnWidth||Math.floor(t.gridCellColumnWidth)%i.fixedColumnWidth!=0):i._cachedHiddenRow[t.currentRow]&&(0===t.gridCellRowHeight||Math.floor(t.gridCellRowHeight)%i.fixedRowHeight!=0)},c}()})),define("dashboard-analytics/visualizations/renderer/crosstab/GridData",[],(function(){return function(){function e(e){var t=e.numFixedRows,i=e.numFixedColumns,n=e.numRows,a=e.numColumns,o=e.cornerGridExpandAreas,s=e.fixedRowExpandAreas,r=e.fixedColumnExpandAreas,l=e.dataExpandAreas;this.grid=[],this.numFixedRows=t||0,this.numFixedColumns=i||0,this.numRows=n,this.numColumns=a,this.totalRows=this.numFixedRows+this.numRows,this.totalColumns=this.numFixedColumns+this.numColumns,this.cornerGridExpandAreas=o,this.fixedRowExpandAreas=s,this.fixedColumnExpandAreas=r,this.dataExpandAreas=l}var t=e.prototype;return t._setCell=function(e){var t=e.content,i=e.attributes,n=e.rowIndex,a=e.colIndex;this.grid[n]||(this.grid[n]=[]),this.grid[n][a]={content:t,attributes:i}},t._getCell=function(e){var t=e.rowIndex,i=e.colIndex;return this.grid[t]||(this.grid[t]=[]),this.grid[t][i]||(this.grid[t][i]={content:null,attributes:{}}),this.grid[t][i]},t.setCornerGridContent=function(e){var t=e.renderer,i=e.props,n=void 0===i?{}:i;this._setCell(_extends({rowIndex:0,colIndex:0},t(0,0,n)))},t.setFixedRowContent=function(e){var t=e.renderer,i=e.rowIndex,n=e.colIndex,a=e.props,o=void 0===a?{}:a;this._setCell(_extends({rowIndex:i,colIndex:n+this.numFixedColumns},t(i,n,o)))},t.setFixedColumnContent=function(e){var t=e.renderer,i=e.rowIndex,n=e.colIndex,a=e.props,o=void 0===a?{}:a;this._setCell(_extends({rowIndex:i+this.numFixedRows,colIndex:n},t(i,n,o)))},t.setDataContent=function(e){var t=e.renderer,i=e.rowIndex,n=e.colIndex,a=e.props;this._setCell(_extends({rowIndex:i+this.numFixedRows,colIndex:n+this.numFixedColumns},t(i,n,a)))},t._getSpans=function(e){var t=e.outerIteratorMin,i=e.outerIteratorMax,n=e.innerIteratorMin,a=e.innerIteratorMax,o=e.areaList,s=e.getArea,r=e.setSpan;if(o&&o.length)for(var l=t;l<i;l++)for(var c=-1,u=n;u<a;u++){var d=s({outerIterator:l,innerIterator:u});d?c=o.indexOf(d)>=0?u:-1:c>-1&&r({outerIterator:l,innerIterator:c,spanLength:u-c+1})}},t._getArea=function(e){var t=e.rowIndex,i=e.colIndex,n=this._getCell({rowIndex:t,colIndex:i}),a=n.content,o=n.attributes;return a?o.area:null},t._populateColSpans=function(e){var t=this,i=e.rowIndexMin,n=e.rowIndexMax,a=e.colIndexMin,o=e.colIndexMax,s=e.areaList;this._getSpans({outerIteratorMin:i,outerIteratorMax:n,innerIteratorMin:a,innerIteratorMax:o,areaList:s,getArea:function(e){var i=e.outerIterator,n=e.innerIterator;return t._getArea({rowIndex:i,colIndex:n})},setSpan:function(e){var i=e.outerIterator,n=e.innerIterator,a=e.spanLength;t._getCell({rowIndex:i,colIndex:n}).attributes.colSpan=a}})},t._populateRowSpans=function(e){var t=this,i=e.colIndexMin,n=e.colIndexMax,a=e.rowIndexMin,o=e.rowIndexMax,s=e.areaList;this._getSpans({outerIteratorMin:i,outerIteratorMax:n,innerIteratorMin:a,innerIteratorMax:o,areaList:s,getArea:function(e){var i=e.outerIterator,n=e.innerIterator;return t._getArea({rowIndex:n,colIndex:i})},setSpan:function(e){var i=e.outerIterator,n=e.innerIterator,a=e.spanLength;t._getCell({rowIndex:n,colIndex:i}).attributes.rowSpan=a}})},t._populateSpans=function(e){var t=e.rowIndexMin,i=e.rowIndexMax,n=e.colIndexMin,a=e.colIndexMax,o=e.areas;this._populateColSpans({rowIndexMin:t,rowIndexMax:i,colIndexMin:n,colIndexMax:a,areaList:o&&o.horizontal}),this._populateRowSpans({rowIndexMin:t,rowIndexMax:i,colIndexMin:n,colIndexMax:a,areaList:o&&o.vertical})},t._populateCornerGridSpans=function(){this._populateSpans({rowIndexMin:0,rowIndexMax:this.numFixedRows,colIndexMin:0,colIndexMax:this.numFixedColumns,areas:this.cornerGridExpandAreas})},t._populateFixedRowSpans=function(){this._populateSpans({rowIndexMin:this.numFixedRows,rowIndexMax:this.totalRows,colIndexMin:0,colIndexMax:this.numFixedColumns,areas:this.fixedRowExpandAreas})},t._populateFixedColSpans=function(){this._populateSpans({rowIndexMin:0,rowIndexMax:this.numFixedRows,colIndexMin:this.numFixedColumns,colIndexMax:this.totalColumns,areas:this.fixedColumnExpandAreas})},t._populateDataSpans=function(){this._populateSpans({rowIndexMin:this.numFixedRows,rowIndexMax:this.totalRows,colIndexMin:this.numFixedColumns,colIndexMax:this.totalColumns,areas:this.dataExpandAreas})},t._getNonTrivialCells=function(){for(var e=[],t=0;t<this.totalRows;t++){var i=[];e.push(i);for(var n=0;n<this.totalColumns;n++){var a=this._getCell({rowIndex:t,colIndex:n}),o=a.content,s=a.attributes;o&&i.push({content:o,attributes:s})}}return e},t.getTable=function(){return this._populateCornerGridSpans(),this._populateFixedRowSpans(),this._populateFixedColSpans(),this._populateDataSpans(),this._getNonTrivialCells()},e}()})),define("dashboard-analytics/visualizations/renderer/common/WidthScaler",["react","prop-types"],(function(e,t){var i;return(i=function(t){function i(i){var n;return(n=t.call(this,i)||this).ref=e.createRef(),n}_inheritsLoose(i,t);var n=i.prototype;return n.componentDidMount=function(){this._updateScale()},n._updateScale=function(){if(this.props.maxWidth){var e=this.props.getNode();if(e){var t=this.ref.current;t.style.transform="",t.style.height="auto";var i,n=e.getBoundingClientRect(),a=this.props.maxWidth/n.width;if(a<1){i=a;var o=n.height*a;t.style.height=o+"px",t.style.transformOrigin="left top",t.style.transform="scale("+a+")"}else i=1;t.style.height=n.height*i*this.props.browserErrorScale+"px"}}},n.render=function(){return e.createElement("div",{className:"widthScaler",ref:this.ref},this.props.children)},i}(e.Component)).propTypes={children:t.arrayOf(t.node).isRequired,getNode:t.node.isRequired,maxWidth:t.number.isRequired,browserErrorScale:t.number},i.defaultProps={browserErrorScale:1},i})),define("dashboard-analytics/visualizations/renderer/common/PrintHelper",["../../../lib/@waca/core-client/js/core-client/utils/BrowserUtils"],(function(e){"use strict";var t,i=["extendedContent","newPage"];return(t=function(){function t(){}return t.getPageWidth=function(e){return e.getFeature("Visualization.internal").getExtendedRenderWidth()-12},t.isInPrintLayoutMode=function(e){var t=e.getFeature("DashboardSettings");return t&&"print"===t.get("layoutMode")},t.isRenderFullEnabled=function(e,n){return t.isInPrintLayoutMode(e)&&(-1!==i.indexOf(n.getPropertyValue("PdfPrint"))||!1)},t.getBrowserErrorScale=function(){return e.isSafari()?1.035:e.isFirefox()?1.01:1},t}()).pageWidthError=12,t})),define("dashboard-analytics/visualizations/renderer/crosstab/CrosstabPrintGrid",["react","prop-types","./GridData","../common/WidthScaler","../common/PrintHelper","@waca/dashboard-common/js/utils/CommonUtil"],(function(e,t,i,n,a,o){var s,r={expansionLineageHintSupported:!1};return(s=function(t){function s(i){var n;return(n=t.call(this,i)||this).ref=e.createRef(),n}_inheritsLoose(s,t),s.getRenderSupportFlag=function(e){return r[e]};var l=s.prototype;return l.recomputeGridSize=function(){},l._rendererWrapper=function(e){var t=this,i=e.renderer,n=e.props,a=void 0===n?{}:n;return function(e,n,o){return void 0===o&&(o={}),t._renderCell({renderer:i,props:_extends({},a,o),rowIndex:e,colIndex:n})}},l._renderCell=function(e){var t=e.renderer,i=e.rowIndex,n=e.colIndex,a=e.props,s=_extends({className:"",isExpansionLineageHintSupported:!1},void 0===a?{}:a),r=t(i,n,s);delete s.style.width;var l=o.deepClone(s);return delete l.style.paddingLeft,delete l.style.paddingTop,delete l.style.display,{content:r,attributes:l}},l._setCornerGridContent=function(e){var t=e.gridData,i=e.getRowHeight,n=e.getColumnWidth;this.props.fixedRows>0&&this.props.fixedColumns>0&&t.setCornerGridContent({renderer:this._rendererWrapper({renderer:this.props.fixedCornerCellRenderer,props:{style:{width:n(0),height:i(0),left:0,top:0}}})})},l._setFixedColumnContent=function(e){for(var t=e.gridData,i=e.getRowHeight,n=e.getColumnWidth,a=0;a<this.props.numRows;a++)for(var o=0;o<this.props.fixedColumns;o++)t.setFixedColumnContent({renderer:this._rendererWrapper({renderer:this.props.fixedColumnCellRenderer}),rowIndex:a,colIndex:o,props:{style:{width:n(o),height:i(a),left:0,top:0}}})},l._setFixedRowContent=function(e){for(var t=e.gridData,i=e.getRowHeight,n=e.getColumnWidth,a=0;a<this.props.fixedRows;a++)for(var o=0;o<this.props.numColumns;o++)t.setFixedRowContent({renderer:this._rendererWrapper({renderer:this.props.fixedRowCellRenderer}),rowIndex:a,colIndex:o,props:{style:{width:n(o),height:i(a),left:0,top:0}}})},l._setDataContent=function(e){for(var t=e.gridData,i=e.getRowHeight,n=e.getColumnWidth,a=0;a<this.props.numRows;a++)for(var o=0;o<this.props.numColumns;o++)t.setDataContent({renderer:this._rendererWrapper({renderer:this.props.dataCellRenderer}),rowIndex:a,colIndex:o,props:{style:{width:n(o),height:i(a),left:0,top:0}}})},l.render=function(){var t=this,o=new i({numFixedRows:this.props.fixedRows,numFixedColumns:this.props.fixedColumns,numRows:this.props.numRows,numColumns:this.props.numColumns,cornerGridExpandAreas:{horizontal:["values"],vertical:["values"]},fixedRowExpandAreas:{horizontal:["summary"],vertical:["cell_edge_row"]},fixedColumnExpandAreas:{horizontal:["cell_edge_column"],vertical:["summary"]}});this._setCornerGridContent({gridData:o,getRowHeight:function(e){return t.props.rowHeight(e)},getColumnWidth:function(e){return t.props.columnWidth(e)}}),this._setFixedColumnContent({gridData:o,getRowHeight:function(e){return t.props.rowHeight(e+t.props.fixedRows)},getColumnWidth:function(e){return t.props.columnWidth(e)}}),this._setFixedRowContent({gridData:o,getRowHeight:function(e){return t.props.rowHeight(e)},getColumnWidth:function(e){return t.props.columnWidth(e+t.props.fixedColumns)}}),this._setDataContent({gridData:o,getRowHeight:function(e){return t.props.rowHeight(e+t.props.fixedRows)},getColumnWidth:function(e){return t.props.columnWidth(e+t.props.fixedColumns)}});var s=o.getTable().map((function(t,i){return e.createElement("tr",{key:i},t.map((function(t,i){var n=t.content,a=t.attributes;return e.createElement("td",_extends({},a,{key:i}),n)})))}));return e.createElement(n,{getNode:function(){return t.ref.current},maxWidth:this.props.pageWidth,browserErrorScale:a.getBrowserErrorScale()},e.createElement("table",{ref:this.ref,className:"print-table",border:"0",cellPadding:"0",cellSpacing:"0",style:this.props.style},s))},s}(e.Component)).propTypes={fixedCornerCellRenderer:t.func.isRequired,fixedRowCellRenderer:t.func.isRequired,fixedColumnCellRenderer:t.func.isRequired,dataCellRenderer:t.func.isRequired,fixedRows:t.number.isRequired,fixedColumns:t.number.isRequired,numRows:t.number.isRequired,numColumns:t.number.isRequired,rowHeight:t.func.isRequired,columnWidth:t.func.isRequired,style:t.object.isRequired,pageWidth:t.number},s})),define("dashboard-analytics/visualizations/renderer/crosstab/CrosstabGrid",["./Pivot","../grid/GridDnDManager","underscore","../grid/GridDataProvider","../grid/GridDropTarget","../grid/GridContentRenderer","react-dom","react","@ba/ba-ui-carbon-toolkit","react-draggable","jquery","../../../util/DashboardFormatter","./CrosstabGridCellRenderers","./CrosstabPrintGrid","../common/PrintHelper"],(function(e,t,i,n,a,o,s,r,l,c,u,d,h,p,g){"use strict";var m="cell",f="values",v="summary",_="10pt",b="IBM Plex Sans",y=18;return function(){function I(e){e=e||{},this.$el=e.$el,this.dashboardApi=e.dashboardApi,this.crosstabView=e.crosstabView,this.content=this.crosstabView&&this.crosstabView.content,this.colorsService=e.colorsService,this.iconsFeature=e.dashboardApi.getFeature("Icons"),this.conditionalFormatting=e.conditionalFormatting,this.dataProvider=new n,this.textStyleIndex={cell:"dataValueStyles",corner:"valueHeadingStyles",row:"rowHeadingStyles",column:"columnHeadingStyles",summary:"summaryStyles",selectedArea:"selectedAreaStyles"},g.isInPrintLayoutMode(this.dashboardApi)||(this._gridDnDManager=new t({grid:this,dashboardApi:this.dashboardApi,content:this.content,gridEdgeMappedToId:{row:"row_level1",column:"column_level1",values:"values"}})),g.isRenderFullEnabled(this.dashboardApi,this.content)?this.Grid=p:this.Grid=l.Grid,this._shapeCols=[],this.rowHeightDeltas=new Map,this.columnWidthDeltas=new Map,this._getDataCellValue=h.getDataCellValue,this._isSummary=h.isSummary,this._buildResizeKey=h.buildResizeKey,this._isCellBelowInSummaryRow=h.isCellBelowInSummaryRow,this.renderedTheme=this.colorsService.getThemeDefinition().getId(),this._measureHeaderDecorations=[],this._selectedMeasureNodes=[]}var C=I.prototype;return C.render=function(t,i,n,a){this.eventHandler=a;var o=this.content.getFeature("Visualization").getSlots(),s=o.getSlot("column_level1").getDataItemList().length>0,r=o.getSlot("row_level1").getDataItemList().length>0,l=this.content.getPropertyValue("valuesAsRows");this.showValuesOnRows="rowsAuto"===l?s:s&&!r,i&&!n&&this.data||(this._pivotTable=new e({data:t,content:this.content,slots:this.content.getFeature("Visualization").getSlots(),dashboard:this.dashboardApi,conditionalFormatting:this.conditionalFormatting,visFormatSpec:this.content.getPropertyValue("format"),showValuesOnRows:this.showValuesOnRows}),this.data=this._pivotTable.create(),this._cellWidthStatus=null),this._alternateRowFlag=-1,this._cellStartRow=this._pivotTable.colEdgeNestingLevelWithMeasure?this._pivotTable.colEdgeNestingLevelWithMeasure:this._pivotTable.colEdgeNestingLevel;var c=this.colorsService.getThemeDefinition().getId();return this.gridRef&&i&&!n&&this.renderedTheme===c?(this.onResize(),this.onSyncScrollBar(),Promise.resolve(!0)):(this.renderedTheme=c,this.dataProvider.updateData(this.data),this._errorWarningAdded?this._errorWarningAdded=!1:this.crosstabView.clearInfoIndicator("error_summary_cell"),this.$el.addClass("dashboard-common-grid").addClass("xtab-grid"),this._renderReactGrid(),this.gridRef?Promise.resolve(!0):Promise.resolve(!1))},C.onResize=function(){this.maxColHeight=this._getMaxColHeight(),this.gridRef&&this.gridRef.recomputeGridSize()},C._getMaxColHeight=function(){return this.$el&&this.$el.length&&this.$el[0].offsetHeight||1/0},C.onSyncScrollBar=function(){var e=u(this.$el[0]),t=e.find(".ba-common-grid__bottom-right-grid"),i=e.find(".ba-common-grid__top-right-grid"),n=e.find(".ba-common-grid__bottom-left-grid");u(t).animate({scrollLeft:u(i).scrollLeft(),scrollTop:u(n).scrollTop()},0)},C.removeGridView=function(){this.gridRef&&this.$el&&(s.unmountComponentAtNode(this.$el[0]),this.gridRef=null)},C.remove=function(){this.columnWidths=null,this.rowHeights=null,this.rowHeightDeltas=null,this.columnWidthDeltas=null,this.fixedRowHeight=null,this.fixedColumnWidth=null,this.hiddenRowsAndColumns=null,this._cachedHiddenCol=null,this._cachedHiddenRow=null,this._cachedRowDataItemInfo=null,this._cachedLevelInfo=null,this._cachedColumnDataItemInfo=null,this.expandCollapseFeature=null,this.isExpandable=null,this.isExpansionLineageHintSupported=null,this.dataProvider=null,this.data=null,this._pivotTable=null,this.eventHandler=null,this._selections=null,this._measureHeaderDecorations=null,this._selectedMeasureNodes=null,this._isSummaryHighlighted=null,this._cellWidthStatus=null,this._canvas=null,this.removeGridView(),this.$el=null},C._setSummaryColor=function(e){var t=this.conditionalFormatting&&this.conditionalFormatting.getSummaryFillColor();t&&i.extend(e.style,{"background-color":t})},C._getConditionalFormatting=function(e,t,i){var n,a=i>=0&&this._pivotTable.getNumberOfMeasures()>i?this._pivotTable._measuresInfo[i]:void 0;if(a){var o=this.content.getFeature("Visualization").getSlots().getDataItem(a.id);o&&(n=this.conditionalFormatting.getFormatting(t.rawValue,e.value,o.getColumnId()))}return n},C.restoreFormat=function(){this.fixedRowHeight=null,this.fixedColumnWidth=null,this.columnWidths=null,this.rowHeights=null,this.rowHeightDeltas=null,this.columnWidthDeltas=null},C.setFormat=function(e){this.fixedRowHeight=e.fixedRowHeight,this.fixedColumnWidth=e.fixedColumnWidth,this.columnWidths=e.columnWidths,this.rowHeights=e.rowHeights,this.rowHeights||(this.rowHeightDeltas=new Map),this.columnWidths||(this.columnWidthDeltas=new Map)},C.setHiddenRowsAndColumns=function(e){this.hiddenRowsAndColumns=e},C.setMeasureHeaderDecorations=function(e){var t=u(e).attr("usevalue");this._measureHeaderDecorations.indexOf(t)>-1||u(e).hasClass("dashboard-grid-cell-selected")?this.clearMeasureHeaderDecorations():(this._measureHeaderDecorations.push(t),this._selectedMeasureNodes.push(e))},C.getSelectedMeasureNodes=function(){return this._selectedMeasureNodes},C.clearMeasureHeaderDecorations=function(){this._measureHeaderDecorations.length=0,this._selectedMeasureNodes.length=0},C.highlightSummary=function(e){this._isSummaryHighlighted=!u(e).hasClass("dashboard-grid-cell-selected")},C.resetSummaryHighlight=function(){this._isSummaryHighlighted=!1},C.isSummaryHighlighted=function(){return this._isSummaryHighlighted},C._getSpanIndex=function(e){var t=e.colIndex,i=e.rowIndex,n=e.colBound,a=e.rowBound,o=e.dataProvider,s=e.fixedRows,r=e.fixedColumns,l=e.useValue,c=e.dataCellValue,u=e.gridCellProps,d=e.defaultColumnWidth,h=e.defaultRowHeight,p=e.ignoreGrouping,g=e.isSummaryCell,m=t+1,f=parseInt(u.style.width,10);if(!p.column){var v=0;for(i<s&&(v=i-1>=0?i-1:0);m<=n&&this._isMatchedBaseOnUniqueValueForEdgeCell({colIndex:m,dataCellValue:c,dataProvider:o,rowIndex:i,useValue:l,isSummaryCell:g})&&this._getDataCellValue(o.getValue(v,m))===this._getDataCellValue(o.getValue(v,t));)f+=this._getColumnWidth(o,s-1,m,d),m++}var _=m-t-1,b=i+1,y=parseInt(u.style.height,10);if(!p.row){var I=0;for(t<r&&(I=t-1>=0?t-1:0);b<=a&&this._isMatchedBaseOnUniqueValueForEdgeCell({colIndex:t,dataCellValue:c,dataProvider:o,rowIndex:b,useValue:l,isSummaryCell:g})&&this._getDataCellValue(o.getValue(b,I))===this._getDataCellValue(o.getValue(i,I));)y+=this._getRowHeight(o,b,r-1,h),b++}return{colSpan:_,rowSpan:b-i-1,gridCellColumnWidth:f,gridCellRowHeight:y}},C._isMatchedBaseOnUniqueValueForEdgeCell=function(e){var t=e.colIndex,i=e.dataCellValue,n=e.dataProvider,a=e.rowIndex,o=e.useValue,s=e.isSummaryCell,r=n.getValue(a,t),l=s;return s&&(l=this._isSummary(r)),!!l||(o&&this._getDataCellValue(r,"useValue")===o||!o&&this._getDataCellValue(r)===i)},C._calculateDelta=function(e,t,i,n){if(e+n<t)e=t-n;else if(i>0){var a=parseInt((e+n)/(i+1));a<t&&(e+=(t-a)*(i+1))}return e},C._onDraggableResize=function(e){if(void 0===e.delta||0!==e.delta){var t,i,n,a,o,s,r,l,c,u,d,h=e.cellInfo,p=e.gridInfo,g=e.dataProvider,m=e.direction,f=e.delta,v=e.rowIndex,_=e.colIndex,b=e.colSpan,y=e.rowSpan,I=e.fixedColumns,C=e.fixedRows,S=e.defaultValue,w=e.currentValue,R=e.skipBound,x=g.getValue(v,_);"x"===m?(o=this.columnWidths||{},s="columnWidths",t=_,n=v,i=b,a=24,r=g.getValue(C-1,t),l="corner"===this._getDataCellValue(r,"type")?this._getCachedDataItemInfoByIndex(this._cachedRowDataItemInfo,t,"dataitemId"):this._buildResizeKey(this._getDataCellValue(r,"ancestor_or_self")),d=C-1+" "+(t+1),u=(c=g.getNumColumns()-1>t+1&&g.getValue(C-1,t+1))&&"corner"===this._getDataCellValue(c,"type")?this._getCachedDataItemInfoByIndex(this._cachedRowDataItemInfo,t+1,"dataitemId"):this._buildResizeKey(this._getDataCellValue(c,"ancestor_or_self"))):(o=this.rowHeights||{},s="rowHeights",t=v,n=_,i=y,a=24,r=g.getValue(t,I-1),l="corner"===this._getDataCellValue(r,"type")?this._getCachedDataItemInfoByIndex(this._cachedColumnDataItemInfo,t,"dataitemId")||"Measures_Row":this._buildResizeKey(this._getDataCellValue(r,"ancestor_or_self")),d=t+1+" "+(I-1),u=(c=g.getNumRows()-1>t+1&&g.getValue(t+1,I-1))&&"corner"===this._getDataCellValue(u,"type")?this._getCachedDataItemInfoByIndex(this._cachedColumnDataItemInfo,t+1,"dataitemId")||"Measures_Row":this._buildResizeKey(this._getDataCellValue(u,"ancestor_or_self")));var P=f+w,L=this._buildResizeKey(this._getDataCellValue(x,"ancestor_or_self"));o[L]=P,o[l]=P;var D=0;if(!R&&n>=0&&i<=0&&u){o[u]=o[u]||S;var T=Math.max(o[u]-f,a),N=p.expandedLeafMap.get(h.currentCellKey),V=N&&N[N.length-1],A=p.expandedLeafMap.get(d),E=A&&A[A.length-1],z=V===E&&V,F=E&&JSON.parse(E).cellKey===h.currentCellKey;D=z||F?f+(T-o[u]):f,o[u]=T}if(i>0)for(var M=parseInt(P/(i+1)),O=i+1;O>0;)(l="x"===m?this._buildResizeKey(this._getDataCellValue(g.getValue(C-1,t+O-1),"ancestor_or_self")):this._buildResizeKey(this._getDataCellValue(g.getValue(t+O-1,I-1),"ancestor_or_self")))&&(o[l]=M),O--;if(h&&"col"===h.scope&&p&&p.expandedRootMap.has(h.currentCellKey)&&(this.columnWidthDeltas[L]?this.columnWidthDeltas[L]+=D-f:this.columnWidthDeltas[L]=D-f),h&&p&&p.expandedLeafMap.has(h.currentCellKey)){var k=p.expandedLeafMap.get(h.currentCellKey),H=JSON.parse(k[k.length-1]).resizeKey,W="col"===h.scope?this.columnWidthDeltas:this.rowHeightDeltas;W[H]?W[H]+=D:W[H]=D}this.crosstabView.setPropertyValue(s,o)}},C._onStartResizeGuideLine=function(e,t,n,a){var o,s={};"x"===t?(o="grid-column-resizer-guideLine",s.height=this.$el[0].clientHeight):(o="grid-row-resizer-guideLine",s.width=this.$el[0].clientWidth);var r=u(this.$el[0]).find("."+n);i.each(r,(function(e){u(e).addClass(n+"-resizing")}));var l=u(this.$el[0]).find(".xtab-grid-guideLine"),c=u(this.$el[0]).find("."+a).offsetParent().offsetParent().offset();u(l).addClass(o),s.top=e.clientY-c.top-1+"px",s.left=e.clientX-c.left-1+"px",u(l).css(s)},C._onDragResizeGuideLine=function(e,t,i){var n="x"===t,a=n?"grid-column-resizer-guideLine":"grid-row-resizer-guideLine",o=u(this.$el[0]).find("."+a),s=u(this.$el[0]).find("."+i).offsetParent().offsetParent().offset();n?u(o).css({left:e.clientX-s.left-1+"px"}):u(o).css({top:e.clientY-s.top-1+"px"})},C._onStopResizeGuideLine=function(e,t,n){var a="x"===t,o=a?"grid-column-resizer-guideLine":"grid-row-resizer-guideLine",s=a?{height:"",top:"",left:""}:{width:"",top:"",left:""},r=u(this.$el[0]).find("."+n);i.each(r,(function(e){u(e).removeClass(n+"-resizing")}));var l=u(this.$el[0]).find("."+o);u(l).css(s),u(l).removeClass(o)},C._renderResizeHandler=function(e){var t=this,i=e.cellInfo,n=e.gridInfo,a=e.dataProvider,o=e.direction,s=e.className,l=e.defaultValue,u=e.currentValue,d=e.containerClassName,h=e.offSetParent,p=e.rowIndex,g=e.colIndex,m=e.colSpan,f=e.rowSpan,v=e.fixedColumns,_=e.fixedRows,b=e.bound,y=e.skipBound,I="x"===o?m:f,C=r.createElement("div",{className:s,onDoubleClick:function(){var e="x"===o&&t._cellWidthStatus&&t._cellWidthStatus[g]&&t._cellWidthStatus[g].textWidth||l;-1!==t._shapeCols.indexOf(g)&&(e+=24);var s=e-u;if(I>0&&(s=e*I-u),s>0){var r={dataProvider:a,direction:o,delta:s,gridInfo:n,rowIndex:p,cellInfo:i,colIndex:g,colSpan:m,rowSpan:f,fixedColumns:v,fixedRows:_,defaultValue:l,currentValue:u,skipBound:y};t._onDraggableResize(r)}}},"");return r.createElement(c,{axis:o,position:{x:0,y:0},onStart:function(e){t._onStartResizeGuideLine(e,o,d,h)},onDrag:function(e){t._onDragResizeGuideLine(e,o,h)},onStop:function(e,s){t._onStopResizeGuideLine(e,o,d);var r="x"===o?s.x:s.y,c=t._calculateDelta(r,b,I,u),h={cellInfo:i,gridInfo:n,dataProvider:a,direction:o,delta:c,rowIndex:p,colIndex:g,colSpan:m,rowSpan:f,fixedColumns:v,fixedRows:_,defaultValue:l,currentValue:u,skipBound:y};t._onDraggableResize(h)}},C)},C._renderGridCellContent=function(e,t,i,n){var a=e+i,s=-1!==this._shapeCols.indexOf(a);!s&&t.shapeId&&(s=!!this._shapeCols.push(a));var l={displayValue:this._wrapDataCellValue(e+i,n,t,!0,s),iconsFeature:this.iconsFeature};return s&&(l.shapeId=t.shapeId),r.createElement(o,l)},C._renderEdgeSelection=function(e,t,n,a){var o=this._getSlotIDByEdgeType(e),s=this._getDataCellValue(t,"ancestor_or_self"),r="row_level1"===o?this._selections.rowSelection:this._selections.colSelection;r&&r.isSelected(s)?a.push("dashboard-grid-cell-selected"):-1!==i.chain(i.pluck(this.crosstabView.getSelector().getSelections(),"categories")).flatten().map((function(e){return e.value})).value().indexOf(n)&&a.push("dashboard-grid-cell-selected")},C._renderDatapointSelection=function(e,t){var n=!1,a=this._getDataCellValue(e,"columnEdge"),o=this._getDataCellValue(e,"rowEdge");if(a&&o&&i.isObject(o.value)&&(a.isMeasure||i.isObject(a.value))){var s=this._selections.datapointSelection;if(s){var r=a.isMeasure?[]:this._getCurrentEdgeSelectionContext(a),l=this._getCurrentEdgeSelectionContext(o);s.isSelected(r.concat(l))&&(t.push("dashboard-grid-cell-selected"),n=!0)}}return n},C._getSelectionFormattingStyles=function(e){var t=this;void 0===e&&(e="");var n=this.textStyle[this.textStyleIndex.selectedArea],a={},o="";if(i.each(n,(function(i,n){for(var s=e,r=i&&i[s];s&&s.lastIndexOf(",")>0;){s=s.slice(0,s.lastIndexOf(","));var l=i&&i[s];(r&&l&&r.weight<l.weight||!r&&l)&&(r=i[s])}a[n]=r&&"color"===n?r.value&&t.colorsService.getHexColorFromDashboardColorSet(r.value)||"":r&&r.value;var c=r&&r.weight;c&&c>o&&(o=c)})),""!==i.values(a).join(""))return{convertedStylesValue:a,weight:o}},C._getSelectionFormattingStylesForTuple=function(e,t){var i=this._getEdgeUseValues(e,t),n=i.columnEdgeUseValue,a=i.rowEdgeUseValue,o=this._getSelectionFormattingStyles(n),s=this._getSelectionFormattingStyles(a),r=o||s;return o&&s&&(r=o.weight>s.weight?o:s),r},C._getEdgeUseValues=function(e,t){var n=e.columnEdge&&e.columnEdge.descendant_or_self_without_measures,a=n&&n.length||0,o=t&&i.isString(t)?t.split(","):null;return{columnEdgeUseValue:o&&o.slice(0,a).join(","),rowEdgeUseValue:o&&o.slice(a,o.length).join(",")}},C.rowEdgeHasMeasures=function(){var e=this._pivotTable.rowEdgeNestingLevel;return this.showValuesOnRows&&(this._pivotTable.getNumberOfMeasures()>1||0===e)},C._isMeasureHidden=function(e,t,i){if(t<1)return!1;var n=this.rowEdgeHasMeasures(),a=e.getValue(n?t:t-1,n?i-1:i),o=this._getDataCellValue(a,"useValue");return this._isRowOrColumnHidden(o)},C._isRowOrColumnHidden=function(e){if(void 0===e&&(e=""),this.hiddenRowsAndColumns.length<1)return!1;for(var t=-1!==this.hiddenRowsAndColumns.indexOf(e);e&&e.lastIndexOf(",")>0&&!t;)e=e.slice(0,e.lastIndexOf(",")),t=-1!==this.hiddenRowsAndColumns.indexOf(e);return t},C._getCanvasFont=function(e){var t={"font-style":e["font-style"],"font-weight":e["font-weight"],"font-size":e["font-size"]||_,"font-family":e["font-family"]||b};return i.values(t).join(" ")},C._getTextWidth=function(e,t){this._canvas=this._canvas||document.createElement("canvas");var i=this._canvas.getContext("2d");return i.font=t,parseInt(i.measureText(e).width)},C._generateWrappedText=function(e,t,i){var n=this._cellWidthStatus&&this._cellWidthStatus[e],a=n&&n.charCount,o=n&&n.cellWidth;if(a&&i===o)return"#".repeat(a);var s=this._getTextWidth("#",t),r=parseInt((i-y)/s);return r=r<=0?1:r,this._cellWidthStatus=this._cellWidthStatus||{},this._cellWidthStatus[e]=this._cellWidthStatus[e]||{},this._cellWidthStatus[e].charCount=r,this._cellWidthStatus[e].cellWidth=i,"#".repeat(r)},C._wrapDataCellValue=function(e,t,i,n,a){var o=this._getCanvasFont(i),s=this._getTextWidth(t,o)+y,r=parseInt(i.width),l=s;return a&&(l+=24),l>r&&(this._cellWidthStatus=this._cellWidthStatus||{},this._cellWidthStatus[e]=this._cellWidthStatus[e]||{},this._cellWidthStatus[e].textWidth=this._cellWidthStatus[e].textWidth<s?s:this._cellWidthStatus[e].textWidth||s,n&&(t=this._generateWrappedText(e,o,r))),t},C._getStylesOmittingWordWrap=function(e){return i.omit(e,["word-break","white-space"])},C._isSuppressionOn=function(){var e=this.content&&this.content.getPropertyValue("suppression");return!e||"none"!==e},C._isExpandable=function(){return this.content&&this.content.getPropertyValue("expandCollapse")},C._isExpansionLineageHintSupported=function(){if(this.Grid.getRenderSupportFlag){var e=this.Grid.getRenderSupportFlag("expansionLineageHintSupported");if(void 0!==e)return e}return!0},C._getExpandInfo=function(e,t,i){var n=this,a=e.getUnion().getDataItemList();return a.length>0&&(i++,a.forEach((function(e){var a=e.getDrillDownValue();if(t[a]=!0,e.getUnion().getDataItemList().length>0){var o=n._getExpandInfo(e,t,i).maxDepth;o>i&&(i=o)}}))),{maxDepth:i,expandMap:t}},C._getDataItemInfoBySlotId=function(e){var t=this,n=this.content&&this.content.getFeature("Visualization"),a=(n&&n.getSlots()).getSlot(e),o={};return a&&i.each(a.getDataItemList(),(function(e,i){var n=t._getExpandInfo(e,{},0);o[i]={dataitemId:e.getColumnId(),dataitemUniqueId:e.getId(),expandMap:n.expandMap,maxDepth:n.maxDepth,isProperty:e.getMetadataColumn().isProperty()}})),o},C._getCachedDataItemInfoByIndex=function(e,t,i){var n=e&&e[t];return i?n&&n[i]:n},C._getCellPropertyColors=function(){try{var e=this.content&&this.content.getPropertyValue("fillColor"),t=e&&this.colorsService.getHexColorFromDashboardColorSet(e),i=this.colorsService.getForegroundColorPropertiesForUIElement(e,"tabs");return{cellFillColor:t,cellTextColor:i&&i.length&&i[0].value}}catch(e){return{}}},C._getIndentationDepth=function(e,t,i){var n=this._getCachedDataItemInfoByIndex(e,i,"maxDepth")||0,a=this._cachedLevelInfo[t][i],o=a&&a.maxLevelDepth||0;return Math.max(n,o)},C._getColumnWidth=function(e,t,i,n){if(this._cachedHiddenCol[i])return 1e-6;var a=e.getValue(t,i),o=this._getDataCellValue(a,"isMeasure");if(this._isRowOrColumnHidden(this._getDataCellValue(a,"useValue"))||o&&this._isMeasureHidden(e,t,i))return this._cachedHiddenCol[i]=!0,1e-6;var s=this._getRootResizeKey(!1,a,this._cachedRowDataItemInfo,i);if(this.columnWidths&&this.columnWidths[s])return this.columnWidths[s];-1!==this._shapeCols.indexOf(i)&&(n+=24);var r=this._getIndentationDepth(this._cachedRowDataItemInfo,"col",i);return this.isExpandable&&r>0?parseInt(n,10)+24*r:n},C._getRowHeight=function(e,t,i,n){if(this._cachedHiddenRow[t])return 1e-6;var a,o=e.getValue(t,i);if(this.showValuesOnRows){var s=this._getDataCellValue(o,"isMeasure");a=this._isRowOrColumnHidden(this._getDataCellValue(o,"useValue"))||s&&this._isMeasureHidden(e,t,i)}else a=this._isRowOrColumnHidden(this._getDataCellValue(o,"useValue"));if(a)return this._cachedHiddenRow[t]=!0,1e-6;var r=this._getRootResizeKey(!0,o,this._cachedColumnDataItemInfo,t);if(this.rowHeights&&this.rowHeights[r])return this.rowHeights[r];var l=this._getIndentationDepth(this._cachedColumnDataItemInfo,"row",t);return this.isExpandable&&l>0?parseInt(n,10)+32*l:n},C._getRootResizeKey=function(e,t,i,n){var a=void 0;return e&&(a="Measures_Row"),"corner"===this._getDataCellValue(t,"type")?this._getCachedDataItemInfoByIndex(i,n,"dataitemId")||a:this._buildResizeKey(this._getDataCellValue(t,"ancestor_or_self"))},C._renderReactGrid=function(){var e=this,t=this.dataProvider;t.updateData.bind(this.dataProvider),t.getNumColumns.bind(this.dataProvider),t.getNumRows.bind(this.dataProvider),t.getValue.bind(this.dataProvider),this.maxColHeight=this._getMaxColHeight();var i=this._pivotTable.getNestingLevels().rowNestingLevel,n=this._pivotTable.getNestingLevels().colNestingLevel;t.updateData(this.data);var a=t.getNumColumns()-i,o=t.getNumRows()-n,l=this.fixedRowHeight||32,c=this.fixedColumnWidth||120;0===o&&0===a&&(n=i=0);var u=this._isSuppressionOn();this.isExpandable=this._isExpandable(),this.isExpansionLineageHintSupported=this._isExpansionLineageHintSupported(),this.isExpandable&&(this.expandCollapseFeature=this.content&&this.content.getFeature("ExpandCollapse")),this._cachedRowDataItemInfo=this._getDataItemInfoBySlotId("row_level1"),this._cachedColumnDataItemInfo=this._getDataItemInfoBySlotId("column_level1"),this._cachedLevelInfo=this._pivotTable.getLevelInfo(),this._cachedHiddenRow={},this._cachedHiddenCol={};var d={fixedRows:n,fixedColumns:i,numRows:o,numColumns:a,fixedColumnWidth:c,fixedRowHeight:l,isSuppressed:u,isSummaryHighlighted:this._isSummaryHighlighted,selections:this._selections,maxColHeight:this.maxColHeight,crosstabGrid:this,dataProvider:this.dataProvider,content:this.content,isExpandable:this.isExpandable,isExpansionLineageHintSupported:this.isExpansionLineageHintSupported,measureHeaderDecorations:this._measureHeaderDecorations,hiddenRowsAndColumns:this.hiddenRowsAndColumns,conditionalFormatting:this.conditionalFormatting,gridDnDManager:this._gridDnDManager,pivotTable:this._pivotTable,coveredCellSet:new Set,expandedRootMap:new Map,expandedLeafMap:new Map,renderedExpandedRootSet:new Set,cellProps:new Map},p=i>1?2:20,m=n>1?2:10,f=r.createElement(this.Grid,{rowHeight:function(n){return e._getRowHeight(t,n,i-1,l)},columnWidth:function(i){return e._getColumnWidth(t,n-1>=0?n-1:0,i,c)},numColumns:a,numRows:o,fixedRows:n,fixedColumns:i,onAfterGridUpdate:function(e){d.coveredCellSet=new Set,d.visibleRanges=e,d.renderedExpandedRootSet=new Set},dataCellRenderer:function(o,s,r){return e._dataCellRenderer(o,s,r,n,i,a,t)},fixedRowCellRenderer:h.getFixedCellRenderer({gridInfo:d,location:"row"}),fixedColumnCellRenderer:h.getFixedCellRenderer({gridInfo:d,location:"column"}),fixedCornerCellRenderer:function(a,o,s){return e._fixedCornerCellRenderer(a,o,s,n,i,t)},overscanRowCount:p,overscanColumnCount:m,style:{},ref:function(t){e.gridRef=t},maxColumnWidth:1/0,pageWidth:g.getPageWidth(this.content)}),v=r.createElement("div",{class:"xtab-grid-guideLine"},""),_=r.createElement("div",{class:"xtab-grid-view"},[f,v]);s.render(_,this.$el[0]),this.gridRef&&(this.gridRef.decorations={measureHeaderDecorations:d.measureHeaderDecorations},this.gridRef.recomputeGridSize())},C._isInSummaryRow=function(e){return e&&e.rowEdge&&e.rowEdge.isSummary},C.setSelections=function(e,t){t&&t.clearSelectionCaches&&(this.resetSummaryHighlight(),this.clearMeasureHeaderDecorations()),this._selections=e},C._getSlotIDByEdgeType=function(e){return"row"===e?"row_level1":"column"===e?"column_level1":null},C.setStyles=function(e){this.textStyle=e},C._getCurrentEdgeSelectionContext=function(e){var t=i.clone(e.ancestor_or_self),n=i.clone(e.descendant_or_self);return(t=i.filter(t,(function(e){return e.value}))).pop(),n=i.filter(n,(function(e){return e.value})),(t||[]).concat(n||[])},C.onEnterContainer=function(){var e=u(this.$el[0]).find('.grid-corner-cell[row="0"][col="0"]');e.length&&e.focus()},C.showDropZone=function(e){this.hideDropZones(),this.$el.find(e).css({display:"block"}),this.$el.find(".grid-column-resizer, .grid-row-resizer").css({display:"none"})},C.hideDropZones=function(){this.$el.find(".grid-drop-zone").css({display:"none"}),this.$el.find(".grid-column-resizer, .grid-row-resizer").css({display:"block"})},C.showReplaceDropZone=function(e,t,i){"corner"===e?this.showDropZone(".grid-corner-cell > .grid-drop-zone"):"row"===t?i?this.showDropZone('.grid-fixed-row-cell[row="'+e+'"][useValue="'+i+'"] > .grid-drop-zone'):this.showDropZone('.grid-fixed-row-cell[row="'+e+'"] > .grid-drop-zone'):"col"===t&&this.showDropZone('.grid-fixed-column-cell[col="'+e+'"] > .grid-drop-zone')},C.showLeftDropZone=function(e){"corner"===e?this.showDropZone(".grid-corner-cell > .grid-drop-zone.left"):this.showDropZone('.grid-fixed-column-cell[col="'+e+'"] > .grid-drop-zone.left, .grid-fixed-row-cell[col="'+e+'"] > .grid-drop-zone.left')},C.showRightDropZone=function(e){"corner"===e?this.showDropZone(".grid-corner-cell > .grid-drop-zone.right"):this.showDropZone('.grid-fixed-column-cell[col="'+e+'"] > .grid-drop-zone.right, .grid-fixed-row-cell[col="'+e+'"] > .grid-drop-zone.right')},C.showTopDropZone=function(e,t){t?this.showDropZone('.grid-fixed-column-cell[row="'+e+'"] > .grid-drop-zone.top'):this.showDropZone('.grid-fixed-row-cell[row="'+e+'"] > .grid-drop-zone.top')},C.showBottomDropZone=function(e,t){t?this.showDropZone('.grid-fixed-column-cell[row="'+e+'"] > .grid-drop-zone.bottom'):this.showDropZone('.grid-fixed-row-cell[row="'+e+'"] > .grid-drop-zone.bottom')},C._dataCellRenderer=function(e,t,n,a,o,s,l){var c=e+a,u=t+o,h=l.getValue(c,u),p=this._isSummary(h),g=this._isCellBelowInSummaryRow(c+1,u,l,!1),f=this._getCellPropertyColors(),v=f.cellFillColor,_=f.cellTextColor,b=this._getDataCellValue(h),y=this.rowEdgeHasMeasures()?e:t,I=this._pivotTable.getNumberOfMeasures()>0?y%this._pivotTable.getNumberOfMeasures():null,C=Number.isInteger(I)?this._pivotTable._measuresInfo[I].formatSpec:null;b=d.formatNull(b,C);var S=this._getDataCellValue(h,"tuple");i.extend(n,{tuple:S,measure:this._getDataCellValue(h,"isMeasure"),row:e+a,col:t+o,"aria-label":b,tabindex:0,area:m});var w=[n.className];if(w.push("grid-data-cell","dashboard-grid-cell"),this._cachedHiddenRow[e+a]||this._cachedHiddenCol[t+o])return n.className=w.join(" "),r.createElement("div",n,"");n.style.zIndex=s-t;var R=this._renderDatapointSelection(h,w);v&&!p&&(n.style=i.extend(n.style,{color:_}),R||(n.style.backgroundColor=v)),this._applyDataCellTextStyle(h,n),this._applySelectionFormattingStyle(h,S,n),(e+a)%2==0&&w.push("alternate"),this._applyCondStyle(h,I,R,n);var x=[];return this._applySummaryStyle(p,n,w),g&&!p&&w.push("above-summary-row"),x.push(this._renderGridCellContent(t,n.style,o,b)),n.style.height-=1,this._applySummaryRowStyle(p,h,g,n,w),this._applyWidthHeightStyle(c,u,l.getNumRows(),l.getNumColumns(),n),n.className=w.join(" "),r.createElement("div",n,x)},C._applyDataCellTextStyle=function(e,t){if(!this._getDataCellValue(e,"type")){var i=Object.assign({},this.textStyle[this.textStyleIndex.cell]);Object.keys(i).forEach((function(e){return""===i[e]&&delete i[e]})),Object.assign(t.style,this._getStylesOmittingWordWrap(i))}},C._applySelectionFormattingStyle=function(e,t,i){var n=this._getSelectionFormattingStylesForTuple(e,t);if(n&&Object.keys(n).length>0){var a=n.convertedStylesValue;Object.keys(a).forEach((function(e){return""===a[e]&&delete a[e]})),Object.assign(i.style,this._getStylesOmittingWordWrap(a))}},C._applyCondStyle=function(e,t,n,a){var o=this._getDataCellValue(e,"condValue");if(o){var s=this._getConditionalFormatting(o,e,t);i.extend(a.style,s),n&&delete a.style.backgroundColor}},C._applySummaryStyle=function(e,t,n){e&&(n.push("summary"),t.area=v,i.extend(t.style,this._getStylesOmittingWordWrap(this.textStyle[this.textStyleIndex.summary])),this._isSummaryHighlighted&&n.push("dashboard-grid-cell-selected"),this._setSummaryColor(t))},C._applySummaryRowStyle=function(e,t,i,n,a){e&&this._isInSummaryRow(t)&&(a.push("summary-row"),a.push("summary-row-top-border"),i||(n.style.height-=1,a.push("summary-row-bottom-border")))},C._applyWidthHeightStyle=function(e,t,i,n,a){t+1>=n&&(a.style.width=parseFloat(a.style.width)-2+"px"),e+1>=i&&(a.style.height-=1)},C._fixedCornerCellRenderer=function(e,t,n,o,s,l){var c=l.getValue(e,t),u=this._getDataCellValue(c),d=this.fixedRowHeight||32,h=this.fixedColumnWidth||120;i.extend(n,{row:e,col:t,tabindex:0,area:f,measure:"true","aria-label":u});var p=n.className?[n.className]:[];p.push("grid-corner-cell","dashboard-grid-cell");var g=this._getDataCellValue(c,"type");if(g){var m=this.textStyleIndex[g];i.extend(n.style,this.textStyle[m])}var v={colIndex:t,rowIndex:e,colBound:s,rowBound:o,dataProvider:l,fixedRows:o,fixedColumns:s,dataCellValue:u,gridCellProps:n,defaultColumnWidth:h,defaultRowHeight:d,ignoreGrouping:{}},_=this._getSpanIndex(v),b=_.colSpan,y=_.rowSpan,I=_.gridCellColumnWidth,C=_.gridCellRowHeight;i.extend(n.style,{width:I+"px",height:Math.min(C,this.maxColHeight)+"px",zIndex:s-t+(o-e)+(b>y?b:y)});var S=[r.createElement("div",{class:"dashboard-text-cell"},u)];u&&(S.push(r.createElement("div",{class:"grid-drop-zone left"},"")),S.push(r.createElement("div",{class:"grid-drop-zone replace"},"")),S.push(r.createElement("div",{class:"grid-drop-zone right"},""))),n.className=p.join(" ");var w=this._gridDnDManager?a:"div";return r.createElement(w,_extends({dndManager:this._gridDnDManager,isMeasure:!0,cellType:"corner"},n),S)},I}()})),define("text!dashboard-analytics/visualizations/renderer/crosstab/Crosstab.html",[],(function(){return'<div class="dataview crosstab-widget" data-attach-point="contentNode">\n\t<div class="value" {{=it.style}}>{{=it.v||"    "}}</div>\n\t{{=it.showTitleString || ""}}\n</div>'})),define("dashboard-analytics/visualizations/renderer/crosstab/CrosstabEventTarget",["jquery","../common/NonVIPREventTarget","underscore"],(function(e,t,i){var n="datapoint",a="itemclass",o="item",s="summary",r="expanded",l="row",c="column",u="values",d="summary",h="column_level1",p="row_level1",g="values",m="heat";return function(t){function f(){for(var e,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];e=t.call.apply(t,[this].concat(n))||this;var o=n[0]||{};return e.ownerWidget=o.ownerWidget,e.view=o.view,e}_inheritsLoose(f,t);var v=f.prototype;return v.getEventTargets=function(t){var n=this;if(!this._isValidEvent(t))return[];var a=[],o=this._getEventTargetItem(t);return i.each(o,(function(t){if(t){var i=e(t.source[0]).attr("area"),o=n._isValidSelectedArea(t);o&&(t.selectionContext=n._updateSelectionContext(t.selectionContext)),a.push({key:t.key,type:t.infoType,source:t.source,values:t.values,selectionContext:t.selectionContext,area:i,isAreaSelected:o})}})),a},v._isValidSelectedArea=function(t){var i=t.source&&t.source[0]&&e(t.source[0]);if(i.hasClass("dashboard-grid-cell-selected"))return i.attr("area")!==d},v._updateSelectionContext=function(e){return e=e||{},i.extend(e,{actions:{actionOptions:{TextAction:{isAreaSelected:!0}}}}),e},v.decorateTarget=function(e,t,i,n){var a=!1;if("highlight"===t)return!0;if("implied_selection"===t){var o=this.view.visControl;if(e&&e.length>0){var s=e[0].source;if(s){var r=s.attr("area"),l=r===d;r===u&&(i?(n||(this._clearSelectionController(),o.clearSelection({clearSelectionCaches:!0})),o.decorateMeasureHeader(s[0])):o.resetMeasureHeaderDecorations(),a=!0),l&&(i?(this._clearSelectionController(),o.clearSelection({clearSelectionCaches:!0}),o.highlightSummary(s[0])):o.resetSummaryHighlight(),a=!0)}}else e||(o.resetMeasureHeaderDecorations(),o.resetSummaryHighlight(),a=!0)}return a},v._clearSelectionController=function(){var e=this.content.getFeature("Visualization").getSlots().getMappedSlotList(),t=[];i.each(e,(function(e){var n=e.getDataItemList();"category"===n[0].getType()&&i.each(n,(function(e){t.push(e.getColumnId())}))})),this.content.getFeature("InteractivityController.deprecated").select({itemIds:t,tuple:[],command:"update",slotsToClear:e})},v.remove=function(){this.ownerWidget=null,this.view=null,t.prototype.remove.call(this)},v._getEventTargetItem=function(t){var i=this._getTargetNode(t);if(i&&i.textContent){var n=e(i),a=n.attr("tuple");return this.view.visControl.isCrosstabMeasureNodeSelected(i)||"true"===n.attr("measure")?[this._getMeasureItemClassTarget(t)]:n.attr("area")===d?[this._getSummaryItemTarget(t,a)]:a?[this._getDatapointTarget(t)]:[this._getItemTarget(t)]}},v._getDatapointTarget=function(t){var a=this.view.visControl.dataPointNodeToSlotsSelections(t);if(!a)return null;var o=a.attributeSelections,s=[];a.selectionContext?s[a.selectionContext]=a.factSelections&&a.factSelections[0]?a.factSelections[0].value:[]:s=a.factSelections&&a.factSelections[0]?[a.factSelections[0].value]:[];var u=i.pluck(i.filter(o,(function(e){return e.edgeType===c})),"value"),d=i.pluck(i.filter(o,(function(e){return e.edgeType===l})),"value"),h=a.factSelections&&a.factSelections[1]?a.factSelections[1].value:void 0,p=a.factSelections&&a.factSelections[1]?a.factSelections[1].heatDataItemIndex:void 0,g=this._createItem(n,t);return this._addItemValues(g.values,u,d,s,h,p),this._includesExpanded(u,d)?(g.infoType=r,g.values=[],e(t.currentTarget).addClass("hoverExpanded")):e(t.currentTarget).removeClass("hoverExpanded"),g},v._getItemTarget=function(t){var i=this.view.visControl.nodeToSelection(t);if(!i)return null;var a=i.column_level1?i.column_level1.value:[],s=i.row_level1?i.row_level1.value:[],l=i.datapoint?[i.datapoint]:[],c=i.itemClassValues?i.itemClassValues:[],u=!0===i.isInnerEdge?n:o,d=this._createItem(u,t);if(c.length>0)d.values=c,d.selectionContext=this._getMeasureSelectionContext(d.values);else{var h=this._getSelectionContext(i.selectionContext);h&&(d.selectionContext=h,d.selectionContext.actions.actionOptions={deleteAction:{excludeAction:!0},jumpToAction:{area:t.target.getAttribute("area")}}),this._addItemValues(d.values,a,s,l)}return this._includesExpanded(a,s)?(d.infoType=r,d.values=[],e(t.currentTarget).addClass("hoverExpanded")):e(t.currentTarget).removeClass("hoverExpanded"),d},v._getMeasureSelectionContext=function(e){var t={actions:{actionsToKeep:[],actionOptions:{}}};return t.slots=[this.visualization.getSlots().getSlot(g)],t.mapIndex=[],i.each(e,(function(e){i.each(e,(function(e){t.mapIndex.push(e.mapIndex)}))})),t},v._getSelectionContext=function(e){if(void 0===e.level)return null;var t=this.visualization.getSlots().getSlot(e.slotID),i=t&&t.getDataItemList();return i&&i.length>0&&e.level<i.length?{mapIndex:e.level,slots:[t],actions:{actionsToKeep:[],actionOptions:{}}}:void 0},v._createItem=function(t,i){var n={};n.infoType=t;var a=e(this._getTargetNode(i));return n.key=a.attr("row")+":"+a.attr("col"),n.source=a,n.values=[],n},v._addItemValues=function(e,t,n,a,o,s){var r=this.visualization.getSlots().getMappedSlotList();i.each(r,(function(i){var r=i.getId();if(r===h)e.push(t);else if(r===p)e.push(n);else if(r===g)e.push(a);else if(r===m){var l=[];l[s]=o,e[e.length]=l}}))},v._getMeasureItemClassTarget=function(e){var t=this._getItemTarget(e);return t.infoType=a,t},v._getSummaryItemTarget=function(e,t){var i=t?null:this._getItemTarget(e);return i&&(i.infoType=s,i.selectionContext={actions:{actionsToKeep:["text"],actionOptions:{TextAction:{area:d}}}}),i},v._getUnionValues=function(){var e,t,n=this.view.content.getFeature("Visualization").getSlots().getDataItemList(),a=[],o=[];i.forEach(n,(function(t){(e=t.getDrillDownValue())&&o.push(e),t.getUnion&&a.push.apply(a,t.getUnion().getDataItemList())}));for(var s=[];!i.isEmpty(a);)t=a.pop(),(e=t.getDrillDownValue())&&-1===i.indexOf(o,e)&&s.push(e),t.getUnion&&a.push.apply(a,t.getUnion().getDataItemList());return s},v._includesExpanded=function(e,t){var n=[];n.push.apply(n,e.reduce((function(e,t){return t.pu?e.push(t.pu):t.p&&t.p.u&&e.push(t.p.u),e}),[])),n.push.apply(n,t.reduce((function(e,t){return t.pu?e.push(t.pu):t.p&&t.p.u&&e.push(t.p.u),e}),[]));var a=this._getUnionValues();return!i.isEmpty(i.intersection(n,a))},v._isValidEvent=function(t){var i=this,n=function(t){return"div"===t.localName&&(e(t).hasClass("bottom-right-grid-cell")||e(t).hasClass("top-right-grid-cell")||e(t).hasClass("bottom-left-grid-cell")||e(t).hasClass("top-left-grid-cell"))},a=function(e){return n(e)},o=function(e){return n(e)},s={click:a,clicktap:a,mousedown:a,tap:a,contextmenu:o,hold:o,mousemove:function(e){return n(e)},mouseleave:function(e){return i.mouseWithinBoundCheck(t)&&n(e)}.bind(this),keydown:function(e){return!!n(e)}}[t.type],r=this._getTargetNode(t);return s&&!0===s(r)},f}(t)})),define("dashboard-analytics/visualizations/renderer/crosstab/CrosstabView",["../VisView","./CrosstabGrid","../../../widgets/livewidget/nls/StringResources","text!./Crosstab.html","../../../DynamicFileLoader","jquery","underscore","../VisEventHandler","./CrosstabEventTarget","../../../util/ContentUtil"],(function(e,t,i,n,a,o,s,r,l,c){"use strict";var u={Color:"color",FontSize:"font-size",FontFace:"font-family",FontBold:"font-weight",FontItalic:"font-style",FontUnderline:"text-decoration",FontAlign:"text-align",TextWrap:["word-break","white-space"]},d={"font-weight":"bold","font-style":"italic","text-decoration":"underline","word-break":"break-all","white-space":"initial"},h=e.extend({className:"dataview crosstab-widget",templateString:n,alwaysRenderOnResize:!0,init:function(){h.inherited("init",this,arguments),this.isMobilePannable=!0,this._getStyleProperties(),this.content=this.content||this.dashboardApi.getCanvas().getContent(this.ownerWidget.getId()),this._conditionalFormatting=this.content.getFeature("ConditionalFormatting"),this._crosstabGrid=new t({$el:this.$el.find(".crosstab-widget"),content:this.content,dashboardApi:this.dashboardApi,colorsService:this.dashboardApi.getFeature("Colors"),crosstabView:this,conditionalFormatting:this._conditionalFormatting})},getGrid:function(){return this._crosstabGrid},getDescription:function(){var e=h.inherited("getDescription",this,arguments);return i.get("WidgetLabelWithDescripion",{label:e,description:i.get("f12KeyDescription")})},onEnterContainer:function(){this._crosstabGrid.onEnterContainer()},getCurrentViewSelector:function(){return this.eventHandler},render:function(e){var t=arguments,i=this;return this._initializeConditionalFormatting().then((function(){if(!i.isMappingComplete()||i.hasMissingFilters()||i.hasUnavailableMetadataColumns())return i.removeGridView(),i.resizeToWidget(e),i.renderIconView(),Promise.resolve(i);i.removeIconView();var n=e.data.getResult();i.setStyles(),i.setSelections(),i.setFormat(),i.setHiddenRowsAndColumns();var a=!!i.content.getFeature("RenderSequence").getStateProperty("newData");return i._crosstabGrid.render(n,i.resizing,a,i.eventHandler).then((function(n){return n?(i.resizeToWidget(e),i.visControl.resetData(),i.visControl.setGridData(i._crosstabGrid),h.inherited("render",i,t)):{reRenderNeeded:!0}}))}))},removeGridView:function(){this._crosstabGrid&&this._crosstabGrid.removeGridView()},remove:function(){this._crosstabGrid&&this._crosstabGrid.remove(),this.eventHandler&&this.eventHandler.remove(),this.visControl=null,h.inherited("remove",this,arguments)},_initializeConditionalFormatting:function(){return this._conditionalFormatting?this._conditionalFormatting.initializeFeature():Promise.resolve()},_getStyleProperties:function(){var e=this,t=this.content.getPropertyList()||[];this._stylesIdMap={},this._stylesProperties=t.reduce((function(t,i){return t[i.prefix]&&(t[i.prefix].push(i),e._stylesIdMap[i.id]=i.style),t}),{rowHeading:[],columnHeading:[],values:[],valueHeading:[],summary:[],selectedArea:[]})},_constructTextStyles:function(e){var t=this;void 0===e&&(e=[]);var i={};return e.forEach((function(e){var n=t._stylesIdMap[e.id]?u[t._stylesIdMap[e.id]]:void 0;if(n){n=Array.isArray(n)?n:[n];var a=t.content.getPropertyValue(e.id);n.forEach((function(e){if(a){if(d[e])if("object"==typeof a){var t={};s.each(a,(function(i,n){t[n]={value:i.value?d[e]:"",weight:i.weight}})),a=t}else a=d[e];i[e]=a}else i[e]=""}))}})),i},setStyles:function(){var e={rowHeadingStyles:this._constructTextStyles(this._stylesProperties.rowHeading),columnHeadingStyles:this._constructTextStyles(this._stylesProperties.columnHeading),dataValueStyles:this._constructTextStyles(this._stylesProperties.values),valueHeadingStyles:this._constructTextStyles(this._stylesProperties.valueHeading),summaryStyles:this._constructTextStyles(this._stylesProperties.summary),selectedAreaStyles:this._constructTextStyles(this._stylesProperties.selectedArea)};this._crosstabGrid.setStyles(e)},initialize:function(){var e=this;return this.$el.addClass("dataview crosstab-widget"),a.load(["dashboard-analytics/visualizations/renderer/crosstab/CrosstabControl"]).then((function(t){var i=new(0,t[0])({domNode:e.$el.find(".crosstab-widget")[0],visualization:e.visualization,conditionalFormatting:e._conditionalFormatting});return e.visControl=i,e.eventHandler=new r({target:new l({$el:e.$el,view:e,content:e.content,visualization:e.visualization}),dashboardSettings:e.dashboardSettings,transaction:e.transactionApi,logger:e.logger,ownerWidget:e.ownerWidget,visAPI:e.ownerWidget.visAPI}),e.visControl}))},setSelections:function(){var e=c.getColumnIdList([this.visualization.getSlots().getSlot("row_level1")],"attribute"),t=c.getColumnIdList([this.visualization.getSlots().getSlot("column_level1")],"attribute"),i=this.getSelector().getSelection(e,{includeParents:!0}),n=this.getSelector().getSelection(t,{includeParents:!0}),a=this.getSelector().getSelection(t.concat(e)),o={clearSelectionCaches:(i||n||a)&&(this._crosstabGrid.isSummaryHighlighted()||this._crosstabGrid.getSelectedMeasureNodes())};this._crosstabGrid.setSelections({rowSelection:i,colSelection:n,datapointSelection:a},o)},setPropertyValue:function(e,t,i){this.content.setPropertyValue(e,t,i)},renderSelected:function(){this.setSelections(),this._crosstabGrid&&this._crosstabGrid.onResize()},getPropertyValue:function(e){return this.content&&this.content.getPropertyValue(e)},setFormat:function(){var e={fixedRowHeight:this.getPropertyValue("fixedRowHeight"),fixedColumnWidth:this.getPropertyValue("fixedColumnWidth"),columnWidths:this.getPropertyValue("columnWidths"),rowHeights:this.getPropertyValue("rowHeights")};this._crosstabGrid.setFormat(e)},setHiddenRowsAndColumns:function(){var e=this.getPropertyValue("hiddenRowsAndColumns")||[];this._crosstabGrid.setHiddenRowsAndColumns(e)},_buildValidateResponse:function(e,t){return{isValid:e,message:t}},_checkValidInput:function(e,t){return o.isNumeric(e)?parseInt(e)<t?this._buildValidateResponse(!1,i.get("prop_sizeValueShouldBeHigher",{value:t})):this._buildValidateResponse(!0):this._buildValidateResponse(!1,i.get("prop_sizeInputNonNumericValue"))},getPropertyList:function(){throw new Error("should not be called")},getPropertyLayoutList:function(){throw new Error("should not be called")},animate:function(){this.resizing?this.visModel.renderCompleteBeforeAnimation():h.inherited("animate",this,arguments)}});return h})),define("dashboard-analytics/visualizations/renderer/crosstab/CrosstabControl",["../../../lib/@waca/core-client/js/core-client/ui/core/Class","jquery","../../../lib/@waca/dashboard-common/dist/utils/Flyout","underscore","../../../widgets/livewidget/nls/StringResources"],(function(e,t,i,n,a){"use strict";var o=e.extend({init:function(e){o.inherited("init",this,arguments),this.domNode=e.domNode,this.visualization=e.visualization,this.conditionalFormatting=e.conditionalFormatting,this._factSlots=null},resetData:function(){this._resetInternalData()},_resetInternalData:function(){this._slots=this.visualization.getSlots().getSlotList();for(var e=0;e<this._slots.length;e++)if(!this._slotRowSortOrder&&this._slots[e].getId().indexOf("row")>-1)this._slotRowSortOrder=this._slots[e].getDefinition().getSortOrder(),this._slotRowStartIndex=e;else if(this._slots[e].getId().indexOf("value")>-1){this._slotValueStartIndex=e;break}this._populateFactSlots()},clear:function(){t(this.domNode).empty()},setGridData:function(e){this._crosstabGrid=e},decorateMeasureHeader:function(e){this._crosstabGrid.setMeasureHeaderDecorations(e)},resetMeasureHeaderDecorations:function(){this._crosstabGrid.clearMeasureHeaderDecorations()},highlightSummary:function(e){this._crosstabGrid.highlightSummary(e)},resetSummaryHighlight:function(){this._crosstabGrid.resetSummaryHighlight()},clearSelection:function(e){this._crosstabGrid.setSelections({colSelection:null,datapointSelection:null,rowSelection:null},e)},isCellSelected:function(e){return t(e).hasClass("dashboard-grid-cell-selected")},isEdgeNodeSelected:function(e){var i=t(e);return"values"===i.attr("area")||"cell_edge_column"===i.attr("area")||"cell_edge_row"===i.attr("area")},isCrosstabMeasureNodeSelected:function(e){return e.textContent&&"values"===t(e).attr("area")},nodeToSelection:function(e){if(this._crosstabGrid&&this._crosstabGrid.data){var i={},n=[],a=t(e.target),o=a.attr("col")||a.parent().attr("col"),s=a.attr("row")||a.parent().attr("row");if(void 0!==o&&void 0!==s){var r=this._crosstabGrid.data[s][o];r.ancestor_or_self&&r.ancestor_or_self.length>=2&&(i.isInnerEdge=!0),r.columnEdge&&this._getSelectionOnEdges(i,r.columnEdge.descendant_or_self,!0,r,n,"column_level1"),r.rowEdge&&this._getSelectionOnEdges(i,r.rowEdge.descendant_or_self,!1,r,n,"row_level1"),r.rowEdge||this._getSelectionOnEdges(i,r.ancestor_or_self,"column"===r.type,r,n),"column"!==r.type&&"row"!==r.type&&(i.datapoint=r.value),(this.isCrosstabMeasureNodeSelected(e.target)||"true"===t(e.target).attr("measure"))&&this._getMeasureHeaderItemValues(i,e)}return i}},_getSelectionOnEdges:function(e,t,i,a,o){var s=i?"column_level1":"row_level1";e.selectionContext={slotID:s,level:a.nestLevel},n.each(t,function(t){this.isFactSlot(t)||(o.push(t.u),e[s]?e[s].value.push(t):e[s]={value:[t]})}.bind(this))},_populateFactSlots:function(){for(var e=[],t=this._slots,i=[],a=0;a<t.length;++a)"ordinal"===t[a].getDefinition().getType()&&(n.each(t[a].getDataItemList(),(function(t){e.push(t.getLabel())})),i.push(t[a]));this._factSlots=e,this._factDataslots=i},isFactSlot:function(e){return this._factSlots||this._populateFactSlots(),this._factSlots.indexOf(e)>=0},edgeNodeToSelectionObject:function(e,t){var i=e.attr("col")||e.parent().attr("col"),n=e.attr("row")||e.parent().attr("row"),a=this._crosstabGrid.data[n][i];if(a.type)return{attributeSelections:[{column:t.getMapping(),value:a.value,edgeType:a.type}]}},dataPointNodeToSlotsSelections:function(e){var i=t(e.target),n=i.attr("col")||i.parent().attr("col"),a=i.attr("row")||i.parent().attr("row"),o=this._crosstabGrid.data[a][n];if(!o.type){var s=[];if(this._getSlotsOnEdges(e,s),0!==s.length){for(var r,l=0;l<s.length&&!this.isFactSlot(s[l].value);l++);l<s.length&&(r=s.splice(l,1)[0]);var c,u,d=[];if(r)c={columnName:r.value,columnId:r.column.getColumnId(),value:o.rawValue},u=this._getFactDataItemIndex(o);else{var h=this._slots[2];h&&(c={columnName:h.getDataItemList()[0].getLabel(),columnId:h.getDataItemList()[0].getColumnId(),value:o.rawValue})}return d.push(c),this._getfactSelectionForConditionalFormatting(o,c,d),{attributeSelections:s,factSelections:d,selectionContext:u}}}},_getFactDataItemIndex:function(e){var t=e.columnEdge;for(this._crosstabGrid&&this._crosstabGrid.showValuesOnRows&&(t=e.rowEdge);t.subCategory;)t=t.subCategory;return t.index},isSummaryNodeSelected:function(e){return e.textContent===a.get("summaryCaption")},_getSlotsOnEdges:function(e,i){var n=t(e.target),a=n.attr("col")||n.parent().attr("col"),o=n.attr("row")||n.parent().attr("row"),s=this._crosstabGrid.data[o][a];s.columnEdge&&this._getSlotsSelectionsOnEdges(i,s.columnEdge),s.rowEdge&&this._getSlotsSelectionsOnEdges(i,s.rowEdge),s.rowEdge||this._getSlotsSelectionsOnEdges(i,s)},measureNodeToDataslots:function(e){if(this.isCrosstabMeasureNodeSelected(e))return this._slots[this._slotValueStartIndex]},_getSlotsSelectionsOnEdges:function(e,t){for(var i=t;i;){var n;if(i.isMeasure)n=this.visualization.getSlots().getSlot("values");else{var a="column"===i.type?"column_level1":"row_level1";n=this.visualization.getSlots().getSlot(a)}var o=n.getDataItemList().find((function(e){return e.getLabel()===i.value}));e.push({column:o,value:i.value,edgeType:i.type}),i=i.subCategory}},_getMeasureHeaderItemValues:function(e,i){var a,o=this,s=[],r=this.getSelectedMeasureNodes();a=r&&2===r.length&&r[0]!==r[1]?r:[t(i.target)],n.each(a,(function(e){var i,a=o.visualization.getSlots().getMappedSlotList();n.find(a,(function(e,t){if("values"===e.getId())return i=t,!0}));var r,l=t(e),c=o._crosstabGrid.data[l.attr("row")][l.attr("col")],u=o.visualization.getSlots().getSlot("values").getDataItemList();n.find(u,(function(e,t){if(e.getLabel()===c.value)return r=t,!0}));var d={};if(r>=0){var h=u[r];d={u:h.getColumnId(),d:h.getLabel(),mapIndex:r}}s[i]||(s[i]=[]),s[i].push(d)})),e.itemClassValues=s},getSelectedMeasureNodes:function(){return this._crosstabGrid.getSelectedMeasureNodes()},_getfactSelectionForConditionalFormatting:function(e,t,i){if(e){var a=this.conditionalFormatting&&this.conditionalFormatting.getConditionalFormatting();if(a){var o=n.find(this.visualization.getSlots().getMappingInfoList(),(function(e){return a.conditionalFormats.find((function(i){return"heat"===e.slot.getId()&&t&&i.heatId===e.dataItem.getId()&&i.dataItemId===t.columnId}))}));o&&t&&o.dataItem&&o.dataItem.getLabel()!==t.columnName&&i.push({columnName:o.dataItem.getLabel(),value:e.condValue?e.condValue.formatted:e.value,heatDataItemIndex:o.indexInSlot})}}}});return o})),define("dashboard-analytics/visualizations/renderer/grid/GridEventTarget",["jquery","../common/NonVIPREventTarget","underscore","../VisEventHandler","../../../lib/@waca/dashboard-common/dist/utils/EventChainLocal","../../../util/EventUtils"],(function(e,t,i,n,a,o){return function(t){function s(){for(var e,i=arguments.length,a=new Array(i),o=0;o<i;o++)a[o]=arguments[o];e=t.call.apply(t,[this].concat(a))||this;var s=a[0]||{};return e.visControl=s.visControl,e.viprDecorations={},e.viprDecorations[n.DECORATIONS.HIGHLIGHT]="highlighted",e.viprDecorations[n.DECORATIONS.SELECT]="selected",e.getAPI()||_assertThisInitialized(e)}_inheritsLoose(s,t);var r=s.prototype;return r.getEventTargets=function(t){var n=this._getTargetNode(t);if(!n)return[];var a=e(n),o=a.attr("row");return i.isUndefined(o)||i.isUndefined(this.visControl.getDataRows()[o])||this._isSummaryRow(a)||!this._canProcessKeyDown(t)&&!this.mouseWithinBoundCheck(t)?[]:this._isHeaderRow(a)?this._getHeaderTargets(t,a):this._getRowTargets(t,a)},r.remove=function(){this.visControl=null,t.prototype.remove.call(this)},r._isSummaryRow=function(t){return e(t).hasClass("summary")},r._isHeaderRow=function(t){return e(t).hasClass("header-cell")},r._getHeaderSelectionContext=function(t){var n=this,a={mapIndex:[],slotId:"grid_cols",actions:{actionsToKeep:[],actionOptions:{}}};return i.each(t,(function(t){var i=e(t).attr("col"),o=n.visControl.findSlotDetails(i).mapIndex;a.mapIndex.push(o),n.visControl.isRank(i)&&(a.actions.actionsToKeep.push("sortAction"),a.actions.actionOptions.sortAction={rankSort:!0})})),a},r._getHeaderTargets=function(e,t){var i=[],n=parseInt(t.attr("row"));if(-1!==["click","contextmenu","hold","keydown"].indexOf(e.type)){var o=this._getTargetNode(e);this.visControl.handleSelectColumnHeader(o,!(e.ctrlKey||e.metaKey),"contextmenu"===e.type)}var s=this.visControl.getSelectedColumnHeaderNodes();s&&s.length>0?i.push({key:n+":",type:"itemclass",source:t,isEdgeSelect:!0,values:this._getColumnTargetValues(s,n),selectionContext:this._getHeaderSelectionContext(s),area:"visualization"}):new a(e).setProperty("preventDefaultContextBar",!0);return i},r._getColumnTargetValues=function(t,n){var a=this,o=[];return i.each(t,(function(t){var s=e(t).attr("col"),r=a.visControl.findSlotDetails(s).slotIndex,l=a.visControl.getDataRows()[n][s];l=i.isUndefined(l.value)?l:l.value,l=i.isArray(l)?l[0]:l,o[r]={value:l}})),o},r._getRowTargets=function(e,t){var i=[],n=parseInt(t.attr("row")),a=parseInt(t.attr("col")),o=this.visControl.isGroupedColumn(a)?a+1:this.visControl.getDataRows()[n].length,s="click"===e.type&&1===e.which||"tap"===e.type;return i.push({key:n+":"+(o-1),type:s?"item":"datapoint",source:t,isEdgeSelect:!0,values:this._getRowTargetValues(n,o),area:"visualization"}),i},r._getRowTargetValues=function(e,t){for(var n,a=[],s=[],r=0;r<t;r++)this.visControl.isRank(r)||(n=this.visControl.getDataRows()[e][r],n=i.isUndefined(n.value)?n:n.value,n=i.isArray(n)?n[0]:n,s.push(o.toDeprecatedPayload(n)));return a.push(s),a},s}(t)})),define("dashboard-analytics/visualizations/renderer/grid/GridView",["jquery","underscore","./GridEventTarget","../VisView","../VisEventHandler","../../../widgets/livewidget/nls/StringResources"],(function(e,t,i,n,a,o){"use strict";var s={"font-weight":"bold","font-style":"italic","text-decoration":"underline"},r={cellValueColor:"color",cellValueFontSize:"font-size",cellValueFontFace:"font-family",cellValueFontBold:"font-weight",cellValueFontItalic:"font-style",cellValueFontUnderline:"text-decoration",cellValueFontAlign:"text-align"},l={columnHeadingColor:"color",columnHeadingFontSize:"font-size",columnHeadingFontFace:"font-family",columnHeadingFontBold:"font-weight",columnHeadingFontItalic:"font-style",columnHeadingFontUnderline:"text-decoration",columnHeadingFontAlign:"text-align"},c=n.extend({templateString:'<div class="dataview grid-view"  data-attach-point="contentNode"></div>',className:"dataview grid-view",alwaysRenderOnResize:!0,init:function(){c.inherited("init",this,arguments),this.isMobilePannable=!0,this._focusedCellIDs={key:null,cellIDs:[]},this._conditionalFormatting=this.content.getFeature("ConditionalFormatting")},_initializeConditionalFormatting:function(){return this._conditionalFormatting?this._conditionalFormatting.initializeFeature():Promise.resolve()},initialize:function(){var e=this;return this.visControl?Promise.resolve(this.visControl):new Promise((function(t,i){try{require([e.content.getFeature("Visualization").getDefinition().getProperty("control")],(function(i){e.visControl=new i({domNode:e.$el.find(".grid-view")[0],content:e.content,gridView:e,tabNavigation:e.ownerWidget.interactivitySettings.tabNavigation,dashboardApi:e.dashboardApi,summaryFeature:e.content.getFeature("SummaryFeature"),conditionalFormatting:e._conditionalFormatting,cellRenderer:e.content.getFeature("CellRenderer.react")}),e.visControl.reset(),t(e.visControl)}),i)}catch(e){i(e)}})).then((function(){return e.eventHandler=new a({target:new i({$el:e.$el,visControl:e.visControl}),dashboardSettings:e.dashboardSettings,transaction:e.transactionApi,logger:e.logger,ownerWidget:e.ownerWidget,visAPI:e.ownerWidget.visAPI,edgeSelection:!0}),e.visControl}))},getCurrentViewSelector:function(){return this.eventHandler},animate:function(){this.resizing?this.visModel.renderCompleteBeforeAnimation():c.inherited("animate",this,arguments)},onDataReady:function(){var e=c.inherited("onDataReady",this,arguments);if(e.taskRefreshed.data){var t=this.renderSequence.getTaskResult("data"),i=e.sameQueryData,n=void 0!==i&&i;t&&t.getResult&&(n||(this.visControl.reset(this.visModel),this.visControl.setData(t.getResult())))}return e},render:function(e){var t=arguments,i=this;return this._initializeConditionalFormatting().then((function(){if(!i.isMappingComplete()||i.hasMissingFilters()||i.hasUnavailableMetadataColumns())return i.removeGridView(),i.resizeToWidget(e),i.renderIconView(),Promise.resolve(i);if(!i.visControl)return Promise.reject(new Error);if(!i.visControl.hasData())return Promise.resolve(i);i.removeIconView(),i.resizeToWidget(e);var n=i.resizing,a=!!i.content.getFeature("RenderSequence").getStateProperty("newData"),o={};return o.headerStyles=i._constructTextStyles(l),o.cellStyles=i._constructTextStyles(r),i.visControl.setStyles(o),i.setSelections(),i.visControl.render(n,a).then((function(e){return e?c.inherited("render",i,t):{reRenderNeeded:!0}}))}))},_constructTextStyles:function(e){var t=this;e=e||{};var i={};return Object.keys(e).forEach((function(n){var a=e[n],o=t.content.getPropertyValue(n);o?(s[a]&&(o=s[a]),i[a]=o):i[a]=""})),i},getDescription:function(){var e=c.inherited("getDescription",this,arguments);return o.get("WidgetLabelWithDescripion",{label:e,description:o.get("f12KeyDescription")})},removeGridView:function(){this.visControl&&this.visControl.removeGridView()},remove:function(){this.eventHandler&&(this.eventHandler.remove(),this.eventHandler=null),this.visControl&&(this.visControl.remove(),this.visControl=null),c.inherited("remove",this,arguments)},_extendTuples:function(e,i,n,a){t.each(e,(function(e){var o={};o[n]=a,i.push(t.extend(o,e))}))},_getSelectionValues:function(){var e=[],i=this.getController(),n=this.visControl.getRankDataItemCount();return t.each(this.visualization.getSlots().getMappedSlotList(),function(a){"heat"!==a.getId()&&t.each(a.getDataItemList(),function(a){var o=this._dataPointSelections&&this._dataPointSelections.getSelections([a],!0)||i.getSelectedTuples([a.getColumnId()]);if(o&&o.length){var s=[];t.each(o,function(t){if(t=Array.isArray(t)?t[0]:t,0===e.length){var i={};i[n]=t,s.push(i)}else this._extendTuples(e,s,n,t)}.bind(this)),e=s.slice()}n++}.bind(this))}.bind(this)),e},setSelections:function(){this.visControl.setSelections(this._getSelectionValues())},renderSelected:function(){this.setSelections(),this.visControl&&this.visControl.onResize()},getFocusedCellIDs:function(){return this._focusedCellIDs},setFocusedCellIDs:function(e,t){this._focusedCellIDs.key=e,this._focusedCellIDs.cellIDs=t},onEnterContainer:function(){this.visControl.onEnterContainer()},filterNodeKeydownHandler:function(e){e.stopPropagation()}});return c})),define("dashboard-analytics/util/ArrayUtils",[],(function(){return function(){function e(){}return e.isArrayInArray=function(e,t){if(Array.isArray(e)&&Array.isArray(t)&&t.length>0&&t.length<=e.length)for(var i=0;i<e.length;i++)if(t[0]===e[i]){for(var n=0;n<t.length&&t[n]===e[n+i];n++);if(n===t.length)return!0}return!1},e}()})),define("dashboard-analytics/visualizations/renderer/grid/GridEdgeIterator",["../../../util/EdgeIterator"],(function(e){"use strict";return function(e){function t(){var i;return(i=e.apply(this,arguments)||this).EdgeIterator=t,i}_inheritsLoose(t,e);var i=t.prototype;return i.createLeafNodeInfo=function(e,t,i,n){var a={descendant_or_self:e,index:this.currentKeyIndex,value:t,type:i.type,isSummary:i.isSummary,isOverallSummary:i.isOverallSummary,isLeafNode:!0,isMeasure:i.isMeasure,summaryOf:i.summaryOf,formatSpec:i.formatSpec};return i.isSummary||(a.cellIdx=i.cellIdx),this.rollupSummariesOfDescendents(a,t,n),a},i.createNodeInfo=function(e,t,i,n,a){var o={descendant_or_self:e,index:this.numberOfLeafNodes-1,value:t,type:i.type,isSummary:i.isSummary||n.isSummary,isOverallSummary:i.isOverallSummary||n.isOverallSummary,noOfChildren:this.subIterator.keys.length,hasLeafNode:n.isLeafNode||n.hasLeafNode,ancestor_or_self:this.ancestor_or_self,isMeasure:i.isMeasure,summaryOf:i.summaryOf||n.summaryOf,subCategory:n,formatSpec:i.formatSpec};return this.rollupSummariesOfDescendents(o,t,a,n),o.descendant_or_self=o.descendant_or_self.concat(n.descendant_or_self),i.isSummary||(o.cellIdx=i.cellIdx),o},t}(e)})),define("dashboard-analytics/visualizations/renderer/grid/Summary",["../../../widgets/livewidget/nls/StringResources"],(function(e){"use strict";var t=e.get("processing"),i=e.get("value_is_not_available");return function(){function e(e,t){this._numberOfValues=0,this._formatSpec=e.formatSpec,this._aggregationType=e.aggregationType,this._isLocalSummary=t,this._uniqueId=e.id}var n=e.prototype;return n.addCallBackContext=function(e){this.categoryUIds=e.categoryUIds,this.tupleUIds=e.tupleUIds,this.getSummary=e.cbGetSummary,this.onCellDataChange=e.cbOnCellDataChange,this.addSummaryValuePromise=e.cbAddSummaryValuePromise},n.addValue=function(e){if(this._isLocalSummary){var t=e;if(e&&"object"==typeof e&&(t=e.getSummarizedValue()),"number"==typeof t)if("number"==typeof this.value)switch(this._aggregationType){case"min":this.value=Math.min(this.value,t);break;case"max":this.value=Math.max(this.value,t);break;default:this.value+=t}else this.value=t}},n.getSummarizedValue=function(e,n){var a=this;return this._isLocalSummary?this.getValue():this.getSummary?(this.valuePromise=this.getSummary(this.categoryUIds,this._uniqueId,this.tupleUIds).then((function(t){a.onCellDataChange(e,n,t,a._formatSpec)})),this.addSummaryValuePromise&&this.addSummaryValuePromise(this.valuePromise),t):i},n.getValue=function(){return"number"==typeof this.value?this.value:null},n.getFormatSpec=function(){return this._formatSpec},e}()})),define("dashboard-analytics/extensions/client-summaries/content-features/SummaryTypes",[],(function(){return["none","countdistinct","avg","calculated","automatic"]})),define("dashboard-analytics/visualizations/renderer/grid/GridDataProcessor",["../../../widgets/livewidget/nls/StringResources","../../../util/DashboardFormatter","../../../util/ArrayUtils","./GridEdgeIterator","./Summary","../../../extensions/client-summaries/content-features/SummaryTypes","../../../widgets/livewidget/query/QueryResultDataUtils"],(function(e,t,i,n,a,o,s){"use strict";var r=e.get("summaryCaption"),l=e.get("value_is_not_available"),c=function(e){return e&&void 0!==e.value?e.value:e},u=function(e,t){var i=[];if(Array.isArray(e))for(var n=0;n<e.length;n++)i.push(c(e[n]));return void 0!==t&&i.push(c(t)),i.toString()};return function(){function e(e){var t=this;this._queryResult=e.queryResult,this._numberOfColumns=e.numberOfColumns||0,this._lastGroupedColumnIndex=e.lastGroupedColumnIndex||0,this._ungroupedColumnsInfo=[],this._rankDataItems=e.rankDataItems||[],this._columnSlot=e.columnSlot,this._columnDataItems=e.columnDataItems||[],this._getRankFormat=e.getRankFormat,this._getRealColumnIndex=e.getRealColumnIndex,this._valuesMap={},this._exceedsColumnThreshold=e.exceedsColumnThreshold||!1,this._numberOfAttributeColumns=this._numberOfColumns-(e.factColumnIndices?e.factColumnIndices.length:0),this._doSummary=e.doSummary,this.summaryAPI=e.summaryFeature,this.summaryNotSupported=this.summaryAPI&&this.summaryAPI.isNotSupported(),this._onCellDataChange=e.onCellDataChange,this._summaryValuePromises=[],this._factColumnsMap={},Array.isArray(e.factColumnIndices)&&e.factColumnIndices.forEach((function(e){return t._factColumnsMap[e]=!0}))}var d=e.prototype;return d.onCellDataChange=function(e,i,n,a){var o=n&&n.u?n.u:n||l;this._onCellDataChange(e,i,t.format(o,a||null),o)},d._setUngroupedColumnsInfo=function(){for(var e=this._lastGroupedColumnIndex;e<this._numberOfColumns;e++){var t=this._columnDataItems[e],i=t.isRank&&t.isRank(),n={dataItemUniqueId:t.getId(),formatSpec:this._getSlotFormat(e),id:t.getId(),index:e,aggregationType:t.getAggregation(),addSummary:!i&&"none"!==this._getSlotDataItemList(this._columnSlot)[this._getRealColumnIndex(e)].getAggregation()};this._ungroupedColumnsInfo.push(n)}},d._getSlotFormat=function(e){var t=this._getSlotDataItemList(this._columnSlot);return this._rankDataItems.length?this._columnDataItems[e].isRank?this._getRankFormat():t[e-this._rankDataItems.length].getFormat():t[e].getFormat()},d._getSlotDataItemList=function(e){return this._queryResult.getSlotDataItemList?this._queryResult.getSlotDataItemList(e)||[]:e&&e.getDataItemList()||[]},d._generateNewDataTableWithOrder=function(){if(this._doSummary)return this._preProcessedData.length?this._preProcessedData:this._rawData;for(var t=0;t<this._rawData.length;t++){for(var n=this._rawData[t],a=-1,o=0;o<this._preProcessedData.length;o++){var s=this._preProcessedData[o];if(s)if(this._rankDataItems.length>0){var r=s[0]&&s[0].value;if(!r)continue;var l=n[0].value;if(!l)continue;var c=r.deco&&r.deco.rank;if(!c)continue;if(c===l){a=o;break}}else{for(var u=s.map((function(t){return t.value&&!e.isUndefined(t.value.value)?t.value.value:t.value})),d=[],h=0;h<n.length;h++){var p=n[h];if(Array.isArray(p))for(var g=0;g<p.length;g++)e.isUndefined(p[g].value)||d.push(p[g].value);else e.isUndefined(typeof p.value)||d.push(p.value)}if(i.isArrayInArray(d,u)){a=o;break}}}-1!==a&&(this._rawData[t]=this._preProcessedData[a],this._preProcessedData[a]=null)}return this._rawData},d.getData=function(){return this._rawData=s.getFlatResolvedDataRows(this._queryResult),this._exceedsColumnThreshold?Promise.resolve(this._rawData):Promise.resolve().then(this._setUngroupedColumnsInfo.bind(this)).then(this._generateIntermediateObjects.bind(this)).then(this._generateNewDataTableWithSummaries.bind(this)).then(this._generateNewDataTableWithOrder.bind(this))},d._generateIntermediateObjects=function(){for(var e,t=this._queryResult.getRowCount(),i={},n=0;n<t;n++)e=this._getTuple(n),this._addTupleToGroupedItemsContainer({container:i,tuple:e,rowIndex:n});this._doSummary&&this._addSummariesToGroupedItemsContainer({container:i});for(var a=0;a<t;a++)e=this._getTuple(a),this._generateIntermediateObjectsForUngroupedColumns(e,a);return this._addSortKeysToContainer(i)},d._generateIntermediateObjectsForUngroupedColumns=function(t,i){for(var n,o,s,l,c,d,h,p,g,m=0,f=this._lastGroupedColumnIndex;f<this._numberOfColumns;f++,m++)if(n=this._ungroupedColumnsInfo[m],o=e.getCellValue(this._queryResult,i,f),l=i+":"+f,!e.isUndefined(o)&&(d=e.getUseValue(o),!e.isUndefined(d)&&null!==d&&(s=t.concat(n.dataItemUniqueId),c=u(s),this._valuesMap[c]={value:o,cellIdx:l},n.addSummary&&n.aggregationType))){var v={summaryKeys:[],oCategoryAndTupleUIds:{},isLocalSummary:this._isLocalSummary(n.aggregationType)};for(h=s.length-2;h>=0;--h){s[h]=r,p=u(s),v.summaryKeys.push(p);var _={categoryUIds:[],tupleUIds:[]};if(!(v.isLocalSummary||this.summaryNotSupported||v.oCategoryAndTupleUIds[p]))for(var b=0;b<this._columnDataItems.length;b++)"object"==typeof s[b]&&(_.categoryUIds.push(this._columnDataItems[b].getId()),_.tupleUIds.push(s[b].value));v.oCategoryAndTupleUIds[p]=_,!(g=this._valuesMap[p])&&n&&(g=new a(n,v.isLocalSummary),this.summaryNotSupported||v.isLocalSummary||g.addCallBackContext({categoryUIds:v.oCategoryAndTupleUIds[p].categoryUIds,tupleUIds:v.oCategoryAndTupleUIds[p].tupleUIds,cbOnCellDataChange:this.onCellDataChange.bind(this),cbGetSummary:this.summaryAPI?this.summaryAPI.getSummary.bind(this.summaryAPI):void 0,cbAddSummaryValuePromise:this.cacheSummaryValuePromise.bind(this)})),g&&g.addValue(d),this._valuesMap[p]=g}}},e.getCellValue=function(e,t,i){var n=e.getValue(t,i);return Array.isArray(n)&&n.length?n[0]:n},e.getUseValue=function(e){return c(e)},e.isUndefined=function(e){return void 0===e},d._getTuple=function(t){for(var i=[],n=0;n<this._numberOfColumns;n++)this._factColumnsMap[n]||i.push(e.getCellValue(this._queryResult,t,n));return i},d._addSortKeysToContainer=function(e){var t=!1,i={edge:e,sortedKeys:[]};for(var n in e)if(e.hasOwnProperty(n))if(n===r)t=!0;else{i.sortedKeys.push(n);var a=e[n].nestedEdges;a&&(e[n].nestedEdges=this._addSortKeysToContainer(a))}if(t){i.sortedKeys.push(r);var o=e[r].nestedEdges;o&&(e[r].nestedEdges=this._addSortKeysToContainer(o))}return i},d._addTupleToGroupedItemsContainer=function(e){var t=e.container,i=e.tuple,n=e.rowIndex,a=e.columnIndex,o=e.tuplePartIndex,s=void 0===o?0:o;if(a=a||0,i&&i.length>0){var r=i[s].value;t[r]||(t[r]={value:i[s],level:a,cellIdx:n+":"+a});var l=s+1;l<i.length&&(t[r].nestedEdges||(t[r].nestedEdges={}),this._addTupleToGroupedItemsContainer({container:t[r].nestedEdges,tuple:i,rowIndex:n,columnIndex:a+1,ancestor:r,tuplePartIndex:l}))}},d._addSummaryToGroupedItemsContainer=function(e,t,i,n){var a=n||0===t;if(t<this._numberOfAttributeColumns){var o={isSummary:!0,level:t,isOverallSummary:a,summaryOf:a?"overall":i};e[r]=o,t<this._numberOfAttributeColumns-1&&(o.nestedEdges={},this._addSummaryToGroupedItemsContainer(o.nestedEdges,t+1,i,a))}},d._addSummariesToGroupedItemsContainer=function(e){var t=this,i=e.container,n=e.columnIndex,a=e.ancestor,o=e.parentSingletonSummaryAdded,s=void 0!==o&&o;n=n||0;var r=Object.keys(i);r.forEach((function(e){(r.length>1||!s)&&(s=1===r.length,t._addSummaryToGroupedItemsContainer(i,n,a)),i[e].nestedEdges&&t._addSummariesToGroupedItemsContainer({container:i[e].nestedEdges,columnIndex:n+1,ancestor:e,parentSingletonSummaryAdded:s})}))},d.cacheSummaryValuePromise=function(e){this._summaryValuePromises.push(e)},d.whenAllSummaryValuesAreReady=function(){return Promise.all(this._summaryValuePromises)},d._getSummaryKeys=function(e){for(var t={},i=this._numberOfAttributeColumns-1;i>=0;--i)e[i]=r,t[u(e)]=!0;return Object.keys(t)},d._generateNewDataTableWithSummaries=function(e){for(var t,i,a=[],o=0,s=new n(e,void 0);t=s.next();)i=[],this._addGroupedItemsToRow(i,t),this._addValuesToRow(i,t,++o),a.push(i);this._preProcessedData=a},d._addGroupedItemsToRow=function(e,t){for(var i=t,n=0;i&&n<this._lastGroupedColumnIndex;)e.push(i),i=i.subCategory,n++},d._addValuesToRow=function(e,i,n){for(var a=0;a<this._ungroupedColumnsInfo.length;a++){var o=this._ungroupedColumnsInfo[a],s=u(i.descendant_or_self,o.dataItemUniqueId),r=this._valuesMap[s]||null,l=null,c=null;r&&(r.getSummarizedValue?r._isLocalSummary?null!==r.getValue()?(c=r.getValue(),l=t.formatNull(c,r._formatSpec||null)):l=r.value:l=r.getSummarizedValue(n,o.index):l=r.value);var d=l;d||i.isSummary&&!o.aggregationType&&(d="  "),e.push({isSummary:i.isSummary,value:d,rawValue:c,key:s,cellIdx:r?r.cellIdx:null,isOverallSummary:i.isOverallSummary})}},d._isLocalSummary=function(e){return-1===o.indexOf(e)},e}()})),define("dashboard-analytics/visualizations/renderer/grid/RankProcessor",["underscore"],(function(e){"use strict";var t=function(){function t(e,t){this._queryResult=e,this.dataRows=this._queryResult.getDataPointValueList(),this.dataItems=this._queryResult.getResultItemList(),this.findSlotDetailsByRealColumnIndex=t,this.rankRefIds=[],this.rankDataItems=[],this._prepareRankDataItems()}var n=t.prototype;return n._prepareRankDataItems=function(){var e=this;this.dataRows[0]&&this.dataRows[0].pt.forEach((function(t,n){if(e._getRankValue(t,n)){e.rankRefIds.push(e.dataItems[n].getId());var a=e.findSlotDetailsByRealColumnIndex(n),o=a.slot,s=a.mapIndex,r={refColumnIndex:n,resultDataItem:e.dataItems[n],aggregationType:o.getDataItemList()[s].getAggregation()};e.rankDataItems.push(new i(r))}}))},n.processData=function(){return this.dataRows.length&&(this._processDataRows(),this._processDataItems()),this.rankDataItems},n._processDataRows=function(){e.each(this.dataRows,function(e){this._processDataPoint(e.pt)}.bind(this))},n._processDataPoint=function(e){for(var t=[],i=0;i<e.length;i++){var n=e[i],a=this._getRankValue(n,i);if(a>0){var o=this.dataItems[i].getId();t[this.rankRefIds.indexOf(o)]={v:a}}}t.splice(0,0,0,0),Array.prototype.splice.apply(e,t)},n._processDataItems=function(){for(var t=0;t<this.rankRefIds.length;t++){var i=e.find(this.dataItems,function(e){return e.getId()===this.rankRefIds[t]}.bind(this));this.dataItems.splice(t,0,i)}},n._getRankValue=function(e,t){var i=0;if("object"==typeof e)e.deco&&e.deco.rank&&(i=e.deco.rank);else{var n=this.dataItems[t].getValue(e)[0];n.deco&&n.deco.rank&&(i=n.deco.rank)}return i},t}(),i=function(){function e(e){this._refColumnIndex=e.refColumnIndex,this._resultDataItem=e.resultDataItem,this._aggregationType=e.aggregationType}var t=e.prototype;return t.isRank=function(){return!0},t.getType=function(){return"fact"},t.getLabel=function(){return this._resultDataItem.getDataItemList()[0].getLabel()},t.getId=function(){return this._resultDataItem.getId()},t.getAggregation=function(){return this._aggregationType},t.getRefColumnIndex=function(){return this._refColumnIndex},e}();return t})),define("dashboard-analytics/visualizations/renderer/grid/GridNullSuppressionProcessor",["./GridDataProcessor"],(function(e){return function(){function t(e){this._queryResult=e.queryResult,this._isSuppressionOn=e.isSuppressionOn,this._columnSlot=e.columnSlot,this._heatSlot=e.heatSlot}var i=t.prototype;return i.getDataPointValueList=function(){return this._queryResult.getDataPointValueList()},i.getResultItemList=function(){return this._resultItemListWithSuppression||this._queryResult.getResultItemList()},i.getRowCount=function(){return this._queryResult.getRowCount()},i.getValue=function(e,t){return this._queryResult.getValue(e,this._getActualColumnIdxToQueryResultSet(t))},i.getSlotDataItemList=function(e){return"heat"===e.getId()?this._heatSlot.getDataItemList():this._columSlotDataItemListWithSuppression||this._columnSlot.getDataItemList()},i.processNullSuppression=function(){if(this._isSuppressionOn){var t,i,n,a=[],o=[],s=this._queryResult.getResultItemList(),r=this._queryResult.getRowCount();for(o.length=s.length,i=0;i<r;i++)for(t=0;t<s.length;t++)if(!o[t]){var l=a.indexOf(s[t].getId());if(n=e.getCellValue(this._queryResult,i,t),!e.isUndefined(n))null===e.getUseValue(n)&&n.deco&&"NULL"===n.deco.state?-1===l&&a.push(s[t].getId()):(o[t]=!0,-1!==l&&a.splice(l,1))}if(a.length>0){this._resultItemListWithSuppression=s.filter((function(e){return!a.find((function(t){return e.getId()===t}))}));var c=this._columnSlot&&this._columnSlot.getDataItemList()||[];this._columSlotDataItemListWithSuppression=c.filter((function(e){return!a.find((function(t){return e.getId()===t}))}));var u=0;for(this._colIdxWithSuppression=[],t=0;t<this._resultItemListWithSuppression.length;t++){var d=this._resultItemListWithSuppression[t].getId();if(u<s.length)for(var h=u;h<s.length;h++)if(s[h].getId()===d){this._colIdxWithSuppression.push(h),++u;break}}}}},i._getActualColumnIdxToQueryResultSet=function(e){return this._isSuppressionOn&&this._colIdxWithSuppression?this._colIdxWithSuppression[e]:e},t}()})),define("dashboard-analytics/visualizations/renderer/grid/control/renderer/BaseGrid",["underscore","jquery","../../../../../util/DashboardFormatter","../../../../../widgets/livewidget/nls/StringResources","../../GridDataProcessor","../../GridDropTarget","../../../../../dataSources/metadata/MetadataColumn","../../RankProcessor","../../GridDataProvider","../../GridContentRenderer","../../GridNullSuppressionProcessor","react-dom","react","@ba/ba-ui-carbon-toolkit","../../../common/PrintHelper"],(function(e,t,i,n,a,o,s,r,l,c,u,d,h,p,g){var m=n.get("summaryCaption");return function(){function o(){this.init(arguments.length<=0?void 0:arguments[0])}var f=o.prototype;return f.init=function(t){var i=this;void 0===t&&(t={}),this.domNode=t.domNode,this.content=t.content,this.gridView=t.gridView,this.dashboardApi=t.dashboardApi,this.colorsService=t.dashboardApi.getFeature("Colors"),this.iconsFeature=t.dashboardApi.getFeature("Icons"),this.tabNavigation=t.tabNavigation,this.conditionalFormatting=t.conditionalFormatting,this.cellRenderer=t.cellRenderer,this._dataRows=null,this._heatByIndex=-1,this._heatIndice=[],this._colorAllColumns=!1,this._bGroupingEnabled=!0,this._filterableSlots=[],this._selectedCellCache={},this._selectedHeaderColumnCache={},this._slotFormatCache={},this._rankDataItems=[],this._columnDataItems=[],this._hideSummaries=!1,this._hasTopBottomLimit=null,this._columnsInfo={groupedIndices:[],factIndices:[]},this.summaryFeature=t.summaryFeature,this.visualization=this.content.getFeature("Visualization"),this._setSummaryColor=function(t){var n=i.conditionalFormatting&&i.conditionalFormatting.getSummaryFillColor();n&&e.extend(t.style,{"background-color":n})},this.renderedTheme=this.colorsService.getThemeDefinition().getId(),this.isInPrintLayoutMode=g.isInPrintLayoutMode(this.dashboardApi)},f.reset=function(){this._heatIndice=[],this._heatByIndex=-1,this._colorAllColumns=!1,this._columnSlot=this.visualization.getSlots().getSlot("grid_cols"),this._heatSlot=this.visualization.getSlots().getSlot("heat"),this._slots=[this._columnSlot,this._heatSlot],this._rankDataItems=[],this._columnDataItems=[],this._hasTopBottomLimit=null,this._columnsInfo={groupedIndices:[],factIndices:[]}},f.setData=function(e){this.dashboardApi.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","v2Table","enabled")?this._queryResult=e:(this._queryResult=new u({columnSlot:this._columnSlot,heatSlot:this._heatSlot,queryResult:e,isSuppressionOn:this._isSuppressionOn()}),this._processRank())},f.hasData=function(){return!!this._queryResult},f.setStyles=function(e){e&&(this.headerStyles=e.headerStyles,this.cellStyles=e.cellStyles)},f.resetOnRender=function(){this._groupedConditionalColor&&delete this._groupedConditionalColor,this._setDoSummaryInfo()},f.onResize=function(){this.maxColHeight=this._getMaxColHeight(),this.gridRef&&this.gridRef.recomputeGridSize()},f.render=function(e,t){var i=this,n=this.colorsService.getThemeDefinition().getId();return this.gridRef&&e&&!t&&this.renderedTheme===n?(this.onResize(),this.onSyncScrollBar(),Promise.resolve(!0)):(this.renderedTheme=n,this._errorWarningAdded?this._errorWarningAdded=!1:this.gridView&&this.gridView.clearInfoIndicator("error_summary_cell"),this.resetOnRender(),this._generateDataRows().then(this._renderReactGrid.bind(this)).then((function(){return!!i.gridRef})))},f.onSyncScrollBar=function(){var e=t(this.domNode),i=e.find(".ba-common-grid__bottom-right-grid"),n=e.find(".ba-common-grid__top-right-grid"),a=t(i).find(".bottom-right-grid-cell"),o=a&&a[0];t(i).animate({scrollLeft:t(n).scrollLeft(),scrollTop:o&&o.offsetTop||1},0)},f.getDataRows=function(){return this._dataRows},f.setSelections=function(e){var t=this;this._selections=e,this._selectionValues=[],this._selectedCellCache={},this._selections.forEach((function(e){var i=[];Object.values(e).forEach((function(e){i.push(e.u)})),t._selectionValues.push(i)}))},f.setValue=function(e,t,i,n){var a=this._getValue(t,"label"),o="object"==typeof t&&"isSummary"in t?t.isSummary:this._dataRows[i][n].isSummary;o?this._getValue(t,"value")===t.summaryOf&&(a=m):0!==i&&(a=this._formatValue(a,n,o)),e.attr("aria-label",a),e.text(a)},f.isCellSelected=function(e){var i=t(e);return i.hasClass("dashboard-grid-cell-selected")||i.hasClass("implied_selection")},f.isGroupedColumn=function(e){var t=e;return"object"==typeof e&&(t=this._getColumnIndex(e)),this._columnsInfo.groupedIndices&&-1!==this._columnsInfo.groupedIndices.indexOf(parseInt(t))},f.getSelectedColumnHeaderNodes=function(){var i=t(this.domNode).find(".header-cell.implied_selection"),n=[];return e.each(i,(function(e){0===t(e).closest(".visually-hidden").get().length&&n.push(e)})),n},f.findSlotDetails=function(e){var t=this.getRealColumnIndex(e);return this._findSlotDetailsByRealColumnIndex(t)},f.getRealColumnIndex=function(e){return this.isRank(e)?this._getRefIndex(e):e-this.getRankDataItemCount()},f.getRankDataItemCount=function(){return this._rankDataItems&&this._rankDataItems.length||0},f.isRank=function(e){return!(!this._columnDataItems[e]||!this._columnDataItems[e].isRank)||!1},f.remove=function(){this.gridView=null,this.tabNavigation=null,this._rankDataItems=null,this._dataRows=null,this._headers=null,this._dataRowsIsReady=null,this._delayedCellUpdate=null,this.removeGridView(),this.domNode=null},f.removeGridView=function(){this.gridRef&&this.domNode&&(d.unmountComponentAtNode(this.domNode),this.gridRef=null)},f.onEnterContainer=function(){var e=t(this.domNode).find('.top-right-grid-cell[row="0"][col="0"]');e.length&&e.focus()},f.handleSelectColumnHeader=function(e,t,i){var n=this.isCellSelected(e);this._hilightColumnHeaderColumn(e,t,n,i)},f._whenRankProcessed=function(){this._processNullSuppression(),this._columnDataItems=this._rankDataItems.concat(this._getSlotDataItemList(this._columnSlot)),this._filterHeatBySlot(this.visualization.getSlots().getSlotList()),this._setColumnsInfo(),this._doGrouping=this._columnsInfo&&!(this._columnsInfo.disableGrouping||this._hasTopBottomLimit),this._setDoSummaryInfo()},f._processNullSuppression=function(){this._queryResult.processNullSuppression&&this._queryResult.processNullSuppression()},f._getSlotDataItemList=function(e){return this._queryResult.getSlotDataItemList?this._queryResult.getSlotDataItemList(e)||[]:e&&e.getDataItemList()||[]},f._setDoSummaryInfo=function(){this._hideSummaries=this.content.getPropertyValue("hideSummaries");var e=this._columnsInfo.factIndices.length,t=this._columnsInfo.groupedIndices.length;this._doSummary=e&&t&&!this._hideSummaries&&this._doGrouping},f._setColumnsInfo=function(){if(this._columnDataItems&&this._columnDataItems.length){var e=this._columnDataItems.length,t=[],i=[];this._columnsInfo={},this._setLeftMostFactSlotIndex(),this._columnsInfo.disableGrouping=!1;for(var n=0;n<e;n++){var a=this._columnDataItems[n];this._columnCanBeGrouped(n)&&t.push(n),(this._isFactOrAggregationSet(a)||this.isRank(n))&&i.push(n)}this._columnsInfo.factIndices=i,this._columnsInfo.groupedIndices=t}},f._setLeftMostFactSlotIndex=function(){delete this._columnsInfo.leftMostFactSlotIndex;for(var e=0;e<this._columnDataItems.length;e++)if(this._isFactOrAggregationSet(this._columnDataItems[e])||this.isRank(e)){this._columnsInfo.leftMostFactSlotIndex=e;break}},f._columnCanBeGrouped=function(t){var i=this._columnsInfo.leftMostFactSlotIndex;return!(!e.isUndefined(i)&&t>=i)&&"attribute"===this._columnDataItems[t].getType()},f._filterHeatBySlot=function(t){var i=this;if(this._hasDataMappings()){var n=this.getRankDataItemCount(),a=this._heatSlot.getDataItemList(),o=this._heatSlot&&a.length>0?a[0].getColumnId():null,s=e.filter(t,(function(e){var t=i._getSlotDataItemList(e);return 0!=t.length&&("heat"===e.getId()?(i._heatByIndex=n++,!1):(n+=t.length,!0))}));return o&&(n=this.getRankDataItemCount(),e.each(s,(function(t){var a=i._getSlotDataItemList(t);if(a.length>0){var s=e.map(a,(function(e){return e.getColumnId()}));e.each(s,(function(e){e===o&&i._heatIndice.push(n),n++}))}})),0===this._heatIndice.length&&(this._colorAllColumns=!0)),s}},f._processRank=function(){var e=new r(this._queryResult,this._findSlotDetailsByRealColumnIndex.bind(this));this._rankDataItems=e.processData(),this._whenRankProcessed()},f._generateDataRows=function(){var e=this;0===this._columnDataItems.length&&this._whenRankProcessed(),this._resetOnGetDataRows();var t=new a({queryResult:this._queryResult,numberOfColumns:this._columnDataItems?this._columnDataItems.length:0,columnSlot:this._columnSlot,rankDataItems:this._rankDataItems,columnDataItems:this._columnDataItems,lastGroupedColumnIndex:this._columnsInfo?this._columnsInfo.leftMostFactSlotIndex:0,factColumnIndices:this._columnsInfo?this._columnsInfo.factIndices:0,doSummary:this._doSummary,onCellDataChange:this._onCellDataChange.bind(this),getRankFormat:this._getRankFormat,getRealColumnIndex:this.getRealColumnIndex.bind(this),summaryFeature:this.summaryFeature});return t.getData().then((function(i){if(e._dataRows=i,e._columnDataItems.length>0&&(e._headers=e._columnDataItems.map((function(t,i){var a=t.getLabel();return e.isRank(i)&&(a=n.get("topBottomRankLabel",{label:a})),a}))),e._dataRows.unshift(e._headers),e._WhenDataRowsAreReady(),e.isInPrintLayoutMode)return t.whenAllSummaryValuesAreReady().then(e.onResize.bind(e));t.whenAllSummaryValuesAreReady().then(e.onResize.bind(e))}))},f._getDataCellValue=function(e,t){if(null!=e)return e="useValue"===t?this._getValue(e,"value"):"type"===t?e.type:"isSummary"===t?e.isSummary:"summaryOf"===t?e.summaryOf:"tuple"===t?e.key:"rank"===t?e.value&&(e.value.deco&&e.value.deco.rank||e.value.value)||e.value:e.isSummary&&this._getValue(e,"value")===e.summaryOf?m:this._getValue(e,"label")},f._getValueForRowAtIndex=function(e,t){var i=e[t];return i.value&&i.value.value?i.value.value:i[0]?i[0].value:null},f._calculateSelectionForFact=function(t){for(var i=this._dataRows[t+1],n=!1,a=[],o=0;o<i.length;o++)if(-1===this._columnsInfo.factIndices.indexOf(o)){var s=this._getValueForRowAtIndex(i,o);a.push(s)}return this._selectionValues.forEach((function(t){0===e.difference(t,a).length&&(n=!0)})),n},f._isCellSelected=function(t,i){var n=this._getCellCacheKey(t,i);if(void 0!==this._selectedCellCache[n])return this._selectedCellCache[n];var a=!1;if(this._selectionValues.length>0)if(-1!==this._columnsInfo.factIndices.indexOf(i))a=this._calculateSelectionForFact(t);else{var o=this._dataRows[t+1],s=o&&this._getValueForRowAtIndex(o,i);a=-1!==e.flatten(this._selectionValues).indexOf(s)}return this._selectedCellCache[n]=a,a},f._getCellCacheKey=function(e,t){return e+"-"+t},f._getCellPropertyColors=function(){try{var e=this.content.getPropertyValue("fillColor"),t=e&&this.colorsService.getHexColorFromDashboardColorSet(e),i=e&&this.colorsService.getForegroundColorPropertiesForUIElement(e,"tabs");return{cellFillColor:t,cellTextColor:i&&i.length&&i[0].value}}catch(e){return{}}},f._prepFormatCache=function(e){this._slotFormatCache={};for(var t=0;t<e;t++){var i=this.findSlotDetails(t),n=i.slot,a=i.mapIndex,o=this._getSlotDataItemList(n);this._slotFormatCache[t]=o[a].getFormat(a)}},f._getReactGridData=function(){var e=new l(this._dataRows),t=e.getNumColumns();this._prepFormatCache(t);var i=this._getCellPropertyColors(),n=i.cellFillColor,a=i.cellTextColor;return this.reactGridData={_dataProvider:e,fixedRows:1,numColumns:t,numRows:e.getNumRows()-1,dataRows:e.getNumRows()-(e.getNumRows()-this._queryResult.getRowCount()),cellFillColor:n,cellTextColor:a},this.reactGridData},f._renderReactGrid=function(){var i=this,n=this._getReactGridData(),a=n._dataProvider,o=n.fixedRows,s=n.numColumns,r=n.numRows,l=n.dataRows,u=n.cellFillColor,m=n.cellTextColor;this.maxColHeight=this._getMaxColHeight();var f=[],v=this._isSuppressionOn(),_=[],b=this._determineHeatColumnPosition();this.coveredCellSet=new Set;var y=2;(this._columnDataItems?this._columnDataItems.length:0)>12&&(y=20);var I={rowHeight:function(){return 32},columnWidth:function(){var e=i.domNode.clientWidth;if(i.domNode.clientHeight/32<r){e-=18}else{e-=1}var t=parseInt(e/s);return Math.max(t,100)},onAfterGridUpdate:function(){i.coveredCellSet=new Set},numColumns:s,numRows:r,fixedRows:o,overscanRowCount:y,dataCellRenderer:function(t,n,s){try{var r=t+o,d=n;if(i.coveredCellSet.has(r+" "+d))return null;var p=a.getValue(r,d),g=i._getDataCellValue(p,"isSummary"),y=i.isRank(n),I=n<i._columnDataItems.length&&i._isFactOrAggregationSet(i._columnDataItems[n]),C=i._getDataCellValue(p),S=g?C:y?i._getDataCellValue(p,"rank"):i._formatValue(C,n,g,v);s.row=t+o,s.col=n,s["aria-label"]=S,s.tabindex=0;var w=[s.className];w.push("grid-data-cell","dashboard-grid-cell","table-view"),s.style=e.extend(s.style,{});var R=i._isCellSelected(t,n);u&&!g&&(s.style=e.extend(s.style,{color:m}),R||(s.style.backgroundColor=u));var x=Object.assign({},i.cellStyles);Object.keys(x).forEach((function(e){return""===x[e]&&delete x[e]})),s.style=Object.assign(s.style,x);var P=0;if(g)w.push("summary","summary-row-top-border"),f.find((function(e){return t===e}))||f.push(t);if(f.forEach((function(e){t>e&&P++})),!g&&t<l+P&&!p.hasLeafNode){var L=i._getConditionalColor(t-P,n,p,b);L&&(i.conditionalFormatting?(e.extend(s.style,L),R&&delete s.style.backgroundColor):e.extend(s.style,L.getStyle()))}i._setRowColSpan({rowIndex:t,colIndex:n,currentRow:r,currentCol:d,isMeasure:I,dataCellValue:S,rawDataCellValue:C,isSummary:g,gridCellProps:s,classList:w}),!g&&R&&w.push("dashboard-grid-cell-selected"),I?w.push("measure"):w.push("category"),s.className=w.join(" ");var D,T={displayValue:S,iconsFeature:i.iconsFeature},N=-1!==_.indexOf(n);if((N||s.style.shapeId)&&(N||_.push(n),T.shapeId=s.style.shapeId),i.cellRenderer&&i.cellRenderer.canRender()){var V;p.isSummary?(V={},"object"==typeof p.value?(V.label=p.value.label,V.value=p.value.value):(V.label=p.value,V.value=p.rawValue||p.value)):V=p.value;var A=i.isRank(n),E=i.isRank(n)?i._getRefIndex(n)+i.getRankDataItemCount():n,z={dataItem:i._columnDataItems[E],dataValue:V,rowIndex:t,colIndex:n};A&&(z.isRank=!0),p.isSummary&&(z.isSummary=!0),D=i.cellRenderer.getComponentList(z)}else D=[];return 0===D.length&&D.push(h.createElement(c,_extends({},T,{key:n}))),g&&(s.area="summary",i._setSummaryColor(s)),(r+1>=a.getNumRows()||g)&&(s.style.height=parseFloat(s.style.height)-2+"px"),d+1>=a.getNumColumns()&&(s.style.width-=2),0===d&&w.push("table-first-column"),s.style.width+="px",i._getCellContent(g,s,D)}catch(e){}},fixedRowCellRenderer:function(t,n,o){var s=a.getValue(t,n),r=i._getDataCellValue(s,"isSummary"),l=i._getDataCellValue(s);o.row=t,o.col=n,o.scope="col",o["aria-label"]=l,o.tabindex=0;var c=[o.className];c.push("grid-fixed-row-cell","dashboard-grid-cell","table-view"),i._selectedHeaderColumnCache[i._getCellCacheKey(t,n)]&&c.push("implied_selection"),o.style=e.extend(o.style,{}),o.style=e.extend(o.style,i.headerStyles),n+1>=a.getNumColumns()&&(o.style.width-=2),o.className=c.join(" ");var u=[l],d=i._getSortType(n);if(d){var g="asc"===d?i.iconsFeature.getIcon("caretUp").id:i.iconsFeature.getIcon("caretDown32").id,m=h.createElement(p.SVGIcon,{iconId:g});u.push(m)}var f=[h.createElement("div",{className:"dashboard-text-cell"},u)];return r&&f.push(h.createElement("div",{className:"grid-summary-decorator"},"")),i._getCellContent(r,o,f)},style:{},ref:function(e){i.gridRef=e},maxColumnWidth:1/0,pageWidth:g.getPageWidth(this.content)},C=this._getReactGridComponentToMount(),S=C.classList,w=C.component;this.$el=t(this.domNode).addClass(S.join(" "));var R=h.createElement(w,I);d.render(R,this.domNode),this.gridRef&&this.gridRef.recomputeGridSize()},f._isSummaryCellInNextRowAtSameColumn=function(e,t,i){var n;if(i.getNumRows()>e){var a=i.getValue(e,t);n=this._getDataCellValue(a,"isSummary")}else n=!1;return n},f._getMaxColHeight=function(){return this.domNode.offsetHeight||1/0},f._onCellDataChange=function(e,t,i,a){this._dataRowsIsReady||this._delayedCellUpdate.push({row:e,column:t,value:i,rawValue:a}),i&&i.error&&(this._errorWarningAdded||(this.gridView.onSummaryDataCellError(),this._errorWarningAdded=!0),i=n.get("value_is_not_available")),this._dataRows&&e<this._dataRows.length&&t<this._dataRows[e].length&&this._dataRows[e][t].value!==i&&(this._dataRows[e][t].value=i,this._dataRows[e][t].rawValue=a)},f._WhenDataRowsAreReady=function(){var e=this;this._dataRowsIsReady=!0,this._delayedCellUpdate.forEach((function(t){return e._onCellDataChange(t.row,t.column,t.value,t.rawValue)}))},f._resetOnGetDataRows=function(){this._dataRows=[],this._dataRowsIsReady=!1,this._delayedCellUpdate=[],this._resetColumnDataItems()},f._resetColumnDataItems=function(){if(this._isSuppressionOn()&&!this._queryResult.getSlotDataItemList&&1===this._queryResult.getResultItemList().length){var t=this._queryResult.getResultItemList()[0].getDataItemList();if(t.length){var i=e.difference(this._columnDataItems,t);this._columnDataItems=e.difference(this._columnDataItems,i)}}},f._getValue=function(t,i){if(null!=t){if(void 0!==t.value&&void 0!==t.descendant_or_self&&(t=t.value),null!=t){if(void 0!==t[i])return t[i];if(t.value&&"object"==typeof t.value)return this._getValue(t.value,i);if("label"===i&&void 0!==t.value)return t.value}return e.isArray(t)&&t[0]?this._getValue(t[0],i):t}},f._getSortType=function(e){var t=this.findSlotDetails(e),i=t.slot,n=t.mapIndex,a=this._getSlotDataItemList(i)[n],o=a&&a.getSort();return o&&(this.isRank(e)&&!o.rankSort||!this.isRank(e)&&o.rankSort)?null:o&&!a.hasDefaultSort()&&o.type},f._getRankFormat=function(){return{formatSpec:{selectedFormat:"none",maximumFractionDigits:0,formatLength:"short",type:"number",locale:this._columnSlot.locale},validFormatSpec:{selectedFormat:"none",maximumFractionDigits:0,formatLength:"short",type:"number",locale:this._columnSlot.locale}}},f._formatValue=function(e,t,n,a){var o;if(o=this.isRank(t)?this._rankFormat:this._slotFormatCache[t],n){var s=this._columnDataItems[t];return s&&this._isFactOrAggregationSet(s)?a?i.format(e,o):i.formatNull(e,o):e}return a?i.format(e,o):i.formatNull(e,o)},f._isSuppressionOn=function(){var e=this.content.getPropertyValue("suppression");return!e||"none"!==e},f._getConditionalColor=function(e,t,i,n){var a=this.isRank(t)?this._getRefIndex(t)+this.getRankDataItemCount():t;if(-1!==this._heatByIndex&&n.length){var o=n.indexOf(a);if(-1!==o){var s=this._queryResult.getValue(e,this._heatByIndex+o),r=this._columnDataItems[a];return this.conditionalFormatting.getFormatting(null!==i.value&&void 0!==i.value&&"object"==typeof i.value?i.value.value:i.value,s.value,r.getColumnId())}}return null},f._hilightColumnHeaderColumn=function(e,i,n,a){var o=t(e);if(!n||!a){i&&this._clearColumnHighlight();var s=o.attr("row"),r=o.attr("col"),l=this._getCellCacheKey(s,r);this._selectedHeaderColumnCache[l]=!n,n?o.removeClass("implied_selection"):o.addClass("implied_selection")}},f._clearColumnHighlight=function(){t(this.domNode).find(".header-cell.implied_selection").removeClass("implied_selection"),this._selectedHeaderColumnCache={}},f._isFactColumn=function(e){return-1!==this._columnsInfo.factIndices.indexOf(parseInt(e))},f._getColumnIndex=function(e){return parseInt(t(e).attr("col"),10)},f._hasDataMappings=function(){return this.visualization.getSlots().getMappedSlotList().length>0},f._findSlotDetailsByRealColumnIndex=function(e){for(var t=0,i=null,n=null,a=0,o=0;o<this._slots.length;o++){i=this._slots[o];var s=this._getSlotDataItemList(i).length;if(e<s+t){n=e-t,a=o;break}t+=s}return{slot:i,slotIndex:a,mapIndex:n}},f._getRefIndex=function(e){return this._columnDataItems[e].getRefColumnIndex&&this._columnDataItems[e].getRefColumnIndex()},f._isFactOrAggregationSet=function(e){return!!e&&("fact"===e.getType()||e.getAggregation()!==s.AGGREGATION_TYPE_MAP.none)},f._determineHeatColumnPosition=function(){var e=this,t=[],i=this.conditionalFormatting&&this.conditionalFormatting.getConditionalFormatting();return i&&this._heatSlot.getDataItemList().forEach((function(n){var a=i.conditionalFormats.find((function(e){return e.heatId===n.getId()}));a&&t.push(e._columnsInfo.factIndices.find((function(t){return!e.isRank(t)&&a.dataItemId===e._columnDataItems[t].getColumnId()})))})),t},f._getReactGridComponentToMount=function(){throw new Error("Must be implemented by subclass")},f._setRowColSpan=function(e){var t=e.rowIndex,i=e.colIndex,n=e.currentRow,a=e.currentCol,o=e.isMeasure,s=e.dataCellValue,r=e.rawDataCellValue,l=e.isSummary,c=e.gridCellProps,u=e.classList;if(!this.reactGridData)throw new Error("Must have valid react grid data");var d,h=this.reactGridData,p=h._dataProvider,g=h.fixedRows,m=h.numColumns,f=h.numRows,v=0,_=0;if(this.isGroupedColumn(i)&&!l){for(var b=n+1;b<=f+g-1;){if(this._getDataCellValue(p.getValue(b,i))!==r||!this._nextRowIsPartOfRowSpan({_dataProvider:p,currentRow:n,nextRowIndex:b,colIndex:i}))break;++b}v=b-(t+g);var y=parseInt(c.style.height,10)*v;v>1&&v+n>=p.getNumRows()?c.style.height=Math.min(y,this.maxColHeight)-2+"px":c.style.height=Math.min(y,this.maxColHeight)+"px"}if(o)d=this._isSummaryCellInNextRowAtSameColumn(n+1,a,p);else{var I=v>0?n+v:n+1;d=this._isSummaryCellInNextRowAtSameColumn(I,a,p)}if(l&&!d&&u.push("summary-row-bottom-border"),o||l||!d||(c.style.height=parseFloat(c.style.height)-2+"px"),l&&!o){for(var C=i+1;C<=m+1&&this._getDataCellValue(p.getValue(t+g,C))===s;)C++;_=C-i,c.style.width=parseInt(c.style.width,10)*_,c.style["font-weight"]="bold",_&&!v&&(v=1,_--)}if(v||_)for(var S=0;S<=v-1;S++)for(var w=0;w<=_;w++)0===S&&0===w||this.coveredCellSet.add(n+S+" "+(a+w));return{rowSpan:v,colSpan:_}},f._nextRowIsPartOfRowSpan=function(e){for(var t=e._dataProvider,i=e.currentRow,n=e.nextRowIndex,a=e.colIndex,o=0;o<=a;o++){var s=this._getDataCellValue(t.getValue(i,o)),r=this._getDataCellValue(t.getValue(n,o));if(s&&r!==s)return!1}return!0},f._getCellContent=function(e,t,i){void 0===i&&(i=[])},o}()})),define("dashboard-analytics/visualizations/renderer/grid/control/renderer/RenderGrid",["underscore","jquery","./BaseGrid","../../GridDnDManager","../../GridDropTarget","react","@ba/ba-ui-carbon-toolkit"],(function(e,t,i,n,a,o,s){return function(e){function t(t){var i;return(i=e.call(this,t)||this).isInPrintLayoutMode||(i._gridDnDManager=new n({grid:_assertThisInitialized(i),dashboardApi:i.dashboardApi,content:i.content,gridEdgeMappedToId:{row:"grid_cols"}})),i}_inheritsLoose(t,e);var i=t.prototype;return i.showDropZone=function(e){this.hideDropZones(),this.$el.find(e).css({display:"block"})},i.hideDropZones=function(){this.$el.find(".grid-drop-zone").css({display:"none"})},i.showReplaceDropZone=function(e,t){void 0===t&&(t="col"),this.showDropZone("["+t+"="+e+"] > .grid-drop-zone")},i.showLeftDropZone=function(e){this.showDropZone("[col="+e+"] > .grid-drop-zone.left")},i.showRightDropZone=function(e){this.showDropZone("[col="+e+"] > .grid-drop-zone.right")},i._getReactGridComponentToMount=function(){return{classList:["dashboard-common-grid","table-grid"],component:s.Grid}},i._getCellContent=function(e,t,i){return void 0===i&&(i=[]),this.isInPrintLayoutMode?o.createElement("div",_extends({cellType:"column"},t),i):(e||(i.push(o.createElement("div",{class:"grid-drop-zone left"},"")),i.push(o.createElement("div",{class:"grid-drop-zone replace"},"")),i.push(o.createElement("div",{class:"grid-drop-zone right"},""))),o.createElement(a,_extends({dndManager:this._gridDnDManager,cellType:"column"},t),i))},t}(i)})),define("dashboard-analytics/visualizations/renderer/grid/control/renderer/TableGridComponent",["react","prop-types","../../../common/WidthScaler","../../../common/PrintHelper"],(function(e,t,i,n){var a;return(a=function(t){function a(i){var n;return(n=t.call(this,i)||this).ref=e.createRef(),n}_inheritsLoose(a,t);var o=a.prototype;return o.render=function(){var t=this,a=this.props,o=a.columnWidth,s=a.dataCellRenderer,r=a.fixedRows,l=a.fixedRowCellRenderer,c=a.numRows,u=a.rowHeight,d=a.style;this.lastRow=null,this.rowHeight=u(),this.columnWidth=o();for(var h=[],p=[],g=0;g<r;g++)h.push(this._renderHeaderRow({rowIndex:g,renderer:l}));for(var m=0;m<c;m++)p.push(this._renderBodyRow(m,s));return e.createElement(i,{getNode:function(){return t.ref.current},maxWidth:this.props.pageWidth,browserErrorScale:n.getBrowserErrorScale()},e.createElement("table",{ref:this.ref,className:"print-table",border:"0",cellPadding:"0",cellSpacing:"0",style:d},e.createElement("tbody",null,h,p)))},o.recomputeGridSize=function(){},o._renderHeaderRow=function(t){for(var i=t.rowIndex,n=t.renderer,a=[],o=this.props.numColumns,s=0;s<o;s++){var r=this._renderCellContent(i,s,n);a.push(r)}return e.createElement("tr",null,a)},o._renderBodyRow=function(t,i){for(var n,a=[],o=this.props.numColumns,s=0;s<o;s++){var r=this._renderCellContent(t,s,i);r?(a.push(r),n=r):n&&(n.props.colSpan=s-n.props.col+1)}return e.createElement("tr",null,a)},o._renderCellContent=function(t,i,n){var a={style:{}},o=n(t,i,a);return a.style.height=this.rowHeight,delete a.style.width,o?e.createElement("td",a,o):null},a}(e.Component)).propTypes={fixedRows:t.number.isRequired,numColumns:t.number.isRequired,numRows:t.number.isRequired,columnWidth:t.func.isRequired,dataCellRenderer:t.func.isRequired,fixedRowCellRenderer:t.func.isRequired,rowHeight:t.func.isRequired,style:t.object.isRequired,pageWidth:t.number},a})),define("dashboard-analytics/visualizations/renderer/grid/control/renderer/PrintGrid",["./BaseGrid","./TableGridComponent","react"],(function(e,t,i){return function(e){function n(){return e.apply(this,arguments)||this}_inheritsLoose(n,e);var a=n.prototype;return a._getReactGridComponentToMount=function(){return{classList:["dashboard-common-grid","table-grid","print-grid"],component:t}},a._setRowColSpan=function(){for(var t,i=arguments.length,n=new Array(i),a=0;a<i;a++)n[a]=arguments[a];var o=n[0].gridCellProps,s=(t=e.prototype._setRowColSpan).call.apply(t,[this].concat(n)),r=s.rowSpan,l=s.colSpan;r&&(o.rowSpan=r),l&&(o.colSpan=l)},a._getCellContent=function(e,t,n){void 0===n&&(n=[]);var a=_extends({},t);return a.className="dashboard-grid-cell",i.createElement("div",_extends({cellType:"column"},a),n)},n}(e)})),define("dashboard-analytics/visualizations/renderer/grid/control/GridControlUtil",["./renderer/RenderGrid","./renderer/PrintGrid","../../common/PrintHelper"],(function(e,t,i){return function(){function n(){}return n.getGridClass=function(n,a){return i.isRenderFullEnabled(n,a)?t:e},n}()})),define("dashboard-analytics/visualizations/renderer/grid/control/JQGrid",["./GridControlUtil"],(function(e){return function(){function t(){this.init(arguments.length<=0?void 0:arguments[0])}var i=t.prototype;return i.init=function(t){void 0===t&&(t={});var i=e.getGridClass(t.dashboardApi,t.content);this.grid=new i(t)},i.reset=function(){this.grid.reset()},i.setData=function(e){this.grid.setData(e)},i.hasData=function(){return this.grid.hasData()},i.setStyles=function(e){this.grid.setStyles(e)},i.resetOnRender=function(){this.grid.resetOnRender()},i.onResize=function(){this.grid.onResize()},i.render=function(e,t){return this.grid.render(e,t)},i.onSyncScrollBar=function(){return this.grid.onSyncScrollBar()},i.setSelections=function(e){this.grid.setSelections(e)},i.setValue=function(e,t,i,n){this.grid.setValue(e,t,i,n)},i.getSelectedColumnHeaderNodes=function(){return this.grid.getSelectedColumnHeaderNodes()},i.isCellSelected=function(e){return this.grid.isCellSelected(e)},i.isGroupedColumn=function(e){return this.grid.isGroupedColumn(e)},i.findSlotDetails=function(e){return this.grid.findSlotDetails(e)},i.getRankDataItemCount=function(){return this.grid.getRankDataItemCount()},i.isRank=function(e){return this.grid.isRank(e)},i.remove=function(){this.grid.remove()},i.removeGridView=function(){this.grid.removeGridView()},i.onEnterContainer=function(){this.grid.onEnterContainer()},i.handleSelectColumnHeader=function(e,t,i){this.grid.handleSelectColumnHeader(e,t,i)},i.showDropZone=function(e){this.grid.showDropZone(e)},i.hideDropZones=function(){this.grid.hideDropZones()},i.showReplaceDropZone=function(e,t){void 0===t&&(t="col"),this.grid.showReplaceDropZone(e,t)},i.showLeftDropZone=function(e){this.grid.showLeftDropZone(e)},i.showRightDropZone=function(e){this.grid.showRightDropZone(e)},i.getDataRows=function(){return this.grid.getDataRows()},t}()})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/utils/ScrollBarUtil",["jquery","../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t){var i=null;return i=t.extend({init:function(e,t,n){i.inherited("init",this,arguments),this.inner=e||null,this.outer=t||null,this.event=n||null},doesHaveVerticalScrollBar:function(t,i){return t=t||this.inner,i=i||this.outer,t=t instanceof e?t.get(0):t,i=i instanceof e?i:e(i),this._getScrollHeight(t)>i.height()},doesHaveHorizontalScrollBar:function(t,i){return t=t||this.inner,i=i||this.outer,t=t instanceof e?t.get(0):t,i=i instanceof e?i:e(i),this._getScrollWidth(t)>i.width()},isEventOnVerticalScrollBar:function(t){t=t||this.event;var i=e(t.target);return i.offset().left+this._getContextClientWidth(i)-t.pageX<=0},isEventOnHorizontalScrollBar:function(t){t=t||this.event;var i=e(t.target);return i.offset().top+this._getContextClientHeight(i)-t.pageY<=0},isOnScrollBar:function(e,t,i){return 1===arguments.length?(i=e||this.event,e=this.inner,t=this.outer):(e=e||this.inner,t=t||this.outer,i=i||this.event),this.doesHaveVerticalScrollBar(e,t)&&this.isEventOnVerticalScrollBar(i)||this.doesHaveHorizontalScrollBar(e,t)&&this.isEventOnHorizontalScrollBar(i)},_getScrollHeight:function(e){return e.scrollHeight},_getScrollWidth:function(e){return e.scrollWidth},_getContextClientWidth:function(e){var t=e[0].clientWidth;return t===e.width()&&(t-=30),t},_getContextClientHeight:function(e){var t=e[0].clientHeight;return t===e.height()&&(t-=30),t}})})),define("dashboard-analytics/visualizations/renderer/indentedlist/IndentedListEventTarget",["jquery","underscore","../common/NonVIPREventTarget","../../../util/EventUtils"],(function(e,t,i,n){return function(i){function a(){for(var e,t=arguments.length,n=new Array(t),a=0;a<t;a++)n[a]=arguments[a];e=i.call.apply(i,[this].concat(n))||this;var o=n[0]||{};return e.visControl=o.visControl,e.attributes=o.attributes,e.logger=o.logger,e.getAPI()||_assertThisInitialized(e)}_inheritsLoose(a,i);var o=a.prototype;return o.getEventTargets=function(t){var i=this._getTargetNode(t);if(!i)return[];var n=e(i).closest(".item");return 0!==n.length&&this.mouseWithinBoundCheck(t)?this._getTargets(t,n):[]},o.remove=function(){this.visControl=null,this.view=null,this.attributes=null,i.prototype.remove.call(this)},o._getTargets=function(e,t){var i=[],n=t&&t.attr(this.attributes.ROW_CLASS)?t.attr(this.attributes.ROW_CLASS):"0",a=t&&t.attr(this.attributes.COLUMN_CLASS)?t.attr(this.attributes.COLUMN_CLASS):"0";return i.push({key:n+","+a,type:"item",source:t,isEdgeSelect:!0,values:this._getTargetValues(t),area:"visualization"}),i},o._getTargetValues=function(e){var i=null,a=[];try{var o=decodeURIComponent(e.attr("data-tuple"));i=JSON.parse(o)}catch(e){this.logger&&this.logger.warn("Unable to parse the string into a JSON object in the indented list.",o)}return i&&(a=t.values(i).map((function(e){return n.toDeprecatedPayload(e)}))),[a]},a}(i)})),define("dashboard-analytics/visualizations/renderer/indentedlist/IndentedListView",["jquery","underscore","../VisView","../../../lib/@waca/core-client/js/core-client/utils/dom-utils","../../../lib/@waca/dashboard-common/dist/utils/ScrollBarUtil","../../../lib/@waca/core-client/js/core-client/i18n/FormatResources","../../../util/DashboardFormatter","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/dashboard-common/dist/utils/EventChainLocal","../VisEventHandler","./IndentedListEventTarget","../common/PrintHelper","../../../util/EventUtils"],(function(e,t,i,n,a,o,s,r,l,c,u,d,h){"use strict";var p={COLUMN_CLASS:"col",ROW_CLASS:"row"},g={"font-weight":"bold","font-style":"italic","text-decoration":"underline"},m={listValueColor:"color",listValueFontSize:"font-size",listValueFontFace:"font-family",listValueFontBold:"font-weight",listValueFontItalic:"font-style",listValueFontUnderline:"text-decoration",listValueFontAlign:"text-align"},f={Right:"flex-end",Left:"flex-start",Center:"center"},v=0,_=1,b=8,y=16,I=i.extend({templateString:'<div role="tree" aria\t-expanded="true" aria-label="'+t.escape(r.get("srILVTreeLabel"))+'" tabIndex="-1" class="datawidget indentedlist-content userPrimaryFGPaletteColor"  data-attach-point="contentNode"></div>',events:{"keydown .item":"onDataItemKeydown",mousedown:"onMouseDown"},init:function(){I.inherited("init",this,arguments),this._cache=[],this._groupArrays=[],this._groupCounter=0,this._focusedNode=null,this.initialRender=!0,this._groupArrays=[],this._groupCounter=0,this.$el.addClass("dataview indentedlist-view indentedlist-view-initial-max-size"),this.initialRender=!0;var e=this.$el.find(".indentedlist-content").first();this.scrollBarUtil=new a(e,this.$el),this.isMobilePannable=!0,this.content=this.content||this.dashboardApi.getCanvas().getContent(this.ownerWidget.getId()),this._scrollHandlerFn=this.scrollHandler.bind(this),this.icons=this.dashboardApi.getFeature("Icons"),this.colors=this.dashboardApi.getFeature("Colors")},scrollHandler:function(t){var i=e(t.target);i.scrollTop()+i.innerHeight()>=i[0].scrollHeight-20&&this._addMore()},onMouseDown:function(e){this._isOnScrollBar(e)&&e.stopPropagation()},getRenderer:function(){return"dashboard-analytics/visualizations/renderer/indentedlist/IndentedListRenderer"},initialize:function(){var e=this;return this.visControl?Promise.resolve(this.visControl):new Promise((function(t,i){try{require([e.content.getFeature("Visualization").getDefinition().getProperty("control")],(function(i){e.visControl=new i({domNode:e.$el.find(".indentedlist-content")[0]}),t(e.visControl)}),i)}catch(e){i(e)}})).then((function(){return e.eventHandler=new c({target:new u({$el:e.$el,visControl:e.visControl,attributes:JSON.parse(JSON.stringify(p)),logger:e.logger}),dashboardSettings:e.dashboardSettings,transaction:e.transactionApi,logger:e.logger,ownerWidget:e.ownerWidget,visAPI:e.ownerWidget.visAPI,edgeSelection:!0}),e.visControl}))},_clampDefaultDimensions:function(){if(this.$el.hasClass("indentedlist-view-initial-max-size")&&(this.$el.width()>320?this.$el.width(320):this.$el.width(this.$el.width()),this.$el.removeClass("indentedlist-view-initial-max-size"),this.$el.height()>480)){this.$el.height(480);var e=this.$el.width()+this._getScrollbarWidth();this.$el.width(e)}},_clearDefaultDimensionClamp:function(){this.$el.width(""),this.$el.height("")},_getScrollbarWidth:function(){var e=this.$el.find(".datawidget");return e.width()-e[0].scrollWidth},render:function(e){var t=this;return this._cache=[],this._groupArrays=[],this._groupCounter=0,this._focusedNode=null,!this.isMappingComplete()||this.hasMissingFilters()||this.hasUnavailableMetadataColumns()?(this.$el.find(".indentedlist-content").empty(),this.resizeToWidget(e),this.initialRender=!0,this.renderIconView(),Promise.resolve(this)):(this._setColumnIdToDataItemMap(),this.onResultsReady(e.data.getResult()),this.removeIconView(),this.resizeToWidget(e),this.renderSelected(),this.initialRender&&(this.initialRender=!1,this.visModel.ownerWidget.whenContainerIsReady.promise.then((function(){t._clampDefaultDimensions(),t._clearDefaultDimensionClamp()}))),I.inherited("render",this,arguments))},_setColumnIdToDataItemMap:function(){var e=this;this.columnIdToDataItemMap={};var t=this.content.getFeature("Visualization").getSlots();t&&t.getMappingInfoList().forEach((function(t){e.columnIdToDataItemMap[t.dataItem.getColumnId()]=t.dataItem}))},remove:function(){this.scrollBarUtil=null,this.eventHandler&&(this.eventHandler.remove(),this.eventHandler=null),this._cache&&(this._cache=null),I.inherited("remove",this,arguments)},getDescription:function(){var e=I.inherited("getDescription",this,arguments);return r.get("WidgetLabelWithDescripion",{label:e,description:r.get("f12KeyDescription")})},renderIconView:function(){this.$el.removeClass("indentedlist-view-initial-max-size"),I.inherited("renderIconView",this,arguments)},_groupItems:function(e){var i=t.groupBy(e,function(e,t){return Math.floor(t/100)}.bind(this));return t.toArray(i)},_isEqualLevel:function(e,i){return!t.find(e,(function(e,t){return!i[t]||i[t].value!==e.value}))},onResultsReady:function(e){var i=this;this.maxIndentationLevel=0;var n=[],a=null,r=0,l=this.content.getFeature("Visualization").getSlots().getSlot("level1"),c=e.getRowCount(),u={},h=this.content.getPropertyValue("listValueFontAlign")?this.content.getPropertyValue("listValueFontAlign"):"Left";t.each(l.getDataItemList(),(function(e){u[e.getId()]=e.getFormat()}));for(var p=function(c){var d=[];t.each(l.getDataItemList(),(function(t,i){var n=[],a={},r=e.getValue(c,i)[0],l=r.label;t&&(n.push(s.format(l,u[t.getId()])),a[t.getColumnId()]=r),d.push({tuple:a,value:n.join(o.getListSeparatorSymbol()+" "),rowId:c,colId:i})}));var p={},g=0;if(a)for(;g<d.length&&i._isEqualLevel(d[g].tuple,a[g].tuple);)t.extend(p,d[g].tuple),g++;if(g<d.length){if(a&&g!==a.length-1)for(m=a.length-g-1,f=0;f<m;f++)r--,n.push("</div>");for(I=g;I<d.length;I++){if(I>0&&I!==g){r++;var C="center"===h?"":'style="padding-'+h+": "+((r==_?b:v)+r*y)+'px"';n.push('<div class="indentGroup" role="group" depth="'+r+'" '+C+">")}t.extend(p,d[I].tuple),i.maxIndentationLevel<r&&(i.maxIndentationLevel=r),n.push({tuple:t.clone(p),colIdx:I,rowValue:d[I].value,iLevel:r,rowId:d[I].rowId,colId:d[I].colId})}}a=d},g=0;g<c;g++){var m,f,I;p(g)}for(var C=0;C<r;C++)n.push("</div>");delete this.styleStr,this.selections=this.getController();var S=this.content&&this.content.getPropertyValue("fillColor"),w=this.colors.getForegroundColorPropertiesForUIElement(S,"tabs");if(this.cellFillColor=S&&this.colors.getHexColorFromDashboardColorSet(S),this.cellTextColor=w&&w.length&&w[0].value,this.el){var R=this.$el.find(".indentedlist-content"),x=R.first();x.off("scroll",this._scrollHandlerFn),d.isRenderFullEnabled(this.dashboardApi,this.content)||n.length<=2e3?(this._convertListObjectsToHTML(n),R.html(n.join(""))):(x.on("scroll",this._scrollHandlerFn),this._cache=n,this._addMore(!0))}},_addMore:function(t){var i=[];if(this._groupArrays=this._groupItems(this._cache),t)i=this._groupArrays[0];else{if(!(this._groupArrays.length>this._groupCounter))return;var n=100*this._groupCounter+this._groupArrays[this._groupCounter].length;i=this._cache.slice(0,n)}this._convertListObjectsToHTML(i);var a=i.length,o=i[a-1];if("</div>"!==o){var s=e(o).attr("depth");"2"===s?i.push("</div></div>"):"1"===s&&i.push("</div>")}else{var r=i[a-2];if("</div>"!==r)"2"===e(r).attr("depth")&&i.push("</div>")}this.$el.find(".indentedlist-content").empty(),this.$el.find(".indentedlist-content").html(i.join("")),this._groupCounter++,this.renderSelected()},_convertListObjectsToHTML:function(e){for(var t,i=this._constructStyleString(),n=0;n<e.length;n++)(t=e[n])&&t.rowValue&&(t.style=i,e[n]=this.renderItem(t))},_constructStyleString:function(){var e=this;return this.styleStr||(this.styleStr='style="',t.each(m,(function(t,i){var n=e.content.getPropertyValue(i);n&&(g[t]&&(n=g[t]),e.styleStr=e.styleStr+t+":"+n+";")})),this.styleStr+='"'),this.styleStr},_getContentJustificationStyle:function(){var e=this.content.getPropertyValue("listValueFontAlign"),t={};return e&&(t["justify-content"]=f[e]+";"),t},_getItemElementStyle:function(e){var t="";if(e){var i=Object.keys(e);i.length&&(t=' style="',i.forEach((function(i){t=""+t+i+":"+e[i]})),t+='"')}return t},renderItem:function(e){var i,n,a,o,s,r,l="";if(e&&(i=e.tuple,n=e.rowValue,a=e.iLevel,o=e.colId,s=e.rowId,r=e.style),this.content.getPropertyValue("listValueColor")&&(l='style="color: '+this.content.getPropertyValue("listValueColor")+';"'),n){var c=a<this.maxIndentationLevel?'<div class="list-svg-container"> \t\t\t\t\t\t\t<svg class="svgIcon" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false">\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#'+this.icons.getIcon("caretDown32").id+'"></use>\t\t\t\t\t\t\t</svg>\t\t\t\t\t\t</div>':"",u=this.isSubsetOfTupleSelected(i,this.selections),d=this._getContentJustificationStyle();return this.cellFillColor&&(d.color=this.cellTextColor+";",u||(d["background-color"]=this.cellFillColor+";")),["<div "+('class="item'+(u?" selected":"")+'"')+this._getItemElementStyle(d)+' role="treeitem" tabindex="-1" aria-label="',t.escape(n),'" data-tuple="',encodeURIComponent(JSON.stringify(i)),'" depth="',a,'" ',p.ROW_CLASS,'="',s,'" ',p.COLUMN_CLASS,'="',o,'" >',c,'<div class="list-item-label" '+r+'>\t\t\t\t\t<div class="list-item-text" '+l+">"+t.escape(n.substr(0,500))+"</div>\t\t\t\t</div>","</div>"].join("")}},renderSelected:function(){var i=this.getController();if(i){var n=e(this.el).find(".item");t.each(n,function(t){var n=null;e(t).removeClass("selected");try{var a=decodeURIComponent(t.getAttribute("data-tuple"));n=JSON.parse(a)}catch(e){this.logger&&this.logger.warn("Unable to parse the string into a JSON object in the indented list.",a)}this.isSubsetOfTupleSelected(n,i)&&e(t).addClass("selected")}.bind(this))}},renderFocused:function(t){e(this.el).find(".item.focused").removeClass("focused"),t&&(e(this._focusedNode).hasClass("selected")||e(this._focusedNode).is(":focus"))?e(this._focusedNode).addClass("focused"):(e(this._focusedNode).blur(),this._focusedNode=null)},isSubsetOfTupleSelected:function(e,i){if(!e||!this.isDataFiltersEnabled()&&!i)return!1;for(var n=!1,a=t.keys(e),o=0;o<a.length;++o){var s=a[o];if(void 0!==e[s])if(this.isDataFiltersEnabled()){var r=this._dataPointSelections.getSelections([this.columnIdToDataItemMap[s]],!0),l=r&&r.length>0,c=r&&r.some((function(t){return t[0].value===e[s].value}));if(l&&!c)return!1;n=c}else{if(i.isItemSelected(s)&&!i.isValueSelected(s,h.toDeprecatedPayload(e[s])))return!1;n=i.isValueSelected(s,h.toDeprecatedPayload(e[s]))}}return n},onEnterContainer:function(){var t=e(this.el).find(".item");t.length>0&&(this._focusedNode?this._focusedNode.focus():t[0].focus())},onDataItemKeydown:function(e){switch(e.keyCode){case 37:case 38:this._moveFocusUp();break;case 39:case 40:this._moveFocusDown();break;case 32:case 13:this.onDataItemClick(e),e.stopPropagation();break;default:return}e.preventDefault()},_getFocusedItemIndex:function(){for(var t=e(this.el).find(".item"),i=0,n=0;n<t.length;n++)if(e(t[n]).is(":focus")){i=n;break}return i},_moveFocusUp:function(){var e=this._getFocusedItemIndex();this._setItemFocus(Math.max(e-1,0))},_moveFocusDown:function(){var t=this._getFocusedItemIndex();this._setItemFocus(Math.min(t+1,e(this.el).find(".item").length-1))},_setItemFocus:function(t){e(this.el).find(".item")[t].focus()},animate:function(){this.visModel.renderCompleteBeforeAnimation()},_isOnScrollBar:function(e){return this.scrollBarUtil.isOnScrollBar(e)}});return I})),define("dashboard-analytics/visualizations/renderer/indentedlist/control/IndentedListControl",["underscore","../../../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t){"use strict";return t.extend({domNode:null,init:function(){e.extend(this,arguments[0])}})})),define("dashboard-analytics/visualizations/renderer/dataplayer/DataPlayerEntryCreator",["jquery","../../../util/DashboardFormatter"],(function(e,t){var i=e('<div class="sliderTickForHorizontal"><div class="tick"></div></div>'),n=e('<div class="sliderLabel" title=""></div>');return function(){function e(e,t,i){this.$sliderNode=e,this.barOverflow=t,this._dataItemAPI=i,this.sizeCache={}}var a=e.prototype;return a._getNewBaseTick=function(){return i.clone()},a._updateSizeCache=function(e){this.sizeCache.width=this.sizeCache.width?this.sizeCache.width:e[0].clientWidth,this.sizeCache.height=this.sizeCache.height?this.sizeCache.height:e[0].clientHeight},a._createAndAddBaseTick=function(){var e=this._getNewBaseTick();return this.$sliderNode.before(e),this._updateSizeCache(e),e},a._updateAndDefineTickEntry=function(e,t,i,n,a){void 0===a&&(a=0);var o=t-Math.round(this.sizeCache.height/2);return e.attr("data-item-index",a),e.css("height",this.sizeCache.height+"px"),e.css("top",o+"px"),e.css("left",n+"px"),{top:o,left:n,width:this.sizeCache.width,height:this.sizeCache.height,spacing:i}},a._getTickLeftPosition=function(e,t,i){return t?Math.round(this.barOverflow/2+i-this.sizeCache.width/2):Math.round(this.barOverflow/2+i*e-this.sizeCache.width/2)},a.createTick=function(e,t,i){var n=this._createAndAddBaseTick(),a=this._getTickLeftPosition(e,!1,i);return this._updateAndDefineTickEntry(n,t,i,a,e)},a.createSoleTick=function(e,t){var i=this._createAndAddBaseTick(),n=this._getTickLeftPosition(0,!0,t);return this._updateAndDefineTickEntry(i,e,t,n,0)},a._getLabelSizeAndPosition=function(e,t,i){var n=e[0].clientWidth,a=n;if(t){var o=2*this.barOverflow-10;n>o&&(n=Math.round(o),e.css("width",n+"px"))}var s=e[0].clientHeight,r=Math.round(i-n/2),l=r+n;return r<0&&(l+=0-r,r=0),{left:r,right:l,width:n,actualWidth:a,height:s}},a._createAndAddLabel=function(e,i,a,o,s){var r=t.format(e,this._dataItemAPI.getFormat()),l=n.clone();l.attr("title",r),l.attr("role","option"),l.attr("tabindex","-1"),l.text(r),this.$sliderNode.before(l),l.attr("data-item-index",i);var c=this._getLabelSizeAndPosition(l,s,a);return _extends({},c,{$el:l,labelBaseline:o,tickLeft:a})},a._getBaseline=function(e){return e-this.$sliderNode[0].clientHeight/2},a._createLabelAndGetPlayerEntry=function(e,t,i,n,a){return{index:t,value:e,tick:i,label:this._createAndAddLabel(e.label,t,i.left+i.width/2,n,a)}},a.createDataPlayerEntry=function(e,t,i,n,a){var o=this._getBaseline(i),s=this.createTick(t,i,n);return this._createLabelAndGetPlayerEntry(e,t,s,o,a)},a.createSoleDataPlayerEntry=function(e,t,i){var n=this._getBaseline(t),a=this.createSoleTick(t,i);return this._createLabelAndGetPlayerEntry(e,0,a,n,!0)},e}()})),define("dashboard-analytics/visualizations/renderer/dataplayer/DataPlayerSlider",["jquery","./DataPlayerEntryCreator","../../../widgets/livewidget/nls/StringResources"],(function(e,t,i){return function(){function n(){this.playerEntries=[]}var a=n.prototype;return a._initSliderContainer=function(e){this.$_sliderContainer=e,this.$_sliderContainer.attr("aria-label",i.get("dataPlayerValueListLabel")),this.$_sliderContainer.empty()},a._createTickDecoration=function(){this.$_tickDecorationNode=e('<div class="sliderNode"><svg class="sliderSymbol" height="18" width="18"><circle cx="10" cy="10" r="8" fill-opacity="1"/></div>'),this.$_sliderContainer.append(this.$_tickDecorationNode)},a._createSliderBar=function(t,i,n){this.$_sliderBar=e('<div class="sliderBarHorizontal"></div>'),this.$_sliderContainer.append(this.$_sliderBar),this.$_sliderBar.css("top",t+"px"),this.$_sliderBar.css("left",i+"px"),this.$_sliderBar.css("width",n+"px")},a._positionLabels=function(t){if(0!==this.playerEntries.length)for(var i=[t],n=0;n<i.length;n++){this._processLabelLayers(i);for(var a=0;a<i[n].length;a++){var o=i[n][a];o.$el.css("top",Math.max(-8,o.labelBaseline-o.height*(n+1))+"px"),o.$el.css("left",o.left+"px")}if(i.length>2){for(var s=[],r=0;r<i.length;r++)e.merge(s,i[r]);this._rotateLabels(s);break}}},a._processLabelLayers=function(e){for(var t=[],i=-99999999,n=e[e.length-1],a=0;a<n.length;a++)n[a].left<i?(t=t.concat(n.splice(a,1)),a--):i=n[a].right;t.length>0&&e.push(t)},a._rotateLabels=function(e){if(!(e.length<1))for(var t=this._getWidgetWidth(),i=Math.max(-8,e[0].labelBaseline-e[0].height),n=Math.max(25,Math.floor(Math.sqrt(i*i+i*i))),a=0;a<e.length;a++){var o=e[a].$el;if(o.css("top",i+"px"),o.css("left",e[a].tickLeft+"px"),t-e[a].tickLeft<i){var s=t-e[a].tickLeft;o.css("width",Math.floor(Math.sqrt(s*s+s*s))+"px")}else o.css("width",n+"px");o.addClass("rotated")}},a._calcTickPosition=function(e){var t={},i=this.playerEntries[e];return i&&(t=this._getTickTopLeftPosition(i)),t},a._getTickTopLeftPosition=function(e){var t={};return e&&e.tick&&(t.top=Math.round(e.tick.top+e.tick.height/2-this._getTickDecorationSize().height/2),t.left=Math.round(e.tick.left+e.tick.width/2-this._getTickDecorationSize().width/2)),t},a._animateToScrollLeftPosition=function(e){this.$_sliderContainer.animate({scrollLeft:e-60})},a._getWidgetWidth=function(){return this.$_sliderContainer[0].scrollWidth||this.$_sliderContainer[0].clientWidth},a._getTickDecorationSize=function(){return this.tickDecorationSize||(this.tickDecorationSize={width:this.$_tickDecorationNode[0].clientWidth,height:this.$_tickDecorationNode[0].clientHeight}),this.tickDecorationSize},a._moveTickDecorationToPosition=function(e,t){var i={left:e};t?this.$_tickDecorationNode.animate(i,200):this.$_tickDecorationNode.css(i)},a.hideTickDecoration=function(){this.$_tickDecorationNode.css("opacity",0),this.$_tickDecorationNode.css("display","none")},a.showTickDecoration=function(){this.$_tickDecorationNode.css({opacity:1,display:"block"})},a.setTickDecorationLeftPosition=function(e){this.$_tickDecorationNode.css("left",e+"px")},a.setTickDecorationTopPosition=function(e){this.$_tickDecorationNode.css("top",e+"px")},a.positionSlider=function(e,t,i){i&&this.showTickDecoration();var n=this.getScrollLeftPosition(),a=this.getSliderSize().width,o=this._calcTickPosition(e);return this.setTickDecorationTopPosition(o.top),(o.left>=n+a-10||o.left<n)&&this._animateToScrollLeftPosition(o.left),this._moveTickDecorationToPosition(o.left,t),(e+1)%this.playerEntries.length},a.getValueAtIndex=function(e){return this.playerEntries[e]&&this.playerEntries[e].value},a.hasPlayerEntries=function(){return this.playerEntries&&this.playerEntries.length},a.getPlayerEntryWithValue=function(e){return this.playerEntries.find((function(t){return t.value.value===e}))},a.determineTickToSnapTo=function(e,t){for(var i=e+this._getTickDecorationSize().width/2,n=e,a=-1,o=t?null:15,s=0;s<this.playerEntries.length;s++){var r=this.playerEntries[s];o||(o=r.tick.spacing/2);var l=r.tick.left+r.tick.width/2,c=i<=l+o,u=i>=l-o,d=0===s&&c,h=s===this.playerEntries.length-1&&u;if(d||h||c&&u){n=this._calcTickPosition(s).left,a=s;break}}return{left:Math.round(n),index:a}},a._renderBarAndGetTickSpacing=function(e,t){var i,n,a;return e&&e.length>1?(i=44*(e.length-1),a=(n=Math.max(i,this.getSliderSize().width-120))/(e.length-1)):a=(n=this.getSliderSize().width-120)/2,this._createSliderBar(t,30,n),this._createTickDecoration(),a},a._createPlayerEntriesAndRenderLabels=function(e,i,n,a){var o=new t(this.$_tickDecorationNode,60,e),s=[];if(this.playerEntries.length=0,i&&1===i.length){var r=o.createSoleDataPlayerEntry(i[0],n,a);this.playerEntries.push(r),s.push(r.label)}else for(var l=0;l<i.length;l++){var c=0===l||l===i.length-1,u=o.createDataPlayerEntry(i[l],l,n,a,c);this.playerEntries.push(u),s.push(u.label)}this._animateToScrollLeftPosition(0),this._positionLabels(s)},a.render=function(e,t,i){this._initSliderContainer(i),this.sliderSize=null,this.tickDecorationSize=null;var n=Math.round(this.getSliderSize().height*(2/3)),a=this._renderBarAndGetTickSpacing(t,n);this._createPlayerEntriesAndRenderLabels(e,t,n,a)},a.getSliderSize=function(){return this.sliderSize||(this.sliderSize={width:this.$_sliderContainer[0].clientWidth,height:this.$_sliderContainer[0].clientHeight}),this.sliderSize},a.getScrollLeftPosition=function(){return this.$_sliderContainer.scrollLeft()},a.getSliderContainer=function(){return this.$_sliderContainer},a.getTickDecorationPosition=function(){return this.$_tickDecorationNode.position()},n}()})),define("dashboard-analytics/visualizations/renderer/dataplayer/DataPlayerPlayPause",["jquery","@ba/ba-ui-carbon-toolkit","../../../widgets/livewidget/nls/StringResources"],(function(e,t,i){return function(){function e(e,t,i){this.$_playPauseButton=e.find(".playOrPause");var n=t.getFeature("Icons"),a=n.getIcon("playIcon"),o=n.getIcon("pauseIcon");this.$_playPauseButton.append('<svg class="play"><use xlink:href="#'+a.id+'"/></svg><svg class="pause"><use xlink:href="#'+o.id+'"/></svg>'),this.playCallback=i}var t=e.prototype;return t.render=function(e,t){this.$_playPauseButton.css("top",Math.round(e*(2/3)-28)+"px"),t?this.$_playPauseButton.addClass("disabled"):this.$_playPauseButton.removeClass("disabled")},t.clearPlayTimer=function(){this._playTimeout&&(window.clearTimeout(this._playTimeout),this._playTimout=null)},t.play=function(){this.$_playPauseButton.removeClass("paused"),this.iterate()},t.pause=function(){this.clearPlayTimer(),this.$_playPauseButton.addClass("paused")},t.isPlaying=function(){return!this.$_playPauseButton.hasClass("paused")},t.iterate=function(){this.clearPlayTimer(),this.playCallback(),this._playTimeout=window.setTimeout(this.iterate.bind(this),1600)},t.hide=function(){this.$_playPauseButton.hide()},t.show=function(){this.$_playPauseButton.attr("aria-label",i.get("playButtonLabel")),this.$_playPauseButton.show()},t.leaveWidget=function(){this.$_playPauseButton.attr("tabindex","-1")},t.enterWidget=function(){this.$_playPauseButton.attr("tabindex","0"),this.$_playPauseButton.focus()},e}()})),define("text!dashboard-analytics/visualizations/renderer/dataplayer/DataPlayerView.html",[],(function(){return'<div class="dataview dataplayer-view userPrimaryFGPaletteColor">\n\t<div class="slider"  data-attach-point="contentNode" role="listbox" tabindex="-1"></div>\n\t<div class="playOrPause paused" role="button">\n\t</div>\n</div>\n'})),define("dashboard-analytics/visualizations/renderer/dataplayer/DataPlayerView",["jquery","underscore","../VisView","./DataPlayerSlider","./DataPlayerPlayPause","../../../widgets/livewidget/nls/StringResources","text!./DataPlayerView.html"],(function(e,t,i,n,a,o,s){"use strict";var r=i.extend({templateString:s,_dataItemAPI:null,_playIndex:-1,_currentSelectionIndex:-1,_mouseStartX:0,_mouseOrgStartX:0,_nodeVirtualPosition:0,_dragging:!1,events:{"clicktap .sliderLabel":"onLabelClick","keydown .sliderLabel":"onLabelKeypress","click .sliderTickForHorizontal":"onTickClick","tap .sliderTickForHorizontal":"onTickClick","touchstart .sliderNode":"onTickDecorationMouseDown","touchend .slider":"onSliderMouseUp","mousedown .sliderNode":"onTickDecorationMouseDown","mouseup .slider":"onSliderMouseUp","clicktap .playOrPause":"onPlayOrPauseClick","mousedown .playOrPause":"preventSelection","keydown .playOrPause":"onPlayOrPauseKeypress"},init:function(){r.inherited("init",this,arguments),this.transaction=this.dashboardApi.getFeature("Transaction"),this.slider=new n,this.playPauseButton=new a(e(this.visEl),this.dashboardApi,this._moveToTheNextItem.bind(this)),this.el.style.position="relative"},remove:function(){this.playPauseButton&&(this.playPauseButton.clearPlayTimer(),this.playPauseButton=null),this.ownerWidget.dashboardApi.off("open:sharePanel",this._onSharePanelOpen,this),this.ownerWidget.dashboardApi.off("close:sharePanel",this._onSharePanelClose,this),r.inherited("remove",this,arguments)},onDataReady:function(e){var t=e.info&&e.info.renderContext?JSON.parse(JSON.stringify(e.info.renderContext)):{};return t.taskRefreshed.data&&(this.filterIndicator&&this.filterIndicator.update(),this._dataItemAPI=this.visualization.getSlots().getSlotList()[0].getDataItemList()[0]),t},getDescription:function(){var e=r.inherited("getDescription",this,arguments);return o.get("WidgetLabelWithDescripion",{label:e,description:o.get("f12KeyDescription")})},_renderEmptyDataPlayerWidget:function(t){this._getSliderContainer().empty(),this.renderIconView(),this.resizeToWidget(t),e(this.visEl).animate({opacity:1}),this.playPauseButton.hide()},_getDataItemsFromResults:function(e){for(var t=[],i=e.getResultItemList()[0].getRowCount(),n=0;n<i;n++)t.push(e.getValue(n,0)[0]);return t},_renderDataPlayerWithResults:function(e){this.removeIconView(),this.resizeToWidget(e);var t=this._getDataItemsFromResults(e.data.getResult());return this._renderWithDataItems(t)},render:function(e){var t=this;return!this.isMappingComplete()||this.hasMissingFilters()||this.hasUnavailableMetadataColumns()?(this._renderEmptyDataPlayerWidget(e),Promise.resolve(this)):(this.ownerWidget.dashboardApi.on("open:sharePanel",this._onSharePanelOpen,this),this.ownerWidget.dashboardApi.on("close:sharePanel",this._onSharePanelClose,this),r.inherited("render",this,arguments).then((function(){return t._renderDataPlayerWithResults(e)})))},onExitContainer:function(){this.playPauseButton.leaveWidget(),this.$el.find(".sliderLabel.selected").attr("tabindex","-1")},onEnterContainer:function(){this.$el.find(".sliderLabel.selected").attr("tabindex","0"),this.playPauseButton.enterWidget()},onLabelKeypress:function(t){var i=e(t.currentTarget),n=t.keyCode;37===n||38===n?(this._moveToItem(i,i.prevAll(".sliderLabel").first()),t.stopPropagation()):39!==n&&40!==n||(this._moveToItem(i,i.nextAll(".sliderLabel").first()),t.stopPropagation())},preventSelection:function(e){e.stopPropagation()},_moveToItem:function(e,t){e.attr("tabindex","-1"),t.click().attr("tabindex","0").focus()},getFilterIndicatorSpec:function(){return{localFilters:!0}},onTickClick:function(e){e.gesture&&e.gesture.preventDefault(),this._setFilterByEventTarget(e,"sliderTickForHorizontal",!1)},onLabelClick:function(e){this._setFilterByEventTarget(e,"sliderLabel",!0)},onPlayOrPauseKeypress:function(e){13!==e.keyCode&&32!==e.keyCode||this.onPlayOrPauseClick(e)},onPlayOrPauseClick:function(e){this.playPauseButton.isPlaying()?this.playPauseButton.pause():this.playPauseButton.play(),e.stopPropagation()},_onSharePanelOpen:function(){this.playPauseButton.isPlaying()&&(this.playPauseButton.pause(),this.shareState={wasPlaying:!0})},_onSharePanelClose:function(){this.shareState&&this.shareState.wasPlaying&&(this.shareState=null,this.playPauseButton.play())},onTickDecorationMouseDown:function(e){this._wasJustPlaying=!1,this.playPauseButton.isPlaying()&&(this.playPauseButton.pause(),this._wasJustPlaying=!0),this._mouseStartX=this._getPageX(e),this._mouseOrgStartX=this._mouseStartX,this._nodeVirtualPosition=this.slider.getTickDecorationPosition().left+this.slider.getScrollLeftPosition(),this.slider.getSliderContainer().on("mousemove touchmove",this.onSliderMouseMove.bind(this)),this._dragging=!0,e.stopPropagation(),e.preventDefault()},onSliderMouseUp:function(e){if(this._dragging){if(this._dragging=!1,this.slider.getSliderContainer().off("mousemove touchmove"),this._mouseOrgStartX!==this._mouseStartX){var t=this._determineTickToSnapTo(this._nodeVirtualPosition,!0);this._setFilter(t.index)}else this._wasJustPlaying||this._clearSelection();e.preventDefault()}},onSliderMouseMove:function(e){var t=this._getPageX(e),i=t-this._mouseStartX;this._mouseStartX=t;var n=this._nodeVirtualPosition+i;this._nodeVirtualPosition=n;var a=this._determineTickToSnapTo(n,!1);this.slider.setTickDecorationLeftPosition(a.left),a.left!==n&&(this._selectTick(a.index),this._setFilter(a.index)),e.preventDefault()},onChangeFilter:function(e){var t=e.changeEvent;if(t&&!t.brushingChanged())return r.inherited("onChangeFilter",this,arguments);if(this._dataItemAPI&&!this._dragging){var i=this.getSelector().getSelections(),n=i&&i.length&&i[0].categories,a=-1;n&&n.length>0&&(a=this._getEntryIndex(n[0].value)),a!==this._currentSelectionIndex&&(this._currentSelectionIndex=a,this._positionSlider(this._currentSelectionIndex,!0,!0))}return Promise.resolve()},_renderTheBaseDataPlayer:function(e){this.slider.render(this._dataItemAPI,e,this._getSliderContainer()),this.playPauseButton.render(this.slider.getSliderSize().height,!(e&&e.length>1))},_renderWithDataItems:function(t){var i=this;this._renderTheBaseDataPlayer(t);var n=this.getSelector().getSelections(),a=n&&n.length&&n[0].categories,o=-1,s=!1;return a&&a.length>0&&(o=-1!==(o=this._getEntryIndex(a[0].value))?o:0,s=!0),this._currentSelectionIndex=o,this._positionSlider(o,!1,s),this.playPauseButton.show(),new Promise((function(t){return e(i.visEl).animate({opacity:1},{complete:t})}))},_getEntryIndex:function(e){var t=-1,i=this.slider.getPlayerEntryWithValue(e);return i&&(t=i.index),t},_positionSlider:function(e,t,i){if(e<0)return this.slider.hideTickDecoration(),void this._selectTick(-1);this._playIndex=this.slider.positionSlider(e,t,i),i&&this._selectTick(e)},_clearCurrentlySelectedTickAndRetrieveTabIndex:function(){var t=e(this.visEl).find(".sliderLabel.selected"),i=t.attr("tabindex");return t.removeClass("selected"),t.attr("tabindex",-1),t.attr("aria-selected","false"),i},_selectTickAtIndexAndSetTabIndex:function(t,i){t>=0&&e(this.visEl).find('.sliderLabel[data-item-index="'+t+'"]').addClass("selected").attr("aria-selected","true").attr("tabindex",i)},_selectTick:function(e){var t=this._clearCurrentlySelectedTickAndRetrieveTabIndex();this._selectTickAtIndexAndSetTabIndex(e,t)},_setFilter:function(e){this.ownerWidget.dashboardApi.triggerDashboardEvent("widget:hideToolbar");var t=this.slider.getValueAtIndex(e),i=this.transaction.startTransaction();this.getSelector().clearAll(i),this.getSelector().select([{categories:[{dataItemId:this._dataItemAPI.getId(),columnId:this._dataItemAPI.getColumnId(),label:t.label,value:t.value}]}],i),this.transaction.endTransaction(i)},_getDataItemIndexFromEvent:function(e,t){return this.getTarget(e.target,t).getAttribute("data-item-index")},_reactToSelectionOfCurrentNode:function(e){e&&!this.playPauseButton.isPlaying()&&this._clearSelection()},_reactToSelectionOfNewNode:function(e){this._selectTick(e),this._setFilter(e)},_setFilterByEventTarget:function(e,t,i){var n=this._getDataItemIndexFromEvent(e,t);n&&((n=parseInt(n,10))!==this._currentSelectionIndex?this._reactToSelectionOfNewNode(n):this._reactToSelectionOfCurrentNode(i))},_moveToTheNextItem:function(){this._dataItemAPI&&this.slider.hasPlayerEntries()&&(-1===this._playIndex&&(this._playIndex=0),this._setFilter(this._playIndex,!0))},_getSliderContainer:function(){return e(this.visEl).find(".slider")},_clearSelection:function(){-1!==this._currentSelectionIndex&&this.getSelector().clearAll(),this._positionSlider(-1),this._selectTick(-1),this._currentSelectionIndex=-1},_determineTickToSnapTo:function(e,t){return this._currentSelectionIndex=-1,this.slider.determineTickToSnapTo(e,t)},_getPageX:function(e){return"touch"!==e.type.substr(0,5)?e.pageX:e.originalEvent.touches[0].pageX}});return r})),define("dashboard-analytics/visualizations/renderer/kpi/control/KpiControl",["underscore","../../../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t){"use strict";return t.extend({domNode:null,init:function(){e.extend(this,arguments[0])}})})),define("dashboard-analytics/visualizations/renderer/infographic/control/InfographicControl",["underscore","../../../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t){"use strict";return t.extend({domNode:null,init:function(){e.extend(this,arguments[0])}})})),define("dashboard-analytics/visualizations/renderer/dropdown/DropdownView",["react","react-dom","@ba/ba-ui-carbon-toolkit","@ba/ba-ui-carbon","dashboard-analytics/visualizations/renderer/VisView","dashboard-analytics/util/DashboardFormatter","dashboard-analytics/widgets/livewidget/nls/StringResources","dashboard-analytics/lib/@waca/dashboard-common/dist/utils/EventChainLocal"],(function(e,t,i,n,a,o,s,r){var l=i.ComboBox,c=n.MultiSelect,u={"clear.selection":"dropdownSingleSelectClearAll","open.menu":"dropdownOpenMenu","close.menu":"dropdownCloseMenu"},d={"clear.all":"dropdownMultiSelectClearAll","open.menu":"dropdownOpenMenu","close.menu":"dropdownCloseMenu"},h=a.extend({events:{"click.dropdown-container":"_onClick","focusout.dropdown-container":"_onFocusOut"},init:function(){h.inherited("init",this,arguments),this._dataPointSelections=this.content.getFeature("DataPointSelections"),this._className=this.visualization.getType(),this._contentViewDom=this.content.getFeature("ContentViewDOM"),this._contentViewDom.getNode().classList.add(this._className)},render:function(e){this._remove();var t=this.renderSequence.getTaskResult("data")||{};if(!this._readyToRender()||!t.getResult)return this.renderIconView(),this.resizeToWidget(e),Promise.resolve(this);this.removeIconView(),this._container=document.createElement("div"),this._container.className="dropdown-container carbonDarkThemeable",this.$el.append(this._container),this.$el.css({width:"",height:""});var i=t.getResult();return this._renderDropDown(i,this.content.getId()),h.inherited("render",this,arguments)},getDescription:function(){var e=h.inherited("getDescription",this,arguments);return s.get("WidgetLabelWithDescripion",{label:e,description:s.get("f12KeyDescription")})},_renderDropDown:function(i,n){var a=this._getDropdownInitInfo(i),o=a.values,s=a.state;this._dropdownType=this.content.getPropertyValue("selection")||"singleSelect","singleSelect"===this._dropdownType?this._dropdown=e.createElement(l,this._getSingleSelectDropdownProps(n,o,s,this)):this._dropdown=e.createElement(c,this._getMultiSelectDropdownProps(n,o,s,this)),t.render(this._dropdown,this._container)},_getSingleSelectDropdownProps:function(e,t,i,n){return{id:"combobox_"+e,type:"text",light:!0,selectedValue:i.textInputSelectedValue,placeholder:this.content.getPropertyValue("placeholder"),disableFilter:!0,customWidth:"100%",customHeight:"100%",size:"small",onChange:function(e){n._onSingleSelectChange(e)},startingValues:t,translateWithId:function(e){return s.get(u[e])}}},_getMultiSelectDropdownProps:function(e,t,i,n){return{id:"multiselect_"+e,items:t,size:"sm",sortItems:function(e){return e},itemToString:function(e){return e?e.label:""},onChange:function(e){n._onMultiSelectChange(e)},light:!0,label:this.content.getPropertyValue("placeholder"),initialSelectedItems:i.textInputSelectedValues,translateWithId:function(e){return s.get(d[e])}}},_getDropdownInitInfo:function(e){var t,i,n=[],a=e.getResultItemList()[0],s=a.getDataItemList()[0].getFormat(),r=this._dataPointSelections.getSelections(),l={};for(t=0;t<a.getRowCount();t++){i=a.getValue(t)[0];var c=o.format(i.label,s)+"";n.push({value:i.value,label:c})}if(r&&r.length>0&&r[0].categories&&r[0].categories.length>0){var u=r.map((function(e){return{value:e.categories[0].value,label:o.format(e.categories[0].label,s)+""}})).filter((function(e){return n.some((function(t){return t.value===e.value}))}));u.length&&(l.textInputSelectedValue={value:u[0].value,label:u[0].label},l.textInputSelectedValues=u)}return{values:n,state:l}},_onSingleSelectChange:function(e){this._values=[],void 0!==e.value&&this._values.push({u:e.value,d:e.label}),this._updateFilters()},_onMultiSelectChange:function(e){this._values=[];var t=e.selectedItems;t&&(this._values=t.filter(Boolean).map((function(e){return{u:e.value,d:e.label}}))),0===this._values.length&&this._updateFilters()},_updateFilters:function(){var e=this.transactionApi.startTransaction();this._dataPointSelections.clearAll(e);var t=this.visualization.getSlots().getMappedSlotList()[0].getDataItemList()[0].getColumnId();this._dataPointSelections.select(this._values.map((function(e){return{categories:[{columnId:t,value:e.u,label:e.d}]}})),e),this.transactionApi.endTransaction(e)},_remove:function(){this._dropdown&&(t.unmountComponentAtNode(this._container),this._dropdown=null),this.$el.empty()},remove:function(){var e=this._contentViewDom.getNode();e&&e.classList.remove(this._className),this._remove(),h.inherited("remove",this,arguments)},_readyToRender:function(){return this.visualization.getSlots().isMappingComplete()&&!this.visualization.hasUnavailableMetadataColumns()},_setEventLocalProperty:function(e,t,i){new r(e).setProperty(t,i)},_updateDropdownOpenStateClass:function(){var e=this;setTimeout((function(){0!==e._contentViewDom.getNode().getElementsByClassName("bx--list-box__menu-icon--open").length?e._contentViewDom.getNode().classList.add("dropdownMenuOpen"):e._contentViewDom.getNode().classList.remove("dropdownMenuOpen")}),200)},_onClick:function(e){this._setEventLocalProperty(e,"preventDefaultContextBar",!0),this._updateDropdownOpenStateClass()},_onFocusOut:function(){"multiSelect"===this._dropdownType&&this._values&&this._values.length&&this._applyCachedMultiSelection(),this._updateDropdownOpenStateClass()},_applyCachedMultiSelection:function(){this._updateFilters(),this._values=[]}});return h})),define("dashboard-analytics/visualizations/renderer/sequence/BaseTask",["../../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e){"use strict";var t=e.extend({init:function(e){t.inherited("init",this,arguments),this.id=e.id,this.owner=e.owner,this.ownerWidget=e.ownerWidget,this.logger=e.logger,this.visAPI=e.visAPI,this.dashboardApi=e.dashboardApi,this.content=e.content,this._initializeStep=this.owner._initializeStep.bind(this.owner),this._isStepComplete=this.owner._isStepComplete.bind(this.owner),this._completeStep=this.owner._completeStep.bind(this.owner),this._logRenderContext=this.owner._logRenderContext.bind(this.owner),this.id&&this._initializeStep(this.id)},getId:function(){return this.id},getRenderState:function(){return this.owner._renderState},clearError:function(){var e=this.content.getFeature("state.internal");e&&e.clearError()},showError:function(){},process:function(){return Promise.reject(new Error("BaseTask.process needs to be overridden!"))},isSameQuery:function(e){var t=!1;if(e&&e.extraInfo){var i=e.extraInfo&&"realtimeRefresh"===e.extraInfo.sender;t=void 0!==(t=!0===e.sameQueryData&&i||e.extraInfo&&e.extraInfo.sameQueryValidateMode)&&t}return t}});return t})),define("dashboard-analytics/visualizations/renderer/sequence/DataTask",["./BaseTask"],(function(e){"use strict";var t=e.extend({init:function(){t.inherited("init",this,arguments),this.visualization=this.content.getFeature("Visualization"),this.infoIndicator=this.content.getFeature("InfoIndicator")},process:function(e){var t=this;return this._isStepComplete(e,"data")?Promise.resolve(e):(this._clearDataErrorsAndWarnings(),this._hasMappedSlots()&&this._canExecuteQuery()&&!this._hasUnavailableMetadataColumns()&&!this._hasMissingFilters()?this._executeQueries(e).then((function(i){return i&&(t.dashboardApi.triggerDashboardEvent("synchronize:pageContextFilters",{synchDataFilterEntries:i.synchDataFilterEntries}),e.extraInfo&&e.extraInfo.sameQueryValidateMode&&(e.sameQueryData=!0,e.extraInfo.queryRefresh=!0),t._completeStep(e,"data",i),t.getRenderState().setPropertyValue("newData",!0)),e})).catch((function(e){if(!e||"dwErrorStaleRequest"!==e.msg){var i=e?e.msg:"dwErrorRenderingVisualization",n=e?e.param:null;t.showError(i,n)}throw e})):(this._completeStep(e,"data",{}),Promise.resolve(e)))},_hasMappedSlots:function(){return 0!==this.visualization.getSlots().getMappedSlotList().length},_canExecuteQuery:function(){return!0===this.dashboardApi.getConfiguration("forceQuery")||this.visualization.getSlots().isMappingComplete()},_hasUnavailableMetadataColumns:function(){return this.visualization.hasUnavailableMetadataColumns()},_hasMissingFilters:function(){return this.ownerWidget&&this.ownerWidget.getUnavailableLocalFilter().length>0},_executeQueries:function(e){var t=this.content.getFeature("DataQueryExecution");return e.extraInfo&&e.extraInfo.dataQueryParams&&t.addRequestOptions(e.extraInfo.dataQueryParams),t.executeQueries()},_clearDataErrorsAndWarnings:function(){this.infoIndicator&&this.infoIndicator.clearMessagesWithIds(["visualization_notifications","moreDataIndicator","autobinSuggestion","data_notifications"])}});return t})),define("dashboard-analytics/visualizations/renderer/sequence/HighlighterTask",["./BaseTask"],(function(e){"use strict";return e.extend({process:function(e){var t=this;return this._isStepComplete(e,"highlighter")?Promise.resolve(e):Promise.resolve().then((function(){return t._completeStep(e,"highlighter",!0),e})).catch((function(e){throw t.showError("dwErrorRenderingVisualization"),e}))}})})),define("dashboard-analytics/visualizations/renderer/sequence/RenderTask",["underscore","./BaseTask"],(function(e,t){"use strict";var i={ENGINE_LAYOUT_DOES_NOT_FIT:"dwErrorVisualizationTooSmall"},n=["id","extraInfo"];return t.extend({process:function(e){this._logRenderContext("_render:ContextStepsComplete",e);var t=e.extraInfo&&e.extraInfo.annotationRequest;return this._isStepComplete(e,"render")||t?(this._completeStep(e,"render",this.getRenderState()),Promise.resolve(e)):this.render(e)},render:function(t){var i,n=t.resizing;delete t.resizing;var a=this.getRenderState();return a.readyToRender()?this.isSameQuery(t)?(t.renderComplete=!0,this.visAPI.renderComplete(),i=Promise.resolve(t)):(this.clearError(),i=this.ownerWidget.getVisBounds().then(function(i){var o=this;if(this._logRenderContext("_render:visBoundReady",t),a.readyToRender()){a.lastSizeRendered=i,e.each(e.keys(t),(function(e){!o._isReservedContextKey(e)&&a.getCurrentContext(e)&&(t[e]=a.getCurrentContext(e)[e])})),t.widgetSize=i;var s=this.getRenderState().getCurrentContextData("visView");s.show();try{return s.resizing=n,s.render(t).then((function(e){if(e&&e.reRenderNeeded)return o.ownerWidget.setReRenderOnShow({resizing:!0}),t.renderComplete=!1,t;o._completeStep(t,"render",a),a.firstRenderComplete=!0,t.renderComplete=!0,o.visAPI.renderComplete(t),o.getRenderState().setPropertyValue("newData",!1);var i=t&&t.extraInfo&&"realtimeRefresh"===t.extraInfo.sender,n=t&&t.refresh&&t.refresh.propertiesPane;return(n=n||void 0===n&&t.refreshAll)&&o.ownerWidget.focusOn&&!i&&o.ownerWidget.refreshPropertiesPane(),t})).catch(function(e){return this._showRenderError(t,e),t.renderComplete=!0,this.getRenderState().setPropertyValue("newData",!1),t}.bind(this))}catch(e){this.getRenderState().setPropertyValue("newData",!1),this._showRenderError(t,e)}a.firstRenderComplete=!0}return t.renderComplete=!0,t}.bind(this))):i=Promise.resolve(t),i},_isReservedContextKey:function(e){return n.indexOf(e)>-1},_showRenderError:function(e,t){if(this.owner.isActive()){if(this.owner.isLastRun(e)){e.visView.hide();var n=t.getErrorCode&&t.getErrorCode(),a=n&&n.name(),o=a&&i[a]||"dwErrorRenderingVisualization";this.owner.showError(o)}this.logger.error("An error occured during the data widget rendering sequence",t,this.visAPI)}else this.logger.debug("An error occured during the data widget rendering sequence",t,this.visAPI)}})})),define("dashboard-analytics/widgets/livewidget/query/QueryResultDataItem",["../../../lib/@waca/core-client/js/core-client/ui/core/Class","./QueryResultDataUtils","underscore"],(function(e,t,i){"use strict";var n=e.extend({_dataItem:null,_bTupleHeaderNormalized:!1,init:function(e){n.inherited("init",this,arguments),this._dataItem=e,this._aTuplePartNormalized=[],this._bTupleHeaderNormalized=!1},getDecoration:function(){return this._dataItem&&this._dataItem.deco&&JSON.parse(JSON.stringify(this._dataItem.deco))},setDecoration:function(e){this._dataItem&&(this._dataItem.deco=e)},getValueDecoration:function(e){var t=this._dataItem&&this._dataItem.items&&this._dataItem.items[e];return t&&t.deco&&JSON.parse(JSON.stringify(t.deco))},setValueDecoration:function(e,t){var i=this._dataItem&&this._dataItem.items&&this._dataItem.items[e];i&&(i.deco=t)},clearDecoration:function(){this._dataItem.deco=null},getTuples:function(){return this._dataItem.items||[]},getTupleCount:function(){return this._dataItem&&this._dataItem.items?this._dataItem.items.length:0},getTuple:function(e){if(!this._dataItem||!this._dataItem.items)return null;if(e<0||e>=this._dataItem.items.length)return null;var n=this._dataItem&&this._dataItem.items?this._dataItem.items[e].t:[];return!0!==this._aTuplePartNormalized[e]&&(i.each(n,function(e,i){t.isRectifyNeeded(e)?(n[i]=t.getRectifiedData(e),t.normalizeData(n[i])):t.normalizeData(e)}.bind(this)),this._aTuplePartNormalized[e]=!0),n},getTupleHeader:function(){return this.getTupleHeaders()[0]},getTupleItemClassSetIndex:function(e){if(this._dataItem&&this._dataItem.items){var t=this._dataItem.items[e].itemClassSetIndex;return null!=t?t:0}return 0},getTupleHeaders:function(){var e=[];return i.each(this._getTupleHeaderObjects(),(function(t){e.push(t&&t.h||[])})),e},getTupleHeaderId:function(e){var t=this._getTupleHeaderObjects()[e||0];return t?t.id:null},getAggregate:function(){return this._getTupleHeaderObjects()[0].h[0].aggregate},_getTupleHeaderObjects:function(){if(!this._dataItem||!this._dataItem.itemClass)return null;var e=this._getNormalizeItemClasses();return!0!==this.isTupleHeaderNormalized&&(i.each(e,function(e){this._getSingleTupleHeaderObject(e)}.bind(this)),this.isTupleHeaderNormalized=!0),e},_getNormalizeItemClasses:function(){return i.isObject(this._dataItem.itemClass)&&!i.isArray(this._dataItem.itemClass)?[this._dataItem.itemClass]:this._dataItem.itemClass},_getSingleTupleHeaderObject:function(e){i.each(e.h,(function(e){t.isRectifyNeeded(e)&&(e=t.getRectifiedData(e)),t.normalizeData(e)}))},clipTuples:function(e){this._dataItem&&this._dataItem.items.length>0&&this._dataItem.items.length>e&&e>=0&&this._dataItem.items.splice(e,this._dataItem.items.length-e)},getNestedResultItemCount:function(){var e=0;return this._dataItem&&this._dataItem.itemClass&&this._dataItem.itemClass.h&&(e=this._dataItem.itemClass.h.length),e}});return n})),define("dashboard-analytics/widgets/livewidget/query/QueryResultData",["../../../lib/@waca/core-client/js/core-client/ui/core/Class","underscore","./QueryResultDataUtils","./QueryResultDataItem"],(function(e,t,i,n){"use strict";var a=e.extend({_rows:null,_index:-1,_oQueryResultData:null,init:function(e){this._index=-1,this._rows=e},setQueryResultDataRef:function(e){this._oQueryResultData=e},hasNext:function(){return this._rows&&this._rows.length>0&&this._index<this._rows.length-1},next:function(){this._index++},getValue:function(e){var i=this._getDatapoint(e);return t.isObject(i)&&void 0!==i.v?i.v:i},getResolvedValue:function(e){var n=this._getDatapoint(e);return t.isObject(n)&&void 0!==n.v?(i.normalizeData(n),n):this._oQueryResultData?this._oQueryResultData.getResultDataItem(e).getTuple(n):null},_getDatapoint:function(e){if(this._index>=0){var t=this._rows[this._index];if(t&&t.pt&&t.pt.length>0)return t.pt[e]}return null}}),o=e.extend({_resultData:null,_aQueryResultDataItems:null,init:function(e){o.inherited("init",this,arguments),this._resultData=e},getCellValue:function(e,t){var n,a=this._getCellRefByIndexes(e,t);return i.isRectifyNeeded(a)?n=i.getRectifiedData(a):void 0!==a.v||void 0!==a.value?(n=a,i.normalizeData(n)):n=this.getResultDataItem(t).getTuple(a)||[],n},_getCellRefByIndexes:function(e,t){var i=this._getDatapointEntry(e);if(i&&i.pt){var n=i.pt;if(n&&n.length>0&&void 0!==t&&t<n.length)return n[t]}return null},_getDatapointEntry:function(e){return e>=0&&this._resultData&&this._resultData.data?this._resultData.data[e]:null},getDatapoints:function(){return this._resultData.data},getDatapointCount:function(){return this._resultData&&this._resultData.data?this._resultData.data.length:0},resetDataItemArray:function(){this._generateDataItemArray()},_isValidDataItem:function(e){var i=function(e){return null!==e.h[0].d&&null!==e.h[0].u};if(t.isArray(e.itemClass)){var n=!0;return t.each(e.itemClass,(function(e){i(e)||(n=!1)})),n}return!!t.isObject(e.itemClass)&&i(e.itemClass)},_generateDataItemArray:function(){this._aQueryResultDataItems=[],this._resultData&&this._resultData.dataItems&&this._resultData.dataItems.length>0&&t.each(this._resultData.dataItems,function(e){this._isValidDataItem(e)&&this._aQueryResultDataItems.push(new n(e))}.bind(this))},getVersion:function(){return this._resultData?this._resultData.version:null},getResultDataItemCount:function(){return this._resultData?(t.filter(this._resultData.dataItems,function(e){return this._isValidDataItem(e)}.bind(this))||[]).length:0},getResultDataItem:function(e){return this._aQueryResultDataItems||this._generateDataItemArray(),this._aQueryResultDataItems[e]},getResultDataItems:function(){return this._resultData?(this._aQueryResultDataItems||this._generateDataItemArray(),this._aQueryResultDataItems):[]},getResultDataItemsNoValidation:function(){var e=[];return this._resultData.dataItems.forEach((function(t){e.push(new n(t))})),e},getDataItemIndex:function(e){var i=-1;return this._resultData&&t.find(this.getResultDataItems(),(function(t,n){if(t.getTupleHeaderId()===e)return i=n,!0})),i},getDataItem:function(e){return this.getResultDataItem(this.getDataItemIndex(e))},getDataRowIterator:function(){var e=new a(this._resultData.data);return e.setQueryResultDataRef(this),e},getResolvedDataRows:function(){for(var e=this.getDatapointCount(),t=this.getResultDataItemCount(),i=[],n=0;n<e;n++){i[n]=[];for(var a=0;a<t;a++)i[n].push(this.getCellValue(n,a))}return i},hasMoreData:function(){return!!this._resultData&&!(!this._resultData.hasPrev&&!this._resultData.hasNext)}});return o})),define("dashboard-analytics/visualizations/renderer/sequence/ResultDataReader",["../../../lib/@waca/core-client/js/core-client/ui/core/Class","../../../apiHelpers/SlotAPIHelper","dashboard-analytics/widgets/livewidget/query/QueryResultData"],(function(e,t,i){"use strict";var n=e.extend({init:function(e,t,i){n.inherited("init",this,arguments),this.visualization=t,this._createQueryResultData=i||this._createQueryResultData,this.plugins=e.getMatchingFeatures("ResultDataReaderPlugin",!0)},_createQueryResultData:function(e){return new i(e)},hasPlugins:function(){return this.plugins.length>0},onNewResults:function(e){this.plugins.forEach((function(t){return t.onNewResults&&t.onNewResults(e)}))},processData:function(e,t,i){return this.plugins.length?this._readResultData(e,t,i):[Promise.resolve({hasPlugins:!1})]},_readResultData:function(e,t,i){var n=e,a=this._buildRowHeaders(t),o=n.getRowCount();this.plugins.forEach((function(e){return e.onDataStart&&e.onDataStart(n,a)}));for(var s=0;s<o;s+=a.valueSlotMeasureCount)this.plugins.forEach((function(e){return e.onDataRow&&e.onDataRow(s)}));var r=[];return this.plugins.forEach((function(e){if(e.onDataDone){var t=e.onDataDone(i);t&&r.push(t)}})),r.length?r:[Promise.resolve({})]},_buildRowHeaders:function(e){var i=[],n=this.visualization.getSlots().getMappedSlotList(),a=e?n.filter((function(t){return-1!==t.getDefinition().getDatasetIdList().indexOf(e)})):n,o=1,s={itemIds:[],columnIndexes:[]},r=0;return a.forEach((function(e){var n=t.isMultiMeasuresValueSlot(e),a=e.isStacked()||n;"ordinal"===e.getDefinition().getType()&&e.getDataItemList().length>1&&n&&(o=e.getDataItemList().length),e.getDataItemList().forEach((function(e,t){var o=n?t:0;"fact"===e.getType()?i.push({dataItemUniqueId:e.getId(),index:r,valueItemIndex:o,aggregate:e.getAggregation(),multiMeasuresValueItem:n}):(s.itemIds.push(e.getColumnId()),a?0===t&&s.columnIndexes.push(r):s.columnIndexes.push(r)),r+=a?0:1})),r+=a?1:0})),{layerId:e,categoryItemHeaders:s,measureItemHeaders:i,valueSlotMeasureCount:o}}});return n})),define("dashboard-analytics/visualizations/renderer/sequence/ResultsDataReaderTask",["dashboard-analytics/visualizations/renderer/sequence/BaseTask","./ResultDataReader"],(function(e,t){"use strict";var i=e.extend({init:function(){i.inherited("init",this,arguments),this._initializeStep("resultsdatareader"),this.resultDataReader=new t(this.ownerWidget.getAPI(),this.content.getFeature("Visualization"))},process:function(e){return this._isStepComplete(e,"resultsdatareader")||!this.resultDataReader.hasPlugins()?Promise.resolve(e):this._processQueryResults(e.data,e).then(function(t){return this._completeStep(e,"resultsdatareader",t),e}.bind(this)).catch(function(e){throw this.showError("dwErrorRenderingVisualization"),e}.bind(this))},_processQueryResults:function(e,t){var i=this;if(this.resultDataReader.onNewResults(e),e&&e.getResult){var n=[];if(e.getQueryResultIdList().forEach((function(a){var o=e.getResult(a);n=n.concat(i._processOneQueryResult(o,a,t))})),n.length)return Promise.all(n)}return Promise.resolve({})},_processOneQueryResult:function(e,t,i){return this.resultDataReader.processData(e,t,i)},_processQueryResults_oldQueryAPI:function(e,t){var i=this;if(this.resultDataReader.onNewResults(e),e&&e.getQueryResults){var n=[];if(e.getQueryResults().forEach((function(e){n=n.concat(i._processOneQueryResult_oldQueryAPI(e,t))})),n.length)return Promise.all(n)}return Promise.resolve({})},_processOneQueryResult_oldQueryAPI:function(e,t){return this.resultDataReader.processData(e.data,e.getDataViewId&&e.getDataViewId(),t)}});return i})),define("dashboard-analytics/visualizations/renderer/sequence/SetDataTask",["dashboard-analytics/visualizations/renderer/sequence/BaseTask"],(function(e){"use strict";return e.extend({process:function(e){var t=this;return this._isStepComplete(e,"setData")?Promise.resolve(e):Promise.resolve().then((function(){if(t._completeStep(e,"setData",!0),!t.owner.getPropertyValue("newData")){var i=t.content.getFeature("DataQueryExecution").getCurrentQueryResults();i&&t._completeStep(e,"data",i)}return e})).catch(function(e){throw this.showError("dwErrorRenderingVisualization"),e}.bind(this))}})})),define("dashboard-analytics/visualizations/renderer/sequence/VisSpecTask",["./BaseTask"],(function(e){"use strict";return e.extend({process:function(e){var t=this;return this._isStepComplete(e,"visSpec")?Promise.resolve(e):Promise.resolve().then((function(){return t._completeStep(e,"visSpec",!0),e})).catch((function(e){throw t.showError("dwErrorRenderingVisualization"),e}))}})})),define("dashboard-analytics/visualizations/renderer/sequence/VisViewTask",["./BaseTask","../../../DynamicFileLoader"],(function(e,t){"use strict";return e.extend({process:function(e){var t=this.ownerWidget;if(t&&t.setLayoutProperties({pannable:!1,mobilePannable:!1,noRotate:!0,maximizable:!0}),this._isStepComplete(e,"visView"))return Promise.resolve(e);this.getRenderState().firstRenderComplete=!1;var i=this._rendererToView();return this._loadVisView(i).then(function(t){if(this._completeStep(e,"visView",t))return this._placeViewIntoDOM(t,e.widgetSize),this._initializeVisView(t).then((function(){return e}));t.remove()}.bind(this))},_loadVisView:function(e){return t.load([e]).then(function(e){return new(0,e[0])({visModel:this.visAPI,logger:this.logger,ownerWidget:this.ownerWidget,dashboardApi:this.dashboardApi,content:this.content})}.bind(this))},_initializeVisView:function(e){if("function"==typeof e.initialize){var t=e.initialize();if(t instanceof Promise)return t}return Promise.resolve()},_rendererToView:function(){var e=this.visAPI.getRenderer();return"Renderer"===e.substr(e.length-8)?e.substr(0,e.length-8)+"View":e},_placeViewIntoDOM:function(e,t){var i=this.ownerWidget;i.placeAt(e),i.applyCommonProperties(),i.dataSlotsView||e.resize(t)}})})),define("dashboard-analytics/visualizations/interactions/FilterAction",["../../lib/@waca/core-client/js/core-client/ui/core/Events","../../widgets/livewidget/nls/StringResources"],(function(e,t){"use strict";var i=null;return i=e.extend({init:function(e){var n=e.visualization,a=e.slot,o=e.index,s=e.dashboard,r=e.content,l=e.logger;i.inherited("init",this,arguments),this.visualization=n,this.slot=a,this.mapIndex=o,this.dashboard=s,this.content=r,this.logger=l;var c=a.getDataItemList()[this.mapIndex];this.itemContext={uniqueId:c.getId(),itemId:c.getColumnId(),itemName:c.getLabel(),dataType:c.getDataType(),aggregationType:c.getAggregation(),sourceId:this.visualization.getDataSource().getId()};var u=c.getMetadataColumn();u&&u.isNamedSet&&u.isNamedSet()&&(this.itemContext.isNamedSet=!0),this.renderModule=this.getEditorModuleName();var d=t.get("toolbarActionFilter"),h=this.dashboard.getFeature("Icons"),p=h.getIcon("common-filter");this.toolbarContribution=[{name:"filter",text:d,label:d,icon:p.id,type:"NextView",group:"filterAction",viewModule:this.renderModule,viewOptions:this.getViewOptions.bind(this)}]},getActionId:function(){return"filterAction"},getAvailableActions:function(){return this.toolbarContribution},getViewOptions:function(){return{height:300,width:212,slot:this.slot,mapIndex:this.mapIndex,logger:this.logger,itemContext:this.itemContext,dashboardApi:this.dashboard,content:this.content,visualization:this.visualization}},getEditorModuleName:function(){return"dashboard-analytics/dialogs/CommonViewWrapper"}})})),define("dashboard-analytics/visualizations/layers",["./definitions/providers/VIPR3Provider","./definitions/providers/LocalProvider","./vipr/VIPR","./vipr/properties/VIPRProperties","./recommender/BaseSmartsVisRecommenderWrapper","./recommender/SmartsRecommenderService","./renderer/vipr3/VIPRView","./renderer/summary/control/SummaryControl","./renderer/summary/SummaryProxyView","./renderer/infographic/InfographicView","./renderer/crosstab/CrosstabView","./renderer/crosstab/CrosstabControl","./renderer/grid/GridView","./renderer/grid/control/JQGrid","./renderer/indentedlist/IndentedListView","./renderer/indentedlist/control/IndentedListControl","./renderer/dataplayer/DataPlayerView","./renderer/kpi/KpiView","./renderer/kpi/control/KpiControl","./renderer/infographic/control/InfographicControl","./renderer/dropdown/DropdownView","./renderer/sequence/DataTask","./renderer/sequence/HighlighterTask","./renderer/sequence/RenderTask","./renderer/sequence/ResultsDataReaderTask","./renderer/sequence/SetDataTask","./renderer/sequence/VisSpecTask","./renderer/sequence/VisViewTask","./interactions/FilterAction"],(function(){})),define("dashboard-analytics/visualizationBundle",(function(){}));