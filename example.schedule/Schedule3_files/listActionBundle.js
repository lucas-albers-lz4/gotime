/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Content Apps
 * (C) Copyright IBM Corp. 2016, 2018
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

define("bi/content_apps/common/ui/list_actions/AddToMyPortalPagesAction",["bacontentnav/common/ui/list_actions/ListAction","bacontentnav/utils/ContentStoreObject","bacontentnav/nls/StringResource","../../../nls/StringResource","bi/commons/utils/BidiUtil"],function(t,e,n,i,o){"use strict";return t.extend({_isFeatureEnabled:!1,initialize:function(t){return t.glassContext.services.config.getConfigValue("ContentApps/enableMyPortalPages").then(function(t){this._isFeaturedEnabled="true"===t}.bind(this))},isItemVisible:function(t){var e=this.getSelectedContext(t);return this._isFeaturedEnabled&&e&&1===e.length&&this._isSupported(e[0])},_isSupported:function(t){return"pagelet"===e.getType(t)},execute:function(e){var n=e&&e.options&&e.options[0];if(n&&n.id){var t=n.id;return e.glassContext.services.userProfile.addPortalPage(t).then(function(){var t=i.get("toastDoneShortcuttingPortalPage",{nameOfItem:o.enforceTextDirection(n.name)});e.glassContext.appController.showToast(t)}.bind(this))}throw new TypeError("Cannot execute action. Unable to resolve id from options")}})}),define("bi/content_apps/common/ui/list_actions/EditPowerPlayInDesignMode",["bacontentnav/common/ui/list_actions/ListAction","bi/content_apps/nls/StringResource","bi/content_apps/utils/C10Utils"],function(t,e,n){"use strict";return t.extend({isItemVisible:function(t){var e=this.getSelectedContext(t);return!(!e||1!==e.length||!this._isSupported(e[0]))},_isSupported:function(t){return"powerPlay8Report"===t.type},execute:function(t){return n.openC10Studio(t.target.activeObject.aSelectedContext[0],t.glassContext,!0),Promise.resolve()}})}),define("bi/content_apps/common/ui/list_actions/LaunchableActionHandler",["bi/glass/core/Class","lodash"],function(t,e){"use strict";var n=t.extend({init:function(t){n.inherited("init",this,arguments),e.extend(this,t)},canExecute:function(t){return!0},doAction:function(t){var e=t.glassContext.gateway,n=t.target.activeObject.aSelectedContext[0].id;if(n&&e){var i=e+"/v1/disp",o=i+"?b_action=xts.run&m=portal/launch.xts&ui.gateway="+(window.location.protocol+"//"+window.location.host+i)+"&ui.tool=cd&ui.id="+n+"&ui.action=edit&launch.launchInWindow=true";return window.open(o)?Promise.resolve():Promise.reject(new Error("Could not launch a new tab."))}return Promise.reject(new Error("Selected artifact does not have a CM id or the gateway is not set"))}});return n}),define("bi/content_apps/common/ui/list_actions/LaunchC10Action",["bacontentnav/common/ui/list_actions/ListAction","bi/commons/utils/LegacyUtils","bi/content_apps/utils/C10Utils","lodash"],function(t,s,a,r){"use strict";return t.extend({isItemVisible:function(t){var e=this.getSelectedContext(t);return e&&1===e.length&&this._isSupported(e[0],t.glassContext)||!1},_isSupported:function(t,e){var n=a.typeToStudioMap[t.type];if("package"!==t.type||t.userInterfaces&&-1!==t.userInterfaces.indexOf("metricStudio")||(n=void 0),!t.ancestors)return!1;var i=r.last(t.ancestors).effectiveUserCapabilities;if(i){var o=a.typeToCapabilityMap[t.type];if(o&&-1===i.indexOf(o))return!1}return!(void 0===n||!s.canUseLegacyTool(e,n))},execute:function(t){return a.openC10Studio(t.target.activeObject.aSelectedContext[0],t.glassContext),Promise.resolve()}})}),define("bi/content_apps/common/ui/list_actions/ManageVersionsAction",["bacontentnav/common/ui/list_actions/ListAction","bi/content_apps/nls/StringResource"],function(t,n){"use strict";return t.extend({isItemVisible:function(t){var e=this.getSelectedContext(t);return!(!e||1!==e.length||!this._isSupported(e[0]))},_isSupported:function(t){return t.versionsSupported},execute:function(t){var e=this.getParentSlideout(t);this.slideout=t.glassContext.appController.showSlideOut({label:n.get("versions"),position:e?null:"right",parent:(t.target&&t.target.activeObject&&t.target.activeObject.renderFromReact?t.target.activeObject.parentSlideout:e)||null,width:"400",onHide:function(){this.slideout&&this.slideout.hide()}.bind(this),content:{module:"bi/content_apps/VersionsView",parentView:this.getListControl(t).contentView,objectInformation:this.getSelectedContext(t)[0],glassContext:t.glassContext}})}})}),define("bi/content_apps/common/ui/list_actions/RunAgentAction",["bacontentnav/common/ui/list_actions/ListAction","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentStoreObject","bacontentnav/common/ui/list_actions/DefaultAction","bi/content_apps/common/ui/list_actions/LegacyArtifactActionHandler"],function(t,e,n,i,s){"use strict";return t.extend({isItemVisible:function(t){var e=this.getSelectedContext(t);return!(!e||1!==e.length||"agentDefinition"!==e[0].type&&"agentDefinitionView"!==e[0].type)},_openUrl:function(t){return window.open(t)},execute:function(o){return this.execOptions=o,this.glassContext=o.glassContext,this.legacyHandler=new s,this.legacyHandler._getLegacyLaunchURL(o).then(function(t){var e=this.getSelectedContext(o)[0].searchPath;e=this.glassContext.getCoreSvc(".CAFEncoding").cafEncodeQSValue(encodeURIComponent(e));var n=t.launchURL.replace("b_action=cognosViewer&ui.action=view","b_action=xts.run&m=portal/runWithOptions/agentDefinition.xts&m_class=agentDefinition"),i="&m_obj="+e;n=n.concat(i),this._openUrl(n)}.bind(this))},_getDefaultAction:function(t){return new i(t)}})}),define("bi/content_apps/common/ui/list_actions/RunAsAction",["bacontentnav/common/ui/list_actions/ListAction","bi/authoring/plugins/rsContextMenuActions","bi/content_apps/nls/StringResource"],function(t,n,i){"use strict";return t.extend({_requiredProperties:{report:["canBurst","options"],reportView:["canBurst","base.canBurst","base.permissions","options"],interactiveReport:["canBurst"]},isItemVisible:function(t){if(t.glassContext&&t.glassContext.isDevInstall&&t.glassContext.isDevInstall()){this._selectedContext=this.getSelectedContext(t);var e=new n;return this._selectedContext&&1===this._selectedContext.length&&(e.isItemVisible(t)||(this._isJob="jobDefinition"===this._selectedContext[0].type))||!1}return!1},getRequiredPropertiesList:function(t){return this._requiredProperties[t.target.activeObject.aSelectedContext[0].type]},execute:function(t){var e=t.target.activeObject.slideout;this._slideout=t.glassContext.appController.showSlideOut({label:i.get("runAs"),position:e?null:"right",parent:e,width:"400",onHide:this._onSlideoutHide.bind(this),enableTabLooping:!0,content:{module:!0===this._isJob?"bi/content_apps/RunAsJobOptionsView":"bi/content_apps/RunAsOptionsView",objectInformation:t.target.activeObject.aSelectedContext[0],glassContext:t.glassContext,listControl:this.getListControl(t)}})},_onSlideoutHide:function(){this._slideout&&this._slideout.hide()}})}),define("bi/content_apps/common/ui/list_actions/SetPropertiesAction",["lodash","bacontentnav/common/ui/list_actions/TargetListAction","bacontentnav/utils/UIHelper"],function(o,t,s){"use strict";var a=["wsNotebookExternal","wsProject","externalContentTypeWs"];return t.extend({isItemVisible:function(t){var e=t.glassContext.getCoreSvc(".FeatureChecker");if(!(e&&e.checkValue("ca-home","newProperties","enabled"))){var n=this.getSelectedContext(t);if(!n||1<n.length||a.includes(n[0].type))return!1;var i=o.last(n[0].ancestors);return!i||!i.permissions||s.hasPermissions(i.permissions,["traverse"])}},_onSlideoutHide:function(){this._slideout.contentView.onHide().then(function(){this.propertiesSlideout&&this.propertiesSlideout.hide()}.bind(this))},execute:function(t){var e,n=t.target.activeObject.contentView;if(t.target.activeObject.renderFromReact&&n&&o.isFunction(n.showProperties))e=t.target.activeObject.aSelectedContext[0],n.showProperties(e,t);else{var i=this.getListControl(t).contentView;e=this.getSelectedContext(t)[0],i&&i.showProperties?i.showProperties(e):this._slideout=t.glassContext.appController.showSlideOut({label:"Properties",position:"right",parent:null,width:"400",enableTabLooping:!0,onHide:this._onSlideoutHide.bind(this),content:{module:"bi/content_apps/PropertiesPageView",parentView:this,objectInformation:e,glassContext:t.glassContext},resizable:!0})}}})}),define("bi/content_apps/common/ui/list_actions/ShortcutActionHandler",["bi/content_apps/common/ui/list_actions/LegacyArtifactDefaultActionHandlerBase","bacontentnav/common/ui/list_actions/DefaultAction","bacontentnav/utils/ContentServiceUrls","bacontentnav/utils/ContentStoreObject","lodash"],function(t,e,a,n,i){"use strict";var o=t.extend({init:function(t){o.inherited("init",this,arguments),i.extend(this,t)},canExecute:function(t){var e=t.target.activeObject.aSelectedContext[0];return!n.getDisabled(e)},_legacyClassATypes:["report","interactiveReport","reportTemplate","reportView","package","folder"],_isClassAType:function(t,e){return Promise.resolve().then(function(){return"pagelet"===e.oTargetType?t.glassContext.services.config.getConfigValue("ContentApps/enableMyPortalPages").then(function(t){return"true"===t}):-1<this._legacyClassATypes.indexOf(e.oTargetType)}.bind(this))},doAction:function(s){return Promise.resolve().then(function(){return this._getLegacyLaunchURL(s).then(function(i){var o=i.launchURL;return this._isClassAType(s,i).then(function(t){if(!o||t){var e=this._getStoreId(i);if("folder"===i.oTargetType){var n=s.target.activeObject.oListControl;n.contentView.openSlideoutView?n.contentView.openSlideoutView({selfUrl:a.getBaseObjectsURL()+"/"+e,renderFromReact:this.options.target.activeObject.oListControl.renderFromReact},!0):this.options.glassContext.openAppView("content",{content:{folder:e}})}else{if("package"!==i.oTargetType)return this._getDefaultAction({glassContext:this.options.glassContext,storeId:e,listControl:this.options.target.activeObject.oListControl}).execute();this._handlePackageAction(i,s)}}else{if(!this._openWindow(o))throw"Could not launch a new tab."}}.bind(this))}.bind(this))}.bind(this))},_getStoreId:function(t){var e=t.navFeed.feed.cm$targetStoreID;return e.substring(9,e.length-2)},_getSearchPath:function(t){return t.navFeed.feed.cm$targetSearchPath||""},_getDefaultAction:function(t){return new e(t)},_openWindow:function(t){return window.open(t)},_handlePackageAction:function(i,o){var t=o.target.activeObject.aSelectedContext[0];n.getTargetDefaultPortalAction(t,!0).then(function(t){if(t&&"run"===t)return this._navigateContributor(i,o);var e=this._getStoreId(i),n=o.target.activeObject.oListControl;n.contentView.openSlideoutView?n.contentView.openSlideoutView({selfUrl:a.getBaseObjectsURL()+"/"+e},!0):this.options.glassContext.openAppView("content",{content:{folder:e}})}.bind(this))},_navigateContributor:function(t,e){var n=e.target.activeObject.aSelectedContext,i=this._getStoreId(t),o=this._getSearchPath(t),s="/bi/v1/disp";if(t.launchURL&&(s=t.launchURL.substring(0,t.launchURL.indexOf("?"))),n.length){n[0].searchPath||t&&t.navFeed&&t.navFeed.feed&&(n[0].searchPath=t.navFeed.feed.cm$searchPath||"");var a={"ui.action":"new",b_action:"xts.run","launch.launchinWindow":!0,"ui.tool":"Contributor","ui.gateway":s,"ui.object":"",m:"portal/launch.xts","temp.prompt_package_target":"ui.object","so.id":i,"so.searchPath":o,"so.storeId":'storeID("'+i+'")'},r=s+"/"+i,c="";for(var l in a)c+=""===c?"?":"&",c+=l+"="+encodeURIComponent(a[l]);if(!this._openWindow(r+c))throw"Could not launch a new tab."}}});return o}),define("bi/content_apps/common/ui/list_actions/ShortcutContentAction",["bacontentnav/common/ui/list_actions/ManageContentAction","lodash"],function(t,o){"use strict";var s=["shortcut","wsNotebookExternal","wsNotebook","wsProject","externalContentTypeWs"];return t.extend({isItemVisible:function(t){var e=t&&t.target&&t.target.activeObject,n=e&&(e.targetSelectedContext||e.aSelectedContext);if(n){var i=this.getSelectedContext(t);i&&(n=!o.some(i,function(t){return s.includes(t.type)}))}return n},_getModalType:function(){return"shortcutDialog"}})}),define("bi/content_apps/common/ui/list_actions/TakeOwnershipAction",["lodash","bacontentnav/utils/ContentStoreObject","bacontentnav/utils/GlassContextHelper","bacontentnav/common/ui/list_actions/ListAction","bi/content_apps/nls/StringResource"],function(r,c,l,t,u){"use strict";return t.extend({isItemVisible:function(t){c.setGlassContext(t.glassContext);var e=this.getSelectedContext(t);if(!e)return!1;for(var n=!1,i=0;i<e.length;i+=1)if(c.hasPermissions(e[i],["setPolicy"])&&!c.isOwner(e[i])){n=!0;break}return n},isItemInTeamContext:function(t){var e=this.getSelectedContext(t);if(e&&e.length){var n=e[0];if(n.ancestors&&n.ancestors.length)for(var i=0;i<n.ancestors.length;i++)if(c.isTeamContent(n.ancestors[i]))return!0}return"teamContent"===t.target.activeObject.contentType},getRequiredPropertiesList:function(){return["owner"]},execute:function(t){var e=this.getSelectedContext(t);if(e){for(var n=!1,i=0,o=0;o<e.length;o+=1)if(c.isOwner(e[o]))i++;else if(c.hasPermissions(e[o],["setPolicy"])){n=!0;break}var s=this.getListControl(t).glassContext;if(!s&&t.glassContext&&(s=t.glassContext),n){var a=function(t){"ok"===t.btn&&this._onConfirm(s,e)}.bind(this);s.appController.Glass.showMessage(u.get("confirmTakeOwnershipMessage"),u.get("confirmTakeOwnership"),"info",["cancel","ok"],void 0,a)}else l.displayToast(s,u.get("toastTakeOwnership",{noOfItemsClaimed:i,noOfItems:e.length}))}},_onConfirm:function(n,i){for(var t,e,o=n.getCoreSvc(".Ajax"),s=[],a=0;a<i.length;a+=1)c.hasPermissions(i[a],["setPolicy"])&&(t=c.getSelfLink(i[a]),e=JSON.stringify({type:c.getType(i[a]),owner:[{type:"account",searchPath:"~"}]}),s.push(o.ajax({dataType:"json",type:"PUT",url:t,contentType:"application/json",data:e})));Promise.all(s).then(function(t){l.displayToast(n,u.get("toastTakeOwnership",{noOfItemsClaimed:t.length,noOfItems:i.length}));var e=this.getListControl().contentView;e&&r.isFunction(e.refresh)&&e.refresh()}.bind(this))}})}),define("js/content_apps/listActionBundle",function(){});