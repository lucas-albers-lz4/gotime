/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Dashboard
 * (C) Copyright IBM Corp. 2016, 2021
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function _defineProperties(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,_toPropertyKey(n.key),n)}}function _createClass(t,e,i){return e&&_defineProperties(t.prototype,e),i&&_defineProperties(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var i=t[Symbol.toPrimitive];if(void 0!==i){var n=i.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _createForOfIteratorHelperLoose(t,e){var i="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(i)return(i=i.call(t)).next.bind(i);if(Array.isArray(t)||(i=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var n=0;return function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,n=new Array(e);i<e;i++)n[i]=t[i];return n}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var i=arguments[e];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(t[n]=i[n])}return t}).apply(this,arguments)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}define("dashboard-analytics/features/widget/expandCollapseAction/ExpandCollapsePropertyProvider",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../lib/@waca/dashboard-common/dist/api/PropertiesProviderAPI","../../../widgets/livewidget/nls/StringResources"],(function(t,e,i){return function(){function n(t){this.content=t.content,this.visualization=t.features.Visualization,t.features.Properties.registerProvider(this.getAPI()),this.dashboard=t.dashboardAPI,this.featureChecker=this.dashboard&&this.dashboard.getGlassCoreSvc(".FeatureChecker")}var o=n.prototype;return o.getAPI=function(){return this._api||(this._api=t.createAPI(this,[e])),this._api},o.destroy=function(){this.content=null},o.getPropertyLayoutList=function(){return[]},o.getPropertyList=function(){var t=this,e=[],n=this.featureChecker&&this.featureChecker.checkValue("dashboard","PropertiesV2","enabled")?"chart":"visualization.chart";return this._isReady()&&this._isSupported()&&e.push({id:"expandCollapse",editor:{sectionId:n,uiControl:{type:"ToggleButton",defaultValue:!0,label:i.get("expandCollapse"),onChange:function(e,i){t.content.setPropertyValue(e,i)}}},onPropertyChange:{refresh:{data:!0}},defaultValue:!0}),e},o.reset=function(){},o._getModuleState=function(){var t=this.visualization.getDataSource();return t&&t.getState()},o._isReady=function(){return"ready"===this._getModuleState()},o._isSupported=function(){return this._isSupportedVisType(this.visualization)&&this._isOlap(this.visualization)},o._isSupportedVisType=function(t){return"Crosstab"===t.getType()},o._isOlap=function(t){var e=t.getSlots().getMappedSlotList(),i=e&&e[0]&&e[0].getDataItemList(),n=i&&i[0]&&i[0].getMetadataColumn();return n&&n.isOlapColumn()||!1},n}()})),define("dashboard-analytics/features/content/expandCollapse/api/ExpandCollapseAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.expand=function(){},e.collapse=function(){},t}()})),define("dashboard-analytics/features/content/expandCollapse/ExpandCollapse",["underscore","../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/ExpandCollapseAPI"],(function(t,e,i){return function(){function t(t){this.dashboard=t.dashboardAPI,this.content=t.content}var n=t.prototype;return n.getAPI=function(){return this._api||(this._api=e.createAPI(this,[i])),this._api},n.expand=function(t,e,i){var n,o=this._getDataItem(t),r=this.dashboard.getFeature("Transaction"),s=r.startTransaction();(n=o.getUnion().getDataItemList().length&&this._findNestedDataItem(o.getUnion().getDataItemList(),e)||o).getUnion().getDataItemList().find((function(t){return t.getDrillDownValue()===i}))||n.getUnion().addDataItem({itemId:o.getColumnId()},s).drillDown(i,s);r.endTransaction(s)},n.collapse=function(t,e,i){var n=this._getDataItem(t),o=this.dashboard.getFeature("Transaction"),r=o.startTransaction(),s=this._findNestedDataItem(n.getUnion().getDataItemList(),e)||n,a=this._findNestedDataItem(s.getUnion().getDataItemList(),i);s&&a&&(a.clearDrill(r),s.getUnion().removeDataItem(a.getId(),r)),o.endTransaction(r)},n._getDataItem=function(t){var e=this.content.getFeature("Visualization").getSlots().getDataItemList().find((function(e){return e.getId()===t}));if(!e)throw new Error("Expand Failed, Invalid DataItem");return e},n._findNestedDataItem=function(t,e){for(var i=Array.from(t),n=null;i.length>0&&!n;){var o=i.shift(),r=o.getUnion().getDataItemList();i.push.apply(i,r||[]),o.getDrillDownValue()===e&&(n=o)}return n},t}()})),define("dashboard-analytics/features/widget/suppressionAction/SuppressionPropertyProvider",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../lib/@waca/dashboard-common/dist/api/PropertiesProviderAPI","../../../widgets/livewidget/nls/StringResources"],(function(t,e,i){return function(){function n(t){this.content=t.content,this.content&&this.content.getFeature("Properties").registerProvider(this.getAPI()),this.dashboard=t.dashboardAPI,this.featureChecker=this.dashboard&&this.dashboard.getGlassCoreSvc(".FeatureChecker")}var o=n.prototype;return o.getAPI=function(){return this._api||(this._api=t.createAPI(this,[e])),this._api},o.destroy=function(){this.content=null},o.getPropertyLayoutList=function(){return[]},o.getPropertyList=function(){var t=this,e=this.featureChecker&&this.featureChecker.checkValue("dashboard","PropertiesV2","enabled")?"chart":"visualization.chart",n=[];return this._isSupported()&&n.push({id:"suppression",editor:{sectionId:e,uiControl:{type:"ToggleButton",defaultValue:"rowsAndColumns",label:i.get("suppression"),onChange:function(e,i){var n=!1===i?"none":"rowsAndColumns";t.content.setPropertyValue(e,n)}}},onPropertyChange:{refresh:{data:!0}},defaultValue:"rowsAndColumns"}),n},o.reset=function(){},o._isSupported=function(){var t=this.content.getFeature("Visualization");return t&&this._isSupportedVisType(t)},o._isSupportedVisType=function(t){return"Crosstab"===t.getType()||"List"===t.getType()},o._isOlap=function(t){var e=t.getSlots().getMappedSlotList(),i=e[0]&&e[0].getDataItemList()[0];return i&&i.getMetadataColumn().isOlapColumn()||!1},n}()})),define("dashboard-analytics/features/widget/lassoSelectAction/LassoSelectAction",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../lib/@waca/dashboard-common/dist/api/ContentActionsProviderAPI"],(function(t,e){return function(){function i(t){var e=t.features;e&&(this.features=e,this.dashboard=e.API,this.lasso=e.Lasso,e.ContentActions.registerProvider("lasso",this.getAPI()))}var n=i.prototype;return n.getAPI=function(){return this._api||(this._api=t.createAPI(this,[e])),this._api},n.destroy=function(){this.dashboard=null},n.getContentActionList=function(t){var i=this;if(this._supportAction(t)&&this.content){var n=this.content.getFeature("VisualizationGesture");return this.lasso.getContributions().map((function(t){return{id:t.id,name:t.name,label:t.label,icon:i.features.Icons.getIcon(t.icon)&&i.features.Icons.getIcon(t.icon).id,type:"Button",section:e.ACTION_SECTION.SELECTION_DATA,order:50,selected:!!n&&(n.getLassoSelectState()&&n.getLassoViewId()===t.id),actions:{apply:i.lasso.toggleLassoSelect.bind(i.lasso,t.id)}}}))}return[]},n._supportAction=function(t){if(!this._isInteractionEnabled("lassoSelect"))return!1;if(1!==t.length)return!1;if(this.dashboard.getMode()===this.dashboard.MODES.EDIT_GROUP)return!1;if(this.content=this.dashboard.getCanvas().getContent(t[0]),!this.content)return!1;var e=this.content.getFeature("Visualization");if(!e||e.getDefinition().getState().getError()||!e.getSlots().isMappingComplete())return!1;var i=this.content.getFeature("state");return!Boolean(i&&!!i.getError())&&("widget.live"===this.content.getType()&&this._isSupportedVisualizationType(e.getType())&&!e.getDefinition().getProperty("isSchematic")&&!e.getDefinition().getProperty("isCustomVis"))},n._isSupportedVisualizationType=function(t){return!(-1!==["Singleton","DataPlayer","DropdownList","Crosstab","List","Hierarchy","KPI","Pie","Wordle","Area","Dial","Bullet","DecisionTree","Sunburst","Spiral","DriverAnalysis","visualizationPreview","snippetList"].indexOf(t))},n._isInteractionEnabled=function(t){var e=this._getInteractionConfig();return!e.hasOwnProperty(t)||-1===[!1,"false"].indexOf(e[t])},n._getInteractionConfig=function(){return this.dashboard.getAppConfig("interactions")||{}},i}()})),define("dashboard-analytics/features/content/dataPointActions/api/DataPointActionsProviderAPI",[],(function(){return function(){function t(){}return t.prototype.getDataPointActionList=function(){},t}()})),define("dashboard-analytics/features/content/common/contextualGridAction/ContextualGridAction",["../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../../widgets/livewidget/nls/StringResources","../../dataPointActions/api/DataPointActionsProviderAPI","../../../../lib/@waca/dashboard-common/dist/api/ContentActionsProviderAPI"],(function(t,e,i,n){return function(){function o(t){var e=t.dashboardAPI,i=t.content,n=t.features;this.dashboard=e||n&&n.API,this.features=n,i?(this.content=i,n&&n.DataPointActions.registerProvider("contextualGridAction",this.getAPI())):n&&n.ContentActions.registerProvider("contextualGridAction",this.getAPI())}var r=o.prototype;return r.getDataPointActionList=function(t,e){var i=this.content;return!e.noFilters&&this.dashboard.getMode()===this.dashboard.MODES.EDIT?this._getContributionList(i,!0,!0):[]},r._supportsRelationshipsView=function(){return this.dashboard.getMode()===this.dashboard.MODES.EDIT&&(this.dashboard.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","RelationshipsView","enabled")||this.dashboard.getConfiguration("showRelationships"))},r._supportAction=function(t,e){if(!this._supportsRelationshipsView()){var i=this.dashboard.getCanvas().getPropertyValue("showDataGridInConsumeMode"),n=this._isInteractionEnabled("showData")&&(this.dashboard.getMode()===this.dashboard.MODES.EDIT||i);if(t&&t.length>1||!n)return!1;if(e.getFeature("state").getError())return!1}return!0},r.getContentActionList=function(t){var e=t[0],i=this.dashboard.getCanvas().getContent(e);return this._supportAction(t,i)?this._getContributionList(i,!1):[]},r._isSupportedFromVisDefinition=function(t){var e=t.getFeature("Visualization");if(!e)return!1;var i=e.getDefinition();return!i.getProperty("isMultilayersWidget")&&!i.getProperty("noDataQuery")&&"dashboardTemplate"!==this.dashboard.getApplicationName()},r._popUpDataTray=function(t){void 0===t&&(t=!0);var e=this.dashboard.getDashboardCoreSvc(".CanvasExtensions");if(e){var i=e.splitPaneView.getSplitter(),n="story"===this.dashboard.getApplicationName()?1:0;return i.toggleItemWithIndexAndBroadcast(n,!0,{sender:t?"showDataBehindVisAction":"relationships"})}return Promise.resolve()},r._getContributionList=function(t,i,o){void 0===o&&(o=!1);var r=[],s=(this.features.Icons||this.features["Dashboard.Icons"]).getIcon("common-querySubject"),a=this._isSupportedFromVisDefinition(t);return(a||this._supportsRelationshipsView())&&r.push({name:"contextualGridAction",label:e.get("showDataBehindVizLabel"),text:o?e.get("showDataBehindVizLabel"):void 0,icon:s.id,type:"Button",group:"ShowDataBehindVizAction",closeOnActionApplied:i,section:n.ACTION_SECTION.SELECTION_DATA,order:100,actions:{apply:this._popUpDataTray.bind(this,a)}}),r},r._isInteractionEnabled=function(t){var e=this.dashboard.getAppConfig("interactions")||{};return!e.hasOwnProperty(t)||-1===[!1,"false"].indexOf(e[t])},r.getAPI=function(){return t.createAPI(this,[i,n])},o}()})),define("dashboard-analytics/features/content/slotActions/api/SlotActionsProviderAPI",[],(function(){return function(){function t(){}return t.prototype.getSlotActionList=function(){},t}()})),define("dashboard-analytics/features/widget/jumpToAction/JumpToAction",["underscore","../../../util/JumpToActionHelper","../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../content/slotActions/api/SlotActionsProviderAPI","../../content/dataPointActions/api/DataPointActionsProviderAPI","../../../lib/@waca/dashboard-common/dist/api/ContentActionsProviderAPI","../../../widgets/livewidget/nls/StringResources"],(function(t,e,i,n,o,r,s){return function(){function a(t){var e=t.content,i=t.dashboardAPI,n=t.features;this._dashboard=n&&n.API||i,this._features=n,e?(this._content=e,this._content.getFeature("SlotActions").registerProvider("jumpToAction",this.getAPI()),this._content.getFeature("DataPointActions").registerProvider("jumpToAction",this.getAPI())):n&&n.ContentActions.registerProvider("jumpToAction",this.getAPI())}var l=a.prototype;return l.destroy=function(){this._dashboard=null,this._content=null},l.getSlotActionList=function(t,e,i){return void 0===i&&(i={}),Array.isArray(e)&&1!==e.length||"cell_edge_row"===i.area||"cell_edge_column"===i.area?[]:this._getContribution()},l.getDataPointActionList=function(t,e){return this._supportDataPointAction(e)?this._getContribution(t,e):[]},l._supportDataPointAction=function(t){return!t.noDrillthrough},l._supportAction=function(t){return 1===t.length&&this._dashboard.getMode()!==this._dashboard.MODES.EDIT_GROUP&&(this._content=this._dashboard.getCanvas().getContent(t[0]),this._content&&"widget.live"===this._content.getType())},l.getContentActionList=function(t){return this._supportAction(t)?(this._content=this._dashboard.getCanvas().getContent(t[0]),this._getDrillThroughToolbarContribution()):[]},l._getTargetInfo=function(t,i,n){var o=this._dashboard.getFeature("DrillThroughService").getDrillThroughModelApiSync().getDrillDefinitionEntries(t);return e.getJumpToTargets({content:t,drillDefinitions:o,selections:n,dashboardApi:this._dashboard,sourceId:i})},l._getContribution=function(t){var e,i=[],n=this._content.getFeature("Visualization").getDataSource().getId();(e=this._getTargetInfo(this._content,n,t)).targets.length>0&&(i=[this._getContributionAction({oTargetsInfo:e,isDataPointSelection:!0,sourceId:n,selections:t})]);return i},l._isAutoGrouped=function(t){var e=t.getSlots().getDataItemList(),i=!1;return e.forEach((function(t){t.getBinning()&&(i=!0)})),i},l._getDrillThroughToolbarContribution=function(){var t=this._content.getFeature("Visualization");if(t&&t.getDefinition()&&t.getDefinition().getType()&&!this._isAutoGrouped(t)){var e=t.getDataSource();if(!e||!this._isInteractionEnabled("drillThrough"))return[];var i=e.getId(),n=this._getTargetInfo(this._content,i),o=n.targets&&!n.targets.length,r=this._dashboard.getFeature("DashboardState").getUiState().authoring;return!r&&o?[]:[this._getContributionAction({sourceId:i,oTargetsInfo:n,isAuthoringMode:r,withoutText:!0})]}return[]},l._getContributionAction=function(e){var i=this;void 0===e&&(e={});var n,o=e.oTargetsInfo,a=!!e.isAuthoringMode,l=!!e.isDataPointSelection,c=(this._features.Icons||this._features["Dashboard.Icons"]).getIcon("visualizations-drillthrough_16");n=(l||!a)&&o.targets&&1===o.targets.length;var u={name:"jumpTo",label:s.get("toolbarActionJumpTo"),icon:c.id,text:e.withoutText?void 0:s.get("toolbarActionJumpTo"),section:r.ACTION_SECTION.SELECTION_DATA,order:40,viewOptions:{content:this._content,sourceId:e.sourceId,jumpToTargets:function(t,e,n){return i._getTargetInfo(t,e,n)},isDataPointSelection:l,dashboardApi:this._dashboard,selections:e.selections}};return u=n?t.extend(u,{type:"Button",closeOnActionApplied:!0,actions:{apply:this._performDirectJumpTo.bind(this,o)}}):t.extend(u,{type:"NextView",viewModule:"dashboard-analytics/drill-through/jumpTo/JumpToViewReact"})},l._performDirectJumpTo=function(e){if(e&&t.isArray(e.targets)&&e.targets.length){var i=e.targets[0].getId(),n=e.targetsMap[i];n&&n.jumpTo()}},l._isInteractionEnabled=function(t){var e=this._dashboard.getAppConfig("interactions")||{};return!e.hasOwnProperty(t)||-1===[!1,"false"].indexOf(e[t])},l.getAPI=function(){return this._api||(this._api=i.createAPI(this,[n,r,o])),this._api},a}()})),define("dashboard-analytics/features/widget/suppressionAction/SuppressionAction",["../../../widgets/livewidget/nls/StringResources","jquery","../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../lib/@waca/dashboard-common/dist/api/ContentActionsProviderAPI"],(function(t,e,i,n){return function(){function o(t){var e=t.features;e&&(this.dashboardApi=e.API,this._features=e,e.ContentActions.registerProvider("suppressionAction",this.getAPI()))}var r=o.prototype;return r.getAPI=function(){return this._api||(this._api=i.createAPI(this,[n])),this._api},r.destroy=function(){this.dashboardApi=null},r.isEnabled=function(t){var e=this._getSelectedContent(),i=e&&e.getFeature("SuppressionPropertyProvider");return 1===t.length&&i&&i.getPropertyList().length&&this.dashboardApi.getMode()!==this.dashboardApi.MODES.EDIT_GROUP},r.getContentActionList=function(t){var e=this._features.Icons.getIcon("iconSuppresion");return this.isEnabled(t)?[{name:"suppression",label:this._getLabel(),icon:e.id,type:"Button",section:n.ACTION_SECTION.SELECTION_VIZ_FORMAT,order:40,actions:{apply:this._toggleSuppress.bind(this,t)}}]:[]},r._getSelectedContent=function(){return this.dashboardApi.getCanvas().getSelectedContentList()[0]},r._getLabel=function(e){return"rowsAndColumns"===(e=e||this._getValue())?t.get("disableSuppression"):t.get("enableSuppression")},r._getValue=function(){return this._getSelectedContent().getPropertyValue("suppression")},r._toggleSuppress=function(t,i){var n="rowsAndColumns"===this._getValue()?"none":"rowsAndColumns",o=e(i.currentTarget).find(".suppressBtnToggle").addBack(),r=this._getLabel(n),s=o.find("span");s&&s.text(r),this._getSelectedContent().setPropertyValue("suppression",n)},o}()})),define("dashboard-analytics/features/dashboard/actions/SearchAction",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/dashboard-common/dist/api/ContentActionsProviderAPI"],(function(t,e,i){var n={list:!0,hierarchy2:!0,hierarchy3:!0};return function(){function o(e){var n=e.features;this._features=n,this._dashboard=n.API,this._api=t.createAPI(this,[i]),n.ContentActions.registerProvider("searchAction",this._api)}var r=o.prototype;return r.getAPI=function(){return this._api},r.getContentActionList=function(t){var n=[];if(this._getSelectedContent(t)){var o=t[0],r=this._dashboard.getCanvas().getContent(o),s=this._features.Icons.getIcon("searchIcon");this._supportAction(t,r)&&(n=[{name:"searchAction",label:e.get("search"),icon:s.id,section:i.ACTION_SECTION.SELECTION_DATA,order:20,type:"NextView",viewModule:"dashboard-analytics/visualizations/search/DataWidgetSearchView",viewOptions:{height:50,width:242,content:r}}])}return n},r._supportAction=function(t,e){var i=!1,o=this._features.DashboardState.getUiState(),r=e.getFeature("Visualization");if(r&&!o.eventGroups){var s=r.getDefinition().getId();i=r.getSlots().isMappingComplete()&&n[s]}return i},r._getSelectedContent=function(t){return 1===t.length},o}()})),define("dashboard-analytics/features/content/slotActions/aggregationTypeAction/AggregationTypeAction",["underscore","../../../../widgets/livewidget/nls/StringResources","../../../../dataSources/metadata/MetadataColumn","../../../../apiHelpers/SlotAPIHelper","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../api/SlotActionsProviderAPI","../../../../lib/@waca/dashboard-common/dist/api/ContentActionsProviderAPI"],(function(t,e,i,n,o,r,s){return function(){function a(t){var e=t.features,i=t.content;this.content=i,this._features=e,this._canvas=e.Canvas,this._slotActions=e.SlotActions,this._contentActions=e.ContentActions,this._slotActions&&this._slotActions.registerProvider("aggregationTypeAction",this.getAPI()),this._contentActions&&this._contentActions.registerProvider("aggregationTypeAction",this.getAPI())}var l=a.prototype;return l._getSlotById=function(t,e){return e.getSlots().getSlot(t)},l._isMultiMeasuresSeriesSlot=function(t,e){return void 0===e&&(n.isMultiMeasuresSeriesSlot(t)||n.isMultiMeasuresValueSlot(t))},l._supportAction=function(t,e,i,n){var o=n.getDataSource();if(!t||!e||this._isMultiMeasuresSeriesSlot(t,i)||null===o.getMetadataColumn(e.getColumnId()))return!1;var r=e.getMetadataColumn()&&e.getMetadataColumn().getAggregationMode();if("static"===r&&"fact"===e.getType())return!1;var s=t.getDefinition()&&t.getDefinition().getType();return"static"!==r&&("ordinal"===s||"any"===s)},l.getContentActionList=function(e){if(1===e.length){var i=this._features.DashboardState.getUiState(),n=e[0],o=this._canvas.getContent(n).getFeature("Visualization");if(o){var r=o.getDefinition().getProperty("actions"),s=t.find(r,(function(t){return"AggregationTypeAction"===t.id}));if(s&&!0!==i.eventGroups)return this.getContribution(o,s.slot,void 0,!0)}}return[]},l.getContribution=function(t,i,n,o){var r=n;if(!i||Array.isArray(n)&&n.length>1)return[];null==n?n=0:Array.isArray(n)&&1===n.length&&(n=n[0]);var a=this._getSlotById(i,t),l=a.getDataItemList(),c=l.length>n?l[n]:null;if(!c||!this._supportAction(a,c,r,t))return[];var u=this.getViewState(i,n,t),d=(this._features.Icons||this._features["Dashboard.Icons"]).getIcon("dashboard-aggregate"),h={name:"aggregationTypeAction",label:e.get("toolbarActionAggregationType"),type:"SubMenu",icon:d.id,useIcon:o,section:s.ACTION_SECTION.SELECTION_DATA,view:{module:"dashboard-analytics/lib/@waca/dashboard-common/dist/ui/dialogs/CommonSelectItemsDialog",state:u},actions:{apply:this.applyAggregation.bind(this,t,i,n)}};return o&&(h.placement="bottom",h.order=90,h.type="NextView"),[h]},l.getSlotActionList=function(t,e){var i=this.content.getFeature("Visualization");return this.getContribution(i,t,e)},l.applyAggregation=function(t,e,i,n){var o="auto"===n?void 0:n;this._getSlotById(e,t).getDataItemList()[i].setAggregation(o)},l._getPossibleItems=function(n,o,r,s){var a,l=this._getSlotById(n,s),c=l.getDataItemList()[o],u=null;if(l&&c){var d=c.getMetadataColumn();u=d&&d.getDefaultAggregation()}a="attribute"===r?"any"===l.getDefinition().getType()?i.SUPPORTED_AGGREGATION_FOR_ATTRIBUTE:t.without(i.SUPPORTED_AGGREGATION_FOR_ATTRIBUTE,i.AGGREGATION_TYPE_MAP.none):i.SUPPORTED_AGGREGATION_FOR_FACT;var h=[];if(t.each(a,(function(t){var i={id:t,localizedString:e.get(t)};h.push(i)})),"fact"===r){var g={id:"auto",localizedString:e.get("defaultAggregation_auto",{aggregationType:e.get(u)})};h.push(g)}return h},l._getCurrentSelectedItem=function(t,e,i){var n=t.getDataItemList()[e],o=n.getAggregation();return"fact"===this._getEffectiveColumnTypeForAggregation(t,e,i)&&n.hasDefaultAggregation()?"auto":o},l._getEffectiveColumnTypeForAggregation=function(t,e){var i=t.getDataItemList()[e].getMetadataColumn();return i&&i.getType()},l.getViewState=function(t,e,i){var n=this._getSlotById(t,i);if(!n)return null;var o=this._getEffectiveColumnTypeForAggregation(n,e);return void 0===o?null:{height:270,width:140,getCurrentSelectedItem:this._getCurrentSelectedItem.bind(this,n,e,i),possibleItems:this._getPossibleItems(t,e,o,i)}},l.getAPI=function(){return this._api||(this._slotActions&&(this._api=o.createAPI(this,[r])),this._contentActions&&(this._api=o.createAPI(this,[s]))),this._api},a}()})),define("dashboard-analytics/features/dashboard/actions/CrosstabActions",["./crosstab/SwapRowColumnAction","./crosstab/HideShowSummariesAction"],(function(t,e){return function(i){var n=i.features,o=new t(n);n.ContentActions.registerProvider("crosstabSwap",o.getAPI());var r=new e(n);n.ContentActions.registerProvider("crosstabHideShowSummaries",r.getAPI())}})),define("dashboard-analytics/features/dashboard/actions/filterDock/FilterDockAction",["../../../../widgets/livewidget/nls/StringResources","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../../lib/@waca/dashboard-common/dist/api/ContentActionsProviderAPI"],(function(t,e,i){return function(){function n(t){var n=t.features;this._dashboard=n.API,this._contentActions=n.ContentActions,this._features=n,this._api=e.createAPI(this,[i]),this._contentActions.registerProvider("filterDock",this.getAPI())}var o=n.prototype;return o.getAPI=function(){return this._api},o.getContentActionList=function(){var e=[],n=this._getCanvasExtensions();if(n){var o=n.getExtension("filterDockCollapseControl");if(o){var r=this._features.Icons.getIcon("filterEdit32");e=[{name:"filterDock",baseClass:"toolbar",section:i.ACTION_SECTION.PANEL,order:20,label:t.get("filterIconLabel_Single"),text:t.get("filterIconLabel_Single"),className:"buttonWithText",icon:r.id,type:"ToggleButton",checked:o.isExpanded(),disabled:this._buttonRendered.bind(this),action:this._expandFilterDock.bind(this),offAction:this._collapseFilterDock.bind(this),decoratorView:{viewModule:"dashboard-analytics/features/dashboard/actions/filterDock/ActiveFilterView",viewOptions:{dashboardAPI:this._dashboard,canvas:this._features.Canvas}}}]}}return e},o._getCanvasExtensions=function(){return this._canvasExtensions||(this._canvasExtensions=this._dashboard.getDashboardCoreSvc(".CanvasExtensions")),this._canvasExtensions},o._buttonRendered=function(){var t=this._getCanvasExtensions();if(!t)return!1;var e=t.getExtension("filterDockCollapseControl"),i=t.getExtension("filterDock");return e.$el.addClass("toolbarControlled"),i.$el.addClass("toolbarControlled"),this._features.DashboardState.getUiState().eventGroups},o._expandFilterDock=function(){this._dashboard.triggerDashboardEvent("filterDock:expand")},o._collapseFilterDock=function(){this._dashboard.triggerDashboardEvent("filterDock:collapse")},n}()})),define("dashboard-analytics/features/widget/changeVisTypeAction/api/ChangeVisTypeActionAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.openDialog=function(){},e.removeDialog=function(){},e.setVisType=function(){},t}()})),define("dashboard-analytics/widgets/livewidget/visSwitcher/VisChangerFlyoutView",["../../../lib/@waca/core-client/js/core-client/ui/core/View","../../../lib/@waca/core-client/js/core-client/utils/Utils","../nls/StringResources","jquery","underscore","react-dom","react","@ba/ba-ui-carbon-toolkit","dashboard-core/js/app/util/ErrorUtils","@ba/ba-ui-carbon"],(function(t,e,i,n,o,r,s,a,l,c){var u=a.Accordion,d=a.AccordionItem,h=a.SVGIcon,g=a.Multilinetruncatedtext,p=a.TruncatedText,f=a.ProgressIndicator,m=c.ClickableTile,v="recommended",_="all",I=function(t){function e(e){var i;return(i=t.call(this,e)||this).state=_extends({},e.state),i.settings=e.settings,i.onSelect=e.onSelect||function(){},i.state.checkMarkIcon=e.state.iconsFeature.getIcon("CheckmarkSVG"),i}_inheritsLoose(e,t);var n=e.prototype;return n.renderPropItem=function(t,e){var i=this,n=this.state.selectedId===t.id,o=n?"true":"false",r="prop-item";n&&(r+=" selected");var a=t.name&&-1!==t.name.indexOf(" "),l=this.state.svgsMap[t.icon]?this.state.svgsMap[t.icon].id:"visualizations-changeVisualization";return s.createElement("div",{role:"group",className:r},s.createElement(m,{className:"vis-type-tile",onSelect:function(){return i.onSelect(t,e)},handleKeyDown:function(n){"Enter"!==n.key&&"Space"!==n.key||i.onSelect(t,e)}},s.createElement("div",{tabIndex:0,className:"prop-icon vis",role:"button","data-id":t.id,"walkme-data-id":t.id,"aria-label":t.name,"aria-pressed":o},s.createElement(h,{iconId:l,height:24,width:24}),s.createElement(h,{className:"checkMarkIcon",iconId:this.state.checkMarkIcon.id,height:14,width:14}),s.createElement("div",{className:"prop-icon-label-container"},a?s.createElement(g,{className:"prop-icon-label",value:t.name,numLines:2}):s.createElement(p,{className:"prop-icon-label",value:t.name})))))},n.loadVisRowItems=function(t,e){var i=this,n=[];return t.forEach((function(t){n.push(i.renderPropItem(t,e))})),n},n._renderLoading=function(){return s.createElement("div",{className:"vis-changer-progressIndicator"},s.createElement(f,{size:"normal",variant:"circle"}))},n._getVisRowItems=function(t,e){var i=t.items,n=t.isRecommended,o=this.loadVisRowItems(i,n),r=e?{"max-height":e}:{};return s.createElement("div",{className:"visChangerRow",style:r},o)},n._getRecommendedAccordionItem=function(){var t={items:this.state.recommended.items,isRecommended:!0};return this.state.recommended.isLoading?this._renderLoading():this._getVisRowItems(t,this._getMaxSectionHeight(v))},n._getAllVisAccordionItem=function(){var t={items:this.state.all.items,isRecommended:!1};return this.state.all.isLoading?this._renderLoading():this._getVisRowItems(t,this._getMaxSectionHeight(_))},n._getSectionLabel=function(t){return(this.settings&&this.settings[t]||{}).label},n._getSectionOpenState=function(t){return this.state.expandState.hasOwnProperty(t)?this.state.expandState[t]:!1!==(this.settings&&this.settings[t]||{}).expand},n._getMaxSectionHeight=function(t){return(this.settings&&this.settings[t]||{}).maxHeight},n._renderAccordions=function(){var t=this,e=this._getRecommendedAccordionItem(),n=this.state.isConsumer,o=this._getSectionLabel(v)||i.get("recommended_visualizations");if(n)return s.createElement(u,null,s.createElement(d,{itemName:o,icon:"left",open:this._getSectionOpenState(v)},e));var r=this._getSectionLabel(_)||i.get("all_visualizations");return s.createElement(u,{icon:"right"},s.createElement(d,{itemName:o,icon:"left",open:this._getSectionOpenState(v),onChange:function(e){return t.state.onItemChange(e,v)}},e),s.createElement(d,{itemName:r,icon:"left",open:this._getSectionOpenState(_),onChange:function(e){return t.state.onItemChange(e,_)}},this._getAllVisAccordionItem()))},n.render=function(){return this._renderAccordions()},e}(s.Component),b=t.extend({_loadSVGFileMap:function(){var t=this;if(this.viewState.svgsMap&&o.keys(this.viewState.svgsMap).length>0)return Promise.resolve(this.viewState.svgsMap);if(this.viewState.svgsMap={},this._getAllAvailableVisualizations(),this.viewState.all&&this.viewState.all.items){var e=this.viewState.iconsFeature;if(this.viewState.all.items.forEach((function(i){var n=e.getIcon(i.icon);t.viewState.svgsMap[i.icon]=n})),-1===Object.keys(this.viewState.svgsMap).indexOf("visualizations-changeVisualization")){var i=e.getIcon("visualizations-changeVisualization");this.viewState.svgsMap["visualizations-changeVisualization"]=i}return Promise.resolve(this.viewState.svgsMap)}},init:function(t){this.el=n("<div class='visChangerContainer'/>"),b.inherited("init",this,arguments),this.applyAction=t&&t.actions&&t.actions.apply;var e=t&&t.state?t.state:t;o.extend(this,e||{}),this.iconsFeature=this.dashboard.getFeature("Icons"),this.settings=this.dashboard.getFeature("DashboardSettings").get("visChanger")||{},this.el.style.width=this.settings.width||this.el.style.width,this._initializeViewState()},_elementExists:function(){var t=!1,e=!1,i=this.el;return i&&(i.length&&(t=i.length>0),i.children&&(e=0!==i.children)),i&&(e||t)},remove:function(){return this._elementExists()&&r.unmountComponentAtNode(this.el),this.viewState=null,b.inherited("remove",this,arguments)},setFocus:function(){this.$(".vis").first().focus()},_processVisualizations:function(t){var e=this,i=[];return o.each(t,(function(t){e.viewState.visualizationMap[t.id||t.getId()]=t,i.push({id:t.id||t.getId(),type:t.type||t.getType&&t.getType(),name:t.caption||t.getLabel(),visId:t.id||t.getId(),caption:t.caption||t.getLabel(),icon:t.icon||t.getIcon(),disabled:t.disabled||!1,properties:t.properties||[]})})),i},_preload:function(){return this.viewState.visualizationMap=this.viewState.visualizationMap||{},this._loadSVGFileMap()},_getAllAvailableVisualizations:function(){var t=this.dashboard.getFeature("VisDefinitions").getList().filter((function(t){return!t.getProperty||!0!==t.getProperty("recommendOnly")&&!0!==t.getProperty("isCustomVis")&&!0!==t.getProperty("isSchematic")})),e=this._processVisualizations(t);this.viewState.all.items=o.sortBy(e,(function(t){return t.name})),this.viewState.all.isLoading=!1},_getRecommendedVisualizations:function(){var t=this;return this.content.getFeature("Visualization.SmartsRecommender").getRecommendedVisualizations().then((function(e){if(null!==t.viewState){var i=t._processVisualizations(e),n=6;t.viewState.selectedId&&n++,t.viewState.recommended.items=i.slice(0,n),t.viewState.recommended.isLoading=!1,t.viewState.recommended.items.forEach((function(e){t.viewState.svgsMap[e.icon]||(t.viewState.svgsMap[e.icon]=t.viewState.iconsFeature.getIcon(e.icon))}))}}))},_initializeViewState:function(){this.viewState={recommended:{items:[],isLoading:!0},all:{items:[],isLoading:!0},svgsMap:null,selectedId:this._getSelectedVizId(),visualizationMap:null,iconsFeature:this.iconsFeature,expandState:this.expandState,onItemChange:this._onItemChange.bind(this)}},_setSectionOpenState:function(t,e){this.expandState[e]=t},_onItemChange:function(t,e){this._setSectionOpenState(t,e);var i=this._getOffScreenHeight();if(i>0){var o=n(this.el).parents(".popover-content"),r=Math.max(0,o.position().top-i);o&&o.css({top:r})}},_getOffScreenHeight:function(){var t=this._getDocumentElement().scrollHeight,i=e.getCurrentWindow().innerHeight;return t>i?t-i:-1},_getDocumentElement:function(){return document.documentElement},_getSelectedVizId:function(){var t=this.content.getPropertyValue("visId.alias");if(!t){var e=this.content.getFeature("Visualization");t=this.currentVis&&"auto"===this.currentVis||e&&!e.isTypeLocked()?"auto":e.getDefinition().getId()}return t},_resetRecommendedViewState:function(){this.viewState.recommended={items:[],isLoading:!0},this._elementExists()&&this.reactComponents&&r.unmountComponentAtNode(this.el)},_showLoading:function(){this._resetRecommendedViewState(),this.reactComponents=r.render(s.createElement(I,{state:this.viewState,settings:this.settings,onSelect:this._selectVis.bind(this)}),this.el)},_showReactSections:function(){this.reactComponents.setState(JSON.parse(JSON.stringify(this.viewState)))},_render:function(t){var e=this;return o.extend(this,t||{}),this._isConsumer(),this._showLoading(),this._preload().then((function(){e._showReactSections()})).then(this._getRecommendedVisualizations.bind(this)).then((function(){e._showReactSections()}))},_isConsumer:function(){var t=this.dashboard&&this.dashboard.getCurrentContentView(),e=t&&t.glassContext;this.viewState&&e&&(this.viewState.isConsumer=!l.hasCapability(e,"canAuthorDashboard"))},render:function(t){return this._render(t),Promise.resolve()},_selectVis:function(t,e){if(this.viewState.selectedId!==t.id){var i=t.type||t.id,n="auto"!==i?this.viewState.svgsMap[t.icon]:void 0;this.applyAction(i,{recommendedCategory:e?"Recommended":"Other",properties:t.properties,expandState:this.expandState,icon:n}),this._toolbar&&(this.remove(),this._toolbar.hide())}},preload:function(){return Promise.resolve()},renderCallBack:function(t){this._toolbar=t}});return b})),define("dashboard-analytics/features/widget/changeVisTypeAction/ChangeVisTypeAction",["underscore","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/ChangeVisTypeActionAPI","../../../widgets/livewidget/visSwitcher/VisChangerFlyoutView","../../../lib/@waca/dashboard-common/dist/api/ContentActionsProviderAPI"],(function(t,e,i,n,o,r){return function(){function s(t){var e=t.features;e&&(this.dashboard=e.API,this.features=e,this.transaction=e.Transaction,this.expandState={},this.typeToIconMapping={},e.ContentActions.registerProvider("changeVisTypeAction",this.getAPI()))}var a=s.prototype;return a.destroy=function(){this.dashboard=null,this.api=null},a.getAPI=function(){return this.api||(this.api=i.createAPI(this,[n,r])),this.api},a._supportAction=function(t,e){var i=Boolean(1===t.length),n=Boolean(e&&"widget.live"===e.getType()),o=this.dashboard.getMode()!==this.dashboard.MODES.EDIT_GROUP,r=e&&e.getFeature("state"),s=Boolean(r&&!!r.getError());return i&&n&&o&&this._isInteractionEnabled("changeVis")&&!s},a.getContentActionList=function(i){var n=this,o=this.dashboard.getCanvas().getContent(i[0]);if(this._supportAction(i,o)){var s,a=o.getFeature("Visualization"),l=this._getVisualizationIcon(a),c={height:202,width:402,content:o,dashboard:this.dashboard,expandState:this.expandState},u={name:"changeVisTypeAction",label:e.get("visChange"),icon:l.id,section:r.ACTION_SECTION.SELECTION_DATA,order:10,type:"NextView",view:{module:"dashboard-analytics/widgets/livewidget/visSwitcher/VisChangerFlyoutView",state:c},actions:{apply:this._changeVisType.bind(this,o)}};return t.extend(u,{text:a.getDefinition().getLabel(),className:"buttonWithText",callbacks:{registerCallback:function(t){s=function(){n._handleChangeType(t,a)},a.on("change:type",s)},unregisterCallback:function(){a.off("change:type",s)}}}),[u]}return[]},a._handleChangeType=function(t,e){t.updateState({text:e.getDefinition().getLabel(),icon:this._getVisualizationIcon(e)})},a._getSchematicIcon=function(t,e){return"com.ibm.vis.schematicsPreview"===t?e.getIcon("svgFile"):e.getIcon("schematicVisual")},a._getCustomVisIcon=function(t,e){return"visualizationPreview"===t?e.getIcon("codeFile32"):e.getIcon("customVisual")},a._getOutOfBoxVisIcon=function(t,e,i){var n=t.getType()||"";return this.typeToIconMapping[n]||i.getIcon(t&&t.getIcon())},a._getVisualizationIcon=function(t){var e=t.getDefinition().getProperty("isSchematic"),i=t.getDefinition().getProperty("isCustomVis"),n=t.getDefinition().getId(),o=this.features.Icons;return(e?this._getSchematicIcon(n,o):i?this._getCustomVisIcon(n,o):this._getOutOfBoxVisIcon(t.getDefinition(),n,o))||o.getIcon("visualizations-changeVisualization")},a._isInteractionEnabled=function(t){var e=this.dashboard.getAppConfig("interactions")||{};return!e.hasOwnProperty(t)||-1===[!1,"false"].indexOf(e[t])},a._trackSetType=function(t,e,i){if(void 0===i&&(i={}),i.recommendedCategory&&this.features.LiveWidgetSegment){var n={category:i.recommendedCategory,visualization:t.getFeature("Visualization"),content:t,info:{visId:e}};this.features.LiveWidgetSegment.track(n)}},a._isUnsupportedVisType=function(t,i){var n=this.features.VisDefinitions.getByType(i);if(n&&!1===n.getProperty("supportsOLAP")){var o=t.getFeature("Visualization.olapContentHelper");if(o&&o.containsOlap())return this.features.Notification.setMessage(e.get("visualizationDoesNotSupportOLAP")),!0}return!1},a.setVisType=function(t,e,i){var n=this.dashboard.getCanvas().getContent(t);if(n&&!this._isUnsupportedVisType(n,e)){var o=n.getFeature("Visualization.SmartsRecommender");o&&o.setType(e,i)}},a._changeVisType=function(e,i,n){var o=this;if(void 0===n&&(n={}),!this._isUnsupportedVisType(e,i)){this.expandState=n.expandState||{},this.typeToIconMapping[i]=n.icon;var r,s=e.getFeature("Visualization.SmartsRecommender");if(s)return this._trackSetType(e,i,n),t.isEmpty(n.properties)||(r=this.transaction.startTransaction(),t.each(n.properties,(function(t,i){e.setPropertyValue(i,t,r)}))),s.setType(i,r).then((function(){e.getFeature("Toolbar.internal").refresh()})).finally((function(){r&&o.transaction.endTransaction(r)}))}},a.openDialog=function(t,e){return e.actions={apply:this._changeVisType.bind(this,e.content)},this.visChangeView||(this.visChangeView=new o(e)),this.visChangeView.render(t)},a.removeDialog=function(){this.visChangeView&&(this.visChangeView.remove(),this.visChangeView=null)},s}()})),define("dashboard-analytics/features/content/dataPointActions/api/DataPointActionsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.registerProvider=function(){},e.getDataPointActionList=function(){},t}()})),define("dashboard-analytics/features/content/dataPointActions/DataPointActions",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/DataPointActionsAPI","underscore"],(function(t,e,i){return function(){function n(){this.api=t.createAPI(this,[e]),this.providers={}}var o=n.prototype;return o.registerProvider=function(t,e){this.providers[t]=e},o.getDataPointActionList=function(t,e){var n=[];for(var o in this.providers){var r=this.providers[o];if(r.getDataPointActionList){var s=null;try{s=r.getDataPointActionList(t,e)}catch(t){console.log(t)}i.isEmpty(s)||n.push.apply(n,s)}}return n},o.getAPI=function(){return this.api},n}()})),define("dashboard-analytics/features/content/elementStyleActions/api/ElementStyleActionsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.registerProvider=function(){},e.getElementStyleActionList=function(){},t}()})),define("dashboard-analytics/features/content/elementStyleActions/ElementStyleActions",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/ElementStyleActionsAPI","underscore"],(function(t,e,i){return function(){function n(){this.api=t.createAPI(this,[e]),this.providers=[]}var o=n.prototype;return o.registerProvider=function(t,e){this.providers[t]=e},o.getElementStyleActionList=function(t,e){var n=e&&e.actionsToKeep||[],o=[];for(var r in this.providers){var s=this.providers[r];if(s.getElementStyleActionList){var a,l=null;try{l=s.getElementStyleActionList(t)}catch(t){console.log(t)}if(!i.isEmpty(l))(a=o).push.apply(a,l)}}return n.length&&(o=o.filter((function(t){return i.contains(n,t.id||t.group||t.name)||"delete"===t.name}))),o},o.getAPI=function(){return this.api},n}()})),define("dashboard-analytics/extensions/visualization-crosstab/dashboard-features/CrosstabPropertyCallbacks",["underscore","../../../widgets/livewidget/nls/StringResources"],(function(t,e){return function(){function t(){}var i=t.prototype;return i.getAPI=function(){return this},i._checkValidInput=function(t,i){return isNaN(t)?this._buildValidateResponse(!1,e.get("prop_sizeInputNonNumericValue")):parseInt(t)<i?this._buildValidateResponse(!1,e.get("prop_sizeValueShouldBeHigher",{value:i})):this._buildValidateResponse(!0)},i.checkValidRowHeightInput=function(t,e){return this._checkValidInput(e,24)},i.checkValidColumnWidthInput=function(t,e){return this._checkValidInput(e,24)},i._buildValidateResponse=function(t,e){return{isValid:t,message:e}},t}()})),define("dashboard-analytics/view/features/content/liveWidgetDOM/api/DOMProviderAPI",[],(function(){return function(){function t(){}return t.prototype.getUIJSON=function(){},t}()})),define("dashboard-analytics/view/features/content/liveWidgetDOM/GridDOMProvider",["jquery","./api/DOMProviderAPI","../../../../lib/@waca/dashboard-common/dist/core/APIFactory"],(function(t,e,i){return function(){function n(t){this._domNode=t.features.ContentViewDOM.getNode(),this.liveWidgetDOM=t.features.LiveWidgetDOM,this.visualization=t.features.Visualization;var e=this.visualization.getType();"Crosstab"!==e&&"List"!==e||this.liveWidgetDOM.registerProvider(this.getAPI())}var o=n.prototype;return o.getAPI=function(){return this._api||(this._api=i.createAPI(this,[e])),this._api},o.getUIJSON=function(){var e=[];t(this._domNode).find(".grid-fixed-row-cell, .top-left-grid-cell").each((function(i,n){var o=t(n);e.push({value:o.text(),useValue:o.attr("useValue")&&o.attr("useValue").split("->"),color:o.css("color"),row:Number(o.attr("row")),col:Number(o.attr("col")),isMeasure:"true"===o.attr("measure"),isSummary:o.hasClass("summary")})}));var i=[];t(this._domNode).find(".grid-fixed-column-cell").each((function(e,n){var o=t(n);i.push({value:o.text(),useValue:o.attr("useValue").split("->"),color:o.css("color"),row:Number(o.attr("row")),col:Number(o.attr("col")),isMeasure:"true"===o.attr("measure"),isSummary:o.hasClass("summary")})}));var n=[];return t(this._domNode).find(".grid-data-cell").each((function(e,i){var o=t(i),r=o.find("svg > use"),s=o.css("background-color"),a=s.split(","),l=o.attr("tuple")?o.attr("tuple").split("->"):void 0;n.push({value:o.find(".dashboard-text-cell").text(),tuple:l,color:o.css("color"),"background-color":s,shape:r.attr("xlink:href"),row:Number(o.attr("row")),col:Number(o.attr("col")),isSummary:o.hasClass("summary"),opacity:parseFloat(a[a.length-1].split(")")[0])})})),{cols:e,rows:i,values:n}},n}()})),define("dashboard-analytics/extensions/dataBehindTheVis/content-features/api/DataBehindTheVisAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getData=function(){},e.export=function(){},t}()})),define("dashboard-analytics/extensions/dataBehindTheVis/content-features/DataBehindTheVis",["underscore","../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/DataBehindTheVisAPI","../../../lib/@waca/dashboard-common/dist/utils/ContentUtil","../../../apiHelpers/SlotAPIHelper","../../../features/content/dataQueryExecution/DataQueryUtils","../../../dataSources/nls/StringResources"],(function(t,e,i,n,o,r,s,a){return function(){function l(t){var e=t.content,i=t.features;this.content=e,this.features=i}var c=l.prototype;return c.getAPI=function(){return this._api||(this._api=i.createAPI(this,[n])),this._api},c.export=function(t){var e=this;return void 0===t&&(t=!0),this.getData(t).then((function(t){return e.csvExport.export(t.title,[t.headers],t.cells)}))},c.destroy=function(){this.dashboardApi=null},c.getData=function(t){var e=this;return void 0===t&&(t=!0),this._queryForData(t).then((function(i){var n=e._filterDataWithSelections(i);return _extends({title:e._getTitle(),isAggregated:!!t},n)}))},c._queryForData=function(t){var e=this;if(void 0===t&&(t=!0),this.visualization.getDataSource()){t=!!t;var i=this._getColumnIdsFromUnprojectedFilters(),n=!this._isMultiMeasureVisualization(this.visualization)&&i&&i.length>0,o=this._getQueryDataset(),r=this.visualization.getSlots().isMappingComplete();return(n?this._getDataFromQuery(o,i,t):this._getDataFromExecution(o,t,r)).then((function(t){return e._getProcessedHeadersAndCells(t)}))}return Promise.resolve({headers:[],cells:[]})},c._getTitle=function(){return e.get("visExportFileName")},c._filterDataWithSelections=function(e){if(e.cells){var i=[],n=this.dataPointSelections.getSelections();n&&n.length&&(t.each(e.cells,(function(e){t.each(n,(function(n){var o;n.categories&&(o=t.every(n.categories,(function(i){return function(i){return t.some(e,(function(t){return t.value===i.value}))}(i)}))),o&&-1===i.indexOf(e)&&i.push(e)}))})),e.cells=i)}return e},c._getColumnIdsFromUnprojectedFilters=function(){var e=this,i=this._getVisibleDataItems(),n=[],o=this.visualization.getDataSource();return t.each(this._getFilterInfo(),(function(r){t.each(r,(function(r){e._getUnProjectedItemsFromFilterEntry(t.pluck(i,"itemId"),r,n,o)}))})),n},c._isMultiMeasureVisualization=function(){return!!t.find(this.visualization.getSlots().getMappedSlotList(),(function(t){return r.isMultiMeasuresSeriesSlot(t)}))},c._getQueryDataset=function(){var t=this.visualization.getDefinition(),e=t.getDatasetList();return e&&1===e.length?e[0].id:t.getDefaultDatasetId()},c._getDataFromQuery=function(t,e,i){var n=this.visualization.getDataSource(),o=i?this.queryService.TYPE.DEFAULT:this.queryService.TYPE.DETAIL,r=this.queryService.createQuery(o);r.setDataSource(n.getId()),r.addDataItems(this._getDataItems(t)),r.addColumns(e);var a=s.removeForecastFilters(this._getFilterInfo()),l=a.localFilters;return l.push.apply(l,a.selectionFilters.concat(a.globalFilters)),r.addFilters(l),r.executeQuery()},c._getDataFromExecution=function(e,i,n){if(i){var o=this.queryExec.getCurrentQueryResults();return!n||t.isEmpty(o)?Promise.resolve(!1):o.getImplType&&o.getInterfaceType?Promise.resolve(o.getResult(e)):e?Promise.resolve(o.getQueryResultByDataViewId(e).getQueryResult()):Promise.resolve(o.getDefaultQueryResult().getQueryResult())}return this.queryExec.executeQueries("detail").then((function(t){return t.getResult(e)}))},c._getVisibleDataItems=function(){var e=[],i=[],n=this.visualization.getSlots();return t.each(n.getMappedSlotList(),(function(n){(t.each(n.getDataItemList(),function(t,o){r.isMultiMeasuresSeriesOrValue(n,o)||(e.push({id:t.getId(),itemId:t.getColumnId()}),i.push(t.getId()))}.bind(this)),i.length>1&&n.isStacked())&&n.getDefinition().getDatasetIdList().forEach((function(t){e.push({id:n.getId(),nest:i,layerId:t})}))})),e},c._getUnProjectedItemsFromFilterEntry=function(e,i,n,o){var r=i.itemId||i.columnId,s=o.getMetadataColumn(r);s&&"Filter"===s.getObjectType()||(r?-1===e.indexOf(r)&&-1===n.indexOf(r)&&n.push(r):t.each(i.values,function(t){this._getUnProjectedItemsFromFilterEntry(e,t,n,o)}.bind(this)))},c._getFilterInfo=function(){var t=this.visualization.getDataSource(),e=this.visualization.getLocalFilters().getFilterList(),i=this.dashboard.getAppConfig("pageContainerType");return{localFilters:e,globalFilters:this.globalFilters.getFilterList({origin:"filter",sourceId:t.getId(),scope:o.getPageContent(this.content,i).getId(),eventGroupId:this.eventGroups.getGroupId(this.content.getId())}),selectionFilters:this.globalFilters.getFilterList({origin:"visualization",sourceId:t.getId(),scope:o.getPageContent(this.content,i).getId(),eventGroupId:this.eventGroups.getGroupId(this.content.getId()),eventSourceId:this.content.getId()})}},c._getProcessedHeadersAndCells=function(e){var i=this,n=[],o=[],r=this._getMetadataColumnList();if(e){var s=this._getVisibleAndFilterColumnIds(r),a=e.getResultItemList(),l=[];t.each(a,function(e,i){t.each(e.getDataItemList(),(function(t){-1!==s.indexOf(t.getColumnId())?n.push(t.getLabel()):l.push(i)}))}.bind(this));for(var c=[],u=this._getColumnCount(a),d=0;d<e.getRowCount();d++){for(var h=!1,g=[],p=function(n){if(-1===l.indexOf(n)){var o=e.getValue(d,n),r=o.type;Array.isArray(o)?(g.push.apply(g,o.map((function(t){return t.toString=i._getCellValue.bind(i,t),t}))),0===d?c[n]=t.pluck(o,"ln"):h=h||t.some(o,(function(t,e){return c[n][e]<t.ln}))):(o.toString=i._getCellValue.bind(i,o),g.push(o)),h=h||r===(e.VALUE_TYPE&&e.VALUE_TYPE.SUMMARY)}},f=0;f<u;f++)p(f);h||o.push(g)}}return{headers:n,cells:o}},c._getVisibleAndFilterColumnIds=function(e){var i=[];t.each(e,(function(t){t&&!t.isMissing()&&i.push(t.getId())}));var n=this._getColumnIdsFromUnprojectedFilters();return i.push.apply(i,n),this._isMultiMeasureVisualization(this.visualization)&&i.push.apply(i,["_multiMeasuresValue","_multiMeasuresSeries"]),i},c._getMetadataColumnList=function(){var e=this.visualization.getSlots();return t.map(e.getDataItemList(),(function(t){return t.getMetadataColumn()}))},c._getColumnCount=function(e){return t.chain(e).map((function(e){var i=t.every(e.getDataItemList(),(function(t){return t.getAggregation()&&"fact"===t.getType()})),n=e.getDataItemList(),o=e.getValue(0);return i&&n&&o&&n.length>e.getValue(0).length?e.getDataItemList():e})).flatten().value().length},c._getCellValue=function(t){var e=this._isCellValueMeasure(t),i=e?t.value:t.label;return null===i?a.get("nullValueText"):e?Math.round(100*i)/100:i},c._isCellValueMeasure=function(e){return e&&t.isUndefined(e.label)},c._getDataItems=function(t){var e=this.visualization.getSlots();if(t){var i=e.getMappingInfoList(),n=[];return i.forEach((function(e){-1!==e.slot.getDefinition().getDatasetIdList().indexOf(t)&&n.push(e.dataItem)})),n}return e.getDataItemList()},c._getItemContext=function(){var t=this.dashboard.getAppConfig("pageContainerType");return this.visualization?{origin:"visualization",sourceId:this.visualization.getDataSource()&&this.visualization.getDataSource().getId(),scope:o.getPageContent(this.content,t).getId(),eventGroupId:this.eventGroups.getGroupId(this.content.getId()),eventSourceId:this.content.getId(),_strictMatch:!0}:null},_createClass(l,[{key:"dashboard",get:function(){return this.features["Dashboard.API"]}},{key:"csvExport",get:function(){return this.features["Dashboard.CsvExport"]}},{key:"queryService",get:function(){return this.features["Dashboard.QueryService"]}},{key:"globalFilters",get:function(){return this.features["Dashboard.GlobalFilters"]}},{key:"eventGroups",get:function(){return this.features["Dashboard.EventGroups"]}},{key:"visualization",get:function(){return this.features.Visualization}},{key:"dataPointSelections",get:function(){return this.features.DataPointSelections}},{key:"queryExec",get:function(){return this.features.DataQueryExecution}}]),l}()})),define("dashboard-analytics/extensions/visualization-kpi/dashboard-features/KpiPropertyCallbacks",["underscore","jquery","../../../widgets/livewidget/nls/StringResources"],(function(t,e,i){return function(){function n(){}var o=n.prototype;return o.getAPI=function(){return this},o._isSlotMapped=function(t){return(t&&t.getDataItemList()||[]).length>0},o._getDataItem=function(t,e){return void 0===e&&(e=0),t.getDataItemList()[e]},o.preRenderBaseLabelProperty=function(e){var i={},n=e.getFeature("Visualization").getSlots().getSlot("actual");if(this._isSlotMapped(n)){var o=this._getDataItem(n);i.placeHolderText=t.escape(o.getLabel())}else i.placeHolderText="";return i},o.preRenderTargetLabelProperty=function(e){var n={},o=e.getFeature("Visualization").getSlots().getSlot("goal");if(this._isSlotMapped(o)){var r=this._getDataItem(o);n.placeHolderText=t.escape(r.getLabel())}else n.placeHolderText=t.escape(i.get("kpiDefaultTargetLabel"));return n},o._getFormatForSlot=function(t,e){var i=this._getDataItem(e);return i&&i.getFormat()||{}},o.preRenderTargetValueProperty=function(e){var n={},o=e.getFeature("Visualization.internal"),r=o.getSlots().getSlot("goal"),s=o.getSlots().getSlot("actual");if(this._isSlotMapped(r))n.readOnly=!0,n.disabled=!0,n.placeHolderText=t.escape(i.get("kpiManualTargetSlotFilled")),n.value="";else if(s){var a=this._getFormatForSlot(o,s),l=Math.max(a.maximumFractionDigits||0,a.minimumFractionDigits||0);l&&(n.decimalPlaces=l)}return n},o.preRenderValueSizeProperty=function(t,e){var n={options:e.options,removeProperty:!0};return"auto"===n.options[0].value&&(n.options[0].label=i.get("kpiAutoValueSize")),n},o.onChangeValueSizeProperty=function(t,e,i){},o.validateTargetValueProperty=function(t,n){return{isValid:e.isNumeric(n)||!n,message:i.get("kpiNonNumericTarget")}},n}()})),define("dashboard-analytics/view/features/content/liveWidgetDOM/KPIDOMProvider",["jquery","./api/DOMProviderAPI","../../../../lib/@waca/dashboard-common/dist/core/APIFactory"],(function(t,e,i){return function(){function n(t){this._domNode=t.features.ContentViewDOM.getNode(),this.liveWidgetDOM=t.features.LiveWidgetDOM,this.visualization=t.features.Visualization,"KPI"===this.visualization.getType()&&this.liveWidgetDOM.registerProvider(this.getAPI())}var o=n.prototype;return o.getAPI=function(){return this._api||(this._api=i.createAPI(this,[e])),this._api},o.getUIJSON=function(){return{base:this._retrieve("base"),target:this._retrieve("target"),time:this._retrieveTime()}},o._retrieveTime=function(){var e="div.dataview.kpi-widget > div.kpi-widget-content > div.kpi-widget-sparkline.widget svg.rootSvg",i=t(this._domNode).find(e+" > g.chart > g.content > rect"),n=t(this._domNode).find(e+" > g.chart > g.content path.line-element");if(i.length>0&&n.length>0)return{width:i.attr("width"),height:i.attr("height"),color:n.css("stroke")}},o._retrieve=function(e){var i="div.dataview > div.kpi-widget-content > div.kpi-widget-value.kpi-widget-"+e+"-value.labeled-value > div.labeled-value",n=t(this._domNode).find(i+"-label > span");if(n.length>0){var o=t(this._domNode).find(i+"-value > span"),r=t(this._domNode).find(i+"-value > svg > use");return{label:{text:n.text(),color:n.css("color")},value:{text:o.text(),color:o.css("color"),shape:r.attr("xlink:href")}}}},n}()})),define("dashboard-analytics/visualizations/recommender/LegacyMapMappingManager",["../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(t){"use strict";return t.extend({init:function(t){this.visualization=t,this.unmappedColumns=null},_getColumnType:function(t){var e=t.getTaxonomyList()?t.getTaxonomyList()[0]:null;return e&&"cGeoLocation"===e.getClass()?"location":t.getType()},_getSlotTypeForColumn:function(t){return{fact:"ordinal",attribute:"category",location:"location"}[this._getColumnType(t)]},_setExistingMappingInfo:function(t){this.visualization.getSlots().getMappingInfoList().forEach((function(e){t[e.slot.getId()]=[e.dataItem.getColumnId()]}))},mapColumnsToSlots:function(t,e,i){var n={};i&&this._setExistingMappingInfo(n);for(var o=t.getSlotList().filter((function(t){return!t.getProperty("multiplier")&&!n[t.getId()]})),r=0;r<o.length;r++){var s=o[r],a=s.getId();if(!e.length)break;var l=this._findBestMatchingColumnForSlot(s,e);n[a]=[l.getId()],e=e.filter((function(t){return t.getId()!==l.getId()}))}return this.unmappedColumns=e,n},getUnmappedColumns:function(){if(this.unmappedColumns.length)return this.unmappedColumns},_findBestMatchingColumnForSlot:function(t,e){var i,n=this;if(0!==e.length){if("location"===t.getSubType()&&(i=e.find((function(t){return"location"===n._getColumnType(t)}))))return i;var o=t.getType();return(i=e.find(function(t){return this._getSlotTypeForColumn(t)===o}.bind(this)))||e[0]}}})})),define("dashboard-analytics/visualizations/recommender/VisRecommenderBindingFallback",["../../lib/@waca/core-client/js/core-client/ui/core/Class","underscore"],(function(t,e){"use strict";var i=t.extend({init:function(t){i.inherited("init",this,arguments),this.visualization=t},destroy:function(){i.inherited("destroy",this,arguments)},assignUnboundColumns:function(t,i){var n=this,o=t.unbound.slice(0);return e.each(o,(function(o){o=n.visualization.getDataSource().getMetadataColumn(o);var r=e.map(i,(function(e){return n._rankSlot(e,t.slots,o)})),s=Math.min.apply(Math,r);if(s>0&&s<9){var a=e.indexOf(r,s),l=i[a].getId(),c=o.getId();t.slots[l]?t.slots[l].push(c):t.slots[l]=[c],t.unbound.splice(e.indexOf(t.unbound,c),1)}})),t},_rankSlot:function(t,e,i){return e[t.getId()]?this._slotHasCapacity(t,e)?this._slotMatchesColumn(t,i)?t.isOptional()?6:5:t.isOptional()?8:7:9:this._slotMatchesColumn(t,i)?t.isOptional()?2:1:t.isOptional()?4:3},_slotHasCapacity:function(t,e){var i=t.getId(),n=t.getMaxItems();return!(n&&n>-1)||(e[i]?e[i].length:0)<n},_slotMatchesColumn:function(t,e){var i=t.getType(),n=e.getType();return"any"===i||("ordinal"===i&&"fact"===n||"category"===i&&"attribute"===n)}});return i})),define("dashboard-analytics/extensions/smarts-recommender/impl/Utils",["../../../apiHelpers/SlotAPIHelper","../../../visualizations/recommender/IRUtils"],(function(t,e){"use strict";return function(){function i(){}return i.translateTopBottom2IR=function(t){var i={};return i.filterId=t.id,i.columnId=t.itemId,i.topBottomType=e.IRTopBottomType(t.selection.topBottom.type),i.method=e.IRTopBottomMethod(t.selection.topBottom.type),i.domainSize=t.selection.topBottom.value,t.selection.topBottom.context&&(i.byColumn=t.selection.topBottom.context.itemId),i.type="TOP_BOTTOM",i},i.getTopBottomItems=function(t){var e=t.getSlots().getMappedSlotList();if(e&&e.length){var n=[];return e.filter((function(t){return t&&!t.getDefinition().isHidden()})).forEach((function(t){i.filterInvalidDataItems(t.getDataItemList()).forEach((function(t){var e=t.getTopBottom();if(e&&e.context){var o=i.translateTopBottom2IR({id:t.getId(),itemId:t.getColumnId(),selection:{topBottom:e}});n.push(o)}}))})),n}},i.getUnboundColumnsIds=function(t,e){var n=t.getSlots().getMappingInfoList().filter((function(t){return t.indexInSlot>-1})),o=(n=e&&e.length?n.filter((function(t){return-1!==e.indexOf(t.slot.getId())})):n).length?n.map((function(t){return t.dataItem})):t.getSlots().getDataItemList();return i.filterInvalidDataItems(o).map((function(t){return t.getColumnId()}))},i.filterInvalidDataItems=function(e){return e.filter((function(e){return!t.isMultiMeasuresSeriesOrValueDataItem(e)&&!e.isColumnUnavailable()}))},i.getFilterItems=function(t){var i=[];return e.localFilters2IRFilters(t.getLocalFilters().getFilterList(),i),i},i}()})),define("dashboard-analytics/extensions/smarts-recommender/dashboard-features/api/SmartsRecommenderWrapperAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.recommendBindingsForNewColumns=function(){},e.recommendBindingsForSelectedViz=function(){},e.recommendBestAlternateVisualization=function(){},e.recommendAlternateVisualizations=function(){},e.recommendRelatedVisualizations=function(){},e.recommendCompareVisualizations=function(){},e.getRecommendInfo=function(){},e.getSmartsToVizMappingsForVisId=function(){},e.isVisSlotKnownToSmarts=function(){},e._transformRecommendationResponse=function(){},t}()})),define("dashboard-analytics/extensions/smarts-recommender/dashboard-features/SmartsRecommenderWrapper",["underscore","dashboard-analytics/visualizations/recommender/BaseSmartsVisRecommenderWrapper","dashboard-analytics/widgets/livewidget/nls/StringResources","dashboard-analytics/visualizations/recommender/LegacyMapMappingManager","dashboard-analytics/visualizations/recommender/VisRecommenderBindingFallback","../impl/Utils","./api/SmartsRecommenderWrapperAPI","@waca/dashboard-common/js/core/APIFactory"],(function(t,e,i,n,o,r,s,a){"use strict";var l=e.extend({_UnsupportedVisIds:["list","dataPlayer","dropdownList","com.ibm.vis.rave2polygonmap"],_LegacyMapMappingManager:n,_VisRecommenderBindingFallback:o,init:function(t){var e=t.features;this._visDefinitions=e.VisDefinitions,this._logger=e.Logger,this._dashboardApi=e.API;var i=this._dashboardApi.getGlassCoreSvc(".Ajax"),n={};this._dashboardApi.prepareGlassOptions(n),this._api=a.createAPI(this,[s]),l.inherited("init",this,[{ajaxSvc:i,glassOptions:n,logger:this._logger,recommenderInternal:e["Recommender.internal"],dataSources:e.DataSources,moserDataSources:e["DataSources.moser"]}])},getAPI:function(){return this._api},destroy:function(){l.inherited("destroy",this,arguments),this.moserDataSources=null,this._visDefinitions=null,this._logger=null,this._dashboardApi=null},getRecommendInfo:function(t){var e=this,i=t.getDataSource();return i?i.loadMetadata().then((function(){var i=e._getBoundColumnsInfo(t);e._replaceHiddenCustomGroupCols(i,t);var n=e._getRequestOptions(t),o=t.getDefinition();return l.inherited("getRecommendInfo",e,[{columns:i,visId:o?o.getId():null,requestOptions:n}]).then((function(t){return t.mandatorySlotsMissing?e._buildChartInfoFromColumns(i,n.module):t})).catch((function(t){return t.message===e.getUnsupportedVizErrCode()?e._buildChartInfoFromColumns(i,n.module):Promise.reject(t)}))})):Promise.resolve({})},_replaceHiddenCustomGroupCols:function(t,e){var i=e.getDataSource().getId(),n=this._dashboardApi.getFeature("DataSources.moser");n&&n.isConsumerGroupColumn&&t.forEach((function(t){var e=t.columnIds;e.forEach((function(t,o){if(n.isConsumerGroupColumn(i,t)){var r=n.getCustomGroupData(i,t);r&&r.basedOnMoserObjectId&&(e[o]=r.basedOnMoserObjectId)}}))}))},_buildChartInfoFromColumns:function(t,e){var n=[];t&&t.length>0&&e&&t.forEach((function(t){t.columnIds.forEach((function(t){e.getMetadataColumn(t)&&n.push(e.getMetadataColumn(t).getLabel())}))}));var o=n.join(i.get("listSeparator")+" ");return Promise.resolve({label:o,title:o})},recommendBindingsForNewColumns:function(t,e){var i=this,n=t.getDefinition().getId();return this._isUnsupportedVis(t,n)?this._recommendBindingsForUnsupportedVisId(t,n,e):new Promise((function(o){var r=i._getBoundColumnsInfo(t),s=i._getRequestOptions(t);o({columnsToBind:e,boundColumnsInfo:r,requestOptions:s,visId:n})})).then(this.recommendBindings.bind(this)).then(this._handleBindingRecommendationResponse.bind(this,t)).catch(this._handleSmartsError.bind(this))},recommendBindingsForSelectedViz:function(t,e){if(this._isUnsupportedVis(t,e))return this._recommendBindingsForUnsupportedVisId(t,e);var i={visId:e,requestOptions:this._getRequestOptions(t)},n=t.getDefinition(),o=n?n.getId():null;return this._isUnsupportedVis(t,o)?i.columnsToBind=r.getUnboundColumnsIds(t):(i.originalVisId=o,i.boundColumnsInfo=this._getBoundColumnsInfo(t)),this.recommendBindings(i).then(this._handleBindingRecommendationResponse.bind(this,t)).catch(this._handleSmartsError.bind(this))},recommendBestAlternateVisualization:function(t,e){var i=this;return void 0===e&&(e=[]),new Promise((function(i){i(e.concat(r.getUnboundColumnsIds(t)))})).then((function(e){return i.recommendAlternateVisualizations(e,i._getRequestOptions(t))})).then((function(t){return t[0]})).catch(this._handleSmartsError.bind(this))},_recommendBindingsForUnsupportedVisId:function(t,e,i){switch(e){case"com.ibm.vis.rave2polygonmap":return this._recommendBindingsForLegacyMap(t,e,i);case"dataPlayer":case"list":case"dropdownList":return this._recommendBindingsForList_DataPlayer(t,e,i);default:return Promise.reject(new Error("Smarts does not support visualization of type "+t.getDefinition().getType()+"."))}},_handleSmartsError:function(t){throw this._logger.warn("An error occurred in the smart recommender",t),t},_handleBindingRecommendationResponse:function(t,e){var i=this;return this._getVisDefinition(e[0].visId).then((function(n){var o=n.getSlotList().filter((function(t){return!t.getProperty("hidden")})),r=o.map((function(t){return t.getId()})),s=n.getSlotList().filter((function(t){return!t.getProperty("optional")})).map((function(t){return t.getId()})),a=e.filter((function(t){return 0===Object.keys(t.slots).filter((function(t){return-1===r.indexOf(t)})).length})).reduce((function(t,e){var i=function(t){return Object.keys(t.slots).filter((function(t){return-1!==s.indexOf(t)})).length};return i(e)>i(t)?e:t}));return i._handleUnboundColumns(t,a,o)}))},_getRequestOptions:function(t){var e=this._getModule(t);return{assetId:e.getAssetId(),sourceType:e.getSourceType(),module:e}},_getVisDefinition:function(t){return Promise.resolve(this._visDefinitions.getById(t))},_getBoundColumnsInfo:function(e){var i=this,n=e.getSlots().getMappedSlotList();if(n&&n.length){var o=e.getDefinition().getId(),s=n.filter((function(t){return t&&!t.getDefinition().isHidden()&&i.isVisSlotKnownToSmarts(o,t)})).map((function(t){var e,i=r.filterInvalidDataItems(t.getDataItemList()).map((function(t){return t.getColumnId()}));return i.length&&(e={slotId:t.getId(),columnIds:i}),e}));return t.filter(s,(function(t){return t}))}},_showToastForDroppedColumns:function(t,e){if(e&&e.length){var n=e.map((function(t){return t.getLabel()})).join(", ").toLocaleString(),o=i.get(t,{columns:n});this._dashboardApi.showToast(o,{type:"info",preventDuplicates:!0})}},_getUsedMetadataColumns:function(t){var e=[];return t.getSlots().getMappingInfoList().forEach((function(t){t.slot&&e.push(t.dataItem.getColumnId())})),e},_recommendBindingsForLegacyMap:function(t,e,i){var n=!0;i||(n=!1,i=this._getUsedMetadataColumns(t));var o=i.map((function(e){return t.getDataSource().getMetadataColumn(e)}));return this._getVisDefinition(e).then(function(e){var i=new this._LegacyMapMappingManager(t),r=i.mapColumnsToSlots(e,o,n);return i.getUnmappedColumns()&&this._showToastForDroppedColumns("maxColumnsExceeded",i.getUnmappedColumns()),{slots:r,visId:e.getId()}}.bind(this))},_recommendBindingsForList_DataPlayer:function(t,e,i){return this._getVisDefinition(e).then(function(e){var n,o=this._getUsedMetadataColumns(t);i&&(o=o.concat(i));var r=e.getSlotList()[0].getProperty("maxItems");o.length>r&&(n=o.splice(r)),n&&n.length>0&&this._showToastForDroppedColumns("maxColumnsExceeded",n.map((function(e){return t.getDataSource().getMetadataColumn(e)})));var s={slots:{},visId:e.getId()};return s.slots[e.getSlotList()[0].getId()]=o,s}.bind(this))},_isUnsupportedVis:function(t,e){void 0===e&&(e=null);var i=t.getDefinition(),n=i&&i.getProperty("isSchematic"),o=i&&i.getProperty("isCustomVis");return!(!n&&!o)||(null===e&&(e=i.getId()),-1!==this._UnsupportedVisIds.indexOf(e))},_handleUnboundColumns:function(t,e,i){var n=e.unbound;if(!n||!n.length)return e;var o=(e=new this._VisRecommenderBindingFallback(t).assignUnboundColumns(e,i)).unbound.length>1?"unboundColumns":"unboundColumn",r=t.getDataSource();return this._showToastForDroppedColumns(o,e.unbound.map((function(t){return r.getMetadataColumn(t)}))),e},_getModule:function(t){var e,i=t.getDataSource();return i&&(e=this.moserDataSources.getModule(i.getId())),e}});return l})),define("dashboard-analytics/extensions/smarts-recommender/impl/FallbackRecommender",["../../../visualizations/recommender/VisRecommenderBindingFallback","./Utils"],(function(t,e){"use strict";return function(){function i(t){this.logger=t.logger,this.visDefinitions=t.visDefinitions,this.dataSources=t.dataSources}var n=i.prototype;return n.destroy=function(){this.logger=null},n.recommendBindingsForNewColumns=function(e,i){var n=new t(e),o={slots:{},unbound:i,visId:e.getDefinition().getId()};return e.getSlots().getMappingInfoList().forEach((function(t){var e=o.slots[t.slot.getId()];e||(e=[],o.slots[t.slot.getId()]=e),e.push(t.dataItem.getColumnId())})),n.assignUnboundColumns(o,this._getValidSlotList(e.getDefinition())),Promise.resolve(o)},n._getValidSlotList=function(t){return t.getSlotList().filter((function(t){return!t.isHidden()}))},n.recommendBindingsForSelectedViz=function(i,n){var o=this.visDefinitions.getById(n),r=new t(i),s={slots:{},unbound:e.getUnboundColumnsIds(i),visId:o.getId()};return r.assignUnboundColumns(s,this._getValidSlotList(o)),Promise.resolve(s)},n.recommendBestAlternateVisualization=function(t){var i=e.getUnboundColumnsIds(t);return this.recommendAlternateVisualizations(i,{dataSource:t.getDataSource()}).then((function(t){return t[0]}))},n.recommendAlternateVisualizations=function(t,e){void 0===e&&(e={});var i={slots:{},visId:""},n=e.dataSource;if(n||(n=this._getDataSource(e.assetId)),n)switch(t.length){case 1:this._recommendAlternateVis_SingleColumnId(n,t,i);break;case 2:this._recommendAlternateVis_DoubleColumnIds(n,t,i);break;case 3:this._recommendAlternateVis_TripleColumnIds(n,t,i)}if(!i.visId.length){i.visId=this.visDefinitions.getByType("List").getId(),i.slots.grid_cols=t}return Promise.resolve([i])},n._recommendAlternateVis_SingleColumnId=function(t,e,i){var n=e.map((function(e){return t.getMetadataColumn(e)})),o=this._getMeasureColumnIdList(n);if(1===o.length)i.visId=this.visDefinitions.getByType("Singleton").getId(),i.slots.actual=o;else{var r=this._getLocationColumnIdList(n);1===r.length&&(i.visId=this.visDefinitions.getByType("Tiledmap").getId(),i.slots.locations=r)}},n._recommendAlternateVis_DoubleColumnIds=function(t,e,i){var n=e.map((function(e){return t.getMetadataColumn(e)})),o=this._getMeasureColumnIdList(n);if(1===o.length){var r=this._getLocationColumnIdList(n);if(1===r.length)i.visId=this.visDefinitions.getByType("Tiledmap").getId(),i.slots.locations=[r[0]],i.slots.locationColor=[o[0]];else{var s=this._getTimeDimensionColumnIdList(n);if(1===s.length)i.visId=this.visDefinitions.getByType("Line").getId(),i.slots.categories=[s[0]],i.slots.values=[o[0]];else{var a=this._getCategoryColumnIdList(n);i.visId=this.visDefinitions.getByType("Column").getId(),i.slots.categories=[a[0]],i.slots.values=[o[0]]}}}else o.length||(i.visId=this.visDefinitions.getByType("PackedBubble").getId(),i.slots.categories=[e[0]],i.slots.color=[e[1]])},n._recommendAlternateVis_TripleColumnIds=function(t,e,i){var n=e.map((function(e){return t.getMetadataColumn(e)})),o=this._getMeasureColumnIdList(n),r=this._getLocationColumnIdList(n);if(o.length&&r.length)i.visId=this.visDefinitions.getByType("Tiledmap").getId(),2===r.length?(i.slots.locations=[r[0]],i.slots.pointLocations=[r[1]],i.slots.locationColor=[o[0]]):(i.slots.locations=[r[0]],i.slots.locationColor=[o[0]],i.slots.pointLocations=[r[0]],i.slots.pointSize=[o[1]]);else if(1===o.length){var s=this._getCategoryColumnIdList(n),a=this._getTimeDimensionColumnIdList(n);1===a.length?(i.visId=this.visDefinitions.getByType("Bar").getId(),i.slots.categories=[s[0]],i.slots.values=[o[0]],i.slots.color=[a[0]]):2===a.length?(i.visId=this.visDefinitions.getByType("Heatmap").getId(),i.slots.categories=[a[0]],i.slots.series=[a[1]],i.slots.color=[o[0]]):(i.visId=this.visDefinitions.getByType("StackedBar").getId(),i.slots.categories=[s[0]],i.slots.values=[o[0]],i.slots.color=[s[1]])}},n._getDataSource=function(t){var e;if(t){var i=this.dataSources&&this.dataSources.getDataSourceList();i&&(e=i.find((function(e){return e.getAssetId()===t})))}return e},n._getMeasureColumnIdList=function(t){return t.filter((function(t){return"fact"===t.getType()})).map((function(t){return t.getId()}))},n._getCategoryColumnIdList=function(t){var e=this;return t.filter((function(t){var i=t.getTaxonomyList();return!("attribute"!==t.getType()||t.isDateTimeDataType()||i&&(e._isLocationTaxonomy(i[0])||e._isTimeDimensionTaxonomy(i[0])))})).map((function(t){return t.getId()}))},n._getLocationColumnIdList=function(t){var e=this;return t.filter((function(t){var i=t.getTaxonomyList();return"attribute"===t.getType()&&!t.isDateTimeDataType()&&i&&e._isLocationTaxonomy(i[0])})).map((function(t){return t.getId()}))},n._getTimeDimensionColumnIdList=function(t){var e=this;return t.filter((function(t){var i=t.getTaxonomyList();return"attribute"===t.getType()&&(t.isDateTimeDataType()||i&&e._isTimeDimensionTaxonomy(i[0]))})).map((function(t){return t.getId()}))},n._isLocationTaxonomy=function(t){return"cGeoLocation"===t.getClass()},n._isTimeDimensionTaxonomy=function(t){return"cTime"===t.getClass()},n.recommendRelatedVisualizations=function(){return Promise.resolve([])},n.recommendCompareVisualizations=function(){return Promise.resolve([])},n.recommendVisualizations=function(){return Promise.resolve([])},i}()})),define("dashboard-analytics/extensions/smarts-recommender/impl/VisRecommenderDelegator",["./FallbackRecommender"],(function(t){"use strict";var e=Object.freeze({ALTERNATE_VISUALIZATIONS:"Alternate visualizations",COMPARE_VISUALIZATIONS:"Compare visualizations"});return function(){function i(e){this.fallbackRecommender=new t(e),this.recommender=e.smartsRecommenderWrapper||this.fallbackRecommender,this.logger=e.logger,this.recommenderCallCaches={}}var n=i.prototype;return n.destroy=function(){this.recommenderCallCaches={},this.recommender.destroy(),this.recommender=null},n.clearRecommenderCache=function(){this.recommenderCallCaches={}},n._getCacheForCallType=function(t){return this.recommenderCallCaches[t]||(this.recommenderCallCaches[t]={cacheKeyArray:[],nextIndex:0}),this.recommenderCallCaches[t]},n._getCacheKeyForColIdsAndPayload=function(t,e){return(e&&e.assetId||"Default Asset Id")+(t&&t.slice()||[]).sort().toString()},n.recommendBindingsForNewColumns=function(t,e){return this.recommender.recommendBindingsForNewColumns(t,e).catch(function(i){return this.logger.error("Smarts Recommender failed. Falling back to classic. See error in arguments.",i),this.fallbackRecommender.recommendBindingsForNewColumns(t,e)}.bind(this))},n.recommendBindingsForSelectedViz=function(t,e){return this.recommender.recommendBindingsForSelectedViz(t,e).catch(function(i){return this.logger.error("Smarts Recommender failed. Falling back to classic. See error in arguments.",i),this.fallbackRecommender.recommendBindingsForSelectedViz(t,e)}.bind(this))},n.recommendBestAlternateVisualization=function(t,e){return this.recommender.recommendBestAlternateVisualization(t,e).catch(function(i){return this.logger.error("Smarts Recommender failed. Falling back to classic. See error in arguments.",i),this.fallbackRecommender.recommendBestAlternateVisualization(t,e)}.bind(this))},n._updateACacheWithARecommendation=function(t,e,i){var n=t.cacheKeyArray;if(n.length>=100){var o=t.nextIndex;delete t[n[o]],n[o]=e,o+=1,t.nextIndex=o>=100?0:o}else n.push(e);t[e]=i},n.recommendAlternateVisualizations=function(t,i){var n=this,o=this._getCacheKeyForColIdsAndPayload(t,i),r=this._getCacheForCallType(e.ALTERNATE_VISUALIZATIONS);return r[o]?Promise.resolve(r[o]):this.recommender.recommendAlternateVisualizations(t,i).then((function(t){return n._updateACacheWithARecommendation(r,o,t),t})).catch(function(e){return this.logger.error("Smarts Recommender failed. Falling back to classic. See error in arguments.",e),this.fallbackRecommender.recommendAlternateVisualizations(t,i)}.bind(this))},n.recommendRelatedVisualizations=function(t,e){return this.recommender.recommendRelatedVisualizations(t,e).then((function(t){return t})).catch(function(i){return this.logger.error("Smarts Recommender failed. Falling back to classic. See error in arguments.",i),this.fallbackRecommender.recommendRelatedVisualizations(t,e)}.bind(this))},n.recommendCompareVisualizations=function(t,i){var n=this,o=this._getCacheKeyForColIdsAndPayload(t,i),r=this._getCacheForCallType(e.COMPARE_VISUALIZATIONS);return r[o]?Promise.resolve(r[o]):this.recommender.recommendCompareVisualizations(t,i).then((function(t){return n._updateACacheWithARecommendation(r,o,t),t})).catch(function(e){return this.logger.error("Smarts Recommender failed. Falling back to classic. See error in arguments.",e),this.fallbackRecommender.recommendCompareVisualizations(t,i)}.bind(this))},n.getRecommendInfo=function(t){return this.recommender.getRecommendInfo?this.recommender.getRecommendInfo(t):Promise.reject("Recommended title not supported")},i}()})),define("dashboard-analytics/extensions/smarts-recommender/impl/SmartsRecommenderFeature",["./Utils","./VisRecommenderDelegator","../../../api/impl/Visualization","../../../widgets/livewidget/models/LiveWidgetModel","../../../lib/@waca/dashboard-common/dist/utils/CommonUtil"],(function(t,e,i,n,o){"use strict";return function(){function r(t){var i=t.features;this.features=i,this.transaction=i.Transaction,this.state=i["state.internal"],this.logger=i.Logger,this.visDefinitions=this.features.VisDefinitions,this.moserDataSources=this.features["DataSources.moser"],this.smartsRecommenderWrapper=this.features.SmartsRecommenderWrapper,this._visRecommenderDelegator=new e({dataSources:this.features.DataSources,moserDataSources:this.moserDataSources,visDefinitions:this.visDefinitions,smartsRecommenderWrapper:i.SmartsRecommenderWrapper,logger:this.logger})}var s=r.prototype;return s.destroy=function(){this.features=null,this.transaction=null,this.state=null,this.logger=null,this.visDefinitions=null,this.creationTransactionToken=null,this._visRecommenderDelegator=null},s.isValidDataSource=function(t){return t.getDataSource()&&"error"!==t.getDataSource().getState()},s.getRecommendedVisualizations=function(t){var e=this;return this.isValidDataSource(t)&&t.getSlots().isMappingComplete()?this.recommendAlternateVisualizations(t).then((function(t){return t.map((function(t){return e.visDefinitions.getById(t.visId)}))})):Promise.resolve([])},s.getRecommendedTitle=function(t){return this.isValidDataSource(t)?this._visRecommenderDelegator.getRecommendInfo(t).then((function(t){return t.label})).catch((function(t){return Promise.reject(new Error(t))})):Promise.resolve()},s.clearRecommenderCache=function(){this._visRecommenderDelegator&&this._visRecommenderDelegator.clearRecommenderCache&&this._visRecommenderDelegator.clearRecommenderCache()},s.setType=function(t,e,i){var n=this,o=this.transaction.startTransaction(i),r=this.visDefinitions.getByType(e);if(r)return t.isTypeLocked()||t.lockType(o),this.isValidDataSource(t)?this._visRecommenderDelegator.recommendBindingsForSelectedViz(t,r.getId()).then((function(e){n._applyRecommendationToVisualization(t,e,o)})).finally((function(){n.transaction.endTransaction(o)})):(t.setType(e,o),this.transaction.endTransaction(o),Promise.resolve());throw new Error("Invalid definition")},s.addDataItems=function(t,e,i){var n=this;if(!t.getDataSource())throw new Error("You must set a datasource in the visualization feature first");var o=e.map((function(t){return t.columnId})),r=this.transaction.startTransaction(i);return t.isTypeLocked()?this._visRecommenderDelegator.recommendBindingsForNewColumns(t,o).then((function(e){n._applyRecommendationToVisualization(t,e,r)})).finally((function(){n.transaction.endTransaction(r)})):this._visRecommenderDelegator.recommendBestAlternateVisualization(t,o).then((function(e){n.features.LiveWidgetSegment&&n.features.LiveWidgetSegment.track({visualization:t,info:e,category:"fromRecommendation"}),n._applyRecommendationToVisualization(t,e,r)})).finally((function(){n.transaction.endTransaction(r)}))},s.recommendBestVisualization=function(t,e){var i=this;if(this.isValidDataSource(t)){var n=this.transaction.startTransaction(e);return t.isTypeLocked()&&t.unlockType(n),this._visRecommenderDelegator.recommendBestAlternateVisualization(t).then((function(e){i.features.LiveWidgetSegment&&i.features.LiveWidgetSegment.track({visualization:t,info:e,category:"fromRecommendation"}),i._applyRecommendationToVisualization(t,e,n)})).finally((function(){i.transaction.endTransaction(n)}))}return Promise.resolve()},s._getSmartSlotsOfInterest=function(t){var e=t&&t.getDefinition&&t.getDefinition(),i=e&&e.getId&&e.getId(),n=i&&this.smartsRecommenderWrapper&&this.smartsRecommenderWrapper.getSmartsToVizMappingsForVisId(i);if(n){var r=o.clone(n);return delete r.visId,delete r.chartType,Object.keys(r)}return[]},s.recommendAlternateVisualizations=function(e){var i;if(this.isValidDataSource(e)){var n=this._getSmartSlotsOfInterest(e),o=e.getDataSource(),r=this.moserDataSources.getModule(o.getId()),s=t.getUnboundColumnsIds(e,n);i=this._visRecommenderDelegator.recommendAlternateVisualizations(s,{assetId:r.getAssetId(),sourceType:r.getSourceType(),module:r})}else i=Promise.resolve([]);return i},s.recommendAlternateVisualizationsAsWidgetSpecs=function(t,e){var i=this;return this.recommendAlternateVisualizations(t).then((function(t){return i._transformWidgetRecommendationsToLiveWidgetSpecs(t,e)}))},s.recommendRelatedVisualizations=function(e){var i;if(this.isValidDataSource(e)){var n=e.getDataSource(),o=t.getUnboundColumnsIds(e),r=t.getTopBottomItems(e),s=t.getFilterItems(e);i=this.recommendRelatedVisualizationsFromColumnIds(n.getId(),o,[].concat(r,s))}else i=Promise.resolve([]);return i},s.recommendAlternateVisualizationsFromColumnIds=function(t,e){var i=this.moserDataSources.getModule(t);return this._visRecommenderDelegator.recommendAlternateVisualizations(e,{assetId:i.getAssetId(),sourceType:i.getSourceType(),module:i})},s.recommendRelatedVisualizationsFromColumnIds=function(t,e,i,n){var o=this.moserDataSources.getModule(t);return this._visRecommenderDelegator.recommendRelatedVisualizations(e,{assetId:o.getAssetId(),sourceType:o.getSourceType(),module:o,filters:i,includeBestVisForTargetFields:!!n,moserDataSources:this.moserDataSources,visualization:this.visualization})},s.recommendRelatedVisualizationsAsWidgetSpecs=function(t,e){var i=this;return this.recommendRelatedVisualizations(t).then((function(t){return i._transformWidgetRecommendationsToLiveWidgetSpecs(t,e)}))},s.recommendCompareVisualizationsAsWidgetSpecs=function(e,i){var n;if(this.isValidDataSource(e)){var o=e.getDataSource(),r=this.moserDataSources.getModule(o.getId()),s={};s.module=r,s.columnIds=t.getUnboundColumnsIds(e),s.widgetSpec=i,s.visualization=e,s.assetId=o.getAssetId(),s.sourceType=o.getType(),s.moserDataSources=this.moserDataSources,n=this._visRecommenderDelegator.recommendCompareVisualizations(s.columnIds,s)}else n=Promise.resolve([]);return n},s._transformWidgetRecommendationsToLiveWidgetSpecs=function(t,e){var o=this,r=[],s=[];return t.forEach((function(t){(e=JSON.parse(JSON.stringify(e))).name=t.label,t.filters&&t.filters.length>0&&(e.localFilters=t.filters);var a=new n(e),l=new i({doNotRegisterDataSourceUsage:!0,content:o.content,features:{"Models.internal":{getWidgetModel:function(){return a}},"Dashboard.API":o.features["Dashboard.API"],"Dashboard.Logger":o.features.Logger,"Dashboard.Colors":o.features.Colors,"Dashboard.Transaction":o.features.Transaction,"Dashboard.DataSources":o.features.DataSources,"Dashboard.internal":o.features["Dashboard.internal"],"Dashboard.VisDefinitions":o.features.VisDefinitions,"Dashboard.VisDefinitions.internal":o.features["VisDefinitions.internal"],"Dashboard.DashboardSettings":o.features.DashboardSettings}});r.push(l.initialize().then((function(){l.unlockType(),o._applyRecommendationToVisualization(l,t);var e=a.toJSON([],["thumbnailId"]);delete e.id,e.recommenderInfo={rtitle:t.title,description:t.description,label:t.label},s.push({name:a.get("name"),spec:e})})))})),console.log("recommendations... ",s),Promise.all(r).then((function(){return s}))},s._applyRecommendationToVisualization=function(t,e,i){var n=this,o=this.transaction.startTransaction(i),r=t.getSlots().getMappingInfoList().map((function(t){return t.dataItem&&t.dataItem.getId()}));if(e.visId!==t.getDefinition().getId()){var s=this.visDefinitions.getById(e.visId);t.setType(s.getType(),o)}var a=t.getSlots(),l=[],c={};a.getDataItemList().forEach((function(t){var e=a.getMappingInfo(t.getId());if(e){var i=e.slot.getId();c[i]||(c[i]=[]),c[i].push(t)}else l.push(t)}));var u={};for(var d in e.slots)e.slots[d].forEach((function(t){u[t]=!0}));var h=a.getSlotList();h.forEach((function(t){var i=t.getId();t.getDataItemList(!0).forEach((function(t){e.slots[i]&&e.slots[i].find((function(e){return t.getColumnId()===e}))||l.push(t)}))}));var g={};h.forEach((function(i){var r=i.getId(),s=i.getId(),u=[];if(e.slots[r])e.slots[r].forEach((function(t){var e,i=function(i){return!(!e&&t===i.getColumnId())||(e=i,!1)};c[s]&&(c[s]=c[s].filter(i)),e||(l=l.filter(i)),e||(e=a.createDataItems([{columnId:t}],o)[0]),u.push(e.getId())}));else{var d=a.getSlot(s),h=d.getDefinition().isHidden(),p=t.getDefinition().getId(),f=n.smartsRecommenderWrapper&&n.smartsRecommenderWrapper.isVisSlotKnownToSmarts(p,d);!h&&f||d.getDataItemList().forEach((function(t){l.find((function(e){return e.getId()===t.getId()}))&&(u.push(t.getId()),l=l.filter((function(e){return e.getId()!==t.getId()})))}))}var m=i.getDataItemList(!0),v=m.filter((function(t){return t.isColumnUnavailable()}));v.length>0&&i.removeDataItems(v.map((function(t){return t.getId()})),o),g[s]=u,i.removeDataItemsMapping(m.map((function(t){return t.getId()})),o)})),Object.keys(g).map((function(t){return a.getSlot(t)})).sort((function(t,e){return(t.getDefinition().getProperty("multiMeasure")?1:-1)-(e.getDefinition().getProperty("multiMeasure")?1:-1)})).map((function(t){return t.getId()})).forEach((function(t){g[t].length>0&&a.getSlot(t).addDataItemsMapping(g[t],-1,o)}));var p=a.getMappingInfoList();if(e.topBottom&&e.topBottom.length>0&&e.topBottom.forEach((function(t){var e=t.itemId,i=t.spec,n=p.find((function(t){return t.dataItem.getColumnId()===e}));if(n){var r={type:i.type,value:i.value};i.context&&(r.context={itemId:i.context,aggregate:i.aggregate}),n.dataItem.setTopBottom(r,o)}})),(e.autoGroup||[]).forEach((function(t){var e=t.itemId,i=t.groupSize;if(t&&i){var n=p.find((function(t){return t.dataItem.getColumnId()===e}));n&&n.dataItem.setBinning({bins:i},o)}})),l.length>0){var f=l.filter((function(t){return"_multiMeasuresSeries"===t.getColumnId()}));a.deleteDataItems(f.map((function(t){return t.getId()})),o)}var m=a.getMappingInfoList().map((function(t){return t.dataItem&&t.dataItem.getId()})),v=r.filter((function(t){return-1===m.indexOf(t)}));v.length>0&&a.deleteDataItems(v,o),this.transaction.endTransaction(o)},r}()})),define("dashboard-analytics/extensions/smarts-recommender/content-features/api/VisualizationSmartsRecommenderAPI",[],(function(){var t=function(){function t(){}var e=t.prototype;return e.setType=function(){},e.addDataItems=function(){},e.recommendBestVisualization=function(){},e.getRecommendedVisualizations=function(){},e.clearRecommenderCache=function(){},t}();return t.AUTO_ID="auto",t})),define("dashboard-analytics/extensions/smarts-recommender/content-features/api/DeprecatedVisualizationSmartsRecommenderAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getRecommendedTitle=function(){},e.getRecommendedVisualizations=function(){},e.recommendAlternateVisualizationsAsWidgetSpecs=function(){},e.recommendRelatedVisualizationsAsWidgetSpecs=function(){},e.recommendCompareVisualizationsAsWidgetSpecs=function(){},t}()})),define("dashboard-analytics/extensions/smarts-recommender/content-features/VisualizationSmartsRecommender",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../widgets/livewidget/nls/StringResources","../impl/SmartsRecommenderFeature","./api/VisualizationSmartsRecommenderAPI","./api/DeprecatedVisualizationSmartsRecommenderAPI"],(function(t,e,i,n,o){"use strict";return function(i){function r(e){var r;return(r=i.call(this,e)||this).creationTransactionToken=e.transactionToken,r.visualization=e.features.Visualization,r.modelsInternal=e.features["Models.internal"],r.liveWidgetSegment=e.features.LiveWidgetSegment,r._api=t.createAPI(_assertThisInitialized(r),[n]),r._dashboardAPI=r.features["Dashboard.API"],r._deprecatedAPI=t.createAPI(_assertThisInitialized(r),[o]),r._dashboardAPI.on("shapingmodel:changed",r.clearRecommenderCache,_assertThisInitialized(r)),r}_inheritsLoose(r,i);var s=r.prototype;return s.initialize=function(){if(!this.visualization.getType())return this.recommendBestVisualization(this.creationTransactionToken)},s.destroy=function(){this._dashboardAPI.off("shapingmodel:changed",this.clearRecommenderCache,this),i.prototype.destroy.call(this),this.creationTransactionToken=null,this.visualization=null,this.modelsInternal=null,this._api=null,this._deprecatedAPI=null},s.getAPI=function(t){return"deprecated"===t?this._deprecatedAPI:this._api},s.clearRecommenderCache=function(){i.prototype.clearRecommenderCache.call(this)},s.getRecommendedVisualizations=function(){return i.prototype.getRecommendedVisualizations.call(this,this.visualization).then((function(t){return[{id:n.AUTO_ID,caption:e.get("automaticTypeCaption"),icon:"visualizations-changeVisualization",disabled:0===t.length}].concat(t)}))},s.getRecommendedTitle=function(){return i.prototype.getRecommendedTitle.call(this,this.visualization)},s.setType=function(t,e){return t===n.AUTO_ID?i.prototype.recommendBestVisualization.call(this,this.visualization,e):i.prototype.setType.call(this,this.visualization,t,e)},s.addDataItems=function(t,e){return i.prototype.addDataItems.call(this,this.visualization,t,e)},s.recommendBestVisualization=function(t){return i.prototype.recommendBestVisualization.call(this,this.visualization,t)},s.recommendAlternateVisualizationsAsWidgetSpecs=function(){return i.prototype.recommendAlternateVisualizationsAsWidgetSpecs.call(this,this.visualization,JSON.parse(JSON.stringify(this.modelsInternal.getWidgetModel().toJSON())))},s.recommendRelatedVisualizationsAsWidgetSpecs=function(){return i.prototype.recommendRelatedVisualizationsAsWidgetSpecs.call(this,this.visualization,JSON.parse(JSON.stringify(this.modelsInternal.getWidgetModel().toJSON())))},s.recommendCompareVisualizationsAsWidgetSpecs=function(){return i.prototype.recommendCompareVisualizationsAsWidgetSpecs.call(this,this.visualization,JSON.parse(JSON.stringify(this.modelsInternal.getWidgetModel().toJSON())))},r}(i)})),define("dashboard-analytics/extensions/smarts-recommender/dashboard-features/api/SmartsRecommenderAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.recommendAlternateContent=function(){},e.recommendRelatedContent=function(){},t}()})),define("dashboard-analytics/extensions/smarts-recommender/dashboard-features/api/DeprecatedSmartsRecommenderAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.recommendAlternateVisualizationsAsWidgetSpecs=function(){},e.recommendRelatedVisualizationsAsWidgetSpecs=function(){},e.transformRecommendationsToLiveWidgetSpecs=function(){},t}()})),define("dashboard-analytics/extensions/smarts-recommender/dashboard-features/SmartsRecommender",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","../impl/SmartsRecommenderFeature","./api/SmartsRecommenderAPI","./api/DeprecatedSmartsRecommenderAPI"],(function(t,e,i,n){"use strict";return function(e){function o(o){var r;return(r=e.call(this,o)||this)._api=t.createAPI(_assertThisInitialized(r),[i]),r._deprecatedAPI=t.createAPI(_assertThisInitialized(r),[n]),r}_inheritsLoose(o,e);var r=o.prototype;return r.destroy=function(){e.prototype.destroy.call(this),this._api=null,this._deprecatedAPI=null},r.getAPI=function(t){return"deprecated"===t?this._deprecatedAPI:this._api},r.recommendAlternateContent=function(){throw new Error("Not implemented yet")},r.recommendRelatedContent=function(){throw new Error("Not implemented yet")},r.recommendAlternateVisualizationsAsWidgetSpecs=function(t,i){var n=this;return e.prototype.recommendAlternateVisualizationsFromColumnIds.call(this,t,i).then((function(e){return n._transformToWidgetSpecs(e,t)}))},r.recommendRelatedVisualizationsAsWidgetSpecs=function(t,i,n){var o=this;return e.prototype.recommendRelatedVisualizationsFromColumnIds.call(this,t,i,null,n).then((function(e){return o._transformToWidgetSpecs(e,t)}))},r.transformRecommendationsToLiveWidgetSpecs=function(t,e){var i=this._visRecommenderDelegator.recommender._transformRecommendationResponse(e,t);return this._transformToWidgetSpecs(i,e)},r._transformToWidgetSpecs=function(t,e){return this._transformWidgetRecommendationsToLiveWidgetSpecs(t,{type:"live",data:{dataViews:[{id:"id_123",modelRef:e}]}})},o}(e)})),define("dashboard-analytics/features/dashboard/recommender/api/InternalRecommenderAPI",[],(function(){return function(){function t(){}return t.prototype.getChartTypeList=function(){},t}()})),define("dashboard-analytics/visualizations/recommender/VisRecommenderUtils",[],(function(){return function(){function t(){}return t.buildChartTypes=function(t){var e=[];return t?((e=t.map((function(t){return t.getType()}))).push("ClusteredBar","ClusteredColumn","ClusteredLine","ClusteredPoint","HierarchicalPie","StackedArea"),e):e},t}()})),define("dashboard-analytics/features/dashboard/recommender/InternalRecommender",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/InternalRecommenderAPI","../../../visualizations/recommender/VisRecommenderUtils"],(function(t,e,i){return function(){function n(i){this._api=t.createAPI(this,[e]),this.features=i.features}var o=n.prototype;return o.getAPI=function(){return this._api},o.getChartTypeList=function(){var t=[];try{var e=this.features.VisDefinitions.getList();t=i.buildChartTypes(e)}catch(t){this.features.Logger.error(t)}return t},n}()})),define("dashboard-analytics/extensions/visualization-summary/dashboard-features/SummaryPropertyCallbacks",[],(function(){return function(){function t(t){this.dashboardApi=t.features.API}var e=t.prototype;return e.getAPI=function(){return this},e.preRenderAlignmentProperty=function(t){return t.getFeature("livewidget.internal").getVisView().isInfographic()?{removeProperty:!0}:{}},e.preRenderValueSizeProperty=function(t,e){var i=t.getFeature("livewidget.internal").getVisView(),n=this.dashboardApi.getFeature("KpiPropertyCallbacks");return i.isInfographic()?{removeProperty:!0}:n.preRenderValueSizeProperty(t,e)},e.preRenderBaseLabelProperty=function(t){return this.dashboardApi.getFeature("KpiPropertyCallbacks").preRenderBaseLabelProperty(t)},e.preRenderFillDirectionProperty=function(t){return t.getFeature("livewidget.internal").getVisView().isInfographic()?{}:{removeProperty:!0}},e.onChangeValueSizeProperty=function(t,e,i){},t}()})),define("dashboard-analytics/features/widget/lassoSelectAction/LassoAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.registerProvider=function(){},e.getContributions=function(){},e.toggleLassoSelect=function(){},e.on=function(){},e.off=function(){},t}()})),define("dashboard-analytics/features/widget/lassoSelectAction/LassoAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){return this.apiSpec||(this.apiSpec={name:"lasso API",events:{serializeActions:!0,actions:{toggleLassoSelect:{eventName:"toggle",isTriggerEvent:function(){return!0},getInfo:function(){return{}},getAction:function(){return{}}}}}}),this.apiSpec},t}()})),define("dashboard-analytics/visualizations/interactions/lassoSelect/LassoSelectView",["../../../lib/@waca/core-client/js/core-client/ui/View","jquery","../../../lib/@waca/core-client/js/core-client/utils/BrowserUtils","../../../lib/@waca/dashboard-common/dist/utils/EventChainLocal"],(function(t,e,i,n){var o=1,r=27,s="mousedown touchstart",a="mousemove touchmove",l="mouseup touchend",c="mouseleave";return t.extend({id:"lw-lasso-select",init:function(i,n,o){t.inherited("init",this,arguments),this.$el.prependTo(document.body),this.$target=i,this.targetNode=this.$target.get(0),this.$body=e(document.body),this.cordinateResolver=n,this._isDragging=o,this.handlers={mousemove:this._getPipedHandler(this._handleMouseMove),mouseup:this._getPipedHandler(this._handleMouseUp),mousedown:this._getPipedHandler(this._handleMouseDown),keyup:this._getPipedHandler(this._handleKeyup),mouseleave:this._getPipedHandler(this._handleMouseLeave)},this._isIE()||this._configCursor(),this.$el.on(a,this.handlers.mousemove),this.$body.keyup(this.handlers.keyup),this.$target.on(c,this.handlers.mouseleave).on(a,this.handlers.mousemove).on(s,this.handlers.mousedown)},_handleMouseMove:function(t){this._updateCursor(t);var e={left:Math.min(t.pageX,this.left),top:Math.min(t.pageY,this.top),width:Math.abs(t.pageX-this.left),height:Math.abs(t.pageY-this.top)};this._isDragging(t)&&(this.$el.css(e),this._isLassoWithinTarget()&&this.trigger("lassoSelect:cordsChange",{event:t,cords:this._getCords()}))},_handleKeyup:function(t){t.keyCode===r&&this.trigger("lassoSelect:cancel",{})},_handleMouseUp:function(t){this._isLassoWithinTarget()&&this.trigger("lassoSelect:done",{event:t,cords:this._getCords()});this.$el.css({left:0,top:0,width:0,height:0}),this.$body.off(l,this.handlers.mouseup)},_handleMouseDown:function(t){"touchstart"!==t.type&&t.which!==o||(this.left=t.pageX,this.top=t.pageY,this.$body.on(l,this.handlers.mouseup))},_handleMouseLeave:function(t){this._updateCursor(t,!1)},remove:function(){this.$el.off(a,this.handlers.mousemove),this.$body.off(l,this.handlers.mouseup).off("keyup",this.handlers.keyup),this.$target.off(s,this.handlers.mousedown).off(c,this.handlers.mouseleave).off(a,this.handlers.mousemove),this._initCursor&&(this.targetNode.style.cursor=this._initCursor.target),this.handlers=null,this.$cursor&&(this.$cursor.remove(),this.$cursor=null),t.inherited("remove",this,arguments)},_getCords:function(){var t=this.el.getBoundingClientRect();return[{x:t.left,y:t.top},{x:t.right,y:t.top},{x:t.right,y:t.bottom},{x:t.left,y:t.bottom}]},_isLassoWithinTarget:function(){var t=this.$target.get(0).getBoundingClientRect(),e=this.el.getBoundingClientRect();return e.top>=t.top&&e.left>=t.left&&e.right<=t.right&&e.bottom<=t.bottom},_getPipedHandler:function(t){return function(e){this._isTouch(e)&&(e.preventDefault(),this.cordinateResolver(e)),new n(e).setProperty("preventWidgetDeselect",!0),t.bind(this)(e)}.bind(this)},_isTouch:function(t){return t.type&&("touchstart"===t.type||"touchmove"===t.type||"touchend"===t.type)},_updateCursor:function(t,i){if(this._isIE()){var n=10,o=12;!1!==i?(this.$cursor&&!this.$cursor.is(":visible")?this.$cursor.show():this.$cursor||(this.$cursor=e('<div class="lassoIconBox">'),this.$cursor.prependTo(document.body)),this.$cursor.css({left:t.pageX+n,top:t.pageY+o})):this.$cursor&&this.$cursor.hide()}},_isIE:function(){return i.isIE()},_configCursor:function(){this._initCursor={},this._initCursor.target=this.targetNode.style.cursor,this.targetNode.style.cursor="url(dashboard-analytics/images/pointer-marquee_32.svg), auto"},getCoordinates:function(){return this._getCords()},getId:function(){return this.id}})})),define("dashboard-analytics/features/widget/lassoSelectAction/Lasso",["../../../widgets/livewidget/nls/StringResources","../../../lib/@waca/dashboard-common/dist/core/APIFactory","./LassoAPI","./LassoAPISpec","../../../visualizations/interactions/lassoSelect/LassoSelectView"],(function(t,e,i,n,o){return function(n){function r(t){var e,i=t.features;return(e=n.call(this)||this)._providers=[],e.features=i,e}_inheritsLoose(r,n);var s=r.prototype;return s.getAPI=function(){return this._api||(this._api=e.createAPI(this,[i])),this._api},s.registerProvider=function(t){if("function"!=typeof t.getLassoContribution)throw new Error('Registered lasso provider doesn"t have a getLassoContribution function');return this._providers.push(t)},s.getContributions=function(){var e=[{id:"lw-lasso-select",name:"lasso",icon:"visualizations-marquee_16",label:t.get("toolbarActionLassoSelect"),module:o}];return this._providers.forEach((function(t){return e.push.apply(e,t.getLassoContribution())})),e},s.toggleLassoSelect=function(t){var e=this.features.Canvas.getSelectedContentList()[0],i=e&&e.getFeature("VisualizationGesture");if(i){var n=i.getLassoSelectState();i.setLassoSelectState(!n,t);var o=e.getFeature("Toolbar.internal");o&&o.refresh()}},r}(n)})),define("dashboard-analytics/features/content/selections/dataPointSelections/api/DataPointSelectionsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.select=function(){},e.deselect=function(){},e.clearAll=function(){},e.getSelections=function(){},e.isSelected=function(){},e.registerSelectionProvider=function(){},t}()})),define("dashboard-analytics/features/content/selections/dataPointSelections/api/deprecated/DataPointSelectionsAPI",[],(function(){return function(){function t(){}return t.prototype.getSelection=function(){},t}()})),define("dashboard-analytics/features/content/selections/dataPointSelections/api/DataPointSelectionsAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){var t=this;return this.apiSpec||(this.apiSpec={name:"dataPointSelections API",events:{propagationInfo:{namespace:"selections",info:{name:"DataPointSelections"},callStack:{name:"getFeature",params:["DataPointSelections"]}},actions:{select:{eventName:"select",getUndoActions:function(t){return[{name:"deselect",params:[t[0]]}]}},deselect:{eventName:"deselect",getUndoActions:function(t){return[{name:"select",params:[t[0]]}]}},clearAll:{eventName:"clearAll",getInfo:function(){return{value:arguments.length<=1?void 0:arguments[1]}},getUndoActions:function(){return[{name:"select",params:[t.getSelections()]}]}}}}}),this.apiSpec},t}()})),define("dashboard-analytics/features/content/selections/dataPointSelections/api/SelectedAPI",[],(function(){return function(){function t(){}return t.prototype.isSelected=function(){},t}()})),define("dashboard-analytics/features/content/selections/dataPointSelections/VisSelected",["../../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/SelectedAPI","../../../../util/EventUtils","underscore"],(function(t,e,i,n){return function(){function o(t){var e=this;this._includeParents=t.includeParents,this._ignoreEdgeSelections=t.ignoreEdgeSelections,this._edgeSelections=[],this._pointSelections={},this._selectedParents={},this._pageContextAPI=t.pageContextAPI,this._selectionProvider=t.selectionProvider,this._itemIds=t.itemIds,this._sourceId=t.sourceId;var i={origin:"visualization",scope:t.scope,eventGroupId:t.eventGroupId};this._selectionProvider&&!this._ignoreEdgeSelections?this._addEdgeSelectionsFromSelectionProvider():this._ignoreEdgeSelections||n.each(this._itemIds,(function(t){var o=e._pageContextAPI.getPageContextItem(Object.assign({itemId:t},i));if(o&&o.getValueCount()){var r={},s=[];n.each(o.getValueIds(),(function(t){r[t]=1,s.push(t)})),e._edgeSelections.push(r)}else e._edgeSelections.push({})}));for(var o=n.map(this._itemIds,(function(t){return{hierarchyUniqueName:t}})),r=this._itemIds.length;r>1;--r)this._selectionProvider?this._addPointSelectionsFromSelectionProvider(n.head(this._itemIds,r),t.includeParents):this._addDataPointSelections(n.head(o,r),i,t.includeParents);for(var s=0;s<this._itemIds.length-1;++s)for(var a=this._itemIds.length;a>s+1;--a)this._selectionProvider?this._addPointSelectionsFromSelectionProvider(this._itemIds.slice(s,a),!1):this._addDataPointSelections(o.slice(s,a),i,!1)}var r=o.prototype;return r.getAPI=function(){return this._api||(this._api=t.createAPI(this,[e])),this._api},r._addDataPointSelections=function(t,e,i){var o=this._pageContextAPI.getPageContextItem(n.extend({hierarchies:t},e));o&&o.getValueCount()&&n.each(o.getDataPoints(),function(t){this._pointSelections[this._getDataPointKey(t)]=1,i&&this._addSelectedParents(this._itemIds,t)}.bind(this))},r._addPointSelectionsFromSelectionProvider=function(t,e){var i=this;this._selectionProvider.getSelectedPoints(t).forEach((function(t){i._pointSelections[i._getDataPointKey(t)]=1,e&&i._addSelectedParents(i._itemIds,t)}))},r._addEdgeSelectionsFromSelectionProvider=function(){var t=this;this._itemIds.forEach((function(e){var i=t._selectionProvider.getSelectedPoints([e]),n={};i.forEach((function(t){n[t[0].value]=1})),t._edgeSelections.push(n)}))},r._addSelectedParents=function(t,e){for(var i=t,o=e;i.length>0;){for(var r=1;r<i.length;++r)this._selectedParents[this._getParentKey(n.first(i,i.length),n.first(o,r))]=1;i=n.rest(i),o=n.rest(o)}},r._getMaxPointSelectionLength=function(){for(var t=0,e=Object.getOwnPropertyNames(this._pointSelections),n=0;n<e.length;n++)t=Math.max(e[n].split(i.SEPARATOR).length,t);return t},r.isSelected=function(t){for(var e=0;e<t.length;++e){var i=n.isObject(this._edgeSelections[e])&&this._edgeSelections[e],o=t[e];if(n.isObject(o)&&(void 0!==o.value?o=o.value:void 0!==o.u&&(o=o.u)),i&&i[o])return!0}if(this._pointSelections[this._getDataPointKey(t)])return!0;for(var r=this._getMaxPointSelectionLength(),s=0;s<t.length;++s)for(var a=t.length;a>=s;--a){var l=t.slice(s,a);if(l.length<=r&&this._pointSelections[this._getDataPointKey(l)])return!0}return!1},r.isSelectedParent=function(t,e){return!!this._selectedParents[this._getParentKey(t,e)]},r.isValueSelected=function(t){return this.isSelected([t])},r.hasSelections=function(){return!(!n.find(this._edgeSelections,(function(t){return n.keys(t).length>0}))&&!n.keys(this._pointSelections).length)},r._getDataPointKey=function(t){return i.getDataPointKey(t)},r._getParentKey=function(t,e){var o="",r=n.clone(e).sort(i.compareDataPointKey);return n.each(r,(function(e,n){o+=t[n]+"="+(e.u||e.value)+i.SEPARATOR})),o.slice(0,-1)},r.getSelectedKeys=function(){var t=[];return n.each(this._edgeSelections,(function(e){t=t.concat(n.keys(e))})),t=t.concat(n.keys(this._pointSelections))},o}()})),define("dashboard-analytics/features/content/selections/dataPointSelections/PendingSelections",["underscore","../../../../apiHelpers/SlotAPIHelper"],(function(t,e){return function(){function i(){this._pendingSelections=[]}var n=i.prototype;return n.select=function(e){var i=this;t.each(e,(function(e){t.find(i._pendingSelections,(function(i){return t.isEqual(i,e)}))||i._pendingSelections.push(e)}))},n.deselect=function(e){var i=this;t.each(e,(function(e){var n=t.findIndex(i._pendingSelections,(function(i){return t.isEqual(i,e)}));n>-1&&i._pendingSelections.splice(n,1)}))},n.clearAll=function(){this._pendingSelections.length=0},n.getSelections=function(i){void 0===i&&(i=[]);var n=t.filter(i,(function(t){return"attribute"===t.getType()&&e.MULTI_MEASURES_SERIES!==t.getColumnId()})),o=t.map(n,(function(t){return t.getId()}));return t.filter(this._pendingSelections,(function(e){return t.every(o,(function(i){return t.find(e.categories,(function(t){return t.dataItemId===i}))}))}))},n.isSelected=function(e){var i=this;return!!t.every(e,(function(e){return!!t.find(i._pendingSelections,(function(i){return t.isEqual(i,e)}))}))},n.registerSelectionProvider=function(){},i}()})),define("dashboard-analytics/features/content/selections/dataPointSelections/DataPointSelections",["underscore","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/DataPointSelectionsAPI","./api/deprecated/DataPointSelectionsAPI","./api/DataPointSelectionsAPISpec","../../../../util/ContentUtil","../../../../lib/@waca/dashboard-common/dist/utils/ContentUtil","./VisSelected","./PendingSelections"],(function(t,e,i,n,o,r,s,a,l){return function(o){function c(t){var e;return(e=o.call(this,t)||this).content=t.content,e.dashboard=t.dashboardAPI,e.featureChecker=e.dashboard.getGlassCoreSvc(".FeatureChecker"),e._selectionProvider=null,e}_inheritsLoose(c,o);var u=c.prototype;return u.registerSelectionProvider=function(t){this._selectionProvider=t},u.getAPI=function(t){if("deprecated"===t)return this._deprecatedApi||(this._deprecatedApi=e.createAPI(this,[i,n])),this._deprecatedApi;if("pending"===t){if(!this._pending){var o=new l;this._pending=e.createAPI(o,[i])}return this._pending}return"utils"===t?(this._utils||(this._utils={getLegacySelection:this._getLegacySelection.bind(this)}),this._utils):(this._api||(this._api=e.createAPI(this,[i])),this._api)},u.select=function(t,e){if(!this._selectionProvider){var i=this._getLegacySelection(t,"update");return this._getController().select(i,e),t}this._selectionProvider.select(t,e)},u.deselect=function(t,e,i){if(void 0===i&&(i=!1),!this._selectionProvider){var n=this._getSlotsToClear(i?void 0:t),o=this._getLegacySelection(t,"remove",n);return this._getController().select(o,e),t}this._selectionProvider.deselect(t,e,i)},u._getSelectionValues=function(e){return t.chain(e||this.getSelections()).map((function(t){return t.categories})).flatten().map((function(t){return t.value})).value()},u._getSlotsToClear=function(e){var i=this._getSelectionValues(e),n=this._getSelectionValues();return i.length!==n.length||t.difference(i,n).length?[]:this.content.getFeature("Visualization").getSlots().getMappedSlotList()},u.clearAll=function(t){if(!this._selectionProvider){var e=this._buildSelections([],!1)||[];return this.deselect(e,t,!0)}this._selectionProvider.clearAll()},u._getVisualization=function(){return this.visualization||(this.visualization=this.content.getFeature("Visualization")),this.visualization},u._getController=function(){return this.controller||(this.controller=this.content.getFeature("SelectionController.deprecated")),this.controller},u._getLegacySelection=function(e,i,n){void 0===n&&(n=[]);var o={command:i,itemIds:[],tuple:[],edgeSelect:!!t.find(e,(function(t){return t.edgeSelect})),multiTuple:!!(e&&e.length>1),slotsToClear:n};return e&&e.forEach((function(t){var e=[],i=[];t.categories&&t.categories.forEach((function(t){-1===o.itemIds.indexOf(t.columnId)&&o.itemIds.push(t.columnId),-1===i.indexOf(t.columnId+t.value)&&(e.push({u:t.value,d:t.label}),i.push(t.columnId+t.value))})),e.length&&o.tuple.push(e)})),o},u.getSelections=function(t,e){var i=this;if(void 0===t&&(t=[]),void 0===e&&(e=!1),this._selectionProvider){var n=this._selectionProvider.getSelectedPoints(t.map((function(t){return t.getColumnId()})));return e?n:n.map((function(e){if(void 0!==e.from||void 0!==e.to){var n={ranges:[]};return n.ranges.push(i._toPayloadValue(e,t[0].getColumnId(),t[0].getId())),n}return{categories:e&&e.length&&e.map((function(e,n){return i._toPayloadValue(e,t[n].getColumnId(),t[n].getId())}))||[]}}))}return this._buildSelections(t)},u._getScope=function(){var t=this.dashboard.getAppConfig("pageContainerType"),e=s.getPageContent(this.content,t);return e&&e.getId()},u._getEventGroupId=function(){return this.dashboard.getFeature("EventGroups").getGroupId(this.content.getId())},u._getPageContext=function(){return this._pageContext||(this._pageContext=r.getPageContext(this.dashboard)),this._pageContext},u._buildSelections=function(t,e){void 0===e&&(e=!0);var i=[],n=this._getVisualization().getDataSource(),o=n&&n.getId();if(o){var r,s={scope:this._getScope(),eventGroupId:this._getEventGroupId(),sourceId:o,origin:"visualization",_strictMatch:e},a=this._getVisualization().getSlots().getDataItemList(),l=this._getPageContext().getNetPageContextItems(s);(r=i).push.apply(r,this._getValues(l,t,a)),i.length&&(i=this._uniqueValues(i))}return i},u._getValues=function(t,e,i){var n=this,o=[],r=null,s=null;return t&&t.length&&t.forEach((function(t){var a=t.getItemIds();if(t.isDataPointType()){var l=[];t.getDataPoints().forEach((function(o){var c=[];o.forEach((function(t,o){(s=n._getDataItem(a[o],e,i))&&"attribute"===s.getType()&&(r=n._toPayloadValue(t,a[o],s.getId()),c.push(r))})),t.getItemIds().length<=c.length&&l.push({categories:c})})),o.push.apply(o,l)}else{t.getValues().forEach((function(t){(s=n._getDataItem(a[0],e,i))&&"attribute"===s.getType()&&(r=n._toPayloadValue(t,a[0],s.getId()),o.push({categories:[r]}))}))}})),o},u._getDataItem=function(e,i,n){var o=t.find(i,(function(t){return t.getColumnId()===e}));return o||(o=t.find(n,(function(t){return t.getColumnId()===e}))),o},u._toPayloadValue=function(t,e,i){var n={dataItemId:i,columnId:e},o=function(t){return t||0===t};return o(t.from)||o(t.to)?n.range=t:void 0!==t.value?(n.value=t.value,n.label=t.label):void 0!==t.u&&(n.value=t.u,n.label=t.d),t.p&&(n.parentId=t.p.u),n},u._uniqueValues=function(e){void 0===e&&(e=[]);var i=[],n={};return e.forEach((function(e){var o=t.pluck(e.categories,"value").join();n[o]||(n[o]=1,i.push(e))})),i},u.isSelected=function(t){if(this._selectionProvider)return this._selectionProvider.isSelected(t);var e=this._getLegacySelection(t);return e.edgeSelect?this._isEdgeSelected(t):this._isDataPointSelected(e)},u._isDataPointSelected=function(e){var i=this.getSelection(e.itemIds);return!!i&&i.isSelected(t.flatten(e.tuple))},u._isEdgeSelected=function(e){var i=this,n=t.chain(t.map(this._getVisualization().getSlots().getDataItemList(),(function(e){var n=e.getColumnId(),o=function(t){return i._getController().getSelectedTuples([t])}(n);return t.map(o,(function(e){return e.label=t.isUndefined(e.label)?e.d:e.label,e.value=t.isUndefined(e.value)?e.u:e.value,{columnId:n,tupleItem:e}}))}))).flatten().filter((function(t){return!!t.tupleItem})).value(),o=!0,r=t.pluck(e,"categories");return t.each(r,(function(e){t.each(e,(function(e){o=!!o&&!!t.find(n,(function(t){return t.columnId===e.columnId&&t.tupleItem.u===e.value}))}))})),o},u.getSelection=function(t,e){return t||(t=r.getColumnIdList(this._getVisualization().getSlots().getMappedSlotList(),"attribute")),this._getSelected(t,e)},u._getSelected=function(t,e){if(!this._getVisualization().getDataSource())return null;var i=this._getVisualization().getDataSource(),n=new a({pageContextAPI:this._getPageContext(),selectionProvider:this._selectionProvider,itemIds:Array.isArray(t)?t:[t],scope:this._getScope(),eventGroupId:this._getEventGroupId(),sourceId:i&&i.getId(),includeParents:!(!e||!0!==e.includeParents),ignoreEdgeSelections:!(!e||!0!==e.ignoreEdgeSelections)});return n.hasSelections()?n.getAPI():null},c}(o)})),define("dashboard-analytics/view/features/content/liveWidgetDOM/api/LiveWidgetDOMAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getUIJSON=function(){},e.registerProvider=function(){},t}()})),define("dashboard-analytics/view/features/content/liveWidgetDOM/LiveWidgetDOM",["./api/LiveWidgetDOMAPI","jquery","../../../../lib/@waca/dashboard-common/dist/core/APIFactory"],(function(t,e,i){return function(){function n(t){this._domNode=t.features.ContentViewDOM.getNode(),this.providers=[]}var o=n.prototype;return o.getAPI=function(){return this._api||(this._api=i.createAPI(this,[t])),this._api},o.getUIJSON=function(){var t={widgetIcons:this._retrieveWidgetIcons(),title:this._retrieveTitle()};return this.providers.forEach((function(e){Object.assign(t,e.getUIJSON())})),t},o.registerProvider=function(t){this.providers.push(t)},o._retrieveWidgetIcons=function(){var t=e(this._domNode).find(".widgetHeader div.widgetIcons .dataWidgetIcon"),i=[];return t.length&&t.each((function(t,n){var o=e(n),r=o.attr("title"),s=o.attr("aria-label");o.is(":visible")&&(r&&s&&r===s?i.push({label:r}):i.push({label:null}))})),i.length?i:void 0},o._retrieveTitle=function(){var t,i=e(this._domNode).find(".widgetHeader .widgetTitle .textArea");if(i&&i.length&&i.is(":visible")){var n=i.find("span.textFitted p span");t={value:n.text(),fontSize:n.css("font-size"),fontFamily:n.css("font-family"),alignment:n.css("text-align")}}return t},n}()})),define("dashboard-analytics/features/content/visIndicators/api/VisIndicatorsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.registerProvider=function(){},e.getIndicatorList=function(){},e.registerEventHandler=function(){},e.deregisterEventHandler=function(){},e.handleEvents=function(){},t}()})),define("dashboard-analytics/features/content/visIndicators/VisIndicators",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/VisIndicatorsAPI","underscore"],(function(t,e,i){return function(){function n(){this.api=t.createAPI(this,[e]),this.providers=[],this.eventHandlers={}}var o=n.prototype;return o.registerProvider=function(t){this.providers.push(t)},o.getIndicatorList=function(){var t=[];return i.each(this.providers,(function(e){e.getIndicatorList&&t.push.apply(t,e.getIndicatorList())})),t},o.registerEventHandler=function(t,e,i){(void 0===i&&(i=null),this.getIndicatorList().find((function(e){return e.name===t})))&&(this.eventHandlers[t]||(this.eventHandlers[t]=[]),!!this.eventHandlers[t].find((function(t){return t.handler===e&&t.thisArg===i}))||this.eventHandlers[t].push({handler:e,thisArg:i}))},o.deregisterEventHandler=function(t,e,i){if(void 0===i&&(i=null),this.eventHandlers[t]){for(var n=this.eventHandlers[t].length-1;n>-1;n--){var o=this.eventHandlers[t][n],r=o.handler===e,s=!i||o.thisArg===i;r&&s&&this.eventHandlers[t].splice(n,1)}0===this.eventHandlers[t].length&&delete this.eventHandlers[t]}},o.handleEvents=function(t,e){if(!this.eventHandlers[t]||0===this.eventHandlers[t].length)return!1;for(var i,n=!1,o=_createForOfIteratorHelperLoose(this.eventHandlers[t]);!(i=o()).done;){var r=i.value;n=r.handler.call(r.thisArg,e)||n}return n},o.getAPI=function(){return this.api},n}()})),define("text!dashboard-analytics/features/content/infoIndicator/templates/InfoIndicator.html",[],(function(){return'<div class="dataWidgetIcon geodata-unavailable hideIndicator" tabindex="0" style="display: none;">\n\t<div title="{{!it.title}}" aria-label="{{!it.title}}" class="warningIcon">\n\t\t<svg class="svgIcon" role="img" aria-label="Warning" focusable="false">\n\t\t\t<use style="pointer-events: none;" xlink:href="#{{=it.iconId}}"></use>\n\t\t</svg>\n\t</div>\n</div>\n'})),define("dashboard-analytics/features/content/infoIndicator/api/InfoIndicatorAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.update=function(){},e.clearMessagesByIdAndSubtype=function(){},e.clearMessagesWithIds=function(){},e.reset=function(){},t}()})),define("text!dashboard-analytics/features/content/infoIndicator/templates/InfoList.html",[],(function(){return'<div class="infoContainer" style="overflow:hidden">\n{{\n\tvar firstMessage = true;\n}}\n{{~it.messages :msg}}\n\t<div class="infoMessage">\n\t\t{{? firstMessage === false}}\n\t\t\t<hr style="margin-top:10px;margin-bottom:10px"></hr>\n\t\t{{??}}\n\t\t\t{{\n\t\t\t\tfirstMessage = false;\n\t\t\t}}\n\t\t{{?}}\n\t\t<div class="infoDataMessagesTitle">{{!msg.label}}</div>\n\t\t<div class="infoDataScrollable{{?it.small}} smallMessage{{?}}" id="{{!msg.id}}">\n\t\t\t<ul>\n\t\t\t{{~msg.items :item}}\n\t\t\t\t{{? item.isSubMessage === true}}\n\t\t\t\t\t<li class=\'infoDataMessagesItemText  subMessage\' id="{{!item.id}}">{{!item.label}}</li>\n\t\t\t\t{{??}}\n\t\t\t  \t<li class=\'infoDataMessagesItemText\' id="{{!item.id}}">{{!item.label}}</li>\n\t\t\t\t{{?}}\n\t\t\t{{~}}\n\t\t\t</ul>\n\t\t</div>\n\t</div>\n{{~}}\n</div>\n'})),define("dashboard-analytics/features/content/infoIndicator/InfoFlyoutView",["jquery","doT","../../../lib/@waca/dashboard-common/dist/utils/FlyoutContentBase","text!./templates/InfoList.html"],(function(t,e,i,n){"use strict";var o=e.template(n),r=i.extend([],{init:function(t){r.inherited("init",this,arguments),this.setMessages(t.viewOptions.messages)},setMessages:function(t){this.messages=t},setFocus:function(){t(".infoDiv").next().first("li").focus()},onPopupShown:function(){this.onPopupClosed();t(".infoDataScrollable").on("mousewheel DOMMouseScroll",(function(t){var e=t.originalEvent,i=e.wheelDelta||-e.detail;this.scrollTop+=10*(i<0?1:-1),t.preventDefault()}))},getRenderedHtml:function(){return o({messages:this.messages,small:this.messages.length>1})}});return r})),define("dashboard-analytics/features/content/infoIndicator/InfoIndicator",["underscore","jquery","doT","text!./templates/InfoIndicator.html","../../../lib/@waca/dashboard-common/dist/core/APIFactory","../visIndicators/api/VisIndicatorsProviderAPI","./api/InfoIndicatorAPI","./InfoFlyoutView","../../../lib/@waca/dashboard-common/dist/utils/Flyout","../../../widgets/livewidget/nls/StringResources"],(function(t,e,i,n,o,r,s,a,l,c){var u=i.template(n);return function(){function i(t){var e=t.content,i=t.features;this.content=e,this.features=i,this.features.VisIndicators.registerProvider(this.getAPI())}var n=i.prototype;return n.getIndicator=function(){if(!this.$indicatorIcon){var t=this.features.Icons.getIcon("warnIcon");this.messages={},this.$indicatorIcon=e(u({title:c.get("warning"),iconId:t.id}));var i=this._onClick.bind(this);this.$indicatorIcon.on("tap keydown click",i)}return this.$indicatorIcon},n.destroy=function(){this.$indicatorIcon=null,this.flyout&&(this.flyout.destroy(),this.flyout=null)},n.getAPI=function(){return this._api||(this._api=o.createAPI(this,[r,s])),this._api},n.getIndicatorList=function(){return[{name:"infoIconDiv",icon:this.getIndicator()}]},n.update=function(t){this._addInfo(t)},n._addInfo=function(e){var i=this,n=t.filter(e,(function(t){return t.items.length>0}));t.each(n,(function(t){i.messages[t.id]=t})),t.isEmpty(this.messages)?this._hideIndicator():this.getIndicator().show()},n.reset=function(){this.messages={},this._hideIndicator()},n._hideIndicator=function(){this.$indicatorIcon&&this.$indicatorIcon.hide()},n.clearMessagesByIdAndSubtype=function(t){var e=this,i=t.id,n=t.type;Object.values(this.messages).forEach((function(t){for(var o=0;o<t.items.length;o++)t.items[o].id===i&&t.items[o].type===n&&(t.items.splice(o,1),0===t.items.length&&e.clearMessagesWithIds([t.id]))}))},n.clearMessagesWithIds=function(e){var i=this;this.messages&&e.forEach((function(t){i.messages[t]&&delete i.messages[t]})),t.isEmpty(this.messages)&&this._hideIndicator()},n._closeFlyout=function(){this.flyout.close()},n._onClick=function(e){if("keydown"===e.type){e.stopPropagation();var i=e.key||e.keyCode||e.which||"";if("Enter"!==i&&"KEY_ENTER"!==i)return}e.gesture&&e.gesture.preventDefault(),e.cancelable&&e.preventDefault(),this.flyout?this.flyout.view.setMessages(t.values(this.messages)):this.flyout=new l({alignment:"center",selector:this.getIndicator(),flyoutClass:"filterPopover visTopPopover",viewClass:a,viewOptions:{messages:t.values(this.messages)}}),this.flyout.open(),e.stopPropagation()},i}()})),define("dashboard-analytics/features/content/pdfPrintAction/PdfPrintPropertiesProvider",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../lib/@waca/dashboard-common/dist/api/PropertiesProviderAPI","../../../widgets/livewidget/nls/StringResources"],(function(t,e,i){var n=[{label:i.get("PdfPrintInViewLabel"),value:"inView"},{label:i.get("PdfPrintExtendedContentLabel"),value:"extendedContent"},{label:i.get("PdfPrintNewPageLabel"),value:"newPage"}];return function(){function o(t){var e=t.content,i=t.dashboardAPI,n=t.features;this.content=e,this.visualization=n.Visualization,this.content&&n.Properties.registerProvider(this.getAPI()),this.featureChecker=i&&i.getGlassCoreSvc(".FeatureChecker")}var r=o.prototype;return r.getAPI=function(){return this._api||(this._api=t.createAPI(this,[e])),this._api},r.destroy=function(){this.content=null,this.featureChecker=null},r.getPropertyLayoutList=function(){var t=[];return this._isSupported()&&t.push({id:"PdfPrinting",type:"Section",label:i.get("PdfPrintSectionLabel"),position:1}),t},r.getPropertyList=function(){var t=this,e=[];if(this._isSupported()){var o=this._isV2PropertiesEnabled()?"PdfPrinting":"general.PdfPrinting";e.push({id:"PdfPrint",editor:{sectionId:o,uiControl:{type:"DropDown",label:i.get("PdfPrintOptionsLabel"),ariaLabel:i.get("PdfPrintOptionsLabel"),onChange:function(e,i){t.content.setPropertyValue(e,i)},readOnly:!0,options:n}},onPropertyChange:{refresh:{data:!0}},supportsUndoRedo:!0,defaultValue:n[0].value})}return e},r._isSupported=function(){return this.featureChecker&&this.featureChecker.checkValue("dashboard","pdf2.0","enabled")},r._isV2PropertiesEnabled=function(){return!(!this.featureChecker||!this.featureChecker.checkValue("dashboard","PropertiesV2","enabled"))},o}()})),define("dashboard-analytics/lib/@waca/dashboard-common/dist/api/CustomColorProviderAPI",[],(function(){return function(){function t(){_classCallCheck(this,t)}return t.prototype.getCustomColorList=function(){},t}()})),define("dashboard-analytics/features/content/visPropertyProvider/VisPropertyProvider",["underscore","../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../lib/@waca/dashboard-common/dist/api/CustomColorProviderAPI","../../../lib/@waca/dashboard-common/dist/api/PropertiesProviderAPI","../../../util/TransactionUtil"],(function(t,e,i,n,o){return function(){function r(t){this.features=t.features,this.content=t.content,this.dashboard=t.dashboardAPI,this.features.Properties.registerProvider(this.getAPI()),this.model=this.content.getFeature("Models.internal").getWidgetModel(),this.content.on("change:visualization:type",this.onVisualizationTypeChange,this),this._customColorProvider=e.createAPI(this,[i]),this.features["Dashboard.CustomColor"].registerProvider(this._customColorProvider),this._customColorProperties=new Set}var s=r.prototype;return s.getAPI=function(){return this._api||(this._api=e.createAPI(this,[n])),this._api},s.destroy=function(){this.features["Dashboard.CustomColor"].deregisterProvider(this._customColorProvider),this.content.off("change:visualization:type",this.onVisualizationTypeChange,this),this.content=null},s.onVisualizationTypeChange=function(){this._propertyList=null,this._propertyLayoutList=null},s.getWidget=function(){return this.content},s._getPropertyFromRawDefinition=function(t){var e=this.content.getFeature("Visualization").getDefinition(),i=e&&e.getProperty(t);if(i)return JSON.parse(JSON.stringify(i))},s.modifyPropertyWithSetterAndGetter=function(e){var i=this,n=this._getVisPropertySupport();t.extend(e,{getPropertyValue:function(){return n.getPropertyValue(e.id)},setPropertyValue:function(t,n){i.updateProperty({id:e.id,value:t},n)}})},s.isAnOverridableVisProperty=function(t){return!{fillColor:!0,borderColor:!0,transparency:!0,showTitle:!0,saveTitle:!0,queryRefresh:!0,"datagrid.viewOption":!0,"value.graphic.content":!0,"value.graphic.currentScaleOption":!0,"value.graphic.fillColor":!0,"value.graphic.borderColor":!0}[t]},s.updateProperty=function(e,i){if(this.isAnOverridableVisProperty(e.id)){var n=this.dashboard.getFeature("internal").getBoardModel(),r=o.transactionTokenToOptions(i),s=t.extend({},r,n.getLanguageModelOptions(!0));s.payloadData||(s.payloadData={}),s.payloadData.skipUndoRedo=!0;var a=this.content.getFeature("Models.internal").getWidgetModel();if(void 0===e.value)a.properties.get(e.id).set({value:void 0});else a.properties.set(e,t.extend({merge:!0,remove:!1},s))}},s._getVisPropertySupport=function(){return this.features["Visualization.legacy"].getLegacyManagers().visPropertySupport},s.getCustomColorList=function(){for(var t=[],e=this.getPropertyList(),i=this.features["Dashboard.Colors"],n=0;n<e.length;n++){var o=e[n].id;if(this._customColorProperties.has(o)){var r=this.content.getPropertyValue(o);r&&t.push(i.getHexColorFromClassName(r))}}return t},s.getPropertyList=function(){var t=this;if(!this._propertyList){var e=this._getPropertyFromRawDefinition("propertyList");e&&e.length>0?e.forEach((function(e){if(t.isAnOverridableVisProperty(e.id)&&(t.modifyPropertyWithSetterAndGetter(e),e.editor&&e.editor.uiControl&&("ColorPicker"===e.editor.uiControl.type&&e.editor.uiControl.addButton&&t._customColorProperties.add(e.id),e.editor.uiControl.multilingual))){var i=t.dashboard.getFeature("TranslationService");if(i){var n=(t.model.getMultilingualAttribute(e.id)||{}).multilingualProperty;i.processMultilingualProperty(e,n)}}})):e=[],this._propertyList=e}return this._propertyList},s.getPropertyLayoutList=function(){if(!this._propertyLayoutList){var t=this._getPropertyFromRawDefinition("propertyLayoutList");this._propertyLayoutList=t||[]}return this._propertyLayoutList},s.reset=function(){},r}()})),define("dashboard-analytics/api/CachingPropertiesProviderAPI",[],(function(){return function(){function t(){}return t.prototype.reset=function(){},t}()})),define("dashboard-analytics/features/content/viprPropertyProvider/ViprPropertyProvider",["underscore","../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../lib/@waca/dashboard-common/dist/api/PropertiesProviderAPI","../../../api/CachingPropertiesProviderAPI","../../../visualizations/vipr/properties/VIPRProperties","../../../util/TransactionUtil"],(function(t,e,i,n,o,r){return function(){function s(t){this.content=t.content,this.dashboard=t.dashboardAPI,this.features=t.features,t.features.Properties.registerProvider(this.getAPI()),this.model=this.content.getFeature("Models.internal").getWidgetModel(),this.content.on("change:visualization:type",this.onVisualizationChange,this),this.content.on("change:visualization:slots",this.onVisualizationChange,this),this.content.on("change:property",this.onVisualizationChange,this),this.dashboard.on("widget:maximize",this.onVisualizationChange,this),this.dashboard.on("widget:restore",this.onVisualizationChange,this),this.VisDefinitions=this.dashboard.getFeature("VisDefinitions");var e=this.dashboard.getGlassCoreSvc&&this.dashboard.getGlassCoreSvc(".FeatureChecker");this.isPropertiesV2Enabled=e&&e.checkValue("dashboard","PropertiesV2","enabled"),this.VisDefinitions.on("refresh:definition",this.onVisualizationChange,this),this.visualization=t.features.Visualization,this.content.on("change:state:status",this.onRenderStateChange,this),this._isChanged=!0}var a=s.prototype;return a.getAPI=function(){return this._api||(this._api=e.createAPI(this,[i,n])),this._api},a.destroy=function(){this.content.off("change:state:status",this.onRenderStateChange,this),this.content.off("change:visualization:type",this.onVisualizationChange,this),this.content.off("change:visualization:slots",this.onVisualizationChange,this),this.content.off("change:property",this.onVisualizationChange,this),this.dashboard.off("widget:maximize",this.onVisualizationChange,this),this.dashboard.off("widget:restore",this.onVisualizationChange,this),this.VisDefinitions.off("refresh:definition",this.onVisualizationChange,this),this.content=null},a.reset=function(){this._isChanged=!1,this._propertyList=null,this._propertyLayoutList=null},a.onRenderStateChange=function(t){this._isChanged&&"rendered"===t.info.value&&(this.contentRendered=!0,this.reset())},a.onVisualizationChange=function(t){this._isChanged=!0,"change:visualization:type"===t.name&&(this.contentRendered=!1)},a._getLivewidgetInternal=function(){return this.livewidgetInternal||(this.livewidgetInternal=this.content.getFeature("livewidget.internal")),this.livewidgetInternal},a._getView=function(){var t=this._getLivewidgetInternal();return t&&t.getVisView()},a._isVIPR=function(){var t=this.visualization.getDefinition().getProperty("renderer");return t&&-1!==t.indexOf("VIPRView")},a.modifyPropertyWithSetterAndGetter=function(e){var i=this,n=this.content.getFeature("Visualization.legacy").getLegacyManagers().visPropertySupport;t.extend(e,{getPropertyValue:function(){return n.getPropertyValue(e.id)},setPropertyValue:function(t,n){i.updateProperty({id:e.id,value:t},n)},supportsUndoRedo:!0})},a.isAnOverridableVisProperty=function(t){return!{fillColor:!0,borderColor:!0,transparency:!0,showTitle:!0,saveTitle:!0,queryRefresh:!0}[t]},a.updateProperty=function(e,i){if(this.isAnOverridableVisProperty(e.id)){var n=this.dashboard.getFeature("internal").getBoardModel(),o=r.transactionTokenToOptions(i),s=t.extend({},o,n.getLanguageModelOptions(!0)),a=this.content.getFeature("Models.internal").getWidgetModel();if(e.id.indexOf("colorPalette")>-1&&this.features.LiveWidgetSegment&&this.features.LiveWidgetSegment.track({category:"colorPalette",visualization:this.content.getFeature("Visualization"),content:this.content,info:{propertyId:e.id,previousValue:this.content.getPropertyValue(e.id),newValue:e.value}}),void 0===e.value)a.properties.get(e.id).set({value:void 0},t.extend({merge:!0,remove:!1,silent:!0},s));else a.properties.set(e,t.extend({merge:!0,remove:!1,silent:!0},s))}},a.getPropertyList=function(){var e=this;if(!this._propertyList&&this._isVIPR()){var i,n=this._getView();if(n&&this.contentRendered)i=n.getPropertyList();else{var r=this.visualization.getSlots().getSlotList(),s=this.visualization.getDefinition().getProperty("vizDefProperties");i=o.getInstance().getPropertyList(s,r,this.content,this.dashboard,this.isPropertiesV2Enabled)}if(i){var a=t.map(i,(function(i){var n=t.extend({},i);if(e.modifyPropertyWithSetterAndGetter(n),n.editor&&n.editor.uiControl&&n.editor.uiControl.multilingual){var o=e.dashboard.getFeature("TranslationService");if(o){var r=(e.model.getMultilingualAttribute(n.id)||{}).multilingualProperty;o.processMultilingualProperty(n,r)}}return n}));this._propertyList=a}}return this._propertyList},a.getPropertyLayoutList=function(){if(!this._propertyLayoutList&&this._isVIPR()){this._propertyLayoutList=[];var t=this._getView();if(t&&this.contentRendered)this._propertyLayoutList=t.getPropertyLayoutList();else{var e=this.visualization.getSlots().getSlotList(),i=this.visualization.getDefinition().getProperty("vizDefProperties");this._propertyLayoutList=o.getInstance().getPropertyLayoutList(i,e,this.content,this.dashboard,this.isPropertiesV2Enabled)}}return this._propertyLayoutList},s}()})),define("dashboard-analytics/features/content/slotActions/api/SlotActionsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.registerProvider=function(){},e.getSlotActionList=function(){},t}()})),define("dashboard-analytics/features/content/slotActions/SlotActions",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","./api/SlotActionsAPI","underscore"],(function(t,e,i){return function(){function n(){this.api=t.createAPI(this,[e]),this.providers=[]}var o=n.prototype;return o.registerProvider=function(t,e){this.providers[t]=e},o.getSlotActionList=function(t,e,n){var o=n&&n.actionOptions||{},r=n&&n.actionsToKeep||[],s=[];for(var a in this.providers){var l=this.providers[a];if(l.getSlotActionList){var c,u=null;try{u=l.getSlotActionList(t,e,o[a])}catch(t){console.log(t)}if(!i.isEmpty(u))(c=s).push.apply(c,u)}}return r.length&&(s=s.filter((function(t){return i.contains(r,t.id||t.group||t.name)||"delete"===t.name}))),s},o.getAPI=function(){return this.api},n}()})),define("dashboard-analytics/features/content/dataPointActions/drillAction/DrillAction",["../../common/DataPointActionBase","../api/DataPointActionsProviderAPI","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../../widgets/livewidget/nls/StringResources","underscore"],(function(t,e,i,n,o){return function(t){function r(e){var i;return(i=t.call(this,e)||this).content.getFeature("DataPointActions").registerProvider("DrillAction",i.getAPI()),i.features=e.features,i}_inheritsLoose(r,t);var s=r.prototype;return s.getAPI=function(){return this._api||(this._api=i.createAPI(this,[e])),this._api},s.getDataPointActionList=function(t,e){var i=[],o=this.features["Dashboard.Icons"].getIcon("dashboard-navigation-drillback"),r=this.features["Dashboard.Icons"].getIcon("dashboard-navigation-drilldown");if(this._supportAction(t,e)){var s=!this._canDrillDown(t),a=!this._canDrillUp(t);i.push.apply(i,[{name:"drillUp",label:n.get("toolbarActionDrillUp"),text:n.get("toolbarActionDrillUp"),icon:o.id,type:"Button",closeOnActionApplied:!0,disabled:a,actions:{apply:this.drillUp.bind(this,t)}},{name:"drillDown",label:n.get("toolbarActionDrillDown"),text:n.get("toolbarActionDrillDown"),icon:r.id,type:"Button",closeOnActionApplied:!0,disabled:s,actions:{apply:this.drillDown.bind(this,t)}}])}return i},s._getVisualization=function(){return this.visualization||(this.visualization=this.content.getFeature("Visualization")),this.visualization},s._getSelectedCategories=function(t){return o.compact(o.pluck(t.dataPoints,"categories"))},s._supportAction=function(t,e){void 0===t&&(t=[]),void 0===e&&(e={});var i=!e.noFilters||e.drillOnly;if(!i)return i;var n=this._getSelectedCategories(t);if(!(i=n&&1===n.length&&1===n[0].length))return i;var o=n[0][0].columnId,r=this._getVisualization().getDataSource().getMetadataColumn(o);return r&&(r.isHierarchy()||r.isNamedSet())},s._getSelectionMappingInfo=function(t){var e=this._getVisualization().getSlots(),i=this._getSelectedCategories(t)[0][0].dataItemId;return e.getMappingInfo(i)},s._executeDrill=function(t,e){var i=this.dashboard.getFeature("Transaction"),n=i.startTransaction();return this._getVisualization().getLocalFilters().removeFilter({itemId:t.getColumnId()},n),e(n).finally((function(){i.endTransaction(n)}))},s.drillUp=function(t){var e=this._getSelectionMappingInfo(t).dataItem,i=this._getSelectedCategories(t)[0][0].parentId;this._executeDrill(e,(function(t){return e.drillUp(i,t)}))},s.drillDown=function(t){var e=this._getSelectionMappingInfo(t).dataItem,i=this._getSelectedCategories(t),n=i[0][0].value,o=i[0][0].parentId;this._executeDrill(e,(function(t){return e.drillDown(n,t,o)}))},s._canDrillDown=function(t){return this._getSelectionMappingInfo(t).dataItem.canDrillDown()},s._canDrillUp=function(t){return void 0!==this._getSelectedCategories(t)[0][0].parentId},r}(t)})),define("dashboard-analytics/features/content/dataPointActions/hideRowColumnAction/HideRowColumnAction",["underscore","../../../../widgets/livewidget/nls/StringResources","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../api/DataPointActionsProviderAPI","../../../../lib/@waca/dashboard-common/dist/api/ContentActionsProviderAPI","../../../../util/ContentUtil"],(function(t,e,i,n,o,r){var s=["crosstab"];return function(){function a(t){var e=t.dashboardAPI,i=t.content,n=t.features;this.dashboard=e||n&&n.API,this.features=n,i?(this.content=i,n&&n.DataPointActions.registerProvider("HideRowColumnAction",this.getAPI())):n&&n.ContentActions.registerProvider("HideRowColumnAction",this.getAPI())}var l=a.prototype;return l._getIcons=function(){return this.features.Icons||this.features["Dashboard.Icons"]},l.getDataPointActionList=function(t,i){if(this._isLocalVis()&&this._supportDataPointAction()&&i.isAreaSelected){if(this.selectedArea=r.getContextFromSelection(this.content,this.dashboard,t),!this.selectedArea.length)return[];this.isAreaSelected=!0;var n=this._getIcons().getIcon("iconHide");return this._getContribution("Datapoint",e.get("hideRowColumn"),n,!1)}return[]},l._supportDataPointAction=function(){return!this.content.getFeature("state").getError()&&this.dashboard.getMode()===this.dashboard.MODES.EDIT},l.getContentActionList=function(t){var i=t[0];if(this.content=this.dashboard.getCanvas().getContent(i),this._isLocalVis()&&this._supportContentAction(t)){var n=this._getIcons().getIcon("iconView");return this._getContribution("Content",e.get("showAllRowColumn"),n,this._isHidden())}return[]},l._getContribution=function(t,e,i,n){var r,s=this;return[{name:"hideRowColumnAction"+t,label:e,text:e,icon:i.id,type:"Button",closeOnActionApplied:!0,disabled:n,section:o.ACTION_SECTION.SELECTION_VIZ_FORMAT,order:30,actions:{apply:this.onStateChange.bind(this)},callbacks:{registerCallback:function(t){r=function(){t.updateState({disabled:s._isHidden()})},s.content.on("change:property:hiddenRowsAndColumns",r)},unregisterCallback:function(){s.content.off("change:property:hiddenRowsAndColumns",r)}}}]},l._supportContentAction=function(t){return!(t&&t.length>1||this.content.getFeature("state").getError()||this.dashboard.getMode()!==this.dashboard.MODES.EDIT)},l._isLocalVis=function(){var e=this.content.getFeature("Visualization"),i=e&&e.getDefinition().getId();return!!i&&t.contains(s,i)},l.onStateChange=function(){var t=[];t=this._buildPropertyList(t);var e=this.dashboard.getFeature("Transaction").startTransaction();this.setProperties(t,e),this._removeFilters(e),this.dashboard.getFeature("Transaction").endTransaction(e)},l._isHidden=function(){return t.isEmpty(this.content.getPropertyValue("hiddenRowsAndColumns")||[])},l._buildPropertyList=function(e){var i=[];if(this.isAreaSelected){var n=this.content.getPropertyValue("hiddenRowsAndColumns")||[];i=t.union(this.selectedArea,n)}return e.push({id:"hiddenRowsAndColumns",value:i}),e},l.setProperties=function(t,e){var i=this;t.forEach((function(t){i.content.setPropertyValue(t.id,t.value,e)}))},l._removeFilters=function(t){this.dashboard.getFeature("GlobalFilters").removeFilters(r.getSelectors(this.content,this.dashboard),t)},l.getAPI=function(){return this._api?this._api:i.createAPI(this,[n,o])},a}()})),define("dashboard-analytics/features/content/slotActions/autoBinAction/BinAction",["../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../../widgets/livewidget/nls/StringResources","../api/SlotActionsProviderAPI","../../../../apiHelpers/SlotAPIHelper"],(function(t,e,i,n){var o=function(){function o(t){var e=t.content,i=t.features;this.content=e,this.features=i,this.dashboard=this.features["Dashboard.API"],this.features.SlotActions.registerProvider("autoBinAction",this.getAPI()),this.logger=this.dashboard.getGlassCoreSvc(".Logger")}var r=o.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[i])),this.api},r._isOlap=function(t,e){return!!(t.isOlapPackage()||e&&e.getMetadataColumn().isOlapColumn())},r._supportAction=function(t,e){var i=this.features.Visualization,o=i.getDataSource(),r=t.getDataItemList()[e],s=this._isOlap(o,r),a=!o||s,l=i.getDefinition().getProperty("binningConfig"),c=!(Array.isArray(e)&&e.length>1)&&-1!==e&&(!l||!1!==l.auto)&&!a&&!(n.isMultiMeasuresSeriesSlot(t)||n.isMultiMeasuresValueSlot(t))&&n.doesDataItemSupportBinning(t,r);if(c){var u=r.getBinning(),d=u?u.baseColumnId:r.getColumnId(),h={basedOnMoserObjectId:d};c=this._getCustomBinUI().validateCustomBinning(o.getId(),d,h)}return c},r._getViewState=function(t,e){var i=this.features.Visualization.getDefinition();if(t){var n=i.getProperty("binningConfig"),r=t.getDataItemList()[e];if(r)return{height:280,width:400,defaultNumberOfBins:n&&n.defaultNumberOfBins||o.DEFAULT_NUMBER_OF_BINS,binningStateCb:this._binningStateCallback.bind(this,r)}}return null},r._binningStateCallback=function(t){var e=t.getBinning();if(e){var i=t&&t.getMetadataColumn(),n=this._getCustomBinUI().getCustomBinning(i.getSourceId(),e.columnId);return n?_extends({},e,{bins:n.numberOfBins}):e}return e},r._findDataItemIndex=function(t){var e=-1;t.getDataItemList().length>0&&(e=t.getDataItemList().findIndex((function(t){if(t.getBinning())return!0;var e=t.getMetadataColumn();return!(!e||"fact"!==e.getType())||void 0})));return e},r.getSlotActionList=function(t,i){var n=this.features.Visualization.getSlots().getSlot(t);null==i&&(i=this._findDataItemIndex(n));var o=n.getDataItemList()[i];if(n&&this._supportAction(n,i)){var r=this._getViewState(n,i),s=this.features["Dashboard.Icons"].getIcon("dashboard-autobin");return[{name:"autoBinAction",targetCaption:o&&o.getLabel(),label:e.get("autoBinActionText"),icon:s.id,type:"NextView",view:{module:"dashboard-analytics/dialogs/AutobinDialog",state:r},actions:{apply:this._applyBinning.bind(this,n,i)}}]}return[]},r._getMoserDataSources=function(){return this._moserDataSources||(this._moserDataSources=this.features["DataSources.moser"]),this._moserDataSources},r._ensureTemporaryModule=function(t){return this._getMoserDataSources().ensureTemporaryModule(t)},r._applyBinningState=function(t,e,i,n){var o=t.getDataItemList()[e],r=o&&o.getMetadataColumn();if(i){var s=o.getBinning();return this.createCustomBinning(o,r,i.numberOfBins,n).then((function(t){t&&o.setBinning(_extends({},s,{bins:i.numberOfBins,label:t.getLabel(),columnId:t.getId()}),n)}))}return this.removeCustomBinning(r,o,n).then((function(){o.setBinning(null,n)}))},r._applyBinning=function(t,e,i){var n=this,o=this.features["Dashboard.Transaction"].startTransaction();this._applyBinningState(t,e,i,o).finally((function(){n.features["Dashboard.Transaction"].endTransaction(o)}))},r._updateCustomBinningSpec=function(t,e){return e.numberOfBins=t.toString(),e},r._getCustomBinningSpec=function(t){var e=t.getBinning();return e?{basedOnMoserObjectId:e.baseColumnId}:null},r._createCustomBinningSpec=function(t){return{numberOfBins:t.toString()}},r.createCustomBinning=function(t,e,i,n){var o=this;return this._ensureTemporaryModule(e.getSourceId()).then((function(){var r=t.getColumnId(),s=o._createCustomBinningSpec(i),a=!1,l=o._getCustomBinningSpec(t);return l&&(s=o._updateCustomBinningSpec(i,l),a=!0),o._getCustomBinUI().createCustomBinning(e.getSourceId(),r,a,s,n).then((function(t){return Promise.resolve(t)})).catch((function(t){return o._handleMUIDialogErrors(t,"createCustomBinningErrorToast"),Promise.resolve(null)}))}))},r._handleMUIDialogErrors=function(t,i){var n=this,o=t.messages||[];o.length>0?o.forEach((function(t){n.logger.error(t.messageHint,n)})):this.logger.error(t,this);this.dashboard.showToast(e.get(i),{type:"error",preventDuplicates:!0})},r._getCustomBinUI=function(){return this._uiDataSources||(this._uiDataSources=this.features["DataSources.CustomBinUI"]),this._uiDataSources},r.removeCustomBinning=function(t,e,i){var n=this;return e.getBinning()?this._getCustomBinUI().removeCustomBinning(t.getSourceId(),e.getColumnId(),i).then((function(){return!0})).catch((function(t){return n._handleMUIDialogErrors(t,"removeCustomBinningErrorToast"),!1})):Promise.resolve(!1)},o}();return o.DEFAULT_NUMBER_OF_BINS=10,o})),define("dashboard-analytics/features/content/slotActions/filterAction/FilterAction",["../../../../widgets/livewidget/nls/StringResources","../../../../apiHelpers/SlotAPIHelper","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../api/SlotActionsProviderAPI"],(function(t,e,i,n){return function(){function o(t){var e=t.content,i=t.dashboardAPI,n=t.features;this.content=e,this.dashboard=i,this.features=n,this.content.getFeature("SlotActions").registerProvider("filterAction",this.getAPI())}var r=o.prototype;return r.getAPI=function(){return this.api||(this.api=i.createAPI(this,[n])),this.api},r._isDataFiltersEnabled=function(){return this.dashboard.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","DataFilters","enabled")},r.getSlotActionList=function(e,i,n){void 0===i&&(i=0),void 0===n&&(n={});var o=this.getVisualization(),r=o.getSlots().getSlot(e),s=r.getDataItemList()[i],a=this.features["Dashboard.Icons"].getIcon("common-filter");if(r&&this._supportAction(r,i,n)){void 0===i&&(i=0),this.itemContext={uniqueId:s.getId(),itemId:s.getColumnId(),itemName:s.getLabel(),dataType:s.getDataType(),sourceId:o.getDataSource().getId()},"fact"===s.getType(i)&&(this.itemContext.aggregationType=s.getAggregation());var l=s.getMetadataColumn();l&&l.isNamedSet()&&(this.itemContext.isNamedSet=!0);var c={height:300,width:212,slot:r,mapIndex:i,logger:this.dashboard.getGlassCoreSvc(".Logger"),itemContext:this.itemContext,dashboardApi:this.dashboard,content:this.content,visualization:this.getVisualization(),showBoxShadow:!0};return[{name:"filter",targetCaption:s.getLabel(),label:t.get("toolbarActionFilter"),icon:a.id,type:"NextView",removeThenApplyAction:!0,showHeading:!1,view:{module:"dashboard-analytics/dialogs/CommonViewWrapper",state:c},actions:{apply:this.applyFilter.bind(this),edit:this.editFilter.bind(this),remove:this.removeFilter.bind(this)}}]}return[]},r._supportAction=function(t,i){var n=this.getVisualization();if(Array.isArray(i)&&1!=i.length)return!1;if(!1===n.getDefinition().getProperty("supportsFilterAction"))return!1;if(void 0!==i&&e.isMultiMeasureSeriesDataItem(t,i))return!1;if(void 0===i&&(e.isMultiMeasuresSeriesSlot(t)||e.isMultiMeasuresValueSlot(t)))return!1;var o=t.getDataItemList()[i];return!(!o||!o.getMetadataColumn())},r.applyFilter=function(t){this.getVisualization().getLocalFilters().addFilter(this.itemContext,t)},r.editFilter=function(t){this.getVisualization().getLocalFilters().editFilter(this.itemContext,t)},r.removeFilter=function(){this.getVisualization().getLocalFilters().removeFilter(this.itemContext)},r.getVisualization=function(){return this.visualization||(this.visualization=this.content.getFeature("Visualization")),this.visualization},o}()})),define("dashboard-analytics/widgets/livewidget/dialogs/components/SortableList",["../../nls/StringResources","react-dom","react","@ba/ba-ui-carbon-toolkit","corsair_ship/ba-react-html5-dnd"],(function(t,e,i,n,o){"use strict";var r=n.SVGIcon,s=n.Container,a=n.FlexLayout,l=n.FlexItem,c=n.SimpleTable,u=n.TruncatedText,d=n.classnames;return o(function(e){function n(i){var n;return(n=e.call(this,i)||this).state={data:i.sortableData||[]},n.idPrefix=i.idPrefix||"",n.resources={moveToTop:t.get("moveToTop"),clear:t.get("clear"),createCustomSort:t.get("createCustomSort"),selectAvailableItemsDesc:t.get("selectAvailableItemsDesc")},n.onChange=i.onChange,n.iconsFeature=i.iconsFeature,n}_inheritsLoose(n,e),n.getDerivedStateFromProps=function(t){return{data:t.sortableData}};var o=n.prototype;return o._reOrderRow=function(t,e,i){var n=[].concat(t);n.splice(i,0,n.splice(e,1)[0]),this.onChange(n)},o._moveToTop=function(t){0!==t&&this._reOrderRow(this.state.data,t,0)},o._removeItem=function(t,e){e&&(e.preventDefault(),e.stopPropagation());var i=this.state.data.filter((function(e){return t!==e.value}));this.onChange(i,t)},o._cellRenderer=function(t){var e=this,n=this.state.data[t].value,o=this.state.data[t].label,c=this.iconsFeature.getIcon("draggable_32"),h=this.iconsFeature.getIcon("remove"),g=this.iconsFeature.getIcon("upToTop");return i.createElement(a,{className:"ba-sortableList__content",gutter:[1,1],id:this.idPrefix+n,onClose:this._closeContainer},i.createElement(a,{className:"ba-sortableList__resize",justifyContent:"center",alignItems:"center"},i.createElement(r,{focusable:!1,iconId:c.id})),i.createElement(s,{className:"ba-sortableList__label",padding:[1,1,1,0]},i.createElement(u,{value:o,location:"end"})),i.createElement(s,{className:"ba-sortableList__buttons",gutter:[1,1]},i.createElement(l,{className:d({"ba-sortableList__moveToTop":!0,"ba-sortableList__moveToTop__hidden":0===t}),justifyContent:"center",alignItems:"center",tabIndex:t>0?0:null,"aria-label":this.resources.moveToTop+" "+o,role:"link",onClick:function(){return e._moveToTop(t)},onKeyPress:function(i){"Enter"===i.key&&e._moveToTop(t)}},i.createElement(r,{iconId:g.id})),i.createElement(l,{className:"ba-sortableList__remove",justifyContent:"center",alignItems:"center","aria-label":this.resources.clear+" "+o,role:"link",tabIndex:0,onClick:function(t){return e._removeItem(n,t)},onKeyPress:function(t){"Enter"===t.key&&e._removeItem(n,t)}},i.createElement(r,{iconId:h.id}))))},o.render=function(){var t=this,e=this.state.data.length>0?i.createElement("div",{className:"ba-sortableList__container"},i.createElement(c,{colToAddScopeRow:1,draggable:!0,height:"100%",rowLength:this.state.data.length,colLength:1,cellRenderer:this._cellRenderer.bind(this),onRowMove:function(e,i){t._reOrderRow(t.state.data,e,i)}})):i.createElement("div",{className:"ba-sortableList__emptyView"},i.createElement("div",{className:"ba-sortableList__emptyView__text__line1",role:"option"},this.resources.createCustomSort),i.createElement("div",{className:"ba-sortableList__emptyView__text__line2",role:"option"},this.resources.selectAvailableItemsDesc));return this._blurLinkElements(),e},o._blurLinkElements=function(){var t=document.getElementsByClassName("ba-sortableList__container");if(t&&t[0]){var e=t[0].querySelectorAll(".ba-sortableList__moveToTop, .ba-sortableList__remove");if(e&&e.length>0)for(var i=0;i<e.length;i++)e[i].blur()}},n}(i.Component))})),define("dashboard-analytics/widgets/livewidget/dialogs/CustomSortDialog",["underscore","../nls/StringResources","../../../lib/@waca/core-client/js/core-client/ui/core/View","react-dom","react","@ba/ba-ui-carbon-toolkit","./components/SortableList"],(function(t,e,i,n,o,r,s){"use strict";var a=r.Dialog,l=r.Checkbox,c=r.TruncatedText,u=r.ListItem,d=r.Container,h=r.List,g=r.FlexLayout,p=r.FlexItem,f=r.SearchInput,m=r.Label,v=r.Select,_=r.Link,I=r.ProgressIndicator,b=r.Tooltip,y=r.EmptyState,S=function(t){var e=t.type,i=t.title;return o.createElement("div",{className:"emptyState"},o.createElement(y,{type:e}),o.createElement("div",{className:"emptyStateTitle"},i))},A=function(i){function n(t){var e;return(e=i.call(this,t)||this).state=_extends({},e.props,{listData:[],visibleListData:[],selectAllValues:!1,btnDisabled:!0,sortableData:[],isLoading:!0,isError:!1,isSearchEmpty:!1,previousSortableData:[],isClean:!0}),e.dialogProps={ariaLabel:"Dialog",className:"customSortContainer",size:"large",width:"640px",height:"699px",clickaway:!1},e.sortRemainingItemsBy=e.props.sortType,e.initialSortType=e.props.sortType,e}_inheritsLoose(n,i);var r=n.prototype;return r.componentDidMount=function(){var e=this;return this.props.getItems().then((function(i){var n=i.map((function(t){return e._getListItemFromQueryItem(t)})).filter((function(e){return!!(t.isNumber(e.label)||e.label&&e.label.trim())})),o=e.props.sortSpec&&e.props.sortSpec.custom&&e.props.sortSpec.custom.top||[];return e._getMissingListData(o,n).then((function(t){n=n.concat(t),e.setState({listData:n,visibleListData:n.slice(),isLoading:!1},(function(){o.forEach((function(t){e._columnSelected(t,!0)}))}))}))}),(function(t){e.props.logger.error(t),e.setState({isError:!0})}))},r._getMissingListData=function(t,e){var i=this,n=t.filter((function(t){return!e.find((function(e){return e.value===t}))}));return n.length?this.props.getItemsFromValues(n).then((function(t){return t.map((function(t){return i._getListItemFromQueryItem(t)}))})):Promise.resolve([])},r._getListItemFromQueryItem=function(t){return{value:t.value,label:t.label,selected:!1}},r._updateSelectAllValues=function(){this.setState({selectAllValues:this.state.visibleListData.length&&!this.state.visibleListData.find((function(t){return!t.selected}))})},r._isClean=function(t,e){return void 0===t&&(t=this.state.sortableData),void 0===e&&(e=this.state.previousSortableData),!(Array.isArray(t)&&Array.isArray(e)&&t.length>0)||t.length===e.length&&(JSON.stringify(t)===JSON.stringify(e)&&this.sortRemainingItemsBy===this.initialSortType)},r._onApply=function(t){t&&t.stopPropagation(),this.props.applyCustomSort(this.state,this.sortRemainingItemsBy)},r._onClose=function(t){t&&t.stopPropagation(),this.props.onRemove()},r._onSelect=function(t){this.sortRemainingItemsBy=t,this.setState({isClean:this._isClean()})},r._onSearch=function(t){var e=this;t=t&&t.trim(),this.setState({isLoading:!0,searchTerm:t,selectAllValues:!1,isSearchEmpty:!1});var i=this.state.listData.slice();t?this.props.getItems(t).then((function(t){if(0===t.length)e.setState({isSearchEmpty:!0,isLoading:!1});else{i=i.filter((function(e){return t.find((function(t){return e.value===t.value}))}));var n=e.state.listData.slice();t.map((function(t){if(-1===i.findIndex((function(e){return e.value===t.value}))){var o=e._getListItemFromQueryItem(t);i.push(o),n.push(o)}})),e.setState({listData:n,visibleListData:i,isLoading:!1,isSearchEmpty:!1},e._updateSelectAllValues)}}),(function(t){e.props.logger.error(t),e.setState({isError:!0})})):this.setState({isLoading:!1,visibleListData:i},this._updateSelectAllValues)},r._removeAll=function(){this.sortRemainingItemsBy="auto";var t=this.state.listData.slice();t.forEach((function(t){return t.selected=!1}));var e=0===this.state.previousSortableData.length;this.setState({listData:t.slice(),visibleListData:this.state.visibleListData?this.state.visibleListData:t,selectAllValues:!1,btnDisabled:!0,isClean:e,sortableData:[]})},r._itemRenderer=function(t,e){var i=_extends({},e),n=this.state.visibleListData[t];return o.createElement(u,_extends({},i,{key:n.value,"data-index":t,className:"customSortCheckboxItem"}),o.createElement(l,{label:n.label,checked:n.selected,onChange:this._columnSelected.bind(this,n.value,!1)}))},r._selectAll=function(t){var e=this,i=!!t.target.checked;this.state.visibleListData.slice().filter((function(t){return t.selected!==i})).forEach((function(t){return e._columnSelected(t.value,!1)})),this.setState({selectAllValues:!0,btnDisabled:0===this.state.sortableData.length,isClean:this._isClean()})},r._columnSelected=function(t,e){var i=this.state.visibleListData.slice(),n=this.state.sortableData;i.find((function(e){if(e.value===t)if(e.selected=!e.selected,e.selected)n.push(e);else{var i=n.findIndex((function(t){return t.value===e.value}));n.splice(i,1)}})),this.setState({visibleListData:i,btnDisabled:0===n.length,sortableData:n,isClean:!!e||this._isClean(n),previousSortableData:e?JSON.parse(JSON.stringify(n)):this.state.previousSortableData},this._updateSelectAllValues)},r.onChange=function(t,e){void 0===e&&(e=""),t.length<this.state.sortableData.length&&this._columnSelected(e),this.setState({sortableData:t,isClean:this._isClean(t)},this._updateSelectAllValues)},r.render=function(){var t,i=this;return this.state.openDialog?(t=this.state.isError?o.createElement(S,{type:"error",title:e.get("somethingWentWrong")}):this.state.isSearchEmpty?o.createElement(S,{type:"no_results",title:e.get("searchReturnedNoResults")}):this.state.isLoading?o.createElement(d,{id:"overlay"},o.createElement(I,{tabIndex:0,size:"normal"})):o.createElement("div",null,o.createElement("div",{className:"selectAllCheckbox"},o.createElement(l,{key:"all",label:e.get("selectAll"),checked:this.state.selectAllValues,onClick:function(t){return i._selectAll(t)}})),o.createElement(d,{className:"customSortCheckboxList"},o.createElement(h,{length:this.state.visibleListData.length,itemRenderer:this._itemRenderer.bind(this),selectionMode:"multiple",fullHeight:"true"}))),o.createElement("div",null,o.createElement(a,_extends({},this.dialogProps,{onClose:this._onClose.bind(this)}),o.createElement(a.Header,null,o.createElement(c,{value:e.get("createCustomSortTitle",{name:this.props.label}),className:"customSortColumnLabel"}),o.createElement(c,{value:e.get("createCustomSort")})),o.createElement(a.Body,null,o.createElement(m,{className:"customSortTitleLabel",label:e.get("createCustomSortDesc")}),o.createElement(g,{direction:"row"},o.createElement(p,{gutter:[0],className:"customSortItemsDialog"},o.createElement(m,{className:"customSortLabel",label:e.get("availableItems")}),o.createElement(d,{id:"avaliableItemsForSort",className:"customSortAvaliableItemsContainer"},o.createElement(f,{size:"sm",placeholder:e.get("search"),value:this.state.searchTerm,id:"searchAllItems",onChange:this._onSearch.bind(this),delay:800,className:"customSortItemSearch"}),t)),o.createElement(p,{grow:!0},o.createElement(m,{className:"customSortLabel",label:e.get("customSortOrder")}),o.createElement(d,{className:"customSortSelectedItemsContainer",id:"customSortList"},o.createElement(s,{sortableData:this.state.sortableData,onChange:this.onChange.bind(this),iconsFeature:this.state.iconsFeature}),o.createElement("div",{className:"customSortRemoveAll"},o.createElement(b,{title:e.get("resetTooltip",{customSortOrder:e.get("customSortOrder"),sortRemainingItemsBy:e.get("sortRemainingItemsBy")}),orient:"left"},o.createElement(_,{id:"removeAllLink",onClick:this._removeAll.bind(this),disabled:this.state.btnDisabled},e.get("removeAll"))))),o.createElement(m,{className:"customSortOrderSelectLabel",label:e.get("sortRemainingItemsBy"),disabled:this.state.btnDisabled}),o.createElement("div",{className:"customSortOrderSelect"},o.createElement(v,{options:[{value:"asc",label:e.get("toolbarActionSortAscending")},{value:"desc",label:e.get("toolbarActionSortDescending")},{value:"auto",label:e.get("toolbarActionSortAuto",{sortOrder:this.props.defaultSortOrder})}],id:"selectSortRemainingItemsBy",selected:this.sortRemainingItemsBy,disabled:this.state.btnDisabled,onChange:function(t){return i._onSelect(t)}}))))),o.createElement(a.Footer,null,o.createElement(a.Button,{primary:!0,id:"applyCustomSort",label:e.get("dlg_create"),onClick:this._onApply.bind(this),disabled:this.state.isClean}),o.createElement(a.Button,{label:e.get("dlg_cancel"),id:"cancelCustomSort",onClick:this._onClose.bind(this)}))))):null},n}(o.Component);return function(t){function e(){return t.apply(this,arguments)||this}_inheritsLoose(e,t);var i=e.prototype;return i.init=function(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];var r=n[0];(e=t.prototype.init).call.apply(e,[this].concat(n)),this.label=r.label,this.getItems=r.getItems,this.getItemsFromValues=r.getItemsFromValues,this.sortSpec=r.sortSpec,this.sortType=r.sortType,this.defaultSortOrder=r.defaultSortOrder,this.applyCustomSort=r.apply,this.reactDomNode=this.$el[0],this.logger=r.logger,this.iconsFeature=r.iconsFeature},i.render=function(){n.render(o.createElement(A,{label:this.label,openDialog:!0,getItems:this.getItems.bind(this),getItemsFromValues:this.getItemsFromValues.bind(this),sortSpec:this.sortSpec,sortType:this.sortType,defaultSortOrder:this.defaultSortOrder,applyCustomSort:this.onApply.bind(this),onRemove:this.onCancel.bind(this),logger:this.logger,iconsFeature:this.iconsFeature}),this.reactDomNode)},i.onApply=function(t,e){var i=t.sortableData,n=[];i.forEach((function(t){n.push(t.value)}));var o={top:n,type:e};this.applyCustomSort(o),this.onCancel()},i.onCancel=function(){this.reactDomNode&&n.unmountComponentAtNode(this.reactDomNode),this.$el.remove(),this.$el=null,e.inherited("remove",this)},e}(i)})),define("dashboard-analytics/features/content/slotActions/sortAction/CustomSortAction",["../../../../widgets/livewidget/dialogs/CustomSortDialog","../../../../widgets/livewidget/nls/StringResources","../../../../features/dashboard/queryService/QueryServiceUtils"],(function(t,e,i){return function(){function n(t){var e=t.dashboardAPI,i=t.options;this.dashboard=e,this.isCustomSortActionEnabled=!(i&&!1===i.customSort)}var o=n.prototype;return o.isEnabled=function(t,e){var i=t.getDataItemList(),n=i&&i[e],o=n.getMetadataColumn();return this.isCustomSortActionEnabled&&n&&"attribute"===n.getType()&&o&&"attribute"===o.getType()&&o.isFacetDefinitionEnabled({strict:!1})},o.getMenuItem=function(){return{id:"custom",localizedString:e.get("toolbarActionSortCustom")}},o.handleSelection=function(e,i,n){this.defaultSortOrderRaw=n,new t({label:e.getLabel(),sortSpec:e.getSort(),sortType:this._getSortType(e),defaultSortOrder:i,getItems:this._getDataItemsFromSearchString.bind(this,e),getItemsFromValues:this._getDataItemsFromUseValues.bind(this,e),apply:this._applyCustomSort.bind(this,e),logger:this.dashboard.getGlassCoreSvc(".Logger"),iconsFeature:this.dashboard.getFeature("Icons")}).render()},o._getDataItems=function(t,e){var n=t.getMetadataColumn(),o=t.getSort(),r=this.dashboard.getFeature("QueryService"),s=e&&e.searchTerm?[e.searchTerm]:[],a=o&&o.type||this._getDefaultSort();return r.getColumnValues(n.getSourceId(),[n.getId()],[],a,s).then((function(t){return i.extractListOfQueryResultData(t)}))},o._getDefaultSort=function(){return"asc"===this.defaultSortOrderRaw||"desc"===this.defaultSortOrderRaw?this.defaultSortOrderRaw:"asc"},o._getDataItemsFromSearchString=function(t,e){var i=e&&{searchTerm:e}||void 0;return this._getDataItems(t,i)},o._getSortType=function(t){if(t.hasDefaultSort())return"auto";var e=t.getSort();return e.custom&&e.custom.sortRemainingItemsBy?e.custom.sortRemainingItemsBy:e&&e.type||"auto"},o._getDataItemsFromUseValues=function(t,e){var i=e?{filter:{expression:{operator:"in",values:e,itemId:t.getColumnId()},type:"pre"}}:void 0;return this._getDataItems(t,i)},o._applyCustomSort=function(t,e){var i=e?{type:"auto"===e.type?void 0:e.type,custom:{enabled:!0,top:e.top,sortRemainingItemsBy:e.type}}:{type:null};t.setSort(i)},n}()})),define("dashboard-analytics/features/content/slotActions/sortAction/SortAction",["../../../../widgets/livewidget/nls/StringResources","./CustomSortAction","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../api/SlotActionsProviderAPI","../../../../apiHelpers/SlotAPIHelper"],(function(t,e,i,n,o){var r={asc:t.get("dlg_ascending"),desc:t.get("dlg_descending"),none:t.get("dlg_none"),custom:t.get("dlg_custom"),hierarchy:t.get("dlg_hierarchy"),namedSet:t.get("dlg_namedSet"),rank:t.get("dlg_rank")};return function(){function s(t){var i=t.content,n=t.dashboardAPI,o=t.features,r=t.options;this.content=i,this.dashboardApi=n,this.features=o,this._autoSortOrder="none",this.customSortAction=new e({dashboardAPI:n,options:r}),this.content.getFeature("SlotActions").registerProvider("sortAction",this.getAPI())}var a=s.prototype;return a.getViewState=function(t,e){var i=this.getVisualization().getSlots().getSlot(t);return i?{height:140,width:140,getCurrentSelectedItem:this._getCurrentSelectedItem.bind(this,i,e),possibleItems:this._getPossibleItems(i,e)}:null},a._getCurrentSelectedItem=function(t,e){var i=t.getDataItemList()[e],n=i.getSort(),o="auto";return!this.isRank&&this.isCurrentSortRankSort(n)||this.isRank&&!this.isCurrentSortRankSort(n)?o="auto":n&&!i.hasDefaultSort()&&(o=this._isCurrentSortCustom(t,e)?"custom":n.type),o},a._isCurrentSortCustom=function(t,e){var i=t.getDataItemList()[e].getSort();return i.custom&&i.custom.enabled&&this.customSortAction.isEnabled(t,e)},a.isCurrentSortRankSort=function(t){return t&&t.context},a._getPossibleItems=function(e,i){this._autoSortOrderStringId=this.getDefaultSortOrder(e,i);var n=[{id:"asc",localizedString:t.get("toolbarActionSortAscending")},{id:"desc",localizedString:t.get("toolbarActionSortDescending")},{id:"auto",localizedString:t.get("toolbarActionSortAuto",{sortOrder:r[this._autoSortOrderStringId]})}];return this.customSortAction.isEnabled(e,i)&&n.push(this.customSortAction.getMenuItem()),n},a.getDefaultSortOrder=function(t,e){var i=t.getDataItemList()[e];if(i){var n=i.getMetadataColumn(),o=n&&n.getDefaultSortType();if(o)return o;if(n&&(!0===n.isOlapColumn()||!0===n.isNamedSet()))return this._getSortLabelForOlapItem(n);if(i.getTopBottom())return"rank";var r=t.getDefinition();if(r)return r.getSort()||"none"}return"none"},a._getSortLabelForOlapItem=function(t){return t.isNamedSet()?"namedSet":"fact"!==t.getType()?"hierarchy":"none"},a._supportAction=function(t,e){return(!Array.isArray(e)||1===e.length)&&(!this._isMultiMeasureDataSlot(t,e)&&this.getVisualization().getDefinition().getProperty("supportsSortAction")&&o.isSlotSortable(t,e,this.getVisualization())&&!(null!=e&&!t.getDataItemList()[e].getMetadataColumn()))},a._isMultiMeasureDataSlot=function(t,e){return void 0===e&&t?o.isMultiMeasuresSeriesSlot(t)||o.isMultiMeasuresValueSlot(t):o.isMultiMeasuresSeriesOrValue(t,e)},a.getSlotActionList=function(e,i,n){this.isRank=n&&n.rankSort;var o=this.getVisualization().getSlots().getSlot(e);if(o&&this._supportAction(o,i)){i=Array.isArray(i)&&1===i.length?i[0]:parseInt(i),this.itemIndex=isNaN(i)?0:i,this.dataSlotId=e;var r=this.getViewState(e,this.itemIndex),s=this.features["Dashboard.Icons"].getIcon("common-sort-icon");return[{name:"sortAction",label:t.get("toolbarActionSort"),icon:s.id,type:"SubMenu",view:{module:"dashboard-analytics/lib/@waca/dashboard-common/dist/ui/dialogs/CommonSelectItemsDialog",state:r},actions:{apply:this.handleSelection.bind(this,o,n)}}]}return[]},a.handleSelection=function(t,e,i){var n=t.getDataItemList()[this.itemIndex];if(i===this.customSortAction.getMenuItem().id)this.customSortAction.handleSelection(n,r[this._autoSortOrderStringId],this._autoSortOrderStringId);else{var o={type:"auto"===i?null:i};if(e&&e.rankSort){var s=n.getTopBottom();s&&s.context&&s.context.itemId&&(o.context=s.context.itemId),o.rankSort=!0}n.setSort(o)}},a.getVisualization=function(){return this.visualization||(this.visualization=this.content.getFeature("Visualization")),this.visualization},a.getAPI=function(){return this._api||(this._api=i.createAPI(this,[n])),this._api},s}()})),define("dashboard-analytics/features/content/slotActions/topBottomAction/TopBottomActionAPI",[],(function(){return function(){function t(){}return t.prototype.reset=function(){},t}()})),define("dashboard-analytics/features/content/slotActions/topBottomAction/TopBottomAction",["../../../../widgets/livewidget/nls/StringResources","underscore","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../api/SlotActionsProviderAPI","../../../../apiHelpers/SlotAPIHelper","./TopBottomActionAPI"],(function(t,e,i,n,o,r){return function(){function s(t){var e=t.content,i=t.dashboardAPI,n=t.features;this.content=e,this.dashboardApi=i,this.features=n,this.content.getFeature("SlotActions").registerProvider("topBottomAction",this.getAPI())}var a=s.prototype;return a.getSlotActionList=function(e,i){var n=this.getVisualization().getSlots().getSlot(e);if(n&&o.isSlotTopBottomable(this.getVisualization().getDefinition(),n,i)){this.slot=n;var r=n.getDefinition().getId();this.dataItemIndex=i?parseInt(i):0,this.dataItem=this.slot.getDataItemList()[this.dataItemIndex];var s=this.getViewState();s.getTopBottomState=this.dataItem.getTopBottom.bind(this),s.contextColumns=this._isAttribute()&&this._getFactColumns(),s.allowPercentOperations=this._isAttribute(),s.allowRankColumn="JQGrid"===this.getVisualization().getDefinition().getId(),s.onSearch=this._onSearch.bind(this);var a=this.features["Dashboard.Icons"].getIcon("dashboard-topbottom");return[{name:"topBottomAction",targetCaption:this.dataItem.getLabel(),label:t.get("toolbarActionTopBottom"),icon:a.id,type:"NextView",view:{module:"dashboard-analytics/lib/@waca/dashboard-common/dist/ui/dialogs/TopBottomDialog",state:s},actions:{apply:this.applyTopBottomValues.bind(this,r,i),reset:this.reset.bind(this,r,i)}}]}return[]},a._getFactColumns=function(){return e.unique(this.getVisualization().getDataSource().findMetadataColumns("","fact"))},a._onSearch=function(t){return e.unique(this.getVisualization().getDataSource().findMetadataColumns(t,"fact"))},a.getViewState=function(){if(this.slot){return{height:280,width:400}}return null},a._isAttribute=function(){return"attribute"===this.dataItem.getType()&&this.dataItem.getMetadataColumn()&&"attribute"===this.dataItem.getMetadataColumn().getType()},a._addAggregateToContext=function(t){var e=t.context&&t.context.itemId;if(e){var i=this.getVisualization().getSlots().getDataItemList();if(i&&i.length>0){var n,o=i.find((function(t){return t.getColumnId()===e&&"none"!==t.getAggregation()}));if(o)n=o.getAggregation();else{var r=this.getVisualization().getDataSource().getMetadataColumn(e);n=r&&r.getDefaultAggregation()}n&&(t.context.aggregate=n)}}},a.applyTopBottomValues=function(t,e,i){e=e||0,this.slot=this.getVisualization().getSlots().getSlot(t),this.dataItem=this.slot.getDataItemList()[e],i?(this._addAggregateToContext(i),this.dataItem.setTopBottom(i)):this.dataItem.setTopBottom()},a.reset=function(t,e){this.slot=this.getVisualization().getSlots().getSlot(t),this.dataItem=this.slot.getDataItemList()[e],this.applyTopBottomValues(t,e)},a.getVisualization=function(){return this.visualization||(this.visualization=this.content.getFeature("Visualization")),this.visualization},a.getAPI=function(){return this._api||(this._api=i.createAPI(this,[n,r])),this._api},s}()})),define("dashboard-analytics/features/content/slotActions/topKeyDriversAction/TopKeyDriversAction",["../../../../visualizations/renderer/topbottom/TopBottomLabel","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","../api/SlotActionsProviderAPI","../../../../apiHelpers/SlotAPIHelper","../../../../widgets/livewidget/nls/StringResources"],(function(t,e,i,n,o){"use strict";var r="top5",s="top10",a="all";return function(t){function l(e){var i,n=e.content,o=e.dashboardAPI,r=e.features;return(i=t.call(this)||this).content=n,i.dashboard=o,i.features=r,r.SlotActions.registerProvider("topKeyDriversAction",i.getAPI()),i}_inheritsLoose(l,t);var c=l.prototype;return c.getAPI=function(){return this._api||(this._api=e.createAPI(this,[i])),this._api},c._isActionSupported=function(t,e){if(!this._isFocusModeEnabled())return!1;var i=t.getDefinition().getProperty("actions");return!!i&&(-1!==i.indexOf("TopKeyDriversAction")&&!this._isMultiMeasureDataSlot(t,e))},c._isFocusModeEnabled=function(){return!this.dashboard.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","FocusMode","disabled")},c.getViewState=function(t,e){var i=this._getVisualization().getSlots().getSlot(t);return i?{height:140,width:140,getCurrentSelectedItem:this._getCurrentSelectedItem.bind(this,i,e),possibleItems:this._getPossibleItems(i,e),eventHandler:this}:null},c.getSlotActionList=function(t,e){if(void 0===e&&(e=0),this.dataSlot=this._getVisualization().getSlots().getSlot(t),this.itemIndex=e,this.dataSlot&&this._isActionSupported(this.dataSlot,e)){var i=this.features["Dashboard.Icons"].getIcon("dashboard-topbottom"),n=this.dataSlot.getDataItemList()[e];return[{name:"show",targetCaption:n&&n.getLabel(),id:"TopKeyDriversAction",text:o.get("toolbarActionTopKeyDrivers"),label:o.get("toolbarActionTopKeyDrivers"),icon:i.id,type:"NextView",group:"topKeyDriversAction",view:{module:"dashboard-analytics/lib/@waca/dashboard-common/dist/ui/dialogs/CommonSelectItemsDialog",state:this.getViewState(t,e)},actions:{apply:this.handleSelection.bind(this)}}]}return[]},c._getCurrentSelectedItem=function(t,e){void 0===e&&(e=0);var i=t.getDataItemList()[e].getTopBottom();return i&&"topcount"===i.type?5===i.value?r:s:a},c._getPossibleItems=function(){return[{id:a,localizedString:o.get("allKeyDriversLabel")},{id:r,localizedString:this.getTopBottomLabel({limit:{op:"top",val:5}})},{id:s,localizedString:this.getTopBottomLabel({limit:{op:"top",val:10}})}]},c._isMultiMeasureDataSlot=function(t,e){return void 0===e&&t?n.isMultiMeasuresSeriesSlot(t)||n.isMultiMeasuresValueSlot(t):n.isMultiMeasuresSeriesOrValue(t,e)},c._getVisualization=function(){return this.visualization||(this.visualization=this.content.getFeature("Visualization")),this.visualization},c.handleSelection=function(t){var e=this.dataSlot.getDataItemList()[this.itemIndex];switch(t){case a:e.setTopBottom();break;case r:case s:e.setTopBottom({type:"topcount",value:t===r?5:10})}},l}(t)})),define("dashboard-analytics/features/content/smart-title/SmartTitleAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.upgradeIfNeeded=function(){},e.prepare=function(){},e.enableAndSetSmartTitle=function(){},e.disableSmartTitle=function(){},e.getTitleState=function(){},e.shouldUseGeneratedTitle=function(){},e.shouldSetTitle=function(){},e.getTitleHtmlWithPreviousFormat=function(){},t}()})),define("dashboard-analytics/features/content/smart-title/SmartTitleFeatureProvider",["gemini/lib/@waca/dashboard-common/dist/core/APIFactory","./SmartTitleAPI","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","underscore"],(function(t,e,i,n){return function(){function o(t){var e=this;this._dashboard=t.dashboardAPI,this._content=t.content,this._dashboardInternal=t.features["Dashboard.internal"],this._widgetApiHandlers={};var i=this._dashboard&&this._dashboard.getGlassCoreSvc(".FeatureChecker");this._isPropertiesV2Enabled=i&&i.checkValue("dashboard","PropertiesV2","enabled"),this._addedContent=[];var n=this._dashboard.getCanvas();n&&(this._addContentEvent=n.on("add:content:child",(function(t){e._addedContent.push(t.info.newContentId)}))),this._state={setupDone:!1,setupCheckDone:!1,initialWidgetRenderDone:!1,shouldUseGeneratedTitle:void 0,smartTitleEnabled:void 0,toEnableGeneratedTitle:void 0,toSetNoTitle:void 0,toSetSmartTitle:void 0},t.features.Properties.registerProvider(this)}var r=o.prototype;return r.getPropertyList=function(){return[{id:"titleMode",editor:{position:100,sectionId:this._isPropertiesV2Enabled?"title":"visualization.chart",uiControl:{type:"DropDown",label:i.get("titleTypeLabel"),ariaLabel:i.get("titleTypeLabel"),options:[{label:i.get("smartTitleLabel"),value:"smartTitle"},{label:i.get("customTitleLabel"),value:"customTitle"},{label:i.get("noTitleLabel"),value:"noTitle"}],active:!0}}}]},r._isSmartTitleEnabled=function(){return this._state.smartTitleEnabled},r.getAPI=function(){return t.createAPI(this,[e])},r.initialize=function(){this.prepare()},r.prepare=function(){this.upgradeIfNeeded(),this._setupTitle(),this._addChangeHandlerForTitleModeProperty()},r._getModelAttr=function(t){var e=this._dashboardInternal.getBoardModel(),i=this._content.getId(),n=e&&e.getWidgetModel(i);if(n)return n.get(t)},r._setModelAttr=function(t,e){void 0===e&&(e={silent:!0});var i=this._dashboardInternal.getBoardModel(),n=this._content.getId(),o=i&&i.getWidgetModel(n);o&&o.set(t,e)},r._setProp=function(t,e){var i=this;this._state.initialWidgetRenderDone?this._content.setPropertyValue(t,e):this._content.getFeature("state").whenStatusChanges("rendered").then((function(){var n=i._dashboardInternal.getBoardModel(),o=i._content.getId(),r=n&&n.getWidgetModel(o);if(r){var s={};s[t]=e,r.set(s,{payloadData:{skipUndoRedo:!0}})}}))},r.upgradeIfNeeded=function(){var t=this._content.getContainer(),e=t&&t.getType();if(e&&"exploreCard"===e){var i={showTitle:void 0,titleMode:"smartTitle"};return this._setModelAttr(i),this._setProp("titleMode","smartTitle"),void this._setProp("showTitle",void 0)}var n=this._getModelAttr("showTitle"),o=this._getModelAttr("name"),r=this._getModelAttr("titleMode");if(void 0!==n){var s={showTitle:void 0};!o||r&&"noTitle"===r||(!0===n?(s.titleMode="customTitle",this._setProp("titleMode","customTitle")):(s.titleMode="noTitle",this._setProp("titleMode","noTitle"))),this._setModelAttr(s),this._setProp("showTitle",void 0)}},r._setupTitle=function(){var t=this,e=this._content.getFeature("state");e.whenStatusChanges("rendered").then((function(){t._state.initialWidgetRenderDone=!0})),this._stateInitPromise=e.whenStatusChanges("rendering"),this._stateInitPromise.then((function(){t._ensureStateCheckOnInit(),t._state.setupCheckDone=!0,t._state.setupDone||(t._state.setupDone=!0,t._state.toEnableGeneratedTitle&&t._state.toSetSmartTitle?t.enableAndSetSmartTitle():t._state.toEnableGeneratedTitle?t._enableSmartTitle():t._state.toSetNoTitle&&t._setProp("titleMode","noTitle"))}))},r._removeAddContentEventListener=function(){this._addContentEvent&&this._addContentEvent.remove&&(this._addContentEvent.remove(),this._addContentEvent=null)},r._ensureStateCheckOnInit=function(){this._removeAddContentEventListener();var t=this._content.getId(),e=-1!==this._addedContent.indexOf(t),i=this._getModelAttr("name"),n=this._getModelAttr("titleMode"),o=!1;return i?"smartTitle"===n||!n&&e?(this._state.toEnableGeneratedTitle=!0,o=!0):"customTitle"!==n&&this._setProp("titleMode","noTitle"):void 0===n?null==i||""!==i||e?(this._state.toEnableGeneratedTitle=!0,this._state.toSetSmartTitle=!0,o=!0):this._state.toSetNoTitle=!0:"smartTitle"===n&&(this._state.toEnableGeneratedTitle=!0,this._state.toSetSmartTitle=!0,o=!0),this._state.shouldUseGeneratedTitle=o,this._state},r.shouldUseGeneratedTitle=function(){return!!this._dashboard.getAppConfig("smartTitle")&&this._ensureStateCheckOnInit().shouldUseGeneratedTitle},r._addChangeHandlerForTitleModeProperty=function(){var t=this;this._content.on("change:property:titleMode",(function(e){"smartTitle"===e.info.value?t.enableAndSetSmartTitle():t.disableSmartTitle(e.info.value)}))},r.enableAndSetSmartTitle=function(){if(!this._isSmartTitleEnabled()){var t=this._content.getFeature("WidgetAPI.deprecated");this._enableSmartTitle(),this._triggerTitleUpdate(t,!0)}},r._enableSmartTitle=function(){if(!this._isSmartTitleEnabled()){this._state.smartTitleEnabled=!0;var t=this._content.getFeature("WidgetAPI.deprecated"),e=t.getVisApi();this._deregisterListener(),this._widgetApiHandlers={_onChangeDefinition:e&&e.on("change:definition",this._triggerTitleUpdate.bind(this,t))},this._setProp("titleMode","smartTitle")}},r.disableSmartTitle=function(t){void 0===t&&(t="customTitle"),!1!==this._isSmartTitleEnabled()&&(this._state.smartTitleEnabled=!1,this._deregisterListener(),this._setProp("titleMode",t))},r.getTitleState=function(){var t=this._getModelAttr("name");return{generatedTitle:this._isSmartTitleEnabled(),title:t}},r.shouldSetTitle=function(t){var e=this._getModelAttr("name");return e!=t||!!this._isTitlePartiallyFormatted(e)},r._isTitlePartiallyFormatted=function(t){return!this._findRawTitleInHtml(t)},r.getTitleHtmlWithPreviousFormat=function(t){var e=this._findRawTitleInHtml(this._getModelAttr("name"));return e?(e.spanContainingTheTitle.innerHTML=n.escape(t),e.titleRoot.innerHTML):null},r._findRawTitleInHtml=function(t){var e=this._getModelAttr("titleHtml");if(t&&e){var i=document.createElement("div");i.innerHTML=n.escape(t);var o=document.createElement("div");o.innerHTML=e;for(var r=o.getElementsByTagName("span"),s=null,a=0;a<r.length;++a)r[a].innerHTML===i.innerHTML&&(s=r[a]);return s&&{spanContainingTheTitle:s,titleRoot:o}}return null},r.destroy=function(){return this._deregisterListener(),Promise.resolve(!0)},r._deregisterListener=function(){this._widgetApiHandlers._onChangeDefinition&&(this._widgetApiHandlers._onChangeDefinition.remove(),this._widgetApiHandlers._onChangeDefinition=null),this._removeAddContentEventListener()},r._triggerTitleUpdate=function(t){t&&t.updateTitle()},o}()})),define("dashboard-analytics/features/content/valuesAsRowsAction/valuesAsRowsPropertyProvider",["../../../lib/@waca/dashboard-common/dist/core/APIFactory","../../../lib/@waca/dashboard-common/dist/api/PropertiesProviderAPI","../../../widgets/livewidget/nls/StringResources"],(function(t,e,i){var n=[{label:i.get("showValuesAsRowLabel"),value:"rowsAuto"},{label:i.get("showValuesAsColumnLabel"),value:"columnsAuto"}];return function(){function o(t){var e=t.content,i=t.dashboardAPI,n=t.features;this.content=e,this.visualization=n.Visualization,this.content&&n.Properties.registerProvider(this.getAPI()),this.featureChecker=i&&i.getGlassCoreSvc(".FeatureChecker")}var r=o.prototype;return r.getAPI=function(){return this._api||(this._api=t.createAPI(this,[e])),this._api},r.destroy=function(){this.content=null,this.featureChecker=null},r.getPropertyLayoutList=function(){return[]},r.getPropertyList=function(){var t=this,e=this.featureChecker&&this.featureChecker.checkValue("dashboard","PropertiesV2","enabled")?"chart":"visualization.chart",o=[];return this._isSupported()&&o.push({id:"valuesAsRows",editor:{sectionId:e,uiControl:{type:"DropDown",label:i.get("showValuesOn"),ariaLabel:i.get("showValuesOn"),onChange:function(e,i){t.content.setPropertyValue(e,i)},readOnly:!0,options:n}},onPropertyChange:{refresh:{data:!0}},supportsUndoRedo:!0,defaultValue:n[1].value}),o},r.reset=function(){},r._isSupported=function(){return this.visualization&&"Crosstab"===this.visualization.getType()},o}()})),define("dashboard-analytics/view/features/content/visExpandMode/api/VisExpandModeAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.renderExpandedModeContent=function(){},e.restore=function(){},t}()})),define("text!dashboard-analytics/view/features/content/visExpandMode/VisExpandMode.template",[],(function(){return'<div class="preview">\n\t<div class="expandPageViewContent">\n\t\t<div class="expandPage {{!it.boardBackgroundColorClass}}">\n\t\t\t<div class="liveWidget widget" id="{{!it.contentId}}"></div>\n\t\t</div>\n\t</div>\n</div>\n'})),define("dashboard-analytics/view/features/content/visExpandMode/VisExpandMode",["./api/VisExpandModeAPI","text!./VisExpandMode.template","../../../../visualizations/vipr/VIPRLibraries","../../../../lib/@waca/dashboard-common/dist/core/APIFactory","doT"],(function(t,e,i,n,o){return function(){function r(t){this.dashboard=t.dashboardAPI,this.content=t.content}var s=r.prototype;return s.getAPI=function(){return this._api||(this._api=n.createAPI(this,[t])),this._api},s.renderExpandedModeContent=function(t){var n=this;t.classList.add("liveWidget"),t.classList.add("widgetExpanded");var r=this.content.getFeature("ContentViewDOM").getNode();this.el=r.querySelector(".widgetContent"),this._parentNode=this.el.parentNode;var s=this.dashboard.getFeature("Canvas"),a=s.findContent({type:"container"}).filter((function(t){return t.getContent(n.content.getId())}))[0].getPropertyValue("backgroundColor");a&&"transparent"!==a||(a=s.getPropertyValue("fillColor"));var l=this.dashboard.getFeature("Colors"),c=a?"fill-"+l.getColorClassName(a):"",u=o.template(e)({contentId:this.content.getId(),boardBackgroundColorClass:c});this.headerNode=this._parentNode.querySelector(".widgetHeader"),this.previewMessageNode=this._parentNode.querySelector(".customVisPreviewMessage"),this.contentNode=document.createElement("div"),this.contentNode.classList.add("expandModeContainer"),this.contentNode.innerHTML=u,this.placeHolderNode=document.createElement("div"),this.placeHolderNode.style.width=this.el.offsetWidth,this.placeHolderNode.style.height=this.el.offsetHeight;var d=this.contentNode.querySelector(".widget");this.previewMessageNode&&d.appendChild(this.previewMessageNode),d.appendChild(this.headerNode),d.appendChild(this.el),this.el.parentNode.appendChild(this.placeHolderNode),this._applyCommonProperties(),t.appendChild(this.contentNode);var h=this.content&&this.content.getFeature("state.internal");if(h){var g=h.getError();if(g&&g.getParams){var p=g.getParams()||{};p.errorInfo&&p.errorInfo.errorCode===i.LOAD_DEFINITION_ERROR&&h.clearError()}}},s.restore=function(){this._parentNode&&this.headerNode&&this._parentNode.insertBefore(this.headerNode,this._parentNode.firstChild),this.placeHolderNode.parentNode.removeChild(this.placeHolderNode),this.contentNode.parentNode.removeChild(this.contentNode)},s._applyCommonProperties=function(){var t=this.content.getPropertyValue("fillColor"),e=this.content.getPropertyValue("borderColor"),i=this.dashboard.getFeature("Colors"),n=new RegExp("\\s*\\bfill|border-[^\\s]*\\b","g"),o=this.el.parentNode,r=o.getAttribute("class")||"";r=r.replace(n,""),t&&(r+=" fill-"+i.getColorClassName(t)),e&&(r+=" border-"+i.getColorClassName(e)),o.setAttribute("class",r)},r}()})),define("dashboard-analytics/consumeProfileBundle",(function(){}));