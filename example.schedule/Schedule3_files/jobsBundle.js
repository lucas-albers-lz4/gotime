/**
 * IBM Confidential OCO Source Materials IBM Business Platform: CA Admin
 * (C) Copyright IBM Corp. 2017, 2018
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

define("bi/admin/account/AccountExplorer",["lodash","bi/commons/ui/core/Class","bi/admin/nls/StringResource","bi/admin/common/utils/AJAXUtils","ba-react-admin/ba-react-admin.min"],function(e,t,i,n,s){"use strict";var a=t.extend({_searchTypes:{0:"contains",1:"startsExact",2:"matchExact"},_pathStack:[],_nameSpaces:[],_content:[],_accountTypes:{namespaceFolder:{svgIcon:"common-folder",titleId:"namespaceFolder"},group:{svgIcon:"common-group",titleId:"group"},account:{svgIcon:"common-user",titleId:"account"},role:{svgIcon:"common-role",titleId:"role"}},_rootDirectory:{type:"directory",defaultName:i.get("namespaces"),url:"#"},_defaultTypes:["namespaceFolder","group"],_defaultNamespaceName:null,_selectedNamespace:null,init:function(e){a.inherited("init",this,arguments),this.glassContext=e.glassContext,this.logger=this.glassContext.services.logger,this.sortColumnName="defaultName",this.sortOrder="asc",this.isHandlingMorePage=!1,this.searchPageFrom=0,this.searchPageSize=100,this.searchOffset=0,this.pagingEnabled=e.pagingEnabled,this.pagingValueSet=e.pagingValueSet,this._filterType={account:!0,role:!0,group:!0};var e={method:"GET",contentType:"application/json; charset=utf-8",dataType:"json",url:"v1/configuration/keys?keys=Admin.mtCloudBuild"};this._getTenantNsFolderId()},getAccount:function(e){var t={dataType:"json",type:"GET",data:{fields:"email,surname,givenName,userName,format,options,contentLocale,productLocale,timeZoneID,searchPath,tenantID,ancestors,permissions,disabled,defaultName,defaultDescription,creationTime,modificationTime,owner.defaultName"},url:e._meta.links.self.url,cache:!1};return this.glassContext.services.ajax.ajax(t)},getItem:function(e){var t={dataType:"json",type:"GET",data:{fields:"searchPath,tenantID,ancestors,permissions,disabled,defaultName,defaultDescription,creationTime,modificationTime,owner.defaultName,owner.id,hidden"},url:e._meta.links.self.url,cache:!1};return this.glassContext.services.ajax.ajax(t)},_getChildren:function(e,t,i){var n="v1/"+e+"/"+t+"/items?";this.currentRequest=n;var a={dataType:"json",type:"GET",data:{fields:"searchPath,tenantID,ancestors,permissions,disabled,defaultName,creationTime,modificationTime,id,hasChildren,hidden,position"},url:n+i,cache:!1};return"xOg__"!==t||this.tenantNsFolderId||this._getTenantNsFolderId(),this.pagingEnabled?s.PaginationHelper.getDataWithLookAhead(0,this.pagingValueSet,this,this.glassContext):this.glassContext.getCoreSvc(".Ajax").ajax(a)},_getTenantNsFolderId:function(){var e="v1/users/~/user_profile_settings",t=this.glassContext.services.fetch.get(e);return t.then(function(e){this.tenantNsFolderId=e.data.rootFolder_CognosNamespace}.bind(this))["catch"](function(e){this.tenantNsFolderId=null}.bind(this))},getFolderPermission:function(e){var t="v1/folders/"+e,i=this.glassContext.services.fetch.get(t);return i.then(function(e){return e.data.permissions})},_getCurrentIdentity:function(){var e="v1/identity",t={dataType:"json",type:"GET",data:{},url:e,cache:!1};return this.glassContext.services.ajax.ajax(t)},_getNameSpaces:function(){var e="v1/namespaces",t={dataType:"json",type:"GET",data:{},url:e,cache:!1};return this.glassContext.services.ajax.ajax(t)},startUp:function(){return this._getNameSpaces().then(function(t){var n=e.map(t.data,function(e){var t=e.creationTime||i.get("unknown"),n=e.modificationTime||"";return e.creationTime=t,e.modificationTime=n,e.owner=i.get("none"),e.description=e.description||e.defaultName,e.svgIcon="common-namespace",e.auth=this._isActiveNS(e),e}.bind(this));return this._nameSpaces=n,this.selectNamespace()}.bind(this))},_isActiveNS:function(t){return e.includes(t.permissions,"traverse")},_hasMultipleNamespaces:function(){return!0},_pushStack:function(t,i){var n=e.indexOf(this._pathStack,t);n>=0?this._pathStack=this._pathStack.slice(0,n+1):t.ancestors?i&&i.defaultName&&i.ancestors?this._buildPathStack(i):this._pathStack.push(t):"namespace"===t.type?this._pathStack.push(t):this._pathStack=[t],this._patchLink(t)},_buildPathStack:function(t){this._pathStack=[],e.forEach(t.ancestors,function(e){"directory"===e.type&&(e.defaultName=i.get("namespaces")),this._pathStack.push(e)}.bind(this)),"directory"===t.type&&(t.defaultName=i.get("namespaces")),this._pathStack.push(t)},_patchLink:function(e){if(!e.label||!e.url){e.label=e.label||e.defaultName;var t="";"namespace"===e.type?t="namespaces":"namespaceFolder"===e.type&&(t="folders"),e.url="v1/"+t+"/"+e.id}},selectRootDirectory:function(){return this._pushStack(this._rootDirectory),this._selectedNamespace=null,Promise.resolve()},updateHasMoreData:function(){this.noMoreData=this._fullContent.length<=this._content.length},selectNamespace:function(e){if(this._content=[],this.clearGroupedContent(),this._pathStack=[],this.searchOffset=0,this._hasMultipleNamespaces()&&this._pushStack(this._rootDirectory),e=e||this._defaultNamespaceName,this._selectedNamespace=this._getNamespaceObj(e),this._canTraverseNamespace()){var t=this._selectedNamespace.id;return new Promise(function(e,i){this._getChildren("namespaces",t,this.getQueryString()).then(function(i){this._fullContent=i.data.data,this._fullContent.parentId=t,this.pagingEnabled||(this._content=i.data.data.slice(0,this.searchPageSize),this._content.length<=this._fullContent.length?this.noMoreData=!0:this.noMoreData=!1);var n;n="xOg__"===t?this.tenantNsFolderId:t,this.getFolderPermission(n).then(function(e){this.parentObjectPermissions=e}.bind(this))["catch"](function(e){this.parentObjectPermissions=null}.bind(this)),this._pushStack(this._selectedNamespace),e()}.bind(this))["catch"](function(e){i(e)}.bind(this))}.bind(this))}return this._fullContent=[],Promise.resolve()},_canTraverseNamespace:function(){return this._selectedNamespace&&this._selectedNamespace.permissions.indexOf("traverse")>-1},_getNamespaceObj:function(t){return e.isString(t)?e.find(this._nameSpaces,function(e){return e.defaultName===t}):t},selectGroup:function(e){return this._content=[],this.clearGroupedContent(),e.permissions&&(this.parentObjectPermissions=e.permissions),new Promise(function(t,i){this._getChildren("groups",e.id,this.getQueryString()).then(function(i){this._fullContent=i.data.data,this._fullContent.parentId=e.id,this.pagingEnabled?this._content=i.data.data.slice(0,this.pagingValueSet):this._content=i.data.data.slice(0,this.searchPageSize),i.data.length>0?this._pushStack(i.data[0],e):this._pushStack(e),t()}.bind(this))["catch"](function(e){i(e)}.bind(this))}.bind(this))},selectRole:function(e){return this._content=[],this.clearGroupedContent(),e.permissions&&(this.parentObjectPermissions=e.permissions),new Promise(function(t,i){this._getChildren("roles",e.id,this.getQueryString()).then(function(i){this._fullContent=i.data.data,this._fullContent.parentId=e.id,this.pagingEnabled?this._content=i.data.data.slice(0,this.pagingValueSet):this._content=i.data.data.slice(0,this.searchPageSize),i.data.length>0?this._pushStack(i.data[0],e):this._pushStack(e),t()}.bind(this))["catch"](function(e){i(e)}.bind(this))}.bind(this))},selectFolder:function(e){return this._content=[],this.clearGroupedContent(),e.permissions&&(this.parentObjectPermissions=e.permissions),new Promise(function(t,i){this._getChildren("folders",e.id,this.getQueryString()).then(function(i){this._fullContent=i.data.data,this._fullContent.parentId=e.id,this.pagingEnabled?this._content=i.data.data.slice(0,this.pagingValueSet):this._content=i.data.data.slice(0,this.searchPageSize),i.data.length>0?this._pushStack(i.data[0],e):this._pushStack(e),t()}.bind(this))["catch"](function(e){i(e)}.bind(this))}.bind(this))},selectCurrentPath:function(){return this.selectPath(this.getCurrentPath())},selectPath:function(e){switch(e.type){case"directory":return this.selectRootDirectory();case"namespace":return this.selectNamespace(e.defaultName||"Cognos");case"namespaceFolder":return this.selectFolder(e);case"role":return this.selectRole(e);case"group":return this.selectGroup(e);default:this.glassContext.services.logger.error("unknown object type for selection:",e)}return Promise.resolve()},isTopOfPage:function(){return 0===this.searchOffset},getNextBrowsePage:function(e){e?(this.searchOffset+=this.searchPageSize,this._content=this._fullContent.slice(Math.max(0,this.searchOffset-3),this.searchOffset+this.searchPageSize)):(this.searchOffset-=this.searchPageSize,this.searchOffset<0&&(this.searchOffset=0),this._content=this._fullContent.slice(this.searchOffset,this.searchOffset+this.searchPageSize)),this.searchOffset+this.searchPageSize>=this._fullContent.length?this.noMoreData=!0:this.noMoreData=!1},getNextSearchPage:function(t){var i=t?this.isHandlingMorePage:this.isTopOfPage();return this.isHandlingMorePage||i||e.isUndefined(this.lastSearchedKeyword)?Promise.resolve():(this.isHandlingMorePage=!0,this.searchOffset=t?this.searchPageSize+this.searchOffset:this.searchOffset-this.searchPageSize,this.search(this.lastSearchedKeyword).then(function(e){return this.isHandlingMorePage=!1,e}.bind(this)))},newSearch:function(){this.searchOffset=0,this.lastSearchedKeyword=null},search:function(t,i){var s=this._searchTypes[i],a=decodeURI(t),o=-1!==a.indexOf('"')&&(-1!==a.indexOf("'")||-1!==a.indexOf("`")),r=-1!==a.indexOf("'")&&(-1!==a.indexOf('"')||-1!==a.indexOf("`")),c=-1!==a.indexOf("`")&&(-1!==a.indexOf('"')||-1!==a.indexOf("'"));return o||r||c?(0===this.searchOffset?this._content=[]:(this._content=this.oldContent,this.searchOffset-=this.searchPageSize),this.noMoreData=!0,Promise.resolve()):new Promise(function(i,a){var o=t.replace(/^\s+|\s+$/g,"");this.lastSearchedKeyword=o;var r=e.last(this.getPathStack()).id;"xOg__"===r&&this.tenantNsFolderId&&"xOg__"!==this.tenantNsFolderId&&(r=this.tenantNsFolderId),this.clearGroupedContent();var c="asc"===(this.sortOrder||"asc")?"%2b":"-",l={method:"GET",contentType:"application/json; charset=utf-8",dataType:"json"};l.url=n.getAJAXURL("namespace")+"/"+r+"/search?types="+this._getTypeString()+"&method="+s+"&fields=id,position,userName,searchPath,tenantID,ancestors,permissions,disabled,defaultName,surname,givenName,creationTime,modificationTime,objectClass,hasChildren&filter="+o,l.url+="&sort="+c+this.sortColumnName,this.currentRequest=l.url,l.url+="&limit="+(this.searchPageSize+1),l.url+="&offset="+this.searchOffset,l.success=function(e){this._content=e.data,this.noMoreData=e.data.length!==this.searchPageSize+1,this.noMoreData||e.data.pop(),i(e)}.bind(this),l.error=function(e,t,n){404===e.status?(0===this.searchOffset?this._content=[]:(this._content=this.oldContent,this.searchOffset-=this.searchPageSize),this.noMoreData=!0,i()):a(e,t,n)}.bind(this),this.glassContext.services.ajax.ajax(l)}.bind(this))},_getTypeString:function(){var e="namespace,namespaceFolder";return e=e.concat(this._filterType.account?",account":"",this._filterType.role?",role":"",this._filterType.group?",group":"")},cacheOldContent:function(){this.oldContent=this._content},clearGroupedContent:function(){this._groupedContent=null},getContent:function(t){var i=[];return e.isEmpty(this._content)||(t=t||this._defaultTypes,i=e.filter(this._content,function(i){return e.includes(t,i.type)}),i=e.map(i,function(e){return this._patchItem(e)}.bind(this))),i},_patchItem:function(e){var t=this._accountTypes[e.type];return"account"===e.type&&e.givenName&&e.surname&&(e.defaultName=e.givenName+" "+e.surname),e.title=e.defaultName,e.svgIcon=t.svgIcon||"common-folder",e.toolTip=e.defaultName,e.disabled=!!e.disabled,e},getGroupedContent:function(){if(!this._groupedContent){if(this._groupedContent={},!e.isEmpty(this.getContent())){var t=e.map(this.getContent(),function(e){return this._patchItem(e)}.bind(this));this._groupedContent=e.groupBy(t,function(e){return e.type})}e.forEach(this._accountTypes,function(e,t){this._groupedContent[t]=this._groupedContent[t]||[]}.bind(this))}return this._groupedContent},getNamespaces:function(){var e=this.sortColumnName||"defaultName",t=this._nameSpaces.sort(function(t,i){if("defaultName"===e)return t.defaultName.localeCompare(i.defaultName,this.glassContext.getCoreSvc(".UserProfile").preferences.productLocale);if("modificationTime"===e){var n=new Date(t.modificationTime),s=new Date(i.modificationTime);return n-s}return 0}.bind(this));return"asc"===(this.sortOrder||"asc")?t:t.reverse()},setPathStack:function(e){this._pathStack=e},getPathStack:function(){return this._pathStack},getCurrentNamespace:function(){return this._selectedNamespace},isBuiltinNamespace:function(){return this._selectedNamespace&&"Cognos"===this._selectedNamespace.defaultName},isCognosUsersNamespace:function(){return this._selectedNamespace&&"Cognos Users"===this._selectedNamespace.defaultName},isOidcNamespace:function(){var t=this.getCurrentNamespace();return t&&e.includes(t.capabilities,"notBrowsable")?!0:!1},getCurrentPath:function(){return e.last(this._pathStack)},getAccountType:function(e){return this._accountTypes[e]},getQueryString:function(){var e=0;this.pagingEnabled&&(e=this.pagingValueSet);var t=this.sortColumnName||"defaultName",i=this.sortOrder||"asc";return"page=0|"+e+"&sorting="+t+"|"+i}});return a}),define("bi/admin/account/services/SecurityObjectSelectorAdaptor",["lodash","bi/admin/nls/StringResource","bi/admin/common/ui/listview/ListDataAdaptor"],function(e,t,i){var n=i.extend({supportPaging:!0,pageSize:50,sortChanged:!1,pagingWhileSearching:!1,getColumnSpecs:function(){return[{type:"Icon"},{type:"MultipleProperties",label:t.get("name"),sortable:!0,scope:"row",items:[{type:"Text",module:"bi/admin/common/ui/listview/columns/SecurityObject",label:t.get("name"),propertyName:"defaultName",sortable:!0,scope:"row",enableAccountItemLink:this.enableAccountItemLink},{type:"Location",module:"bi/admin/common/ui/listview/columns/SecurityObjectLocation",showAsActiveLink:!1,clickCallback:this.locationChanged.bind(this)}]},{type:"Time",module:"bi/admin/common/ui/listview/columns/SecurityObjectTime",label:t.get("lastModified"),propertyName:"modificationTime",sortable:!0}]},locationChanged:function(e){this._accountExplorer.setPathStack(e.ancestors);var t=e.ancestors[e.ancestors.length-1];this.trigger("locationChanged",{data:t,isFolderNav:!1})},init:function(e){n.inherited("init",this,arguments),$.extend(this,e),this.columnSpecs=this.getColumnSpecs(),this.isGetMoreData=!1,this.isGetLessData=!1},shouldShowFilter:function(){var t=e.isUndefined(this.hideFilter)||!this.hideFilter,i=!e.isUndefined(this.allowedSelectionTypes)&&this.allowedSelectionTypes.length>1;return t&&i},isBrowse:function(){return e.isUndefined(this.searchText)||""===this.searchText},getItems:function(e){return this.isBrowse()?(this._getItemsForBrowsing(),Promise.resolve()):this.isSearching&&!e?this.isGetMoreData?this.getNextSearchPage(!0):this.isGetLessData?this.getNextSearchPage(!1):this._getSearchResult():(this._doCommonFiltering(this._getGroupedContent()),Promise.resolve(this._accountExplorer._content))},getNextSearchPage:function(e){return this._accountExplorer.getNextSearchPage(e).then(function(){this._doCommonFiltering(this._getGroupedContent())}.bind(this))},_getSearchResult:function(){return this._accountExplorer.search(this.searchText,this.searchType).then(function(){this._doCommonFiltering(this._getGroupedContent())}.bind(this))},_getAvailableNamespaces:function(){var t=this._accountExplorer.getNamespaces();return t=e.filter(t,function(e){return e.auth})},_getGroupedContent:function(){var e,t=this._accountExplorer.getGroupedContent();return e=this._filterType?[].concat(t.namespaceFolder,this._filterType.account?t.account:"",this._filterType.group?t.group:"",this._filterType.role?t.role:""):[].concat(t.namespaceFolder,t.account,t.group,t.role)},_getItemsForBrowsing:function(){var t=this._accountExplorer.getCurrentPath();$(this).trigger("ldapBrowsingEvent",t.type);var i;"directory"===t.type?(i=this._getAvailableNamespaces(),this.cognosNamespaceOnly&&(i=e.filter(i,function(e){return"Cognos"===e.defaultName}))):(this.isGetMoreData?this._accountExplorer.getNextBrowsePage(!0):this.isGetLessData&&this._accountExplorer.getNextBrowsePage(!1),i=this._getGroupedContent()),this._doCommonFiltering(i),this.trigger("pathChanged",this._accountExplorer.getPathStack())},_doCommonFiltering:function(t){var i=[];e.forEach(t,function(t){var n=!0;if("account"===t.type&&t.userName&&(t.givenName&&t.surname?t.defaultName=t.givenName+" "+t.surname+" ("+t.userName+")":t.defaultName&&(t.defaultName=t.defaultName+" ("+t.userName+")")),this.objectInfo){var s=t.id!==object.id,a=this.isAddMemberTo&&s&&!this._isEveryoneGroup(t)&&!this._isAllAuthUserGroup(t)&&t.permissions.indexOf("write")>-1;n=a||!this.isAddMemberTo&&s}e.isUndefined(this.allowedSelectionTypes)||(n="namespace"===t.type||"namespaceFolder"===t.type?!0:e.includes(this.allowedSelectionTypes,t.type)?!0:!1),n&&i.push(t)}.bind(this)),this.items=i,this._accountExplorer.pagingEnabled&&this._accountExplorer.pagerControl&&this._accountExplorer.pagerControl.store.updatePager(this._accountExplorer,{},this)},_getRowsObj:function(e){return this.getItems(e).then(function(){return{rows:this.items,hasMore:!1}}.bind(this))},getRows:function(){return this.pagingWhileSearching?this._getRowsObj(!0):this.sortChanged?this._accountExplorer.selectPath(e.last(this._accountExplorer.getPathStack())).then(function(){return this.sortChanged=!1,this._getRowsObj()}.bind(this)):this._getRowsObj()},setOrder:function(e,t){this.sortChanged=!0;var i,n=this.getColumnSpecs()[e];if("MultipleProperties"===n.type){var s=n.items;i=s[0].propertyName}else i=this.getColumnSpecs()[e].propertyName;this._accountExplorer.sortColumnName=i,this._accountExplorer.sortOrder=t},hasMore:function(){return!1},_isEveryoneGroup:function(e){return e.searchPath.indexOf('CAMID("::Everyone')>=0},_isAllAuthUserGroup:function(e){return e.searchPath.indexOf('CAMID("::All Authenticated Users')>=0},rowClickHandler:function(i,n){if("namespace"===n.type&&!n.auth&&!e.includes(this.allowedSelectionTypes,"namespace"))return void i.glassContext.appController.showToast(t.get("noSigninToViewErrorMsg"),{type:"error"});if(("namespaceFolder"===n.type||"namespace"===n.type)&&-1===n.permissions.indexOf("traverse")&&!e.includes(this.allowedSelectionTypes,"namespace"))return void i.glassContext.appController.showToast(t.get("noTraversePermissionErrorMsg"),{type:"error"});if("role"!==n.type&&"group"!==n.type||n.hasChildren)switch(n.type){case"namespace":this._accountExplorer.selectNamespace(n).then(i.updateForNavigate.bind(i));break;case"namespaceFolder":this._accountExplorer.selectFolder(n).then(i.updateForNavigate.bind(i,n));break;case"group":this._accountExplorer.selectGroup(n).then(i.updateForNavigate.bind(i));break;case"role":this._accountExplorer.selectRole(n).then(i.updateForNavigate.bind(i));break;case"account":}}});return n}),define("text!bi/admin/account/templates/SecurityObjectSelectorTemplate.html",[],function(){return'<div class="bi-admin-propertyrow bi-admin-add-member-pane-footer">\n	<div class="bi-admin-property-label"></div>\n	<div class="bi-admin-property-value propertyUIControl">\n		<div class="bi-admin-border-wrapper">\n			<button id="btnAdd_addMembers" type="button" class="propertyButton primary">{{=it.strings.add}}</button>\n		</div>\n		<div class="bi-admin-border-wrapper">\n			<button id="btnCancel_addMembers" type="button" class="propertyButton secondary">{{=it.strings.close}}</button>\n		</div>\n	</div>\n</div>'}),define("text!bi/admin/account/templates/SecurityObjectExplorerTemplate.html",[],function(){return'<div style="display: none" class="bi-admin-filterbar folderpane-filterbar" >\n    <div class="bi-admin-filterbar-leading">\n        <input type="search">\n    </div>\n    {{?it.showFilter}}\n    <div class="bi-admin-filterbar-trailing">\n       <div class="bi-admin-filter-wrapper-identifier">\n		     <div class="bi-admin-filter-wrapper">\n		        <button class="ba-common-button bi-admin-account-filter" id="filterDef" title="{{=it.strings.type}}" tabindex="0">\n			    	<svg class="svgIcon">\n			       		<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#common-filter"></use>\n			        </svg>\n                </button>\n			</div>\n		</div>\n   	</div>\n   	{{?}}\n</div>\n<div class="bi-admin-account-list-toolbar">\n    <div class="expl-navbar bi-admin-account-list-navbar">\n        <div class="appbarRow">\n            <div class="appbarLeading">\n                <div id="breadcrumbs"></div>\n            </div>\n            <div class="appbarTrailing"></div>\n        </div>\n    </div>\n    <div class="bi-admin-account-createNewBar">\n    </div>\n    <!--\n    <div class="multiUploadRow">\n        <a class="multiUploadBtn">\n            <svg class="svgIcon">\n                <use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#common-upload"></use>\n            </svg>\n            <span class="multiUploadText"></span>\n        </a>\n    </div>\n    -->\n</div>\n\n<div class="bi-admin-account-list bi-admin-flexcontent">\n</div>\n\n<div class="bi-admin-account-pagingBar">\n</div>\n'}),define("text!bi/admin/account/templates/CreateNewGroupTemplate.html",[],function(){return'<div class="bi-admin-newpanel">\n	<div class="bi-admin-propertyrow">\n		<div class="bi-admin-property-label"><label for="name" local_id="name"></label></div>\n		<div class="bi-admin-property-value">\n			<input type="text" id="name" cog-data="defaultName" required maxLength="30" pattern="([^\']+)|([^\\u0022]+)"/>\n		</div>\n	</div>\n	<div class="bi-admin-propertyrow multiline">\n        <div class="bi-admin-property-label"><label for="description" local_id="description"></label></div>\n        <div class="bi-admin-border-wrapper">\n        	<textarea type="text" id="description" cog-data="defaultDescription" class="bi-admin-textarea"></textarea>\n        </div>\n	</div>\n	<div class="bi-admin-propertyrow">\n		<div class="bi-admin-property-label"></div>\n		<div class="bi-admin-property-value">\n			<div class="bi-admin-border-wrapper">\n				<button id="btnCreate" type="button" class="bi-button" local_id="ok"></button>\n			</div>\n			<div class="bi-admin-border-wrapper">\n				<button id="btnCancel" type="button" class="bi-button" local_id="cancel"></button>\n			</div>\n		</div>\n	</div>\n</div>'}),define("text!bi/admin/account/templates/CreateNewUserTemplate.html",[],function(){return'<div class="bi-admin-newpanel">\n	<div class="bi-admin-propertyrow">\n		<div class="bi-admin-property-label"><label for="givenName" local_id="givenName"></label></div>\n		<div class="bi-admin-property-value">\n			<input type="text" id="givenName" cog-data="givenName" required maxLength="30" pattern="([^\']+)|([^\\u0022]+)"/>\n		</div>\n	</div>\n\n	<div class="bi-admin-propertyrow">\n		<div class="bi-admin-property-label"><label for="surname" local_id="surname"></label></div>\n		<div class="bi-admin-property-value">\n			<input type="text" id="surname" cog-data="surname" required maxLength="30" pattern="([^\']+)|([^\\u0022]+)"/>\n		</div>\n	</div>\n\n	<div class="bi-admin-propertyrow">\n		<div class="bi-admin-property-label"><label for="userId" local_id="userId"></label></div>\n		<div class="bi-admin-property-value">\n			<input type="text" id="userId" cog-data="userName" required/>\n		</div>\n	</div>\n\n	<div class="bi-admin-propertyrow">\n		<div class="bi-admin-property-label"><label for="password" local_id="password"></label></div>\n		<div class="bi-admin-property-value">\n			<input type="password" id="password" cog-data="password" required autoComplete="new-password"/>\n		</div>\n	</div>\n\n	<div class="bi-admin-propertyrow">\n		<div class="bi-admin-property-label"><label for="email" local_id="email"></label></div>\n		<div class="bi-admin-property-value">\n			<input type="email" id="email" cog-data="email"/>\n		</div>\n	</div>\n\n	<div class="bi-admin-propertyrow">\n		<div class="bi-admin-property-label"></div>\n		<div class="bi-admin-property-value">\n			<div class="bi-admin-border-wrapper">\n				<button id="btnCreate" type="button" class="bi-button" local_id="ok"></button>\n			</div>\n			<div class="bi-admin-border-wrapper">\n				<button id="btnCancel" type="button" class="bi-button" local_id="cancel"></button>\n			</div>\n		</div>\n	</div>\n</div>'}),define("bi/admin/account/ui/SecurityObjectExplorerView",["q","lodash","doT","bi/commons/utils/Utils","bi/admin/account/AccountExplorer","bi/admin/common/ui/MagicWand","bacontentnav/common/ui/Breadcrumbs","bi/commons/ui/AccessibleView","bi/admin/common/ui/listview/ListView","bi/admin/nls/StringResource","bacontentnav/common/ui/ContentGenericDialog","text!bi/admin/account/templates/SecurityObjectExplorerTemplate.html","text!bi/admin/account/templates/CreateNewGroupTemplate.html","text!bi/admin/account/templates/CreateNewUserTemplate.html","bi/admin/common/utils/AJAXUtils","bi/commons/utils/BidiUtil","bi/commons/utils/ContentFormatter","bi/commons/ui/properties/PropertyUIControl","bacontentnav/common/ui/contentbar_components/Button","react-dom","react","ba-react-admin/ba-react-admin.min","bi/admin/common/Uploader"],function(e,t,i,n,s,a,o,r,c,l,d,h,u,p,g,m,f,b,_,v,w,C,x){"use strict";var y=r.extend({showBreadcrumbs:!0,defaultTypes:["namespaceFolder","group","role","account"],_breadCrumbs:null,_accountExplorer:null,listAdaptor:null,init:function(e){y.inherited("init",this,arguments),this.glassContext=e.glassContext,!this._accountExplorer&&e.accountExplorer?this._accountExplorer=e.accountExplorer:this._accountExplorer=this._getNewAccountExplorer({glassContext:e.glassContext}),this.listAdaptor=e.listAdaptor,this.parent=e.parent,this.includeToolbar=e.includeToolbar?e.includeToolbar:!1,this.hideSearch=e.hideSearch,this.filterPushed=!1,this.hidePaging=e.hidePaging,this.pagingEnabled=!1,this.filterStringValue={group:!0,account:!0,role:!0}},_getNewAccountExplorer:function(e){return new s(e)},_getLdapStatus:function(){var e={dataType:"json",type:"GET",data:{},url:g.getAJAXURL("ldapStatus"),cache:!1};return this.glassContext.services.ajax.ajax(e)},_showPaging:function(){return t.isUndefined(this.hidePaging)||!this.hidePaging},_populatePagingStatusAndValue:function(){var e=this._checkIfPagingIsEnabled(),t=this._getPagingValue();return Promise.all([e,t]).then(function(e){this.pagingEnabled="true"===e[1],this.pagingValueSet=parseInt(e[0])}.bind(this))},_renderPagingWidget:function(){if(this.pagingEnabled&&this._showPaging()){this._accountExplorer.pagingEnabled=this.pagingEnabled,this._accountExplorer.pagingValueSet=this.pagingValueSet,this._accountExplorer.searchPageSize=this.pagingValueSet;var e=w.createElement(C.Pagination,{glassContext:this.glassContext,StringResource:l,accountExplorer:this._accountExplorer,listView:this.listView,defaultPagingValue:this.pagingValueSet,listAdaptor:this.listAdaptor});this.pagerControl=v.render(e,this.$el.find(".bi-admin-account-pagingBar")[0]),this._accountExplorer.pagerControl=this.pagerControl,this.$el.find(".bi-admin-account-pagingBar").hide(),$(this.listAdaptor).on("ldapBrowsingEvent",function(e,t){this._updatePagingBar(t)}.bind(this))}},_checkIfPagingIsEnabled:function(){var e="v1/configuration/keys/Admin.namespaceChildrenPerPage",t=this.glassContext.services.fetch.get(e);return t.then(function(e){return e.data["Admin.namespaceChildrenPerPage"]})},_getPagingValue:function(){var e="v1/configuration/keys/Admin.enableNamespaceChildrenPaging",t=this.glassContext.services.fetch.get(e);return t.then(function(e){return e.data["Admin.enableNamespaceChildrenPaging"]})},_renderTemplate:function(){var e={strings:{type:l.get("type"),addNewUser:l.get("addNewUser"),addNewGroup:l.get("addNewGroup"),addNewRole:l.get("addNewRole"),addNewFolder:l.get("addNewFolder"),"import":l.get("import")},showFilter:this.listAdaptor.shouldShowFilter()},t=i.template(h)(e);this.$el.html(t),m.initElementForBidi(this.$el.find(".bi-admin-input.bi-admin-input-search")[0]),this.myAccount=w.createElement(C.UserWidget,{parent:this,glassContext:this.glassContent,StringResource:l,clickFunc:this._createObj.bind(this),importOpenIdFunc:this.importOpenId.bind(this),importFunc:this.importFunc.bind(this),label:"First Label"}),v.render(this.myAccount,this.$el.find(".bi-admin-account-createNewBar")[0]),this.$el.find(".bi-admin-account-createNewBar").hide(),this.$el.find(".multiUploadText").text(l.get("importText"))},importFunc:function(e){"importUsers"===e?this.importOpenId("users"):"importGroups"===e&&this.importOpenId("groups")},_updateOrUploadUsers:function(e){var t=this._accountExplorer.getCurrentPath().id,i={headers:{"Content-Type":"text/csv"},url:"v1/users?pid="+t,type:"POST",data:e.data,"Content-Length":e.byteLength,processData:!1};return this.glassContext.services.ajax.ajax(i)},_updateOrUploadGroups:function(e){var t=this._accountExplorer.getCurrentPath().id,i={headers:{"Content-Type":"text/csv"},url:"v1/groups?pid="+t,type:"POST",data:e.data,"Content-Length":e.byteLength,processData:!1};return this.glassContext.services.ajax.ajax(i)},_createUploader:function(e){return"users"===e?new x({glassContext:this.glassContext,$el:this.$el,fileType:"csv",ajax:this._updateOrUploadUsers.bind(this),ajaxOptions:{}}):"groups"===e?new x({glassContext:this.glassContext,$el:this.$el,fileType:"csv",ajax:this._updateOrUploadGroups.bind(this),ajaxOptions:{}}):void 0},_refreshAccountListPane:function(e){this.pagingEnabled?(this.listAdaptor.sortChanged=!1,C.PaginationHelper.reloadListViewinPagingContext(this.glassContext,this._accountExplorer,this.listView,this.listAdaptor,e)):(this.listAdaptor.sortChanged=!0,this.listView.reload(!1))},importOpenId:function(e){var t=this._createUploader(e);return t.doUpload().then(function(){this._refreshAccountListPane(!0)}.bind(this),function(e){this.glassContext.appController.showErrorMessage(l.get("OIDCErrorSuggestion",{serverError:e.responseJSON.messages}),l.get("error"))}.bind(this))},changeBrowseSearch:function(e){var t=this.$el.find(".bi-admin-account-list");e?(this._accountExplorer.newSearch(),this.listView.setPaging(!0),t.addClass("security-browsing")):(this.listView.setPaging(!0),t.removeClass("security-browsing"))},_getBaseTextDirection:function(){var e="auto";return this.glassContext.services.userProfile&&this.glassContext.services.userProfile.preferences&&this.glassContext.services.userProfile.preferences.baseTextDirection&&(e=this.glassContext.services.userProfile.preferences.baseTextDirection.toLowerCase()),e},_renderSearch:function(){var e=this.$el.find(".bi-admin-filterbar-leading"),t=w.createElement(C.AdminSearchInput,{parent:this,StringResource:l,placeholder:l.get("filterTips"),textDir:this._getBaseTextDirection(),onSearch:function(e,t,i){var n=""===t;this.listView.setPaging(!1),this.listAdaptor.searchText=encodeURIComponent(t.trim()),this.listAdaptor.searchType=i,this.listAdaptor.isSearching=!0,this._accountExplorer.clearGroupedContent(),this.listView._clearTable(),this.listView.showWorking(),n?this._accountExplorer.selectCurrentPath().then(function(){this.listView.reload(!1).then(function(){this.changeBrowseSearch(n),this._clearSearch()}.bind(this))}.bind(this)):this.listView.reload(!1).then(function(){this.changeBrowseSearch(n),this.pagingEnabled&&this.pagerControl&&this.pagerControl.store.updatePager(this._accountExplorer,this.listView,this.listAdaptor)}.bind(this))}.bind(this),ref:function(e){this._searchInput=e}.bind(this),onClear:function(e){var t=!0;this.listView.setPaging(!1),this.listAdaptor.searchText="",this._accountExplorer.clearGroupedContent(),this._accountExplorer.selectCurrentPath().then(function(){this.listView.reload(!1).then(function(){this.changeBrowseSearch(t)}.bind(this)),this.pagingEnabled&&this.pagerControl&&this._clearSearch()}.bind(this))}.bind(this)});v.render(t,e[0]),$(this.listAdaptor).on("ldapBrowsingEvent",function(e,t){this._updateFilterBar(t)}.bind(this))},_clearSearch:function(){this.pagerControl.store.updatePager(this._accountExplorer,this.listView,this.listAdaptor),this.listAdaptor.isSearching=void 0},_initializeAccountExplorer:function(){var t=e.defer();return this._accountExplorer._defaultTypes=this.defaultTypes,this._accountExplorer.startUp().done(function(){this.listAdaptor.cognosNamespaceOnly?this._accountExplorer.selectNamespace("Cognos").done(function(){
this._updateAccountExplorerInit().done(function(){this.filterStringValue.account=!1,this.filterStringValue.role=!0,"role"===this.listAdaptor.allowedSelectionTypes?this.filterStringValue.group=!1:this.filterStringValue.group=!0,t.resolve()}.bind(this))}.bind(this)):this._updateAccountExplorerInit().done(function(){this.filterStringValue.account=!0,this.filterStringValue.role=!0,this.filterStringValue.group=!0,t.resolve()}.bind(this))}.bind(this)),t.promise},_updateAccountExplorerInit:function(){var t=e.defer();return this._getLdapStatus().done(function(e){this._ldapStatus=!!e["ads-state"],this._configToolBar(),t.resolve()}.bind(this)),this.listAdaptor._accountExplorer=this._accountExplorer,this.listAdaptor.on("pathChanged",function(e){this._updateBreadcrumb(e),this.listAdaptor.off("locationChanged"),this.listAdaptor.on("locationChanged",function(e){this._navigate(e.data)}.bind(this))}.bind(this)),t.promise},_renderListView:function(){var t=e.defer(),i=this.$el.find(".bi-admin-account-list");return i.addClass("security-browsing"),i.empty(),this.listView=this._getNewListView({el:i,dataAdaptor:this.listAdaptor,glassContext:this.glassContext,accessibleLabel:this.title,activeInputForm:null,multiSelect:!0,onSelectionChange:this.onSelectionChange}),this.listView.singleSelectCallback=this._rowClickHandler.bind(this),this.listAdaptor.contextMenuHandler&&(this.listView.contextMenuCallback=this.listAdaptor.contextMenuHandler.bind(this.listAdaptor,this)),this.listView.render().then(function(){this.pagingEnabled||this._bindListViewEvents()}.bind(this)).then(t.resolve,t.reject),t.promise},refresh:function(){this._refreshAccountListPane()},_getNewListView:function(e){return new c(e)},_bindListViewEvents:function(){$(this.listView).on("previousPage",function(){this._accountExplorer.isTopOfPage()||(this.listView.setPaging(!1),this._accountExplorer.cacheOldContent(),this._accountExplorer.clearGroupedContent(),this._accountExplorer.selectCurrentPath().then(function(){this.listAdaptor.isGetLessData=!0,this.listView.reload(!1).then(function(){this.changeBrowseSearch(!1),this.listAdaptor.isGetLessData=!1,this.listView.setPaging(!0)}.bind(this))}.bind(this)))}.bind(this)),$(this.listView).on("nextPage",function(){this.scrollCausedByRowClick||this._accountExplorer.noMoreData?delete this.scrollCausedByRowClick:(this.listView.setPaging(!1),this._accountExplorer.cacheOldContent(),this._accountExplorer.clearGroupedContent(),this._accountExplorer.selectCurrentPath().then(function(){this.listAdaptor.isGetMoreData=!0,this.listView.reload(!1).then(function(){this.changeBrowseSearch(!1),this.listAdaptor.isGetMoreData=!1,this.listView.adjustScrollForPageDown(),this.listView.setPaging(!0)}.bind(this))}.bind(this)))}.bind(this))},clearShowWorking:function(){this.$el.find(".adminAccountsShowWorking").remove()},showWorking:function(){var e=n.getLoadingAnimation(1),t=$('<div class="adminAccountsShowWorking emptyTableContent bi-admin-working"></div>');t.append(e),this.$el.append(t)},render:function(){var t=e.defer();this._renderTemplate(),this.showWorking();var i=this._populatePagingStatusAndValue()["catch"](function(e){this.pagingEnabled=!1,this.logger.error(e)}.bind(this));return this._renderSearch(),this._initializeAccountExplorer().then(function(){return i}).then(this._renderListView.bind(this)).then(function(){this._bindEvents(),this._renderPagingWidget(),this.clearShowWorking()}.bind(this)).then(t.resolve,t.reject),t.promise},_bindFilter:function(){this.filterPushed||(this.filterPushed=!0,this.glassContext.appController.showSlideOut({parent:this.parent.slideout,position:"left",width:"200px",content:{parentView:this,glassContext:this.glassCtxt,showSwitchButton:!0,module:"bi/admin/account/slideout/UserGroupSelectorPane",view:this,callback:this}}).on("hide",function(){this.filterPushed=!1}.bind(this)))},getSelectedObjects:function(){return this.listView.getSelectedObjects()},_getFilterBar:function(){return this.$el.find(".bi-admin-filterbar.folderpane-filterbar")},_getPaginBar:function(){return this.$el.find(".bi-admin-account-pagingBar")},_updateFilterBar:function(e){var t=this._getFilterBar();this._hideBar(t,e)},_updatePagingBar:function(e){var t=this._getPaginBar();this._hideBar(t,e)},_hideBar:function(e,t){"directory"===t?e.css("display","none"):e.css("display","block")},_bindEvents:function(){this.$el.find(".multiUploadBtn").on("primaryaction",function(){}.bind(this));var e=this.$el.find("#filterDef").on("primaryaction",function(){this._bindFilter()}.bind(this)),t=$('<span class="bi-admin-filter-icon">');t.text(this._filterString(this.filterStringValue)),f.middleShortenString(t),t.appendTo(e)},setFocus:function(){this.$el.find(".bi-admin-filterbar-leading input").focus()},setFocusOnAccountList:function(){this.listView.setFocus()||this.setFocus()},_filterString:function(e){for(var t,i=["account","role","group"],n=0,s=0;s<i.length;s++)e[i[s]]&&(t=0===n?l.get(i[s]):t.concat(",").concat(" ").concat(l.get(i[s])),n++);return 0===n?t=l.get("none"):n===i.length&&(t=l.get("allMember")),t},_filter:function(e){var t=this.$el.find(".bi-admin-filter-icon");t&&(t[0].title="");var i=this._filterString(e);t.text(i),f.middleShortenString(t[0]),this.listAdaptor._filterType=e||"",this._accountExplorer._filterType=this.listAdaptor._filterType,this.listAdaptor._filterString="",this.pagingEnabled?C.PaginationHelper.reloadListViewinFilteredContext(this.glassContext,this._accountExplorer,this.listView,this.listAdaptor):this.listView.reload(!1)},updateForNavigate:function(e){this.hideSearch||this._searchInput.clearSearch(),this.changeBrowseSearch(!0),this.listView.setPaging(!1),this._accountExplorer.updateHasMoreData(),this.listView.reload(!1).done(function(){this.setFocusOnAccountList(),this.listView.setPaging(!0),this.pagingEnabled&&this.pagerControl&&this.pagerControl.store.updatePager(this._accountExplorer,this.listView,this.listAdaptor)}.bind(this)),this._configToolBar(e)},_navigate:function(e){this.listAdaptor.searchText=void 0,this._accountExplorer.selectPath(e).done(function(){this.updateForNavigate(e)}.bind(this,e))},_onNavigate:function(e){var t=this._breadCrumbs.ancestors;if(!(e>=t.length-1)){var i=t[e];this.scrollCausedByRowClick=!0,this._navigate(i)}},_checkCapabilities:function(e){return t.find(this.glassContext.services.userProfile.capabilities,function(t){return t===e})},_canShowToolbar:function(e){return this._checkCapabilities("canUseUsersGroupsAndRolesTool")&&("Cognos"===e.defaultName||"Cognos Users"===e.defaultName||this._isNonBrowsableNamespace())},_isWriteable:function(e){var i=!1;return t.find(e,function(e){i="write"===e}),i},_configToolBar:function(e){var t=this.$el.find(".bi-admin-account-createNewBar");t.css("padding","initial"),t.css("paddingTop","5px");var i=this.$el.find(".dropdown-toggle"),n=this._accountExplorer.getCurrentNamespace();return this._accountExplorer.tenantNsFolderId&&"xOg__"!==this._accountExplorer.tenantNsFolderId&&"v1/namespaces/xOg__/items?"===this._accountExplorer.currentRequest?this._accountExplorer.getFolderPermission(this._accountExplorer.tenantNsFolderId).then(function(s){this._renderConfigToolBar(e,t,i,n,s)}.bind(this))["catch"](function(s){this.tenantNsFolderPermissions=null,this._renderConfigToolBar(e,t,i,n)}.bind(this)):this._renderConfigToolBar(e,t,i,n),Promise.resolve()},_renderConfigToolBar:function(e,i,n,s,a){i.find(".admin-import-dropdown").hide(),s?"copyMoveDialog"===this.type?("Cognos"===s.defaultName?(i.find("#newGroup").hide(),i.find("#newUser").hide(),i.find("#newRole").hide(),i.find("#newFolder").show(),i.find(".admin-import-dropdown").hide()):(i.find("#newGroup").hide(),i.find("#newUser").hide(),i.find("#newFolder").hide(),i.find("#newRole").hide(),i.find(".admin-import-dropdown").hide()),this._canShowToolbar(s)?i.show():i.hide(),this.includeToolbar||i.hide(),n.show()):(t.includes(s.capabilities,"notBrowsable")&&this._isNotCloudEnviroment()?(i.find("#newUser").show(),i.find("#newGroup").show(),i.find("#newFolder").hide(),i.find("#newRole").hide(),i.find(".admin-import-dropdown").show()):e&&"namespaceFolder"===e.type&&this._isWriteable(e.permissions)||"Cognos"===s.defaultName&&"xOg__"===this._accountExplorer.tenantNsFolderId&&this._isWriteable(s.permissions)||"Cognos"===s.defaultName&&"xOg__"!==this._accountExplorer.tenantNsFolderId&&this._isWriteable(a)?(this._hideButtonBasedOnTargetType("group",i.find("#newGroup")),this._hideButtonBasedOnTargetType("folder",i.find("#newFolder")),this._hideButtonBasedOnTargetType("role",i.find("#newRole")),i.find("#newUser").hide()):"Cognos Users"===s.defaultName?(i.find("#newUser").show(),i.find("#newGroup").hide(),i.find("#newFolder").hide(),i.find("#newRole").hide()):(i.find("#newGroup").hide(),i.find("#newUser").hide(),i.find("#newFolder").hide(),i.find("#newRole").hide()),this._canShowToolbar(s)?i.show():i.hide(),n.show()):(i.hide(),n.hide())},_isNotCloudEnviroment:function(){return"xOg__"===this._accountExplorer.tenantNsFolderId},_hideButtonBasedOnTargetType:function(e,t){this.targetType&&-1===this.targetType.indexOf(e)?t.hide():t.show()},reloadList:function(){return this.listView.reload(!1)},_rowClickHandler:function(e){this.scrollCausedByRowClick=!0,this.listAdaptor.rowClickHandler&&this.listAdaptor.rowClickHandler(this,e)},_updateBreadcrumb:function(e){var t=this.$el.find("#breadcrumbs");this.showBreadcrumbs&&(this._breadCrumbs?this._breadCrumbs.updateBreadcrumb(e):(this._breadCrumbs=new o({el:t,label:l.get("breadCrumbsAccessibleLabel"),breadcrumbs:[{defaultName:"",url:""}],navigateCallback:this._onNavigate.bind(this)}),this._breadCrumbs.ancestors=this._breadCrumbs.breadcrumbs,this._breadCrumbs.render(),this._breadCrumbs.updateBreadcrumb(e)))},_allowCreateUser:function(){var e=!1;if(this._ldapStatus){var i=this._accountExplorer.getCurrentPath(),n=!1;t.forEach(this._accountExplorer.authNamespaces,function(e){"CognosEx"===e.searchPath.split('"')[1]&&(n=!0)}),e=!!i&&"namespace"===i.type&&"Cognos"===i.defaultName&&n}return e},_isNonBrowsableNamespace:function(){var e=this._accountExplorer.getCurrentNamespace();return t.includes(e.capabilities,"notBrowsable")},_createObj:function(e){var i=this._accountExplorer.getCurrentNamespace();e=e||this._filterType;var n=this._accountExplorer.getCurrentPath().id;if(t.includes(i.capabilities,"notBrowsable")&&"account"===e)this.glassContext.appController.showSlideOut({parent:this.parent.slideout,width:"400px",content:{showGobackButton:!1,module:"bi/admin/account/slideout/AddOpenIdPane",parentView:this,objectInfo:i,pid:n,glassContext:this.glassContext}});else if("account"===e){var s={businessPhone:"",contentLocale:"",faxPhone:"",homePhone:"",mobilePhone:"",pagerPhone:"",postalAddress:"",productLocale:"",userName:"",hidden:!1,shown:!1,password:"",description:"",type:"account"};this.newGroupSlideout=this.glassContext.appController.showSlideOut({parent:this.parent.slideout,width:"400px",content:{module:"bi/admin/account/slideout/CreateNewPane",parentView:this,template:"account"===e?p:u,objectInfo:"account"===e?s:{},pid:n,type:e,glassContext:this.glassContext}})}else this._isNonBrowsableNamespace()&&"group"===e?this.listView.addInput("nonBrowsableGroup",n,this._accountExplorer,this.listAdaptor):this.listView.addInput(e,n,this._accountExplorer,this.listAdaptor)},showProperties:function(e,t){this.propertySlideout=this.glassContext.appController.showSlideOut({parent:this.parent.slideout,launchPoint:this.parent.slideout.$el.find("span.goback-icon"),width:"400px",onHide:function(){this.propertySlideout&&this.propertySlideout.contentView&&this.propertySlideout.contentView.onHide&&this.propertySlideout.contentView.onHide().then(function(){this.propertySlideout.hide()}.bind(this))}.bind(this),content:{module:"bi/admin/common/PropertiesPageView",parentView:this,objectInfo:e,type:e.type,selectedTabModule:t||"",accountExplorer:this._accountExplorer,glassContext:this.glassContext}})},_deleteAccountObj:function(e){require(["bi/admin/account/ui/ConfirmDeleteContentView"],function(t){var i=new d({title:l.get("confirmDelete"),viewClass:t,viewOptions:{accountObj:e,accountAdaptor:this.listAdaptor,listView:this.listView,showCheckbox:!1,accountExplorer:this._accountExplorer,glassContext:this.glassContext}});i.setLaunchPoint(this.$el.find(".bi-admin-filterbar-leading input")),i.open()}.bind(this))},_deleteUserProfileObj:function(e){require(["bi/admin/account/ui/ConfirmDeleteContentView"],function(t){var i=new d({title:l.get("confirmDelete"),viewClass:t,viewOptions:{accountObj:e,accountAdaptor:this.listAdaptor,listView:this.listView,showCheckbox:!1,accountExplorer:this._accountExplorer,glassContext:this.glassContext,deleteUserProfile:!0}});i.setLaunchPoint(this.$el.find(".bi-admin-filterbar-leading input")),i.open()}.bind(this))},createUserProfile:function(e){var t=e[0].id,i=g.getPath("createUserProfile",t),n={dataType:"json",type:"GET",url:i};return this.glassContext.getCoreSvc(".Ajax").ajax(n).then(function(e){this.glassContext.appController.showToast(l.get("userProfileCreationSuccessful")),this._refreshAccountListPane()}.bind(this),function(e,t){this.glassContext.appController.showErrorMessage(l.get("userProfileCreationFailed")+", "+g.buildErrorMessage(t.responseJSON.errors))}.bind(this))},_copyUserProfileObj:function(e){this.copyProfileSlideout=this.glassContext.appController.showSlideOut({parent:this.parent.slideout,width:"400px",onHide:function(){this.copyProfileSlideout&&this.copyProfileSlideout.contentView&&this.copyProfileSlideout.contentView.onHide&&this.copyProfileSlideout.contentView.onHide().then(function(){this.copyProfileSlideout.hide()}.bind(this))}.bind(this),content:{module:"bi/admin/account/slideout/CopyUserProfilePane",parentView:this,data:e,accountExplorer:this._accountExplorer,glassContext:this.glassContext,listRefresh:this._refreshAccountListPane.bind(this),deleteUserProfile:this._deleteUserProfileObj.bind(this)}})},_openSecurityObjectSelectorPane:function(e,t){var i;t.indexOf(",")>-1?i=t.split(","):(i=[],i.push(t)),this.memberInfo=e;var n=this,s=l.get("addMemberTo");this.addMemberSlideout=this.glassContext.appController.showSlideOut({parent:this.parent.slideout,width:"475px",content:{title:s,module:"bi/admin/account/slideout/SecurityObjectSelectorPane",parentView:n,objectInfo:n.memberInfo,allowedSelectionTypes:i,filterType:i,multiSelect:n.memberInfo.length>1?!1:!0,defaultTypes:["namespaceFolder","group","role","account"],isAddMemberTo:!0,cognosNamespaceOnly:!0,targetType:t,pagingEnabled:this.pagingEnabled,pagingValueSet:this.pagingValueSet}})}});return y}),define("bi/admin/account/slideout/SecurityObjectSelectorPane",["q","lodash","doT","bi/commons/ui/Slideout","bi/admin/account/AccountExplorer","bi/admin/account/services/SecurityObjectSelectorAdaptor","bi/admin/common/slideout/BasePane","bi/admin/common/ui/MagicWand","bacontentnav/utils/UIHelper","bacontentnav/common/ui/Breadcrumbs","bi/admin/common/ui/listview/ListView","bi/admin/nls/StringResource","text!bi/admin/account/templates/SecurityObjectSelectorTemplate.html","bi/admin/common/utils/AJAXUtils","bi/admin/account/ui/SecurityObjectExplorerView"],function(e,t,i,n,s,a,o,r,c,l,d,h,u,p,g){"use strict";var m=o.extend({title:h.get("addMembersPaneTitle"),showBreadcrumbs:!0,multiSelect:!0,_breadCrumbs:null,init:function(e){m.inherited("init",this,arguments),t.assign(this,e);var i=e.cognosNamespaceOnly?e.cognosNamespaceOnly:!1;this.title=e.fromFilterPane?h.get("selectauser"):this.title,this._accountExplorer=this._getNewAccountExplorer({glassContext:this.glassContext,pagingEnabled:e.pagingEnabled,pagingValueSet:e.pagingValueSet}),this.explorerView=this._getNewSecurityObjectExplorerView({glassContext:this.glassContext,showBreadcrumbs:!0,hideSearch:e.hideSearch,type:e.type,accountExplorer:this._accountExplorer,listAdaptor:this._getNewSecurityObjectSelectorAdaptor({glassContext:this.glassContext,allowedSelectionTypes:e.allowedSelectionTypes,cognosNamespaceOnly:i,enableAccountItemLink:e.enableAccountItemLink}),parent:this,onSelectionChange:this._onSelectionChange.bind(this)}),e.targetType&&(this.explorerView.targetType=e.targetType)},_getNewAccountExplorer:function(e){return new s(e)},_getNewSecurityObjectExplorerView:function(e){return new g(e)},_getNewSecurityObjectSelectorAdaptor:function(e){return new a(e)},renderBody:function(e){return this.explorerView.$el=e,this.explorerView.render(e).then(function(){var t={};t.strings={add:h.get("add"),close:h.get("close")};var n=i.template(u)(t);return e.append(n),this._bindEvents(),this.$el.addClass("securityObjectExplorer"),this.explorerView.reloadList()}.bind(this))},setFocus:function(){this.$body.find(".bi-admin-filterbar-leading input").focus()},setFocusOnMemberList:function(){this.listView.setFocus()||this.setFocus()},_bindEvents:function(){this.isCopyUserProfile?$("#btnAdd_addMembers").on("clicktap",this._addCopyTargetsClick.bind(this)):$("#btnAdd_addMembers").on("clicktap",this._addMembersClick.bind(this)),$("#btnCancel_addMembers").on("clicktap",this.slideout.hide.bind(this.slideout))},_addCopyTargetsClick:function(){var e=this.explorerView.getSelectedObjects();e.length>0&&!t.isUndefined(this.multiSelectCallback)&&this.isCopyUserProfile&&this.multiSelectCallback(e),this.slideout.hide()},_addMembersClick:function(){return Promise["try"](function(){this._toggleAddMembersButton(!0);var e=this.explorerView.getSelectedObjects();return 0!==e.length?t.isUndefined(this.multiSelectCallback)?t.isUndefined(this.selectedCallback)?this.isAddMemberTo?this._addToAsMember(e):this._addMember(e):this.selectedCallback(e[0]):this.multiSelectCallback(e):void this.glassContext.appController.showToast(h.get("memberSelErrorMsg"),{type:"error"})}.bind(this)).then(function(){return this._toggleAddMembersButton(!1)}.bind(this))},_onSelectionChange:function(){var e=this.explorerView.getSelectedObjects();if(e.length>0&&this._checkSelectedItemTypes(e)?this._toggleAddMembersButton(!1):this._toggleAddMembersButton(!0),this.isCopyUserProfile){var t=e.filter(function(e){return"account"===e.objectClass}),i=this.$el.find(".bi-admin-pane-header .title");t.length>0?$(i[0]).html(h.get("usersSelected",{numUsers:e.length})):$(i[0]).html(this.title)}},_toggleAddMembersButton:function(e){e===!0?this.$el.find("button#btnAdd_addMembers").addClass("disabled"):e===!1?this.$el.find("button#btnAdd_addMembers").removeClass("disabled"):this.$el.find("button#btnAdd_addMembers").toggleClass("disabled")},_addMembers:function(e,t,i){var n="";switch(e){case"group":n=p.getPath("addGroupMembers",t);break;case"role":n=p.getPath("addRoleMembers",t)}var s={dataType:"json",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(i),url:n,cache:!1};return this.glassContext.services.ajax.ajax(s)},_addToAsMember:function(i){var n=this._buildMembersFromObjectInfo(),s=!1,a=[];return t.forEach(i,function(i){if(i.permissions.indexOf("write")>-1&&t.includes(this.allowedSelectionTypes,i.objectClass)){var o=e.defer();this._addMembers(i.objectClass,i.id,n).then(function(e){o.resolve(e.warning?e.warning:h.get("addMemberMsg"))}).fail(function(e,t){o.resolve(t.responseJSON.messages[0]),s=!0}),a.push(o.promise)}else if(-1===i.permissions.indexOf("write")){var r=e.defer();r.resolve(h.get("writePermissionNeededError")),a.push(r.promise),s=!0}}.bind(this)),e.all(a).then(function(e){var t=this;e.forEach(function(e){s?t.glassContext.appController.showToast(h.get(e),{type:"error"}):t.glassContext.appController.showToast(e)})}.bind(this))},_buildMembersFromObjectInfo:function(){var e={};e.groups=[],e.users=[],e.roles=[];for(var t=0;t<this.objectInfo.length;t++){var i=this.objectInfo[t];"group"===i.type?e.groups.push({id:i.id}):e.users.push({id:i.id})}return e},_addMember:function(e){var i={};return i.groups=[],i.users=[],i.roles=[],t.forEach(e,function(e){var t=e.id,n=e.type;"group"===this.objectInfo[0].type?"group"===n?i.groups.push({id:t}):i.users.push({id:t}):"group"===n?i.groups.push({id:t}):"role"===n?i.roles.push({id:t}):i.users.push({id:t})}.bind(this)),this._addMembers(this.objectInfo[0].type,this.objectInfo[0].id,i).then(function(e){this.objectInfo[0].members=e.members,this.parentView.refresh(),this.glassContext.appController.showToast(e.warning?e.warning:h.get("addMemberMsg"))}.bind(this))},_checkSelectedItemTypes:function(e){for(var i=0;i<e.length;i++)if(!t.includes(this.allowedSelectionTypes,e[i].type))return!1;return!0}});return m}),define("bi/admin/job/JobPane",["jquery","lodash","bi/glass/app/ContentView","bi/admin/nls/StringResource","react","react-dom","ba-react-admin/ba-react-admin.min","bacontentnav/ui/dialogs/OpenDialog","bi/admin/account/slideout/SecurityObjectSelectorPane","bi/content_apps/PromptValuesView"],function(e,t,i,n,s,a,o,r,c,l){var d=i.extend({selectableItems:t.keys(o.JobStepObjects),init:function(t){d.inherited("init",this,arguments),this.objectInfo={},this.objRef&&(this.objectInfo.id=this.objRef),e.extend(this,t)},updateContent:function(e){o.JobUIStore.isOpen&&e&&(o.JobObjectStore.updateWithNewContent(this.glassContext,e),e.objectInfo&&e.objectInfo.id&&(this.objectInfo.id=e.objectInfo.id),this.trigger("change:state"))},deactivate:function(){return Promise.resolve()},activate:function(e){return e.setFocus?Promise.resolve():(o.JobObjectStore.updateWithNewContent(this.glassContext,e),e.objectInfo&&e.objectInfo.id&&(this.objectInfo.id=e.objectInfo.id),this.trigger("change:state"),Promise.resolve())},getTitle:function(){var e=o.JobObjectStore;return e.isNew?n.get("newJob"):e.defaultName},getContent:function(){return o.JobObjectStore.isNew?{objRef:""}:this.objectInfo&&this.objectInfo.id?{objRef:this.objectInfo.id}:void 0},isDirty:function(){var e=o.JobObjectStore;return e.isNew?!0:e.isDirty},getIcon:function(){return"common-job"},setTitle:function(){this.trigger("change:title",{value:this.getTitle()})},updateAfterSave:function(){this.setTitle(),this.trigger("change:dirty"),this.objectInfo.id=o.JobObjectStore.id,this.trigger("change:state")},renderAccountSelector:function(t){var i=e(t),n=["account"],s=new c({glassContext:this.glassContext,parentView:this,objectInfo:[{}],allowedSelectionTypes:n,targetType:[],$el:i});s.renderBody(i)},_openScheduleSlideout:function(e){var t=JSON.parse(JSON.stringify(e));this.glassContext.appController.showSlideOut({content:{module:"bi/schedule/views/SchedulesView",glassContext:this.glassContext,objectInfo:t},width:"390px",enableTabLooping:!0,label:"Schedule",position:"left"})},_showOptionsSlideout:function(e,t){this.glassContext.appController.showSlideOut({content:{module:"bi/admin/job/RunOptionsView",glassContext:this.glassContext,objectInformation:e,selectedStep:t},width:"390px",enableTabLooping:!0,label:n.get("options"),position:"left",onHide:function(){this.contentView.onHide()}})},openRelinkDialog:function(){var e=new r({glassContext:this.glassContext,typesToOpen:this.selectableItems,multiSelect:!1,primaryBtnText:n.get("ok"),onOpenCallback:o.JobUIStore.relinkDialogClosed.bind(o.JobUIStore,this.glassContext),dataManipulationCallback:this._filterOutNoExecute.bind(this),extraUrlParameters:["options"]});e.title=n.get("relinkAsset"),e.primaryBtnText=n.get("ok"),e.open()},openOptionsSlideout:function(e,t){var i=e;e.stepObject&&e.stepObject.length>0&&(i=e.stepObject[0]),"reportView"===i.type?o.JobAccess.getPropertiesForReportView(this.glassContext,i.id).then(function(i){var n=i.data.data[0];n.descriptor=t,this._showOptionsSlideout(n,e)}.bind(this)):this._showOptionsSlideout({id:i.id,type:i.type,canBurst:e.canBurst,descriptor:t},e)},openDeploymentSelection:function(e){var t=o.JobAccess;t.getAdminFolderID(this.glassContext).then(function(t){var i={id:t,defaultName:"Directory",type:"adminFolder",_meta:{links:{items:{mimeType:"application/json",url:"v1/objects/"+t+"/items"},self:{mimeType:"application/json",url:"v1/objects/"+t}}}},s=new r({glassContext:this.glassContext,typesToOpen:["importDeployment","exportDeployment"],multiSelect:!0,ancestors:[i],rootObjects:[i],onOpenCallback:e,extraUrlParameters:["options"]});s.title=n.get("addJobSteps"),s.primaryBtnText=n.get("jobStepsToAdd"),s.open()}.bind(this))},renderPromptSelector:function(t,i){var n=e(t);this.objectInfo={id:i.stepObject[0].id,type:i.type};var n=e(t),s=new l({glassContext:this.glassContext,parentView:this,promptDisplayValues:[],parameters:[],objectInformation:{id:i.id,type:i.type},hasPermission:!0,clearCallback:function(){console.log("weeeeee")},editCallback:function(){console.log("weeeeee")},$el:n,slideout:this});s.render()},_filterOutNoExecute:function(e){e.data=t.filter(e.data,function(e){return-1===this.selectableItems.indexOf(e.type)?!0:-1!==e.permissions.indexOf("execute")}.bind(this))},openContentSelection:function(e){var t=new r({glassContext:this.glassContext,typesToOpen:this.selectableItems,multiSelect:!0,primaryBtnText:n.get("addJobSteps"),filesToOpenTitle:n.get("jobStepsToAdd"),onOpenCallback:e,dataManipulationCallback:this._filterOutNoExecute.bind(this),extraUrlParameters:["options"]});t.title=n.get("addJobSteps"),t.primaryBtnText=n.get("jobStepsToAdd"),t.open()},remove:function(){o.JobUIStore.setIsOpen(!1),d.inherited("remove",this,arguments),a.unmountComponentAtNode(this.$el[0])},render:function(){o.JobUIStore.setIsOpen(!0),this.$el.addClass("jobmgt"),this.$el.css("width","100%"),this.$el.css("height","100%"),a.unmountComponentAtNode(this.$el[0]);var e=s.createElement(o.JobPane,{glassContext:this.glassContext,StringResource:n,objectInfo:this.objectInfo,dialog:this,selectedJobSteps:this.selectedSteps});return o.JobObjectStore.setOptionDefault(this.glassContext),a.render(e,this.$el[0]),Promise.resolve()}});return d.openJobPane=function(e,t){var i=e.appController.currentAppView.perspective,n={id:"job_mgt",content:t};return"job_mgt"===i&&t.setFocus?void 0:t.addToJob===!0?void e.appController.openAppView("job_mgt",n):void e.appController.closeAppView("job_mgt","job_mgt").then(function(){setTimeout(function(){e.appController.openAppView("job_mgt",n)},1)})},d}),define("js/admin/jobsBundle",function(){});