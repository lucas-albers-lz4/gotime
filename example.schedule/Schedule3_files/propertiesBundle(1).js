/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Content Apps
 * (C) Copyright IBM Corp. 2016, 2018
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

define("bi/content_apps/common/ui/permissions/Policy",[],function(){"use strict";function o(t,e,i,n){if(!(this instanceof o))throw new TypeError("Policy constructor cannot be called as a function.");this.permissions=[{name:"read",access:"grant"},{name:"traverse",access:"grant"}],this.securityObject={defaultName:t,id:e,type:i,searchPath:n}}return o.prototype={constructor:o},o}),define("text!bi/content_apps/common/policyfacets.json",[],function(){return'{\n\t"copyright": "Licensed Materials - Property of IBM. IBM Cognos Products: BI Cloud(C) Copyright IBM Corp.2014, 2017. US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.",\n\t"facets": {\n        "accounts": "account",\n        "groups": "group",\n        "roles": "role"\n\t},\n\t"columns": []\n}'}),define("bi/content_apps/common/PolicyPropertyView",["bacontentnav/common/ContentListPageView","bi/content_apps/common/ui/permissions/Policy","text!./policyfacets.json","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentStoreObject","bacontentnav/utils/PolicyHelper","bacontentnav/common/ui/BreadcrumbDropDown","bacontentnav/utils/GlassContextHelper","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","lodash"],function(t,c,e,o,s,a,i,n,r,l){"use strict";var p=t.extend({init:function(t){this.itemURL=t.itemURL,this.showUnavailablePolicies=!1,p.inherited("init",this,arguments),l.extend(this,t),this.addURLParameters({schemaInfo:"true",fields:"surname,givenName,userName,defaultName,policies.defaultName,policies.id,policies.ancestors,permissions"}),this.contentListFacets=JSON.parse(e).facets},getPoliciesData:function(){return Promise.resolve(this.permissionsData)},_canModifyPolicies:function(t){this.canModifyPolicies=void 0===t?s.hasPermissions(this.oData.data[0],["setPolicy"])&&!s.isPoliciesAcquired(this.oData.data[0]):t},_getObject:function(){var t=this.getURLParameters(),i=this._getDefaultRequestURL();$.each(t,function(t,e){i===this.itemURL?i+="?":i+="&",i+=t+"="+e}.bind(this));var e={dataType:"json",type:"GET",data:{},url:i,cache:!1};return this.glassContext.getCoreSvc(".Ajax").ajax(e).then(function(t){return t&&t.data})},_setOData:function(t){var e=[];this.rejectedPolicies=[],t.data[0].policies&&(t.data[0].policies.forEach(function(t){"nil"===t.securityObject.type?this.rejectedPolicies.push(t):e.push(t)}.bind(this)),t.data[0].policies=e),this.oData=t},_showHideAddMemberButton:function(t){var e="0";t&&this.canModifyPolicies?this.contentBar.itemMap.add.show():(this.contentBar.itemMap.add.hide(),e="-1"),$(this.contentBar.itemMap.add.el).find("button").attr("tabindex",e)},_updateUIForEdit:function(){var t=s.isTeamContent(this.oData.data[0]),e=this.getListControl();if(this.applyToChildren=this._oPropertyUIControl.getProperty("applyToAllChildren"),t)this.contentBar.itemMap.add&&this._showHideAddMemberButton(!0);else{var i=this._oPropertyUIControl.getProperty("overrideParent").isChecked();this._canModifyPolicies(i),i?this.applyToChildren.enable():(e._clearRows(),this.multiselectBar.hide(),this.contentBar.show(),this.applyToChildren.uncheck(),this.applyToChildren.disable()),e.multiSelect=i,this.$el.removeClass("policyCanNotModify"),this.canModifyPolicies&&i||this.$el.addClass("policyCanNotModify"),this.contentBar.itemMap.add&&this._showHideAddMemberButton(i)}},render:function(){return this._getObject().then(function(t){return this._setOData(t),this.permissionsData={},this.permissionsData.data=t.data[0].policies?t.data[0].policies:[],this._canModifyPolicies(),p.inherited("render",this,arguments).then(function(){return this._updateUIForEdit(),Promise.resolve()}.bind(this))}.bind(this))},_overrideParentChanged:function(){this._updateUIForEdit(),this._enableApplyItems()},renderContent:function(){this.$el.addClass("policies"),this.$contentBars=this.$el.children().detach();var t=[];return this.rejectedPolicies&&0<this.rejectedPolicies.length&&t.push({type:"SingleLineLinks",name:"hidePolicies",items:[{align:"left",items:[{type:"text",class:"versionStatusText",value:o.get("missingPolicies"),svgIcon:"common-warning"}]}]},{type:"CheckBox",name:"showUnavailablePolicies",label:o.get("showUnavailablePolicies"),controlOnLeft:!0,checked:this.showUnavailablePolicies,onChange:this._toggleShowUnavailablePolicies.bind(this)}),s.isTeamContent(this.oData.data[0])||t.push({type:"CheckBox",name:"overrideParent",label:o.get("overrideParentPermissions"),controlOnLeft:!0,checked:!s.isPoliciesAcquired(this.oData.data[0]),onChange:this._overrideParentChanged.bind(this)}),t.push({module:"bi/content_apps/ui/RenderCallback",renderCallback:this._renderListControl.bind(this)},{type:"CheckBox",name:"applyToAllChildren",label:o.get("applyToAllChildren"),controlOnLeft:!0,onChange:this._enableApplyItems.bind(this)}),this.slideout.viewId&&t.push({type:"Footer",items:[{type:"Button",label:o.get("applyLabel"),onSelect:this.onApplyClick.bind(this),primary:!0},{type:"Button",label:o.get("cancel"),onSelect:this._onCancelClick.bind(this),primary:!1}]}),this._oPropertyUIControl=new r({el:this.$el,glassContext:this.glassContext,items:t}),this._oPropertyUIControl.render().then(function(){var t,e=this._getFooter();e&&(t=e&&e._oPropertyUIControl.getProperties(),this.applyButton=t[0],this.applyButton&&this.applyButton.disable());return Promise.resolve()}.bind(this))},_getFooter:function(){var e;return this._oPropertyUIControl.getProperties().forEach(function(t){"Footer"===t.type&&(e=t)}),e},_renderListControl:function(t){var e=$("<div></div>");return $(t).append(e),e.append(this.$contentBars),this.renderContentList({el:e,columns:this._getColumnSpecification(),$container:this.$el.closest(".propertiesUIControlPageView"),minHeight:50,url:this.url||this._getDefaultRequestURL()})},_onCancelClick:function(){this.slideout.hide()},onApplyClick:function(){var e={};e.policies=this.oData.data[0].policies,e.type=this.oData.data[0].type;var t=this._oPropertyUIControl.getProperty("overrideParent"),i=!t||t.isChecked();i?(this.rejectedPolicies&&0<this.rejectedPolicies.length&&this.rejectedPolicies.forEach(function(t){e.policies.push(t)}),e.policies.forEach(function(t){var e=t.securityObject;e.searchPath='storeID("'+e.id+'")'})):e.policies=[],this.applyToChildren&&this.applyToChildren.isChecked()&&(e._meta={schemaInfo:{policies:{applyUpdateToDescendants:!0}}});var n=JSON.stringify(e),o={headers:{Accept:"application/json","Content-Type":"application/json"},type:"PUT",url:s.getSelfLink(this.oData.data[0]),data:n};return this.applyButton&&this.applyButton.disable(),this._sendRequest(o).then(function(e){if(i)return this._updateUIForEdit(),Promise.resolve(e);this._getObject().then(function(t){return this._setOData(t),this.permissionsData={},this.permissionsData.data=t.data[0].policies?t.data[0].policies:[],this._canModifyPolicies(),this.refresh(this.itemURL),this._updateUIForEdit(),Promise.resolve(e)}.bind(this))}.bind(this))},_sendRequest:function(t,e){return e=e||function(){return Promise.resolve()},this.glassContext.getCoreSvc(".Ajax").ajax(t).then(e.bind(this)).catch(function(t){return n.showAjaxServiceError(this.glassContext,t),Promise.reject(t)}.bind(this))},_getDefaultRequestURL:function(){return this.itemURL},_getModuleName:function(){return"bi/content_apps/common/ui/PolicyPropertyView"},getFilterSpec:function(){return[{name:"allContent",label:o.get("allGenericItems"),value:"allContent"},{name:"accounts",label:o.get("policyFilterAccounts"),value:"account"},{name:"groups",label:o.get("policyFilterGroups"),value:"group"},{name:"roles",label:o.get("policyFilterRoles"),value:"role"}]},_getFilterItems:function(t,e,i,n){return l.map(t,function(t){return{name:e+t.name,icon:"wft_checkmark",label:t.label,checked:t.value===i,action:function(){n(t.name)}}})},contentbarItems:function(){var t="POLICY_FILTER_",e=window.localStorage.getItem("filterString_"+this.stateId)||"",i=this.getFilterSpec(),n=this._getFilterItems(i,t,e,this._filter.bind(this));return[{name:"nameLabel",position:"leading",style:"nameLabel",module:"bacontentnav/common/ui/contentbar_components/HiddenLabel",label:o.get("policiesTableLable")},{name:t+"typeMenu",label:o.get("type"),hcLabel:!1,position:"trailing",supportCustomCollapse:!0,showTitle:!1,updateLabel:!0,icon:"common-filter",bSVG:!0,module:"bacontentnav/common/ui/contentbar_components/ToggleMenuBar",items:n},{name:"add",position:"trailing",displayLabel:!1,label:o.get("policesAddMemberButtonLabel"),module:"bacontentnav/common/ui/contentbar_components/Button",className:"addNewFolder",supportCustomCollapse:!0,icon:"common-add",hiddenOnRender:!0,_handleClick:function(){this._openAddMembersSlideout()}.bind(this)}]},getListControlOptions:function(){return{ajaxProp:"data",emptyFolderString:o.get("emptyPolicyList"),showEmptyNewFolderButton:!1,getJSONDataCallback:this.getPoliciesData.bind(this),url:"",multiSelect:this.canModifyPolicies,rightClickContextMenu:!1}},getDefaultSort:function(){return[1,"asc"]},_isDuplicate:function(t,e){var i=!1;return t.forEach(function(t){if(t.securityObject.id===e)return!(i=!0)}),i},removeSelection:function(){setTimeout(function(){var t=this._oPropertyUIControl.getProperty("overrideParent");if(null===t||t.isChecked()){var i=this.getListControl().getSelectedObjects(),e=l.reject(this.oData.data[0].policies,function(e){return l.find(i,function(t){return e.securityObject.defaultName===t.securityObject.defaultName})});this.getListControl().removeSelectedRows(),(this.oData.data[0].policies=e)&&0<e.length?(this._enableApplyItems(),this.setFocus()):this._disableApplyItems()}}.bind(this),100)},addSelection:function(t){var e,a=0,r=0,i=this.getListControl().getDatatable(),l=i.api(),p=i.fnGetData();t.forEach(function(t){var e=t.id,i=t.type,n=t.defaultName,o=this._isDuplicate(p,e);if(a+=1,!o&&"namespaceFolder"!==i){r+=1;var s=new c(n,e,i);l.row.add(s).draw(!0),null!==this.oData.data[0].policies||(this.oData.data[0].policies=[]),this.oData.data[0].policies.push(s)}}.bind(this)),e=1===r?o.get("toastItemsWereAddedSingular",{noOfItems:r}):0===r&&1===a?o.get("toastItemsAlreadyAddedSingular"):0===r&&1<a?o.get("toastItemsAlreadyAdded"):o.get("toastItemsWereAdded",{noOfItems:r}),this.glassContext.appController.showToast(e),this._enableApplyItems()},_openAddMembersSlideout:function(t){this.glassContext.appController.showSlideOut({parent:this.slideout,width:"450",content:{module:"bi/admin/account/slideout/SecurityObjectSelectorPane",parentView:this,objectInfo:t,title:o.get("selectAccountGroupOrRole"),allowedSelectionTypes:["group","role","account","namespace"],multiSelectCallback:this.addSelection.bind(this)}})},_birdBeakMenuItems:function(){return[{label:o.get("permissionRead"),icon:"",onSelect:function(){var t=this.getListControl();t&&this._updatePermission(a.simplePermEnum.read,t.getSelectedObjects(),t.getSelectedRows())}.bind(this)},{label:o.get("permissionRun"),icon:"",onSelect:function(){var t=this.getListControl();t&&this._updatePermission(a.simplePermEnum.run,t.getSelectedObjects(),t.getSelectedRows())}.bind(this)},{label:o.get("permissionWrite"),icon:"",onSelect:function(){var t=this.getListControl();t&&this._updatePermission(a.simplePermEnum.write,t.getSelectedObjects(),t.getSelectedRows())}.bind(this)},{label:o.get("permissionFull"),icon:"",onSelect:function(){var t=this.getListControl();t&&this._updatePermission(a.simplePermEnum.full,t.getSelectedObjects(),t.getSelectedRows())}.bind(this)}]},_updatePermission:function(e,t,i){var n=0;t.forEach(function(t){t.permissions=a.clonePermissionArray(e),i[n]&&this.getListControl().updateCell(t,i[n],2),n+=1}.bind(this)),this.applyButton&&this.applyButton.enable(),this.onChange("permissionsChanged",!0)},_getColumnSpecification:function(){var t=[];t.push({type:"Icon",getDataFn:function(t){return"nil"===t.securityObject[s.TYPE]?"unknown":t.securityObject[s.TYPE]}});var e=[];return e.push({type:"Text",scope:"row",label:o.get("name"),getDataFn:function(t){if(void 0===t.securityObject[s.DEFAULT_NAME])return o.get("unavailable");var e=this.oData.data[0];return this._getUserName(e,t)}.bind(this)}),e.push({type:"Text",getDataFn:function(t){return this._getPath(t)}.bind(this)}),t.push({type:"MultipleProperties",items:e}),t.push({type:"MultipleProperties",orientation:"horizontal",weight:10,items:[{type:"Permission",clickCallback:this._openPolicyDetailSlideoutView.bind(this)},{type:"BirdBeakMenu",name:o.get("permissionSetAccess"),menuItems:this._birdBeakMenuItems()}]}),t.push({type:"ClickableIcon",name:o.get("policesRemove"),icon:"common-remove-delete",clickCallback:this.removeSelection.bind(this),a11yLabel:o.get("removeSelectedItem")}),t},_adjustWidth:function(){this.$el.addClass("pageview-small")},_refreshTable:function(){var t=this.getListControl().getSelectedRows();if(0<t.length){var e=this.getListControl().getSelectedObjects();this.getListControl().updateCell(e[0],t[0],2)}},_getUserName:function(t,e){return t.userName&&t.givenName&&t.surname&&l.escape(t.defaultName)===l.escape(e.securityObject[s.DEFAULT_NAME])?t.givenName+" "+t.surname+" ("+t.userName+")":!t.userName||t.givenName&&t.surname||l.escape(t.defaultName)!==l.escape(e.securityObject[s.DEFAULT_NAME])?l.escape(e.securityObject[s.DEFAULT_NAME]):l.escape(e.securityObject[s.DEFAULT_NAME])+" ("+t.userName+")"},_getPath:function(t){var e="";if(t.securityObject[s.ANCESTORS]&&t.securityObject[s.ANCESTORS].length){var i=t.securityObject[s.ANCESTORS];i.shift();for(var n=0;n<i.length;n++)e+=""===e?"":" > ",e+=i[n].defaultName}return e},_openPolicyDetailSlideoutView:function(t){this.slideout.addChild({width:"400",onHide:this._refreshTable.bind(this),enableTabLooping:!0,content:{module:"bi/content_apps/common/PolicyDetailsView",enableParentApplyButton:function(){this.applyButton&&this.applyButton.enable(),this._refreshTable(),this.onChange("permissionsChanged",!0)}.bind(this),objectInformation:t,ownerData:this.oData.data[0],canModify:this.canModifyPolicies}})},getListControl:function(){return this._listControl},_showUnavailablePolicies:function(){var e=this.getListControl().getDatatable().api();this.rejectedPolicies.forEach(function(t){this.oData.data[0].policies.push(t),e.row.add(t).draw(!0)}.bind(this)),this.rejectedPolicies=[]},_hideUnavailablePolicies:function(){var e=[],i=0,n=[];this.oData.data[0].policies.forEach(function(t){"nil"===t.securityObject.type?(this.rejectedPolicies.push(t),n.push(i)):e.push(t),i+=1}.bind(this)),this.getListControl().removeIndexRows(n),this.oData.data[0].policies=e},_toggleShowUnavailablePolicies:function(){this._oPropertyUIControl.getProperty("showUnavailablePolicies").isChecked()?this._showUnavailablePolicies():this._hideUnavailablePolicies(),this.showUnavailablePolicies=!this.showUnavailablePolicies},_createMultiSelectBar:function(){return p.inherited("_createMultiSelectBar",this,arguments).then(function(){var e=this.$el.find(".multiselectbar .policyMulSel");return this.msddMenu=new i({dropDownMenuSpec:{title:o.get("permissionSetAccess"),id:"birdBeakIdms",label:"BirdBeakMS",items:this._birdBeakMenuItems(),actionElement:e[0],ddMenuPlacement:"bottom"}}),this.msddMenu.render().then(function(t){e.append(t)}),Promise.resolve(this)}.bind(this))},_multiselectbarItems:function(){return Promise.resolve([{name:"SetLabel",position:"leading",module:"../../lib/gemini/app/ui/toolbar_components/Label",label:"Set",style:"policyMultiSelectLabel"},{name:"birdBeakButton",position:"leading",displayLabel:!1,label:o.get("permissionSetAccess"),icon:"common-titan-arrow-down",module:"./contentbar_components/Button",className:"policyMulSel"},{position:"leading",type:"Separator"},{name:"removeButton",position:"leading",displayLabel:!1,label:o.get("removeSelectedItem"),icon:"common-remove-delete",module:"./contentbar_components/Button",className:"policyMulSel",action:this.removeSelection.bind(this)},{name:"selectedLabel",position:"center",label:o.get("selected"),module:"../../lib/gemini/app/ui/toolbar_components/Label",style:"selectedLabel"},{name:"cancelButton",position:"trailing",label:o.get("cancel"),text:o.get("cancel"),labelOnly:!0,module:"./contentbar_components/Button",className:"cancelButton",_handleClick:function(){this._listControl._clearRows(),this.multiselectBar.hide(),this.contentBar.show()}.bind(this)}])},_enableApplyItems:function(){this.applyToChildren&&this.applyToChildren.enable(),this.applyButton&&this.applyButton.enable(),this.onChange("permissionsChanged",!0)},_disableApplyItems:function(){this.applyToChildren&&this.applyToChildren.disable(),this.applyButton&&this.applyButton.disable(),this.onChange("permissionsChanged",!1)}});return p}),define("bi/content_apps/PropertiesPermissionsTab",["bi/glass/app/ContentView","bi/content_apps/common/PolicyPropertyView","bacontentnav/utils/ContentStoreObject","underscore"],function(t,e,i,n){"use strict";var o=t.extend({init:function(t){o.inherited("init",this,arguments),n.extend(this,t),this.policyView=null},render:function(){return this.policyView=this._getPolicyPropertyView({el:this.$el,id:"policyPropertyView",slideout:this.slideout,onChange:this.onChange,glassContext:this.glassContext,itemURL:i.getSelfLink(this.objectInfo)}),this.policyView.render()},_getPolicyPropertyView:function(t){return new e(t)},onApply:function(){this.policyView.onApplyClick()}});return o}),define("bi/content_apps/PropertiesTab",["bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyTabView","bacontentnav/utils/ContentStoreObject","underscore"],function(t,i,o){"use strict";var e=t.extend({init:function(t){e.inherited("init",this,arguments),o.extend(this,t)},_setReportOption:function(t,e,i){for(var n=0;n<t.length;n++)if(t[n].name===e.name)return void(i?t.splice(n,1):t[n].value=e.value);i||t.push(e)},_setAdvancedOption:function(t,e,i,n,o){var s={};s.name=e,s.type=i,s.value=n,this._setReportOption(t,s,s.value===o)},_getRetentionValue:function(t){var e=null;return"history"===t?e=i.getRunHistoryConfig(this.objectInfo):"reportVersion"===t&&(e=i.getReportOutputVersionsConfig(this.objectInfo)),e?void 0!==e.maxDuration&&e.maxDuration?parseInt(e.maxDuration.match(/\d+/),10):e.maxObjects:1},_getRetentionUnit:function(t){var e=null;return"history"===t?e=i.getRunHistoryConfig(this.objectInfo):"reportVersion"===t&&(e=i.getReportOutputVersionsConfig(this.objectInfo)),e&&void 0!==e.maxDuration&&e.maxDuration?"D"===e.maxDuration.split(/\d+/)[1]?"days":"months":"occurrences"},_getReportRetentions:function(){return i.getReportRetentions(this.objectInfo)},_setReportRetention:function(t,e,i,n){var o={prop:"creationTime",objectClass:n};if(t)for(var s=0;s<t.length;s++)if(t[s].objectClass===n){o=t[s];break}this._setRetentionValue(o,e,i)},_getModifiedRetentions:function(t,e){var i=this._getReportRetentions(),n=!1;(e.hasOwnProperty("runHistory")||e.hasOwnProperty("runHistoryUnit"))&&(n=!0,this._setReportRetention(i,e.runHistory,e.runHistoryUnit,"history"),delete e.runHistory,delete e.runHistoryUnit),(e.hasOwnProperty("reportVersion")||e.hasOwnProperty("reportVersionUnit"))&&(n=!0,this._setReportRetention(i,e.reportVersion,e.reportVersionUnit,"reportVersion"),delete e.reportVersion,delete e.reportVersionUnit),n&&o.extend(t,{retentions:i})},_setRetentionValue:function(t,e,i){0<=e?i?"occurrences"===i?(t.maxObjects=e,delete t.maxDuration):(t.maxObjects=0,t.maxDuration="P"+e+("days"===i?"D":"M")):t.maxDuration?t.maxDuration=t.maxDuration.replace(/\d+/,e):t.maxObjects=e:i&&("occurrences"===i?t.maxDuration&&(t.maxObjects=parseInt(t.maxDuration.match(/\d+/),10),delete t.maxDuration):t.maxDuration?t.maxDuration=t.maxDuration.replace(/(\w+)(\d+)(\w+)/,"$1$2"+("days"===i?"D":"M")):(t.maxDuration="P"+t.maxObjects+("days"===i?"D":"M"),t.maxObjects=0))}});return e}),define("bi/content_apps/PromptValuesView",["bi/glass/app/ContentView","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentStoreObject","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","bi/schedule/views/PromptPickerView","bacontentnav/utils/UIHelper","lodash"],function(t,e,i,n,o,s,a){"use strict";var r=t.extend({init:function(t){r.inherited("init",this,arguments),a.extend(this,t),this.showClickables=void 0===this.isEditMode||this.isEditMode},render:function(){var t=[{}];return this.showClickables&&(t=[{type:"text",name:"editPromptValues",value:this._getBannerEditSetText()},{type:"text",value:e.get("clear"),name:"clearPromptValues",clickCallback:function(){this.promptDisplayValues=[],this._getPromptValuesSection().refreshProperties([]),this.clearCallback&&this.clearCallback()}.bind(this)}]),this._oPropertyUIControl=new n({el:this.$el,glassContext:this.glassContext,slideout:this.slideout,items:[{type:"Banner",name:"promptValuesBanner",id:this.viewId,value:e.get("currentValues"),centerLabel:!0,backButton:this.slideout.overlay,editable:!1,readOnly:!0,onClose:function(){this.slideout.hide()}.bind(this),clickables:t},{type:"CollapsibleSection",name:"SectionPromptValues",styleAsSimpleRow:!0,hideSectionTitle:!0,open:!0,items:this._getPromptItems(this.promptDisplayValues)}]}),this._areValueSet()||this._renderEmptyPaneInfoMessage(this.$el),this._oPropertyUIControl.render().then(function(){this._renderPromptPicker()}.bind(this))},_areValueSet:function(){return 0!==this._getPromptItems(this.promptDisplayValues).length},_getBannerEditSetText:function(){var t=this._areValueSet()?"edit":"set";return e.get(t)},_renderEmptyPaneInfoMessage:function(t){s.renderInfoMessage(t,e.get("noPromptsValuesSet"))},_removeEmptyPaneInfoMessage:function(t){t.find("div.contentApps_comingSoon").remove()},_renderPromptPicker:function(){var t=this.parentView&&(this.parentView.objectInfo||this.parentView.props&&this.parentView.props.objectInfo);this.promptPicker=new o({$toggler:this.$el.find('div[class^="editPromptValues'+this.viewId+' "]'),reportId:t&&t.id,values:this.parameters,useValues:!1!==this.useParameters,glassContext:this.glassContext,onFinish:function(){this._onEditFinish()}.bind(this)}),this.promptPicker.render()},_onEditFinish:function(){this.parameters=this.promptPicker.getParameterValues(),this.promptDisplayValues=i.getPromptsDisplayValues(this.parameters);var t=this._getPromptItems(this.promptDisplayValues);this._getPromptValuesSection().refreshProperties(t),this.editCallback&&this.editCallback(this.parameters),this._removeEmptyPaneInfoMessage(this.$el)},_getPromptValuesSection:function(){return this._oPropertyUIControl.getProperty("SectionPromptValues")},_getPromptItems:function(t){var e=[];if(t)for(var i=0;i<t.length;i+=1){e.push({type:"Separator"});var n=a.escape(t[i].name),o={type:"SingleLineValue",name:n,label:n,value:t[i].display};e.push(o)}return e},setFocus:function(){this._oPropertyUIControl.setFocus("promptValuesBanner")}});return r}),define("bi/content_apps/PropertiesReportTab",["bi/content_apps/PropertiesTab","bi/content_apps/utils/C10Utils","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentStoreObject","bacontentnav/utils/GlassContextHelper","bi/content_apps/PromptValuesView","bi/content_apps/PdfOptionsView","underscore","bi/content_apps/authoring/AuthoringHelper"],function(t,h,s,d,e,i,n,m,o){"use strict";var a=t.extend({ACTION_VIEW:"viewOutput",ACTION_RUN:"run",ACTION_EDIT:"edit",RUNASOWNER:"runAsOwnerRadio",pdfOptionNames:["outputPageDefinition","outputPageOrientation","userPassword","ownerPassword","allowPrintQuality","allowModifications","allowAnnotations","allowFieldCompletion","allowAssembly","allowContentCopy","allowAccessibilitySupport"],init:function(t){a.inherited("init",this,arguments),m.extend(this,t),this._getPdfOptions()},render:function(){return new Promise(function(e){this._id=m.uniqueId("prop_");var i=[],n=[this._getFormatSpec(),{type:"Separator",indent:2}];return-1===this.objectInfo.type.indexOf("powerPlay8Report")&&n.push({name:"setPdfOptions",label:s.get("pdfOptions"),value:s.get("set"),indent:2,type:"SingleLineValue",ellipses:!0,editCallback:function(){this._openPdfOptionsView()}.bind(this)},{type:"Separator",indent:2}),this._getLanguages().then(function(t){return n.push({type:"DropDown",name:d.OPTION_ACCESSIBILITY_FEATURES,label:s.get("enableAccessibilitySupport"),indent:2,options:[{label:s.get("default"),value:null,selected:null===this._getEnableAccessibilitySupport()},{label:s.get("True"),value:!0,selected:!0===this._getEnableAccessibilitySupport()},{label:s.get("False"),value:!1,selected:!1===this._getEnableAccessibilitySupport()}]},{type:"Separator",indent:2},{type:"DropDown",name:d.OPTION_OUTPUT_LOCALE,label:s.get("language"),indent:2,options:t,position:"left",parentEl:this.slideout.$el},{type:"Separator",indent:2}),i.push({name:"package",label:s.get("source"),value:this._getPackageOrModule(),type:"SingleLineValue"}),i.push({name:"promptValues",label:s.get("promptValues"),type:"SectionLabel"}),i.push({name:"executionPrompt",checked:this._getPromptValue(),label:s.get("executionPrompt"),type:"CheckBox"}),i.push({type:"Separator"}),i.push({name:"currentPromptValues",label:s.get("currentValues"),value:this._getPromptValueLabel(),type:"SingleLineValue",ellipses:!0,editCallback:function(){this._openPromptsValuesView()}.bind(this)}),i.push({type:"Separator"}),i.push({type:"CollapsibleSection",label:s.get("reportOptions"),open:!1,name:"reportOptions",items:n}),this._getAdvancedItems().then(function(t){i.push({type:"CollapsibleSection",name:"advancedReportProperties",label:s.get("advancedProperties"),items:t}),this.renderPropertyUIControl({el:this.$el,onChange:this.onChange,glassContext:this.glassContext,readOnly:!d.hasPermissions(this.objectInfo,["write"]),items:i}).then(function(){e(this)}.bind(this))}.bind(this))}.bind(this))}.bind(this))},onClose:function(){return this._closePdfOptionView(),void 0===this.getPropertyUIControl()?this.renderPropertyUIControl().then(function(){return this.getPropertyUIControl().onClose()}.bind(this)):this.getPropertyUIControl().onClose()},getModifiedProperties:function(){var t={},e=this.getPropertyUIControl().getModifiedProperties();return this._getModifiedRunAsOwner(t,e),this._getModifiedOptions(t,e),this._getModifiedRetentions(t,e),m.extend(t,e),this.logger.debug("PropertiesReportTab.getModifiedProperties",t),t},_getFormatSpec:function(){var e;if("interactiveReport"===this.objectInfo.type)e={type:"SingleLineLinks",indent:2,items:[{align:"left",items:[{type:"text",value:s.get("format")}]},{align:"right",items:[{type:"text",value:s.get("html")}]}]};else if(h.isPowerPlay(this.objectInfo.type))e={type:"SingleLineLinks",indent:2,items:[{align:"left",items:[{type:"text",value:s.get("format")}]},{align:"right",items:[{type:"text",value:s.get("pdf")}]}]};else{e={type:"DropDown",name:d.OPTION_OUTPUT_FORMAT,label:s.get("format"),indent:2,options:[{label:s.get("default"),value:"",selected:null===this._getOutputFormat()}]},o.getSupportedFormats(this.objectInfo).forEach(function(t){e.options.push({label:s.get(o.FORMAT_MESSAGE_KEY_MAP[t]),value:t,selected:this._getOutputFormat()===t})}.bind(this))}return e},_getAdvancedItems:function(){return new Promise(function(t){var e=d.getType(this.objectInfo),i=[{type:"SingleLineLinks",name:"sectionRunHistory",items:[{align:"left",items:[{labelFor:"runHistory",type:"text",value:s.get("runHistory")}]},{align:"right",items:[{type:"Input",name:"runHistory",ellipses:!1,inputClass:"narrowInput",value:this._getRetentionValue("history"),validator:{isNumber:!0}},{type:"DropDown",name:"runHistoryUnit",ariaLabel:s.get("runHistoryUnits"),options:[{label:s.get("occurrences"),value:"occurrences",selected:"occurrences"===this._getRetentionUnit("history")},{label:s.get("days"),value:"days",selected:"days"===this._getRetentionUnit("history")},{label:s.get("months"),value:"months",selected:"months"===this._getRetentionUnit("history")}]}]}]},{type:"Separator"},{type:"SingleLineLinks",name:"sectionReportVersion",items:[{align:"left",items:[{labelFor:"reportVersion",type:"text",value:s.get("reportOutputVersions")}]},{align:"right",items:[{type:"Input",name:"reportVersion",ellipses:!1,inputClass:"narrowInput",value:this._getRetentionValue("reportVersion"),validator:{isNumber:!0}},{type:"DropDown",name:"reportVersionUnit",ariaLabel:s.get("reportOutputVersionsUnits"),options:[{label:s.get("occurrences"),value:"occurrences",selected:"occurrences"===this._getRetentionUnit("reportVersion")},{label:s.get("days"),value:"days",selected:"days"===this._getRetentionUnit("reportVersion")},{label:s.get("months"),value:"months",selected:"months"===this._getRetentionUnit("reportVersion")}]}]}]}];if(this.objectInfo.type&&(i.push({type:"Separator"}),i.push(this._getDefaultActionSpec())),-1===e.indexOf("powerPlay8Report")&&(i.push({type:"Separator"},{type:"DropDown",name:"verticalElements",label:s.get("rowsPerPageHtmlReport"),options:[{label:s.get("default"),value:"null",selected:"null"===this._getRowsPerPageHtmlReport()},{label:"4",value:"4",selected:4===this._getRowsPerPageHtmlReport()},{label:"5",value:"5",selected:5===this._getRowsPerPageHtmlReport()},{label:"8",value:"8",selected:8===this._getRowsPerPageHtmlReport()},{label:"10",value:"10",selected:10===this._getRowsPerPageHtmlReport()},{label:"12",value:"12",selected:12===this._getRowsPerPageHtmlReport()},{label:"16",value:"16",selected:16===this._getRowsPerPageHtmlReport()},{label:"20",value:"20",selected:20===this._getRowsPerPageHtmlReport()},{label:"50",value:"50",selected:50===this._getRowsPerPageHtmlReport()},{label:"100",value:"100",selected:100===this._getRowsPerPageHtmlReport()},{label:"200",value:"200",selected:200===this._getRowsPerPageHtmlReport()},{label:"500",value:"500",selected:500===this._getRowsPerPageHtmlReport()},{label:"1000",value:"1000",selected:1e3===this._getRowsPerPageHtmlReport()}]}),i.push({name:"selectionBasedFeatures",label:s.get("selectionBasedFeatures"),checked:d.getOptionValue(this.objectInfo,d.OPTION_SELECTION_BASED_FEATURES,!0),type:"CheckBox"},{name:"allowNotification",label:s.get("allowNotifications"),checked:d.getAllowNotification(this.objectInfo),type:"CheckBox"},{name:"advancedOutput",label:s.get("advancedOutput"),checked:d.getOptionValue(this.objectInfo,d.OPTION_ENABLE_USER_FEATURE_SAVED_OUTPUT,!1),type:"CheckBox"})),"powerPlay8Report"===e&&i.push({type:"Separator"},{name:"powerPlay8ReportTab",type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",value:s.get("powerPlay8Report")}]},{align:"right",items:[{type:"text",value:s.get("SetExternalRespostoryLabel"),clickCallback:this._setPowerPlay8ReportOptions.bind(this)}]}]}),"reportView"!==e)return this._getRunAsOwnerInfo().then(function(t){t&&(i.push({type:"Separator"},{name:"runAsOwnerLabel",label:s.get("run"),type:"SectionLabel"}),i.push({type:"RadioButtonGroup",name:this.RUNASOWNER,value:t,ariaLabel:s.get("run"),items:[{label:s.get("runAsUser"),value:d.RUN_AS_USER},{label:s.get("runWithOwnerCapabilities"),value:d.RUN_WITH_OWNER_CAPABILITIES},{label:s.get("runAsOwner",{ownerName:d.getOwnerName(this.objectInfo)}),value:d.RUN_AS_OWNER}]}))}.bind(this),function(){}).finally(function(){t(i)});t(i)}.bind(this))},_setPowerPlay8ReportOptions:function(){h.openC10Morphlet(h.morphletMap.propPP8,this.objectInfo.type,this.objectInfo.id)},_getRunAsOwnerInfo:function(){return new Promise(function(e,i){var t=d.getOwnerSelfLink(this.objectInfo);t?this.glassContext.services.ajax.ajax({dataType:"json",type:"GET",url:t+"/items?fields=permissions&types=credential"}).then(function(t){0<t.data.length&&(d.hasPermissions(t.data[0],["execute"])||d.hasPermissions(t.data[0],["read"]))?e(d.getRunAsOwnerValue(this.objectInfo)):i(new Error)}.bind(this)):i(new Error)}.bind(this))},_getOutputFormat:function(){return d.getOption(this.objectInfo,d.OPTION_OUTPUT_FORMAT)},_getOutputLocale:function(){return d.getOption(this.objectInfo,d.OPTION_OUTPUT_LOCALE)},_getEnableAccessibilitySupport:function(){return d.getOption(this.objectInfo,d.OPTION_ACCESSIBILITY_FEATURES)},_getReportOptions:function(){return d.getOptions(this.objectInfo)},_getLanguages:function(){return new Promise(function(i){var n=this._getOutputLocale()?this._getOutputLocale():"",o=[{value:"",label:s.get("default"),selected:""===n}];if(this.glassContext)return e.getContentLocales(this.glassContext).then(function(t){for(var e in t)t.hasOwnProperty(e)&&o.push({value:e,label:t[e],selected:e===n});i(o)});i(o)}.bind(this))},_getPackageOrModule:function(){var t=d.getMetadataModelPackage(this.objectInfo)||d.getModule(this.objectInfo)||d.getBaseMetadataModelPackage(this.objectInfo)||d.getBaseModule(this.objectInfo);return t&&d.getName(t)||s.get("unavailable")},_getModifiedRunAsOwner:function(t,e){var i={},n=!1;if(e.hasOwnProperty(this.RUNASOWNER)){switch(i[d.RUN_AS_OWNER]=!1,i[d.RUN_WITH_OWNER_CAPABILITIES]=!1,e[this.RUNASOWNER]){case d.RUN_WITH_OWNER_CAPABILITIES:i[d.RUN_WITH_OWNER_CAPABILITIES]=!0;break;case d.RUN_AS_OWNER:i[d.RUN_AS_OWNER]=!0}delete e[this.RUNASOWNER],n=!0}n&&m.extend(t,i)},_getModifiedOptions:function(t,e){var i=this._getReportOptions(),n=!1;if(e.hasOwnProperty(d.OPTION_OUTPUT_FORMAT)){var o=e[d.OPTION_OUTPUT_FORMAT];t.executionFormat=o;var s={};s.name=d.OPTION_OUTPUT_FORMAT,s.type="runOptionStringArray",s.value=[o],this._setReportOption(i,s,""===s.value[0]),delete e[d.OPTION_OUTPUT_FORMAT],n=!0}if(e.hasOwnProperty(d.EXECUTION_PROMPT)){var a=h.isPowerPlay(this.objectInfo.type),r={};r.name=d.OPTION_PROMPT,r.type=a?"powerPlay8OptionBoolean":"runOptionBoolean",r.value=!!e.executionPrompt,this._setReportOption(i,r),n=!0}if(e.hasOwnProperty(d.OPTION_SELECTION_BASED_FEATURES)&&(this._setAdvancedOption(i,d.OPTION_SELECTION_BASED_FEATURES,"runOptionBoolean",!!e.selectionBasedFeatures,!0),delete e[d.OPTION_SELECTION_BASED_FEATURES],n=!0),e.hasOwnProperty(d.OPTION_ENABLE_ALLOW_NOTIFICATION)&&(n=!0),e.hasOwnProperty(d.OPTION_ENABLE_USER_FEATURE_SAVED_OUTPUT)&&(this._setAdvancedOption(i,d.OPTION_ENABLE_USER_FEATURE_SAVED_OUTPUT,"runOptionBoolean",!!e.advancedOutput,!1),n=!0),e.hasOwnProperty(d.OPTION_OUTPUT_LOCALE)){var l={},p=e[d.OPTION_OUTPUT_LOCALE];t.executionLocale=p,l.name=d.OPTION_OUTPUT_LOCALE,l.type="runOptionLanguageArray",l.value=[p],this._setReportOption(i,l,""===l.value[0]),delete e[d.OPTION_OUTPUT_LOCALE],n=!0}if(e.hasOwnProperty(d.OPTION_ACCESSIBILITY_FEATURES)){var c={};c.name=d.OPTION_ACCESSIBILITY_FEATURES,c.type="genericOptionBoolean",c.value=e[d.OPTION_ACCESSIBILITY_FEATURES],this._setReportOption(i,c,"null"===c.value||""===c.value),delete e[d.OPTION_ACCESSIBILITY_FEATURES],n=!0}if(e.hasOwnProperty(d.OPTION_HTML_ROWS_PER_PAGE)){var u={};u.name=d.OPTION_HTML_ROWS_PER_PAGE,u.type="runOptionInt",u.value=e[d.OPTION_HTML_ROWS_PER_PAGE],this._setReportOption(i,u,"null"===u.value),delete e[d.OPTION_HTML_ROWS_PER_PAGE],n=!0}this._isPdfOptionsModified(i,this.pdfOptions)&&(n=!0,i=this._getModifiedPdfOptions(i,this.pdfOptions)),n&&m.extend(t,{options:i})},_getParameters:function(){return d.getParameters(this.objectInfo)},_getPromptValueLabel:function(){var t=this._getParameters();return t&&0<t.length?t.length+" "+s.get("numOfPromptValues"):s.get("setValues")},_openPromptsValuesView:function(){h.isPowerPlay(this.objectInfo.type)?h.openC10Morphlet(h.morphletMap.runOptsPP8,this.objectInfo.type,this.objectInfo.id,[{setPrompts:"true"}]):this.glassContext.appController.showSlideOut({label:s.get("promptValues"),position:this.slideout?null:"left",overlay:!0,parent:this.slideout,width:"400",content:{module:i,parentView:this,glassContext:this.glassContext,promptDisplayValues:d.getPromptsDisplayValues(this._getParameters()),parameters:[],useParameters:!1,clearCallback:function(){0<this._getParameters().length&&this._setPrompts()}.bind(this),editCallback:function(t){this._setPrompts(t)}.bind(this)}})},_setPrompts:function(t){var e;e=null==t||0===t.length?(this.objectInfo.parameters=[],{parameters:[],type:"report"}):{parameters:this.objectInfo.parameters=t,type:"report"},this.slideout.contentView._directSave(e),this.getPropertyUIControl().getProperty("currentPromptValues").setValue(this._getPromptValueLabel())},_getRowsPerPageHtmlReport:function(){return d.getOption(this.objectInfo,d.OPTION_HTML_ROWS_PER_PAGE)},_getPdfOptions:function(){return this.pdfOptions||(this.pdfOptions=[],this._getReportOptions().forEach(function(t){if(this._isPdfOption(t)){var e={name:t.name,type:t.type,value:t.value};this.pdfOptions.push(e)}}.bind(this))),this.pdfOptions},_getOption:function(t,e){if(t)for(var i=0;i<t.length;i+=1)if(t[i].name===e)return t[i];return null},_isPdfOptionsModified:function(t,e){if(e)for(var i=0;i<e.length;i+=1){var n=this._getOption(t,e[i].name);if(!n||n.value!==e[i].value)return!0}if(t)for(var o=0;o<t.length;o+=1){var s=t[o];if(this._isPdfOption(s)){var a=this._getOption(e,s.name);if(!a||a.value!==s.value)return!0}}return!1},_getModifiedPdfOptions:function(t,e){for(var i=[],n=0;n<t.length;n+=1)this._isPdfOption(t[n])||-1!==this.pdfOptionNames.indexOf(t[n].name)||i.push(t[n]);return i.concat(e)},_closePdfOptionView:function(){this.pdfOptionView&&this.pdfOptionView.contentView&&(this.pdfOptionView.contentView.onClose(),this.pdfOptionView.hide(),this.pdfOptionView=null)},_openPdfOptionsView:function(){this.pdfOptionView=this.glassContext.appController.showSlideOut({label:s.get("pdfOptions"),position:"left",width:"400",parent:this.slideout,overlay:!0,content:{module:n,parentView:this,pdfOptions:this._getPdfOptions(),glassContext:this.glassContext,showCancel:!1,closeCallback:function(t){t&&(this.pdfOptions=[],m.extend(this.pdfOptions,t))}.bind(this)}})},_isPdfOption:function(t){return!(!t||-1===this.pdfOptionNames.indexOf(t.name))&&(0!==t.name.indexOf("allow")||0===t.type.indexOf("pdfOption"))},_getPowerPlay8OptionPrompt:function(){return d.getOption(this.objectInfo,"prompt")},_getExecutionPrompt:function(){return h.isPowerPlay(this.objectInfo.type)?this._getPowerPlay8OptionPrompt():d.getExecutionPrompt(this.objectInfo)},_getPromptValue:function(){return h.isPowerPlay(this.objectInfo.type)?this._getPowerPlay8OptionPrompt():d.getOptionValue(this.objectInfo,"prompt",!0)},_getDefaultPortalAction:function(){return this.objectInfo.defaultPortalAction},_getDefaultActionSpec:function(){var t=[{label:s.get("viewMostRecentReport"),value:this.ACTION_VIEW,selected:this._getDefaultPortalAction()===this.ACTION_VIEW},{label:s.get("runTheReport"),value:this.ACTION_RUN,selected:this._getDefaultPortalAction()===this.ACTION_RUN}];if(-1===this.objectInfo.type.indexOf("View")){var e=this.objectInfo.type.charAt(0).toUpperCase()+this.objectInfo.type.slice(1);t.push({label:s.get("open"+e),value:this.ACTION_EDIT,selected:this._getDefaultPortalAction()===this.ACTION_EDIT})}return{type:"DropDown",name:"defaultPortalAction",label:s.get("defaultPortalAction"),options:t}}});return a}),define("bi/content_apps/PropertiesC10Tab",["bi/content_apps/PropertiesTab","bi/content_apps/utils/C10Utils","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentStoreObject","lodash"],function(t,e,i,r,l){"use strict";var n=t.extend({init:function(t){n.inherited("init",this,arguments),l.extend(this,t)},_setPowerPlayReport:function(){e.openC10Morphlet(e.morphletMap.proppowerplay,this.objectInfo.type,this.objectInfo.id)},_setDocumentRetention:function(){e.openC10General(e.propGeneralTitanActionEnum.document,this.objectInfo.type,this.objectInfo.id)},_viewArchivedVersion:function(){e.openC10Morphlet(e.morphletMap.archive,this.objectInfo.type,this.objectInfo.id,[{output_tab:"arch"},{m_name:this.objectInfo.defaultName}])},_viewCurrentVersion:function(){e.openC10Morphlet(e.morphletMap.archive,this.objectInfo.type,this.objectInfo.id,[{output_tab:"current"},{m_name:this.objectInfo.defaultName}])},_getReportOptions:function(){return r.getOptions(this.objectInfo)},_setAgentDefinition:function(){e.openC10Morphlet(e.morphletMap.agent,this.objectInfo.type,this.objectInfo.id)},_setMetricsExportTask:function(){e.openC10Morphlet(e.morphletMap.metricsExport,this.objectInfo.type,this.objectInfo.id)},_setMetricsDatasourceETLTask:function(){e.openC10Morphlet(e.morphletMap.metricsImport,this.objectInfo.type,this.objectInfo.id)},_setMetricsMainteanceTask:function(){e.openC10Morphlet(e.morphletMap.metricsMainTask,this.objectInfo.type,this.objectInfo.id)},_genUILinkToC10:function(t,e,i,n){return{name:t,type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",value:e,name:"text"+t}]},{align:"right",items:[{type:"text",value:i,clickCallback:n,name:"value"+t,ariaLabelledby:"text"+t+" value"+t}]}]}},_genRunHistoryUI:function(){return{type:"SingleLineLinks",name:"sectionRunHistory",items:[{align:"left",items:[{type:"text",value:i.get("runHistory"),labelFor:"runHistory"}]},{align:"right",items:[{type:"Input",name:"runHistory",ellipses:!1,inputClass:"narrowInput",value:this._getRetentionValue("history"),validator:{isNumber:!0},onChange:this._updateSaveButton.bind(this)},{type:"DropDown",name:"runHistoryUnit",ariaLabel:i.get("runHistoryUnits"),onChange:this._updateSaveButton.bind(this),options:[{label:i.get("occurrences"),value:"occurrences",selected:"occurrences"===this._getRetentionUnit("history")},{label:i.get("days"),value:"days",selected:"days"===this._getRetentionUnit("history")},{label:i.get("months"),value:"months",selected:"months"===this._getRetentionUnit("history")}]}]}]}},_updateSaveButton:function(){this.onChange("permissionsChanged",!0)},_getItems:function(){var t=[];switch(this.objectInfo.type){case"metricsMaintenanceTask":t.push(this._genRunHistoryUI()),t.push({type:"Separator"}),t.push(this._genUILinkToC10("metricsMaintenanceTaskProp",i.get("metricsMaintenanceTask"),i.get("SetExternalRespostoryLabel"),this._setMetricsMainteanceTask.bind(this)));break;case"metricsFileImportTask":t.push(this._genRunHistoryUI()),t.push({type:"Separator"}),t.push(this._genUILinkToC10("metricsDataSourceETLTask",i.get("metricsFileImportTask"),i.get("SetExternalRespostoryLabel"),this._setMetricsDatasourceETLTask.bind(this)));break;case"metricsDataSourceETLTask":t.push(this._genRunHistoryUI()),t.push({type:"Separator"}),t.push(this._genUILinkToC10("metricsDataSourceETLTaskProp",i.get("metricsDataSourceETLTask"),i.get("SetExternalRespostoryLabel"),this._setMetricsDatasourceETLTask.bind(this)));break;case"metricsExportTask":t.push(this._genRunHistoryUI()),t.push({type:"Separator"}),t.push(this._genUILinkToC10("metricsExportTaskProp",i.get("metricsExportTask"),i.get("SetExternalRespostoryLabel"),this._setMetricsExportTask.bind(this)));break;case"planningTask":t.push(this._genRunHistoryUI());break;case"agentDefinition":case"agentDefinitionView":t.push(this._genRunHistoryUI()),t.push({type:"Separator"}),t.push(this._genUILinkToC10("agentDefinitionProp",i.get("agentDefinition"),i.get("SetExternalRespostoryLabel"),this._setAgentDefinition.bind(this)));break;case"powerPlayReport":t.push(this._genUILinkToC10("powerPlay8ReportTab",i.get("powerPlayReport"),i.get("SetExternalRespostoryLabel"),this._setPowerPlayReport.bind(this)));break;case"document":t.push(this._genUILinkToC10("layoutProperty",i.get("DocumentRetention"),i.get("SetExternalRespostoryLabel"),this._setDocumentRetention.bind(this))),t.push(this._genUILinkToC10("viewArchivedVersions",i.get("viewCurrentVersions"),i.get("viewRunHistory"),this._viewCurrentVersion.bind(this))),t.push(this._genUILinkToC10("viewArchivedVersions",i.get("viewArchivedVersions"),i.get("viewRunHistory"),this._viewArchivedVersion.bind(this)))}return t},render:function(){return this._id=l.uniqueId("prop_"),this.renderPropertyUIControl({el:this.$el,glassContext:this.glassContext,readOnly:"document"!==this.objectInfo.type&&!r.hasPermissions(this.objectInfo,["write"]),items:this._getItems()})},_getModifiedOptions:function(t,e){var i=this._getReportOptions(),n=!1;if(e.hasOwnProperty(r.OPTION_OUTPUT_FORMAT)){var o={};o.name=r.OPTION_OUTPUT_FORMAT,o.type="runOptionStringArray",o.value=[e[r.OPTION_OUTPUT_FORMAT]],this._setReportOption(i,o,"Default"===o.value[0]),delete e[r.OPTION_OUTPUT_FORMAT],n=!0}if(e.hasOwnProperty(r.OPTION_OUTPUT_LOCALE)){var s={};s.name=r.OPTION_OUTPUT_LOCALE,s.type="runOptionLanguageArray",s.value=[e[r.OPTION_OUTPUT_LOCALE]],this._setReportOption(i,s,"Default"===s.value[0]),delete e[r.OPTION_OUTPUT_LOCALE],n=!0}if(e.hasOwnProperty(r.OPTION_ACCESSIBILITY_FEATURES)){var a={};a.name=r.OPTION_ACCESSIBILITY_FEATURES,a.type="genericOptionBoolean",a.value=e[r.OPTION_ACCESSIBILITY_FEATURES],this._setReportOption(i,a,"null"===a.value),delete e[r.OPTION_ACCESSIBILITY_FEATURES],n=!0}n&&l.extend(t,{options:i})},getModifiedProperties:function(){var t={},e=this.getPropertyUIControl().getModifiedProperties();return this._getModifiedOptions(t,e),this._getModifiedRetentions(t,e),l.extend(t,e),t}});return n}),define("bi/content_apps/PropertiesCapabilitiesTab",["bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyTabView","bi/content_apps/utils/C10Utils","bi/content_apps/nls/StringResource","lodash"],function(t,e,i,n){"use strict";var o=t.extend({init:function(t){o.inherited("init",this,arguments),n.extend(this,t)},_setCapabilities:function(t){t?e.openC10Morphlet(e.morphletMap.capabilities,this.objectInfo.type,this.objectInfo.id):this.glassContext.appController.openAppView("packageCapabilities",{content:{id:this.objectInfo.id}})},_shouldInvokeOldUI:function(){return this.glassContext.getCoreSvc(".Ajax").ajax({dataType:"json",type:"GET",url:"v1/configuration/keys/Admin.oldPackageCapabilitiesUI"}).then(function(t){return!(!t.data||"true"!==t.data["Admin.oldPackageCapabilitiesUI"])}.bind(this),function(t){return this.glassContext.getCoreSvc(".Logger").error(t),!1})},render:function(){return this._id=n.uniqueId("prop_"),this._shouldInvokeOldUI().then(function(t){return this.renderPropertyUIControl({el:this.$el,glassContext:this.glassContext,items:[{name:"setCapabilities",type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",name:"setCapabilitiesText",value:i.get("capabilities")}]},{align:"right",items:[{type:"text",name:"setCapabilitiesLink",value:i.get("SetCapabilitiesLabel"),clickCallback:this._setCapabilities.bind(this,t),ariaLabelledby:"setCapabilitiesText setCapabilitiesLink"}]}]}]})}.bind(this))}});return o}),define("bi/content_apps/PropertiesJobTab",["bi/content_apps/PropertiesTab","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentStoreObject","underscore"],function(t,i,r,l){"use strict";var e=t.extend({init:function(t){e.inherited("init",this,arguments),l.extend(this,t)},render:function(){this._id=l.uniqueId("prop_");var t=!r.hasPermissions(this.objectInfo,["write"]),e=!r.hasPermissions(this.objectInfo,["traverse"]);return this.renderPropertyUIControl({el:this.$el,glassContext:this.glassContext,items:[{type:"SingleLineLinks",name:"sectionRunHistory",readOnly:t,items:[{align:"left",items:[{type:"text",value:i.get("runHistory"),labelFor:"runHistory"}]},{align:"right",items:[{type:"Input",name:"runHistory",ellipses:!1,inputClass:"narrowInput",value:this._getRetentionValue("history"),validator:{isNumber:!0},onChange:this._updateSaveButton.bind(this)},{type:"DropDown",name:"runHistoryUnit",ariaLabel:i.get("runHistoryUnits"),onChange:this._updateSaveButton.bind(this),options:[{label:i.get("occurrences"),value:"occurrences",selected:"occurrences"===this._getRetentionUnit("history")},{label:i.get("days"),value:"days",selected:"days"===this._getRetentionUnit("history")},{label:i.get("months"),value:"months",selected:"months"===this._getRetentionUnit("history")}]}]}]},{type:"CollapsibleSection",label:i.get("advancedProperties"),name:"Advanced",items:[{name:"advancedProperties",type:"SingleLineLinks",readOnly:t||e,items:[{align:"left",items:[{type:"text",name:"advancedPropertiesText",value:i.get("jobAdvancedProperties")}]},{align:"right",items:[{type:"text",value:i.get("JobAdvancedSettings"),name:"advancedPropertiesLink",ariaLabelledby:"advancedPropertiesText advancedPropertiesLink",clickCallback:this._setAdvancedProperties.bind(this)}]}]}]}]})},_updateSaveButton:function(){this.onChange("permissionsChanged",!0)},_setAdvancedProperties:function(){var t={id:e.JOB_MGT,content:{objectInfo:this.objectInfo}};this.glassContext.appController.openAppView(e.JOB_MGT,t)},getModifiedProperties:function(){var t={},e=this.getPropertyUIControl().getModifiedProperties();return this._getModifiedOptions(t,e),this._getModifiedRetentions(t,e),l.extend(t,e),t},_getOutputFormat:function(){return r.getOption(this.objectInfo,r.OPTION_OUTPUT_FORMAT)},_getOutputLocale:function(){return r.getOption(this.objectInfo,r.OPTION_OUTPUT_LOCALE)},_getEnableAccessibilitySupport:function(){return r.getOption(this.objectInfo,r.OPTION_ACCESSIBILITY_FEATURES)},_getReportOptions:function(){return r.getOptions(this.objectInfo)},_getModifiedOptions:function(t,e){var i=this._getReportOptions(),n=!1;if(e.hasOwnProperty(r.OPTION_OUTPUT_FORMAT)){var o={};o.name=r.OPTION_OUTPUT_FORMAT,o.type="runOptionStringArray",o.value=[e[r.OPTION_OUTPUT_FORMAT]],this._setReportOption(i,o,"Default"===o.value[0]),delete e[r.OPTION_OUTPUT_FORMAT],n=!0}if(e.hasOwnProperty(r.OPTION_OUTPUT_LOCALE)){var s={};s.name=r.OPTION_OUTPUT_LOCALE,s.type="runOptionLanguageArray",s.value=[e[r.OPTION_OUTPUT_LOCALE]],this._setReportOption(i,s,"Default"===s.value[0]),delete e[r.OPTION_OUTPUT_LOCALE],n=!0}if(e.hasOwnProperty(r.OPTION_ACCESSIBILITY_FEATURES)){var a={};a.name=r.OPTION_ACCESSIBILITY_FEATURES,a.type="genericOptionBoolean",a.value=e[r.OPTION_ACCESSIBILITY_FEATURES],this._setReportOption(i,a,"null"===a.value),delete e[r.OPTION_ACCESSIBILITY_FEATURES],n=!0}n&&l.extend(t,{options:i})}});return e.JOB_MGT="job_mgt",e}),define("text!bi/content_apps/common/templates/PolicyDetail.html",[],function(){return'<div style="padding: 10px">\n\t<div class="policyDetailTitle">{{=it.strings.title}}</div>\n\t<div class="policyHeaderRow">\n\t\t<div class="policyHeaderLeft ellipses">{{=_.escape(it.owner)}}</div>\n\t\t<div class="policyHeaderRight">\n\t\t\t<div class="policyHeaderSeparator" ></div>\n\t\t\t<div class="simplifiedPermission">{{=it.simpliedPolicy}}</div>\n\t\t</div>\n\t</div>\n\t<div class="propertyUIControl policyDetail"> \n\t\t<table class="propertyRow" summary="{{=it.strings.title}}" role="grid" tabindex="0">\n\t\t\t<thead>\n\t\t\t\t<tr style=" position:absolute; left:-9999px">\n\t\t\t\t\t<th scope="col">{{=it.strings.columnLabelAccess}}</th>   \n\t\t\t\t\t<th scope="col">{{=it.strings.columnLabelPermission}}</th>\n\t\t\t\t\t<th scope="col">{{=it.strings.columnLabelAction}}</th>\n\t\t\t\t</tr>\n\t\t\t</thead>\n\t\t\t<tbody>\n\n\t\t\t{{ for(var prop in it.permIcons) { }}\n\t\t\t\t<tr>\n\t\t\t\t\t<td class="permission_{{=prop}}">\n\t\t\t\t\t\t<div title="{{=it.permIcons[prop].tooltip}}" alt="{{=it.permIcons[prop].tooltip}}" role="img" aria-label="{{=it.permIcons[prop].tooltip}}" tabindex="0">\n\t\t\t\t\t\t\t<svg role="presentation" class="svgIcon">\n\t\t\t\t\t\t\t\t<text>{{=it.permIcons[prop].tooltip}}</text>\n\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="{{=it.permIcons[prop].icon}}"></use>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</td>\n\t\t\t\t\t<td scope="row" class="policyDetailLabel" aria-label="{{=it.permIcons[prop].label}}" tabindex="0">{{=it.permIcons[prop].label}}</td>\n\t\t\t\t\t<td id="{{=prop}}_id">\n\t\t\t\t\t\t{{?it.canModify}}\n\t\t\t\t\t\t<div role="button" class="clickable" aria-haspopup="true" name="{{=prop}}" tabindex="0" id="policyDetailsDropDown" aria-label="{{=it.strings.setAccess}}">\n\t\t\t\t\t\t\t<svg class="svgIcon">\n\t\t\t\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#common-titan-arrow-down"></use>\n\t\t\t\t\t\t\t</svg>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t{{?}}\n\t\t\t\t\t</td>\n\t\t\t\t</tr>\n\t\t\t{{ } }}\n\t\t\t</tbody>\n\t\t</table>\n\t\t</div>\n</div>\n'}),define("bi/content_apps/common/PolicyDetailsView",["bi/commons/ui/AccessibleView","doT","bacontentnav/common/ui/BreadcrumbDropDown","text!bi/content_apps/common/templates/PolicyDetail.html","bi/content_apps/nls/StringResource","bacontentnav/utils/PolicyHelper","bi/commons/ui/KeyCodes","bi/commons/utils/ContentFormatter","lodash"],function(t,l,i,p,c,u,e,h,r){"use strict";var n=t.extend({init:function(t){this.events={},this.events["keydown #policyDetailsDropDown"]="_handleKeyDown",n.inherited("init",this,arguments),r.extend(this,t)},_refreshPermissionUI:function(e){var t=this.$el.find(".permission_"+e),i=this.$el.find(".simplifiedPermission"),n=this.$el.find("#"+e+"_id");i.text(u.getSimplifiedPermissions(this.objectInformation.permissions)),t.empty();var o=r.find(this.objectInformation.permissions,function(t){return t.name===e}),s=o?o.access:"default",a=$('<div title="'+c.get(s)+'"><svg class="svgIcon"><text>'+s+'</text><use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#common-'+s+'_perm"></use></svg></div>');t.append(a),n.children("div").focus()},_updatePermission:function(e,t){if("default"===t){var i=r.reject(this.objectInformation.permissions,function(t){return t.name===e});this.objectInformation.permissions=i}else{var n=r.find(this.objectInformation.permissions,function(t){return t.name===e});n||(n={name:e},this.objectInformation.permissions.push(n)),n.access=t}this._refreshPermissionUI(e),"function"==typeof this.enableParentApplyButton&&this.enableParentApplyButton()},_onMenuSelect:function(t,e){var i=e.children("div").attr("name");this._updatePermission(i,t)},updateRead:function(t){this._updatePermission(u.permissionEnum.r,t)},updateWrite:function(t){this._updatePermission(u.permissionEnum.w,t)},updateExecute:function(t){this._updatePermission(u.permissionEnum.x,t)},updateSetPolicy:function(t){this._updatePermission(u.permissionEnum.sp,t)},updateTraverse:function(t){this._updatePermission(u.permissionEnum.t,t)},getOwnerName:function(){return this.ownerData.givenName&&this.ownerData.surname&&this.objectInformation.securityObject.defaultName===this.ownerData.defaultName?this.ownerData.givenName+" "+this.ownerData.surname:this.objectInformation.securityObject.defaultName},render:function(){var t=this.getOwnerName(),e=["read","write","execute","traverse","setPolicy"],i=u.getIconsForPermissionValues(this.objectInformation.permissions),n=l.template(p)({oData:this.objectInformation,simpliedPolicy:u.getSimplifiedPermissions(this.objectInformation.permissions),permIcons:i,canModify:this.canModify,owner:t,strings:{title:c.get("permissionDetails"),grant:c.get("grant"),deny:c.get("deny"),default:c.get("default"),columnLabelAccess:c.get("permissionDetailsColumnAccess"),columnLabelPermission:c.get("permissionDetailsColumnPermission"),columnLabelAction:c.get("permissionDetailsColumnAction"),setAccess:c.get("permissionSetAccess")}});this.$el.append(n);var o=this.$el.find(".ellipses");$.each(o,function(t,e){h.middleShortenString(e)});for(var s=0;s<e.length;s+=1){var a=e[s]+"_id",r=this.$el.find("#"+a);this._createDropDown(r)}return this.$el.closest(".flyoutPane").attr({"aria-label":c.get("permissionDetails"),role:"region"}),this.$el.find(".propertyRow").focus(),Promise.resolve()},setFocus:function(){var t=this.$el.find("#policyDetailsDropDown");t&&t.focus()},_createDropDown:function(t){var e=[{label:c.get("grant"),icon:"common-grant_perm",onSelect:this._onMenuSelect.bind(this,"grant",t)},{label:c.get("deny"),icon:"common-deny_perm",onSelect:this._onMenuSelect.bind(this,"deny",t)},{label:c.get("default"),icon:"common-default_perm",onSelect:this._onMenuSelect.bind(this,"default",t)}];this.ddMenu=new i({dropDownMenuSpec:{title:c.get("permissionSetAccess"),id:"myId",label:"mylabel",icon:"",items:e,actionElement:t,ddMenuPlacement:"bottom"}}),this.ddMenu.render()},_handleKeyDown:function(t){t.keyCode===e.DOWN_ARROW&&$(t.currentTarget).closest("td").click()}});return n}),define("js/content_apps/propertiesBundle",function(){});