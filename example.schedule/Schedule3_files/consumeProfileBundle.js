/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Dashboard
 * (C) Copyright IBM Corp. 2016, 2021
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}define("@dashboard-features/dataFilters/js/content/FilterContentAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){return this.apiSpec||(this.apiSpec={name:"content API",events:{propagationInfo:{namespace:"filterContent",info:{contentId:this.getId()},callStack:{name:"getFilterContent",params:[this.getId()]}},actions:{}}}),this.apiSpec},t}()})),define("@dashboard-features/dataFilters/js/content/FilterContent",["@waca/dashboard-common/js/core/APIFactory","dashboard-core/js/api/ContentAPI","./FilterContentAPISpec","dashboard-core/js/view/features/content/contentView/api/RendererAPI","dashboard-core/js/features/FeatureLoader","dashboard-core/js/features/content/state/impl/StateImpl","dashboard-core/js/features/content/internalModels/InternalModels","dashboard-core/js/features/content/contentFilter/ContentFilter","dashboard-core/js/features/content/serializer/Serializer","dashboard-core/js/features/content/InlineFeatures","dashboard-core/js/dashboard/widgets/WidgetRegistry"],(function(t,e,n,i,r,o,a,s,c,u,l){return function(n){function d(r){var o,a=r.model,s=r.features;return(o=n.call(this,arguments)||this).model=a,o.features=s,o.api=t.createAPI(_assertThisInitialized(o),[e,i]),o}_inheritsLoose(d,n);var p=d.prototype;return p.initialize=function(){var t=this,e=this.features["DashboardFeatureLoader.internal"],n=e&&e.getCurrentProfile&&e.getCurrentProfile();this.featureLoader=new r({featureParams:{dashboardAPI:this.features.API,content:this.getAPI()},profileList:n,enableProfileFeatureLoading:void 0!==n,externalFeatures:e,parentAPI:this,types:["widget","widget.live"]});var i={id:this.model.id,toJSON:function(){return t.model}};return this.featureLoader.registerFeature("state",new o({logger:this.logger}),{containerId:"com.ibm.bi.dashboard.content-features",name:"state",types:["widget"]}),this.featureLoader.registerFeature("Models.internal",new a({widgetModel:this.model,layoutModel:i}),{containerId:"com.ibm.bi.dashboard.content-features",name:"InternalModels"}),this.featureLoader.registerFeature("ContentFilter",new s({content:this,logger:this.logger}),{containerId:"com.ibm.bi.dashboard.content-features",name:"ContentFilter"}),this.featureLoader.registerFeature("Serializer",new c({layoutModel:i,content:this}),{containerId:"com.ibm.bi.dashboard.content-features.Serializer",name:"Serializer"}),this.features.API.findGlassCollection("com.ibm.bi.dashboard.content-features").then((function(e){var n;(n=e).push.apply(n,u);var i=t.features.ContentTypeRegistry;return i&&(e=i.processFeatureCollection(e)),t.featureLoader.loadFeaturesFromArray(e)})).then((function(){return t.widgetRegistry=new l,t.widgetRegistry.initialize(t.features.API)}))},p.getAPI=function(){return this.api},p.destroy=function(){this.widget&&this.widget.destroy(),this.widgetContainer&&this.widgetContainer.remove()},p.getId=function(){return this.model.id},p.getType=function(){return this.model.type},p.getFeature=function(t){return this.featureLoader.getFeature(t)},p.setFeatureEnabled=function(t,e){this.featureLoader&&this.featureLoader.setFeatureEnabled(t,e)},p.getContainer=function(){return this.features.Canvas.getContent(this.model.containerId)},p.getPropertyLayoutList=function(){},p.getPropertyNameList=function(){},p.getPropertyList=function(){},p.setPropertyValue=function(){},p.getPropertyValue=function(){},p.getContent=function(){},p.findContent=function(){},p.getChildren=function(){},p.addContent=function(){},p.removeContent=function(){},p.render=function(t){var e=this;return!t&&this.widget?this.widget.resize({reRender:!0}):this._createWidget(t).then((function(t){return t.onContainerReady({model:e.model}),t.render()}))},p._createLayoutContainer=function(t){this.widgetContainer=document.createElement("div"),this.widgetContainer.classList.add("widget"),this.widgetContainer.classList.add("liveWidget"),this.widgetContainer.style.height="100%",this.widgetContainer.style.width="100%";var e=document.createElement("div");return e.classList.add("liveWidgetContent"),e.classList.add("widgetContent"),t.appendChild(this.widgetContainer),this.widgetContainer.appendChild(e),e},p._createWidget=function(t){var e=this;return new Promise((function(n){if(e.widget)n(e.widget);else{var i=e.widgetRegistry.live.widget;require([i],(function(i){e.widget=new i({el:e._createLayoutContainer(t),dashboardApi:e.features.API,id:e.model.id,widgetModel:e.model,content:e.getAPI(),initialConfigJSON:e.featureLoader.getFeature("Serializer").toJSON(),contentFeatureLoader:{registerFeature:function(t,n,i,r){return e.featureLoader.registerFeature(n,i,r)},registerDeprecatedFeature:function(t,n,i){return e.featureLoader.registerFeature(n,i,{},!0)}}}),e.widget.initialize().then((function(){n(e.widget)}))}))}}))},d}(n)})),define("@dashboard-features/dataFilters/js/content/FilterContentProvider",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-common/js/api/ContentProviderAPI","@waca/dashboard-livewidget/js/widgets/livewidget/models/LiveWidgetModel","./FilterContent"],(function(t,e,n,i){var r=function(){function r(n){var i=n.features;this.features=i,this.api=t.createAPI(this,[e]),this.features.ContentFactory.registerProvider(this.api)}var o=r.prototype;return o.getAPI=function(){return this.api},o.getTypeList=function(){return[r.FILTER_SPEC_MODEL_TYPE]},o.addModel=function(t){return t.type=r.FILTER_SPEC_MODEL_TYPE,Promise.resolve(new n(t))},o.createContent=function(t){return t.type=r.FILTER_CONTENT_MODEL_TYPE,new i({features:this.features,model:t})},r}();return r.FILTER_SPEC_MODEL_TYPE="widget.live.filter",r.FILTER_CONTENT_MODEL_TYPE="widget.live",r})),define("@dashboard-features/dataFilters/js/api/FilterControlAddOnsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getAddOnFilterSpec=function(){},e.getInfoStrings=function(){},e.updateNeeded=function(){},e.registerFilterControl=function(){},e.deregisterFilterControl=function(){},e.registerAddOn=function(){},e.deregisterAddOn=function(){},e.updateFilterControls=function(){},e.updateFilterControl=function(){},t}()})),define("@dashboard-features/dataFilters/js/FilterControlAddOns",["@waca/dashboard-common/js/core/APIFactory","./api/FilterControlAddOnsAPI"],(function(t,e){return function(){function n(){this._api=t.createAPI(this,[e]),this._addOns=[],this._filterControlInfo=[]}var i=n.prototype;return i.getAPI=function(){return this._api},i.destroy=function(){this._addOns=null,this._filterControlInfo=null},i.getAddOnFilterSpec=function(t){var e=[];return this._addOns.forEach((function(n){return e.push.apply(e,n.getFilterSpec(t))})),e},i.getInfoStrings=function(t){var e={};return this._addOns.forEach((function(n){var i=n.getInfoStrings(t);Object.keys(i).forEach((function(t){return e[t]=i[t]}))})),e},i.updateNeeded=function(t,e){return this._addOns.some((function(n){return n.updateNeeded(t,e)}))},i.registerAddOn=function(t){this._addOns.push(t)},i.deregisterAddOn=function(t){var e=this._addOns.findIndex((function(e){return e===t}));this._addOns.splice(e,1)},i.registerFilterControl=function(t){this._findRegisteredFilterControl(t)||this._filterControlInfo.push(t)},i.deregisterFilterControl=function(t){var e=this._findRegisteredFilterControlIndex(t);-1!==e&&this._filterControlInfo.splice(e,1)},i.updateFilterControls=function(){this._filterControlInfo.forEach((function(t){var e=t.updateHandler;e.ownerObject[e.handlerName]()}))},i.updateFilterControl=function(t){var e=this;this._filterControlInfo.forEach((function(n){if(e._columnInfoMatches(n.columnInfo,t)){var i=n.updateHandler;i.ownerObject[i.handlerName]()}}))},i._columnInfoMatches=function(t,e){return Object.keys(t).every((function(n){return t[n]===e[n]}))&&Object.keys(e).every((function(n){return t[n]===e[n]}))},i._findRegisteredFilterControl=function(t){var e=this._findRegisteredFilterControlIndex(t);return-1===e?null:this._filterControlInfo[e]},i._findRegisteredFilterControlIndex=function(t){var e=t.updateHandler;return this._filterControlInfo.findIndex((function(t){return t.updateHandler.ownerObject===e.ownerObject}))},i.reset=function(){},n}()})),define("@dashboard-features/dataFilters/js/cascadingFilters/CascadingFiltersPropertiesProvider",["@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t){var e=function(){function e(t,e){this._featureModel=t||{},this._featureChecker=e,this._strategyOptions=[]}var n=e.prototype;return n.addCascadeStrategyOption=function(t,e){this._strategyOptions.push({label:t,value:e})},n.getPropertyLayoutList=function(){var n=this._isV2PropertiesEnabled()?"cascadingFilters":"general.cascadingFilters",i=[{id:"cascadingFilters",type:"Section",label:t.get("cascadingFiltersSection"),position:3},{id:e.CASCADE_GLOBAL_TO_TAB,editor:{sectionId:n,position:1,uiControl:{type:"ToggleButton",label:t.get("cascade_globalToTab")}},supportsUndoRedo:!0},{id:e.CASCADE_TAB_TO_LOCAL,editor:{sectionId:n,position:1,uiControl:{type:"ToggleButton",label:t.get("cascade_tabToLocal")}},supportsUndoRedo:!0}];return this._strategyOptions.length>1&&i.push({id:e.CASCADE_STRATEGY,editor:{sectionId:n,position:2,uiControl:{type:"DropDown",label:t.get("cascadeStrategy"),options:this._strategyOptions}},supportsUndoRedo:!0}),i},n.getPropertyList=function(){var t=this;return[{id:e.CASCADE_GLOBAL_TO_TAB,setPropertyValue:function(n){t._featureModel[e.CASCADE_GLOBAL_TO_TAB]=n},getPropertyValue:function(){return t._featureModel[e.CASCADE_GLOBAL_TO_TAB]||!1},supportsUndoRedo:!0},{id:e.CASCADE_TAB_TO_LOCAL,setPropertyValue:function(n){t._featureModel[e.CASCADE_TAB_TO_LOCAL]=n},getPropertyValue:function(){return t._featureModel[e.CASCADE_TAB_TO_LOCAL]||!1},supportsUndoRedo:!0},{id:e.CASCADE_STRATEGY,setPropertyValue:function(e){t._featureModel.cascadeStrategy=e},getPropertyValue:function(){return t._featureModel.cascadeStrategy?t._featureModel.cascadeStrategy:t._strategyOptions.length&&t._strategyOptions[0].value||void 0},supportsUndoRedo:!0}]},n.reset=function(){},n._isV2PropertiesEnabled=function(){return!(!this._featureChecker||!this._featureChecker.checkValue("dashboard","PropertiesV2","enabled"))},e}();return e.CASCADE_STRATEGY="cascadeStrategy",e.CASCADE_GLOBAL_TO_TAB="cascadeGlobalToTab",e.CASCADE_TAB_TO_LOCAL="cascadeTabToLocal",e})),define("@dashboard-features/dataFilters/js/api/CascadingFiltersAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.isCascadingFiltersEnabled=function(){},e.registerCascadeSets=function(){},e.deregisterCascadeSets=function(){},e.getCurrentStrategyAPI=function(){},e.registerCascadeStrategy=function(){},t}()})),define("@dashboard-features/dataFilters/js/api/FilterControlAddOnAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getFilterSpec=function(){},e.getInfoStrings=function(){},e.updateNeeded=function(){},t}()})),define("@dashboard-features/dataFilters/js/cascadingFilters/CascadingFilters",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-common/js/api/PropertiesProviderAPI","./CascadingFiltersPropertiesProvider","../api/CascadingFiltersAPI","../api/FilterControlAddOnAPI","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,i,r,o){var a=function(){function a(o){var a=o.features,s=o.spec;this._featureChecker=a.API&&a.API.getGlassCoreSvc(".FeatureChecker"),this._disableForStories=!("story"!==a.API.getType()),this._canvas=a.Canvas,this._filterControlAddOns=a.FilterControlAddOns,this._featureModel=s||{},this._properties=a.Properties,this._propertiesProvider=new n(this._featureModel,this._featureChecker),this._api=t.createAPIFromSpec([{implementation:this,interface:i},{implementation:this,interface:r},{implementation:this._propertiesProvider,interface:e}]),this.isCascadingFiltersEnabled()&&(this._filterControlAddOns.registerAddOn(this._api),this._properties.registerProvider(this._api),this._canvas.on("change:property:"+n.CASCADE_GLOBAL_TO_TAB,this._onCascadingFiltersCanvasPropertyChanged,this),this._canvas.on("change:property:"+n.CASCADE_TAB_TO_LOCAL,this._onCascadingFiltersCanvasPropertyChanged,this),this._canvas.on("change:property:"+n.CASCADE_STRATEGY,this._onCascadingFiltersCanvasPropertyChanged,this),this._canvas.on("change:content:cascadeSets:addToCascadeSet",this._onAddToCascadeSet,this),this._canvas.on("change:content:cascadeSets:removeFromCascadeSet",this._onRemoveFromCascadeSet,this)),this._strategies={},this._cascadeSetsApis={}}var s=a.prototype;return s.getAPI=function(){return this._api},s.destroy=function(){this._properties&&this.isCascadingFiltersEnabled()&&(this._properties.deregisterProvider(this._api),this._canvas.off("change:property:"+n.CASCADE_GLOBAL_TO_TAB,this._onCascadingFiltersCanvasPropertyChanged,this),this._canvas.off("change:property:"+n.CASCADE_TAB_TO_LOCAL,this._onCascadingFiltersCanvasPropertyChanged,this),this._canvas.off("change:property:"+n.CASCADE_STRATEGY,this._onCascadingFiltersCanvasPropertyChanged,this),this._filterControlAddOns.deregisterAddOn(this._api),this._canvas.off("change:content:cascadeSets:addToCascadeSet",this._onAddToCascadeSet,this),this._canvas.off("change:content:cascadeSets:removeFromCascadeSet",this._onRemoveFromCascadeSet,this))},s.registerCascadeStrategy=function(t){this._strategies[t.getId()]=t,this._propertiesProvider.addCascadeStrategyOption(t.getLabel(),t.getId())},s.getCurrentStrategyAPI=function(){var t=this._propertiesProvider.getPropertyList().find((function(t){return t.id===n.CASCADE_STRATEGY})).getPropertyValue();return this._strategies[t]},s.isCascadingFiltersEnabled=function(){return!this._disableForStories&&!(this._featureChecker&&this._featureChecker.checkValue("dashboard","CascadingFilters","disabled"))},s.getFilterSpec=function(t){var e=t.scope,n=t.dataSourceId,i=t.columnId,r=[];return this.isCascadingFiltersEnabled()?("global"!==e&&r.push.apply(r,this._getDashboardOptionFilters({scope:e,dataSourceId:n})),this.getCurrentStrategyAPI()&&r.push.apply(r,this.getCurrentStrategyAPI().getCascadingFilterSpec({cascadeSet:this._findCascadeSet(t),columnId:i})),r):r},s.getInfoStrings=function(t){var e={};return"global"!==t.scope&&this._getDashboardOptionFilters(t).length>0&&(e[a.DESCRIPTION_MSG]=o.get("valuesCascaded")),this.getFilterSpec(t).length>0&&(e[a.SHOWALL_MSG]=o.get("showAllData")),e},s.updateNeeded=function(t,e){if(!this.isCascadingFiltersEnabled())return!1;if(this._getPropertyValue(n.CASCADE_GLOBAL_TO_TAB)&&"global"===t.scope&&"global"!==e.scope)return!0;if(this._isTabToLocalNeeded(e.scope))return!0;if(t.scope===e.scope&&t.dataSourceId===e.dataSourceId){var i=e.scope,r=e.dataSourceId;return this.getCurrentStrategyAPI().isCascadeTarget({sourceColumnId:t.columnId,targetColumnId:e.columnId,cascadeSetList:this._getCascadeSetList(i,r)})}return!1},s._getDashboardOptionFilters=function(t){var e,i=t.scope,r=t.dataSourceId,o=[],a=this._getDataFilters(i);if(!a)return o;(this._getPropertyValue(n.CASCADE_GLOBAL_TO_TAB)&&(o=a.getFilterSpecList({contentType:"global",dataSourceId:r})),this._isTabToLocalNeeded(i))&&(e=o).push.apply(e,a.getFilterSpecList({contentType:"ancestor",dataSourceId:r}));return o},s.toJSON=function(){return this._featureModel},s.reset=function(){},s._onCascadingFiltersCanvasPropertyChanged=function(){return this._filterControlAddOns.updateFilterControls()},s._onAddToCascadeSet=function(t){var e=this,n=this._cascadeSetsApis[t.info.contentId],i=n.getCascadeSetList(),r=Array.isArray(t.info.value)?t.info.value[0]:t.info.value;i.forEach((function(t){t.findColumn(r)&&t.getColumnIdList().forEach((function(i){return e._filterControlAddOns.updateFilterControl({columnId:i,dataSourceId:t.getDataSourceId(),scope:n.getScope()})}))}))},s._onRemoveFromCascadeSet=function(t){var e=this,n=this._cascadeSetsApis[t.info.contentId];n.getCascadeSetList().forEach((function(i){e._filterControlAddOns.updateFilterControl({columnId:t.info.value,dataSourceId:i.getDataSourceId(),scope:n.getScope()}),i.getColumnIdList().forEach((function(t){e._filterControlAddOns.updateFilterControl({columnId:t,dataSourceId:i.getDataSourceId(),scope:n.getScope()})}))}))},s._getPropertyValue=function(t){var e=this._propertiesProvider.getPropertyList().find((function(e){return e.id===t}));return e&&e.getPropertyValue()},s._isTabToLocalNeeded=function(t){var e=this._canvas.getContent(t);return e&&"widget.live"===e.getType()&&this._getPropertyValue(n.CASCADE_TAB_TO_LOCAL)},s._getDataFilters=function(t){return this._canvas.getContent(t).getFeature("DataFilters")},s.registerCascadeSets=function(t){this._cascadeSetsApis[t.getContentId()]=t,"global"===t.getScope()&&(this._cascadeSetsApis.global=t)},s.deregisterCascadeSets=function(t){delete this._cascadeSetsApis[t.getContentId()],"global"===t.getScope()&&delete this._cascadeSetsApis.global},s._getCascadeSetList=function(t,e){var n=this._cascadeSetsApis[t];return n&&n.getCascadeSetList(e)||[]},s._findCascadeSet=function(t){return this._getCascadeSetList(t.scope,t.dataSourceId).find((function(e){return e.findColumn(t.columnId)}))},a}();return a.DESCRIPTION_MSG="descriptionText",a.SHOWALL_MSG="showAll",a})),define("@dashboard-features/dataFilters/js/api/CascadeStrategyAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getId=function(){},e.getLabel=function(){},e.getCascadingFilterSpec=function(){},e.isCascadeTarget=function(){},t}()})),define("@dashboard-features/dataFilters/js/cascadingFilters/FirstToLastClearStrategyProvider",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","../api/CascadeStrategyAPI"],(function(t,e,n){var i=function(){function i(r){var o=r.features;this._api=t.createAPI(this,[n]),this._id=i.id,this._label=e.get(i.id);var a=o.CascadingFilters;a&&a.registerCascadeStrategy(this)}var r=i.prototype;return r.getAPI=function(){return this._api},r.getId=function(){return this._id},r.getLabel=function(){return this._label},r.isCascadeTarget=function(t){var e=t.sourceColumnId,n=t.targetColumnId,i=t.cascadeSetList.find((function(t){return t.findColumn(e)&&t.findColumn(n)}));if(i){var r=i.getColumnIdList().findIndex((function(t){return t===e})),o=i.getColumnIdList().findIndex((function(t){return t===n}));return r>=0&&o>r}return!1},r.getCascadingFilterSpec=function(t){var e=t.cascadeSet,n=t.columnId;if(e){var i=!0,r={};return e.getColumnIdList().forEach((function(t){t===n?i=!1:i&&(r[t]=!0)})),e.getDataFilters().getFilterSpecList({includeEmptyFilters:!0}).filter((function(t){return r[t.columnId]}))}return[]},i}();return i.id="cascadeStrategy_FirstToLast",i})),define("@dashboard-features/dataFilters/js/cascadingFilters/MultiDirectionClearStrategyProvider",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","../api/CascadeStrategyAPI"],(function(t,e,n){var i=function(){function i(r){var o=r.features;this._api=t.createAPI(this,[n]),this._id=i.id,this._label=e.get(i.id);var a=o.CascadingFilters;a&&a.registerCascadeStrategy(this)}var r=i.prototype;return r.getAPI=function(){return this._api},r.getId=function(){return this._id},r.getLabel=function(){return this._label},r.isCascadeTarget=function(t){var e=t.sourceColumnId,n=t.targetColumnId,i=t.cascadeSetList.find((function(t){return t.findColumn(e)&&t.findColumn(n)}));return e!==n&&!!i},r.getCascadingFilterSpec=function(t){var e=t.cascadeSet,n=t.columnId;return e?e.getDataFilters().getFilterSpecList().filter((function(t){if(t.columnId!==n&&e.findColumn(t.columnId))return!0})):[]},i}();return i.id="cascadeStrategy_MultiDirectional",i})),define("@dashboard-features/forecast/js/indicator/internal/ForecastPredictComponents",["@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","react","prop-types","@ba/ba-ui-carbon-toolkit","underscore","@ba/ba-ui-carbon","@waca/dashboard-common/js/utils/CommonUtil"],(function(t,e,n,i,r,o,a){var s=i.Label,c=i.Tooltip,u=i.FlexLayout,l=i.HSpacer,d=i.VSpacer,p=o.TextInput,h=o.Dropdown,f=function(n){function i(t){var e,i=(e=n.call(this,t)||this)._clearValidationErrorForAllSettings(a.deepClone(t.settings));return e.state={settings:i},e}_inheritsLoose(i,n);var o=i.prototype;return o.componentDidUpdate=function(t){if(String(t.settings.map((function(t){return t.value})))!==String(this.props.settings.map((function(t){return t.value})))){var e=this._clearValidationErrorForAllSettings(a.deepClone(this.props.settings));this.setState({settings:e})}},o.validateNumberInput=function(t,e){if(r.isEmpty(t))return!0;var n=Number(t);if(!r.isNumber(n))return!1;var i=r.find(this.state.settings,(function(t){return t.id===e})),o=i.restrictions.minimum,a=i.restrictions.maximum;return o<=n&&n<=a},o._clearValidationErrorForAllSettings=function(t){var e=r.clone(t);return r.each(e,(function(t){t.showValidationError=!1})),e},o._validateNumberInputForItem=function(t,e){var n=this.validateNumberInput(e,t.id);return n||(t.showValidationError=!0,this.setState({validationError:!0})),n},o._checkAndSetNumberValues=function(t,e){if(this._validateNumberInputForItem(t,e)){var n=this._clearValidationErrorForAllSettings(this.state.settings);this.setState({validationError:!1});var i=this.props.settings.find((function(e){return e.id===t.id}));if("ignoreLastNPeriods"===t.id&&("0"===i.value||0===i.value))return void(""!==e&&"0"===e||this.props.onForecastPredictItemsChanged(a.deepClone(n)));(""===e&&i.value&&0!==i.value||""!==e&&!i.value||""!==e&&i.value&&i.value!==Number(e))&&this.props.onForecastPredictItemsChanged(a.deepClone(n))}},o.onBlur=function(t,e){this._checkAndSetNumberValues(t,e)},o.onKeyPress=function(t,e){"Enter"===e.key&&this._checkAndSetNumberValues(t,e.target.value)},o._getNumberReactComponent=function(n){var i=this,r=n.showValidationError?t.get("forecast_enter_number")+n.restrictions.minimum+t.get("and")+n.restrictions.maximum:n.value;return e.createElement("div",{className:"forecastPredictInput",key:n.id},e.createElement(c,{className:"predictForecastTooltip",title:n.description,orient:"top",disabled:this.props.isDisabled},e.createElement(s,{className:"predictForecastInputLabel",type:"caption",htmlFor:n.id,label:n.name,disabled:this.props.isDisabled})),e.createElement("div",{className:"predictForecastInputEntry"},e.createElement(p,{className:"predictForecastOptionEntry",light:!0,title:r,id:n.id,value:n.value||"",placeholder:n.default,onChange:function(t){return i._applyNumberValuesToState(t.currentTarget.value,n)},onKeyPress:function(t){return i.onKeyPress(n,t)},fireOnBlur:!0,onBlur:function(t){return i.onBlur(n,t.target.value)},invalid:n.showValidationError,disabled:this.props.isDisabled})),e.createElement(d,{size:1}))},o._updateStateClearErrorsGetNewPredictItems=function(t,e){var n=r.clone(this.state.settings);return n.forEach((function(n){n.id===e.id&&(n.showValidationError=!1,r.isEmpty(t)?delete n.value:n.value="confidenceLevel"===e.id?t:parseInt(t))})),this.setState({validationError:!1}),n},o._applyNumberValuesToState=function(t,e){this._validateNumberInputForItem(e,t)&&this._updateStateClearErrorsGetNewPredictItems(t,e)},o._applySelectValuesToState=function(t,e){var n=this._updateStateClearErrorsGetNewPredictItems(t,e);this.props.onForecastPredictItemsChanged(a.deepClone(n))},o._getEnumerationReactComponent=function(t){var n=this,i=[];t.restrictions.values.map((function(t){i.push({value:t.value,label:t.name})}));var r=t.restrictions.values.find((function(e){return t.value===e.value}));r=r?r.name:t.restrictions.values.find((function(e){return t.default===e.value})).name;var o=t.id;return e.createElement("div",{className:"forecastPredictInput",key:t.id},e.createElement(c,{className:"predictForecastTooltip",title:t.description,display:"inline-block",orient:"top",disabled:this.props.isDisabled},e.createElement(s,{className:"predictForecastInputLabel",id:o,type:"caption",htmlFor:t.id,label:t.name,disabled:this.props.isDisabled})),e.createElement("div",{className:"predictForecastInputEntry"},e.createElement(h,{className:"predictForecastOptionEntry",id:t.id,selectedItem:r,disabled:this.props.isDisabled,onChange:function(e){return n._applySelectValuesToState(e.selectedItem.value,t)},items:i,light:!0,ariaLabel:t.name})),e.createElement(d,{size:1}))},o._getPredictItem=function(t){return"enumeration"===t.restrictions.type?this._getEnumerationReactComponent(t):this._getNumberReactComponent(t)},o.render=function(){for(var t=[],n=e.createElement(l,{size:1}),i=this.state.settings.length,r=0;r<i;){var o=this._getPredictItem(this.state.settings[r++]),a=r<i?this._getPredictItem(this.state.settings[r++]):null,s=e.createElement(u,{direction:"row",justifyContent:"space-between",className:"predictForecastOptionsRow"},a?[o,n,a,n]:o);t.push(s)}return e.createElement(u,{className:"predictForecastOptions",direction:"column",justifyContent:"flex-start"},t)},i}(e.Component);return f.propTypes={isDisabled:n.bool,settings:n.array,onForecastPredictItemsChanged:n.func},f})),define("@dashboard-features/forecast/js/multivariate/ForecastDndOptionalFactorItemHandler",["jquery"],(function(t){return function(){function e(t){this.domNode=t.domNode,this.className=t.className,this.actionHandler=t.actionHandler,this.addAfter=t.addAfter,this.dndManager=t.dndManager,this.onDragEnter=t.onDragEnter,this.onDragLeave=t.onDragLeave,this.timer=null,this.dndManager&&this._setupDnD()}var n=e.prototype;return n._setupDnD=function(){var t=this,e=this.actionHandler&&this.actionHandler.onDrop&&this.actionHandler.onDrop.bind(this.actionHandler);this.dndManager.registerDropTarget({el:this.domNode,type:"optionalFactor.item",info:function(n,i){return{dragInfo:{position:{x:i.clientX,y:i.clientY}},node:n,onDragEnter:t.activateDropTarget.bind(t),onDragLeave:t.deactivateDropTarget.bind(t),onDrop:e,contentId:t.actionHandler.getContentId(),addAfter:t.addAfter,actionHandler:t.actionHandler}}})},n.destroy=function(){this.dndManager.deregisterDropTarget(this.domNode)},n.updateDropTarget=function(t){this.dndManager&&(this.actionHandler=t,this._setupDnD())},n.activateDropTarget=function(){t(this.domNode).toggleClass(this.className,!0),this.onDragEnter&&this.onDragEnter()},n.deactivateDropTarget=function(){t(this.domNode).toggleClass(this.className,!1),this.onDragLeave&&this.onDragLeave()},e}()})),define("@dashboard-features/forecast/js/multivariate/ForecastOptionalFactorFieldDropdown",["react","prop-types","jquery","underscore","@ba/ba-ui-carbon-toolkit"],(function(t,e,n,i,r){var o=i.debounce,a=r.Collapse,s=r.TextInput;return function(i){function r(e){var r;return(r=i.call(this,e)||this).scrollToDropdown=function(){if(r.dropdownRef.current){var t=r.dropdownRef.current.getBoundingClientRect().bottom-window.innerHeight;if(t>300)r.dropdownRef.current.closest(".multivariate__optionalFactors").scrollTop=t}},r.onChange=function(t){r.setState({userTextInput:t})},r.handleEscapeDropdown=function(t){"Escape"===t.key&&r.props.onBlur()},r.handleKeyDown=function(t){if("ArrowDown"===t.key){var e=r.dropdownRef.current,i=n(e).find("div.ba-common-list")[0];i&&(t.preventDefault(),i.focus())}else"Enter"===t.key&&""===r.state.userTextInput&&(t.preventDefault(),r.props.onBlur())},r.onBlur=function(){r.blurTimer=setTimeout(r.props.onBlur,350)},r.onFocus=function(){r.blurTimer&&(clearTimeout(r.blurTimer),r.blurTimer=null)},r.state={userTextInput:r.props.textValue},r.dropdownRef=t.createRef(),r}_inheritsLoose(r,i);var c=r.prototype;return c.render=function(){var e={"max-height":this.props.getDropdownMaxHeight()>0?this.props.getDropdownMaxHeight()+"px":"none"},n=t.createElement("div",{className:"multivariate__optionalFactors__dropdown",ref:this.dropdownRef,style:e},t.createElement(a,{isOpened:this.props.open,autoUnmount:!0,hasNestedCollapse:!0,forceInitialAnimation:!0,onRest:this.scrollToDropdown},this._renderMetadataTree()));return t.createElement("div",{className:"dropdownWrapper",onBlur:this.onBlur,onFocus:this.onFocus,onKeyDown:this.handleEscapeDropdown},this._renderTextInput(),n)},c._renderTextInput=function(){return t.createElement(s,{className:"itemInput",noBottomBorder:!0,value:this.state.userTextInput,autoFocus:!0,onChange:o(this.onChange.bind(this),250),onKeyDown:o(this.handleKeyDown.bind(this),250),style:{width:"100%",height:40}})},c.performSelection=function(t){this.props.actionHandler.insertItemFromTypeInField(t,this.props.sourceId),this.props.onBlur()},c._renderMetadataTree=function(){return this.props.datasourcesUI.getPickTree(this.props.sourceId,this.state.userTextInput,this.performSelection.bind(this),this.props.actionHandler.getOptionalFactorTypes())},_createClass(r,null,[{key:"propTypes",get:function(){return{open:e.bool,textValue:e.string,datasourcesUI:e.object,getDropdownMaxHeight:e.func,sourceId:e.string,onBlur:e.func,actionHandler:e.object}}}]),r}(t.Component)})),define("@dashboard-features/forecast/js/multivariate/ForecastOptionalFactorPlaceHolder",["react","prop-types","jquery","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","@ba/ba-ui-carbon-toolkit","./ForecastOptionalFactorFieldDropdown"],(function(t,e,n,i,r,o){var a=r.Label;return function(r){function s(e){var n;return(n=r.call(this,e)||this)._placeholderTypeInOn=function(){n.setState({isTypeInMode:!0})},n._placeholderTypeInOff=function(){n.setState({isTypeInMode:!1})},n._placeholderDropzoneOn=function(){n.setState({showDropzone:!0})},n._placeholderDropzoneOff=function(){n.setState({showDropzone:!1})},n.state={isTypeInMode:!1,showDropzone:!0},n.placeholderRef=t.createRef(),n}_inheritsLoose(s,r);var c=s.prototype;return c.componentDidMount=function(){var t=this,e={onDragEnter:this._placeholderDropzoneOn.bind(this),onDragLeave:this._placeholderDropzoneOff.bind(this),getDndManager:function(e){t._dndManager=e}};this.props.initializeDnd(this.placeholderRef.current,e)},c.componentDidUpdate=function(t,e){var i=this;if(this.state.showDropzone!==e.showDropzone){var r=n(this.placeholderRef.current).closest(".multivariate__optionalFactors").get(0);r&&this._dndManager&&this._dndManager.dragObject&&this._dndManager.reassessContainer(r)}if(t.actionHandler!==this.props.actionHandler){var o={onDragEnter:this._placeholderDropzoneOn.bind(this),onDragLeave:this._placeholderDropzoneOff.bind(this),getDndManager:function(t){i._dndManager=t}};this.props.initializeDnd(this.placeholderRef.current,o)}},c.componentWillUnmount=function(){this._dndManager&&this._dndManager.deregisterDropTarget(this.placeholderRef.current)},c.render=function(){return t.createElement("div",{className:"optionalFactorPlaceholder",ref:this.placeholderRef},t.createElement("div",{className:"optionalFactorPlaceholder__hoverIndicator"}),this._renderItem())},c.shouldRenderPlaceholder=function(){return this.state.showDropzone},c._renderItem=function(){var e=this;if(this.shouldRenderPlaceholder())return this.sourceId=this.props.actionHandler.getDatasourceId(),t.createElement("div",{className:"optionalFactorPlaceholder__itemPlaceholder",tabIndex:"0",onClick:this._placeholderTypeInOn,onKeyUp:function(t){return e.props.a11Y.handleOpenTypeInDropdown(t,e._placeholderTypeInOn.bind(e))}},this.state.isTypeInMode&&this.sourceId?this._renderFieldDropdown():t.createElement(a,{className:"optionalFactorPlaceholder__itemPlaceholder__actionLabel",label:i.get("forecast_optional_factors_placeholderDropzone")}))},c._renderFieldDropdown=function(){return t.createElement(o,{open:this.state.isTypeInMode,datasourcesUI:this.props.datasourcesUI,getDropdownMaxHeight:this.getDropdownMaxHeight,sourceId:this.sourceId,onBlur:this._placeholderTypeInOff,actionHandler:this.props.actionHandler})},c.getDropdownMaxHeight=function(){return 500},_createClass(s,null,[{key:"propTypes",get:function(){return{a11Y:e.object,datasourcesUI:e.object,actionHandler:e.object,parentNode:e.object,initializeDnd:e.func}}}]),s}(t.Component)})),define("@dashboard-features/forecast/js/multivariate/ForecastOptionalFactorDeleteAction",["@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t){return function(){function e(e,n){this.columnId=e,this.onOptionalFactorDeleted=n,this.toolbarContribution=[{name:"delete",text:t.get("toolbarDeleteActionText"),label:t.get("toolbarDeleteActionText"),icon:"dashboard-delete",type:"Button",removeOnActionApplied:!0,action:this.deleteOptionalFactor.bind(this),group:"deleteAction"}]}var n=e.prototype;return n.getActionId=function(){return"deleteAction"},n.getAvailableActions=function(){return this.toolbarContribution},n.deleteOptionalFactor=function(){this.onOptionalFactorDeleted(this.columnId)},e}()})),define("@dashboard-features/forecast/js/multivariate/ForecastOptionalFactorActionHandler",["jquery","underscore","@waca/dashboard-common/js/ui/AuthoringToolbar","./ForecastOptionalFactorDeleteAction"],(function(t,e,n,i){var r=["Calculation","fact"];return function(){function o(t){this.content=t.content,this.onOptionalFactorAdded=t.onOptionalFactorAdded,this.onOptionalFactorDeleted=t.onOptionalFactorDeleted,this.getNumOfMultivariates=t.getNumOfMultivariates,this.maxOptionalFactors=t.maxOptionalFactors,this.visualization=this.content.getFeature("Visualization"),this.visDnD=this.content.getFeature("VisDnD")}var a=o.prototype;return a.handleDrop=function(t){var n=e.map(t&&t.columns,(function(t){return t.metadataColumn}));if(n.length>0){var i=[];n.forEach((function(t){i.push({name:t.getLabel(),columnId:t.getId()})})),this.onOptionalFactorAdded(i)}},a.getOptionalFactorTypes=function(){return r},a.insertItemFromTypeInField=function(t){-1!==r.indexOf(t.getType())&&this.onOptionalFactorAdded([{name:t.getLabel(),columnId:t.getId()}])},a.getDatasourceId=function(){var t=this.visualization.getDataSource();return t?t.getId():null},a.getContentId=function(){return this.content.getId()},a.getActions=function(t){return new i(t,this.onOptionalFactorDeleted)},a.getDropTargetInfo=function(t){return{type:"optionalFactor.item",info:{contentId:this.getContentId(),node:t,actionHandler:this}}},a.onDropA11Y=function(t){var e=this.getDropTargetInfo(t);this.visDnD.onDrop({type:"A11YMetadataColumns"},e)},a.openItemActionMenu=function(t,e){var n=this.getActions(t).getAvailableActions();this.buildActionToolbar(n,e)},a.isActionMenuOpened=function(){return!!this._actionMenuToolbar},a.buildActionToolbar=function(e,i){var r={placement:"top",attachPoint:".actionmenu",preferredVertical:!0,reactToolbar:!0,textOnly:!0,flyoutClass:"popover actionToolbarPopover text"};this.$parentNode=t(i),this.$parentNode.addClass("action-menu-opened");var o=this.$parentNode.find(r.attachPoint||".toolbarRoot");this._actionMenuToolbar=new n(r),this._actionMenuToolbar.addItems(e),this._actionMenuToolbar.setSelectionContext([o]),this._actionMenuToolbar.show(r.placement),this._actionMenuToolbar.on("flyout:hide",this._removeToolbar,this),this._actionMenuToolbar.on("toolbar:remove",this._onToolbarRemove.bind(this))},a.isPaste=function(t){return 86===t.keyCode&&(t.ctrlKey||t.metaKey)},a._removeToolbar=function(){this._actionMenuToolbar&&this._actionMenuToolbar.remove(!0)},a._onToolbarRemove=function(){this.$parentNode&&(this.$parentNode.removeClass("action-menu-opened"),this.$parentNode=null),this._actionMenuToolbar&&(this._actionMenuToolbar=null)},o}()})),define("@dashboard-features/forecast/js/multivariate/ForecastOptionalFactorFieldItem",["react","underscore","prop-types","@ba/ba-ui-carbon-toolkit"],(function(t,e,n,i){var r=i.SVGIcon,o=i.TruncatedText;return function(e){function i(t){return e.call(this,t)||this}_inheritsLoose(i,e);var a=i.prototype;return a.getDOMNode=function(){return this.domNode},a.render=function(){var e=this,n=this.props,i=n.fieldName,a=n.className,s=n.onOpenActionMenu,c=n.overflowIcon;return t.createElement("div",{className:a?"bi-common-field-item "+a:"bi-common-field-item","aria-label":i,tabIndex:"0",ref:function(t){e.domNode=t}},t.createElement("div",{className:"bi-common-field-item__nameLine",onMouseEnter:this.props.onMouseEnterCallBack,onMouseLeave:this.props.onMouseLeaveCallBack},t.createElement("div",{className:"bi-common-field-item__nameLine__fieldName"},t.createElement(o,{location:"middle",style:{fontWeight:"normal"},value:i})),this.props.isAuthoringMode&&t.createElement("div",{className:"bi-common-field-item__nameLine__actionMenu",tabIndex:0,onKeyPress:function(t){t.stopPropagation(),s(t)},onClick:function(t){t.stopPropagation(),s(t)}},t.createElement(r,{size:"small",iconId:c.id}),t.createElement("div",{className:"actionmenu"}))))},_createClass(i,null,[{key:"propTypes",get:function(){return{className:n.string,fieldName:n.string,onOpenActionMenu:n.func,overflowIcon:n.object,onMouseEnterCallBack:n.func,onMouseLeaveCallBack:n.func,isAuthoringMode:n.boolean}}}]),i}(t.Component)})),define("@dashboard-features/forecast/js/multivariate/ForecastOptionalFactorFlyout",["react","prop-types","@ba/ba-ui-carbon-toolkit","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,i){var r=n.Flyout;return function(n){function o(t){var e;return(e=n.call(this,t)||this)._onCloseFlyout=function(){e.props.onClose&&e.props.onClose()},e}_inheritsLoose(o,n);var a=o.prototype;return a.render=function(){var t=this._renderQuerySubjectItem();return t?this._renderFlyout(t):null},a._renderQuerySubjectItem=function(){return this.props.datasourcesUI.getColumnSourceTree(this.props.sourceId,this.props.columnId)},a._renderFlyout=function(e){var n=i.get("forecast_item_tooltip");return t.createElement(r,{domNodeToAttachTo:document.body,triggerNode:this.props.domNode,offset:30,placement:"topCentred",candidatePlacement:["topCentred"],onClose:this._onCloseFlyout},t.createElement("div",{className:"optionalFactor__disambiguatingTooltipTitle"},n),t.createElement("div",{className:"optionalFactor__disambiguatingTooltip"},e))},_createClass(o,null,[{key:"propTypes",get:function(){return{datasourcesUI:e.object,domNode:e.object,columnId:e.string,sourceId:e.string,onClose:e.func}}}]),o}(t.Component)})),define("@dashboard-features/forecast/js/multivariate/ForecastOptionalFactorItem",["react","prop-types","./ForecastOptionalFactorFieldItem","./ForecastOptionalFactorFlyout"],(function(t,e,n,i){return function(r){function o(t){var e;return(e=r.call(this,t)||this)._showFlyout=function(){e.flyoutTooltipTimer||(e.flyoutTooltipTimer=setTimeout((function(){e.props.actionHandler.isActionMenuOpened()||e.setState({isFlyoutShown:!e.state.isFlyoutShown})}),1e3))},e._hideFlyout=function(){e.setState({isFlyoutShown:!1}),e.flyoutTooltipTimer&&(clearTimeout(e.flyoutTooltipTimer),e.flyoutTooltipTimer=null)},e.state={isFlyoutShown:!1},e.sourceId=e.props.actionHandler.getDatasourceId(),e.flyoutTooltipTimer=null,e}_inheritsLoose(o,r);var a=o.prototype;return a.componentDidMount=function(){this._initializeDndSupport()},a.render=function(){return t.createElement(t.Fragment,null,this._renderFlyout(),this._renderFieldItem())},a._initializeDndSupport=function(){var t=this;this.props.dndManager.then((function(e){t._dndManager=e}))},a._renderFlyout=function(){if(this.state.isFlyoutShown&&this.domNode)return t.createElement(i,{domNode:this.domNode,datasourcesUI:this.props.datasourcesUI,columnId:this.props.itemColumnId,sourceId:this.sourceId,onClose:this._hideFlyout})},a._renderFieldItem=function(){var e=this;return t.createElement(n,{className:"optionalFactorItem",fieldName:this.props.itemName,onKeyUp:function(t){return e.props.a11Y.handleKeyUpForItem(t,{columnId:e.props.itemColumnId})},onMouseEnterCallBack:this._showFlyout.bind(this),onMouseLeaveCallBack:this._hideFlyout.bind(this),onOpenActionMenu:this._itemActionMenu.bind(this),ref:function(t){t&&t.getDOMNode&&(e.domNode=t.getDOMNode())},overflowIcon:this.props.overflowIcon,isAuthoringMode:this.props.isAuthoringMode})},a._itemActionMenu=function(){this.props.isAuthoringMode&&this.props.actionHandler.openItemActionMenu(this.props.itemColumnId,this.domNode)},_createClass(o,null,[{key:"propTypes",get:function(){return{datasourcesUI:e.object,dndManager:e.object,actionHandler:e.object,itemColumnId:e.object,overflowIcon:e.object,itemName:e.string,a11Y:e.object,isAuthoringMode:e.boolean}}}]),o}(t.Component)})),define("@dashboard-features/forecast/js/multivariate/ForecastOptionalFactorA11YHandler",["jquery"],(function(t){return function(){function e(t){this.actionHandler=t.actionHandler}var n=e.prototype;return n.handleKeyUpForItem=function(e,n){"Delete"!==e.key&&"Backspace"!==e.key||t(e.target).hasClass("slotEditorItem")&&(this._deleteItem(n),e.preventDefault())},n.handleOpenTypeInDropdown=function(t,e){this._sourceSelection||"Enter"!==t.key||e()},n.headerHandleKeyUp=function(t,e){this.actionHandler.isPaste(t)&&this.actionHandler.onDropA11Y(e)},n._deleteItem=function(t){this.actionHandler.getActions(t.columnId).deleteOptionalFactor()},e}()})),define("@dashboard-features/forecast/js/multivariate/ForecastOptionalFactorsSection",["react","prop-types","underscore","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","./ForecastDndOptionalFactorItemHandler","./ForecastOptionalFactorPlaceHolder","./ForecastOptionalFactorActionHandler","./ForecastOptionalFactorItem","./ForecastOptionalFactorA11YHandler"],(function(t,e,n,i,r,o,a,s,c){return function(u){function l(t){var e,n={content:(e=u.call(this,t)||this).props.content,onOptionalFactorAdded:e.props.onForecastOptionalFactorAdded,onOptionalFactorDeleted:e.props.onForecastOptionalFactorDeleted,getNumOfMultivariates:e._getNumberOfMultivariates.bind(_assertThisInitialized(e)),maxOptionalFactors:e.props.maxOptionalFactors};return e.actionHandler=new a(n),e.a11YHandler=new c({actionHandler:e.actionHandler}),e}_inheritsLoose(l,u);var d=l.prototype;return d.componentWillUnmount=function(){this.dropItemHandler&&this.dropItemHandler.destroy()},d.render=function(){var e=this;return t.createElement("div",{className:"multivariate__optionalFactors",ref:function(t){e.domNode=t},tabIndex:"0",onKeyUp:function(t){return e.a11YHandler.headerHandleKeyUp(t,e.domNode)},"aria-label":i.get("forecast_optional_factors")},(this.props.isAuthoringMode||this.props.multivariatesInfoList)&&t.createElement("div",{className:"multivariate__optionalFactors__heading__container"},i.get("forecast_optional_factors"),t.createElement("div",{className:"multivariate__optionalFactors__heading__container__ratio"},i.get("forecast_optional_factors_num_added",{added:this.props.multivariatesInfoList?this.props.multivariatesInfoList.length:0,max:this.props.maxOptionalFactors}))),this.props.multivariatesInfoList&&this._renderOptionalFactors(),this.props.showPlaceHolder&&this.props.isAuthoringMode&&t.createElement(o,{a11Y:this.a11YHandler,datasourcesUI:this.props.datasourcesUI,initializeDnd:this._initializeDndSupport.bind(this),actionHandler:this.actionHandler,parentNode:this.domNode}),this.props.isAuthoringMode&&this.props.multivariatesInfoList&&this.props.multivariatesInfoList.length>=this.props.maxOptionalFactors&&t.createElement("div",{className:"optionalFactorMaxInfo"},i.get("forecast_optional_factors_max_info",{max:this.props.maxOptionalFactors})))},d._initializeDndSupport=function(t){var e=this;this.props.dndManager.then((function(n){t&&(e.dropItemHandler=new r({domNode:t,className:"dndHover",actionHandler:e.actionHandler,addAfter:!1,dndManager:n}))}))},d._renderOptionalFactors=function(){var e=this,i=n.map(this.props.multivariatesInfoList,(function(n,i){return t.createElement("div",{className:"multivariate__optionalFactors__item",key:"optionalFactors"+i},t.createElement(s,{a11Y:e.a11YHandler,itemName:n.label,itemColumnId:n.columnId,actionHandler:e.actionHandler,dndManager:e.props.dndManager,datasourcesUI:e.props.datasourcesUI,overflowIcon:e.props.overflowIcon,isAuthoringMode:e.props.isAuthoringMode}))}));if(i.length)return t.createElement("div",{className:"multivariate__optionalFactors__items"},i)},d._getNumberOfMultivariates=function(){return this.props.multivariatesInfoList&&this.props.multivariatesInfoList.length},_createClass(l,null,[{key:"propTypes",get:function(){return{datasourcesUI:e.object,dndManager:e.object,content:e.object,onForecastOptionalFactorAdded:e.func,onForecastOptionalFactorDeleted:e.func,showPlaceHolder:e.boolean,overflowIcon:e.object,multivariatesInfoList:e.object,isAuthoringMode:e.boolean,maxOptionalFactors:e.number}}}]),l}(t.Component)})),define("text!@dashboard-features/forecast/js/indicator/templates/ForecastIndicator.html",[],(function(){return'<div role="application" class="dataWidgetIcon liveWidgetForecast liveWidgetForecastNone" title="{{!it.title}}"  aria-label="{{!it.title}}" data-selector="true" tabindex="0">\n\t<svg id="icon" class="svgIcon">\n\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#{{!it.forecastIcon}}"></use>\n\t</svg>\n</div>\n'})),define("@dashboard-features/forecast/js/indicator/ForecastIndicator",["underscore","jquery","doT","text!./templates/ForecastIndicator.html","@waca/dashboard-common/js/utils/EventChainLocal","@waca/dashboard-livewidget/js/lib/@waca/core-client/js/core-client/utils/Utils","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,i,r,o,a){"use strict";var s=n.template(i),c=function(){function t(t){var n=t.content,i=t.features;this.features=i,this.content=n,this.dashboard=i["Dashboard.API"];var r=i["Dashboard.Icons"].getIcon("forecast");this.$forecastIndicator=e(s({title:a.get("forecast_title"),forecastIcon:r.id})),this.$forecastIndicator=o.embedSVGIcon(this.$forecastIndicator),i.VisIndicators.registerProvider(this),this.initEvents()}var n=t.prototype;return n.getAPI=function(){return this},n.initEvents=function(){var t=this._onClick.bind(this);this.$forecastIndicator.on("tap keyup click",t)},n.destroy=function(){this.$forecastIndicator.off()},n.getIndicatorList=function(){return[{name:t.id,icon:this.$forecastIndicator}]},n.update=function(){this._setForecastIndicatorVisibility(this._areThereValidForecastMessages())},n._setForecastIndicatorVisibility=function(t){t?this.$forecastIndicator.removeClass("liveWidgetForecastNone"):this.$forecastIndicator.addClass("liveWidgetForecastNone")},n._areThereValidForecastMessages=function(){var t=this.features.Forecast;return!!this.features.Forecast.supportsForecasts()&&t.areThereValidForecastSettings()},n._onClick=function(e){new r(e).setProperty("preventDefaultContextBar",!0),e.keyCode&&13!==e.keyCode||(e.gesture&&e.gesture.preventDefault(),this.features.VisIndicators.handleEvents(t.id,e)||this.features["Dashboard.InAppSlideoutState"].open("analyticsView"))},t}();return c.id="forecastIcon",c})),define("@dashboard-features/forecast/js/view/ForecastSection",["react","prop-types","@ba/ba-ui-carbon-toolkit","../indicator/internal/ForecastPredictComponents","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","../multivariate/ForecastOptionalFactorsSection","../indicator/ForecastIndicator"],(function(t,e,n,i,r,o,a){var s=n.Button,c=function(n){function a(t){var e;return(e=n.call(this)||this).forecast=t.forecast,e.state=t.displayState,e.overflowVerticalIcon=t.dashboard.getFeature("Dashboard.Icons").getIcon("overflowVertical"),e}_inheritsLoose(a,n);var c=a.prototype;return c.componentDidUpdate=function(t){var e=t.displayState.toggleEnabled!==this.props.displayState.toggleEnabled,n=String(t.displayState.settings.map((function(t){return t.value})))!==String(this.props.displayState.settings.map((function(t){return t.value}))),i=void 0===this.props.displayState.multivariates&&void 0!==t.displayState.multivariates;if(!i&&this.props.displayState.multivariates&&t.displayState.multivariates&&(i=String(t.displayState.multivariates.map((function(t){return t.columnId})))!==String(this.props.displayState.multivariates.map((function(t){return t.columnId})))),e||n||i){var r=this.props.displayState;if(i&&!this.props.displayState.multivariates)this.props.displayState.multivariates=[];this.setState(r)}},c.componentWillUnmount=function(){this.forecast.removeMessageListener(this)},c.render=function(){var e="authoring"===this.props.dashboard.getMode(),n=!this.props.displayState.multivariates||this.props.displayState.multivariates.length<5,a=!this.forecast.isForecastEnabled(),c=!(this.forecast.isForecastEnabled()&&this.forecast.hasStatisticalDetails());return this.forecast.addMessageListener(this),t.createElement("div",{className:"forecastComponents"},t.createElement(i,{settings:this.state.settings,isDisabled:a,onForecastPredictItemsChanged:this.predictSettingsChanged.bind(this)}),t.createElement(o,{datasourcesUI:this.props.dashboard.getFeature("DataSources.UI"),content:this.props.content,dndManager:this.props.dashboard.getDashboardSvc(".DndManager"),onForecastOptionalFactorAdded:this.onForecastOptionalFactorAdded.bind(this),onForecastOptionalFactorDeleted:this.onForecastOptionalFactorDeleted.bind(this),multivariatesInfoList:this.props.forecast.getMultivariatesInfoList(),showPlaceHolder:n,overflowIcon:this.overflowVerticalIcon,isAuthoringMode:e,maxOptionalFactors:5}),e&&t.createElement(s,{kind:"ghost",className:"forecastStatsDetails",disabled:c,onClick:this.onClickStatsDetails.bind(this)},r.get("statDetails_title")))},c.onClickStatsDetails=function(){var t=this.props.dashboard,e=t.getDashboardCoreSvc(".CanvasExtensions");if(e){var n=e.splitPaneView.getSplitter(),i="story"===t.getApplicationName()?1:0;n.toggleItem(i,!0,{sender:"forecastSection"})}},c.predictSettingsChanged=function(t){var e=this;this.setState((function(n){var i=Object.assign(n,{settings:t});return e.props.forecast.applyStateChange(i),i}))},c.onForecastOptionalFactorAdded=function(t){var e=this;this.setState((function(n){if(n.multivariates||(n.multivariates=[]),n.multivariates.length+t.length<=5){var i=[];t.forEach((function(t){-1===n.multivariates.findIndex((function(e){return e.columnId===t.columnId}))&&i.push(t)})),i.length&&(n.multivariates=n.multivariates.concat(i),e.props.forecast.applyStateChange(n))}return n}))},c.onForecastOptionalFactorDeleted=function(t){var e=this;this.setState((function(n){if(n.multivariates){var i=n.multivariates.findIndex((function(e){return e.columnId===t}));i>=0&&(n.multivariates.splice(i,1),n.multivariates.length||(n.multivariates=[]),e.props.forecast.applyStateChange(n))}return n}))},_createClass(a,null,[{key:"propTypes",get:function(){return{dashboard:e.object,forecast:e.object,displayState:e.object,content:e.object,overflowIcon:e.object}}}]),a}(t.Component);return function(){function e(t){this.features=t.features,this.features.AnalyticsView.registerSection(this),this.content=this.getSelectedContent()}var n=e.prototype;return n.getId=function(){return"forecast"},n.getVisIconId=function(){return a.id},n.getLabel=function(){return r.get("forecast_title")},n.getSelectedContent=function(){var t=this.features.Canvas.getSelectedContentList();return 1===t.length?t[0]:null},n.render=function(){var e=this.getForecast();return t.createElement(c,{dashboard:this.features.API,forecast:e,displayState:JSON.parse(JSON.stringify(e.getForecastDisplayState())),content:this.content})},n.getToggleSupport=function(){return!0},n.getEnabled=function(){var t=this.getForecast();return!!t&&t.supportsForecasts()&&t.areThereValidForecastSettings()},n.getChecked=function(){var t=this.getForecast();return!!t&&t.isForecastEnabled()},n.getForecast=function(){return this.content?this.content.getFeature("Forecast"):null},n.setChecked=function(t){var e=this.getForecast();e&&e.applyStateChange({toggleEnabled:t,settings:[]})},n.setContent=function(t){this.content=t},n.getToggleTooltip=function(){return this.getChecked()?r.get("forecast_toggle_off"):r.get("forecast_toggle_on")},e}()})),define("@dashboard-features/insightsNarrator/js/view/ChartInsightsItemActions",["react","prop-types","@ba/ba-ui-carbon-toolkit","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,i){var r=n.FlexItem,o=n.Button,a=n.SVGIcon,s=function(e){var n=function(t){if(void 0===t&&(t=1),e.insights&&e.insights.length){var n=e.insights[e.index+t],i=e.insightsNarrator.getPinIdList(),r=i.findIndex((function(t){return t===e.insightId})),o=i.findIndex((function(t){return n&&t===n.id}));e.insightsNarrator.reOrderPinned(r,o)}},s=e.index+1===e.itemsLen,c=s?"top":"bottom";return t.createElement(r,null,-1!==e.actions.indexOf("moveDown")?t.createElement(o,{tooltipAlignment:"end",tooltipPosition:c,size:"small",disabled:s||e.disableActions,hasIconOnly:!0,"aria-label":i.get("MoveDown"),iconDescription:i.get("MoveDown"),renderIcon:function(n){return t.createElement(a,_extends({icon:e.icons.getIcon("arrowDown")},n))},onClick:function(){return n(1)}}):[],-1!==e.actions.indexOf("moveUp")?t.createElement(o,{tooltipAlignment:"end",tooltipPosition:c,size:"small",disabled:0===e.index||e.disableActions,hasIconOnly:!0,"aria-label":i.get("MoveUp"),iconDescription:i.get("MoveUp"),renderIcon:function(n){return t.createElement(a,_extends({icon:e.icons.getIcon("arrowUp")},n))},onClick:function(){return n(-1)}}):[],-1!==e.actions.indexOf("unPin")?t.createElement(o,{tooltipAlignment:"end",tooltipPosition:c,size:"small",disabled:e.disableActions,hasIconOnly:!0,"aria-label":e.disableActions?i.get("DisabledUnstar"):i.get("Unstar"),iconDescription:e.disableActions?i.get("DisabledUnstar"):i.get("Unstar"),renderIcon:function(n){return t.createElement(a,_extends({icon:e.icons.getIcon("starFilled16")},n))},onClick:function(){e.animate.afterFadeOut((function(){return e.insightsNarrator.unPin(e.insightId)}))}}):[],-1!==e.actions.indexOf("pin")?t.createElement(o,{tooltipAlignment:"end",tooltipPosition:c,size:"small",disabled:e.disableActions,hasIconOnly:!0,"aria-label":i.get("Star"),iconDescription:i.get("Star"),renderIcon:function(n){return t.createElement(a,_extends({icon:e.icons.getIcon("star16")},n))},onClick:function(){e.animate.afterFadeOut((function(){return e.insightsNarrator.pin(e.insightId)}))}}):[])};return s.propTypes={actions:e.array,index:e.number,itemsLen:e.number,icons:e.object,insightsNarrator:e.object,insightId:e.string,insights:e.array,disableActions:e.bool,animate:e.object},s})),define("@dashboard-features/insightsNarrator/js/util/UnescapedString",["react","prop-types","underscore","@waca/dashboard-common/js/utils/HtmlXSSUtils"],(function(t,e,n,i){"use strict";var r=function(e){if(Array.isArray(e.children)||!e.children.type)throw new Error("must contain exactly 1 child elements");var r=e.children.type,o=n.omit(e.children.props,"children");return t.createElement(r,_extends({},o,{dangerouslySetInnerHTML:{__html:i.sanitizeHtml(e.children.props.children)}}))};return r.propTypes={children:e.node},r}));var CI_DEFAULT_ITEM_CLASS="ci--list-item",CI_FADE_IN="ci--fade-in",CI_FADE_OUT="ci--fade-out";function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _classPrivateFieldLooseBase(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}define("@dashboard-features/insightsNarrator/js/util/AnimationConst",[],(function(){"use strict";var t={CI_DEFAULT_ITEM_CLASS:CI_DEFAULT_ITEM_CLASS,CI_FADE_IN:CI_FADE_IN,CI_FADE_OUT:CI_FADE_OUT,CI_ITEM_FADE_IN_CLASS:CI_DEFAULT_ITEM_CLASS+" "+CI_FADE_IN,CI_ITEM_FADE_OUT_CLASS:CI_DEFAULT_ITEM_CLASS+" "+CI_FADE_OUT};return Object.freeze(t),t})),define("@dashboard-features/insightsNarrator/js/view/ChartInsightsListItem",["react","@ba/ba-ui-carbon-toolkit","prop-types","./ChartInsightsItemActions","../util/UnescapedString","../util/AnimationConst"],(function(t,e,n,i,r,o){var a=e.FlexLayout,s=e.FlexItem,c=o.CI_DEFAULT_ITEM_CLASS,u=o.CI_ITEM_FADE_OUT_CLASS,l=function(e){var n=function(e){var n=t.useState(e.className),i=n[0],r=n[1];return t.useEffect((function(){e.className!==i&&r(e.className)}),[e]),[i,r]}(e),o=n[0],l=n[1],d=t.useRef(null);return t.createElement(a,{onAnimationEnd:function(t){return function(t,e,n){t.target.classList.contains(c)&&(e.current&&(e.current.call(),e.current=null),n(c))}(t,d,l)},className:o,direction:"column"},t.createElement(s,{className:"ci--list-item-top"},t.createElement(r,null,t.createElement("span",{tabIndex:0},e.insights[e.index].label))),t.createElement(s,{className:"ci--list-item-bottom"},t.createElement(a,{className:"ci--list-item-actions",justifyContent:"flex-end"},t.createElement(i,_extends({index:e.index,insightId:e.insights[e.index].id,itemsLen:e.insights.length,actions:e.actions,animate:{afterFadeOut:function(t){d.current=t,l(u)}}},e)))))};return l.propTypes={insights:n.object,index:n.number,actions:n.object},l})),define("@dashboard-features/insightsNarrator/js/view/ChartInsightsList",["react","prop-types","@ba/ba-ui-carbon","@ba/ba-ui-carbon-toolkit","./ChartInsightsListItem","../util/AnimationConst"],(function(t,e,n,i,r,o){var a=n.Tooltip,s=i.SimpleTable,c=o.CI_DEFAULT_ITEM_CLASS,u=o.CI_ITEM_FADE_IN_CLASS,l=o.CI_FADE_IN,d=function e(n){var i,r,o=n.insights,c=(i=o,r=t.useRef(null),t.useEffect((function(){r.current=i})),r.current);return n.hide?[]:t.createElement("div",{className:"ci-list-container "+l},n.consumeDescription?t.createElement("div",{className:"ci-title-consume",tabIndex:0,"aria-label":n.consumeDescription}," ",n.consumeDescription," "):t.createElement("div",{className:"ci-title"},t.createElement("span",{tabIndex:0,"aria-label":n.title}," ",n.title),t.createElement(a,{iconDescription:n.description},t.createElement("span",null,n.description))),o.length?t.createElement(s,{className:"ci--list",colToAdaddScopeRow:1,draggable:!1,height:"100%",rowLength:o.length,colLength:1,cellRenderer:function(t){return e.renderInsight(t,o,c,n)}}):t.createElement("div",{className:"ci--list-message",tabIndex:0,"aria-label":n.message},n.message))};return d.propTypes={insights:e.object,hide:e.bool,title:e.title,message:e.string,icons:e.object,consumeDescription:e.string,description:e.string},d.renderInsight=function(e,n,i,o){var a=i&&i.findIndex((function(t){return n[e].id===t.id})),s=c;return(null===a||-1===a||-1!==a&&a!==e&&i.length===n.length)&&(s=u),t.createElement(r,_extends({className:s,index:e},o))},d})),define("@dashboard-features/insightsNarrator/js/view/InsightsNarratorSectionAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){return this.apiSpec||(this.apiSpec={name:"narrative insight section API",events:{serializeActions:!0,propagationInfo:{namespace:"narrativeInsightsection",callStack:{name:"narrativeInsightsection",params:[]},info:{supportsUndoRedo:!1}},actions:{onChange:{eventName:"onChange",getInfo:function(t){return{value:t[0],isExternalEvent:t[1]}},isTriggerEvent:function(){return!0}}}}}),this.apiSpec},t}()})),define("text!@dashboard-features/insightsNarrator/js/templates/InsightsIndicator.html",[],(function(){return'<div role="application" class="dataWidgetIcon liveWidgetNarrativeInsights liveWidgetInsightNone" title="{{!it.title}}"  aria-label="{{!it.title}}" data-selector="true" tabindex="0">\n\t<svg id="icon" class="svgIcon">\n\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#{{!it.insightsIcon}}"></use>\n\t</svg>\n</div>\n'})),define("@dashboard-features/insightsNarrator/js/api/InsightsIndicatorAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getIndicatorList=function(){},e.update=function(){},e.onClick=function(){},e.on=function(){},e.off=function(){},t}()})),define("@dashboard-features/insightsNarrator/js/InsightsIndicatorAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){return this.apiSpec||(this.apiSpec={name:"insights indicator API",events:{serializeActions:!0,propagationInfo:{namespace:"insightsIndicator",callStack:{name:"insightsIndicator",params:[]},info:{supportsUndoRedo:!1}},actions:{onClick:{eventName:"onClick",getInfo:function(){return{}},isTriggerEvent:function(){return!0}}}}}),this.apiSpec},t}()})),define("@dashboard-features/insightsNarrator/js/InsightsIndicator",["underscore","jquery","doT","text!./templates/InsightsIndicator.html","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-common/js/utils/EventChainLocal","@waca/dashboard-livewidget/js/lib/@waca/core-client/js/core-client/utils/Utils","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","@waca/dashboard-livewidget/js/util/KeyCodes","./api/InsightsIndicatorAPI","./InsightsIndicatorAPISpec"],(function(t,e,n,i,r,o,a,s,c,u,l){"use strict";var d=n.template(i),p=function(t){function n(n){var i,r=n.content,o=n.features;(i=t.call(this)||this).features=o,i.content=r,i.insightsNarrator=o.InsightsNarrator;var c=i.features["Dashboard.Icons"].getIcon("insights");return i.$insightsIndicator=e(d({title:s.get("insightsNarrator"),insightsIcon:c.id})),i.$insightsIndicator=a.embedSVGIcon(i.$insightsIndicator),i.features.VisIndicators.registerProvider(_assertThisInitialized(i)),i.initEvents(),i}_inheritsLoose(n,t);var i=n.prototype;return i.getAPI=function(){return this._api||(this._api=r.createAPI(this,[u])),this._api},i.initEvents=function(){var t=this._onClick.bind(this);this.$insightsIndicator.on("tap keyup click",t)},i.destroy=function(){this.$insightsIndicator.off()},i.getIndicatorList=function(){return[{name:n.id,icon:this.$insightsIndicator}]},i.update=function(){this.insightsNarrator.shouldShowVisIndicatorForInsightsNarrator()?this.$insightsIndicator.removeClass("liveWidgetInsightNone"):this.$insightsIndicator.addClass("liveWidgetInsightNone")},i._onClick=function(t){new o(t).setProperty("preventDefaultContextBar",!0),t.keyCode&&t.keyCode!==c.KEY_ENTER||(t.gesture&&t.gesture.preventDefault(),this.features.VisIndicators.handleEvents(n.id,t)||(this.insightsNarrator.setToggleState(!0),this.features["Dashboard.InAppSlideoutState"].open("analyticsView")),this.getAPI().onClick())},i.onClick=function(){},n}(l);return p.id="narrativeInsightsIcon",p})),define("@dashboard-features/insightsNarrator/js/view/InsightsNarratorSection",["react","prop-types","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/api/SectionProviderAPI","@ba/ba-ui-carbon-toolkit","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","./ChartInsightsList","./InsightsNarratorSectionAPISpec","../InsightsIndicator"],(function(t,e,n,i,r,o,a,s,c){var u=r.ProgressIndicator,l=r.FlexLayout,d=r.FlexItem,p=function(n){function i(t){var e;return(e=n.call(this)||this).state={loading:!0,isAuthoring:t.dashboardState.getUiState().authoring,insights:[],pinnedIds:[]},e.cbOnUiStateChange=e._onUiStateChange.bind(_assertThisInitialized(e)),e}_inheritsLoose(i,n);var r=i.prototype;return r.getPinnedSectionMessage=function(t,e){return e.length&&!t.length?o.get("ChartInsightPinnedEmpty"):""},r.getNonPinnedSectionMessage=function(t,e){var n="";return!e.length&&t.length&&(n=o.get("ChartInsightAllInsightsPinned")),e.length||t.length||(n=o.get("ChartInsightNoRecommendedInsights")),n},r.componentDidMount=function(){this.props.dashboardState.onUiStateChange(this.cbOnUiStateChange),this.props.insightsNarrator.on("change:updateCNSInsights",this._onUpdateCNSInsights,this),this.props.insightsNarrator.on("change:setPinIdList",this._onUpdatePinnedList,this),this.props.insightsNarrator.getInsights()},r.componentWillUnmount=function(){this.props.dashboardState.offUiStateChange(this.cbOnUiStateChange),this.props.insightsNarrator.off("change:updateCNSInsights",this._onUpdateCNSInsights,this),this.props.insightsNarrator.off("change:setPinIdList",this._onUpdatePinnedList,this)},r._onUiStateChange=function(){var t=this.props.dashboardState.getUiState().authoring;this.setState({isAuthoring:t})},r._onUpdateCNSInsights=function(t){this.setState({loading:!1,insights:t.info&&t.info.value&&t.info.value.insights||[],pinnedIds:this.props.insightsNarrator.getPinIdList()})},r._onUpdatePinnedList=function(){this.setState({pinnedIds:this.props.insightsNarrator.getPinIdList()})},r.render=function(){var e=this,n=this.state.pinnedIds.map((function(t){return e.state.insights.find((function(e){return e.id===t}))})).filter(Boolean),i=this.state.insights.filter((function(t){return t.id&&!(-1!==e.state.pinnedIds.indexOf(t.id))}));i=this.state.isAuthoring?i:i.slice(0,3);var r=[t.createElement(a,_extends({key:"pinnedSection",title:o.get("ChartInsightPinnedSectionTitle",{count:n.length}),message:this.getPinnedSectionMessage(n,i),description:o.get("ChartInsightPinnedSectionDescription"),consumeDescription:this.state.isAuthoring?"":o.get("ChartInsightConsumePinnedInsightsDesc"),hide:!this.state.insights.length||!n.length&&!this.state.isAuthoring,insights:n,actions:this.state.isAuthoring?["moveUp","moveDown","unPin"]:["unPin"],disableActions:!this.state.isAuthoring},this.props)),t.createElement(a,_extends({key:"suggestedSection",title:o.get("ChartInsightNonPinnedSectionTitle",{count:i.length}),description:o.get("ChartInsightNonPinnedSectionDescription"),message:this.getNonPinnedSectionMessage(n,i),hide:this.state.insights.length&&!i.length&&!this.state.isAuthoring,insights:i,actions:this.state.isAuthoring?["pin"]:[],disableActions:!this.state.isAuthoring},this.props))],s=t.createElement(l,{className:"ci-loading",justifyContent:"center",direction:"row"},t.createElement(d,null,t.createElement(u,{variant:"circle",size:"small"})),t.createElement(l,{justifyContent:"center",direction:"column"},t.createElement(d,null,t.createElement("span",{className:"ci-loading-message"},o.get("ChartInsightLoadingMessage")))));return t.createElement("div",{className:"insightNarattorComponents"},this.state.loading?s:r)},_createClass(i,null,[{key:"propTypes",get:function(){return{insightsNarrator:e.object,dashboardState:e.object}}}]),i}(t.Component),h=function(e){function r(t){var a;return(a=e.call(this)||this)._id=r.id,a._label=o.get(r.id),a.features=t.features,a.analyticsView=a.features.AnalyticsView,a._api=n.createAPI(_assertThisInitialized(a),[i]),a.analyticsView.registerSection(a._api,1),a.content=a.getSelectedContent(),a}_inheritsLoose(r,e);var a=r.prototype;return a.getAPI=function(){return this._api},a.getId=function(){return this._id},a.getVisIconId=function(){return c.id},a.getLabel=function(){return this._label},a.render=function(){return t.createElement(p,{insightsNarrator:this.content.getFeature("InsightsNarrator"),icons:this.features.Icons,dashboardState:this.features.DashboardState})},a.getToggleSupport=function(){return!1},a.getEnabled=function(){var t=!1;if(this.content){var e=this.content.getFeature("InsightsNarrator");t=!!e&&e.shouldShowInsightsNarrator()}return t},a.getChecked=function(){return this.content.getFeature("InsightsNarrator").getToggleState()},a.setChecked=function(t){var e=this.content.getFeature("InsightsNarrator");e.setToggleState(t),t&&e.getInsights()},a.setContent=function(t){this.content=t},a.getSelectedContent=function(){var t=this.features.Canvas.getSelectedContentList();return 1===t.length?t[0]:null},a.getToggleTooltip=function(){return null},a.onChange=function(t){this.setChecked(t)},r}(s);return h.id="insightsNarrator",h})),define("@dashboard-features/print-client/js/PrintClientAPI",[],(function(){return function(){function t(){_classCallCheck(this,t)}return t.prototype.print=function(){},t}()})),define("@dashboard-features/print-client/js/PrintClient",["./PrintClientAPI","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-core/js/app/nls/StringResources"],(function(t,e,n){var i=["Ajax","DashboardPreferences","DashboardTheme","Glass","Logger","Palette","UserProfile"],r={Letter:{width:8.5,height:11},Legal:{width:8.5,height:14},A4:{width:8.27,height:11.69},Tabloid:{width:11,height:17}};return function(){function o(n){_classCallCheck(this,o),this._api=e.createAPI(this,[t]),this._features=n.features,this._loadTimeout=n.loadTimeout||3e5,this._logger=this._features.Logger}return o.prototype.getAPI=function(){return this._api},o.prototype.print=function(t){var e=this,n=Object.assign({pageSize:{pageSize:"Letter",orientation:"portrait"}},t);return this._checkLogin().then((function(){return e._printDashboard(n)}))},o.prototype._checkLogin=function(){return this._features.Glass.getCoreService(".Ajax").ajax({url:"v1/login",type:"GET",contentType:"application/json"})},o.prototype._getDelay=function(t){var e=0,n=t.document.getElementById("dashboardRoot");return n&&null!=n.querySelector(".webpageWidget")&&(e=1e4),e},o.prototype._attachUnhandledRejectionListenerToWindow=function(t){var e=this;t.addEventListener("unhandledrejection",(function(t){t&&t.preventDefault(),t&&t.detail&&t.detail.reason&&e._logger.error(t.detail.reason)}))},o.prototype._printDashboard=function(t){var e=this,n=this._blockUI(),i=this._showToast(),r=this._renderIframe(),a=r.contentWindow;this._attachUnhandledRejectionListenerToWindow(a),i.onCancel((function(){e._restoreUI(n,r,i)}));var s=this._features.Serializer.toJSON(),c=this._waitForIframeLoad(a),u=this._waitForIframePrint(a);return this._log("Loading iframe"),c.then((function(){if(e._log("Dashboard print-client fully loaded."),a._printClientDeferred)return a._printClientDeferred.promise.then((function(){return e._log("Rendering print version of dashboard"),a._dashboard.renderContent({spec:s,includeFilters:t.printFilters,pageOptions:o.getPrintPageOptions(t.pageSize),bootstrapFeatures:e._getBootStrapFeatures(),progressCallback:e._getProgressCallback()})})).then((function(t){return new Promise((function(n){return setTimeout((function(){return n(t)}),e._getDelay(a))}))})).then((function(){return i.remove(0)})).then((function(){e._log("Printing");var t=e._waitForBrowserFocus();return a.print(),Promise.race([u,t])})).then((function(){e._log("Finished printing"),e._restoreUI(n,r)}));e._restoreUI(n,r,i)})).catch((function(t){throw console.error("Error rendering dashboard print view:"),console.error(t),e._renderError(),e._restoreUI(n,r,i),t}))},o.prototype._blockUI=function(){var t=document.createElement("div");return t.classList.add("dashboard-print-blocker"),t.style.width="100vw",t.style.height="100vh",t.style.backgroundColor="#000",t.style.opacity="0.5",t.style.position="absolute",t.style.zIndex="3100",document.body.append(t),t},o.prototype._restoreUI=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;t&&(t.remove(),e&&(e.remove(),n&&n.remove(0)))},o.prototype._showToast=function(){var t=n.get("buildingPDF"),e=this._features.Glass.showProgressToast(t,{noHideBtn:!0});return e.indefinite(t),e},o.prototype._renderIframe=function(){var t=this._features.UserProfile.getContentLocale()||"en",e=this._features.UserProfile.getProductLocale()||"en",n=document.createElement("iframe");return n.src="/bi/dashboard-print.html?cl="+t+"&pl="+e,n.style.position="fixed",n.style.top="0px",n.style.left="0px",n.style.width="1px",n.style.height="1px",n.style.borderWidth="0px",n.style.pointerEvents="none",n.style.userSelect="none",document.body.append(n),n},o.prototype._getBootStrapFeatures=function(){var t=this,e={};return i.forEach((function(n){var i=t._features[n];i&&(e[n]=i)})),e},o.prototype._renderError=function(){this._features.Glass.showToast(n.get("errorPrintPDF"),{type:"error",preventDuplicates:!0})},o.prototype._waitForIframeLoad=function(t){var e=this,n=void 0;return new Promise((function(i,r){t.addEventListener("load",(function(){return i()})),n=setTimeout((function(){return r(new Error("Iframe load timeout"))}),e._loadTimeout)})).then((function(){return clearTimeout(n)}))},o.prototype._waitForIframePrint=function(t){return new Promise((function(e){t.addEventListener("afterprint",(function(){return e()}))}))},o.prototype._waitForBrowserFocus=function(){return new Promise((function(t){window.addEventListener("focus",(function(){return t()}),{once:!0})}))},o.prototype._getProgressCallback=function(){var t=this;return function(e){t._log("["+e.timeElapsed+"]\t["+e.status+"]\t"+e.message+"\t"+JSON.stringify(e))}},o.prototype._log=function(t){console.debug("Printing: "+t)},o._getPrintPageSize=function(t,e){var n=r[t],i={};return"portrait"===e?(i.width=n.width,i.height=n.height):(i.width=n.height,i.height=n.width),i},o.getPrintPageOptions=function(t){var e=t.pageSize,n=t.orientation;return{size:o._getPrintPageSize(e,n)}},o}()})),define("@dashboard-features/save/js/SaveAPI",[],(function(){return function(){function t(){_classCallCheck(this,t)}return t.prototype.save=function(){},t.prototype.saveAs=function(){},t}()})),define("@dashboard-features/save/js/Save",["@waca/dashboard-common/js/core/APIFactory","./SaveAPI"],(function(t,e){return function(){function n(i){var r=i.features;_classCallCheck(this,n),this._features=r,this._api=t.createAPI(this,[e])}return n.prototype.getAPI=function(){return this._api},n.prototype.destroy=function(){delete this._api},n.prototype.save=function(t){var e=this,n=this._features.internal.getBoardModel().id;if(!n){return Promise.reject({status:"fail",error:Object.assign(new Error,{code:"missingDashboardId"})})}return this._getContentService().then((function(t){return t.saveDashboard(e._features.API,n)})).then((function(n){return e._getResponse(n,t)}))},n.prototype.saveAs=function(t,e,n,i){var r=this,o=e;return-1===o.indexOf("/")&&(o="v1/objects/"+e+"/items"),this._getContentService().then((function(e){return e.saveAsDashboard(r._features.API,t,o,n)})).then((function(t){return r._getResponse(t,i)}))},n.prototype._getContentService=function(){return this._features.API.getServiceWhenReady(".DashboardContent")},n.prototype._getResponse=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["status","assetId"];return this._pick(t,e)},n.prototype._pick=function(t,e){var n={};return e.forEach((function(e){t.hasOwnProperty(e)&&(n[e]=t[e])})),n},n}()})),define("@dashboard-features/smartAnnotations/js/view/AnalyticMessages",["react","prop-types","@ba/ba-ui-carbon-toolkit","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,i){var r=n.Container,o=n.FlexLayout,a=n.FlexItem,s=n.Label,c=n.SVGIcon,u=function(e){function n(){return e.apply(this,arguments)||this}_inheritsLoose(n,e);var u=n.prototype;return u._getIconInfoByType=function(t){var e,r,o;switch(t){case n.MESSAGE_TYPES.INFO:e="analyticMessages-icon-info",r="getInformation",o=i.get("statDetailsPerspectiveTitle");break;case n.MESSAGE_TYPES.ERROR:e="analyticMessages-icon-error",r="critical",o=i.get("smart_errors");break;case n.MESSAGE_TYPES.WARNING:default:e="analyticMessages-icon-warning",r="warnIcon",o=i.get("smart_warnings")}var a=this.props.icons.getIcon(r);return{className:e,iconId:a&&a.id,label:o}},u.renderMessages=function(){var e=this,n=t.createElement(t.Fragment,null);return this.props.messages&&(n=t.createElement(r,{className:"analyticMessages"},Object.keys(this.props.messages).map((function(n){var i=e.props.messages[n],u=e._getIconInfoByType(i.type);return t.createElement(r,{key:i.id,className:"analyticsMessages-message"},t.createElement(o,{className:"analyticMessages-title",direction:"row"},t.createElement(a,{className:"analyticMessages-icon"},t.createElement(c,{className:u.className,iconId:u.iconId,size:"small"})),t.createElement(a,null,t.createElement(s,{className:"analyticMessages-label",label:u.label}))),t.createElement(r,{className:"analyticMessages-items"},i.items.map((function(e){return t.createElement(s,{key:e.id,className:"analyticMessages-items-label",label:e.label})}))))})))),n},u.render=function(){return this.renderMessages()},n}(t.Component);return u.MESSAGE_TYPES={ERROR:"error",WARNING:"warning",INFO:"info"},u.propTypes={icons:e.object,messages:e.object},u}));var id=0;function _classPrivateFieldLooseKey(t){return"__private_"+id+++"_"+t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _createForOfIteratorHelperLoose(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(n)return(n=n.call(t)).next.bind(n);if(Array.isArray(t)||(n=_unsupportedIterableToArray(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _unsupportedIterableToArray(t,e){if(t){if("string"==typeof t)return _arrayLikeToArray(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?_arrayLikeToArray(t,e):void 0}}function _arrayLikeToArray(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,_toPropertyKey(i.key),i)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function _classPrivateFieldLooseBase(t,e){if(!Object.prototype.hasOwnProperty.call(t,e))throw new TypeError("attempted to use private field on non-instance");return t}define("@dashboard-features/smartAnnotations/js/view/AnalyticsViewCtrl",["react","prop-types","@ba/ba-ui-carbon-toolkit","./AnalyticMessages","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,i,r){var o=n.Container,a=n.FlexLayout,s=n.FlexItem,c=n.EmptyState,u=n.Label,l=n.Accordion,d=n.AccordionItem,p=n.Tooltip,h=n.ToggleSwitch,f=_classPrivateFieldLooseKey("registerVisIconEventHandler"),g=_classPrivateFieldLooseKey("deregisterVisIconEventHandler"),m=_classPrivateFieldLooseKey("handleIndicatorEvent"),v=function(e){function n(t){var n;return n=e.call(this,arguments)||this,Object.defineProperty(_assertThisInitialized(n),m,{value:b}),Object.defineProperty(_assertThisInitialized(n),g,{value:_}),Object.defineProperty(_assertThisInitialized(n),f,{value:I}),n.state={checked:t&&t.section.getChecked(),opened:t&&t.section.getChecked()},_classPrivateFieldLooseBase(_assertThisInitialized(n),f)[f](t),n}_inheritsLoose(n,e);var i=n.prototype;return i.componentWillUnmount=function(){_classPrivateFieldLooseBase(this,g)[g]()},i.toggleState=function(){var t=this;this.setState((function(e){return t.props.section.setChecked(!e.checked),{checked:!e.checked,opened:!e.checked}}))},i.getLabel=function(e){return t.createElement(u,{label:e,className:"analyticsSectionTitle"})},i.getLabelWithToggle=function(e){var n=this;return t.createElement(a,{direction:"row",justifyContent:"space-between",className:"analyticsLabelWithToggle"},t.createElement(s,null,t.createElement(u,{label:e,className:"analyticsSectionTitle"})),t.createElement(a,null,t.createElement(p,{title:this.props.section.getToggleTooltip(),orient:"top"},t.createElement(h,{className:"analyticsToggle",small:!0,checked:this.props.section.getChecked(),onClick:function(t){t.stopPropagation(),n.toggleState()}}))))},i.render=function(){var e=this,n=this.props.section.getToggleSupport(),i=this.props.section.getLabel();return t.createElement(d,{key:this.props.section.getId(),className:"analyticsToggleSection "+this.props.section.getId(),itemName:n?this.getLabelWithToggle(i):this.getLabel(i),"aria-label":i,open:this.state.opened,onChange:function(t){e.props.section.onChange&&e.props.section.onChange(t),e.setState({opened:t})}},this.props.section.render())},n}(t.Component);function I(t){var e=t.content.getFeature("VisIndicators");e&&t.section.getVisIconId()&&e.registerEventHandler(t.section.getVisIconId(),_classPrivateFieldLooseBase(this,m)[m],this)}function _(){var t=this.props.content.getFeature("VisIndicators");t&&this.props.section.getVisIconId()&&t.deregisterEventHandler(this.props.section.getVisIconId(),_classPrivateFieldLooseBase(this,m)[m],this)}function b(t){var e=!1;if("click"===t.type&&!this.state.opened){this.setState({opened:!0}),this.props.section.onChange&&this.props.section.onChange(!0,!0),e=!0}return e}v.propTypes={section:e.object,content:e.object};var y=function(e){function n(t){var n;n=e.call(this,arguments)||this,t.canvas.on("change:selections:select",n.onContentSelectChange,_assertThisInitialized(n)),t.canvas.on("change:selections:deselect",n.onContentSelectChange,_assertThisInitialized(n)),t.canvas.on("change:content:property:forecasting",n._onContentForecastingPropertyChanged,_assertThisInitialized(n)),t.apiOn("shapingmodel:changed",n._onShapingModelChanged,_assertThisInitialized(n));var i=n.getActiveContent(t.canvas),r=n.updateMessages(i);return n.setContent(i,t.sections),n.state={content:i,messages:r},n}_inheritsLoose(n,e);var d=n.prototype;return d.componentWillUnmount=function(){this.props.canvas.off("change:selections:select",this.onContentSelectChange,this),this.props.canvas.off("change:selections:deselect",this.onContentSelectChange,this),this.props.canvas.off("change:content:property:forecasting",this._onContentForecastingPropertyChanged,this),this.props.apiOff("shapingmodel:changed",this._onShapingModelChanged,this),this.deregisterContentHandler(this.state.content),this.props.sections.forEach((function(t){return t.destroy&&t.destroy()}))},d._onShapingModelChanged=function(){var t=this.getActiveContent(this.props.canvas);this.setContent(t)},d._onContentForecastingPropertyChanged=function(t){var e=t&&t.info&&t.info.contentId,n=this.getActiveContent(this.props.canvas);n&&n.getId()===e&&this.setContent(n)},d.supportsAnalytics=function(){return!!this.state.content&&!!this.props.sections.find((function(t){return t.getEnabled()}))},d.render=function(){return this.supportsAnalytics()?this.renderSections():this.renderEmpty()},d.renderSections=function(){var e=this;return t.createElement(o,{className:"analyticsView carbonDarkThemeable"},t.createElement(l,{icon:"right",className:"analyticsView-content"},this.props.sections.filter((function(t){return t.getEnabled()})).map((function(n){return t.createElement(v,{key:n.getId(),section:n,content:e.state.content})}))),t.createElement(i,{messages:this.state.messages,icons:this.props.icons}))},d.renderEmpty=function(){var e=r.get("AnalyticsMsgDefault"),n=r.get("AnalyticsDescriptionDefault"),i=this.props.canvas.getSelectedContentList();return 0===i.length?e=r.get("AnalyticsMsgNoContent"):i.length>1&&(e=r.get("AnalyticsMsgMultiSelected"),n=r.get("AnalyticsDescriptionMultiSelected")),t.createElement(a,{className:"analyticsView-empty carbonDarkThemeable",direction:"column",justifyContent:"space-around"},t.createElement(s,null,t.createElement(c,{size:"large"}),t.createElement(u,{className:"analyticsView-empty-title",label:e}),t.createElement(u,{className:"analyticsView-empty-description",label:n})))},d.getActiveContent=function(t){void 0===t&&(t=this.props.canvas);var e=t.getSelectedContentList();return 1===e.length?e[0]:null},d.setContent=function(t,e){if(void 0===e&&(e=this.props.sections),e.forEach((function(e){e.setContent(t)})),this.state){this.deregisterContentHandler(this.state.content);var n=this.updateMessages(t);this.setState({content:t,messages:n})}this.registerContentHandler(t)},d.onContentSelectChange=function(){var t=this.getActiveContent();this.setContent(t)},d.registerContentHandler=function(t){if(t){var e=t.getFeature("RenderSequence");e&&(e.on("execution:end",this.onRenderComplete,this),e.on("execution:start:annotation",this.onAnalyticsRender,this))}},d.deregisterContentHandler=function(t){if(t){var e=t.getFeature("RenderSequence");e&&(e.off("execution:end",this.onRenderComplete,this),e.off("execution:start:annotation",this.onAnalyticsRender,this))}},d.getMessageEntries=function(t,e){var n={};return e&&e.length&&(n[t]={id:t,type:t,items:e.map((function(t){var e=t.id,n=t.caption;return{id:e,label:t.label||n}}))}),n},d.updateMessages=function(t){var e=null;if(t){var n=t.getFeature("RenderSequence"),r=n&&n.getTaskResult("annotation");if(r)e=_extends({},this.getMessageEntries(i.MESSAGE_TYPES.WARNING,r.getWarningList()),this.getMessageEntries(i.MESSAGE_TYPES.ERROR,r.getErrorList()));else{var o=t.getFeature("SmartsExecution"),a=o&&o.getNonAnnotatableReasons().descriptions;a&&a.length&&(e=_extends({},this.getMessageEntries(i.MESSAGE_TYPES.WARNING,a.flat().map((function(t){return t.items})).flat())))}}return e},d.onRenderComplete=function(t){if("execution:end"===t.name){var e=t&&t.info&&t.info.renderContext,n=e&&e.taskRefreshed;n&&(n.data||n.annotation)&&this.setState({messages:this.updateMessages(this.getActiveContent())})}},d.onAnalyticsRender=function(){var t=this;if(!this.supportsAnalytics())return this.state.content.getFeature("SmartAnnotationProvider.suggestions").whenReady().then((function(){t.supportsAnalytics()&&t.forceUpdate()}))},n}(t.Component);return y.propTypes={apiOn:e.function,apiOff:e.function,canvas:e.object,icons:e.object,sections:e.array,content:e.object},y})),define("@dashboard-features/smartAnnotations/js/api/AnalyticsViewAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.registerSection=function(){},e.render=function(){},t}()})),define("@dashboard-features/smartAnnotations/js/view/AnalyticsView",["react","react-dom","./AnalyticsViewCtrl","../api/AnalyticsViewAPI","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-common/js/api/ContentActionsProviderAPI","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,i,r,o,a){var s=function(){function s(t){this.features=t.features,this.sections=[],this.features.InAppSlideoutState.registerContribution(s.providerId,{name:s.providerId,text:a.get("visualizationAnalytics"),icon:this.features.Icons.getIcon("forecast").id,type:"Button",order:10,section:o.ACTION_SECTION.PANEL,className:"buttonWithText",isEnabled:function(){return!0}}),this.features.InAppSlideoutDOM.registerView(s.providerId,this)}var c=s.prototype;return c.getAPI=function(){return this.api||(this.api=r.createAPI(this,[i])),this.api},c.destroy=function(){this.unmount(),this.api=null,this.features=null,this.sections=null},c.unmount=function(){this._parent&&(e.unmountComponentAtNode(this._parent),this._parent=null)},c.getProviderId=function(){return s.providerId},c.render=function(i){var r=this,o=(i||{}).parentNode,a=void 0===o?null:o;return a&&document.body.contains(a)&&this._parent!==a?(this.unmount(),this._parent=a,new Promise((function(i){e.render(t.createElement(n,{apiOn:r.features.API.on,apiOff:r.features.API.off,canvas:r.features.Canvas,icons:r.features.Icons,sections:r.sections.map((function(t){return t.section}))}),a,i)}))):Promise.resolve(null)},c.registerSection=function(t,e){void 0===e&&(e=-1),t&&(this.sections.push({section:t,order:e}),this.sections.sort((function(t,e){return t.order-e.order})))},s}();return s.providerId="analyticsView",s})),define("@dashboard-features/smartAnnotations/js/internal/SAToggleButtons",["@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","react","@ba/ba-ui-carbon-toolkit","prop-types"],(function(t,e,n,i){var r=n.ToggleSwitch,o=n.Label,a=n.Tooltip,s=n.FlexItem,c=n.FlexLayout,u=function(n){function i(){return n.apply(this,arguments)||this}_inheritsLoose(i,n);var u=i.prototype;return u.renderLabel=function(n,i){var r=e.createElement(a,{title:n.long,orient:"bottom"},e.createElement(o,{className:"intentTooltipLabel",label:n.short}));return"FIT_LINE"===i.id?e.createElement("div",null,e.createElement(o,{className:"smartannotationsShortLabelFitLabel",label:t.get("smart_annotation_Relationship")}),r):"MEANINGFUL_DIFFERENCES"===i.id?e.createElement("div",null,r):e.createElement("div",null,e.createElement(o,{className:"smartannotationsShortLabel",label:n.long}))},u.renderAToggle=function(n,i,u){var l=this,d=n.checked?t.get("smart_annotation_toggle_off"):t.get("smart_annotation_toggle_on");return e.createElement(c,{flexDirection:"row",justifyContent:"space-between",className:"smartToggleButtons"},e.createElement(s,null,e.createElement(a,{title:n.caption,orient:"top",className:"smartAnnotationsToggleTooltip",disabled:u},e.createElement(o,{className:"smartAnnotationsToggleText",disabled:u,label:n.caption,id:n.id}))),e.createElement(s,null,e.createElement(a,{title:d,orient:"top",className:"smartAnnotationsToggleTooltip",disabled:u},e.createElement(r,{className:n.checked?"smartAnnotationsToggleSwitch is-checked":"smartAnnotationsToggleSwitch",key:i,align:"right",checked:n.checked,disabled:u,onChange:function(){return l.props.onToggleButtonClicked(i)},small:!0,"aria-labelledby":n.id}))))},u.renderToggleSections=function(t,n,i,r){var o=this,a=[];r&&r.length>0&&(a=r.map((function(e){return o.renderLabel(e,t)})));var s=this.renderAToggle(t,n,i);return e.createElement("div",{className:"smartAnnotationsCheckboxSection ba-theme-waca"},e.createElement("div",{className:"smartAnnotationLabels"},s,a))},u.render=function(){var t=this.renderToggleSections.bind(this),n=this.props.disabled,i=!n&&this.props.messages||[],r=[];return this.props.annotations&&this.props.annotations.length>0&&(r=this.props.annotations.map((function(e,r){return t(e,r,n,i[e.id])}))),e.createElement("div",{className:"smartAnnotationsToggleButtons"},r)},i}(e.Component);return u.propTypes={disabled:i.bool,onToggleButtonClicked:i.func,messages:i.array,annotations:i.array},u})),define("@dashboard-features/smartAnnotations/js/internal/FPDMessages",["react","@ba/ba-ui-carbon-toolkit","prop-types"],(function(t,e,n){var i=e.Label,r=function(e){function n(){return e.apply(this,arguments)||this}_inheritsLoose(n,e);var r=n.prototype;return r.renderSubMessageLabel=function(e){return t.createElement(i,{className:"smartannotationsShortLabel",value:e.short,label:e.long})},r.renderTitle=function(e,n){return!n&&t.createElement(i,{className:"smartannotationsShortLabel",label:e})},r.renderMessagesSection=function(e,n){var i=this,r=[],o=e.entries;o&&o.length>0&&(r=o.map((function(t){return i.renderSubMessageLabel(t)})));var a=this.renderTitle(e.caption,n);return t.createElement("div",{className:"smartAnnotationsCheckboxSection"},a,t.createElement("div",{className:"smartAnnotationLabels"},r))},r.render=function(){var e=this.props.messages,n=this.renderMessagesSection.bind(this),i=[],r=e&&1===e.length;return e&&e.length>0&&(i=e.map((function(t){return n(t,r)}))),t.createElement("div",{className:"smartAnnotationsFPD"},i)},n}(t.Component);return r.propTypes={messages:n.array},r})),define("@dashboard-features/smartAnnotations/js/api/SmartsIndicatorAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.registerClickHandler=function(){},e.deregisterClickHandler=function(){},e.update=function(){},t}()})),define("text!@dashboard-features/smartAnnotations/js/templates/SmartAnnotiationsIndicator.html",[],(function(){return'<div role="application" class="dataWidgetIcon liveWidgetAnnotations liveWidgetAnnotationsNone" title="{{!it.title}}"  aria-label="{{!it.title}}" data-selector="true" tabindex="0">\n\t<svg class="svgIcon">\n\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#{{=it.smartAnnotationsIcon}}"></use>\n\t</svg>\n</div>\n'})),define("@dashboard-features/smartAnnotations/js/SmartsIndicator",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/visIndicators/api/VisIndicatorsProviderAPI","./api/SmartsIndicatorAPI","underscore","jquery","doT","text!./templates/SmartAnnotiationsIndicator.html","@waca/dashboard-livewidget/js/lib/@waca/core-client/js/core-client/utils/Utils","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","@waca/dashboard-common/js/utils/EventChainLocal","@waca/dashboard-livewidget/js/util/KeyCodes"],(function(t,e,n,i,r,o,a,s,c,u,l){var d=o.template(a),p=function(){function i(t){var e=t.content,n=t.features;this.content=e,this.features=n,this._onClickHandlers=[],n.VisIndicators.registerProvider(this.getAPI())}var o=i.prototype;return o.getIndicator=function(){if(!this.$indicatorIcon){var t=this.features["Dashboard.Icons"].getIcon("common-insights");this.$indicatorIcon=r(d({title:c.get("smart_annotation_insight_icon_title"),smartAnnotationsIcon:t.id}));var e=this._onClick.bind(this);this.$indicatorIcon.on("tap keyup click",e),this.$indicatorIcon=s.embedSVGIcon(this.$indicatorIcon)}return this.$indicatorIcon},o.destroy=function(){this.$indicatorIcon&&this.$indicatorIcon.off()&&this.$indicatorIcon.remove(),this.$indicatorIcon=null},o.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e,n])),this.api},o.getIndicatorList=function(){return[{name:i.id,icon:this.getIndicator()}]},o.registerClickHandler=function(){},o.deregisterClickHandler=function(){},o.update=function(){var t=this.getIndicator();this._areThereValidInsights()?t.removeClass("liveWidgetAnnotationsNone"):t.addClass("liveWidgetAnnotationsNone")},o._areThereValidInsights=function(){return!!this.features["SmartAnnotations.deprecated"].areThereValidFPDMessages()||!!this.features.Visualization.getDefinition().getProperty("supportsAnnotations")&&this.features["SmartAnnotations.deprecated"].areThereValidInsights()},o._onClick=function(t){if(new u(t).setProperty("preventDefaultContextBar",!0),!(t.keyCode&&t.keyCode!==l.KEY_ENTER||(t.gesture&&t.gesture.preventDefault(),this.features.VisIndicators.handleEvents(i.id,t)))){var e=this.features["Dashboard.InAppSlideoutState"];e&&e.open("analyticsView")}},o.getVisApi=function(){return this.visAPI||(this.visAPI=this.content.getFeature("WidgetAPI.deprecated").getVisApi()),this.visAPI},i}();return p.id="smartAnnotationsIcon",p})),define("@dashboard-features/smartAnnotations/js/view/InsightsSection",["react","prop-types","@ba/ba-ui-carbon-toolkit","../internal/SAToggleButtons","../internal/FPDMessages","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","../SmartsIndicator"],(function(t,e,n,i,r,o,a){var s=n.Container,c=function(n){function o(t){var e;return(e=n.call(this)||this).smartAnnotations=t.smartAnnotations,e.state=t.displayState,e}_inheritsLoose(o,n);var a=o.prototype;return a.componentDidUpdate=function(t){String(t.displayState.annotations.map((function(t){return t.checked})))!==String(this.props.displayState.annotations.map((function(t){return t.checked})))&&this.setState(this.props.displayState)},a.componentWillUnmount=function(){this.smartAnnotations.removeMessageListener(this)},a.render=function(){return this.smartAnnotations.addMessageListener(this),t.createElement(s,{className:"insightsSection"},this.smartAnnotations.areThereValidFPDMessages()?this.renderFPDMessages():this.renderSAToggleButtons())},a.renderSAToggleButtons=function(){return t.createElement(i,{annotations:this.state.annotations,messages:this.state.messages,disabled:!this.smartAnnotations.isAnnotationsEnabled(),onToggleButtonClicked:this.onToggleButtonClicked.bind(this)})},a.renderFPDMessages=function(){return t.createElement(r,{messages:this.state.fpdMessages})},a.onToggleButtonClicked=function(t){var e=this;this.setState((function(n){var i=n.annotations[t];return i.checked=!i.checked,e.smartAnnotations.annotationSelectionStateChanged(i),n}))},a.setSmartAnnotationMessages=function(t){this.setState({messages:t})},a.setFPDMessages=function(t){this.setState({fpdMessages:t})},a.clearInsightsIndicatorMessages=function(){this.setState({messages:null,fpdMessages:null})},_createClass(o,null,[{key:"propTypes",get:function(){return{smartAnnotations:e.object,displayState:e.object}}}]),o}(t.Component);return function(){function e(t){this.features=t.features,this.features.AnalyticsView.registerSection(this),this.content=this.getSelectedContent()}var n=e.prototype;return n.getSelectedContent=function(){var t=this.features.Canvas.getSelectedContentList();return 1===t.length?t[0]:null},n.getSmartAnnotations=function(){return this.content&&this.content.getFeature("SmartAnnotations.deprecated")},n.getId=function(){return"insights"},n.getVisIconId=function(){return a.id},n.getLabel=function(){return o.get("smart_annotation_dialog_title")},n.render=function(){return t.createElement(c,{smartAnnotations:this.getSmartAnnotations(),displayState:JSON.parse(JSON.stringify(this.getSmartAnnotations().getAnnotationDisplayState()))})},n.getToggleSupport=function(){var t=this.getSmartAnnotations();return t&&t.supportsAnnotations()},n.getEnabled=function(){var t=this.getSmartAnnotations();if(t){var e=t.areThereValidFPDMessages(),n=t.supportsAnnotations(),i=t.areThereValidInsights();return e||n&&i}return!1},n.getChecked=function(){var t=this.getSmartAnnotations();return!t||!t.supportsAnnotations()||t.isAnnotationsEnabled()},n.setChecked=function(t){var e=this.getSmartAnnotations();e&&e.toggleStateChanged(!!t)},n.getToggleTooltip=function(){return this.getChecked()?o.get("smart_annotations_toggle_off"):o.get("smart_annotations_toggle_on")},n.setContent=function(t){this.content=t},e}()})),define("@dashboard-features/staticOutput/js/api/StaticOutputAPI",[],(function(){return function(){function t(){_classCallCheck(this,t)}return t.prototype.generateOutput=function(){},t}()})),define("@dashboard-features/staticOutput/js/StaticOutput",["./api/StaticOutputAPI","@waca/dashboard-common/js/core/APIFactory"],(function(t,e){var n={portrait:"portrait",landscape:"landscape"},i={letter:"letter",legal:"legal",a4:"a4",tabloid:"tabloid"};return function(){function r(n){var i=n.features;_classCallCheck(this,r),this._features=i,this.api=e.createAPI(this,[t])}return r.prototype.getAPI=function(){return this.api},r.prototype.destroy=function(){this._features=null},r.prototype.generateOutput=function(t){var e=t.pageSize,n=t.printFilters,i=this._getFormNode({pageSize:e,printFilters:n});this._getDocument().body.appendChild(i),i.submit(),i.remove()},r.prototype._getDocument=function(){return document},r.prototype._getFormNode=function(t){var e=t.pageSize,n=t.printFilters,i=this._getOutputOptions({pageSize:e,printFilters:n}),r=document.createElement("form");r.method=i.method,r.action=i.action,r.setAttribute("accept-charset","utf-8"),r.target="_blank",r.style.display="none";var o=i.values;return Object.keys(o).forEach((function(t){var e=document.createElement("input");e.setAttribute("type","text"),e.setAttribute("name",t),e.value=o[t],r.appendChild(e)})),r},r.prototype._getOutputOptions=function(t){var e=t.pageSize,n=t.printFilters;e=e||{};var i=this._features.Serializer.toJSON();return{method:"POST",action:"./static_output/generate",name:i.name,values:{format:this._getPageFormat(e.pageSize),orientation:this._getPageOrientation(e.orientation),outputType:"pdf",printFilters:n,specification:JSON.stringify(i)}}},r.prototype._getPageOrientation=function(t){var e=t?t.toLowerCase():n.portait;return n[e]||n.portrait},r.prototype._getPageFormat=function(t){var e=t?t.toLowerCase():i.letter;return i[e]||i.letter},r}()})),define("@dashboard-features/caActions/js/datapoint/customGroupAction/api/CustomGroupActionAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getDataPointActionList=function(){},e.createCustomGroup=function(){},e.renameCustomGroup=function(){},e.removeCustomGroup=function(){},t}()})),define("@dashboard-features/caActions/js/datapoint/customGroupAction/CustomGroupAction",["@waca/dashboard-livewidget/js/features/content/common/DataPointActionBase","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","./api/CustomGroupActionAPI","@waca/dashboard-common/js/core/APIFactory","underscore","ca-modeller/shaping"],(function(t,e,n,i,r,o){"use strict";return function(t){function a(e){var n;return(n=t.call(this,e)||this).content.getFeature("DataPointActions").registerProvider("customGroupAction",n.getAPI()),n.features=e.features,n}_inheritsLoose(a,t);var s=a.prototype;return s.getAPI=function(){return i.createAPI(this,[n])},s.getDataPointActionList=function(t,n){var i=t.dataPoints||[],o=i.length&&r.flatten(r.without(r.pluck(i,"categories"),void 0),!0),a=o.length&&o[0]&&this._getVisualization().getSlots().getMappingInfo(o[0].dataItemId).dataItem,s=a&&a.getMetadataColumn(),c=this.features["Dashboard.Icons"].getIcon("GroupIcon");if(this._supportAction(i,o,a,s,n)){var u={name:"customGroup",text:e.get("customGroupLabel"),label:e.get("customGroupLabel"),icon:c.id,type:"Button",group:"customGroupAction"},l=this._getViewOptions(i,a,s);if(!this._getCustomGroupData(s.getSourceId(),s.getId())||1===l.length&&"createCustomGroupAction"===l[0].actionId)r.extend(u,{action:this.createCustomGroup.bind(this,i,a,s)});else{var d=o&&o.map((function(t){return t.label})).join(e.get("listSeparator")+" ");r.extend(u,{type:"NextView",targetCaption:d,viewModule:"dashboard-analytics/dialogs/CustomGroupActionsListDialog",viewOptions:{possibleItems:l}})}return[u]}return[]},s._supportAction=function(t,e,n,i,r){if(void 0===r&&(r={}),this.dashboard.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","customGroups","disabled"))return!1;if(r.noFilters)return!1;var o=this._isSupportedSelections(e,i);if(o){var a=this._getCustomGroupData(i.getSourceId(),i.getId()),s=!1,c=this._createCustomGroupSpec(t);a&&(c=this._updateCustomGroupSpec(t,a),s=!0),o=this._getCustomGroupUI().validateCustomGroup(i.getSourceId(),i.getId(),s,c)}return o},s._isSupportedSelections=function(t,e){return this._isValidCategoricalSelections(t,e)&&this._isValidWhiteListVisType()&&this._isSupportedDataType(e)},s._isValidWhiteListVisType=function(){var t=this.content.getFeature("Visualization").getDefinition();return t&&t.getProperty("supportsCustomGroupAction")},s._isValidCategoricalSelections=function(t,e){return 1===Object.keys(r.groupBy(t,"columnId")).length&&"attribute"===e.getType()},s._isSupportedDataType=function(t){return t&&!t.isDateTimeDataType()},s._isSelectionAllGrouped=function(t,e){var n=this._getCustomGroupData(e.getSourceId(),e.getId());if(n){var i=n.groupsList;return!r.filter(t,(function(t){return!(r.findWhere(i,{label:t.label})||r.findWhere(i,{placeholder:t.label}))})).length}return!1},s._supportCreateAction=function(t,e){return t.length>1||1===t.length&&!this._isSelectionAllGrouped(t,e)},s._supportRenameAction=function(t,e){return 1===t.length&&this._isSelectionAllGrouped(t,e)},s._supportRemoveAction=function(t,e){return this._isSelectionAllGrouped(t,e)},s._getViewOptions=function(t,n,i){var r=this._getMembersFromDataPoints(t),o=[];return this._supportCreateAction(r,i)&&o.push({label:e.get("createCustomGroupLabel"),value:this.createCustomGroup.bind(this,t,n,i),actionId:"createCustomGroupAction"}),this._supportRenameAction(r,i)&&o.push({label:e.get("renameCustomGroupLabel"),value:this.renameCustomGroup.bind(this,t,n,i),actionId:"renameCustomGroupAction"}),this._supportRemoveAction(r,i)&&o.push({label:e.get("ungroupCustomGroupLabel"),value:this.removeCustomGroup.bind(this,t,n,i),actionId:"removeCustomGroupAction"}),o},s._getUniqueGlobalFiltersSelector=function(t){return{origin:"visualization",sourceId:this._getVisualization().getDataSource().getId(),scope:this.content.getFeature("WidgetAPI.deprecated").getScope(),eventGroupId:this.eventGroups.getGroupId(this.content.getId()),hierarchyUniqueNames:[t]}},s._getMembersFromDataPoints=function(t){var e=[];return t.filter((function(t){return t.categories&&1===t.categories.length})).forEach((function(t){var n=t.categories[0].label,i=n&&n.toString()||n;i&&function(t,e){return!r.find(t,(function(t){return t.label===e}))}(e,i)&&e.push({label:i})})),e},s._getNewCustomGroupList=function(t,e){var n=[],i="";return r.each(t.groupsList,(function(t){i=t.label||t.placeholder,n.push(i)})),r.filter(e.groupsList,(function(t){return i=t.label||t.placeholder,!r.contains(n,i)}))},s._createCustomGroupSpec=function(t){return{groupsList:[{value:this._getMembersFromDataPoints(t),focus:!0}]}},s._updateCustomGroupSpec=function(t,e){var n=this._getMembersFromDataPoints(t),i=e.groupsList,o=[],a=[],s="";return r.each(i,(function(t){s=t.label||t.placeholder,r.findWhere(n,{label:s})&&(o.push(s),a=a.concat(t.value))})),n=r.filter(n,(function(t){return!r.contains(o,t.label)})).concat(a),(i=r.filter(i,(function(t){return s=t.label||t.placeholder,!r.contains(o,s)}))).push({value:n,focus:!0}),e.groupsList=i,e},s._updateGroupName=function(t,e){var n=t.groupsList;return r.each(n,(function(t){(t.label||t.placeholder)===e&&(t.focus=!0)})),t.groupsList=n,t},s._handleMUIDialogErrors=function(t){var n=this,i=[o.customGroupUtils.getCustomGroupMessageIds().CUSTOM_GROUP_INT_MSG_CANCEL],a=t.messages||[],s=!1;if(a.length>0?r.each(a,(function(t){r.contains(i,t.messageId)||(s=!0,n.logger.error(t.messageHint,n))})):(s=!0,this.logger.error(t,this)),s){this.dashboard.showToast(e.get("createCustomGroupErrorToast"),{type:"error",preventDuplicates:!0})}},s._addConsumerGroupColumnToSourceModel=function(t,e,n){var i=this._getMoserDataSources().getCustomGroupColumns(t);i||(i=[]),-1===i.indexOf(e)&&(i.push(e),this._getMoserDataSources().setCustomGroupColumns(t,i,n))},s._removeConsumerGroupColumnFromSourceModel=function(t,e,n){var i=this._getMoserDataSources().getCustomGroupColumns(t);if(i){var r=i.filter((function(t){return t!==e}));this._getMoserDataSources().setCustomGroupColumns(t,r,n)}},s.createCustomGroup=function(t,e,n){var i=this;return this._ensureTemporaryModule(n.getSourceId()).then((function(){var r=n.getId(),o=i._createCustomGroupSpec(t),a=!1,s=i._getCustomGroupData(n.getSourceId(),n.getId());s&&(o=i._updateCustomGroupSpec(t,s),a=!0);var c=i.transaction.startTransaction();return i._getCustomGroupUI().createCustomGroup(n.getSourceId(),r,a,o,null,c).then((function(t){c.forceUpdate=!0,i._addConsumerGroupColumnToSourceModel(t[0].getSourceId(),t[0].getId(),c);var o=i._getCustomGroupData(t[0].getSourceId(),t[0].getId()),a=i._getUniqueGlobalFiltersSelector(r),u=o.groupsList[0].label||o.groupsList[0].placeholder;if(i.globalFilters.removeFilters(a,c),s){var l=i._getNewCustomGroupList(s,o);l.length&&(u=l[0].label||l[0].placeholder)}else i._swapSlotsForGroupedItems(t[0].getId(),e.getId(),c),i._hideAndLabelGroupColumn(t[0],n);i._selectItems(t[0].getId(),[{label:u}],c)})).catch(i._handleMUIDialogErrors.bind(i)).finally((function(){i.transaction.endTransaction(c)}))}))},s.renameCustomGroup=function(t,e,n){var i=this;return this._ensureTemporaryModule(n.getSourceId()).then((function(){var r=n.getId(),o=i._getMembersFromDataPoints(t)[0].label,a=i._getCustomGroupData(n.getSourceId(),n.getId()),s=i._updateGroupName(a,o);return i._getCustomGroupUI().createCustomGroup(n.getSourceId(),r,!0,s).then((function(t){var n=i._getCustomGroupData(t[0].getSourceId(),t[0].getId()).groupsList.map((function(t){return t.label||t.placeholder})),s=a.groupsList.map((function(t){return t.label||t.placeholder})),c=i._getChangedName(n,s);if(c){var u=i.transaction.startTransaction(),l=i._getUniqueGlobalFiltersSelector(r);i._updateCustomSortingObjectForGroup(e,t[0].getId(),o,c,u),i.globalFilters.removeFilters(l,u),i._selectItems(t[0].getId(),[{label:c}],u),i.transaction.endTransaction(u)}})).catch(i._handleMUIDialogErrors.bind(i))}))},s._updateCustomSortingObjectForGroup=function(t,e,n,i,r){var o=t.getSort();if(o&&o.custom){var a=o.custom.top||[];if(a.length>0){var s=e+"->["+n+"]",c=a.indexOf(s);if(-1!==c){var u=e+"->["+i+"]";a[c]=u,o.custom.top=a,t.setSort(o,{transactionId:r.transactionId})}}}},s._removeSelectedGroupsFromList=function(t,e){var n=[];return r.each(e,(function(e){t=t.filter((function(t){return t.label!==e.label&&t.placeholder!==e.label||(n=n.concat(t.value),!1)}))})),{groupMembers:n,groupsList:t}},s.removeCustomGroup=function(t,e,n){var i=this;return this._ensureTemporaryModule(n.getSourceId()).then((function(){var r=n.getId(),a=i._getCustomGroupData(n.getSourceId(),n.getId()),s=a.basedOnMoserObjectId,c=i._getMembersFromDataPoints(t),u=i._removeSelectedGroupsFromList(a.groupsList,c),l=u.groupMembers,d=u.groupsList;if(!d.length){var p=i.transaction.startTransaction();p.forceUpdate=!0,i._swapSlotsForGroupedItems(s,e.getId(),p);var h=i._getUniqueGlobalFiltersSelector(r);return i.globalFilters.removeFilters(h,p),i._selectItems(s,l,p),i._isDataItemUsedForMapping(e.getId())?(i.transaction.endTransaction(p),Promise.resolve()):(i._removeConsumerGroupColumnFromSourceModel(n.getSourceId(),n.getId(),p),i._getCustomGroupUI().removeCustomGroup(n.getSourceId(),r).then((function(){return i.transaction.endTransaction(p),Promise.resolve()})).catch((function(t){return i.logger.error("Unable to remove the orphan custom group item from module.",t,r),i.transaction.endTransaction(p),Promise.resolve()})))}var f={groupsList:d,basedOnMoserObjectId:a.basedOnMoserObjectId,name:a.name},g={startView:o.customGroupUtils.getCustomGroupViews().CUSTOM_GROUP_VIEW_SILENT};return i._getCustomGroupUI().createCustomGroup(n.getSourceId(),r,!0,f,g).then((function(t){var e=i.transaction.startTransaction(),n=i._getUniqueGlobalFiltersSelector(r);i.globalFilters.removeFilters(n,e),i._selectItems(t[0].getId(),l,e),i.transaction.endTransaction(e)})).catch(i._handleMUIDialogErrors.bind(i))}))},s._isDataItemUsedForMapping=function(t){var e=this.dashboard.getSpec();if(e){var n=e.widgets&&r.filter(e.widgets,(function(t){return"live"===t.type}));return n&&r.some(n,(function(e){return e.slotmapping&&e.slotmapping.slots&&r.some(e.slotmapping.slots,(function(e){return r.contains(e.dataItems,t)}))}))}return!1},s._getChangedName=function(t,e){var n=t.length!==e.length,i=r.difference(t,e);return 1!==i.length||n?null:i.pop()},s._swapSlotsForGroupedItems=function(t,e,n){var i=this._getVisualization().getSlots().getMappingInfo(e);i.slot.addDataItems([{columnId:t}],i.indexInSlot,n),i.slot.removeDataItems([e],n)},s._selectItems=function(t,e,n){var i=[];r.each(e,(function(e){var n=e.label,r={itemIds:[t],tuple:[{d:n,u:t+"->["+n+"]"}]};i.push(r)}));var o={undoRedoTransactionId:n.transactionId,transactionToken:n,edgeSelect:e.length>1};this.content.getFeature("WidgetAPI.deprecated").getVisApi().selectData(i,o)},s._hideAndLabelGroupColumn=function(t,n){var i=e.get("customGroupingLabel",{columnLabel:n.getLabel()});t.setHidden(!0),t.setLabel(i),this._getMoserDataSources().addToUndoStack(n.getSourceId(),{undo:function(){},redo:function(){}},{skipUndoRedo:!0})},s._ensureTemporaryModule=function(t){return this._getMoserDataSources().ensureTemporaryModule(t)},s._getCustomGroupData=function(t,e){return this._getMoserDataSources().getCustomGroupData(t,e)},s._getMoserDataSources=function(){return this._moserDataSources||(this._moserDataSources=this.dashboard.getFeature("DataSources.moser")),this._moserDataSources},s._getCustomGroupUI=function(){return this._uiDataSources||(this._uiDataSources=this.dashboard.getFeature("DataSources.CustomGroupUI")),this._uiDataSources},s._getVisualization=function(){return this._visualization||(this._visualization=this.content.getFeature("Visualization")),this._visualization},a}(t)})),define("@dashboard-features/caActions/js/content/navigateAction/api/NavigationGroupsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.createNavigationGroup=function(){},e.deleteNavigationGroup=function(){},e.startNavigating=function(){},e.endNavigating=function(){},e.setNavigationGroupIdInFocus=function(){},t}()})),define("@dashboard-features/caActions/js/content/navigateAction/NavigationGroupsAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){var t=this;return this.apiSpec||(this.apiSpec={name:"navigation groups API",events:{propagationInfo:{namespace:"navigationGroups",info:{supportsUndoRedo:!0,refresh:{}}},actions:{setNavigationGroupIdInFocus:{eventName:"setNavigationGroupIdInFocus",transactionAPI:this.transaction,isResolvePostResponse:!1,transactionParamIndex:1,autoCreateTransaction:!0,getUndoActions:function(){return[{name:"setNavigationGroupIdInFocus",params:[t.getNavigationGroupIdInFocus()]}]}},deleteNavigationGroup:{eventName:"deleteNavigationGroup",transactionAPI:this.transaction,isResolvePostResponse:!0,transactionParamIndex:1,autoCreateTransaction:!0,getUndoActions:function(t,e){return[{name:"createNavigationGroup",params:[e.key,e.group]}]}},createNavigationGroup:{eventName:"createNavigationGroup",transactionAPI:this.transaction,isResolvePostResponse:!1,transactionParamIndex:2,autoCreateTransaction:!0,getUndoActions:function(t){return[{name:"deleteNavigationGroup",params:[t[0]]}]}}}}}),this.apiSpec},t}()})),define("@dashboard-features/caActions/js/content/navigateAction/NavigationGroups",["@waca/dashboard-common/js/core/APIFactory","./api/NavigationGroupsAPI","./NavigationGroupsAPISpec"],(function(t,e,n){return function(n){function i(t){var e;(e=n.call(this,t)||this).features=t.features;var i=e.features.Visualization.getSlots();return i.on("change:dataitems:create",e.onDataItemsCreate,_assertThisInitialized(e)),i.registerDeleteDataItemsHandler(e.onDataItemsDelete.bind(_assertThisInitialized(e))),e._navigationGroups=t.spec&&t.spec.navigationGroups||{},e}_inheritsLoose(i,n);var r=i.prototype;return r.getAPI=function(){return this._api||(this._api=t.createAPI(this,[e])),this._api},r.toJSON=function(){return Object.keys(this._navigationGroups).length?{navigationGroups:this._navigationGroups}:{}},r.createNavigationGroup=function(t,e){var n=this._navigationGroups[t]?Object.keys(this._navigationGroups).length:t;return this._navigationGroups[n]=e,this._navigationGroups[n]},r.deleteNavigationGroup=function(t){var e=JSON.parse(JSON.stringify({key:t,group:this._navigationGroups[t]}));return delete this._navigationGroups[t],e},r.startNavigating=function(t,e){var n=this._findNavigationGroupByItemId(t);if(!n){var i=this.features.Visualization.getSlots().getDataItem(t);i&&(n=this.getAPI().createNavigationGroup(this._getNewNavigationGroupId(),[{dataItemId:t,columnId:i.getColumnId(),actions:i.serializeActions()}],e))}var r=this._getNavigationGroupId(n);this.getAPI().setNavigationGroupIdInFocus(r,e)},r.endNavigating=function(t,e){var n=this._navigationGroups[this.getNavigationGroupIdInFocus()],i=this.features.Visualization.getSlots().getDataItem(t);if(i&&n){var r=this._findNavigationGroupEntry(n,i.getColumnId());r&&r.actions&&r.actions.forEach((function(t){var n=JSON.parse(JSON.stringify(t.params));i[t.name].apply(i,n.concat([e]))}))}this.getAPI().setNavigationGroupIdInFocus(null,e)},r.onDataItemsDelete=function(t,e){var n=this;this._navigationGroupIdInFocus?this._saveDataItemContentsToNavigationGroup(t[0],this._navigationGroups[this._navigationGroupIdInFocus]):t.forEach((function(t){var i=Object.keys(n._navigationGroups).find((function(e){if(-1!==n._navigationGroups[e].map((function(t){return t.dataItemId})).indexOf(t))return e}));i&&n.getAPI().deleteNavigationGroup(i,e)}))},r._saveDataItemContentsToNavigationGroup=function(t,e){var n=e&&e.find((function(e){return e.dataItemId===t}));if(n){var i=this.features.Visualization.getSlots().getDataItem(t);n.columnId=i.getColumnId(),n.actions=i.serializeActions(),delete n.dataItemId}},r.onDataItemsCreate=function(t){if(this._navigationGroupIdInFocus){var e=t.info.dataItemList.map((function(t){return t.id}))[0],n=this.features.Visualization.getSlots().getDataItem(e),i=this._navigationGroups[this._navigationGroupIdInFocus];if(i){var r=i&&i.find((function(t){return t.columnId===n.getColumnId()}));r?r.dataItemId=e:i.push({dataItemId:e})}}},r.setNavigationGroupIdInFocus=function(t){this._navigationGroupIdInFocus=t},r.getNavigationGroupIdInFocus=function(){return this._navigationGroupIdInFocus},r._findNavigationGroupByItemId=function(t){return Object.values(this._navigationGroups).find((function(e){return-1!==e.map((function(t){return t.dataItemId})).indexOf(t)}))},r._findNavigationGroupEntry=function(t,e){var n=t.find((function(t){return t.columnId===e}));return n?JSON.parse(JSON.stringify(n)):null},r._getNavigationGroupId=function(t){var e=this;return Object.keys(this._navigationGroups).find((function(n){return e._navigationGroups[n]===t}))},r._getNewNavigationGroupId=function(){var t=-1;return Object.keys(this._navigationGroups).forEach((function(e){var n=Number(e);n>t&&(t=n)})),t+1},i}(n)})),define("@dashboard-features/caActions/js/content/navigateAction/api/NavigateActionAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.setNavigationPathIdForDataItem=function(){},e.getNavigationPaths=function(){},e.getDrillGroups=function(){},e.navigateTo=function(){},t}()})),define("@dashboard-features/caActions/js/content/navigateAction/NavigateAction",["@waca/dashboard-livewidget/js/features/content/common/DataPointActionBase","@waca/dashboard-livewidget/js/features/content/slotActions/api/SlotActionsProviderAPI","@waca/dashboard-livewidget/js/features/content/dataPointActions/api/DataPointActionsProviderAPI","./api/NavigateActionAPI","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","@waca/dashboard-livewidget/js/apiHelpers/SlotAPIHelper","underscore"],(function(t,e,n,i,r,o,a,s){var c=function(t){function c(e){var n;return(n=t.call(this,e)||this).dashboard=e.dashboardAPI,n.content=e.content,e.features.DataPointActions.registerProvider("navigateAction",_assertThisInitialized(n)),e.features.SlotActions.registerProvider("navigateAction",n.getAPI()),n.features=e.features,n._drillState=[],n}_inheritsLoose(c,t);var u=c.prototype;return u.getAPI=function(){return this._api||(this._api=r.createAPI(this,[e,n,i])),this._api},u._initSelectionInfo=function(t){var e=this,n=s.flatten(s.pluck(t,"categories").filter(Boolean)),i=s.uniq(n,(function(t){return t.dataItemId})),r=this._getVisualization().getSlots();this._currentSelections=[],i.forEach((function(t){var n=r.getMappingInfo(t.dataItemId),i=s.find(e._currentSelections,(function(t){return t.slot.getId()===n.slot.getId()&&t.indexInSlot<n.indexInSlot}));i?(i.indexInSlot=n.indexInSlot,i.dataItem=n.dataItem,i.columnId=t.columnId,i.label=t.label):e._currentSelections.push(e._createCurrentSelectionInfo(t,n))}))},u._createCurrentSelectionInfo=function(t,e){return{columnId:t.columnId,label:t.label,slot:e.slot,dataItem:e.dataItem,indexInSlot:e.indexInSlot}},u._isMultiMeasuresSeriesSlot=function(t){return a.isMultiMeasuresSeriesSlot(t)||a.isMultiMeasuresValueSlot(t)},u._supportDataPointAction=function(t){return(!t.noFilters||t.drillOnly)&&(this._getNavigateItemsInfo()||this._getPreviousDrillItem())},u.setNavigationPathIdForDataItem=function(t){this._currentSelections[0].dataItem.setNavigationPathId(t)},u.getDataPointActionList=function(t,e){return this._initSelectionInfo(t.dataPoints),delete this._navigateItemsInfo,delete this._currentSelectionsOrig,this._initializeNavigateItemsInfo(),e.includeApplyFilter&&(this._currentSelectionsOrig=t),this._supportDataPointAction(e)?this._getAvailableActions():[]},u._supportSlotAction=function(t,e){return!this._isMultiMeasuresSeriesSlot(t,e)&&this._getNavigateItemsInfo()},u.getSlotActionList=function(t,e){if(void 0===e&&(e=0),Array.isArray(e)&&1!==e.length)return[];var n=this._getVisualization().getSlots().getSlot(t),i=n.getDataItemList()[e];return this._currentSelections=[{columnId:i.getColumnId(),slot:n,dataItem:i,indexInSlot:e}],delete this._navigateItemsInfo,delete this._currentSelectionsOrig,this._initializeNavigateItemsInfo(),this._supportSlotAction(n,e)?this._getAvailableActions():[]},u.getNavigationPaths=function(t){var e=this._getVisualization().getDataSource().getId(),n=this._currentSelections.map((function(t){return{label:t.label,columnId:t.columnId}}));return this._getMoserDataSources().getNavigationPaths(e,t,n)},u.getDrillGroups=function(t){var e=this._getVisualization().getDataSource().getId();return this._getMoserDataSources().getDrillGroups(e,t)},u._getAvailableActions=function(){if(0===this._currentSelections.length)return[];var t=!this._canDrillDown(),e=!this._hasDrillState(),n=this.features["Dashboard.Icons"].getIcon("dashboard-navigation-drillback"),i=this.features["Dashboard.Icons"].getIcon("dashboard-navigation-drilldown"),r=this.features["Dashboard.Icons"].getIcon("dashboard-navigation-compass");return this.toolbarContribution=[{name:"navigateBack",label:o.get("toolbarActionDrillBack"),text:o.get("toolbarActionDrillBack"),className:"iconWithText",icon:n.id,type:"Button",group:"navigateBackAction",action:this._navigateBack.bind(this),closeOnActionApplied:!0,disabled:e,update:!0},{name:"navigateDown",label:o.get("toolbarActionDrillDown"),text:o.get("toolbarActionDrillDown"),className:"iconWithText",icon:i.id,type:"Button",group:"navigateDownAction",action:this._navigateDown.bind(this),closeOnActionApplied:!0,disabled:t,update:!0}],this.viewOptions=this._getViewOptions(),this.viewOptions&&this.viewOptions.possibleItems&&this.toolbarContribution.push({name:"navigate",text:o.get("toolbarActionNavigate"),label:o.get("toolbarActionNavigate"),targetCaption:this._getNavigationToLabels(),className:"iconWithText",icon:r.id,type:this._hasMultipleColumns()?"SubMenu":"NextView",group:"navigateAction",closeOnActionApplied:!1,view:{module:"dashboard-analytics/widgets/livewidget/dialogs/NavigationDialog",state:this.viewOptions},actions:{apply:this._navigateTo.bind(this)},update:!0}),this.toolbarContribution},u._navigateTo=function(t){this.viewOptions.possibleItems=this._getNavigateInfoForDataItem(t),this.currentSelectedItem=t},u._getNavigationToLabels=function(){if(this._currentSelectionsOrig){var t=[];return this._getGroupKeys().forEach((function(e){e.groupKeyList.forEach((function(n,i){t.push(e.groupedSelection[0][i].label)}))})),t.join(" | ")}},u._getCurrentSelectedItem=function(){return this.currentSelectedItem||this._currentSelections&&this._currentSelections[0]&&this._currentSelections[0].columnId},u._getViewOptions=function(){var t={labels:!1,eventHandler:this};return this._hasMultipleColumns()?(t.possibleItems=this._getNavigateInfoForSubMenu(),t.updateFlyout=!0):t.possibleItems=this._getNavigateInfoForDataItem(this._currentSelections[0].columnId),t.getCurrentSelectedItem=this._getCurrentSelectedItem.bind(this),t},u._getNavigateInfoForSubMenu=function(){var t=this._getNavigateItemsInfo();return Object.keys(t).map((function(e){return{id:e,localizedString:t[e][0].dataItem.getLabel()}}))},u._initializeNavigateItemsInfo=function(){var t={};this._currentSelections.forEach(function(e){var n=this.getNavigationPaths(e.columnId);if(n&&n.length){var i={slot:e.slot,dataItem:e.dataItem,navigationPaths:n,indexInSlot:e.indexInSlot},r=this._getNavigationPathToUseForColumn(e.dataItem,n);r&&(i.selectedNavigationPath=r),t[e.columnId]=t[e.columnId]||[],t[e.columnId].push(i)}}.bind(this)),s.keys(t).length&&(this._navigateItemsInfo=t)},u._getNavigateItemsInfo=function(){return this._navigateItemsInfo||this._initializeNavigateItemsInfo(),this._navigateItemsInfo},u._getNavigateInfoForDataItem=function(t){var e=this._getNavigateItemsInfo();if(e)return e[t]},u._canDrillDown=function(){for(var t in this._navigateItemsInfo)return s.find(this._navigateItemsInfo[t],function(e){return this._getNextItemInNavPath(t,e.selectedNavigationPath)}.bind(this));return!1},u._hasMultipleColumns=function(){return s.unique(this._currentSelections,!1,(function(t){return t.columnId})).length>1},u._getNextItemInNavPath=function(t,e){var n=e.getSegment(),i=this._findIndex(n,"ref",t);if(!(i>=n.length-1))return n[i+1].ref},u._getNavigationPathToUseForColumn=function(t,e){var n=t.getNavigationPathId();if(n)for(var i=0;i<e.length;i++)if(e[i].getIdentifier()===n)return e[i];return e[0]},u._findIndex=function(t,e,n){if(!t)return-1;for(var i=0;i<t.length;i++)if(t[i][e]===n)return i;return-1},u._navigateDown=function(){var t=[];for(var e in this._navigateItemsInfo)this._navigateItemsInfo[e].forEach(function(n){var i=this._getNextItemInNavPath(e,n.selectedNavigationPath);i&&t.push({slot:n.slot,indexInSlot:n.indexInSlot,newColumnId:i,navigationPathId:n.selectedNavigationPath.getIdentifier()})}.bind(this));if(t.length)return this.navigateTo(t)},u.navigateTo=function(t){var e=this,n=this.transaction.startTransaction();this._clearDataPointSelectionsIfNeeded(n),this._applyNavigationToPageContext(n);var i=[];t.forEach((function(t){var r=e._replaceSlotMapping(t,n);r&&i.push(r)})),i.length&&this._saveDrillState(i),this.transaction.endTransaction(n)},u._clearDataPointSelectionsIfNeeded=function(t){var e=this.features.DataPointSelections.getSelections(),n=this._getCategoriesDataPoints(e),i=this._getSelector();(this.globalFilters.getFilterList({origin:"visualization",sourceId:i.sourceId,scope:i.scope})||[]).some((function(t){return n.every((function(e){return s.findWhere(t,{columnId:e.columnId})}))}))&&this.features.DataPointSelections.deselect(e,t)},u._getCategoriesDataPoints=function(t){var e=[];return t&&t.dataPoints&&this.selections.dataPoints.forEach((function(t){t.categories&&t.categories.forEach((function(t){var n=s.findWhere(e,{columnId:t.columnId});n||(n={columnId:t.columnId},e.push(n))}))})),e},u._applyNavigationToPageContext=function(t){var e=this;if(this._currentSelectionsOrig){var n=this._getSelector(),i=this.globalFilters.getFilters(n.sourceId,n.scope);this._getGroupKeys().forEach((function(r){r.groupKeyList.forEach((function(o,a){n.itemIds=[o],n.isSticky=!0;var s=e._getVisualization().getDataSource().getMetadataColumn(o);s&&s.isProperty()&&(n.type="display");var c={values:[r.groupedSelection[0][a]]};i.filterExists(n)||i.addFilter(n,c,t)}))}))}},u._getGroupKeys=function(){var t=this,e=[],n=this._groupSelections(this._currentSelectionsOrig.dataPoints),i=function(){var i=r&&r.split(",");return i&&i.length?1===i.length&&void 0===s.find(t._currentSelections,(function(t){return t.columnId===i[0]}))?"continue":void e.push({groupedSelection:n[r],groupKeyList:i}):"continue"};for(var r in n)i();return e},u._replaceSlotMapping=function(t,e){var n=t.slot,i=t.indexInSlot,r=t.navigationPathId,o=t.newColumnId;if(-1===i)return null;e.forceUpdate=!0;var a=n.getDataItemList()[i],s=a.getId(),u=a.getColumnId();this.features["NavigationGroups.internal"].startNavigating(s,e);var l={columnId:o,navigationPathId:r||c.INITIAL_NAV_PATH_ID};n.removeDataItemsMapping([s],e);var d=this._getVisualization().getSlots(),p=n.addDataItems([l],i,e)[0];return d.deleteDataItems([s],e),this.features["NavigationGroups.internal"].endNavigating(p.getId(),e),{slotId:n.getId(),newDataItem:{id:p.getId()},oldDataItem:{itemId:u,navigationPathId:r}}},u._navigateBack=function(){var t=this;if(this._hasDrillState()){var e=this.transaction.startTransaction(),n=this._getGlobalFiltersSelector(),i=this._getPreviousDrillItem(),r=(i?i.map((function(t){return t.oldDataItem})):[]).map((function(t){return t.itemId}));this._currentSelections.map((function(t){return t.columnId})).concat(r).forEach((function(i){n.itemId=i,t._removeGlobalFilters(n,e)})),this._revertToLastDrillState(e),this.transaction.endTransaction(e)}},u._removeGlobalFilters=function(t,e){this.globalFilters.removeFilters(t,e,{noSelfRefresh:!0})},u._getGlobalFiltersSelector=function(){return{origin:"visualization",sourceId:this._getVisualization().getDataSource().getId(),scope:this.content.getFeature("WidgetAPI.deprecated").getScope(),eventGroupId:this.eventGroups.getGroupId(this.content.getId()),eventSourceId:this.content.getId()}},u._getPreviousDrillItem=function(){return this._drillState.length?this._drillState[this._drillState.length-1]:null},u._saveDrillState=function(t){this._drillState.push(t)},u._revertToLastDrillState=function(t){var e=this;0!==this._drillState.length&&this._drillState.pop().forEach((function(n){var i=e._getVisualization().getSlots().getSlot(n.slotId),r=i.getDataItemList().map((function(t){return t.getId()})).indexOf(n.newDataItem.id),o=n.oldDataItem.navigationPathId,a=n.oldDataItem.itemId;e._replaceSlotMapping({slot:i,indexInSlot:r,navigationPathId:o,newColumnId:a},t)}))},u._hasDrillState=function(){return this._updateDrillState(),this._drillState.length>0},u._updateDrillState=function(){for(var t=this._getVisualization().getSlots().getSlotList(),e=this._drillState||[],n=e.length;n--;)this._updateDrillStateSlotId(t,e[n])},u._updateDrillStateSlotId=function(t,e){s.find(t,(function(t){var n=t.getDataItemList().map((function(t){return t.getId()})),i=s.find(e,(function(t){return n.indexOf(t.newDataItem.id)>=0})),r=t.getId();return i&&r!==i.slotId&&(i.slotId=r),i}))},u._getMoserDataSources=function(){return this._moserDataSources||(this._moserDataSources=this.dashboard.getFeature("DataSources.moser")),this._moserDataSources},c}(t);return c.INITIAL_NAV_PATH_ID="_initialPathId",c})),define("@dashboard-features/dataFilters/js/DataFiltersSelectionProvider",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/selections/dataPointSelections/api/DataPointSelectionProviderAPI"],(function(t,e){return function(){function n(t){var e=t.content,n=t.dashboardAPI,i=t.features;this.content=e,this.dataFilters=i["DataFilters.internal"],this.features=i,this.dashboard=n,this.featureChecker=this.dashboard.getGlassCoreSvc(".FeatureChecker"),this.initialize()}var i=n.prototype;return i.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},i.isDataFiltersEnabled=function(){return this.featureChecker.checkValue("dashboard","DataFilters","enabled")},i.initialize=function(){this.isDataFiltersEnabled()&&this.features.DataPointSelections.registerSelectionProvider(this.getAPI())},i.destroy=function(){},i._isBrushingFilterType=function(){return!this._isFilterContent()},i._isFilterContent=function(){var t=this.content.getContainer();return t.getFeature("FiltersUI")&&t.getFeature("FiltersUI").getFilterContent(this.content.getId())},i.select=function(t,e){var n=this;t.forEach((function(t){if(t.ranges){var i=t.ranges.map((function(t){return{range:t.range}})),r=t.ranges[0].columnId;n.dataFilters.add({contentType:"selection",columnIds:[r]},{values:i},e)}else if(t.edgeSelect)t.categories.forEach((function(i,r){n.dataFilters.add({contentType:"selection",columnIds:[i.columnId]},{values:[{categories:[t.categories[r]]}]},e)}));else{var o=n._getTupleColumnIds(t);n.dataFilters.add({contentType:"selection",columnIds:o},{values:[t]},e)}}))},i.deselect=function(t,e){var n=this;void 0===t&&(t=[]),t.length?t.forEach((function(t){if(t.edgeSelect)t.categories.forEach((function(i,r){n.dataFilters.remove({contentType:"selection",columnIds:[i.columnId]},{values:[{categories:[t.categories[r]]}]},e)}));else{var i=n._getTupleColumnIds(t);n.dataFilters.remove({contentType:"selection",columnIds:i},{values:[t]},e)}})):this.clearAll(e)},i.clearAll=function(t){var e=this,n=this._getVisualizationAttributeColumnIds(),i=this._isFilterContent()?{valuesOnly:!0}:null;this.dataFilters.remove({contentType:"selection",columnIds:n},i,t),(n=this._getVisualizationColumnIds()).forEach((function(n){e.dataFilters.remove({contentType:"selection",columnIds:[n]},i,t)}))},i.isSelected=function(t){var e=this;if(!t||!t.length)return!1;if(t[0].ranges){var n=[t[0].ranges[0].columnId];return!!this.getSelectedPoints(n).length}var i=t[0].categories.map((function(t){return t.columnId})),r=this.dataFilters.getFilterList({contentType:"selection",brushingFilters:this._isBrushingFilterType(),includeVisible:!0,columnIds:i}),o=!1;if(r.length){var a=r.length&&r[0].getValueList();o=t.every((function(t){return a.find((function(n){return e._tuplesMatch(t.categories,n)}))}))}return o},i.getSelectedPoints=function(t){var e=this.dataFilters.getFilterList({contentType:"selection",brushingFilters:this._isBrushingFilterType(),includeVisible:!0,columnIds:t});return e.length&&e[0].getValueList()||[]},i._getVisualizationAttributeColumnIds=function(){return this.features.Visualization.getSlots().getMappingInfoList().map((function(t){return t.dataItem})).filter((function(t){return"attribute"===t.getType()})).map((function(t){return t.getColumnId()}))},i._getVisualizationColumnIds=function(){return this.features.Visualization.getSlots().getMappingInfoList().map((function(t){return t.dataItem.getColumnId()}))},i._getTupleColumnIds=function(t){var e=[];return t.categories&&t.categories.forEach((function(t){return e.push(t.columnId)})),e},i._tuplesMatch=function(t,e){return t.length===e.length&&t.every((function(t){return e.find((function(e){return e.value===t.value}))}))},n}()})),define("@dashboard-features/dataFilters/js/api/LocalFiltersUIAPI",[],(function(){return function(){function t(){}return t.prototype.getLocalFilterUI=function(){},t}()})),define("@dashboard-features/dataFilters/js/LocalFiltersUI",["@waca/dashboard-common/js/core/APIFactory","./api/LocalFiltersUIAPI","@waca/dashboard-livewidget/js/filters/finder/FilterTypes"],(function(t,e,n){return function(){function i(){this.api=t.createAPI(this,[e])}var r=i.prototype;return r.destroy=function(){this.api=null},r.getAPI=function(){return this.api},r.getLocalFilterUI=function(t){var e="@dashboard-features/dataFilters/js/localfiltersui/controllers/";switch(t){case n.RANGE:return{path:e+"RangeLocalFilterController"};case n.TREE:return{path:e+"HierarchicalLocalFilterController"};case n.NON_NUMERICAL:return{path:e+"NonNumericLocalFilterController"};case n.DATE_TIME:return{path:e+"DateTimeLocalFilterController"}}return{path:null}},i}()})),define("@dashboard-features/dataFilters/js/api/CascadeSetsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.addToCascadeSet=function(){},e.removeFromCascadeSet=function(){},e.deleteItem=function(){},e.reorderCascadeSets=function(){},e.findCascadeSet=function(){},e.getCascadeSetList=function(){},e.getCascadeSet=function(){},e.getScope=function(){},e.on=function(){},e.off=function(){},e.getContentId=function(){},t}()})),define("@dashboard-features/dataFilters/js/api/CascadeSetsUpdateControllerAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.updateCascadeSetsOnDrop=function(){},e.updateCascadeSetsOnDropSet=function(){},e.getFinalDropTargetIndex=function(){},e.canDrop=function(){},e.registerItemPositionsCallback=function(){},t}()})),define("@dashboard-features/dataFilters/js/cascadingFilters/CascadeSetsUpdateController",[],(function(){return function(){function t(t){this.cascadingFilters=t}var e=t.prototype;return e.setCascadeSets=function(t){this.cascadeSets=t},e.registerItemPositionsCallback=function(t){this._getItemPositions=t},e.updateCascadeSetsOnDrop=function(t,e,n){var i=t&&this.cascadeSets&&this.cascadeSets.findCascadeSet(t.columnId,t.dataSourceId),r=e&&this.cascadeSets&&this.cascadeSets.findCascadeSet(e.columnId,e.dataSourceId);if(i&&(!r||i===r)){var o=1===i.getColumnIdList().length;this.cascadeSets.removeFromCascadeSet(t.columnId,i.getDataSourceId(),n),i=o?null:i}var a=t||{},s=this.getNonCascadePositionBefore(a);if(this._moveCascadeSetsAtPosition(a,s,0,n),r){var c=r.getColumnIdList().findIndex((function(t){return t===e.columnId}));if(i&&i!==r)this.cascadeSets.reorderCascadeSets(i.getId(),r.getId(),n),i.setPosition(r.getPosition(),n);else if(c>0&&t.dataSourceId===r.getDataSourceId()||i===r&&c>-1)this.cascadeSets.addToCascadeSet(t.columnId,t.dataSourceId,null,c,n);else{var u=this.cascadeSets.getCascadeSetList().findIndex((function(t){return t===r}));this._moveCascadeSetsAtPosition(r.getPosition(),a,u,n)}}},e.updateCascadeSetsOnDropSet=function(t,e,n){if(this.cascadeSets){var i=t&&this.cascadeSets.findCascadeSet(t.columnId,t.dataSourceId);if(i){var r=null===e?this._getLastNonCascadePosition():this.getNonCascadePositionBefore({columnId:e.columnId,dataSourceId:e.dataSourceId});i.setPosition(r,n);var o=(e=e?{columnId:e.columnId,dataSourceId:e.dataSourceId}:null)&&this.cascadeSets&&this.cascadeSets.findCascadeSet(e.columnId,e.dataSourceId);if(o&&o.getColumnIdList()[0]===e.columnId)this.cascadeSets.reorderCascadeSets(i.getId(),o.getId(),n);else{var a=this._getCascadeSetBeforeTargetPosition(e);a&&this.cascadeSets.reorderCascadeSets(a.getId(),i.getId(),n)}}}},e.getNonCascadePositionBefore=function(t){for(var e,n="",i="",r=_createForOfIteratorHelperLoose(this._getItemPositions());!(e=r()).done;){var o=e.value;if(t.columnId===o.columnId&&t.dataSourceId===o.dataSourceId)break;this.cascadeSets.findCascadeSet(o.columnId,o.dataSourceId)||(n=o.dataSourceId,i=o.columnId)}return{dataSourceId:n,columnId:i}},e.getCascadeSetAfterPosition=function(t){if(!this._getItemPositions)return null;for(var e,n,i=!1,r=_createForOfIteratorHelperLoose(this._getItemPositions());!(n=r()).done;){var o=n.value;if(o.columnId!==t.columnId||o.dataSourceId!==t.dataSourceId){if(e=i&&this.cascadeSets.findCascadeSet(o.columnId,o.dataSourceId))break}else i=!0}return e||null},e._getNonCascadePositionAfter=function(t){for(var e,n="",i="",r=!1,o=_createForOfIteratorHelperLoose(this._getItemPositions());!(e=o()).done;){var a=e.value;if(a.columnId!==t.columnId||a.dataSourceId!==t.dataSourceId){if(r&&!this.cascadeSets.findCascadeSet(a.columnId,a.dataSourceId)){i=a.columnId,n=a.dataSourceId;break}}else r=!0}return{dataSourceId:n,columnId:i}},e.getFinalDropTargetIndex=function(t,e){var n=-1;if(e&&this._isFirstItemInCascadeSet(e)){var i=this._getNonCascadePositionAfter(e),r=i.columnId,o=i.dataSourceId;if(r===t.columnId&&o===t.dataSourceId){var a=this._getNonCascadePositionAfter(t);r=a.columnId,o=a.dataSourceId}n=this._getIndexFromPosition(r,o)}return n},e._getIndexFromPosition=function(t,e){return""===t&&""===e?this._getItemPositions().length:this._getItemPositions().findIndex((function(n){return t===n.columnId&&n.dataSourceId===e}))},e._isFirstItemInCascadeSet=function(t){if(this.cascadingFilters.isCascadingFiltersEnabled()){var e=this.cascadeSets.findCascadeSet(t.columnId,t.dataSourceId);return!(!e||0!==e.getColumnIdList().indexOf(t.columnId))}return!1},e.canDrop=function(t,e){if(this.cascadeSets&&t&&e){var n=this.cascadeSets.findCascadeSet(e.columnId,e.dataSourceId);if(n&&n.getColumnIdList()[0]!==e.columnId)if(t.some((function(t){return t.dataSourceId!==n.getDataSourceId()})))return!1}return!0},e._getCascadeSetBeforeTargetPosition=function(t){var e=this._getItemPositions(),n=null===t?e.length:e.findIndex((function(e){return e.columnId===t.columnId&&e.dataSourceId===t.dataSourceId}));if(n>0){var i=e[n-1];return this.cascadeSets.findCascadeSet(i.columnId,i.dataSourceId)}return null},e._moveCascadeSetsAtPosition=function(t,e,n,i){void 0===n&&(n=0),this.cascadeSets.getCascadeSetList().slice(n).forEach((function(n){n.getPosition().dataSourceId===t.dataSourceId&&n.getPosition().columnId===t.columnId&&n.setPosition({dataSourceId:e.dataSourceId,columnId:e.columnId},i)}))},e._getLastNonCascadePosition=function(){var t=this._getItemPositions(),e=t[t.length-1],n=this.cascadeSets.findCascadeSet(e.columnId,e.dataSourceId);return n?n.getPosition():e},e.destroy=function(){this.cascadeSets=null,this._getItemPositions=null},t}()})),define("@dashboard-features/dataFilters/js/api/CascadeSetAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getId=function(){},e.findColumn=function(){},e.setPosition=function(){},e.getPosition=function(){},e.getColumnIdList=function(){},e.getDataSourceId=function(){},e.getDataFilters=function(){},e.destroy=function(){},e.on=function(){},e.off=function(){},_createClass(t,null,[{key:"DEFAULT_POSITION",get:function(){return{columnId:"",dataSourceId:""}}}]),t}()})),define("@dashboard-features/dataFilters/js/cascadingFilters/CascadeSetAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){var t=this;return this.apiSpec||(this.apiSpec={name:"cascade set API",events:{serializeActions:!0,propagationInfo:{namespace:"cascadeSet",callStack:{name:"getCascadeSet",params:[this.getId()]},info:{supportsUndoRedo:!0}},actions:{setPosition:{eventName:"setPosition",transactionParamIndex:1,autoCreateTransaction:!0,getUndoActions:function(e){var n=t.getPosition(),i=e[1];return[{name:"setPosition",params:[{columnId:n.columnId,dataSourceId:n.dataSourceId},i]}]}}}}}),this.apiSpec},t}()})),define("@dashboard-features/dataFilters/js/cascadingFilters/CascadeSet",["@waca/dashboard-common/js/core/APIFactory","../api/CascadeSetAPI","./CascadeSetAPISpec"],(function(t,e,n){return function(n){function i(i,r,o,a,s){var c;return void 0===s&&(s=null),(c=n.call(this)||this)._id=i,c._columnIds=[r],c._dataSourceId=o,c._dataFilters=a,c._position={},c.setPosition(s),c._api=c._api=t.createAPI(_assertThisInitialized(c),[e]),c}_inheritsLoose(i,n);var r=i.prototype;return r.getId=function(){return this._id},r.getAPI=function(){return this._api},r.addColumn=function(t,e){void 0===e&&(e=-1),-1===e||e>=this._columnIds.length?this._columnIds.push(t):this._columnIds.splice(e,0,t)},r.findColumn=function(t){return this._columnIds.find((function(e){return e===t}))},r.removeColumn=function(t){var e=this._columnIds.findIndex((function(e){return e===t}));return-1!==e&&this._columnIds.splice(e,1),e},r.setPosition=function(t){this._position.columnId=t&&t.columnId||e.DEFAULT_POSITION.columnId,this._position.dataSourceId=t&&t.dataSourceId||e.DEFAULT_POSITION.dataSourceId},r.getPosition=function(){return JSON.parse(JSON.stringify(this._position||{}))},r.getColumnIdList=function(){return this._columnIds},r.getDataSourceId=function(){return this._dataSourceId},r.getDataFilters=function(){return this._dataFilters},r.destroy=function(){},i}(n)})),define("@dashboard-features/dataFilters/js/cascadingFilters/CascadeSetsAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){return this.apiSpec||(this.apiSpec={name:"cascade sets API",events:{serializeActions:!0,propagationInfo:{namespace:"cascadeSets",callStack:{name:"cascadeSets",params:[]},info:{supportsUndoRedo:!0}},actions:{addToCascadeSet:{eventName:"addToCascadeSet",transactionParamIndex:4,autoCreateTransaction:!0,getUndoActions:function(t){return[{name:"removeFromCascadeSet",params:t}]}},removeFromCascadeSet:{eventName:"removeFromCascadeSet",isResolvePostResponse:!0,transactionParamIndex:2,autoCreateTransaction:!0,getUndoActions:function(t,e){var n=e.idRemoved,i=e.indexInSet;return[{name:"addToCascadeSet",params:[t[0],t[1],n,i,t[2]]}]}},reorderCascadeSets:{eventName:"reorderCascadeSets",transactionParamIndex:2,autoCreateTransaction:!0,getUndoActions:function(t){var e=t[0];return[{name:"reorderCascadeSets",params:[t[1],e,t[2]]}]}}}}}),this.apiSpec},t}()})),define("@dashboard-features/dataFilters/js/cascadingFilters/CascadeSets",["@waca/dashboard-common/js/core/APIFactory","../api/CascadeSetsAPI","../api/CascadeSetsUpdateControllerAPI","./CascadeSetsUpdateController","./CascadeSet","./CascadeSetsAPISpec"],(function(t,e,n,i,r,o){return function(o){function a(r){var a,s=r.content,c=r.features,u=r.spec;return(a=o.call(this)||this)._cascadingFilters=c["Dashboard.CascadingFilters"],a._dataFilters=c.DataFilters,a._featureModel=u,a._content=s,a._cascadeSetsUpdateController=new i(a._cascadingFilters),a._api=t.createAPIFromSpec([{implementation:_assertThisInitialized(a),interface:e},{implementation:a._cascadeSetsUpdateController,interface:n}]),a._cascadeSetsUpdateController.setCascadeSets(a._api),a._cascadeSetList=[],a._cascadingFilters.isCascadingFiltersEnabled()&&a._loadCascadeSets(),a._cascadingFilters.registerCascadeSets(a._api),a}_inheritsLoose(a,o);var s=a.prototype;return s.getAPI=function(){return this._api},s.getCascadeSet=function(t){var e=this._cascadeSetList.find((function(e){return e.getId()===t}));return e&&e.getAPI()},s._getNextSetId=function(){var t=-1;return this.getCascadeSetList().forEach((function(e){return t=e.getId()>t?e.getId():t})),t+1},s.addToCascadeSet=function(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=-1);var r=this._cascadeSetList.filter((function(t){return t.getDataSourceId()===e&&(null===n||t.getId()===n)})),o=null;if(0===r.length){var a=this._cascadeSetsUpdateController.getNonCascadePositionBefore({columnId:t,dataSourceId:e});o=this._addCascadeSet(t,e,n,a)}else(o=r[0]).addColumn(t,i);return this._updateCascadeSetsOnAddOrRemove(t,e),o&&o.getAPI()},s.reorderCascadeSets=function(t,e){var n=this._cascadeSetList.findIndex((function(e){return e.getId()===t})),i=this._cascadeSetList.findIndex((function(t){return t.getId()===e}));if(-1!==n&&-1!==i&&n>i){var r=this._cascadeSetList[n];return this._cascadeSetList[n]=this._cascadeSetList[i],this._cascadeSetList[i]=r,!0}return!1},s.getScope=function(){return this._content.getContainer()?this._content.getId():"global"},s.getContentId=function(){return this._content.getId()},s.getCascadeSetList=function(t){return void 0===t&&(t=null),(null===t?this._cascadeSetList:this._cascadeSetList.filter((function(e){return e.getDataSourceId()===t}))).map((function(t){return t.getAPI()}))},s.findCascadeSet=function(t,e){var n=this._findCascadeSet(t,e);return n&&n.getAPI()},s.deleteItem=function(t,e,n){this._findCascadeSet(t,e)?this.getAPI().removeFromCascadeSet(t,e,n):this._updateCascadeSetsOnAddOrRemove(t,e,n)},s.removeFromCascadeSet=function(t,e){var n=this._findCascadeSet(t,e),i={};return n&&(1===n.getColumnIdList().length?i=this._removeCascadeSet(t,e):(i.indexInSet=n.removeColumn(t),i.idRemoved=n.getId())),i},s._removeCascadeSet=function(t,e){var n=this._findCascadeSetIdx(t,e);if(-1!==n){var i=this._cascadeSetList[n].getPosition(),r=this._cascadeSetList[n].getId();return this._cascadeSetList.splice(n,1),{idRemoved:r,position:i}}return null},s._updateCascadeSetsOnAddOrRemove=function(t,e,n){var i=this._cascadeSetList.filter((function(n){return n.getPosition().columnId===t&&n.getPosition().dataSourceId===e}));if(i&&i.length){var r={columnId:t,dataSourceId:e},o=this._cascadeSetsUpdateController.getNonCascadePositionBefore(r);i.forEach((function(t){n?t.getAPI().setPosition(o,n):t.setPosition(o)}))}},s.destroy=function(){this._cascadingFilters.deregisterCascadeSets(this._api),this._cascadeSetList.forEach((function(t){return t.destroy()})),this._cascadeSetsUpdateController.destroy()},s.toJSON=function(){var t=this;return this._featureModel=void 0,this._cascadeSetList.length&&(this._featureModel={cascadeSets:[]},this._cascadeSetList.forEach((function(e){t._featureModel.cascadeSets.push({id:e.getId(),position:e.getPosition(),dataSourceId:e.getDataSourceId(),items:e.getColumnIdList()})}))),this._featureModel},s._findCascadeSetIdx=function(t,e){return this._cascadeSetList.findIndex((function(n){return n.getDataSourceId()===e&&n.findColumn(t)}))},s._addCascadeSet=function(e,n,i,o){void 0===i&&(i=null),void 0===o&&(o=null);var a=null===i?this._getNextSetId():i,s=new r(a,e,n,this._dataFilters,o);t.setParentChildRelation(this,s);var c=this._cascadeSetsUpdateController.getCascadeSetAfterPosition({columnId:e,dataSourceId:n});if(c){var u=this._cascadeSetList.findIndex((function(t){return t.getId()===c.getId()}));this._cascadeSetList.splice(u,0,s)}else this._cascadeSetList.push(s);return s},s._findCascadeSet=function(t,e){var n=this._findCascadeSetIdx(t,e);return-1!==n?this._cascadeSetList[n]:null},s._loadCascadeSets=function(){var t=this;this._featureModel&&this._featureModel.cascadeSets&&this._featureModel.cascadeSets.forEach((function(e){var n=null;e.items.forEach((function(i){n?n.addColumn(i):(n=t._addCascadeSet(i,e.dataSourceId,e.id)).setPosition(e.position)}))}))},s.reset=function(){},a}(o)})),define("@dashboard-features/dataFilters/js/content/DataPointFilterAction",["@waca/dashboard-livewidget/js/features/content/common/DataPointActionBase","@waca/dashboard-livewidget/js/features/content/dataPointActions/api/DataPointActionsProviderAPI","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","underscore"],(function(t,e,n,i,r){return function(t){function o(e){var n,i=e.content,r=e.dashboardAPI,o=e.features;return(n=t.call(this,{content:i,dashboardAPI:r,features:o})||this).content.getFeature("DataPointActions").registerProvider("DataPointFilterAction",n.getAPI()),n.features=o,n.dashboard=r,n}_inheritsLoose(o,t);var a=o.prototype;return a.getAPI=function(){return this._api||(this._api=n.createAPI(this,[e])),this._api},a.getDataPointActionList=function(t,e){void 0===e&&(e={});var n=[];return this._supportAction(t,e)&&(n.push.apply(n,[{name:"filterLocalExcludeSelected",label:i.get("toolbarActionFilterLocalExcludeSelected"),className:"iconWithText",text:i.get("toolbarActionFilterLocalExcludeSelected"),type:"Button",actions:{apply:this._applyFilter.bind(this,t,!0)},closeOnActionApplied:!0},{name:"filterLocalKeepSelected",label:i.get("toolbarActionFilterLocalKeepSelected"),className:"iconWithText",text:i.get("toolbarActionFilterLocalKeepSelected"),type:"Button",actions:{apply:this._applyFilter.bind(this,t,!1)},closeOnActionApplied:!0}]),e.includeApplyFilter&&"cell_edge_row"!==t.area&&"cell_edge_column"!==t.area&&n.push({name:"filterAllKeepSelected",label:i.get("toolbarActionFilterAllKeepSelected"),className:"iconWithText",text:i.get("toolbarActionFilterAllKeepSelected"),type:"Button",actions:{apply:this._applyPendingToDataPointSelections.bind(this,t)},closeOnActionApplied:!0})),n},a._supportAction=function(t,e){if(e.noFilters)return!1;var n=t&&t.dataPoints;return r.some(n,(function(t){return t.categories}))},a._applyPendingToDataPointSelections=function(t,e){if(!this._isDataFiltersEnabled())return this._applyPendingToPageContext(t,e);var n=this.dashboard.getFeature("Transaction"),i=e||n.startTransaction();this.content.getFeature("DataPointSelections").select(t.dataPoints,i),this.content.getFeature("DataPointSelections.pending").clearAll(i),e||n.endTransaction(i)},a._applyPendingToPageContext=function(t,e){var n=this.dashboard.getFeature("Transaction"),i=n.startTransaction(e),r=this._getSelector(),o=this._groupSelections(t.dataPoints),a=this.globalFilters.getFilters(r.sourceId,r.scope);for(var s in o)if(s){r.itemIds=s.split(",");var c={values:o[s]};a.addFilter(r,c,i)}n.endTransaction(i)},a._applyFilter=function(t,e,n){var i=this.dashboard.getFeature("Transaction"),o=i.startTransaction(n),a=this._groupSelections(t.dataPoints);for(var s in a)if(s){var c={},u={exclude:!!e},l=a[s],d=s.split(",");if(this._isDataFiltersEnabled()){c.columnIds=d;var p={exclude:!!e,values:l.map((function(t){return{categories:t}}))};if(this.features.DataFilters.add(c,p,o),e){var h=JSON.parse(JSON.stringify(c));h.contentType="selection",this.features.DataFilters.remove(h,null,o)}}else d.length>1?(c.itemIds=d,u.values=l):(c.itemId=d[0],u.values=r.flatten(l)),this._getLocalFilters().addFilter(c,u,o),u.exclude&&this.globalFilters.removeFilters(this._getSelector(),o)}i.endTransaction(o)},a._isDataFiltersEnabled=function(){return this.dashboard.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","DataFilters","enabled")},o}(t)})),define("@dashboard-features/forecast/js/ForecastPropertiesProvider",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-common/js/api/PropertiesProviderAPI"],(function(t,e){return function(){function n(t){this.content=t.content,this.content&&this.content.getFeature("Properties").registerProvider(this.getAPI())}var i=n.prototype;return i.getAPI=function(){return this._api||(this._api=t.createAPI(this,[e])),this._api},i.destroy=function(){this.content=null},i.getPropertyLayoutList=function(){return[]},i.getPropertyList=function(){return[{id:"forecasting",onPropertyChange:{refresh:{annotation:!0,data:!0}}}]},i.reset=function(){},n}()}));id=0;function _classPrivateFieldLooseKey(t){return"__private_"+id+++"_"+t}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}define("@dashboard-features/insightsNarrator/js/InsightNarratorTracking",[],(function(){"use strict";var t="addNarrativeInsightToFavoriteInsights",e="removeNarrativeInsightsFromFavoriteInsights",n="reorderFavoriteInsight",i="clickNarrativeInsightsIconOnDataWidget",r="expandNarrativeInsightsPanelSection",o="collapseNarrativeInsightsPanelSection",a=_classPrivateFieldLooseKey("registerTrackingEvents"),s=_classPrivateFieldLooseKey("deregisterTrackingEvents"),c=_classPrivateFieldLooseKey("track"),u=_classPrivateFieldLooseKey("trackPin"),l=_classPrivateFieldLooseKey("trackUnpin"),d=_classPrivateFieldLooseKey("trackReOrderPinned"),p=_classPrivateFieldLooseKey("trackIndicatorClick"),h=_classPrivateFieldLooseKey("trackSectionToggle"),f=_classPrivateFieldLooseKey("getInsightInfo"),g=_classPrivateFieldLooseKey("getPinnedInsightInfo");function m(){this.insightsNarrator.on("change:pin",_classPrivateFieldLooseBase(this,u)[u],this),this.insightsNarrator.on("change:unPin",_classPrivateFieldLooseBase(this,l)[l],this),this.insightsNarrator.on("change:reOrderPinned",_classPrivateFieldLooseBase(this,d)[d],this),this.insightsIndicator.on("change:onClick",_classPrivateFieldLooseBase(this,p)[p],this),this.insightsNarratorSection.on("change:onChange",_classPrivateFieldLooseBase(this,h)[h],this)}function v(){this.insightsNarrator.off("change:pin",_classPrivateFieldLooseBase(this,u)[u],this),this.insightsNarrator.off("change:unPin",_classPrivateFieldLooseBase(this,l)[l],this),this.insightsNarrator.off("change:reOrderPinned",_classPrivateFieldLooseBase(this,d)[d],this),this.insightsIndicator.off("change:onClick",_classPrivateFieldLooseBase(this,p)[p],this),this.insightsNarratorSection.off("change:onChange",_classPrivateFieldLooseBase(this,h)[h],this)}function I(t,e,n){void 0===e&&(e="Updated Object"),void 0===n&&(n="narrativeInsight"),this.features.LiveWidgetSegment.track({eventType:e,category:"narrativeInsight",visualization:this.features["Visualization.internal"],info:_extends({},t,{objectType:n})})}function _(e){var n=_classPrivateFieldLooseBase(this,f)[f](e.info.value);_classPrivateFieldLooseBase(this,c)[c]({objectId:n.insight.secure_id,process:t,"custom.insightLevel":n.insight.level,"custom.insightType":n.insight.insight_type,"custom.addedToFavoriteInsights":!0,"custom.favoriteInsightsOrder":n.pinIndex})}function b(t){var n=_classPrivateFieldLooseBase(this,f)[f](t.info.value);_classPrivateFieldLooseBase(this,c)[c]({objectId:n.insight.secure_id,process:e,"custom.insightLevel":n.insight.level,"custom.insightType":n.insight.insight_type,"custom.addedToFavoriteInsights":!1,"custom.favoriteInsightsOrder":n.pinIndex})}function y(t){var e=_classPrivateFieldLooseBase(this,g)[g](t.info.value[0]);_classPrivateFieldLooseBase(this,c)[c]({objectId:e.insight.secure_id,process:n,"custom.insightLevel":e.insight.level,"custom.insightType":e.insight.insight_type,"custom.addedToFavoriteInsights":!1,"custom.favoriteInsightsOrder":e.pinIndex});var i=_classPrivateFieldLooseBase(this,g)[g](t.info.value[1]);_classPrivateFieldLooseBase(this,c)[c]({objectId:i.insight.secure_id,process:n,"custom.insightLevel":i.insight.level,"custom.insightType":i.insight.insight_type,"custom.addedToFavoriteInsights":!1,"custom.favoriteInsightsOrder":i.pinIndex})}function S(){_classPrivateFieldLooseBase(this,c)[c]({process:i},"Ran Process","narrativeInsightList")}function C(t){t.info.isExternalEvent||_classPrivateFieldLooseBase(this,c)[c]({process:t.info.value?r:o},"Ran Process","narrativeInsightList")}function P(t){return{pinIndex:this.insightsNarrator.getPinIdList().indexOf(t),insight:this.insightsNarrator.getCurrentInsights().insights.find((function(e){return e.id===t}))}}function A(t){var e=this.insightsNarrator.getPinIdList()[t];return{pinIndex:t,insight:this.insightsNarrator.getCurrentInsights().insights.find((function(t){return t.id===e}))}}return function(){function t(t){var e=t.features;Object.defineProperty(this,g,{value:A}),Object.defineProperty(this,f,{value:P}),Object.defineProperty(this,h,{value:C}),Object.defineProperty(this,p,{value:S}),Object.defineProperty(this,d,{value:y}),Object.defineProperty(this,l,{value:b}),Object.defineProperty(this,u,{value:_}),Object.defineProperty(this,c,{value:I}),Object.defineProperty(this,s,{value:v}),Object.defineProperty(this,a,{value:m}),this.insightsNarrator=e.InsightsNarrator,this.insightsIndicator=e.InsightsIndicator,this.insightsNarratorSection=e.InsightsNarratorSection,this.features=e,_classPrivateFieldLooseBase(this,a)[a]()}return t.prototype.destroy=function(){_classPrivateFieldLooseBase(this,s)[s](),this.insightsNarrator=null,this.insightsNarratorSection=null,this.features=null},t}()})),define("@dashboard-features/predictQuery/js/possibleKeyDriverAction/PossibleKeyDriverAction",["@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/slotActions/api/SlotActionsProviderAPI"],(function(t,e,n){return function(){function i(t){var e=t.content,n=t.dashboardAPI,i=t.features;this.features=i,this.content=e,this.dashboard=n,i.SlotActions.registerProvider("possibleKeyDriverAction",this.getAPI())}var r=i.prototype;return r.getAPI=function(){return this._api||(this._api=e.createAPI(this,[n])),this._api},r._isActionSupported=function(t){if(!this._isFocusModeEnabled())return!1;var e=t.getDefinition().getProperty("actions");return!!e&&-1!==e.indexOf("PossibleKeyDriverAction")},r._isFocusModeEnabled=function(){return!this.dashboard.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","FocusMode","disabled")},r._getVisKeyDrivers=function(){return this.features.VisKeyDrivers},r.getSlotActionList=function(e,n){var i=this._getVisualization().getSlots().getSlot(e),r=this._getVisKeyDrivers(),o=r&&r.getPossibleKeyDriversErrorState();r||(this._visAPI=this.content.getFeature("WidgetAPI.deprecated").getVisApi(),o=this._visAPI.getPossibleKeyDriversErrorState());var a=o.inErrorState?o.caption:t.get("toolbarActionPossibleKeyDrivers"),s=this.features["Dashboard.Icons"].getIcon("potentialDrivers");return i&&this._isActionSupported(i)?[{name:"possibleKeyDriver",id:"PossibleKeyDriverAction",text:t.get("toolbarActionPossibleKeyDrivers"),icon:s.id,label:a,type:"Button",removeOnActionApplied:!0,actions:{apply:this.openEditDriversDialog.bind(this,i,n)},group:"possibleKeyDriverAction",disabled:o.inErrorState}]:[]},r.openEditDriversDialog=function(e,n){var i=this;void 0===n&&(n=0);var r=e.getDataItemList()[n],o=this._getVisKeyDrivers().getKeyDriversScopingInfo(r),a=this._getVisualization().getDataSource();return this.dashboard.getFeature("DataSources.UI").pickItems({dataSourceId:a&&a.getId(),labels:{title:t.get("toolbarActionPossibleKeyDrivers"),subTitle:t.get("toolbarActionPossibleKeyDriversSubTitle")},initialFieldIds:o.initialFieldIds,recommendedFieldIds:o.recommendedFieldIds,max:250}).then((function(t){if(t&&t.length){var e=t.map((function(t){return{fieldIDForExpression:t.getId(),isDefaultRecommendation:-1!==o.recommendedFieldIds.indexOf(t.getId()),tableID:t.getTableId(),selected:!0}})),n=e.filter((function(t){return!1===t.isDefaultRecommendation})),a={recommendedDrivers:o.recommendedDrivers.map((function(t){var n=e.some((function(e){return t.fieldIDForExpression===e.fieldIDForExpression}));return _extends({},t,{selected:n})})),nonRecommendedDrivers:n};return i._getVisKeyDrivers().possibleKeyDriverSelectionStateChanged(r.getColumnId(),a)}}))},r.setToolbar=function(t){this.toolbar=t},r.remove=function(){this.toolbar&&this.toolbar.flyout&&this.toolbar.flyout.close()},r._getVisualization=function(){return this.visualization||(this.visualization=this.content.getFeature("Visualization")),this.visualization},i}()})),define("@dashboard-features/dataFilters/js/api/FiltersUIAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.addFilterContent=function(){},e.removeFilterContent=function(){},e.setPosition=function(){},e.getFilterContent=function(){},e.getFilterContentList=function(){},e.createFilterVisualization=function(){},t}()})),define("@dashboard-features/dataFilters/js/FiltersUIAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){var t=this;return this.apiSpec||(this.apiSpec={name:"Filters UI API",events:{propagationInfo:{namespace:"filtersUI",callStack:{name:"filtersUI"},info:{supportsUndoRedo:!0,refresh:{data:!0}}},actions:{addFilterContent:{eventName:"add",isResolvePostResponse:!0,transactionAPI:this.features["Dashboard.Transaction"],transactionParamIndex:2,autoCreateTransaction:!0,getAction:function(t,e){return{name:"addContent",params:[e.getFeature("Serializer").toJSON(),t[1]]}},getUndoActions:function(t,e){return[{name:"removeFilterContent",params:[e.getId()]}]}},removeFilterContent:{eventName:"remove",isResolvePostResponse:!1,transactionAPI:this.features["Dashboard.Transaction"],transactionParamIndex:1,autoCreateTransaction:!0,getUndoActions:function(e){var n=t.getFilterContent(e[0]).getFeature("Serializer"),i=t.getFilterContentList().findIndex((function(t){return t.getId()===e[0]}));return[{name:"addFilterContent",params:[n.toJSON(),i]}]}},setPosition:{eventName:"position",transactionAPI:this.features["Dashboard.Transaction"],transactionParamIndex:2,autoCreateTransaction:!0,getUndoActions:function(e){var n=t.getFilterContentList().findIndex((function(t){return t.getId()===e[0]}));return[{name:"setPosition",params:[e[0],n]}]}},createFilterVisualization:{eventName:"createFilterVisualization",transactionAPI:this.features["Dashboard.Transaction"],transactionParamIndex:1,autoCreateTransaction:!0}}}}),this.apiSpec},t}()})),define("@dashboard-features/dataFilters/js/FiltersUI",["@waca/dashboard-common/js/core/APIFactory","./api/FiltersUIAPI","./FiltersUIAPISpec"],(function(t,e,n){return function(n){function i(i){var r,o=i.features,a=i.spec,s=i.content;return(r=n.call(this)||this).content=s,r.spec=a,r.features=o,r.api=t.createAPI(_assertThisInitialized(r),[e]),r.contents=[],r.contentsMap={},r.featureChecker=r.features.API.getGlassCoreSvc(".FeatureChecker"),r}_inheritsLoose(i,n);var r=i.prototype;return r.initialize=function(){return this._loadChildren(this.spec&&this.spec.contents||[])},r.toJSON=function(){return this.contents.length?{contents:this.contents.map((function(t){return t.getFeature("Serializer").toJSON()}))}:void 0},r.getAPI=function(){return this.api},r.addFilterContent=function(t,e){return this._createContent(t||{type:"widget.live.filter",containerId:this.content.getId()},e)},r.removeFilterContent=function(t){var e=this.contents.findIndex((function(e){return e.getId()===t})),n=e>-1?this.contents.splice(e,1):null;n&&n.length&&(delete this.contentsMap[t],n[0].destroy())},r.setPosition=function(t,e){var n=this.getFilterContent(t);if(n&&e<this.contents.length){e<0&&(e=this.contents.length-1);var i=this.contents.findIndex((function(e){return e.getId()===t}));return this.contents.splice(e,0,this.contents.splice(i,1)[0]),n}},r.getFilterContent=function(t){return this.contentsMap[t]},r.getFilterContentList=function(){return this.contents.map((function(t){return t.getAPI()}))},r.createFilterVisualization=function(t,e){var n=this.getFilterContent(t,e),i=n&&n.getFeature("Visualization");return this._createFilterVis(i,e),i},r._createFilterVis=function(t,e){if(t){var n=t.getSlots(),i=n.getDataItemList().map((function(t){return t.getMetadataColumn()}));if(i&&i.length){var r=this._getFilterContentVisInfo(i[0]),o=n.getDataItemList().map((function(t){return t.getId()}));t.setType(r.type,e),t.getSlots().setDataItems(o,r.slotId,e)}}},r._getFilterContentVisInfo=function(t){var e="List",n="grid_cols";return"fact"===t.getType()?(e="RangeFilter",n="actual"):t.isDateTimeDataType()?(e="DateTimeFilter",n="filter"):t.isOlapColumn(),{type:e,slotId:n}},r._loadChildren=function(t){var e=this,n=[];return t&&t.length?n.push(t.map((function(t){return e._createContent(t)}))):this.featureChecker.checkValue("dashboard","DataFilters","enabled")&&n.push(this._recoverFilterContentsFromDataFilters()),Promise.all(n)},r._recoverFilterContentsFromDataFilters=function(){var t=this;return this.features.DataFilters.getFilterList({contentType:"self"}).map((function(e){var n={type:"widget.live.filter",containerId:t.content.getId()};return t._createContent(n).then((function(n){var i=n.getFeature("Visualization");i.setDataSource(e.getDataSource().getId()),i.getSlots().createDataItems(e.getColumnIdList().map((function(t){return{columnId:t}}))),t._createFilterVis(i)}))}))},r._createContent=function(e,n){var i=this;void 0===n&&(n=-1),e.type="widget.live.filter";var r=this.features["Dashboard.ContentFactory"];return r.addModel(e).then((function(e){var o=r.createContent(e);return t.setParentChildRelation(i,o),n<0&&(n=i.contents.length),i.contents.splice(n,0,o),i.contentsMap[e.id]=o,o.initialize().then((function(){return o.getAPI()}))}))},i}(n)})),define("@dashboard-features/consumeProfileBundle",(function(){}));