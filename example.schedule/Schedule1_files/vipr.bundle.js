/*
 *@license
 * Licensed Materials - Property of IBM
 *
 * IBM @vida/vipr
 *
 * (C) Copyright IBM Corp. 2023
 *
 * US Government Users Restricted Rights - Use, duplication or
 * disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
 */
define(["require","exports"],(function(e,t){"use strict";function r(e){var t=Object.create(null);return e&&Object.keys(e).forEach((function(r){if("default"!==r){var n=Object.getOwnPropertyDescriptor(e,r);Object.defineProperty(t,r,n.get?n:{enumerable:!0,get:function(){return e[r]}})}})),t.default=e,Object.freeze(t)}var n;t.EncodingType=void 0,(n=t.EncodingType||(t.EncodingType={})).Cat="cat",n.Cont="cont",n.Custom="custom";const s=/^(?:custom|cat|cont)$/;var i;!function(e){function t(e){return function(e){return"string"==typeof e&&s.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid EncodingType: ${e}`);return r}}(t.EncodingType||(t.EncodingType={})),t.FontStyle=void 0,(i=t.FontStyle||(t.FontStyle={})).Normal="normal",i.Italic="italic";const o=/^(?:normal|italic)$/;function a(e){return"string"==typeof e&&o.test(e)}var l;!function(e){function t(t){if("string"!=typeof t)return null;switch(t.toLowerCase()){case"normal":return e.Normal;case"oblique":case"italic":return e.Italic;default:return null}}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid FontStyle: ${e}`);return r},e.toCssString=function(e){return a(e)?e:""}}(t.FontStyle||(t.FontStyle={})),t.FontWeight=void 0,(l=t.FontWeight||(t.FontWeight={}))[l.Thin=100]="Thin",l[l.ExtraLight=200]="ExtraLight",l[l.Light=300]="Light",l[l.Normal=400]="Normal",l[l.Medium=500]="Medium",l[l.SemiBold=600]="SemiBold",l[l.Bold=700]="Bold",l[l.ExtraBold=800]="ExtraBold",l[l.Heavy=900]="Heavy",function(e){function t(t){if("string"!=typeof t)return null;switch(t.toLowerCase()){case"100":return e.Thin;case"200":return e.ExtraLight;case"300":return e.Light;case"400":case"normal":return e.Normal;case"500":return e.Medium;case"600":return e.SemiBold;case"700":case"bold":return e.Bold;case"800":return e.ExtraBold;case"900":return e.Heavy;default:return null}}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid FontWeight: ${e}`);return r},e.fromValue=function(e){switch(e){case 100:case 200:case 300:case 400:case 500:case 600:case 700:case 800:case 900:return e;default:return null}},e.toCssString=function(e){switch(e){case 400:return"normal";case 700:return"bold";case 100:case 200:case 300:case 500:case 600:case 800:case 900:return String(e);default:return""}}}(t.FontWeight||(t.FontWeight={})),t.HittableType=void 0,(t.HittableType||(t.HittableType={})).Data="data";const u=/^(?:data)$/;var c;!function(e){function t(e){return function(e){return"string"==typeof e&&u.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid HittableType: ${e}`);return r}}(t.HittableType||(t.HittableType={})),t.LengthUnit=void 0,(c=t.LengthUnit||(t.LengthUnit={})).Em="em",c.Percentage="%",c.Centimeter="cm",c.Millimeter="mm",c.Inch="in",c.Pica="pc",c.Point="pt",c.Pixel="px";const p=/^(?:[ecm]m|p[ctx]|in|%)$/;function h(e){return"string"==typeof e&&p.test(e)}var d,f;!function(e){function t(e){return h(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid LengthUnit: ${e}`);return r}}(t.LengthUnit||(t.LengthUnit={})),t.LogLevel=void 0,(d=t.LogLevel||(t.LogLevel={}))[d.error=2]="error",d[d.warn=3]="warn",d[d.info=4]="info",d[d.log=5]="log",d[d.debug=6]="debug",t.PaletteType=void 0,(f=t.PaletteType||(t.PaletteType={})).Cat="cat",f.Cont="cont",f.CustomCont="customcont",f.CustomCat="customcat";const g=/^(?:custom)?(?:cat|cont)$/;function m(e,t,r){return+(t<e?e:t>r?r:t)}!function(e){function t(e){return function(e){return"string"==typeof e&&g.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid PaletteType: ${e}`);return r}}(t.PaletteType||(t.PaletteType={}));const y="",v=Object.freeze(new Array(0)),b=Object.freeze(new Map);function w(e){return null==e}function _(e){return w(e)?y:String(e)}var P;t.RenderStatus=void 0,(P=t.RenderStatus||(t.RenderStatus={})).Pending="pending",P.Rendering="rendering",P.Animating="animating",P.Blocked="blocked",P.Paused="paused",P.Complete="complete",P.Failed="failed",P.Aborted="aborted",P.Timeout="timeout";const C=/^(?:pending|rendering|animating|blocked|paused|complete|failed|aborted|timeout)$/;function S(e){return"string"==typeof e&&C.test(e)}!function(e){function t(e){return S(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid RenderStatus: ${e}`);return r}}(t.RenderStatus||(t.RenderStatus={}));class RenderMessage{constructor(e,t,r,n,s,i){if(!S(e))throw new TypeError(`Invalid _status: ${e}`);Object.defineProperties(this,{status:{enumerable:!0,value:e},progress:{enumerable:!0,value:m(0,+t,1)},id:{enumerable:!0,value:_(r)},message:{enumerable:!0,value:_(n)},data:{enumerable:!0,value:void 0===s?null:s},obsolete:{enumerable:!0,value:!!i}})}get completed(){return this.status===t.RenderStatus.Complete}get failed(){return this.status===t.RenderStatus.Failed||this.status===t.RenderStatus.Aborted||this.status===t.RenderStatus.Timeout}makeObsolete(e){const t=!1!==e;return this.obsolete===t?this:new RenderMessage(this.status,this.progress,this.id,this.message,this.data,t)}toString(){return this.message}valueOf(){return this.id}}var x;t.ResourceType=void 0,(x=t.ResourceType||(t.ResourceType={})).Css="text/css",x.Html="text/html",x.Java="application/java",x.JavaScript="text/javascript",x.Json="application/json",x.Nls="text/x.nls",x.Svg="image/svg+xml",x.Text="text/plain",x.Xml="text/xml",x.Raw="application/octet-stream",function(e){e.parse=function(t){if(!t)return null;switch(t.toLowerCase()){case"css":case"text/css":return e.Css;case"html":case"text/html":return e.Html;case"java":case"application/java":return e.Java;case"js":case"javascript":case"text/javascript":return e.JavaScript;case"json":case"application/json":return e.Json;case"nls":case"i18n":case"text/x.nls":return e.Nls;case"svg":case"image/svg+xml":return e.Svg;case"txt":case"text":case"text/plain":return e.Text;case"xml":case"text/xml":return e.Xml;case"raw":case"application/octet-stream":return e.Raw;default:return null}}}(t.ResourceType||(t.ResourceType={}));const D=/^(?:error|warn|info)$/;var T,I;t.Severity=void 0,(T=t.Severity||(t.Severity={})).Error="error",T.Warning="warn",T.Info="info",function(e){function t(e){return"string"==typeof(t=e)&&D.test(t)?e:null;var t}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid Severity: ${e}`);return r}}(t.Severity||(t.Severity={})),t.DataItemType=void 0,(I=t.DataItemType||(t.DataItemType={})).Cat="cat",I.Cont="cont";const O=/^(?:cat|cont)$/;function R(e){return"string"==typeof e&&O.test(e)}var E;!function(e){function t(e){return R(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid DataItemType: ${e}`);return r}}(t.DataItemType||(t.DataItemType={})),t.FormatKind=void 0,(E=t.FormatKind||(t.FormatKind={})).Data="data",E.Label="label";const j=/^(?:data|label)$/;function V(e){return"string"==typeof e&&j.test(e)}var k;!function(e){function t(e){return V(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid FormatKind: ${e}`);return r}}(t.FormatKind||(t.FormatKind={})),t.ValueType=void 0,(k=t.ValueType||(t.ValueType={})).Missing="missing",k.Numeric="numeric";const A=/^(?:missing|numeric)$/;var L;!function(e){function t(e){return function(e){return"string"==typeof e&&A.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid ValueType: ${e}`);return r}}(t.ValueType||(t.ValueType={})),t.InfoType=void 0,(L=t.InfoType||(t.InfoType={})).VIPRData="viprdata",L.DataSet="dataset",L.Slot="slot",L.DataItem="dataitem",L.ItemClassSet="itemclassset",L.ItemClass="itemclass",L.Tuple="tuple",L.Item="item",L.DataPoint="datapoint",L.Value="value",L.CustomData="customdata";const z=/^(?:slot|(?:custom|vipr)data|data(?:set|item|point)|item(?:class(?:set)?)?|tuple|value)$/;!function(e){function t(e){return function(e){return"string"==typeof e&&z.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid InfoType: ${e}`);return r}}(t.InfoType||(t.InfoType={}));class VisualItemInfo{constructor(e){Object.defineProperties(this,{payload:{enumerable:!0,value:e}})}get type(){return this.getType()}get id(){return this.getId()}getId(){return this.payload.getId()}getPayload(){return this.payload}equals(e){const t="getId"in e&&e.getId()||e.id,r="getType"in e&&e.getType()||e.type,n="getPayload"in e&&e.getPayload()||e.payload;return this===e||this.infoType===e.infoType&&this.getId()===t&&this.getType()===r&&this.getPayload()===n}getSource(){return null}getInfoType(){return t.InfoType.CustomData}getHittableType(){return t.HittableType.Data}getType(){return"visualItem"}getRSHittableType(){return"visualItem"}}Object.defineProperties(VisualItemInfo.prototype,{infoType:{enumerable:!0,value:t.InfoType.CustomData},source:{enumerable:!0,value:null}});class Truncation{constructor(e,t){Object.defineProperties(this,{type:{enumerable:!0,value:e},message:{enumerable:!0,value:t}})}toString(){return this.message}}var N;t.TruncationType=void 0,(N=t.TruncationType||(t.TruncationType={})).Limit="limit",N.Unaggregated="unaggregated";class LimitTruncation extends Truncation{constructor(e,r,n,s,i,o){super(t.TruncationType.Limit,e),Object.defineProperties(this,{capability:{enumerable:!0,value:r},limit:{enumerable:!0,value:n},full:{enumerable:!0,value:s},slotRef:{enumerable:!0,value:i},dataItem:{enumerable:!0,value:o},next:{enumerable:!0,writable:!0,value:null}})}}Object.defineProperties(LimitTruncation.prototype,{slotDef:{get:function(){return this.slotRef}}});let M=0;class TruncationInfo{constructor(e,t){Object.defineProperties(this,{id:{enumerable:!0,value:String(M++)},message:{enumerable:!0,value:e},truncations:{enumerable:!0,value:t}})}toString(){return this.message}}class UnaggregatedTruncation extends Truncation{constructor(e){super(t.TruncationType.Unaggregated,e)}}function F(e){return"object"==typeof e&&null!==e&&"getRed"in e&&"getGreen"in e&&"getBlue"in e&&"getAlpha"in e}function $(e){return"object"==typeof e&&null!==e&&"r"in e&&"g"in e&&"b"in e}function q(e,t){const r=void 0===e?Number.NaN:null===e||e.length<1?null:Number.parseFloat(e);if(Number.isNaN(r)){if(void 0===t)throw new Error(`Failed to parse ${e} to number`);return t}return r}const B=/^\s*#([0-9a-fA-F]{3,4}|[0-9a-fA-F]{6}|[0-9a-fA-F]{8})\s*$/,H=/^\s*rgba?\s*\(\s*(\d+\%?)\s*,\s*(\d+\%?)\s*,\s*(\d+\%?)\s*(?:,\s*(\d+(?:\.\d+)?\%?)\s*)?\)\s*$/,G=/^\s*hsla?\s*\(\s*([+\-]?(?=\d|\.\d+)\d*(?:\.\d+)?)(deg|g?rad|turn)?\s*,\s*((?=\d|\.\d+)\d*(?:\.\d+)?\%?)\s*,\s*((?=\d|\.\d+)\d*(?:\.\d+)?\%?)\s*(?:,\s*((?=\d|\.\d+)\d*(?:\.\d+)?\%?)\s*)?\)\s*$/;function U(e){return m(0,+e||0,1)}function W(e){return m(0,Math.floor(e)||0,255)}function K(e){return W(255*e)}function X(e){const t=e.indexOf("%",e.length-1)>=0;let r=q(t?e.substring(0,e.length-1):e,0);return t&&(r/=100),U(r)}function J(e){return e.indexOf("%",e.length-1)>=0?K(X(e)):W(q(e,0))}function Q(e,t,r,n){const s=(n+e/30)%12;return r-t*Math.max(Math.min(s-3,9-s,1),-1)}function Y(e,t,r,n=1){return new Color((s=W(e),i=W(t),o=W(r),s<<16|i<<8|o),U(n));var s,i,o}function Z(e,t,r,n=1){return new Color(function(e,t,r){const n=t*Math.min(r,1-r);return K(Q(e,n,r,0))<<16|K(Q(e,n,r,8))<<8|K(Q(e,n,r,4))}(e,t,r),U(n))}class Color{constructor(e,t=1){Object.defineProperties(this,{_argb:{value:e|K(t)<<24},a:{enumerable:!0,value:t}})}static fromHost(e){return e?e instanceof Color?e:Y(e.getRed(),e.getGreen(),e.getBlue(),e.getAlpha()):null}static fromString(e){if(!e||!e.length)return null;const t=ee[e.toLowerCase()];if(t)return t;let r;if(r=B.exec(e)){const e=r[1];let t=0,n=255;switch(e.length){case 8:n=parseInt(e.substring(6,8),16);case 6:t=parseInt(e.substring(0,6),16);break;case 4:n=parseInt(e.substring(3,4),16),n|=n<<4;case 3:t=parseInt(e.substring(0,3),16),t=(3840&t)<<8|(240&t)<<4|15&t,t|=t<<4}return new Color(t,U(n/255))}if(r=H.exec(e))return Y(J(r[1]),J(r[2]),J(r[3]),r[4]?X(r[4]):1);if(r=G.exec(e)){let e=parseFloat(r[1]);switch(r[2]||"deg"){case"deg":break;case"rad":e=180*e/Math.PI;break;case"grad":e=360*e/400;break;case"turn":e*=360;break;default:throw new Error(`Unhandled unit: ${r[2]}`)}return Z(e,X(r[3]),X(r[4]),r[5]?X(r[5]):1)}return null}static fromObject(e){if(e){if(e instanceof Color)return e;if($(e))return Y(e.r,e.g,e.b,e.a)}return null}static toObject(e){if(!F(e))throw new TypeError("Color is invalid");return{r:e.getRed(),g:e.getGreen(),b:e.getBlue(),a:e.getAlpha()}}static interpolate(e,t,r){if(!(e&&t&&F(e)&&F(t)))throw new TypeError("One of the colors is invalid");if(r<=0)return e;if(r>=1)return t;const n=t.getRed()-e.getRed(),s=t.getGreen()-e.getGreen(),i=t.getBlue()-e.getBlue(),o=t.getAlpha()-e.getAlpha();return Y(Math.round(e.getRed()+n*r),Math.round(e.getGreen()+s*r),Math.round(e.getBlue()+i*r),e.getAlpha()+o*r)}get r(){return this.getRed()}get g(){return this.getGreen()}get b(){return this.getBlue()}equals(e){return e===this||!!e&&(e instanceof Color?this._argb===e._argb&&this.a===e.a:!!F(e)&&(this.getRed()===e.getRed()&&this.getGreen()===e.getGreen()&&this.getBlue()===e.getBlue()&&this.a===e.getAlpha()))}getRed(){return this._argb>>>16&255}getGreen(){return this._argb>>>8&255}getBlue(){return 255&this._argb}getAlpha(){return this.a}toString(){if(0===this._argb)return"transparent";if(1===this.a){const e=(16777215&this._argb).toString(16);return"#00000".substring(0,7-e.length)+e}return`rgba(${this.getRed()}, ${this.getGreen()}, ${this.getBlue()}, ${this.a})`}}const ee=Object.freeze({transparent:new Color(0,0),black:new Color(0),navy:new Color(128),darkblue:new Color(139),mediumblue:new Color(205),blue:new Color(255),darkgreen:new Color(25600),green:new Color(32768),teal:new Color(32896),darkcyan:new Color(35723),deepskyblue:new Color(49151),darkturquoise:new Color(52945),mediumspringgreen:new Color(64154),lime:new Color(65280),springgreen:new Color(65407),aqua:new Color(65535),cyan:new Color(65535),midnightblue:new Color(1644912),dodgerblue:new Color(2003199),lightseagreen:new Color(2142890),forestgreen:new Color(2263842),seagreen:new Color(3050327),darkslategray:new Color(3100495),darkslategrey:new Color(3100495),limegreen:new Color(3329330),mediumseagreen:new Color(3978097),turquoise:new Color(4251856),royalblue:new Color(4286945),steelblue:new Color(4620980),darkslateblue:new Color(4734347),mediumturquoise:new Color(4772300),indigo:new Color(4915330),darkolivegreen:new Color(5597999),cadetblue:new Color(6266528),cornflowerblue:new Color(6591981),mediumaquamarine:new Color(6737322),dimgray:new Color(6908265),dimgrey:new Color(6908265),slateblue:new Color(6970061),olivedrab:new Color(7048739),slategray:new Color(7372944),slategrey:new Color(7372944),lightslategray:new Color(7833753),lightslategrey:new Color(7833753),mediumslateblue:new Color(8087790),lawngreen:new Color(8190976),chartreuse:new Color(8388352),aquamarine:new Color(8388564),maroon:new Color(8388608),purple:new Color(8388736),olive:new Color(8421376),gray:new Color(8421504),grey:new Color(8421504),skyblue:new Color(8900331),lightskyblue:new Color(8900346),blueviolet:new Color(9055202),darkred:new Color(9109504),darkmagenta:new Color(9109643),saddlebrown:new Color(9127187),darkseagreen:new Color(9419919),lightgreen:new Color(9498256),mediumpurple:new Color(9662680),darkviolet:new Color(9699539),palegreen:new Color(10025880),darkorchid:new Color(10040012),yellowgreen:new Color(10145074),sienna:new Color(10506797),brown:new Color(10824234),darkgray:new Color(11119017),darkgrey:new Color(11119017),lightblue:new Color(11393254),greenyellow:new Color(11403055),paleturquoise:new Color(11529966),lightsteelblue:new Color(11584734),powderblue:new Color(11591910),firebrick:new Color(11674146),darkgoldenrod:new Color(12092939),mediumorchid:new Color(12211667),rosybrown:new Color(12357519),darkkhaki:new Color(12433259),silver:new Color(12632256),mediumvioletred:new Color(13047173),indianred:new Color(13458524),peru:new Color(13468991),chocolate:new Color(13789470),tan:new Color(13808780),lightgray:new Color(13882323),lightgrey:new Color(13882323),palevioletred:new Color(14184595),thistle:new Color(14204888),orchid:new Color(14315734),goldenrod:new Color(14329120),crimson:new Color(14423100),gainsboro:new Color(14474460),plum:new Color(14524637),burlywood:new Color(14596231),lightcyan:new Color(14745599),lavender:new Color(15132410),darksalmon:new Color(15308410),violet:new Color(15631086),palegoldenrod:new Color(15657130),lightcoral:new Color(15761536),khaki:new Color(15787660),aliceblue:new Color(15792383),honeydew:new Color(15794160),azure:new Color(15794175),sandybrown:new Color(16032864),wheat:new Color(16113331),beige:new Color(16119260),whitesmoke:new Color(16119285),mintcream:new Color(16121850),ghostwhite:new Color(16316671),salmon:new Color(16416882),antiquewhite:new Color(16444375),linen:new Color(16445670),lightgoldenrodyellow:new Color(16448210),oldlace:new Color(16643558),red:new Color(16711680),fuchsia:new Color(16711935),magenta:new Color(16711935),deeppink:new Color(16716947),orangered:new Color(16729344),tomato:new Color(16737095),hotpink:new Color(16738740),coral:new Color(16744272),darkorange:new Color(16747520),lightsalmon:new Color(16752762),orange:new Color(16753920),lightpink:new Color(16758465),pink:new Color(16761035),gold:new Color(16766720),peachpuff:new Color(16767673),navajowhite:new Color(16768685),moccasin:new Color(16770229),bisque:new Color(16770244),mistyrose:new Color(16770273),blanchedalmond:new Color(16772045),papayawhip:new Color(16773077),lavenderblush:new Color(16773365),seashell:new Color(16774638),cornsilk:new Color(16775388),lemonchiffon:new Color(16775885),floralwhite:new Color(16775920),snow:new Color(16775930),yellow:new Color(16776960),lightyellow:new Color(16777184),ivory:new Color(16777200),white:new Color(16777215)});Object.defineProperties(Color,{rgb:{enumerable:!0,value:Y},rgba:{enumerable:!0,value:Y},hsl:{enumerable:!0,value:Z},hsla:{enumerable:!0,value:Z},Named:{enumerable:!0,value:ee}});const te=/\s*;\s*/;class PaletteBase{constructor(e){Object.defineProperties(this,{source:{enumerable:!0,value:e}})}static split(e){return e.trim().split(te)}static mapColor(e,t){let r=null;if("string"==typeof e?r=Color.fromString(e):e instanceof Color||F(e)?r=Color.fromHost(e):$(e)&&(r=Color.fromObject(e)),null===r)throw new TypeError(`Invalid Color "${e}" at index ${t}`);return r}getSource(){return this.source}toString(){return null!==this.source?this.source:this._serialize()}}function re(e){const t=e?Object.freeze(Array.from(e,PaletteBase.mapColor,PaletteBase)):v;if(t.length<1)throw new Error("A Categorical Palette requires at least 1 color");return t}class CatPaletteBase extends PaletteBase{constructor(e){super("string"==typeof e?e:null),Object.defineProperties(this,{colors:{enumerable:!0,value:re("string"==typeof e?PaletteBase.split(e):e)}})}_getColorAt(e){let t=e%this.colors.length;return t<0&&(t+=this.colors.length),this.colors[t]}getColors(){return this.colors}_serialize(){return this.colors.join(";")}}const ne=new WeakMap;class CatPaletteResolver extends CatPaletteBase{constructor(e,t=0){super(e),Object.defineProperties(this,{defaultIndex:{enumerable:!0,value:Math.floor(t)||0}})}getColor(e,t,r){if(!e||!t||!t.isMapped())return this.getDefaultColor(null);let n;if(r<0)n=e.getIndex();else{const s=e.getItemInfos();if(r>=s.length)return this.getDefaultColor(null);n=function(e,t,r){let n=ne.get(e);n||ne.set(e,n=[]);let s=n[r];if(!s){s=n[r]=[];for(let t=e.getTupleInfos(),n=0,i=t.length;n<i;++n){const e=t[n].getItemInfos()[r];if(e){const t=e.getUniqueName();s.indexOf(t)<0&&s.push(t)}}}return s}(t,0,r).indexOf(s[r].getUniqueName())}return this._getColorAt(n)}getDefaultColor(e){return this._getColorAt(this.defaultIndex)}getSingleColor(e){return this._getColorAt(this.defaultIndex+e)}}function se(e){return"object"==typeof e&&null!==e&&"getColor"in e&&"getAt"in e&&"getValue"in e}const ie=/\s+(-?(?:\d*\.\d+|\d+))(%)?\s*$/;class ColorStop{constructor(e,t,r){Object.defineProperties(this,{color:{enumerable:!0,value:e},at:{enumerable:!0,value:t},value:{enumerable:!0,value:r}})}static fromString(e){if(!e||!e.length)return null;let t,r=null,n=null;const s=ie.exec(e);if(s){const i=s[1],o=s[2];t=Color.fromString(e.substring(0,e.length-s[0].length));try{const e=q(i);null!==e&&(o?r=e/100:n=e)}catch(t){throw new Error(`Invalid value for stop definition: ${e}`)}}else t=Color.fromString(e);return new ColorStop(t,r,n)}static createImplicit(e){return new ColorStop(Color.fromHost(e),null,null)}static createAbsolute(e,t){return new ColorStop(Color.fromHost(e),null,t)}static createRelative(e,t){return new ColorStop(Color.fromHost(e),t,null)}static create(e,t,r){return new ColorStop(Color.fromHost(e),t,r)}static isImplicit(e){return null===e.getAt()&&null===e.getValue()}static fromHost(e){if(e){if(e instanceof ColorStop)return e;if(se(e))return new ColorStop(Color.fromHost(e.getColor()),e.getAt(),e.getValue())}return null}getColor(){return this.color}getAt(){return this.at}getValue(){return this.value}toString(){let e=this.color?this.color.toString():"transparent";return null!==this.at?e+=` ${100*this.at}%`:null!==this.value&&(e+=` ${this.value}`),e}}const oe=/\s*(?:at\s+|@)([^\r\n]+)/;class ConsoleAppender{constructor(){Object.defineProperties(this,{_level:{writable:!0,value:this._level}})}get level(){return this._level}set level(e){this.setLevel(e)}setLevel(e){const r=function(e){switch(e){case 2:case"2":case"error":return t.LogLevel.error;case 3:case"3":case"warn":return t.LogLevel.warn;case 4:case"4":case"info":return t.LogLevel.info;case 5:case"5":case"log":return t.LogLevel.log;case 6:case"6":case"debug":return t.LogLevel.debug;default:return null}}(e);return null!==r&&(this._level=r),this._level}accept(e,t){return"undefined"!=typeof console&&e<=this.level}log(e){const r=console[function(e){switch(e){case t.LogLevel.error:return"error";case t.LogLevel.warn:return"warn";case t.LogLevel.info:return"info";case t.LogLevel.log:return"log";case t.LogLevel.debug:return"debug"}}(e.level)]||console.log;console.group&&console.group(e.context);let n=e.message;if(e instanceof Error&&"stack"in e){const t=function(e,t){let r=null,n=t;if(n){const t=n.indexOf(e);t>=0&&(n=n.substr(t+e.length+1)),r=oe.exec(n)}return r&&r[1]||null}(e.message,e.stack);t&&(n=`${n}\n\tat ${t}`)}r.call(console,n),console.groupEnd&&console.groupEnd()}}class ContPaletteStops{constructor(e,t){Object.defineProperties(this,{stops:{enumerable:!0,value:e},interpolate:{enumerable:!0,value:t}})}getStops(){return this.stops}mustInterpolate(){return this.interpolate}toString(){return this.stops.join(";")}}const ae=/^(?:(\w+):)?([^|]+)(\|)?(?:(\w+):)?(.*)$/;class ContPaletteBase extends PaletteBase{constructor(e,t,r=!0,n=!0){super("string"==typeof e&&w(t)&&r&&n?e:null);let s=e,i=t,o=r,a=n;if(null!==this.source&&"string"==typeof e){const t=ae.exec(e);if(null!==t){if(s=t[2],t[1])switch(t[1]){case"interpolate":o=!0;break;case"discrete":o=!1;break;default:throw new Error("Invalid interpolation")}if(t[3]){if(t[4])switch(t[4]){case"equalize":a=!0;break;case"exact":a=!1;break;default:throw new Error("Invalid equalization")}i=t[5]}}}"string"==typeof s&&(s=PaletteBase.split(s)),"string"==typeof i&&(i=PaletteBase.split(i));const l=w(s)?v:ContPaletteBase.parseStops(s,!1),u=w(i)?v:ContPaletteBase.parseStops(i,!0),c=l.length>0?l:ContPaletteBase.sliceDivergent(u,!1),p=l.length>0?l:ContPaletteBase.sliceDivergent(u,!0);if(Object.defineProperties(this,{linear:{enumerable:!0,value:l},divergent:{enumerable:!0,value:u},interpolate:{enumerable:!0,value:!1!==o},equalize:{enumerable:!0,value:!ContPaletteBase.isAbsolute(u)&&!1!==a},_lowStops:{value:c},_highStops:{value:p},_midPoint:{value:ContPaletteBase.calculateMidPoint(u)}}),this.linear.length<1&&this.divergent.length<1)throw new Error("A Continuous Palette requires either linear or divergent stops")}static parseStops(e,t){if(!e)return v;const r=t?-1:0;let n=!1,s=!1,i=!1;const o=e.length||0;if(o<1)return v;const a=new Array(o);for(let t=0;t<o;++t){const o=e[t];let l=null;if("string"==typeof o)l=ColorStop.fromString(o);else if(o instanceof ColorStop||se(o))l=ColorStop.fromHost(o);else{let e=null;F(o)?e=Color.fromHost(o):$(o)&&(e=Color.fromObject(o)),l=ColorStop.createImplicit(e)}if(!l)throw new Error(`Invalid color stop definition: ${o}`);if(a[t]=l,null!==l.at){if(l.at<r||l.at>1)throw new RangeError(`Stop offset ${l.at} out of range (${r} - 1)`);s=!0,a[t]=ColorStop.createRelative(l.color,l.at)}else null!==l.value?(n=!0,a[t]=ColorStop.createAbsolute(l.color,l.value)):(i=!0,a[t]=ColorStop.createImplicit(l.color))}if(n&&s)throw new Error("Mixing absolute and relative stops is not supported");if(i){let e,t=1,s=r,i=null,l=null;if(e=a[o-1],!e.color)throw new Error("The last stop must define a color");if(n){if(t=e.value,null===t)throw new Error("The last value of an absolute palette cannot be implicit")}else null===e.at&&(a[o-1]=ColorStop.createRelative(e.color,t));let u=0,c=-1;if(e=a[0],!e.color)throw new Error("The first stop must define a color");if(n){if(s=e.value,null==s)throw new Error("The first value of an absolute palette cannot be implicit")}else null===e.at?a[0]=ColorStop.createRelative(e.color,s):s=e.at;for(let r=1;r<o;++r){if(e=a[r],l=e.color,!l){const e=a[r-1].color,t=r-1;let n=null,s=null;for(n=r+1;n<o&&(s=a[n].color,null===s);n++);l=Color.interpolate(e,s,(r-t)/(n-t)),a[r]=ColorStop.createImplicit(l)}if(e=a[r],i=n?e.value:e.at,null===i){if(c<=r)for(t=null,c=r+1;c<o&&(t=n?a[c].value:a[c].at,null===t);++c);i=s+(r-u)/(c-u)*(t-s),a[r]=n?ColorStop.createAbsolute(e.color,i):ColorStop.createRelative(e.color,i)}else s=i,u=r}}return Object.freeze(a)}static isAbsolute(e){return e.length>0&&null===e[0].at&&null!==e[0].value}static calculateMidPoint(e){let t=0;if(e.length>0&&null!==e[0].value){t=e[0].value;const r=e[e.length-1].getValue();null!==r&&(t=(r-t)/2+t)}return t}static sliceDivergent(e,t){if(ContPaletteBase.isAbsolute(e))return e;const r=e.length,n=new Array(Math.floor(r/2)+1);n.length=0;for(let s=0;s<r;++s){const r=e[s],i=r.at;null!==i&&(t?i>=0&&n.push(r):i<=0&&n.push(ColorStop.createRelative(r.color,i+1)))}return n}getStopsFor(e){let t=0,r=0,n=!1;e&&(t=e.getMin(),r=e.getMax(),n=this.divergent.length>0&&t<this._midPoint&&r>this._midPoint);const s=n?this.divergent:t<this._midPoint?this._lowStops:this._highStops;let i;const o=s.length;let a=this.interpolate;if(t>=r){const e=new Array(1);e[0]=s[Math.floor(o/2)],a=!1,i=Object.freeze(e)}else if(n&&!ContPaletteBase.isAbsolute(s)){const e=s.slice(0);let n=Math.abs(this._midPoint-t)||0,o=Math.abs(r-this._midPoint)||0;this.equalize&&(n<o?(n=o,t=this._midPoint-o):n>o&&(o=n,r=this._midPoint+n));for(let r=1;r<e.length-1;r++){const{at:s,color:i}=e[r];e[r]=new ColorStop(i,null,s<0?(s+1)*n+t:s*o+this._midPoint)}e[0]=new ColorStop(e[0].color,null,t),e[e.length-1]=new ColorStop(e[e.length-1].color,null,r),i=ContPaletteBase.parseStops(e,!1)}else i=s;return new ContPaletteStops(i,a)}getLinear(){return this.linear}getDivergent(){return this.divergent}_serialize(){let e=this.linear.join(";");return this.divergent.length>0&&(e=`${e}|${this.divergent.join(";")}`),e}}class ContPaletteResolver extends ContPaletteBase{constructor(e,t,r=!0,n=!0){super(e,t,r,n)}getColorStops(e,t){return this.getStopsFor(t)}}class CustomCatPaletteResolver extends CatPaletteBase{constructor(e){super(e)}getColor(e,t,r){return this._getColorAt(e)}}class CustomContPaletteResolver extends ContPaletteBase{constructor(e,t,r=!0,n=!0){super(e,t,r,n)}getColorStops(e){return this.getStopsFor(e)}}function le(e){return"object"==typeof e&&null!==e&&"getName"in e&&"getCaption"in e&&"getDescription"in e}class EnumValue{constructor(e,t,r){Object.defineProperties(this,{name:{enumerable:!0,value:e},_caption:{value:t},_description:{value:w(r)?null:r}})}get caption(){return"function"==typeof this._caption?this._caption():this._caption}get description(){return"function"==typeof this._description?this._description():this._description}static fromHost(e){if(e){if(e instanceof EnumValue)return e;if(le(e))return new EnumValue(e.getName(),e.getCaption(),e.getDescription())}return null}getName(){return this.name}getCaption(){return this.caption}getDescription(){return this.description}toString(){return this.name}valueOf(){return this.name}equals(e){return this===e||(e instanceof EnumValue||le(e))&&this.name===e.getName()&&this.caption===e.getCaption()&&this.description===e.getDescription()}toJSON(){return{name:this.name,caption:this.caption,description:this.description}}}function ue(e){return"object"==typeof e&&null!==e&&"getValue"in e&&"getUnit"in e}function ce(e){return"object"==typeof e&&null!==e&&"value"in e&&"unit"in e}const pe=/^([\-\+]?(?:\d+(?:(?!\r?\n)[\s,]\d+)*(?:\.\d+)?|\.\d+))(?:$|(?!\d|\.))(%|[a-zA-Z]+)?$/;class Length{constructor(e,t){if("number"!=typeof e)throw new TypeError("_value must be a number");if(!h(t))throw new TypeError(`Invalid length unit: ${t}`);Object.defineProperties(this,{value:{enumerable:!0,value:e},unit:{enumerable:!0,value:t}})}static fromHost(e){if(e){if(e instanceof Length)return e;if(ue(e))return new Length(e.getValue(),e.getUnit())}return null}static fromObject(e){if(e){if(e instanceof Length)return e;if(ce(e))return new Length(e.value,e.unit)}return null}static parse(e){const r=e?pe.exec(e):null;if(r){const e=q(r[1],null),n=t.LengthUnit.tryParse(r[2]);if(null!==e&&(n||!r[2]))return new Length(e,n||t.LengthUnit.Pixel)}return null}getValue(){return this.value}getUnit(){return this.unit}getRSUnit(){return this.unit}toString(){return`${this.value}${this.unit}`}equals(e){return this===e||e instanceof Length&&e.value===this.value&&e.unit===this.unit}}const he=/\s+/g,de=/\s*,\s*/,fe=/\s*;\s*/;function ge(e){let t=null,r=0;if(e&&(t=String(e).trim(),r=t.length,r>1)){const e=t.charAt(0);"'"!==e&&'"'!==e||e!==t.charAt(r-1)||(t=t.substring(1,r-1),r=t.length)}return r>0?t:null}function me(e){const r=e?e.length:0;if(r<1)return null;let n=null,s=null,i=null,o=null,a=0;he.lastIndex=0;for(let n,l=0,u=0;u<r;u=l){const c=he.exec(e);c?(l=he.lastIndex,n=l-c[0].length):l=n=r;const p=e.substring(u,n),h=t.FontStyle.tryParse(p);if(h){h===t.FontStyle.Normal?(i||(i=h),o||(o=t.FontWeight.Normal)):i=h,a=l;continue}const d=t.FontWeight.tryParse(p);if(d)o&&d===t.FontWeight.Normal||(o=d),a=l;else if(s=Length.parse(p),s){a=l;break}}return n=Font.parseFamily(a<1?e:e.substring(a)),Font.create(n,s,i,o)}class Font{constructor(e,t,r,n){if(null!==e&&!Array.isArray(e))throw new TypeError("Font family must be an Array of String");if(!(null===t||t instanceof Length))throw new TypeError("Font size must be a Length instance");if(null!==r&&!a(r))throw new TypeError("Invalid FontStyle");if(null!==n&&!function(e){if("number"!=typeof e)return!1;switch(e){case 100:case 200:case 300:case 400:case 500:case 600:case 700:case 800:case 900:return!0;default:return!1}}(n))throw new TypeError("Invalid FontWeight");Object.defineProperties(this,{family:{enumerable:!0,value:e},size:{enumerable:!0,value:t},style:{enumerable:!0,value:r},weight:{enumerable:!0,value:n}})}static create(e,t,r,n){return e||t||r||n?new Font(e,t,r,n):null}static normalizeFamily(e){let t=null;if(e){const r=e.length;t=new Array(r);let n=0;for(let s=0;s<r;++s){const r=ge(e[s]);null!==r&&(t[n++]=r)}n<1?t=null:t.length>n&&(t.length=n),t&&Object.freeze(t)}return t}static parseFamily(e){let t=null;if(e){const r=String(e).split(de),n=r.length;t=new Array(n);let s=0;for(let e=0;e<n;++e){const n=ge(r[e]);null!==n&&(t[s++]=n)}s<1?t=null:t.length>s&&(t.length=s)}return t||(t=new Array(0)),Object.freeze(t)}static familyEqual(e,t){if(e===t)return!0;if(!e||!t)return!1;const r=e.length;if(r!==t.length)return!1;for(let n=0;n<r;++n){if(e[n]!==t[n])return!1}return!0}static familyToString(e){let t="";if(e)for(let r=0,n=e.length;r<n;++r){const n=e[r],s=he.test(n);t.length>0&&(t+=", "),s&&(t+='"'),t+=n,s&&(t+='"')}return t}static toCssString(e){const t=[];let r=Font.familyToString(e.getFamily());return r.length>0&&t.push(`font-family: ${r};`),r=Font.sizeToString(e.getSize()),r.length>0&&t.push(`font-size: ${r};`),r=Font.styleToString(e.getStyle()),r.length>0&&t.push(`font-style: ${r};`),r=Font.weightToString(e.getWeight()),r.length>0&&t.push(`font-weight: ${r};`),t.join(" ")}static sizeToString(e){return e?`${e.getValue()}${e.getUnit()}`:""}static styleToString(e){return e?t.FontStyle.toCssString(e):""}static weightToString(e){return e?t.FontWeight.toCssString(e):""}static fromHost(e){if(e){if(e instanceof Font)return e;if("object"==typeof(t=e)&&null!==t&&"getFamily"in t&&"getSize"in t&&"getStyle"in t&&"getWeight"in t)return Font.create(Font.normalizeFamily(e.getFamily()),Length.fromHost(e.getSize()),e.getStyle(),e.getWeight())}var t;return null}static parse(e){if(!e||"string"!=typeof e)return null;let r=null,n=null,s=null,i=null;for(const o of e.trim().split(fe)){const e=o.indexOf(":");let a=null,l=null;if(e<0&&o.length>0?(a="font",l=o):e>0&&(a=o.substring(0,e),l=o.substring(e+1).trim()),null!==a&&null!==l)switch(a){case"font":const e=me(l);e&&(r=e.family,n=e.size,s=e.style,i=e.weight);break;case"font-size":n=Length.parse(l);break;case"font-family":r=Font.parseFamily(l);break;case"font-style":s=t.FontStyle.parse(l);break;case"font-weight":i=t.FontWeight.parse(l)}}return Font.create(r,n,s,i)}getFamily(){return this.family}getSize(){return this.size}getStyle(){return this.style}getWeight(){return this.weight}getRSStyle(){return this.style}getRSWeight(){return this.weight}toString(){let e;return this.style!==t.FontStyle.Normal&&this.weight!==t.FontWeight.Normal||this.style===t.FontStyle.Normal&&this.weight===t.FontWeight.Normal?(e="",this.style===t.FontStyle.Normal?e+="normal":(this.style&&(e+=this.style),this.weight&&(e.length>0&&(e+=" "),e+=t.FontWeight.toCssString(this.weight))),this.size&&(e.length>0&&(e+=" "),e+=this.size.toString()),this.family&&(e.length>0&&(e+=" "),e+=Font.familyToString(this.family))):e=Font.toCssString(this),e}equals(e){return e===this||e instanceof Font&&Font.familyEqual(this.family,e.family)&&(this.size===e.size||!!this.size&&this.size.equals(e.size))&&this.style===e.style&&this.weight===e.weight}}function ye(e){return"function"==typeof e||!!e&&"[object Function]"===Object.prototype.toString.call(e)}function ve(e,t){const r=e.lastIndexOf(t),n=e.length-1;return r>=0&&r<=n&&(r===n?e.length=n:0===r?e.shift():e.splice(r,1),!0)}const be=Object.prototype.hasOwnProperty,we="undefined"==typeof Symbol?"@@destroyed":Symbol("destroyed");class MetaData{constructor(){this.listeners=[],this.references=[],this.referenceHandlers=[]}}const _e=new WeakMap;function Pe(e){return"object"==typeof e&&!!e&&"destroy"in e}function Ce(e){Pe(e)&&e.destroy()}class OwnedHandle{constructor(e,t){Object.defineProperties(this,{_owner:{writable:!0,value:e},_ownerDL:{writable:!0,value:null},_target:{writable:!0,value:t},_targetDL:{writable:!0,value:null}}),e.addDestroyListener(this._ownerDL=this._ownerDestroyed.bind(this)),"addDestroyListener"in t&&t.addDestroyListener(this._targetDestroyed=this._targetDestroyed.bind(this))}_ownerDestroyed(){this._target&&(this._owner=null,this._targetDL&&("removeDestroyListener"in this._target&&this._target.removeDestroyListener(this._targetDL),this._targetDL=null),Ce(this._target),this._ownerDL=null,this._target=null)}_targetDestroyed(){this._owner&&(this._ownerDL&&this._owner.removeDestroyListener(this._ownerDL),this._owner=null,this._ownerDL=null,this._target=null,this._targetDL=null)}}function Se(e){if(!Pe(e))throw new TypeError("Cannot own; invalid value");if(e===this)throw new Error("An object cannot own itself");new OwnedHandle(this,e)}class Destroyable{static isDestroyed(e){return!!e&&be.call(e,we)}static destroyAll(e){if(e&&"object"==typeof e){if("forEach"in e)return void e.forEach(Ce);if("length"in e)return void Array.prototype.forEach.call(e,Ce)}throw new TypeError("_collection must either have a forEach method or a length property.")}destroy(){be.call(this,we)||(this._destroy(),Object.defineProperty(this,we,{value:!0}))}_destroy(){const e=function(e){const t=_e.get(e)||null;return t&&_e.delete(e),t}(this);if(e){if(e.listeners.length>0){for(let t=0,r=e.listeners.length;t<r;++t)e.listeners[t](this);e.listeners.length=0}if(e.references.length>0){for(let t=0,r=e.references.length;t<r;++t){const r=e.references[t],n=e.referenceHandlers[t];n&&this[r].removeDestroyListener(n),delete this[r]}e.references.length=0,e.referenceHandlers.length=0}}}addDestroyListener(e){if(!ye(e))throw new TypeError("_listener must be callable");return function(e){let t=_e.get(e);return t||_e.set(e,t=new MetaData),t}(this).listeners.push(e),e}removeDestroyListener(e){const t=_e.get(this);return!!t&&ve(t.listeners,e)}own(...e){e.forEach(Se,this)}}class EventArgs{constructor(e){const t="boolean"==typeof e?e:!0===this.cancelable;Object.defineProperties(this,{cancelable:{enumerable:!0,value:t},defaultPrevented:{configurable:t,enumerable:!0,value:!1}})}preventDefault(){!0!==this.cancelable||this.defaultPrevented||Object.defineProperty(this,"defaultPrevented",{enumerable:!0,value:!0})}}const xe=Object.freeze(new EventArgs),De=new WeakMap;class EventedHandle extends Destroyable{constructor(e,t,r){super(),De.set(this,e),Object.defineProperties(this,{eventName:{enumerable:!0,value:t},listener:{enumerable:!0,writable:!0,value:r}}),this.attach()}_destroy(){this.detach(),De.has(this)&&(this.listener=null,De.delete(this)),super._destroy()}attach(){if(this.listener){const e=De.get(this);e&&e.indexOf(this)<0&&e.push(this)}return this}detach(){if(this.listener){const e=De.get(this);e&&ve(e,this)}return this}isAttached(){const e=De.get(this);return!!e&&e.indexOf(this)>=0}}class Evented extends Destroyable{_destroy(){const e=De.get(this);if(e){De.delete(this);for(let t=e.length-1;t>=0;--t)e[t].destroy()}super._destroy()}on(e,t){if(!ye(t))throw new TypeError("_listener must be a function");if(Destroyable.isDestroyed(this))throw new Error("The target object has been destroyed, cannot attach an event listener to it");let r=De.get(this);return r||De.set(this,r=[]),new EventedHandle(r,e,t)}once(e,t){if(!ye(t))throw new TypeError("_listener must be a function");let r=null;return r=this.on(e,(function(e,n){r&&(r.destroy(),r=null),t(e,n)}))}emit(e,t){if(Destroyable.isDestroyed(this))throw new Error("The target object has been destroyed, cannot emit an event from it");const r=t||xe;var n;(n=r)instanceof EventArgs||"object"==typeof n&&null!==n&&"cancelable"in n&&"defaultPrevented"in n||"undefined"==typeof console||console.warn(new TypeError(`${this.constructor.name||"Evented"} is emitting the "${e}" event with arguments that are not EventArgs`));const s=`on${e}`;s in this&&this[s](r,this);const i=De.get(this);if(i&&i.length>0){const t=i.filter((t=>t.eventName===e));for(let e=0,n=t.length;e<n;++e){const n=t[e].listener;n&&n(r,this)}}return t||null}}const Te=new WeakMap,Ie=Te.get.bind(Te),Oe=Te.set.bind(Te),Re=Te.delete.bind(Te);var Ee;t.PropertyType=void 0,(Ee=t.PropertyType||(t.PropertyType={})).Group="group",Ee.Boolean="boolean",Ee.Color="color",Ee.Enum="enum",Ee.Font="font",Ee.Length="length",Ee.Number="number",Ee.Palette="palette",Ee.String="string";const je=/^(?:group|boolean|color|enum|font|length|number|string|palette)$/;var Ve;!function(e){function t(e){return function(e){return"string"==typeof e&&je.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid PropertyType: ${e}`);return r}}(t.PropertyType||(t.PropertyType={})),t.PropertyVisibility=void 0,(Ve=t.PropertyVisibility||(t.PropertyVisibility={})).Listed="listed",Ve.Configuration="configuration",Ve.Excluded="excluded";const ke=/^(?:listed|configuration|excluded)$/;!function(e){function t(e){return function(e){return"string"==typeof e&&ke.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid PropertyVisibility: ${e}`);return r}}(t.PropertyVisibility||(t.PropertyVisibility={}));class PropertyActiveEventArgs extends EventArgs{constructor(e,t){super(),Object.defineProperties(this,{property:{enumerable:!0,value:e},oldValue:{enumerable:!0,value:t}})}}function Ae(e){return e.isActive()}class MergedVizGroupProperty extends Evented{constructor(e,t,r){if(super(),Object.defineProperties(this,{def:{enumerable:!0,value:e},properties:{enumerable:!0,value:t},_active:{writable:!0,value:!1},_visualItems:{value:r||v}}),t.length>0){const e=this._propertyActiveChanged.bind(this),r=this.emit.bind(this,"value");for(const n of t)this.own(n.on("active",e),n.on("value",r))}this._active=this.properties.some(Ae)}get active(){return this.isActive()}get type(){return this.getType()}get name(){return this.getName()}get caption(){return this.getCaption()}get description(){return this.getDescription()}get aliases(){return this.getAliases()}get tags(){return this.getTags()}get visibility(){return this.getVisibility()}get deprecated(){return this.isDeprecated()}get affectedBy(){return this.getAffectedBy()}getDef(){return this.def}isActive(){return this._active}getType(){return this.def.type}getName(){return this.def.name}getCaption(){return this.def.caption}getDescription(){return this.def.description}getAliases(){return this.def.aliases}getTags(){return this.def.tags}getVisibility(){return this.def.visibility}isDeprecated(){return this.def.deprecated}getAffectedBy(){return this.def.affectedBy}getVisualItems(){return this.visualItems}getProperties(){return this.properties}forEach(e,t){this.properties.forEach(e,t)}_propertyActiveChanged(e){this.emit("active",e);const t=e.property.isActive();if(this._active!==t){const e=t||this.properties.some(Ae);this._active!==e&&(this._active=e,this.emit("active",new PropertyActiveEventArgs(this,!e)))}}}class MergedPropertiesController extends Evented{constructor(){super(),Object.defineProperties(this,{_views:{value:[]},_tree:{value:[]},_listed:{value:[]},_configuration:{value:[]},_excluded:{value:[]},_handles:{value:[]},_map:{value:new Map}}),Object.defineProperty(this,"host",{enumerable:!0,value:new MergedVizProperties(this,this._tree,this._listed,this._configuration,this._excluded,this._map)})}_destroy(){this._clear(),super._destroy()}add(e){if(!this._views.includes(e)){this._views.push(e);const r=Ie(e);r?r.addDestroyListener(this.remove.bind(this,e)):"object"==typeof(t=e)&&t&&"addDestroyListener"in t&&e.addDestroyListener(this.remove.bind(this))}var t}remove(e){const t=this._views.indexOf(e);t>=0&&this._views.splice(t,1)}update(e){if(this._clear(),e){const r=this.emit.bind(this,"active"),n=this.emit.bind(this,"value");for(const s of e.properties){const e=this._resolve(s);e&&s.visibility===t.PropertyVisibility.Listed&&(this._tree.push(e),this._handles.push(e.on("active",r),e.on("value",n)))}for(const t of e.configuration){const e=this._resolveValue(t);this._handles.push(e.on("active",r),e.on("value",n))}for(const e of this._excluded)this._handles.push(e.on("active",r),e.on("value",n))}}_clear(){this._tree.length=0,this._listed.length=0,this._configuration.length=0,this._excluded.length=0,Destroyable.destroyAll(this._handles),this._handles.length=0,this._map.clear()}_getContainer(e){switch(e.visibility){case t.PropertyVisibility.Listed:return this._listed;case t.PropertyVisibility.Excluded:return this._excluded;case t.PropertyVisibility.Configuration:return this._configuration}}_resolve(e){return e.type===t.PropertyType.Group?this._resolveGroup(e):this._resolveValue(e)}_resolveGroup(e){const r=[];for(const n of e.properties){const e=this._resolve(n);e&&n.visibility!==t.PropertyVisibility.Excluded&&r.push(e)}if(r.length<1)return null;const n=new MergedVizGroupProperty(e,Object.freeze(r));return this._handles.push(n),this._addToMap(n),n}_resolveValue(e){let t=null;for(let r=this._views.length-1;r>=0&&!t;--r)t=this._views[r].get(e.name);if(!t)throw new Error(`Could not resolve ${e.name}, did you forget to add a properties view before calling update?`);return this._addToMap(t),this._getContainer(e).push(t),t}_addToMap(e){this._map.set(e.name,e);for(const t of e.aliases)this._map.set(t,e)}}class MergedVizProperties{constructor(e,t,r,n,s,i){Oe(this,e),Object.defineProperties(this,{tree:{enumerable:!0,value:t},listed:{enumerable:!0,value:r},configuration:{enumerable:!0,value:n},excluded:{enumerable:!0,value:s},_map:{value:i}})}has(e){return this._map.has(e)}get(e){return this._map.get(e)||null}forEach(e,t){for(const r of this.listed)e.call(t,r,r.def.name,this);for(const r of this.configuration)e.call(t,r,r.def.name,this);for(const r of this.excluded)e.call(t,r,r.def.name,this)}on(e,t){return Ie(this).on(e,(e=>t(e,this)))}getGroup(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Group?r:null}getBoolean(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Boolean?r:null}getColor(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Color?r:null}getEnum(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Enum?r:null}getNumber(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Number?r:null}getString(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.String?r:null}getPalette(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Palette?r:null}}function Le(e){return Le="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Le(e)}function ze(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Ne(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function Me(e,t,r){return t&&Ne(e.prototype,t),r&&Ne(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function Fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function $e(e,t){return $e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},$e(e,t)}function qe(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&$e(e,t)}function Be(e,t){if(t&&("object"===Le(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Fe(e)}function He(e){return He=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},He(e)}function Ge(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function Ue(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function We(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ue(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ue(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ke(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Xe(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ke(Object(r),!0).forEach((function(t){Ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ke(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var Je={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},Qe=function(){function Logger(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ze(this,Logger),this.init(e,t)}return Me(Logger,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||Je,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,r,n){return n&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(r).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(e){return new Logger(this.logger,Xe(Xe({},{prefix:"".concat(this.prefix,":").concat(e,":")}),this.options))}}]),Logger}(),Ye=new Qe,Ze=function(){function EventEmitter(){ze(this,EventEmitter),this.observers={}}return Me(EventEmitter,[{key:"on",value:function(e,t){var r=this;return e.split(" ").forEach((function(e){r.observers[e]=r.observers[e]||[],r.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];if(this.observers[e]){var s=[].concat(this.observers[e]);s.forEach((function(e){e.apply(void 0,r)}))}if(this.observers["*"]){var i=[].concat(this.observers["*"]);i.forEach((function(t){t.apply(t,[e].concat(r))}))}}}]),EventEmitter}();function et(){var e,t,r=new Promise((function(r,n){e=r,t=n}));return r.resolve=e,r.reject=t,r}function tt(e){return null==e?"":""+e}function rt(e,t,r){e.forEach((function(e){t[e]&&(r[e]=t[e])}))}function nt(e,t,r){function n(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function s(){return!e||"string"==typeof e}for(var i="string"!=typeof t?[].concat(t):t.split(".");i.length>1;){if(s())return{};var o=n(i.shift());!e[o]&&r&&(e[o]=new r),e=Object.prototype.hasOwnProperty.call(e,o)?e[o]:{}}return s()?{}:{obj:e,k:n(i.shift())}}function st(e,t,r){var n=nt(e,t,Object);n.obj[n.k]=r}function it(e,t){var r=nt(e,t),n=r.obj,s=r.k;if(n)return n[s]}function ot(e,t,r){var n=it(e,r);return void 0!==n?n:it(t,r)}function at(e,t,r){for(var n in t)"__proto__"!==n&&"constructor"!==n&&(n in e?"string"==typeof e[n]||e[n]instanceof String||"string"==typeof t[n]||t[n]instanceof String?r&&(e[n]=t[n]):at(e[n],t[n],r):e[n]=t[n]);return e}function lt(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var ut={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function ct(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return ut[e]})):e}var pt="undefined"!=typeof window&&window.navigator&&void 0===window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,ht=[" ",",","?","!",";"];function dt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ft(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?dt(Object(r),!0).forEach((function(t){Ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):dt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function gt(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=He(e);if(t){var s=He(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return Be(this,r)}}function mt(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var n=t.split(r),s=e,i=0;i<n.length;++i){if(!s)return;if("string"==typeof s[n[i]]&&i+1<n.length)return;if(void 0===s[n[i]]){for(var o=2,a=n.slice(i,i+o).join(r),l=s[a];void 0===l&&n.length>i+o;)o++,l=s[a=n.slice(i,i+o).join(r)];if(void 0===l)return;if(t.endsWith(a)){if("string"==typeof l)return l;if(a&&"string"==typeof l[a])return l[a]}var u=n.slice(i+o).join(r);return u?mt(l,u,r):void 0}s=s[n[i]]}return s}}var yt=function(e){qe(ResourceStore,e);var t=gt(ResourceStore);function ResourceStore(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return ze(this,ResourceStore),r=t.call(this),pt&&Ze.call(Fe(r)),r.data=e||{},r.options=n,void 0===r.options.keySeparator&&(r.options.keySeparator="."),void 0===r.options.ignoreJSONStructure&&(r.options.ignoreJSONStructure=!0),r}return Me(ResourceStore,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},s=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,i=void 0!==n.ignoreJSONStructure?n.ignoreJSONStructure:this.options.ignoreJSONStructure,o=[e,t];r&&"string"!=typeof r&&(o=o.concat(r)),r&&"string"==typeof r&&(o=o.concat(s?r.split(s):r)),e.indexOf(".")>-1&&(o=e.split("."));var a=it(this.data,o);return a||!i||"string"!=typeof r?a:mt(this.data&&this.data[e]&&this.data[e][t],r,s)}},{key:"addResource",value:function(e,t,r,n){var s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},i=this.options.keySeparator;void 0===i&&(i=".");var o=[e,t];r&&(o=o.concat(i?r.split(i):r)),e.indexOf(".")>-1&&(n=t,t=(o=e.split("."))[1]),this.addNamespaces(t),st(this.data,o,n),s.silent||this.emit("added",e,t,r,n)}},{key:"addResources",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var s in r)"string"!=typeof r[s]&&"[object Array]"!==Object.prototype.toString.apply(r[s])||this.addResource(e,t,s,r[s],{silent:!0});n.silent||this.emit("added",e,t,r)}},{key:"addResourceBundle",value:function(e,t,r,n,s){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},o=[e,t];e.indexOf(".")>-1&&(n=r,r=t,t=(o=e.split("."))[1]),this.addNamespaces(t);var a=it(this.data,o)||{};n?at(a,r,s):a=ft(ft({},a),r),st(this.data,o,a),i.silent||this.emit("added",e,t,r)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?ft(ft({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((function(e){return t[e]&&Object.keys(t[e]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),ResourceStore}(Ze),vt={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,r,n,s){var i=this;return e.forEach((function(e){i.processors[e]&&(t=i.processors[e].process(t,r,n,s))})),t}};function bt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function wt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?bt(Object(r),!0).forEach((function(t){Ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):bt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function _t(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=He(e);if(t){var s=He(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return Be(this,r)}}var Pt={},Ct=function(e){qe(Translator,e);var t=_t(Translator);function Translator(e){var r,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return ze(this,Translator),r=t.call(this),pt&&Ze.call(Fe(r)),rt(["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],e,Fe(r)),r.options=n,void 0===r.options.keySeparator&&(r.options.keySeparator="."),r.logger=Ye.create("translator"),r}return Me(Translator,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var r=this.resolve(e,t);return r&&void 0!==r.res}},{key:"extractFromKey",value:function(e,t){var r=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===r&&(r=":");var n=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,s=t.ns||this.options.defaultNS||[],i=r&&e.indexOf(r)>-1,o=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||function(e,t,r){t=t||"",r=r||"";var n=ht.filter((function(e){return t.indexOf(e)<0&&r.indexOf(e)<0}));if(0===n.length)return!0;var s=new RegExp("(".concat(n.map((function(e){return"?"===e?"\\?":e})).join("|"),")")),i=!s.test(e);if(!i){var o=e.indexOf(r);o>0&&!s.test(e.substring(0,o))&&(i=!0)}return i}(e,r,n));if(i&&!o){var a=e.match(this.interpolator.nestingRegexp);if(a&&a.length>0)return{key:e,namespaces:s};var l=e.split(r);(r!==n||r===n&&this.options.ns.indexOf(l[0])>-1)&&(s=l.shift()),e=l.join(n)}return"string"==typeof s&&(s=[s]),{key:e,namespaces:s}}},{key:"translate",value:function(e,t,r){var n=this;if("object"!==Le(t)&&this.options.overloadTranslationOptionHandler&&(t=this.options.overloadTranslationOptionHandler(arguments)),t||(t={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var s=void 0!==t.returnDetails?t.returnDetails:this.options.returnDetails,i=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,o=this.extractFromKey(e[e.length-1],t),a=o.key,l=o.namespaces,u=l[l.length-1],c=t.lng||this.language,p=t.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(c&&"cimode"===c.toLowerCase()){if(p){var h=t.nsSeparator||this.options.nsSeparator;return s?(d.res="".concat(u).concat(h).concat(a),d):"".concat(u).concat(h).concat(a)}return s?(d.res=a,d):a}var d=this.resolve(e,t),f=d&&d.res,g=d&&d.usedKey||a,m=d&&d.exactUsedKey||a,y=Object.prototype.toString.apply(f),v=["[object Number]","[object Function]","[object RegExp]"],b=void 0!==t.joinArrays?t.joinArrays:this.options.joinArrays,w=!this.i18nFormat||this.i18nFormat.handleAsObject,_="string"!=typeof f&&"boolean"!=typeof f&&"number"!=typeof f;if(w&&f&&_&&v.indexOf(y)<0&&("string"!=typeof b||"[object Array]"!==y)){if(!t.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var P=this.options.returnedObjectHandler?this.options.returnedObjectHandler(g,f,wt(wt({},t),{},{ns:l})):"key '".concat(a," (").concat(this.language,")' returned an object instead of string.");return s?(d.res=P,d):P}if(i){var C="[object Array]"===y,S=C?[]:{},x=C?m:g;for(var D in f)if(Object.prototype.hasOwnProperty.call(f,D)){var T="".concat(x).concat(i).concat(D);S[D]=this.translate(T,wt(wt({},t),{joinArrays:!1,ns:l})),S[D]===T&&(S[D]=f[D])}f=S}}else if(w&&"string"==typeof b&&"[object Array]"===y)(f=f.join(b))&&(f=this.extendTranslation(f,e,t,r));else{var I=!1,O=!1,R=void 0!==t.count&&"string"!=typeof t.count,E=Translator.hasDefaultValue(t),j=R?this.pluralResolver.getSuffix(c,t.count,t):"",V=t["defaultValue".concat(j)]||t.defaultValue;!this.isValidLookup(f)&&E&&(I=!0,f=V),this.isValidLookup(f)||(O=!0,f=a);var k=t.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey,A=k&&O?void 0:f,L=E&&V!==f&&this.options.updateMissing;if(O||I||L){if(this.logger.log(L?"updateKey":"missingKey",c,u,a,L?V:f),i){var z=this.resolve(a,wt(wt({},t),{},{keySeparator:!1}));z&&z.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var N=[],M=this.languageUtils.getFallbackCodes(this.options.fallbackLng,t.lng||this.language);if("fallback"===this.options.saveMissingTo&&M&&M[0])for(var F=0;F<M.length;F++)N.push(M[F]);else"all"===this.options.saveMissingTo?N=this.languageUtils.toResolveHierarchy(t.lng||this.language):N.push(t.lng||this.language);var $=function(e,r,s){var i=E&&s!==f?s:A;n.options.missingKeyHandler?n.options.missingKeyHandler(e,u,r,i,L,t):n.backendConnector&&n.backendConnector.saveMissing&&n.backendConnector.saveMissing(e,u,r,i,L,t),n.emit("missingKey",e,u,r,f)};this.options.saveMissing&&(this.options.saveMissingPlurals&&R?N.forEach((function(e){n.pluralResolver.getSuffixes(e,t).forEach((function(r){$([e],a+r,t["defaultValue".concat(r)]||V)}))})):$(N,a,V))}f=this.extendTranslation(f,e,t,d,r),O&&f===a&&this.options.appendNamespaceToMissingKey&&(f="".concat(u,":").concat(a)),(O||I)&&this.options.parseMissingKeyHandler&&(f="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(a,I?f:void 0):this.options.parseMissingKeyHandler(f))}return s?(d.res=f,d):f}},{key:"extendTranslation",value:function(e,t,r,n,s){var i=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,wt(wt({},this.options.interpolation.defaultVariables),r),n.usedLng,n.usedNS,n.usedKey,{resolved:n});else if(!r.skipInterpolation){r.interpolation&&this.interpolator.init(wt(wt({},r),{interpolation:wt(wt({},this.options.interpolation),r.interpolation)}));var o,a="string"==typeof e&&(r&&r.interpolation&&void 0!==r.interpolation.skipOnVariables?r.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(a){var l=e.match(this.interpolator.nestingRegexp);o=l&&l.length}var u=r.replace&&"string"!=typeof r.replace?r.replace:r;if(this.options.interpolation.defaultVariables&&(u=wt(wt({},this.options.interpolation.defaultVariables),u)),e=this.interpolator.interpolate(e,u,r.lng||this.language,r),a){var c=e.match(this.interpolator.nestingRegexp);o<(c&&c.length)&&(r.nest=!1)}!1!==r.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,n=new Array(e),o=0;o<e;o++)n[o]=arguments[o];return s&&s[0]===n[0]&&!r.context?(i.logger.warn("It seems you are nesting recursively key: ".concat(n[0]," in key: ").concat(t[0])),null):i.translate.apply(i,n.concat([t]))}),r)),r.interpolation&&this.interpolator.reset()}var p=r.postProcess||this.options.postProcess,h="string"==typeof p?[p]:p;return null!=e&&h&&h.length&&!1!==r.applyPostProcessor&&(e=vt.handle(h,e,t,this.options&&this.options.postProcessPassResolved?wt({i18nResolved:n},r):r,this)),e}},{key:"resolve",value:function(e){var t,r,n,s,i,o=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!o.isValidLookup(t)){var l=o.extractFromKey(e,a),u=l.key;r=u;var c=l.namespaces;o.options.fallbackNS&&(c=c.concat(o.options.fallbackNS));var p=void 0!==a.count&&"string"!=typeof a.count,h=p&&!a.ordinal&&0===a.count&&o.pluralResolver.shouldUseIntlApi(),d=void 0!==a.context&&("string"==typeof a.context||"number"==typeof a.context)&&""!==a.context,f=a.lngs?a.lngs:o.languageUtils.toResolveHierarchy(a.lng||o.language,a.fallbackLng);c.forEach((function(e){o.isValidLookup(t)||(i=e,!Pt["".concat(f[0],"-").concat(e)]&&o.utils&&o.utils.hasLoadedNamespace&&!o.utils.hasLoadedNamespace(i)&&(Pt["".concat(f[0],"-").concat(e)]=!0,o.logger.warn('key "'.concat(r,'" for languages "').concat(f.join(", "),'" won\'t get resolved as namespace "').concat(i,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),f.forEach((function(r){if(!o.isValidLookup(t)){s=r;var i,l=[u];if(o.i18nFormat&&o.i18nFormat.addLookupKeys)o.i18nFormat.addLookupKeys(l,u,r,e,a);else{var c;p&&(c=o.pluralResolver.getSuffix(r,a.count,a));var f="_zero";if(p&&(l.push(u+c),h&&l.push(u+f)),d){var g="".concat(u).concat(o.options.contextSeparator).concat(a.context);l.push(g),p&&(l.push(g+c),h&&l.push(g+f))}}for(;i=l.pop();)o.isValidLookup(t)||(n=i,t=o.getResource(r,e,i,a))}})))}))}})),{res:t,usedKey:r,exactUsedKey:n,usedLng:s,usedNS:i}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,r){var n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,r,n):this.resourceStore.getResource(e,t,r,n)}}],[{key:"hasDefaultValue",value:function(e){var t="defaultValue";for(var r in e)if(Object.prototype.hasOwnProperty.call(e,r)&&t===r.substring(0,t.length)&&void 0!==e[r])return!0;return!1}}]),Translator}(Ze);function St(e){return e.charAt(0).toUpperCase()+e.slice(1)}var xt=function(){function LanguageUtil(e){ze(this,LanguageUtil),this.options=e,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Ye.create("languageUtils")}return Me(LanguageUtil,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],r=e.split("-");return this.options.lowerCaseLng?r=r.map((function(e){return e.toLowerCase()})):2===r.length?(r[0]=r[0].toLowerCase(),r[1]=r[1].toUpperCase(),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=St(r[1].toLowerCase()))):3===r.length&&(r[0]=r[0].toLowerCase(),2===r[1].length&&(r[1]=r[1].toUpperCase()),"sgn"!==r[0]&&2===r[2].length&&(r[2]=r[2].toUpperCase()),t.indexOf(r[1].toLowerCase())>-1&&(r[1]=St(r[1].toLowerCase())),t.indexOf(r[2].toLowerCase())>-1&&(r[2]=St(r[2].toLowerCase()))),r.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,r=this;return e?(e.forEach((function(e){if(!t){var n=r.formatLanguageCode(e);r.options.supportedLngs&&!r.isSupportedCode(n)||(t=n)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var n=r.getLanguagePartFromCode(e);if(r.isSupportedCode(n))return t=n;t=r.options.supportedLngs.find((function(e){if(0===e.indexOf(n))return e}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var r=e[t];return r||(r=e[this.getScriptPartFromCode(t)]),r||(r=e[this.formatLanguageCode(t)]),r||(r=e[this.getLanguagePartFromCode(t)]),r||(r=e.default),r||[]}},{key:"toResolveHierarchy",value:function(e,t){var r=this,n=this.getFallbackCodes(t||this.options.fallbackLng||[],e),s=[],i=function(e){e&&(r.isSupportedCode(e)?s.push(e):r.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&i(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&i(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&i(this.getLanguagePartFromCode(e))):"string"==typeof e&&i(this.formatLanguageCode(e)),n.forEach((function(e){s.indexOf(e)<0&&i(r.formatLanguageCode(e))})),s}}]),LanguageUtil}(),Dt=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],Tt={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},It=["v1","v2","v3"],Ot={zero:0,one:1,two:2,few:3,many:4,other:5};function Rt(){var e={};return Dt.forEach((function(t){t.lngs.forEach((function(r){e[r]={numbers:t.nr,plurals:Tt[t.fc]}}))})),e}var Et=function(){function PluralResolver(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};ze(this,PluralResolver),this.languageUtils=e,this.options=t,this.logger=Ye.create("pluralResolver"),this.options.compatibilityJSON&&"v4"!==this.options.compatibilityJSON||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=Rt()}return Me(PluralResolver,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(e,{type:t.ordinal?"ordinal":"cardinal"})}catch(e){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.getRule(e,t);return this.shouldUseIntlApi()?r&&r.resolvedOptions().pluralCategories.length>1:r&&r.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,r).map((function(e){return"".concat(t).concat(e)}))}},{key:"getSuffixes",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,r);return n?this.shouldUseIntlApi()?n.resolvedOptions().pluralCategories.sort((function(e,t){return Ot[e]-Ot[t]})).map((function(e){return"".concat(t.options.prepend).concat(e)})):n.numbers.map((function(n){return t.getSuffix(e,n,r)})):[]}},{key:"getSuffix",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=this.getRule(e,r);return n?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(n.select(t)):this.getSuffixRetroCompatible(n,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var r=this,n=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),s=e.numbers[n];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===s?s="plural":1===s&&(s=""));var i=function(){return r.options.prepend&&s.toString()?r.options.prepend+s.toString():s.toString()};return"v1"===this.options.compatibilityJSON?1===s?"":"number"==typeof s?"_plural_".concat(s.toString()):i():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?i():this.options.prepend&&n.toString()?this.options.prepend+n.toString():n.toString()}},{key:"shouldUseIntlApi",value:function(){return!It.includes(this.options.compatibilityJSON)}}]),PluralResolver}();function jt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Vt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?jt(Object(r),!0).forEach((function(t){Ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):jt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var kt=function(){function Interpolator(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ze(this,Interpolator),this.logger=Ye.create("interpolator"),this.options=e,this.format=e.interpolation&&e.interpolation.format||function(e){return e},this.init(e)}return Me(Interpolator,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:ct,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?lt(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?lt(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?lt(t.nestingPrefix):t.nestingPrefixEscaped||lt("$t("),this.nestingSuffix=t.nestingSuffix?lt(t.nestingSuffix):t.nestingSuffixEscaped||lt(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var r="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(r,"g")}},{key:"interpolate",value:function(e,t,r,n){var s,i,o,a=this,l=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function u(e){return e.replace(/\$/g,"$$$$")}var c=function(e){if(e.indexOf(a.formatSeparator)<0){var s=ot(t,l,e);return a.alwaysFormat?a.format(s,void 0,r,Vt(Vt(Vt({},n),t),{},{interpolationkey:e})):s}var i=e.split(a.formatSeparator),o=i.shift().trim(),u=i.join(a.formatSeparator).trim();return a.format(ot(t,l,o),u,r,Vt(Vt(Vt({},n),t),{},{interpolationkey:o}))};this.resetRegExp();var p=n&&n.missingInterpolationHandler||this.options.missingInterpolationHandler,h=n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return u(e)}},{regex:this.regexp,safeValue:function(e){return a.escapeValue?u(a.escape(e)):u(e)}}].forEach((function(t){for(o=0;s=t.regex.exec(e);){var r=s[1].trim();if(void 0===(i=c(r)))if("function"==typeof p){var l=p(e,s,n);i="string"==typeof l?l:""}else if(n&&n.hasOwnProperty(r))i="";else{if(h){i=s[0];continue}a.logger.warn("missed to pass in variable ".concat(r," for interpolating ").concat(e)),i=""}else"string"==typeof i||a.useRawValueToEscape||(i=tt(i));var u=t.safeValue(i);if(e=e.replace(s[0],u),h?(t.regex.lastIndex+=u.length,t.regex.lastIndex-=s[0].length):t.regex.lastIndex=0,++o>=a.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var r,n,s=this,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=Vt({},i);function a(e,t){var r=this.nestingOptionsSeparator;if(e.indexOf(r)<0)return e;var n=e.split(new RegExp("".concat(r,"[ ]*{"))),s="{".concat(n[1]);e=n[0],s=(s=this.interpolate(s,o)).replace(/'/g,'"');try{o=JSON.parse(s),t&&(o=Vt(Vt({},t),o))}catch(t){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),t),"".concat(e).concat(r).concat(s)}return delete o.defaultValue,e}for(o.applyPostProcessor=!1,delete o.defaultValue;r=this.nestingRegexp.exec(e);){var l=[],u=!1;if(-1!==r[0].indexOf(this.formatSeparator)&&!/{.*}/.test(r[1])){var c=r[1].split(this.formatSeparator).map((function(e){return e.trim()}));r[1]=c.shift(),l=c,u=!0}if((n=t(a.call(this,r[1].trim(),o),o))&&r[0]===e&&"string"!=typeof n)return n;"string"!=typeof n&&(n=tt(n)),n||(this.logger.warn("missed to resolve ".concat(r[1]," for nesting ").concat(e)),n=""),u&&(n=l.reduce((function(e,t){return s.format(e,t,i.lng,Vt(Vt({},i),{},{interpolationkey:r[1].trim()}))}),n.trim())),e=e.replace(r[0],n),this.regexp.lastIndex=0}return e}}]),Interpolator}();function At(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Lt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?At(Object(r),!0).forEach((function(t){Ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):At(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var zt=function(){function Formatter(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};ze(this,Formatter),this.logger=Ye.create("formatter"),this.options=e,this.formats={number:function(e,t,r){return new Intl.NumberFormat(t,r).format(e)},currency:function(e,t,r){return new Intl.NumberFormat(t,Lt(Lt({},r),{},{style:"currency"})).format(e)},datetime:function(e,t,r){return new Intl.DateTimeFormat(t,Lt({},r)).format(e)},relativetime:function(e,t,r){return new Intl.RelativeTimeFormat(t,Lt({},r)).format(e,r.range||"day")},list:function(e,t,r){return new Intl.ListFormat(t,Lt({},r)).format(e)}},this.init(e)}return Me(Formatter,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}},r=t.interpolation;this.formatSeparator=r.formatSeparator?r.formatSeparator:r.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"format",value:function(e,t,r,n){var s=this,i=t.split(this.formatSeparator).reduce((function(e,t){var i=function(e){var t=e.toLowerCase().trim(),r={};if(e.indexOf("(")>-1){var n=e.split("(");t=n[0].toLowerCase().trim();var s=n[1].substring(0,n[1].length-1);"currency"===t&&s.indexOf(":")<0?r.currency||(r.currency=s.trim()):"relativetime"===t&&s.indexOf(":")<0?r.range||(r.range=s.trim()):s.split(";").forEach((function(e){if(e){var t=We(e.split(":")),n=t[0],s=t.slice(1).join(":");r[n.trim()]||(r[n.trim()]=s.trim()),"false"===s.trim()&&(r[n.trim()]=!1),"true"===s.trim()&&(r[n.trim()]=!0),isNaN(s.trim())||(r[n.trim()]=parseInt(s.trim(),10))}}))}return{formatName:t,formatOptions:r}}(t),o=i.formatName,a=i.formatOptions;if(s.formats[o]){var l=e;try{var u=n&&n.formatParams&&n.formatParams[n.interpolationkey]||{},c=u.locale||u.lng||n.locale||n.lng||r;l=s.formats[o](e,c,Lt(Lt(Lt({},a),n),u))}catch(e){s.logger.warn(e)}return l}return s.logger.warn("there was no format function for ".concat(o)),e}),e);return i}}]),Formatter}();function Nt(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Mt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Nt(Object(r),!0).forEach((function(t){Ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Nt(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ft(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=He(e);if(t){var s=He(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return Be(this,r)}}var $t=function(e){qe(Connector,e);var t=Ft(Connector);function Connector(e,r,n){var s,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return ze(this,Connector),s=t.call(this),pt&&Ze.call(Fe(s)),s.backend=e,s.store=r,s.services=n,s.languageUtils=n.languageUtils,s.options=i,s.logger=Ye.create("backendConnector"),s.waitingReads=[],s.maxParallelReads=i.maxParallelReads||10,s.readingCalls=0,s.state={},s.queue=[],s.backend&&s.backend.init&&s.backend.init(n,i.backend,i),s}return Me(Connector,[{key:"queueLoad",value:function(e,t,r,n){var s=this,i={},o={},a={},l={};return e.forEach((function(e){var n=!0;t.forEach((function(t){var a="".concat(e,"|").concat(t);!r.reload&&s.store.hasResourceBundle(e,t)?s.state[a]=2:s.state[a]<0||(1===s.state[a]?void 0===o[a]&&(o[a]=!0):(s.state[a]=1,n=!1,void 0===o[a]&&(o[a]=!0),void 0===i[a]&&(i[a]=!0),void 0===l[t]&&(l[t]=!0)))})),n||(a[e]=!0)})),(Object.keys(i).length||Object.keys(o).length)&&this.queue.push({pending:o,pendingCount:Object.keys(o).length,loaded:{},errors:[],callback:n}),{toLoad:Object.keys(i),pending:Object.keys(o),toLoadLanguages:Object.keys(a),toLoadNamespaces:Object.keys(l)}}},{key:"loaded",value:function(e,t,r){var n=e.split("|"),s=n[0],i=n[1];t&&this.emit("failedLoading",s,i,t),r&&this.store.addResourceBundle(s,i,r),this.state[e]=t?-1:2;var o={};this.queue.forEach((function(r){var n,a,l,u,c,p;n=r.loaded,a=i,u=nt(n,[s],Object),c=u.obj,p=u.k,c[p]=c[p]||[],l&&(c[p]=c[p].concat(a)),l||c[p].push(a),function(e,t){delete e.pending[t],e.pendingCount--}(r,e),t&&r.errors.push(t),0!==r.pendingCount||r.done||(Object.keys(r.loaded).forEach((function(e){o[e]||(o[e]={});var t=Object.keys(o[e]);t.length&&t.forEach((function(r){void 0!==t[r]&&(o[e][r]=!0)}))})),r.done=!0,r.errors.length?r.callback(r.errors):r.callback())})),this.emit("loaded",o),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,r){var n=this,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:350,o=arguments.length>5?arguments[5]:void 0;return e.length?this.readingCalls>=this.maxParallelReads?void this.waitingReads.push({lng:e,ns:t,fcName:r,tried:s,wait:i,callback:o}):(this.readingCalls++,this.backend[r](e,t,(function(a,l){if(a&&l&&s<5)setTimeout((function(){n.read.call(n,e,t,r,s+1,2*i,o)}),i);else{if(n.readingCalls--,n.waitingReads.length>0){var u=n.waitingReads.shift();n.read(u.lng,u.ns,u.fcName,u.tried,u.wait,u.callback)}o(a,l)}}))):o(null,{})}},{key:"prepareLoading",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},s=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),s&&s();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var i=this.queueLoad(e,t,n,s);if(!i.toLoad.length)return i.pending.length||s(),null;i.toLoad.forEach((function(e){r.loadOne(e)}))}},{key:"load",value:function(e,t,r){this.prepareLoading(e,t,{},r)}},{key:"reload",value:function(e,t,r){this.prepareLoading(e,t,{reload:!0},r)}},{key:"loadOne",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e.split("|"),s=n[0],i=n[1];this.read(s,i,"read",void 0,void 0,(function(n,o){n&&t.logger.warn("".concat(r,"loading namespace ").concat(i," for language ").concat(s," failed"),n),!n&&o&&t.logger.log("".concat(r,"loaded namespace ").concat(i," for language ").concat(s),o),t.loaded(e,n,o)}))}},{key:"saveMissing",value:function(e,t,r,n,s){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t)?this.logger.warn('did not save key "'.concat(r,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!"):null!=r&&""!==r&&(this.backend&&this.backend.create&&this.backend.create(e,t,r,n,null,Mt(Mt({},i),{},{isUpdate:s})),e&&e[0]&&this.store.addResource(e[0],t,r,n))}}]),Connector}(Ze);function qt(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===Le(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===Le(e[2])||"object"===Le(e[3])){var r=e[3]||e[2];Object.keys(r).forEach((function(e){t[e]=r[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,r,n){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function Bt(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function Ht(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function Gt(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(r),!0).forEach((function(t){Ge(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Ht(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function Ut(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var r,n=He(e);if(t){var s=He(this).constructor;r=Reflect.construct(n,arguments,s)}else r=n.apply(this,arguments);return Be(this,r)}}function Wt(){}function Kt(e){Object.getOwnPropertyNames(Object.getPrototypeOf(e)).forEach((function(t){"function"==typeof e[t]&&(e[t]=e[t].bind(e))}))}var Xt=function(e){qe(I18n,e);var t=Ut(I18n);function I18n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(ze(this,I18n),e=t.call(this),pt&&Ze.call(Fe(e)),e.options=Bt(r),e.services={},e.logger=Ye,e.modules={external:[]},Kt(Fe(e)),n&&!e.isInitialized&&!r.isClone){if(!e.options.initImmediate)return e.init(r,n),Be(e,Fe(e));setTimeout((function(){e.init(r,n)}),0)}return e}return Me(I18n,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0;"function"==typeof t&&(r=t,t={}),!t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));var n=qt();function s(e){return e?"function"==typeof e?new e:e:null}if(this.options=Gt(Gt(Gt({},n),this.options),Bt(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=Gt(Gt({},n.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){var i;this.modules.logger?Ye.init(s(this.modules.logger),this.options):Ye.init(null,this.options),this.modules.formatter?i=this.modules.formatter:"undefined"!=typeof Intl&&(i=zt);var o=new xt(this.options);this.store=new yt(this.options.resources,this.options);var a=this.services;a.logger=Ye,a.resourceStore=this.store,a.languageUtils=o,a.pluralResolver=new Et(o,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!i||this.options.interpolation.format&&this.options.interpolation.format!==n.interpolation.format||(a.formatter=s(i),a.formatter.init(a,this.options),this.options.interpolation.format=a.formatter.format.bind(a.formatter)),a.interpolator=new kt(this.options),a.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},a.backendConnector=new $t(s(this.modules.backend),a.resourceStore,a,this.options),a.backendConnector.on("*",(function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];e.emit.apply(e,[t].concat(n))})),this.modules.languageDetector&&(a.languageDetector=s(this.modules.languageDetector),a.languageDetector.init(a,this.options.detection,this.options)),this.modules.i18nFormat&&(a.i18nFormat=s(this.modules.i18nFormat),a.i18nFormat.init&&a.i18nFormat.init(this)),this.translator=new Ct(this.services,this.options),this.translator.on("*",(function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),s=1;s<r;s++)n[s-1]=arguments[s];e.emit.apply(e,[t].concat(n))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.format=this.options.interpolation.format,r||(r=Wt),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var l=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);l.length>0&&"dev"!==l[0]&&(this.options.lng=l[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined");var u=["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"];u.forEach((function(t){e[t]=function(){var r;return(r=e.store)[t].apply(r,arguments)}}));var c=["addResource","addResources","addResourceBundle","removeResourceBundle"];c.forEach((function(t){e[t]=function(){var r;return(r=e.store)[t].apply(r,arguments),e}}));var p=et(),h=function(){var t=function(t,n){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),p.resolve(n),r(t,n)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?h():setTimeout(h,0),p}},{key:"loadResources",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wt,n=r,s="string"==typeof e?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(s&&"cimode"===s.toLowerCase())return n();var i=[],o=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){i.indexOf(e)<0&&i.push(e)}))};if(s)o(s);else{var a=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);a.forEach((function(e){return o(e)}))}this.options.preload&&this.options.preload.forEach((function(e){return o(e)})),this.services.backendConnector.load(i,this.options.ns,(function(e){e||t.resolvedLanguage||!t.language||t.setResolvedLanguage(t.language),n(e)}))}else n(null)}},{key:"reloadResources",value:function(e,t,r){var n=et();return e||(e=this.languages),t||(t=this.options.ns),r||(r=Wt),this.services.backendConnector.reload(e,t,(function(e){n.resolve(),r(e)})),n}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&vt.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var r=this.languages[t];if(!(["cimode","dev"].indexOf(r)>-1)&&this.store.hasLanguageSomeTranslations(r)){this.resolvedLanguage=r;break}}}},{key:"changeLanguage",value:function(e,t){var r=this;this.isLanguageChangingTo=e;var n=et();this.emit("languageChanging",e);var s=function(e){r.language=e,r.languages=r.services.languageUtils.toResolveHierarchy(e),r.resolvedLanguage=void 0,r.setResolvedLanguage(e)},i=function(i){e||i||!r.services.languageDetector||(i=[]);var o="string"==typeof i?i:r.services.languageUtils.getBestMatchFromCodes(i);o&&(r.language||s(o),r.translator.language||r.translator.changeLanguage(o),r.services.languageDetector&&r.services.languageDetector.cacheUserLanguage(o)),r.loadResources(o,(function(e){!function(e,i){i?(s(i),r.translator.changeLanguage(i),r.isLanguageChangingTo=void 0,r.emit("languageChanged",i),r.logger.log("languageChanged",i)):r.isLanguageChangingTo=void 0,n.resolve((function(){return r.t.apply(r,arguments)})),t&&t(e,(function(){return r.t.apply(r,arguments)}))}(e,o)}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?this.services.languageDetector.detect(i):i(e):i(this.services.languageDetector.detect()),n}},{key:"getFixedT",value:function(e,t,r){var n=this,s=function e(t,s){var i;if("object"!==Le(s)){for(var o=arguments.length,a=new Array(o>2?o-2:0),l=2;l<o;l++)a[l-2]=arguments[l];i=n.options.overloadTranslationOptionHandler([t,s].concat(a))}else i=Gt({},s);i.lng=i.lng||e.lng,i.lngs=i.lngs||e.lngs,i.ns=i.ns||e.ns;var u=n.options.keySeparator||".",c=r?"".concat(r).concat(u).concat(t):t;return n.t(c,i)};return"string"==typeof e?s.lng=e:s.lngs=e,s.ns=t,s.keyPrefix=r,s}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var n=this.resolvedLanguage||this.languages[0],s=!!this.options&&this.options.fallbackLng,i=this.languages[this.languages.length-1];if("cimode"===n.toLowerCase())return!0;var o=function(e,r){var n=t.services.backendConnector.state["".concat(e,"|").concat(r)];return-1===n||2===n};if(r.precheck){var a=r.precheck(this,o);if(void 0!==a)return a}return!!this.hasResourceBundle(n,e)||(!(this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages))||!(!o(n,e)||s&&!o(i,e)))}},{key:"loadNamespaces",value:function(e,t){var r=this,n=et();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){r.options.ns.indexOf(e)<0&&r.options.ns.push(e)})),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var r=et();"string"==typeof e&&(e=[e]);var n=this.options.preload||[],s=e.filter((function(e){return n.indexOf(e)<0}));return s.length?(this.options.preload=n.concat(s),this.loadResources((function(e){r.resolve(),t&&t(e)})),r):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(this.services.languageUtils.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Wt,n=Gt(Gt(Gt({},this.options),t),{isClone:!0}),s=new I18n(n),i=["store","services","language"];return i.forEach((function(t){s[t]=e[t]})),s.services=Gt({},this.services),s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s.translator=new Ct(s.services,s.options),s.translator.on("*",(function(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];s.emit.apply(s,[e].concat(r))})),s.init(n,r),s.translator.options=s.options,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),I18n}(Ze);Ge(Xt,"createInstance",(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0;return new Xt(e,t)}));var Jt=Xt.createInstance();function Qt(e){return Qt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Qt(e)}Jt.createInstance=Xt.createInstance,Jt.createInstance,Jt.init,Jt.loadResources,Jt.reloadResources,Jt.use,Jt.changeLanguage,Jt.getFixedT,Jt.t,Jt.exists,Jt.setDefaultNamespace,Jt.hasLoadedNamespace,Jt.loadNamespaces,Jt.loadLanguages;var Yt,Zt=[],er=Zt.forEach,tr=Zt.slice;function rr(e){return er.call(tr.call(arguments,1),(function(t){if(t)for(var r in t)void 0===e[r]&&(e[r]=t[r])})),e}function nr(){return"function"==typeof XMLHttpRequest||"object"===("undefined"==typeof XMLHttpRequest?"undefined":Qt(XMLHttpRequest))}if("function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?Yt=global.fetch:"undefined"!=typeof window&&window.fetch&&(Yt=window.fetch)),void 0!==e&&("undefined"==typeof window||void 0===window.document)){var sr=Yt||e("cross-fetch");sr.default&&(sr=sr.default),t.default=sr,module.exports=t.default}var ir,or,ar,lr=Object.freeze({__proto__:null});function ur(e){return ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ur(e)}"function"==typeof fetch&&("undefined"!=typeof global&&global.fetch?ir=global.fetch:"undefined"!=typeof window&&window.fetch&&(ir=window.fetch)),nr&&("undefined"!=typeof global&&global.XMLHttpRequest?or=global.XMLHttpRequest:"undefined"!=typeof window&&window.XMLHttpRequest&&(or=window.XMLHttpRequest)),"function"==typeof ActiveXObject&&("undefined"!=typeof global&&global.ActiveXObject?ar=global.ActiveXObject:"undefined"!=typeof window&&window.ActiveXObject&&(ar=window.ActiveXObject)),ir||!lr||or||ar||(ir=lr),"function"!=typeof ir&&(ir=void 0);var cr=function(e,t){if(t&&"object"===ur(t)){var r="";for(var n in t)r+="&"+encodeURIComponent(n)+"="+encodeURIComponent(t[n]);if(!r)return e;e=e+(-1!==e.indexOf("?")?"&":"?")+r.slice(1)}return e},pr=function(e,t,r,n){return"function"==typeof r&&(n=r,r=void 0),n=n||function(){},ir?function(e,t,r,n){e.queryStringParams&&(t=cr(t,e.queryStringParams));var s=rr({},"function"==typeof e.customHeaders?e.customHeaders():e.customHeaders);r&&(s["Content-Type"]="application/json"),ir(t,rr({method:r?"POST":"GET",body:r?e.stringify(r):void 0,headers:s},"function"==typeof e.requestOptions?e.requestOptions(r):e.requestOptions)).then((function(e){if(!e.ok)return n(e.statusText||"Error",{status:e.status});e.text().then((function(t){n(null,{status:e.status,data:t})})).catch(n)})).catch(n)}(e,t,r,n):nr||"function"==typeof ActiveXObject?function(e,t,r,n){r&&"object"===ur(r)&&(r=cr("",r).slice(1)),e.queryStringParams&&(t=cr(t,e.queryStringParams));try{var s;(s=or?new or:new ar("MSXML2.XMLHTTP.3.0")).open(r?"POST":"GET",t,1),e.crossDomain||s.setRequestHeader("X-Requested-With","XMLHttpRequest"),s.withCredentials=!!e.withCredentials,r&&s.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),s.overrideMimeType&&s.overrideMimeType("application/json");var i=e.customHeaders;if(i="function"==typeof i?i():i)for(var o in i)s.setRequestHeader(o,i[o]);s.onreadystatechange=function(){s.readyState>3&&n(s.status>=400?s.statusText:null,{status:s.status,data:s.responseText})},s.send(r)}catch(e){console&&console.log(e)}}(e,t,r,n):void 0};function hr(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function dr(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var fr,gr=function(){return{loadPath:"/locales/{{lng}}/{{ns}}.json",addPath:"/locales/add/{{lng}}/{{ns}}",allowMultiLoading:!1,parse:function(e){return JSON.parse(e)},stringify:JSON.stringify,parsePayload:function(e,t,r){return function(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}({},t,r||"")},request:pr,reloadInterval:"undefined"==typeof window&&36e5,customHeaders:{},queryStringParams:{},crossDomain:!1,withCredentials:!1,overrideMimeType:!1,requestOptions:{mode:"cors",credentials:"same-origin",cache:"default"}}},mr=function(){function Backend(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};hr(this,Backend),this.services=e,this.options=t,this.allOptions=r,this.type="backend",this.init(e,t,r)}var e,t,r;return e=Backend,t=[{key:"init",value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.services=e,this.options=rr(r,this.options||{},gr()),this.allOptions=n,this.services&&this.options.reloadInterval&&setInterval((function(){return t.reload()}),this.options.reloadInterval)}},{key:"readMulti",value:function(e,t,r){this._readAny(e,e,t,t,r)}},{key:"read",value:function(e,t,r){this._readAny([e],e,[t],t,r)}},{key:"_readAny",value:function(e,t,r,n,s){var i,o=this,a=this.options.loadPath;"function"==typeof this.options.loadPath&&(a=this.options.loadPath(e,r)),(a=function(e){return!!e&&"function"==typeof e.then}(i=a)?i:Promise.resolve(i)).then((function(i){if(!i)return s(null,{});var a=o.services.interpolator.interpolate(i,{lng:e.join("+"),ns:r.join("+")});o.loadUrl(a,s,t,n)}))}},{key:"loadUrl",value:function(e,t,r,n){var s=this;this.options.request(this.options,e,void 0,(function(i,o){if(o&&(o.status>=500&&o.status<600||!o.status))return t("failed loading "+e+"; status code: "+o.status,!0);if(o&&o.status>=400&&o.status<500)return t("failed loading "+e+"; status code: "+o.status,!1);if(!o&&i&&i.message&&i.message.indexOf("Failed to fetch")>-1)return t("failed loading "+e+": "+i.message,!0);if(i)return t(i,!1);var a,l;try{a="string"==typeof o.data?s.options.parse(o.data,r,n):o.data}catch(t){l="failed parsing "+e+" to json"}if(l)return t(l,!1);t(null,a)}))}},{key:"create",value:function(e,t,r,n,s){var i=this;if(this.options.addPath){"string"==typeof e&&(e=[e]);var o=this.options.parsePayload(t,r,n),a=0,l=[],u=[];e.forEach((function(r){var n=i.options.addPath;"function"==typeof i.options.addPath&&(n=i.options.addPath(r,t));var c=i.services.interpolator.interpolate(n,{lng:r,ns:t});i.options.request(i.options,c,o,(function(t,r){a+=1,l.push(t),u.push(r),a===e.length&&s&&s(l,u)}))}))}}},{key:"reload",value:function(){var e=this,t=this.services,r=t.backendConnector,n=t.languageUtils,s=t.logger,i=r.language;if(!i||"cimode"!==i.toLowerCase()){var o=[],a=function(e){n.toResolveHierarchy(e).forEach((function(e){o.indexOf(e)<0&&o.push(e)}))};a(i),this.allOptions.preload&&this.allOptions.preload.forEach((function(e){return a(e)})),o.forEach((function(t){e.allOptions.ns.forEach((function(e){r.read(t,e,"read",null,null,(function(n,i){n&&s.warn("loading namespace ".concat(e," for language ").concat(t," failed"),n),!n&&i&&s.log("loaded namespace ".concat(e," for language ").concat(t),i),r.loaded("".concat(t,"|").concat(e),n,i)}))}))}))}}}],t&&dr(e.prototype,t),r&&dr(e,r),Object.defineProperty(e,"prototype",{writable:!1}),Backend}();mr.type="backend",function(e){e.Java="java",e.JavaScript="js"}(fr||(fr={})),function(e){function t(t){if("string"!=typeof t)return null;switch(t.toLowerCase()){case"java":return e.Java;case"javascript":case"js":return e.JavaScript;default:return null}}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid Language: ${e}`);return r}}(fr||(fr={}));const yr=/^(?:GET|HEAD|POST|PUT|DELETE|CONNECT|OPTIONS|TRACE|PATCH)$/;const vr=/(?:^text\/(?:ht|x)ml|application\/xml|\w+\/\w+\+xml)(?:;|$)/i;let br=function(){return new XMLHttpRequest};var wr,_r;!function(e){e[e.Unsent=0]="Unsent",e[e.Opened=1]="Opened",e[e.HeadersReceived=2]="HeadersReceived",e[e.Loading=3]="Loading",e[e.Done=4]="Done"}(wr||(wr={})),function(e){e.Auto="",e.ArrayBuffer="arraybuffer",e.Blob="blob",e.Document="document",e.Json="json",e.Text="text"}(_r||(_r={}));const Pr=/^(?:|arraybuffer|blob|document|json|text)$/;const Cr="error";class XhrResponse{constructor(e,t,r,n){Object.defineProperties(this,{_xhr:{value:e},state:{enumerable:!0,value:t},response:{enumerable:!0,value:r},error:{enumerable:!0,value:n}})}get status(){return this._xhr.status}get ok(){return(e=this._xhr.status)>=200&&e<300||304===e||1223===e||!e;var e}get statusText(){return this._xhr.statusText}getResponseHeader(e){return this._xhr.getResponseHeader(e)}}Object.defineProperties(XhrResponse.prototype,{responseText:{get:function(){return this._xhr.responseText}},responseXML:{get:function(){return this._xhr.responseXML}}});class XhrRequest{constructor(e,t,r,n,s){Object.defineProperties(this,{method:{enumerable:!0,value:e},url:{enumerable:!0,value:t},options:{enumerable:!0,value:r},_xhr:{value:n},_promise:{value:s}})}get readyState(){return this._xhr.readyState}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}abort(){this._xhr.abort()}}function Sr(e,t=null){const r=t&&t.method||"GET";let n;const s=new Promise((function(s,i){if("string"!=typeof e)throw new TypeError("A resource url is required.");if("string"!=typeof(o=r)||!yr.test(o))throw new TypeError(`Invalid method: ${r}`);var o;let a=null,l=null,u="";if(t&&("string"==typeof t.user&&(a=t.user),"string"==typeof t.password&&(l=t.password),t.responseType&&(u=t.responseType,!function(e){return"string"==typeof e&&Pr.test(e)}(u))))throw new TypeError(`Invalid or unsupported ResponseType: ${u}`);function c(){n&&(n.onreadystatechange&&(n.onreadystatechange=null),n.onload&&(n.onload=null),n.onerror&&(n.onerror=null),n.onabort&&(n.onabort=null),n.ontimeout&&(n.ontimeout=null),n=null)}function p(e){if(n){try{s(new XhrResponse(n,"load",function(e,t){if("response"in e&&e.responseType===t)return e.response;const r=e.getResponseHeader("Content-Type");let n="document"===t?e.responseXML:e.responseText;switch(t){case"arraybuffer":case"blob":throw new Error(`xhr cannot handle ${t}`);case"":case"text":null===n&&(n="");break;case"document":null===n||r&&vr.test(r)||(n=null);break;case"json":if(null!==n)try{n=JSON.parse(n)}catch(e){n=null}break;default:throw new Error(`Internal error: getResponseObject does not handle responseType ${t}`)}return n}(n,u),null))}catch(e){i(new XhrResponse(n,Cr,null,e))}c()}}function h(e){n&&(i(new XhrResponse(n,"abort",null,new Error("Request aborted"))),c())}if(n=br(),"onload"in n&&"onerror"in n?(n.onload=p,n.onerror=function(e){n&&(i(new XhrResponse(n,Cr,null,new Error(n.statusText))),c())}):n.onreadystatechange=function(e){switch(n.readyState){case 4:return p();case 0:return h()}},"onabort"in n&&(n.onabort=h),"ontimeout"in n&&(n.ontimeout=function(e){n&&(i(new XhrResponse(n,"timeout",null,new Error("Connection timeout"))),c())}),n.open(r,e,!0,a,l),t&&(n.withCredentials=!!t.withCredentials,"headers"in t&&function(e,t){for(const r in t)t.hasOwnProperty(r)&&e.setRequestHeader(r,t[r])}(n,Object(t.headers)),t.timeout&&(n.timeout=t.timeout)),"responseType"in n&&u!==n.responseType)try{n.responseType=u}catch(e){}t&&"data"in t?n.send(t.data):n.send()}));return new XhrRequest(r,e,t,n,s)}const xr="undefined"!=typeof globalThis?globalThis:void 0!==typeof self?self:void 0!==typeof window?window:{},Dr="undefined"!=typeof setTimeout?function(e){setTimeout(e,4)}:function(e){e()},Tr=Object.prototype.hasOwnProperty,Ir=!("undefined"==typeof window||"undefined"==typeof navigator||!window.document),Or=!Ir&&"undefined"!=typeof importScripts,Rr=!(Ir||Or)&&"undefined"!=typeof process,Er=Object.freeze({responseType:"text"});const jr="_",Vr={jQuery:!0},kr=/\/\*[\s\S]*?\*\/|([^:"'=]|^)\/\/.*$/gm,Ar=/[^.]\s*require\s*\(\s*["']([^'"\s]+)["']\s*\)/g,Lr=/\.js$/,zr=/^\.\//,Nr=/^https?:\/\//,Mr=/^\/|:|\?|\.js$/,Fr=Function.prototype.call.bind(Tr);function $r(e,t){return Tr.call(e,t)?e[t]:null}function qr(e,t){for(const r in e)if(Tr.call(e,r)&&t(e[r],r))break}function Br(e,t,r,n){return t&&qr(t,(function(t,s){!r&&Fr(e,s)||(!n||"object"!=typeof t||!t||Array.isArray(t)||ye(t)||t instanceof RegExp?e[s]=t:Br(e[s]||(e[s]={}),t,r,n))})),e}function Hr(e,t){return t||""}function Gr(e){const t=e.indexOf("!"),r=new Array(2);return r[0]=t<0?null:e.substring(0,t),r[1]=t<0?e:e.substring(t+1,e.length),r}function Ur(e,t,r,n){const s=Object.defineProperties(new Error(t),{requireType:{enumerable:!0,value:e},requireModules:{enumerable:!0,value:r||null}});return n&&Object.defineProperty(s,"originalError",{enumerable:!0,value:n}),s}function Wr(e){throw e}function Kr(e){!function(e){return!!e.remove}(e)?e.parentNode&&e.parentNode.removeChild(e):e.remove()}const Xr=function(){var e;let t=null;if("undefined"!=typeof requirejs&&"undefined"!=typeof define&&define.amd){const r=null===(e=requirejs.s)||void 0===e?void 0:e.contexts;r&&(qr(r,(function(e){let r=null;return qr(e.registry,(function(e){return e.defining&&(r=e),r})),r&&(t=e),t})),t||(t=r._||null))}return t}(),Jr="undefined"!=typeof navigator&&(navigator.languages&&navigator.languages[0]||navigator.language||navigator.userLanguage)||null,Qr=fr.JavaScript,Yr=Xr&&Xr.config.locale||Jr||"en",Zr="default",en=new Map;function tn(e,t){const r=en.get(t[0]);if(r){const t=function(e,t){if(t){if(t.includes(e))return e;if(t.includes(e.toLowerCase()))return e.toLowerCase();if(e.includes("-")){const r=e.split("-")[0];if(t.includes(r))return r}if(t.includes("root"))return"root"}return null}(e[0],r.languages)||"{{lng}}";return`${r.url}/${t}/${r.filename}.json`}return""}const rn=Jt.createInstance();const nn=new class Nls{constructor(){"undefined"!=typeof window&&void 0!==window.document&&rn.use(mr),rn.init({contextSeparator:":::",nsSeparator:"::",lng:Yr,fallbackLng:"root",fallbackNS:Zr,ns:[],defaultNS:Zr,backend:{loadPath:tn,addPath:""}})}get(e,t){return rn.t(t?`${t}::${e}`:e)}has(e,t){return rn.exists(t?`${t}::${e}`:e)}addBundle(e,t,r="root"){rn.addResourceBundle(r,t||Zr,e)}addNamespace(e,t,r,n){en.set(r||Zr,{url:e,filename:t,languages:n}),rn.loadNamespaces(r||Zr)}getFn(e,t){const r=t?`${t}::${e}`:e;return()=>rn.t(r)}};function sn(e){return Math.max(0,Math.floor(e)||0)}function on(e){if(w(e))return null;if(!ye(e))throw new TypeError(`${e} is not a function.`);return e}class Timer extends Destroyable{constructor(e,t=0,r=!1){super(),this._tid=null,this._time=sn(t),this._tick=on(e),this._auto=!!r}static run(e,t=0,r=!0){return new Timer(e,t,r).start()}destroy(){this.stop(),this._tick=null,super.destroy()}get time(){return this._time}set time(e){this._time=sn(e)}get tick(){return this._tick}set tick(e){this._tick=on(e)}get active(){return null!==this._tid}start(e=this._time){if(null!==this._tid&&(clearTimeout(this._tid),this._tid=null),Destroyable.isDestroyed(this))throw new Error("Timer has been destroyed");return this._tid=setTimeout((()=>{this._tid=null;const e=this._tick;this._auto&&this.destroy(),e&&e()}),"number"!=typeof e?this._time:sn(e)),this}stop(){return null!==this._tid&&(clearTimeout(this._tid),this._tid=null),this}}class Deferred{constructor(){const e=new Promise(((e,t)=>{Object.defineProperties(this,{complete:{enumerable:!0,value:e},error:{enumerable:!0,value:t}})}));Object.defineProperty(this,"promise",{enumerable:!0,value:e})}}const an=new WeakMap;class RenderHandle{constructor(e,r,n,s){an.set(this,r),Object.defineProperties(this,{format:{enumerable:!0,value:e},status:{enumerable:!0,writable:!0,value:t.RenderStatus.Pending},_progress:{writable:!0,value:null},_promise:{value:n},_preRender:{value:s}})}get supportsPause(){const e=an.get(this);return!(!e||!e.supportsPause)}get supportsComplete(){const e=an.get(this);return!(!e||!e.supportsComplete)}get supportsAbort(){const e=an.get(this);return!(!e||!e.supportsAbort)}get onprogress(){return this._progress}set onprogress(e){if(!w(e)&&!ye(e))throw new TypeError("onprogress callback must be null or a function.");this._progress=e||null}then(e,t){return this._promise.then(e,t)}catch(e){return this._promise.catch(e)}pause(){const e=an.get(this);return!!e&&e.requestPause()}resume(){const e=an.get(this);return!!e&&e.requestResume()}complete(){const e=an.get(this);return e?e.requestComplete():this.status===t.RenderStatus.Complete}abort(){const e=an.get(this);return e?e.requestAbort():this.status===t.RenderStatus.Aborted}emitProgress(e){this._progress&&this._progress(e)}invokePreRender(){if(!this._preRender)return null;const e=new Deferred;return this._preRender(e,this),e.promise}}class RenderParameters{constructor(e,t,r){var n;"string"==typeof e?Object.defineProperties(this,{format:{enumerable:!0,value:e},width:{enumerable:!0,value:t},height:{enumerable:!0,value:r}}):"object"==typeof(n=e)&&null!==n&&"getFormat"in n&&"getWidth"in n&&"getHeight"in n&&Object.defineProperties(this,{format:{enumerable:!0,get:e.getFormat.bind(e)},width:{enumerable:!0,get:e.getWidth.bind(e)},height:{enumerable:!0,get:e.getHeight.bind(e)}})}static fromHost(e){return e?new RenderParameters(e):null}getWidth(){return this.width}getHeight(){return this.height}getFormat(){return this.format}}class RenderNotification{get timeout(){return Ie(this).getTimeout()}constructor(e){Oe(this,e)}complete(e,t,r){Ie(this).complete(e,t,r)}fail(e,t,r){Ie(this).fail(e,t,r)}abort(e,t,r){Ie(this).abort(e,t,r)}error(e){Ie(this).error(e)}animating(){Ie(this).animating()}pause(){Ie(this).pause()}resume(){Ie(this).resume()}progress(e,t,r,n){Ie(this).progress(e,t,r,n)}keepAlive(){Ie(this).keepAlive()}getTimeout(){return Ie(this).getTimeout()}}const ln=/^(?:complete|failed|aborted|timeout)$/,un=/^(?:rendering|animating|paused)$/;function cn(e,t,r){t?e.complete(r):e.error(r)}class RenderTask{constructor(e,r){Object.defineProperties(this,{_renderParams:{value:e||new RenderParameters("client")},_status:{writable:!0,value:t.RenderStatus.Pending},_pauseStatus:{writable:!0,value:null},_handles:{value:[]},_handleDfds:{value:[]},_timer:{writable:!0,value:null},_interrupt:{writable:!0,value:null},_progress:{writable:!0,value:0},_linked:{writable:!0,value:null},_notify:{value:new RenderNotification(this)},_onSettle:{value:r},_destroyError:{writable:!0,value:null},_abortRequested:{writable:!0,value:!1}})}get timeout(){return this.getTimeout()}destroy(e){let t=3e3;return this._destroyError=e,this._timer&&(t=Math.max(500,this._timer.time/5),this._timer.destroy(),this._timer=null),this._interrupt?(this._abortRequested||(this.requestAbort(),this._abortRequested=!1),this._timer=new Timer(this._timeout.bind(this),t),this._timer.start()):this.abort("destroy",null==e?void 0:e.message,e),this._handles[this._handles.length-1]}add(e,r=null){if(this._status!==t.RenderStatus.Pending)throw new Error("Render already started, cannot add a handle");const n=new Deferred,s=new RenderHandle(this._renderParams.format,this,n.promise,r);if(e)try{s.onprogress=e}catch(e){return s.status=t.RenderStatus.Failed,n.error(new RenderMessage(s.status,1,"error",e.message,e)),s}return this._handles.push(s),this._handleDfds.push(n),s}execute(e,r,n){n>0&&(this._timer=new Timer(this._timeout.bind(this),n));const s=this._handles,i=this.startRender.bind(this,r),o=this.error.bind(this);function a(){const e=[];for(let t=0,r=s.length;t<r;++t){const r=s[t].invokePreRender();r&&e.push(r)}e.length>0?e.length>1?Promise.all(e).then(i,o):e[0].then(i,o):i()}if(this._setStatus(t.RenderStatus.Blocked),e)try{e(this._renderParams,{complete:a,error:o})}catch(e){o(e)}else a()}startRender(e){var r;if(this._status!==t.RenderStatus.Failed&&this._status!==t.RenderStatus.Aborted)try{if(this._status!==t.RenderStatus.Blocked)throw new Error(`Internal error: cannot render from status ${this._status}`);this._timer&&this._timer.start(),this._setStatus(t.RenderStatus.Rendering);const n=e(this._renderParams,this._notify)||null;if(n&&!("object"==typeof(r=n)&&null!==r&&"supportsPause"in r&&"supportsAbort"in r&&"supportsComplete"in r&&"pause"in r&&"resume"in r&&"complete"in r&&"abort"in r))throw new TypeError("Invalid interrupt api returned by renderer");this._interrupt=n}catch(e){this.error(e)}}link(e){if(this._linked)throw new Error("Cannot link to two different handles.");if(!(e instanceof RenderHandle||(r=e,"object"==typeof r&&null!==r&&"format"in r&&"status"in r&&"supportsPause"in r&&"supportsAbort"in r&&"supportsComplete"in r&&"pause"in r&&"resume"in r&&"complete"in r&&"abort"in r&&"onprogress"in r&&"then"in r&&"catch"in r)))throw new TypeError;var r;const n=e.status;ln.test(n)||(e.onprogress=this._handleProgress.bind(this),n!==t.RenderStatus.Pending&&n!==t.RenderStatus.Blocked&&this._setStatus(n));const s=this._finish.bind(this);e.then(s,s),this._linked=e}complete(e,r,n){this._checkId(e)&&this._finish(new RenderMessage(t.RenderStatus.Complete,1,e,r,n))}fail(e,r,n){this._checkId(e)&&this._finish(new RenderMessage(t.RenderStatus.Failed,1,e,r,n))}abort(e,r,n){this._checkId(e)&&this._finish(this._destroyError&&!this._abortRequested?new RenderMessage(t.RenderStatus.Aborted,0,"destroy",this._destroyError.message,this._destroyError):new RenderMessage(t.RenderStatus.Aborted,0,e,r,n))}error(e){let r=null,n=null;if("string"==typeof e)r=e;else if(e){const t=Object(e);if(!("name"in t)||!("message"in t))throw new TypeError("Invalid _error provided");r=e.message,n=e}this._finish(new RenderMessage(t.RenderStatus.Failed,1,"error",r,n))}animating(){this._status===t.RenderStatus.Rendering&&this._setStatus(t.RenderStatus.Animating)}pause(){this._status!==t.RenderStatus.Rendering&&this._status!==t.RenderStatus.Animating||(this._timer&&this._timer.stop(),this._pauseStatus=this._status,this._setStatus(t.RenderStatus.Paused))}resume(){this._status===t.RenderStatus.Paused&&(this._setStatus(this._pauseStatus),this._pauseStatus=null,this._timer&&this._timer.start())}progress(e,t,r,n){this._handleProgress(new RenderMessage(this._status,e,t,r,n))}keepAlive(){this._handleProgress(null)}getTimeout(){return this._timer?this._timer.time:0}get supportsPause(){return this._linked?this._linked.supportsPause:null!==this._status&&(un.test(this._status)&&!(!this._interrupt||!this._interrupt.supportsPause))}get supportsAbort(){return this._linked?this._linked.supportsAbort:null!==this._status&&(this._status===t.RenderStatus.Pending||un.test(this._status)&&!(!this._interrupt||!this._interrupt.supportsAbort))}get supportsComplete(){return this._linked?this._linked.supportsComplete:null!==this._status&&(un.test(this._status)&&!(!this._interrupt||!this._interrupt.supportsComplete))}requestAbort(){if(this._linked)return this._linked.abort();let e=this.supportsAbort;return e&&(this._abortRequested=!0,this._status===t.RenderStatus.Pending?(this.abort(),e=!0):e=!!this._interrupt.abort(this._notify)),e}requestPause(){return this._linked?this._linked.pause():this._status===t.RenderStatus.Paused||this.supportsPause&&!!this._interrupt.pause(this._notify)}requestResume(){return this._linked?this._linked.resume():this._status===t.RenderStatus.Rendering||this._status===t.RenderStatus.Animating||this.supportsPause&&!!this._interrupt.resume(this._notify)}requestComplete(){return this._linked?this._linked.complete():this._status===t.RenderStatus.Complete||this.supportsComplete&&!!this._interrupt.complete(this._notify)}_checkId(e){const t=null===e||"object"!=typeof e||!("then"in e);return t||this.error(new Error("RenderingService attempted to complete a render with a Promise")),t}_setStatus(e){if(this._status===e)return;if(e===t.RenderStatus.Pending||e===t.RenderStatus.Blocked&&this._status!==t.RenderStatus.Pending||ln.test(this._status))throw new Error(`Status cannot go from ${this._status} to ${e}`);this._status=e;const r=this._handles.length-1;let n=null;if(null===e||ln.test(e)||e===t.RenderStatus.Blocked||(n=new RenderMessage(e,this._progress,"status",null,e)),r>=0){let t;if(r>0){const s=n&&n.makeObsolete(!0);for(let n=0;n<r;++n)t=this._handles[n],t.status=e,s&&t.emitProgress(s)}t=this._handles[r],t.status=e,n&&t.emitProgress(n)}}_handleProgress(e){if(!this._timer||this._status!==t.RenderStatus.Rendering&&this._status!==t.RenderStatus.Animating||this._timer.start(),!e)return;this._progress=e.progress,this._status!==e.status&&this._setStatus(e.status);const r=this._handles.length-1;if(r>=0){if(r>0){const t=e.makeObsolete(!0);for(let e=0;e<r;++e)this._handles[e].emitProgress(t)}this._handles[r].emitProgress(e.makeObsolete(!1))}}_timeout(){this._finish(new RenderMessage(t.RenderStatus.Timeout,0,"timeout",this._destroyError?this._destroyError.message:null,this._destroyError))}_finish(e){if(!(e instanceof RenderMessage))throw new TypeError("Attempt to finish a RenderQueue Task without a RenderMessage");if(!ln.test(this._status)){const r=e.status;if(!ln.test(r))throw new Error(`Attempt to finish render task with status ${r}`);this._setStatus(r),this._progress=e.progress,this._timer&&this._timer.destroy();const n=this._handles.length-1,s=r===t.RenderStatus.Complete||r===t.RenderStatus.Aborted&&this._abortRequested;if(n>=0){let t=0;if(n>0){const r=e.makeObsolete(!0);for(;t<n;++t)cn(this._handleDfds[t],s,r),an.delete(this._handles[t])}cn(this._handleDfds[n],s,e.makeObsolete(!1)),an.delete(this._handles[t]),this._handleDfds.length=this._handles.length=0}this._onSettle(this,e),this._timer=this._interrupt=this._linked=null}}}class RenderQueue{constructor(e,t,r=null,n=0){if(!w(e)&&!ye(e))throw new TypeError(`The before function: ${e} is not a function.`);if(!ye(t))throw new TypeError(`A render function is required, ${t} is not a function.`);if(!w(r)&&!ye(r))throw new TypeError(`The after function: ${r} is not a function`);Object.defineProperties(this,{_current:{writable:!0,value:null},_next:{writable:!0,value:null},_before:{writable:!0,value:e},_render:{value:t},_after:{writable:!0,value:r},_timeout:{writable:!0,value:0},_destroyError:{writable:!0,value:null},_destroyPromise:{writable:!0,value:null},_afterTaskBound:{value:this._afterTask.bind(this)}}),n&&(this.timeout=n)}static link(e,t){if(!(e instanceof RenderNotification))throw new TypeError("_notify was not created by a RenderQueue");if(!(t instanceof RenderHandle))throw new TypeError("_handle was not created by a RenderQueue");Ie(e).link(t)}get timeout(){return this._timeout}set timeout(e){this._timeout=Math.max(0,Math.floor(e)||0)}destroy(e){return this._destroyPromise||(this._destroyError=e||new Error("destroy"),this._destroyPromise=new Promise(this._destroy.bind(this))),this._destroyPromise}_destroy(e,t){const r=this._current,n=this._next;let s=null;this._current=this._next=null,r&&(s=r.destroy(this._destroyError)),n&&n.destroy(this._destroyError),this._before=null,this._after=null,this._destroyError=null,s?s.then(e,t):e()}add(e,t,r){let n=this._next;n||(this._next=n=new RenderTask(e,this._afterTaskBound));const s=n.add(t,r);return this._current||this._execute(),s}_execute(){if(!this._destroyPromise){if(this._current)throw new Error("Cannot execute render, another render is still in progress");this._current=this._next,this._next=null,this._current.execute(this._before,this._render,this._timeout)}}_afterTask(e,t){this._current===e?(this._current=null,this._after&&this._after(t),this._next&&Timer.run((()=>{this._next&&!this._current&&this._execute()}),0)):this._next===e&&(this._next=null)}}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */function pn(e,t,r,n){return new(r||(r=Promise))((function(s,i){function o(e){try{l(n.next(e))}catch(e){i(e)}}function a(e){try{l(n.throw(e))}catch(e){i(e)}}function l(e){var t;e.done?s(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,a)}l((n=n.apply(e,t||[])).next())}))}class DataContext{constructor(){Object.defineProperties(this,{_owner:{value:new WeakMap},_reference:{value:new WeakMap}})}static setOwner(e,t,r){e._owner.set(t,r)}static setReference(e,t,r){e._reference.set(t,r)}getOwner(e){const t=this._owner.get(e);if(!t)throw new Error("Data context owner not initialized");return t}getReference(e){const t=this._reference.get(e);if(!t)throw new Error("Data context reference not initialized.");return t}}Object.defineProperties(DataContext,{vipr:{enumerable:!0,value:new DataContext}});class DataContextView{constructor(e){Oe(this,e)}}class RSv1DataContext extends DataContextView{constructor(e){super(e)}getOwner(e){return Ie(this).getOwner(e)}getReference(e){return Ie(this).getReference(e)}}
/*
     *@license
     * Licensed Materials - Property of IBM
     *
     * IBM @vida/vipr-rs-v1
     *
     * (C) Copyright IBM Corp. 2023
     *
     * US Government Users Restricted Rights - Use, duplication or
     * disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
     */var hn,dn,fn,gn,mn,yn,vn,bn,wn,_n,Pn,Cn,Sn,xn;!function(e){e.Cat="cat",e.Cont="cont"}(hn||(hn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"cat":return e.Cat;case"cont":return e.Cont;default:return null}}}(hn||(hn={})),function(e){e.Custom="custom",e.Structured="structured"}(dn||(dn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"custom":return e.Custom;case"structured":return e.Structured;default:return null}}}(dn||(dn={})),function(e){e.Data="data",e.Label="label"}(fn||(fn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"data":return e.Data;case"label":return e.Label;default:return null}}}(fn||(fn={})),function(e){e.Cat="cat",e.Cont="cont",e.Any="any"}(gn||(gn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"cat":return e.Cat;case"cont":return e.Cont;case"any":return e.Any;default:return null}}}(gn||(gn={})),function(e){e.Missing="missing",e.Numeric="numeric"}(mn||(mn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"missing":return e.Missing;case"numeric":return e.Numeric;default:return null}}}(mn||(mn={})),function(e){e.Sum="sum",e.Average="average",e.Accumulate="accumulate"}(yn||(yn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"sum":return e.Sum;case"average":return e.Average;case"accumulate":return e.Accumulate;default:return null}}}(yn||(yn={})),function(e){e.Cat="cat",e.Cont="cont",e.Custom="custom"}(vn||(vn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"cat":return e.Cat;case"cont":return e.Cont;case"custom":return e.Custom;default:return null}}}(vn||(vn={})),function(e){e.Normal="normal",e.Italic="italic",e.Oblique="oblique"}(bn||(bn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"normal":return e.Normal;case"italic":return e.Italic;case"oblique":return e.Oblique;default:return null}},e.toCssString=function(e){return null===e?"":e}}(bn||(bn={})),function(e){e[e.Thin=100]="Thin",e[e.ExtraLight=200]="ExtraLight",e[e.Light=300]="Light",e[e.Normal=400]="Normal",e[e.Medium=500]="Medium",e[e.SemiBold=600]="SemiBold",e[e.Bold=700]="Bold",e[e.ExtraBold=800]="ExtraBold",e[e.Heavy=900]="Heavy"}(wn||(wn={})),function(e){e.fromValue=function(t){switch(t){case 100:return e.Thin;case 200:return e.ExtraLight;case 300:return e.Light;case 400:return e.Normal;case 500:return e.Medium;case 600:return e.SemiBold;case 700:return e.Bold;case 800:return e.ExtraBold;case 900:return e.Heavy;default:return null}},e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"100":return e.Thin;case"200":return e.ExtraLight;case"300":return e.Light;case"400":case"normal":return e.Normal;case"500":return e.Medium;case"600":return e.SemiBold;case"700":case"bold":return e.Bold;case"800":return e.ExtraBold;case"900":return e.Heavy;default:return null}},e.toCssString=function(t){if(null===t)return"";switch(t){case e.Normal:return"normal";case e.Bold:return"bold";default:return t.toString()}}}(wn||(wn={})),function(e){e.Data="data"}(_n||(_n={})),function(e){e.parse=function(t){return null===t?null:"data"===t.toLowerCase()?e.Data:null}}(_n||(_n={})),function(e){e.Em="em",e.Ex="ex",e.Percentage="%",e.Centimeter="cm",e.Millimeter="mm",e.Inch="in",e.Pica="pc",e.Point="pt",e.Pixel="px"}(Pn||(Pn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"em":return e.Em;case"ex":return e.Ex;case"%":return e.Percentage;case"cm":return e.Centimeter;case"mm":return e.Millimeter;case"in":return e.Inch;case"pc":return e.Pica;case"pt":return e.Point;case"px":return e.Pixel;default:return null}}}(Pn||(Pn={})),function(e){e.Separate="separate",e.Absolute="absolute",e.Aggregate="aggregate",e.Ignore="ignore"}(Cn||(Cn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"separate":return e.Separate;case"absolute":return e.Absolute;case"aggregate":return e.Aggregate;case"ignore":return e.Ignore;default:return null}}}(Cn||(Cn={})),function(e){e.Cat="cat",e.Cont="cont",e.CustomCat="customcat",e.CustomCont="customcont"}(Sn||(Sn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"cat":return e.Cat;case"cont":return e.Cont;case"customcat":return e.CustomCat;case"customcont":return e.CustomCont;default:return null}}}(Sn||(Sn={})),function(e){e.Boolean="boolean",e.Color="color",e.Enum="enum",e.Font="font",e.Length="length",e.Number="number",e.String="string",e.Palette="palette"}(xn||(xn={})),function(e){e.parse=function(t){if(null===t)return null;switch(t.toLowerCase()){case"boolean":return e.Boolean;case"color":return e.Color;case"enum":return e.Enum;case"font":return e.Font;case"length":return e.Length;case"number":return e.Number;case"string":return e.String;case"palette":return e.Palette;default:return null}}}(xn||(xn={}));var Dn=Object.freeze({__proto__:null,get RSAggregationCapability(){return yn},get RSDataItemType(){return hn},get RSDataSetType(){return dn},get RSEncodingType(){return vn},get RSFontStyle(){return bn},get RSFontWeight(){return wn},get RSFormatKind(){return fn},get RSHittableType(){return _n},get RSLengthUnit(){return Pn},get RSNegativeHandlingCapability(){return Cn},get RSPaletteType(){return Sn},get RSPropertyType(){return xn},get RSSlotType(){return gn},get RSValueType(){return mn}});function Tn(e,t,r="Entry",n=0){const s=t-n;if(s<0||s>=e.length)throw new RangeError(`${r} index ${t} out of range [${n} - ${n+e.length-1}]`);return e[s]}function In(e,t,r=0){const n=t-r;return n<0||n>=e.length?null:e[n]}class Capability{constructor(e,t,r){Object.defineProperties(this,{slot:{enumerable:!0,value:e},name:{enumerable:!0,value:t},attributes:{enumerable:!0,value:r||b}})}getSlot(){return this.slot}getName(){return this.name}getAttributes(){return this.attributes}}class VizServiceNotification{constructor(e,t,r,n,s,i){Object.defineProperties(this,{level:{enumerable:!0,value:e},type:{enumerable:!0,value:t},id:{enumerable:!0,value:r},description:{enumerable:!0,value:n},localizedMessage:{enumerable:!0,value:s},payload:{enumerable:!0,value:i}})}getLevel(){return this.level}getType(){return this.type}getId(){return this.id}getDescription(){return this.description}getLocalizedMessage(){return this.localizedMessage}getPayload(){return this.payload}toString(){return this.description}}const On=[];class DataObject{constructor(e){Object.defineProperties(this,{source:{value:e}})}static validateFormatKind(e){if(!V(e))throw new TypeError(`Invalid FormatKind: ${e}`);return e}static joinCaptions(e,t,r){On.length=0;for(const e of r)On.push(e.getCaption(t));const n=e.format(On);return On.length=0,n}static joinLegendCaptions(e,t,r){On.length=0;for(const e of t)On.push(e.getLegendCaption(r));const n=e.format(On);return On.length=0,n}static joinSubCaptions(e,t,r){On.length=0;for(const e of r)On.push(e.getSubCaption(t));const n=e.format(On);return On.length=0,n}static joinCombinedCaptions(e,t,r){On.length=0;for(const e of r)On.push(e.combineCaptions(t));const n=e.format(On);return On.length=0,n}get infoType(){return this.getInfoType()}getSource(){return this.source}getHittableType(){return t.HittableType.Data}getRSHittableType(){return t.HittableType.Data}}class SliceResult{constructor(e,t){Object.defineProperties(this,{dataItems:{enumerable:!0,value:e},slices:{enumerable:!0,value:t}})}}const Rn=/\{\{|\}\}|\{(\d+)\}/g;function En(e,...t){return w(e)?y:String(e).replace(Rn,(function(e,r){if(r){if(r in t)return String(t[r]);throw new RangeError(`No replacement for {${r}}, it is out of bounds (${t.length})`)}return e.charAt(0)}))}class TruncationFactory{constructor(e){Object.defineProperties(this,{_truncations:{value:[]},_nls:{value:e}})}addSlot(e,t,r,n,s){if(!n||!s)throw new Error("_slotRef and _dataItem are mandatory");this._addLimit(e,t,r,n,s)}addData(e,t,r){this._addLimit(e,t,r,null,null)}addUnaggregated(){this._findUnaggregated()||this._truncations.push(new UnaggregatedTruncation(this._nls.duplicate_truncation))}create(){return this._truncations.length<1?null:new TruncationInfo(this._nls.data_truncation,Object.freeze(this._truncations))}_findLimit(e){for(const t of this._truncations)if(t instanceof LimitTruncation&&t.capability===e)return t;return null}_findUnaggregated(){for(const e of this._truncations)if(e instanceof UnaggregatedTruncation)return e;return null}_addLimit(e,t,r,n,s){let i=this._findLimit(e);if(!i||i.slotRef!==n||i.dataItem!==s){const o=new LimitTruncation(n?En(this._nls.tuple_truncation,n.caption,t,r):En(this._nls.datapoint_truncation,t),e,t,r,n,s);if(i)if(r>i.full)this._truncations[this._truncations.indexOf(i)]=o,o.next=i;else{let e=i.next;for(;e&&r<e.full;)i=e,e=e.next;i.next=o,o.next=e||null}else this._truncations.push(o)}return i}}function jn(e){return e&&e.empty()}class VIPRData extends DataObject{constructor(e,t,r,n,s,i=null){super(e),Object.defineProperties(this,{_vizDef:{value:t},_decoFilter:{value:r},mapping:{value:n},dataSets:{enumerable:!0,value:s},_slicedFrom:{value:i||null},_sourceVersion:{writable:!0,value:NaN},_version:{writable:!0,value:0}})}static isSliced(e){return!!e._slicedFrom}get decorationsVersion(){return this.getDecorationsVersion()}getMapping(){return this.mapping}getDataSets(){return this.dataSets}getDataSet(e){const t=this._vizDef.dataSets;for(let r=t.length-1;r>=0;--r){if(t[r].name===e)return this.dataSets[r]}throw new RangeError(`There is no data set named "${e}"`)}getDecorationsVersion(){return this._version}refreshDecorations(){if(this._slicedFrom)this._version=this._slicedFrom.refreshDecorations(),this._sourceVersion=this._slicedFrom._sourceVersion;else{const e=this.source?this.source.getDecorationsVersion():0;if(e!==this._sourceVersion){++this._version,this._sourceVersion=e;for(const e of this.dataSets)e&&e.setDataPointDecorationsDirty()}}return this._version}empty(){return new VIPRData(this.source,this._vizDef,this._decoFilter,this.mapping,this.dataSets.map(jn),this._slicedFrom)}filterDecorations(e){let t=this._decoFilter.size>0;if(t&&this._decoFilter.clear(),e&&(e.forEach((function(e){"string"==typeof e&&this._decoFilter.add(e)}),this),!t&&this._decoFilter.size>0&&(t=!0)),t){++this._version;for(const e of this.dataSets)e&&e.setDataPointDecorationsDirty()}}getDataSetInfos(){return this.dataSets}getDataSetInfo(e){return this.getDataSet(e)}getDataSetInfoCount(){return this.dataSets.length}getDataSetAt(e){return Tn(this.dataSets,e,"DataSet")}getInfoType(){return t.InfoType.VIPRData}getRSHittableType(){return _n.Data}getCommonSlots(e){let t=null;if(!this||!e||!e.length)return t;const r=[...new Set(e.map((e=>e.getSlot())))],n=((e,t)=>{class SlotRefMock{constructor(e){this.name=e}}const r=new Map,n=[],s=t.filter((e=>e)).map((e=>new SlotRefMock(e)));for(let t=0;t<this.getDataSetInfoCount();t++){const r=e.getDataSetMapping(t);r&&n.push(r)}return n.forEach((e=>{s.forEach((t=>{const n=e.getDataItemsFor(t);n&&n.length&&r.set(t.name,n[0])}))})),r})(this.getMapping(),r);if(n&&n.size){const e=[...n.values()].filter(((e,t,r)=>r.indexOf(e)!==t));if(e.length){const r=new Map;e.forEach((e=>r.set(e,[]))),n.forEach(((t,n)=>{-1!==e.indexOf(t)&&r.set(t,r.get(t).concat(n))})),t=r}}return t}updateCapabilities(e){if(null===e)return e;const t=e.slice(),r=this.getCommonSlots(e);return r&&r.size>0&&r.forEach((e=>{let r;t.forEach((t=>{t.getSlot()&&e.includes(t.getSlot())&&(r=r?Math.min(r,t.getAttributes().get("n")):t.getAttributes().get("n"))})),t.forEach(((n,s)=>{if(n.getSlot()&&e.includes(n.getSlot())&&n.getAttributes().get("n")>r){const e=new Map;n.getAttributes().forEach(((t,r)=>{e.set(r,t)})),e.set("n",r);const i=new Capability(n.getSlot(),n.getName(),Object.freeze(e));t.splice(s,1,i)}}))})),Object.freeze(t)}slice(e,r,n,s){const i=[];if(this._slicedFrom)throw new Error("VIPRData is already processed");const o=this.dataSets.length;let a=1;const l=new TruncationFactory(s),u=this.updateCapabilities(r),c=this.dataSets.map((function(t,r){const n=t&&t.slice(e,i,u,l);return n&&n.length>a&&(a=n.length),n})),p=new Array(a);for(let e=0;e<a;++e){const t=new Array(o);for(let r=0;r<o;++r){const n=c[r];t[r]=n&&n[1===n.length?0:e]}p[e]=new VIPRData(this.source,this._vizDef,this._decoFilter,this.mapping,t,this)}const h=l.create();if(h&&n&&n.notify){const e=new VizServiceNotification(t.Severity.Warning,"truncate",`truncation_${h.id}`,"truncation",h.message,h);try{n.notify(e)}catch(e){}}return new SliceResult(i,p)}initDataContext(e){if(!e)throw new Error("_context cannot be null");for(const t of this.dataSets)t&&t.applyContext(e,this);return this}}class PropertyValueEventArgs extends EventArgs{constructor(e,t){super(),Object.defineProperties(this,{property:{enumerable:!0,value:e},oldValue:{enumerable:!0,value:t}})}}function Vn(e){return e.isDirtyLocked()}class PropertyView{constructor(e){Oe(this,e)}get name(){return this.getName()}get active(){return this.isActive()}get visualItems(){return this.getVisualItems()}getName(){return Ie(this).def.name}isActive(){return Ie(this).isActive()}getVisualItems(){return Ie(this).getPropsToRSVisualItemsMap().get(this.name)}}class VizProperty{constructor(e,t){Oe(this,e)}get def(){return this.getDef()}get active(){return this.isActive()}get type(){return this.getType()}get name(){return this.getName()}get caption(){return this.getCaption()}get description(){return this.getDescription()}get aliases(){return this.getAliases()}get tags(){return this.getTags()}get visibility(){return this.getVisibility()}get deprecated(){return this.isDeprecated()}get affectedBy(){return this.getAffectedBy()}get visualItems(){return this.getVisualItems()}getDef(){return Ie(this).def}isActive(){return Ie(this).isActive()}getType(){return this.getDef().type}getName(){return this.getDef().name}getVisualItems(){return Ie(this).getPropsToVizVisualItemsMap().get(this.name)}getCaption(){return this.getDef().caption}getDescription(){return this.getDef().description}getAliases(){return this.getDef().aliases}getTags(){return this.getDef().tags}getVisibility(){return this.getDef().visibility}isDeprecated(){return this.getDef().deprecated}getAffectedBy(){return this.getDef().affectedBy}on(e,t){return Ie(this).on(e,(e=>{t(e,this)}))}}class Property extends Evented{constructor(e,t,r){super(),Object.defineProperties(this,{_flags:{writable:!0,value:1},_def:{writable:!0,value:e},_propsToVizVisualItemsMap:{enumerable:!0,value:t},_propsToRSVisualItemsMap:{enumerable:!0,value:r}})}get def(){return this._def}isActive(){return 0!=(1&this._flags)}setActive(e){this.isActive()!==e&&(e?this._flags|=1:this._flags&=-2,this.emit("active",new PropertyActiveEventArgs(this.toHost(),!e)))}lock(){const e=!this.isLocked();return e&&(this._flags|=2),e}unlock(e){const t=this.isLocked();return t&&(this._flags&=-3,this._markRendered(e)),t}isLocked(){return 0!=(2&this._flags)}hasDefaultValue(){return 0!=(4&this._flags)}setIsDefaultValue(e){return this.hasDefaultValue()!==e&&(e?this._flags|=4:this._flags&=-5),e}setPropertyDef(e){if(this._def!==e){if(e.name!==this._def.name)throw new Error(`Attempted to update property ${this._def.name} with VizDef of property `);if(e.type!==this._def.type)throw new Error(`Attempted to update property ${this._def.name} from ${this._def.type} to ${e.type}`);this._def=e,this._updateFromDef()}}getPropsToVizVisualItemsMap(){return this._propsToVizVisualItemsMap}getPropsToRSVisualItemsMap(){return this._propsToRSVisualItemsMap}postInit(){}}const kn=void 0;function An(e){return!!e&&e.def.type!==t.PropertyType.Group}function Ln(e,t){const r=e.get(t);return r&&Ie(r)}class ValuePropertyAdapter extends PropertyView{constructor(e){super(e),Object.defineProperties(this,{_value:{writable:!0,value:null},_peek:{writable:!0,value:null}})}get value(){return this.getValue()}set value(e){this.setValue(e)}get peek(){return this.peekValue()}get active(){return this.isActive()}set active(e){this.setActive(e)}get dirty(){return this.isDirty()}get writable(){return this.isWritable()}getValue(){return this._value}setValue(e){if(!this.isWritable())throw new Error(`${this.name} is not writable`);return Ie(this).setValue(this.parseRenderer(e),e),this.peekValue()}peekValue(){return this._normalize(Ie(this).getValue())}setActive(e){return Ie(this).setActive(e),e}isDirty(){return Ie(this).isDirtyLocked()}isWritable(){const e=Ie(this).def;return e.serviceWritable&&!e.deprecated}parseHost(e,t,r){let n=e;const s=this._normalize(e),i=r?s:this._parseHost(s,t,this._peek);return i!==s&&(n=this._parseRenderer(i)),this._peek=i,n}parseRenderer(e){if(w(e)||"string"==typeof e){const t=Ie(this);return t.parse(e,t.getValue())}return this._parseRenderer(e)}updateValue(){this._value=this._peek}init(){if(null!==this._value||null!==this._peek)throw new Error("Already intialized");this._value=this._peek=this._normalize(Ie(this).getValue())}}class DeprecatedAdapter{constructor(e,t){Object.defineProperties(this,{_hostProperties:{value:e},_rendererView:{value:t},_setMap:{value:new Map},_updating:{writable:!0,value:!1}});const r=Ie(t);if(r.def.affectedBy.length>0){const t=this._onAffectedByValue.bind(this);for(const n of r.def.affectedBy){const r=Ln(e,n);if(!r)throw new Error(`AffectedBy references non-existing property ${n}`);An(r)&&r.on("value",t)}}}setValue(){if(!this._updating&&(this._setMap.clear(),this._setValue(this._rendererView.peekValue(),this._setMap),this._setMap.size>0)){this._updating=!0;try{this._setMap.forEach(((e,t)=>{const r=this._resolveView(t),n=r&&Ln(this._hostProperties,t);r&&n&&An(n)&&!n.def.deprecated&&n.setValue(r.parseRenderer(e),e)}))}finally{this._updating=!1}this._setMap.clear()}}_onAffectedByValue(){if(this._updating)return;this._updating=!0;const e=this._evaluate(this._rendererView.peekValue());Ie(this._rendererView).setValue(this._rendererView.parseRenderer(e),e),this._updating=!1}}class VizValueProperty extends VizProperty{constructor(e,t){super(e,t)}get value(){return this.getValue()}set value(e){this.setValue(e)}get dirty(){return this.isDirty()}get allowNull(){return this.getAllowNull()}get defaultValue(){return this.getDefaultValue()}get serviceWritable(){return this.isServiceWritable()}get requiresData(){return this.getRequiresData()}hasDefaultValue(){return Ie(this).hasDefaultValue()}resetValue(){return Ie(this).resetValue()}getValue(){return Ie(this).getValue()}setValue(e){const t=Ie(this);return t.setValue(t.parse(e),e)}isActive(){return Ie(this).isActive()}isDirty(){return Ie(this).isDirty()}getAllowNull(){return this.getDef().allowNull}getDefaultValue(){return this.getDef().defaultValue}isServiceWritable(){return this.getDef().serviceWritable}getRequiresData(){return this.getDef().requiresData}}class ValueProperty extends Property{constructor(e,t,r){super(e,t,r),Object.defineProperties(this,{_value:{writable:!0,value:null},_lockedValue:{writable:!0,value:null},_renValue:{writable:!0,value:kn},_rendererView:{writable:!0,value:null},_deprecated:{writable:!0,value:null}}),this._value=this._lockedValue=this._normalize(e.defaultValue),this.setIsDefaultValue(!0)}init(e,t){if(this._rendererView)throw new Error(`Property ${this.def.name} is already initialized`);if(Ie(e)!==this)throw new Error("View is not for this property");if(this.def.deprecated&&!t)throw new Error(`Deprecated property ${this.def.name} requires a deprecated adapter`);this._rendererView=e,this._deprecated=t,this._rendererView.init()}parse(e,t=this._value){return this._normalize(this._def.parse(e,t))}getValue(){return this._value}getValueLocked(){return this._lockedValue}setValue(e,t,r=!1){const n=this.setIsDefaultValue(void 0===t),s=this._rendererView?this._rendererView.parseHost(e,t,n):e;if(r||!this._valuesEqual(s,this._value)){const e=this._value;this._value=s,this._deprecated&&this._deprecated.setValue(),this.isLocked()||(this._lockedValue=s,this._rendererView&&this._rendererView.updateValue()),Destroyable.isDestroyed(this)||this.emit("value",new PropertyValueEventArgs(this.toHost(),e))}else this._deprecated&&this._deprecated.setValue();return this._value}resetValue(){this.setValue(this._normalize(this._def.defaultValue),void 0)}isDirty(){return this._value!==this._renValue}isDirtyLocked(){return this._lockedValue!==this._renValue}_markRendered(e){e&&(this._renValue=this._lockedValue),this._lockedValue=this._value,this._rendererView&&this._rendererView.updateValue()}_updateFromDef(){this.hasDefaultValue()&&this.resetValue()}_valuesEqual(e,t){return e===t}}class RSv1ValueProperty extends ValuePropertyAdapter{constructor(e,t){super(e),Object.defineProperties(this,{_parser:{value:t}})}getRSType(){return this.type}_parseHost(e,t,r){return this._parser?this._parser.parseValue(e,t,r):e}}Object.defineProperties(RSv1ValueProperty.prototype,{valueOf:{value:function(){return this.getValue()}}});class RSv1BooleanProperty extends RSv1ValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return e}}Object.defineProperty(RSv1BooleanProperty.prototype,"type",{enumerable:!0,value:xn.Boolean});class RSv1CustomData{constructor(e){Object.defineProperties(this,{payload:{enumerable:!0,value:e}})}get type(){return this.getType()}get id(){return this.getId()}getHittableType(){return t.HittableType.Data}getInfoType(){return t.InfoType.CustomData}getType(){return this.payload.getType()}getId(){return this.payload.getId()}getPayload(){return this.payload}equals(e){return"object"==typeof(t=e)&&!!t&&"getPayload"in t&&(this.payload===e.getPayload()||this.infoType===e.getInfoType()&&this.id===e.getId()&&this.type===e.getType()&&function(e){return"object"==typeof e&&!!e&&"equals"in e}(this.payload)&&this.payload.equals(e.getPayload()));var t}getSource(){return this.source}}Object.defineProperties(RSv1CustomData.prototype,{infoType:{enumerable:!0,value:t.InfoType.CustomData},source:{enumerable:!0,value:null}});class RSv1CustomDataDecorated extends RSv1CustomData{constructor(e,t){super(e),Object.defineProperties(this,{customSet:{enumerable:!0,value:t}})}getCustomSet(){return this.customSet}setDecoration(e,t){return this.payload.setDecoration(e,t),!0}removeDecoration(e){return this.payload.removeDecoration(e),!0}clearDecorations(){return this.payload.clearDecorations(),!0}hasDecoration(e){return this.payload.hasDecoration(e)}getDecoration(e){return this.payload.getDecoration(e)}}class AxisItem{constructor(e,t,r,n,s){Object.defineProperties(this,{type:{enumerable:!0,value:e},slot:{enumerable:!0,value:t},tuple:{enumerable:!0,value:r},value:{enumerable:!0,value:n},hittableType:{enumerable:!0,value:s}})}getType(){return this.type}getSlot(){return this.slot}getTuple(){return this.tuple}getValue(){return this.value}getHittableType(){return this.hittableType}}class Bounds{constructor(e,t,r,n){Object.defineProperties(this,{left:{enumerable:!0,value:e},top:{enumerable:!0,value:t},right:{enumerable:!0,value:r},bottom:{enumerable:!0,value:n}})}get width(){return this.getWidth()}get height(){return this.getHeight()}getLeft(){return this.left}getTop(){return this.top}getRight(){return this.right}getBottom(){return this.bottom}getWidth(){return this.right-this.left}getHeight(){return this.bottom-this.top}}class Encoding{constructor(e,t,r,n,s,i){Object.defineProperties(this,{type:{enumerable:!0,value:e},channel:{enumerable:!0,value:r},slot:{enumerable:!0,value:t},caption:{enumerable:!0,value:n},subCaption:{enumerable:!0,value:s},ref:{enumerable:!0,value:i}})}getType(){return this.type}getSlot(){return this.slot}getChannel(){return this.channel}getCaption(){return this.caption}getSubCaption(){return this.subCaption}getRef(){return this.ref}}class CatEncoding extends Encoding{constructor(e,r,n,s,i,o){super(t.EncodingType.Cat,e,r,n,s,i),Object.defineProperties(this,{entries:{enumerable:!0,value:o}})}getEntries(){return this.entries}}class CatEncodingEntry{constructor(e,t,r,n,s,i){Object.defineProperties(this,{caption:{enumerable:!0,value:e},color:{enumerable:!0,value:t||null},shape:{enumerable:!0,value:r||null},selected:{enumerable:!0,value:!1!==n},highlighted:{enumerable:!0,value:!1!==s},ref:{enumerable:!0,value:i||null}})}getCaption(){return this.caption}getColor(){return this.color}getShape(){return this.shape}isSelected(){return this.selected}isHighlighted(){return this.highlighted}getRef(){return this.ref}}function zn(e){if("number"!=typeof e)throw new TypeError("Not a valid number");return e}class ContDomain{constructor(e,t,r,n){Object.defineProperties(this,{min:{enumerable:!0,value:zn(e)},max:{enumerable:!0,value:zn(t)},empty:{enumerable:!0,value:!0===r},explicit:{enumerable:!0,value:!0===n}})}static fromHost(e){if(e){if(e instanceof ContDomain)return e;if("object"==typeof(t=e)&&null!==t&&"getMin"in t&&"getMax"in t&&"isEmpty"in t&&"isExplicit"in t)return new ContDomain(e.getMin(),e.getMax(),e.isEmpty(),e.isExplicit());if(function(e){return"object"==typeof e&&null!==e&&"min"in e&&"max"in e}(e)){const t=!0===e.empty||null===e.min&&null===e.max;return new ContDomain(t?0:e.min,t?0:e.max,t,!0===e.explicit)}}var t;return null}getMin(){return this.min}getMax(){return this.max}isEmpty(){return this.empty}isExplicit(){return this.explicit}equals(e){if(e===this)return!0;let t=0,r=0,n=!this.empty,s=!this.explicit;return e instanceof ContDomain&&(t=e.min,r=e.max,n=e.empty,s=e.explicit),n===this.empty&&s===this.explicit&&t===this.min&&r===this.max}toString(){return this.empty?"[]":`[ ${this.min}, ${this.max} ]`}}Object.defineProperties(ContDomain,{EMPTY:{enumerable:!0,value:new ContDomain(0,0,!0,!1)}});class ContEncoding extends Encoding{constructor(e,r,n,s,i,o,a,l){super(t.EncodingType.Cont,e,r,n,s,i),Object.defineProperties(this,{domain:{enumerable:!0,value:o},interpolate:{enumerable:!0,value:a},stops:{enumerable:!0,value:l}})}getDomain(){return this.domain}getInterpolate(){return this.interpolate}getStops(){return this.stops}}class CustomEncoding extends Encoding{constructor(e,r,n,s,i,o){super(t.EncodingType.Custom,e,r,n,s,i),Object.defineProperties(this,{payload:{enumerable:!0,value:o}})}getPayload(){return this.payload}}class Region{constructor(e,t,r){Object.defineProperties(this,{name:{enumerable:!0,value:e},slots:{enumerable:!0,value:t},bounds:{enumerable:!0,value:r}})}getName(){return this.name}getSlots(){return this.slots}getBounds(){return this.bounds}}class ResolvedColorStop extends ColorStop{constructor(e,t,r){super(e,t,r)}getColor(){return this.color}getAt(){return this.at}getValue(){return this.value}}const Nn=new WeakMap;function Mn(e,t){return Nn.set(e,t),t}function Fn(e,t){if(e){if(e instanceof DataObject)return e;if(Array.isArray(e))return e.map((e=>Fn(e))).filter((e=>null!==e));if("object"==typeof(r=e)&&"getType"in r&&"getId"in r){if(function(e){return"visualItem"===e.getType()}(e)){const r=t&&t.get(e.getId());return r?new VisualItemInfo(r):null}let r=Nn.get(e);return r||(r=function(e){return"setDecoration"in e&&"removeDecoration"in e}(e)?new RSv1CustomDataDecorated(e,""):new RSv1CustomData(e),Mn(e,r)),r}}var r;return null}function $n(e){if(e){if(e instanceof Color)return e;if("getRed"in e&&"getGreen"in e&&"getBlue"in e&&"getAlpha"in e)return Color.rgb(e.getRed(),e.getGreen(),e.getBlue(),e.getAlpha())}return null}function qn(e){if(e){if(e instanceof ResolvedColorStop)return e;if("getColor"in e&&"getAt"in e)return new ResolvedColorStop($n(e.getColor()),e.getAt(),e.getValue())}return null}function Bn(e){if(e){if(e instanceof ContDomain)return e;if("getMin"in e&&"getMax"in e&&"isEmpty"in e&&"isExplicit"in e)return new ContDomain(e.getMin(),e.getMax(),e.isEmpty(),e.isExplicit())}return null}function Hn(e){const t=e.getStops();return new ContEncoding(e.getSlot(),e.getChannel(),e.getCaption(),e.getSubCaption(),Fn(e.getRef()),Bn(e.getDomain()),e.getInterpolate(),t?Object.freeze(Array.from(t,qn)):null)}function Gn(e){return e?new Capability(e.getSlot(),e.getName(),e.getAttributes()):null}function Un(e){return new CatEncodingEntry(e.getCaption(),$n(e.getColor()),e.getShape(),e.isSelected(),e.isHighlighted(),Fn(e.getRef()))}function Wn(e){if(e){if(e instanceof Length)return e;if("getValue"in e&&"getRSUnit"in e)return new Length(e.getValue(),t.LengthUnit.parse(e.getRSUnit()))}return null}function Kn(e){return new Region(e.getName(),e.getSlots(),(t=e.getBounds())?t instanceof Bounds?t:new Bounds(t.getLeft(),t.getTop(),t.getRight(),t.getBottom()):null);var t}class RSv1ColorProperty extends RSv1ValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return $n(e)}}Object.defineProperty(RSv1ColorProperty.prototype,"type",{enumerable:!0,value:xn.Color});class RSv1EnumProperty extends RSv1ValueProperty{constructor(e,t){super(e,t)}get possibleValues(){return Ie(this).getPossibleValuesLocked()}getPossibleValues(){return Ie(this).getPossibleValuesLocked()}setPossibleValues(e,t=null){let r=v,n=null;return e&&(r=Object.freeze(Array.from(e,(function(e){const r=function(e){if(e){if(e instanceof EnumValue)return e;if("getName"in e&&"getCaption"in e&&"getDescription"in e)return new EnumValue(e.getName(),e.getCaption(),e.getDescription())}return null}(e);return(t===e||"string"==typeof t&&r.name===t)&&(n=r),r})))),Ie(this).setPossibleValues(r,n)}peekPossibleValues(){return Ie(this).getPossibleValues()}_normalize(e){return e&&e.name}_parseRenderer(e){return Ie(this).parse(e)}}Object.defineProperty(RSv1EnumProperty.prototype,"type",{enumerable:!0,value:xn.Enum});class RSv1FontProperty extends RSv1ValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return function(e){if(e){if(e instanceof Font)return e;if("getFamily"in e&&"getSize"in e&&"getRSStyle"in e&&"getRSWeight"in e){const r=e.getRSStyle(),n=e.getRSWeight();return Font.create(Font.normalizeFamily(e.getFamily()),Wn(e.getSize()),r?t.FontStyle.parse(r):null,n?t.FontWeight.fromValue(n):null)}}return null}(e)}}Object.defineProperty(RSv1FontProperty.prototype,"type",{enumerable:!0,value:xn.Font});class RSv1NumberProperty extends RSv1ValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return e}}Object.defineProperty(RSv1NumberProperty.prototype,"type",{enumerable:!0,value:xn.Number});class RSv1LengthProperty extends RSv1ValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return Wn(e)}}Object.defineProperty(RSv1LengthProperty.prototype,"type",{enumerable:!0,value:xn.Length});class RSv1StringProperty extends RSv1ValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return e}}var Xn;Object.defineProperty(RSv1StringProperty.prototype,"type",{enumerable:!0,value:xn.String}),t.Aggregation=void 0,(Xn=t.Aggregation||(t.Aggregation={})).Auto="auto",Xn.Count="count",Xn.Distinct="distinct",Xn.Sum="sum",Xn.Avg="avg",Xn.Min="min",Xn.Max="max",Xn.First="first",Xn.Last="last",Xn.None="none";const Jn=/^(?:auto|count|distinct|sum|avg|min|max|first|last|none)$/;var Qn;!function(e){function t(e){return function(e){return"string"==typeof e&&Jn.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid Aggregation: ${e}`);return r}}(t.Aggregation||(t.Aggregation={})),t.SlotType=void 0,(Qn=t.SlotType||(t.SlotType={})).Cat="cat",Qn.Cont="cont",Qn.Any="any";const Yn=/^(?:cat|cont|any)$/;var Zn;!function(e){function t(e){return function(e){return"string"==typeof e&&Yn.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid SlotType: ${e}`);return r}}(t.SlotType||(t.SlotType={})),t.SlotSubType=void 0,(Zn=t.SlotSubType||(t.SlotSubType={})).None="none",Zn.GeoSpatial="geospatial",Zn.Temporal="temporal",Zn.Reference="reference";const es=/^(?:none|geospatial|temporal|reference)$/;!function(e){function t(e){return function(e){return"string"==typeof e&&es.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid SlotSubType: ${e}`);return r}}(t.SlotSubType||(t.SlotSubType={}));class SlotRef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f,g,m){if(e===t.SlotType.Cat&&p!==t.Aggregation.None)throw new TypeError("_aggregation must be Aggregation.None for Cat slots");const y=Math.trunc(c)||0;Object.defineProperties(this,{type:{enumerable:!0,value:e},subType:{enumerable:!0,value:r},subTypeOptional:{enumerable:!0,value:!!n},name:{enumerable:!0,value:s},optional:{enumerable:!0,value:!!i},_caption:{enumerable:!0,value:o},_description:{enumerable:!0,value:a||null},multiDataItem:{enumerable:!0,value:!!l},channels:{enumerable:!0,value:Object.freeze(u||v)},maxLevels:{enumerable:!0,value:c<1?-1:y},aggregation:{enumerable:!0,value:p},suppressMissing:{enumerable:!0,value:!!h},role:{enumerable:!0,value:d},defaultMapping:{enumerable:!0,value:f},hidden:{enumerable:!0,value:!!g},dataSetIndex:{enumerable:!0,value:+m||0},_reference:{writable:!0,value:null}})}get caption(){return"function"==typeof this._caption?this._caption():this._caption}get description(){return"function"==typeof this._description?this._description():this._description}get reference(){return this._reference}static create(e,t,r){return new SlotRef(e.type,e.subType,e.subTypeOptional,e.name,t,e.caption,e.description,e.multiDataItem,e.channels,e.maxLevels,e.aggregation,e.suppressMissing,e.role,e.defaultMapping,e.hidden,r)}getReference(){return this._reference}setReference(e){if(this.subType!==t.SlotSubType.Reference)throw new Error("Reference can only be set on slots with SlotSubType.Reference");if(this._reference)throw new Error("Reference can only be set once");if(!(e instanceof SlotRef))throw new TypeError("Setting a null reference is not allowed");if(e===this)throw new Error("A slot cannot reference itself");if(e.type!==this.type)throw new Error(`A ${this.type} slot can only reference a slot of the same type`);if(this.name===e.name)throw new Error(`Slot ${this.name} cannot reference a slot with the same name`);this._reference=e}toString(){return this.name}}class Decorated extends DataObject{constructor(e,t){super(e),Object.defineProperties(this,{_decoFilter:{value:t}})}hasDecoration(e){return!this._decoFilter.has(e)&&!!(this.source&&this.source.hasDecoration&&this.source.hasDecoration(e))}getDecoration(e,t){return this.hasDecoration(e)?this.source.getDecoration(e):t}getRSHittableType(){return _n.Data}}class Slotted extends Decorated{constructor(e,t,r){super(e,t),Object.defineProperties(this,{slotRef:{value:r instanceof SlotRef?r:null}})}getSlotRef(){return this.slotRef}}Object.defineProperties(Slotted.prototype,{slotDef:{get:Slotted.prototype.getSlotRef}});class DataItem extends Slotted{constructor(e,t,r,n,s,i){super(e,t,r),Object.defineProperties(this,{sourceIndex:{value:n},mapped:{enumerable:!0,value:s},colIndex:{value:i}})}getInfoType(){return t.InfoType.DataItem}getDataSet(e){return e.getOwner(this)}isMapped(){return this.mapped}applyContext(e,t){t&&DataContext.setOwner(e,this,t)}}const ts=Array.prototype.join;class FallbackListFormatter{constructor(e){Object.defineProperties(this,{_separator:{value:e}})}format(e){return e?ts.call(e.filter((e=>e.length)),this._separator):""}}class Formatter{constructor(e){Object.defineProperties(this,{format:{value:e.format.bind(e)}})}static create(e){return e instanceof Formatter?e:new Formatter(e)}}class ListFormatterCache{constructor(e,t){Object.defineProperties(this,{_source:{value:e},_fallback:{value:t},_data:{writable:!0,value:null},_label:{writable:!0,value:null}})}get(e){const t=`_${e}`;let r=this[t];if(!r){const s=!!(n=this._source)&&"getListFormatter"in n&&this._source.getListFormatter(e)||this._fallback(e);this[t]=r=new Formatter(s)}var n;return r}}const rs=new FallbackListFormatter("  ");function ns(e){return rs}class CatDataItem extends DataItem{constructor(e,t,r,n,s,i,o,a,l,u,c,p){super(e,t,r,n,s,i),Object.defineProperties(this,{tupleCount:{enumerable:!0,value:o},start:{enumerable:!0,value:a},end:{enumerable:!0,value:l},itemClassSets:{enumerable:!0,value:u},tuples:{enumerable:!0,value:c},_listFmt:{value:p||new ListFormatterCache(e,ns)}})}getRSType(){return t.DataItemType.Cat}asCat(){return this}asCont(){return null}getCaption(e){return DataItem.joinCaptions(this._listFmt.get(DataItem.validateFormatKind(e)),e,this.itemClassSets)}getLegendCaption(e=!1){return DataItem.joinLegendCaptions(this._listFmt.get(DataItem.validateFormatKind(t.FormatKind.Label)),this.itemClassSets,e)}getSubCaption(e){return DataItem.joinSubCaptions(this._listFmt.get(DataItem.validateFormatKind(e)),e,this.itemClassSets)}combineCaptions(e){return DataItem.joinCombinedCaptions(this._listFmt.get(DataItem.validateFormatKind(e)),e,this.itemClassSets)}getStart(){return this.start}getEnd(){return this.end}getTupleCount(){return this.tupleCount}getItemClassSetCount(){return this.itemClassSets.length}getItemClassSet(e){return In(this.itemClassSets,e)}getItemClassSets(){return this.itemClassSets}getTuples(){return this.tuples}getTuple(e){return In(this.tuples,e,this.start)}getDataItemInfoType(){return this.type}getItemClassSetInfos(){return this.itemClassSets}getTupleInfos(){return this.tuples}getTupleInfo(e){return Tn(this.tuples,e,"Tuple",this.start)}clone(e,t,r=this.colIndex,n=0){n=Math.floor(n)||0;const s=this.itemClassSets.map((function(r){return r.clone(e,t)})),i=this.start,o=n>0?Math.min(i+n,this.end):this.end,a=o-i,l=new Array(a);for(let t=0;t<a;++t){const r=this.tuples[t],n=r.source?r.source.getItemClassSetIndex():0;l[t]=r.clone(e,s[n])}return this._createClone(this.source,e,t,this.sourceIndex,this.mapped,r,this.tupleCount,i,o,s,l)}applyContext(e,t){super.applyContext(e,t);for(const t of this.itemClassSets)t.applyContext(e,this);for(const t of this.tuples)t.applyContext(e,this)}_createClone(e,t,r,n,s,i,o,a,l,u,c){return new CatDataItem(e,t,r,n,s,i,o,a,l,u,c,this._listFmt)}}Object.defineProperties(CatDataItem.prototype,{type:{value:t.DataItemType.Cat}});class FormatterProxy{constructor(e,t,r){Object.defineProperties(this,{_kind:{value:e},_source:{value:t},_fallbackResolver:{value:r},_view:{value:new Formatter(this)},_fallback:{writable:!0,value:null},_fmt:{writable:!0,value:null}}),this.resolve()}format(e){return this._fmt.format(e)||y}resolve(){const e=(t=this._source)&&"getFormatter"in t?this._source.getFormatter(this._kind):null;var t;return e?this._fmt=e:(this._fallback||(this._fallback=this._fallbackResolver(this._kind)),this._fmt=this._fallback),this._view}}class FormatterCache{constructor(e,t){Object.defineProperties(this,{_source:{value:e},_fallbackResolver:{value:t},_data:{writable:!0,value:null},_label:{writable:!0,value:null}})}get(e){const t=`_${e}`;let r=this[t];return r||(this[t]=r=new FormatterProxy(e,this._source,this._fallbackResolver)),r.resolve()}}const ss=new FallbackListFormatter(" - ");function is(e){return ss}class ItemClassSet extends DataObject{constructor(e,t,r){super(e),Object.defineProperties(this,{slotRef:{writable:!0,value:t instanceof SlotRef?t:null},itemClasses:{enumerable:!0,value:r},_fmt:{value:new ListFormatterCache(e,is)}})}static create(e){const t=new Array(1);return t[0]=e,new ItemClassSet(null,e.slotRef,t)}getInfoType(){return t.InfoType.ItemClassSet}getItemClasses(){return this.itemClasses}getCaption(e){return DataObject.joinCaptions(this._fmt.get(e),e,this.itemClasses)}getLegendCaption(e){return DataObject.joinLegendCaptions(this._fmt.get(t.FormatKind.Label),this.itemClasses,e)}getSubCaption(e){return DataObject.joinSubCaptions(this._fmt.get(e),e,this.itemClasses)}combineCaptions(e){return DataObject.joinCombinedCaptions(this._fmt.get(e),e,this.itemClasses)}getItemClassCount(){return this.itemClasses.length}getItemClass(e){return In(this.itemClasses,e)}getSlotRef(){return this.slotRef}getItemClassInfos(){return this.itemClasses}clone(e,t){return new ItemClassSet(this.source,t,this.itemClasses.map((function(r){return r.clone(e,t)})))}applyContext(e,t){t&&DataContext.setOwner(e,this,t);for(const t of this.itemClasses)t.applyContext(e,this)}}const os={format:String},as=Object.freeze({maximumFractionDigits:20});class FallbackNumberFormatter{constructor(e){let t;t="undefined"!=typeof Intl?new Intl.NumberFormat("en",Object.assign({useGrouping:e},as)):os,Object.defineProperties(this,{_fmt:{value:t}})}format(e){return w(e)?y:this._fmt.format(e)}}const ls=new FallbackNumberFormatter(!0),us=new FallbackNumberFormatter(!1);function cs(e){return e===t.FormatKind.Data?ls:us}class ContDataItem extends DataItem{constructor(e,t,r,n,s,i,o,a,l){super(e,t,r,n,s,i),Object.defineProperties(this,{itemClassSet:{enumerable:!0,value:ItemClassSet.create(o)},itemClass:{enumerable:!0,value:o},_domain:{value:a},_valueFmt:{value:l||new FormatterCache(e,cs)}})}getRSType(){return this.type}asCat(){return null}asCont(){return this}getItemClass(){return this.itemClass}getCaption(e){return this.itemClass.getCaption(e)}getLegendCaption(e=!1){return this.itemClass.getLegendCaption(e)}getSubCaption(e){return this.itemClass.getSubCaption(e)}combineCaptions(e){return this.itemClass.combineCaptions(e)}getFormatter(e){return this._valueFmt.get(DataItem.validateFormatKind(e))}getDataItemInfoType(){return t.DataItemType.Cont}getDomain(e){return this.getDomainInfo(Gn(e))}getDomainInfo(e){const t=e||null;let r=null;return this.source&&(r=ContDomain.fromHost(this.source.getDomain(t))),!r&&this._domain&&(r=this._domain.resolve(this,t)),r||(r=ContDomain.EMPTY),r}getItemClassInfo(){return this.itemClass}calcDomain(e){return this._domain.resolve(this,e||null)}clone(e,t,r,n){return new ContDataItem(this.source,e,t,this.sourceIndex,this.mapped,r,this.itemClass.clone(e,t),n||this._domain,this._valueFmt)}missingCaption(e){return this._valueFmt.get(e).format(null)}applyContext(e,t){DataItem.prototype.applyContext.call(this,e,t),this.itemClassSet.applyContext(e,this)}}Object.defineProperties(ContDataItem.prototype,{type:{value:t.DataItemType.Cont}});const ps=new FallbackListFormatter(" | ");function hs(e){return ps}class Tuple extends Slotted{constructor(e,t,r,n,s,i,o){super(e,t,r),Object.defineProperties(this,{index:{enumerable:!0,value:n},itemClassSet:{enumerable:!0,value:s},items:{enumerable:!0,value:i},_key:{writable:!0,value:null},_keyS:{writable:!0,value:null},_listFmt:{value:new ListFormatterCache(this.source,hs)}})}static joinKey(e){return e.join("")}get itemClasses(){return this.getItemClasses()}get dataItem(){return this.getDataItemInfo()}get key(){return this.getKey(!0)}getRSType(){return hn.Cat}getDataItem(e){return e.getOwner(this)}asCat(){return this}asCont(){return null}getSubInfoType(){return this.subType}getSubType(){return this.subType}getIndex(){return this.index}getItemClassSet(){return this.itemClassSet}getItemClasses(){return this.itemClassSet&&this.itemClassSet.itemClasses}getItemClassCount(){return this.itemClassSet.getItemClassCount()}getItemClass(e){return this.itemClassSet.getItemClass(e)}getItems(){return this.items}getItemCount(){return this.items.length}getItem(e){return In(this.items,e)}getKey(e=!0){let t=e?this._keyS:this._key;if(null===t){const r=[];this.addKeyParts(r),r.length<1?r.push(String(this.index)):r.length>1&&e&&r.sort(),t=Tuple.joinKey(r),e?this._keyS=t:this._key=t}return t}getCaption(e){return Slotted.joinCaptions(this._listFmt.get(e),e,this.items)}getLegendCaption(e=!1){return Slotted.joinLegendCaptions(this._listFmt.get(t.FormatKind.Label),this.items,e)}getInfoType(){return t.InfoType.Tuple}getDataItemInfoType(){return t.DataItemType.Cat}getItemClassSetInfo(){return this.itemClassSet}getItemClassInfos(){return this.itemClassSet.getItemClassInfos()}getItemInfos(){return this.items}getDataItemInfo(){return DataContext.vipr.getOwner(this)}addKeyParts(e){if(this.source)for(const t of this.items)e.push(t.getUniqueName())}_cloneItems(e,t){return this.items.map((function(r,n){return r.clone(e,t.itemClasses[n])}))}clone(e,t){return new Tuple(this.source,e,t.getSlotRef(),this.index,t,this._cloneItems(e,t),this._listFmt)}applyContext(e,t){DataContext.setOwner(e,this,t)}valueOf(){return this.index}}function ds(e,t){if("string"==typeof t){for(const r of e)if(r.name===t)return r}else{const r=t;for(const t of e)if(t===r||t.slotRef===r.slotRef)return t}return null}function fs(e,t,r){const n=ds(e,t);if(!n||r&&!n.forViz)throw"string"==typeof t?new RangeError(`There is no slot with name "${t}"`):new RangeError("Provided slot is not part of this data set");return n}Object.defineProperties(Tuple.prototype,{type:{value:t.DataItemType.Cat},subType:{value:t.SlotSubType.None}});class DataPoint extends Decorated{constructor(e,t,r,n,s,i,o,a,l){super(e,t),Object.defineProperties(this,{dataItems:{value:r},index:{value:s},ordinal:{value:i},_slots:{value:n},_rowData:{value:o},_rowStart:{value:a},offset:{value:l},_key:{writable:!0,value:null},_keyS:{writable:!0,value:null}})}get row(){return this.getRowInfo()}get key(){return this.getKey(!0)}getDataSet(e){return e.getOwner(this)}getKey(e=!0){let t=e?this._keyS:this._key;if(null===t){const r=[];for(const e of this._slots)if(e.mapped&&e.forViz)for(const t of e.dataItems)"cat"===t.type&&this.datum(t).addKeyParts(r);r.length<1?r.push(String(this.ordinal)):e&&r.sort(),this.offset>0&&r.push(`[${this.offset}]`),t=Tuple.joinKey(r),e?this._keyS=t:this._key=t}return t}all(e){return fs(this._slots,e,!0).dataItems.map(this.datum,this)}get(e,t=0){const r=In(fs(this._slots,e,!0).dataItems,t);return r?this.datum(r):null}getInfoType(){return t.InfoType.DataPoint}getRowInfo(){let e=this.dataItems.length;for(;e>0&&this.dataItems[e-1]&&!this.dataItems[e-1].source;)--e;const t=new Array(e);for(let r=0;r<e;++r)t[r]=this.datum(this.dataItems[r]);if(this.index<0)for(const e of this._slots)if(e.mapped)for(const r of e.dataItems)if(r.sourceIndex>=0&&this.dataItems[r.sourceIndex]!==r&&"cat"===r.type&&t[r.sourceIndex].index!==this.datum(r).index)return null;return t}allInfo(e){return this.all(e)}getInfo(e,t=0){return this.get(e,t)}datum(e){return e.colIndex<0?e.getTuple(0):this._rowData[this._rowStart+e.colIndex]}applyContext(e,t){if(DataContext.setOwner(e,this,t),e!==DataContext.vipr)for(const t of this._slots)for(const r of t.dataItems)(r instanceof ContDataItem||r instanceof CatDataItem)&&this.datum(r).applyContext(e,r)}}const gs=Color.Named.purple;class PaletteProxy{constructor(e){Object.defineProperties(this,{_resolver:{writable:!0,value:e}})}}class CatPaletteProxy extends PaletteProxy{constructor(e,t,r){super(e),Object.defineProperties(this,{_dataContext:{value:r},_slotName:{value:t}})}_getTupleColor(e,t){let r;if(e){if(!(e instanceof Tuple))throw new TypeError("_tuple is not a valid Tuple");const n=e.getSlotRef();if(null!==this._slotName&&this._slotName!==(n&&n.name))return this._getColor(null);r=Color.fromHost(this._resolver.getColor(e,Ie(this._dataContext).getOwner(e),Math.max(-1,t)))}else r=Color.fromHost(this._resolver.getDefaultColor(null));return r||gs}_getColor(e){if(e&&null!==this._slotName){if(!(e instanceof DataPoint))throw new TypeError("_dataPoint is not a valid DataPoint");const t=Ie(this._dataContext).getOwner(e).getSlotInfo(this._slotName);if(t&&t.isMapped()){const r=e.get(t);if(r)return this._getTupleColor(r,-1)}}return Color.fromHost(this._resolver.getDefaultColor(e))||gs}}class RSv1PaletteProperty extends RSv1ValueProperty{constructor(e,t){super(e,t)}get paletteType(){return this.getRSPaletteType()}get slot(){return this.getSlot()}getRSPaletteType(){return Ie(this).def.paletteType}getSlot(){const e=Ie(this).def.slot;return e&&e.name}_parseRenderer(e){throw new Error("Renderers setting a palette resolver is not supported.")}}Object.defineProperty(RSv1PaletteProperty.prototype,"type",{enumerable:!0,value:xn.Palette}),Object.defineProperty(RSv1PaletteProperty.prototype,"getPaletteType",{value:RSv1PaletteProperty.prototype.getRSPaletteType});class RSv1CatPaletteProxy extends CatPaletteProxy{constructor(e,t,r){super(e,t,r)}getTupleColor(e,t=-1){return null===t&&(t=-1),super._getTupleColor(e,t)}getColor(e){return super._getColor(e)}}class RSv1CatPaletteProperty extends RSv1PaletteProperty{constructor(e,t,r){super(e,t),Object.defineProperties(this,{_dataContext:{value:r}})}getTupleColor(e,t){if(!this._value)throw new Error("Cannot resolve tuple color, resolver is null");return this._value.getTupleColor(e,t)}getColor(e){if(!this._value)throw new Error("Cannot resolve color, resolver is null");return this._value.getColor(e)}_normalize(e){if(!e)return null;const t=Ie(this).def.slot;return new RSv1CatPaletteProxy(e,t&&t.name,this._dataContext)}}function ms(e){const t=e.getAt();if(null!==t&&(t<0||t>1))throw new Error(`getAt() value ${t} out of range (0-1 inclusive)`);return t}class ContStops{constructor(e,t,r,n){Object.defineProperties(this,{stops:{enumerable:!0,value:e},domain:{enumerable:!0,value:t},aligned:{enumerable:!0,value:r},interpolate:{enumerable:!0,value:!1!==n}})}static fromHost(e,t){const r=function(e,t){const r=e.length;let n=t.min,s=t.max;const i=new Array(Math.max(2,r));let o;if(r>1&&t.min<t.max){let t,a,l=e[0];if(o=Color.fromHost(l.getColor()),!o)throw new Error("First stop must have a color");t=ms(l),a=l.getValue();let u=!1;if(null===t&&null!==a){u=!0,t=0,n=a;const i=e[r-1].getValue();if("number"!=typeof i)throw new Error("The last absolute stop must have a value");s=i}else t=null===t?0:m(0,t,1),a=n+t*(s-n);i[0]=new ResolvedColorStop(o,t,a);let c=0,p=o,h=-1,d=null,f=0,g=u?a:t,y=-1,v=null,b=!0;for(let m=1;m<r;++m){if(l=e[m],o=h===m?d:Color.fromHost(l.getColor()),null===o){if(null===d||h<m){for(d=null,h=m+1;null===d&&h<r;++h)d=Color.fromHost(e[h].getColor());if(null===d)throw new Error("The last stop must define a color")}o=Color.interpolate(p,d,(m-c)/(h-c))}else p=o,c=m;if(u){if(a=m===y?v:l.getValue(),null===a){if(null===v||y<m){for(v=null,y=m+1;null===v&&y<r;++y)v=e[y].getValue();null===v&&(y=r-1,v=s)}a=g,m===y?a=v:m>f&&(a+=(v-g)*(m-f)/(y/f))}else g=a,f=m;b=a>=g&&a<=s,t=(a-n)/(s-n)}else{if(t=m===y?v:l.getAt(),null===t){if(null===v||y<m){for(v=null,y=m+1;null===v&&y<r;++y)v=ms(e[y]);null===v&&(v=1,y=r-1)}t=g,m===y?t=v:m>f&&(t+=(v-g)*(m-f)/(y/f))}else g=t,f=m;b=t>=g&&t<=1,a=n+t*(s-n)}if(!b)throw new Error("Stops are out of order, this is not supported.");i[m]=new ResolvedColorStop(o,t,a)}}else{i.length=2;const t=r>0?e[0]:null;o=t?Color.fromHost(t.getColor()):null,o||(o=gs),i[0]=new ResolvedColorStop(o,0,n),i[1]=new ResolvedColorStop(o,1,s)}return Object.freeze(i)}(e.stops,t);let n,s;const i=r[0].value,o=r[r.length-1].value;return i===t.min&&o===t.max?(s=t,n=r):(s=new ContDomain(i,o),n=function(e,t){let r=null,n=1,s=0;const i=Math.abs(t.max-t.min),o=[];for(let a=0,l=e.length;a<l;++a){const l=e[a],u=l.value;if(null===u)throw new Error("ColorStop value can't be null, this is not supported");const c=(u-t.min)/i;if(a>0&&n<0&&c>0){const e=(t.min-s)/(u-s);let n;n=null===r?l.color:Color.interpolate(r.color,l.color,e),o.push(new ResolvedColorStop(n,0,t.min))}if(c>=0&&c<=1&&o.push(new ResolvedColorStop(l.color,c,u)),a>0&&n<1&&c>1){const e=(t.max-s)/(u-s);let n;n=null===r?l.color:Color.interpolate(r.color,l.color,e),o.push(new ResolvedColorStop(n,1,t.max))}r=l,n=c,s=u}return o}(r,t)),new ContStops(r,s,n,e.interpolate)}getStops(){return this.stops}getDomain(){return this.domain}getAligned(){return this.aligned}mustInterpolate(){return this.interpolate}getColor(e){const t=+e||0,r=this.stops;let n=null,s=null,i=(r?r.length:0)-1;for(;i>=0&&(n=r[i],!(t>=n.value));--i)s=n;if(n){const e=n?n.value:0;if(i<0||!s||!this.interpolate||e===t)return n.color;{const r=Math.abs(s.value-e)||0,i=r&&(t-e)/r;return Color.interpolate(n.color,s.color,i)}}return gs}}class ContPaletteProxy extends PaletteProxy{constructor(e){super(e)}_getColorStops(e,t){const r=t||(e?e.getDomain(null):ContDomain.EMPTY),n=this._resolver.getColorStops(e,r);return ContStops.fromHost(n,r)}}class RSv1ContPaletteProxy extends ContPaletteProxy{getColorStops(e,t){return super._getColorStops(e,Bn(t))}}class RSv1ContPaletteProperty extends RSv1PaletteProperty{getColorStops(e,t){if(!this._value)throw new Error("Cannot resolve color stops, resolver is null");return this._value.getColorStops(e,t)}_normalize(e){return e?new RSv1ContPaletteProxy(e):null}}class CustomCatPaletteProxy extends PaletteProxy{constructor(e){super(e)}_getColor(e,t,r){return Color.fromHost(this._resolver.getColor(e,t,r))||gs}}class RSv1CustomCatPaletteProxy extends CustomCatPaletteProxy{getColor(e,t,r){return super._getColor(e,t,Fn(r))}}class RSv1CustomCatPaletteProperty extends RSv1PaletteProperty{getColor(e,t,r){if(!this._value)throw new Error("Cannot resolve color, resolver is null");return this._value.getColor(e,t,r)}_normalize(e){return e?new RSv1CustomCatPaletteProxy(e):null}}class CustomContPaletteProxy extends PaletteProxy{constructor(e){super(e)}_getColorStops(e){const t=e||ContDomain.EMPTY,r=this._resolver.getColorStops(t);return ContStops.fromHost(r,t)}}class RSv1CustomContPaletteProxy extends CustomContPaletteProxy{getColorStops(e){return super._getColorStops(Bn(e))}}class RSv1CustomContPaletteProperty extends RSv1PaletteProperty{getColorStops(e){if(!this._value)throw new Error("Cannot resolve color stops, resolver is null");return this._value.getColorStops(e)}_normalize(e){return e?new RSv1CustomContPaletteProxy(e):null}}function ys(e){return!!e&&e.def.type===t.PropertyType.Group}function vs(e){return e.def.visibility!==t.PropertyVisibility.Excluded}function bs(e){return vs(e)&&e.isActive()}function ws(e){return e.toHost()}function _s(e){return Object.freeze(e.properties.filter(vs).map(ws))}function Ps(e,t){for(const r of e)if(r.name===t)return r;return null}class VizGroupProperty extends VizProperty{constructor(e,t,r){super(e,t),Object.defineProperties(this,{_properties:{writable:!0,value:_s(e)}})}get properties(){return this.getProperties()}getProperties(){return this._properties}forEach(e,t){this._properties.forEach(e,t)}update(){this._properties=_s(Ie(this))}on(e,r){return Ie(this).on(e,((e,n)=>{if("property"in e){const r=e.property;if(r.getName()!==n.def.name&&r.getVisibility()===t.PropertyVisibility.Excluded)return}r(e,this)}))}}class GroupProperty extends Property{constructor(e,t,r,n){if(super(e,r,n),Object.defineProperties(this,{properties:{enumerable:!0,value:Object.freeze(t)}}),this.setActive(this._determineActive()),Object.defineProperty(this,"_hostView",{value:new VizGroupProperty(this,e,Object.freeze(t.map(ws)))}),t.length>0){const e=this._propertyActiveChanged.bind(this),r=this._propertyValueChanged.bind(this);for(const n of t)this.own(n,n.on("active",e),n.on("value",r))}}lock(){const e=super.lock();if(e)for(const e of this.properties)e.lock();return e}unlock(e){const t=super.unlock(e);if(t)for(const t of this.properties)t.unlock(e);return t}_determineActive(){return this.properties.some(bs)}_propertyActiveChanged(e){this.emit("active",e);const t=e.property.isActive();this.isActive()!==t&&this.setActive(t||this._determineActive())}_propertyValueChanged(e){this.emit("value",e)}_updateFromDef(){for(const e of this.properties){const t=Ps(this._def.properties,e.def.name);if(!t)throw new Error(`GroupProperty ${this._def.name} is missing extended property ${e.def.name}`);e.setPropertyDef(t)}this._hostView.update()}postInit(){super.postInit();for(const e of this.properties)e.postInit()}toHost(){return this._hostView}isDirtyLocked(){return this.properties.some(Vn)}_markRendered(e){}}class RSv1DeprecatedProperty extends DeprecatedAdapter{constructor(e,t,r,n){super(e,t),Object.defineProperties(this,{_rsProperties:{value:r},_api:{value:n}})}_resolveView(e){return this._rsProperties.get(e)}_setValue(e,t){this._api.setValue(this._rsProperties,e,t)}_evaluate(e){return this._api.evaluate(this._rsProperties,e)}}function Cs(e,r,n){const s=ye(i=r&&r.parser(e.def.name))?{parseValue:i}:i||null;var i;switch(e.def.type){case t.PropertyType.Boolean:return new RSv1BooleanProperty(e,s);case t.PropertyType.Color:return new RSv1ColorProperty(e,s);case t.PropertyType.Enum:return new RSv1EnumProperty(e,s);case t.PropertyType.Font:return new RSv1FontProperty(e,s);case t.PropertyType.Length:return new RSv1LengthProperty(e,s);case t.PropertyType.Number:return new RSv1NumberProperty(e,s);case t.PropertyType.String:return new RSv1StringProperty(e,s);case t.PropertyType.Palette:return function(e,r,n){switch(e.def.paletteType){case t.PaletteType.Cat:return new RSv1CatPaletteProperty(e,r,n);case t.PaletteType.Cont:return new RSv1ContPaletteProperty(e,r);case t.PaletteType.CustomCat:return new RSv1CustomCatPaletteProperty(e,r);case t.PaletteType.CustomCont:return new RSv1CustomContPaletteProperty(e,r);default:throw new Error(`Unhandled palette type: ${e.def.paletteType}`)}}(e,s,n);default:throw new Error(`Unhandled property type: ${e.def.paletteType}`)}}function Ss(e,t,r,n,s,i){for(const o of r)if(ys(o))Ss(e,t,o.properties,n,s,i);else if(An(o)){const r=Cs(o,n,s);e.push(r),t.set(o.def.name,r);for(const e of o.def.aliases)t.set(e,r);o.def.visualItems.forEach((e=>{i.has(e)?i.get(e).push(r):i.set(e,[r])}))}}class RSv1Properties{constructor(e,t,r){const n=[],s=new Map;Ss(n,s,e.properties,r,t,e.visualItemsToRSProps),Ss(n,s,e.configuration,r,t,e.visualItemsToRSProps),Object.defineProperties(this,{_values:{value:Object.freeze(n)},_map:{value:Object.freeze(s)}}),n.forEach((t=>{const n=Ie(t);let s=null;r&&n.def.deprecated&&(s=r.deprecated(n.def.name)||null),n.init(t,s&&new RSv1DeprecatedProperty(e.toHost(),t,this,s))}))}[Symbol.iterator](){return this._map.values()}has(e){return this._map.has(e)}_getTyped(e,t){const r=this._map.get(e);return!r||t&&r.getRSType()!==t?null:r}_getPaletteTyped(e,r){const n=this._getTyped(e,t.PropertyType.Palette);return n&&n.getRSPaletteType()===r?n:null}get(e){return this._getTyped(e,null)}forEach(e,t){for(const r of this._values)e.call(t,r,r.name,this)}getBoolean(e){return this._getTyped(e,t.PropertyType.Boolean)}getColor(e){return this._getTyped(e,t.PropertyType.Color)}getEnum(e){return this._getTyped(e,t.PropertyType.Enum)}getFont(e){return this._getTyped(e,t.PropertyType.Font)}getLength(e){return this._getTyped(e,t.PropertyType.Length)}getNumber(e){return this._getTyped(e,t.PropertyType.Number)}getString(e){return this._getTyped(e,t.PropertyType.String)}getCatPalette(e){return this._getPaletteTyped(e,t.PaletteType.Cat)}getContPalette(e){return this._getPaletteTyped(e,t.PaletteType.Cont)}getCustomCatPalette(e){return this._getPaletteTyped(e,t.PaletteType.CustomCat)}getCustomContPalette(e){return this._getPaletteTyped(e,t.PaletteType.CustomCont)}}function xs(e){if(!(e instanceof Coordinate))throw new TypeError("Invalid coordinate provided");return e}class Coordinate{constructor(e,t){Object.defineProperties(this,{viewPort:{enumerable:!0,value:e},_vis:{value:t}})}get x(){return this.getX()}get y(){return this.getY()}getX(){return this.viewPort.x}getY(){return this.viewPort.y}}class CustomDataSet{constructor(e,t,r){if("string"!=typeof e)throw new TypeError("_name must be a string");if(!Array.isArray(t))throw new TypeError("_items must be an Array");Object.defineProperties(this,{name:{enumerable:!0,value:e},items:{enumerable:!0,value:t},_wrapped:{value:r}})}getName(){return this.name}getItems(){return this.items}getDecorationsVersion(){return this._wrapped.getDecorationsVersion()}updateDecorations(){return this._wrapped.updateDecorations()}}class RSv1CustomDataSet{constructor(e,t){if("string"!=typeof e)throw new TypeError("_name must be a string");if(!Array.isArray(t))throw new TypeError("_items must be an Array");Object.defineProperties(this,{name:{enumerable:!0,value:e},items:{enumerable:!0,value:t},_decoVer:{writable:!0,value:0}})}getName(){return this.name}getItems(){return this.items}getDecorationsVersion(){return this._decoVer}updateDecorations(){return++this._decoVer}}var Ds;Object.defineProperties(RSv1CustomDataSet.prototype,{getDecorationVersion:{value:function(){return this._decoVer}}}),function(e){e.Inactive="inactive",e.Pending="pending",e.Complete="complete",e.Failed="failed",e.Aborted="aborted"}(Ds||(Ds={}));const Ts="Request has not been executed yet";class VizServiceRequest{get id(){return this.getId()}get name(){return this.getName()}get version(){return this.getVersion()}get payload(){return this.getPayload()}get aborted(){return this.isAborted()}get completed(){return this.isCompleted()}get failed(){return this.isFailed()}get active(){return this.isActive()}constructor(e){Oe(this,e)}getId(){return Ie(this).id}getName(){return Ie(this).name}getVersion(){return Ie(this).version}getPayload(){return Ie(this).payload}isAborted(){return Ie(this).status===Ds.Aborted}isCompleted(){return Ie(this).status===Ds.Complete}isFailed(){return Ie(this).status===Ds.Failed}isActive(){return Ie(this).status===Ds.Pending}reply(e){const t=Ie(this);if(t.status===Ds.Inactive)throw new Error(Ts);t.status===Ds.Pending&&t.update(Ds.Pending,e)}complete(e){const t=Ie(this);if(t.status===Ds.Inactive)throw new Error(Ts);t.status===Ds.Pending&&t.update(Ds.Complete,e)}fail(e){const t=Ie(this);if(t.status===Ds.Inactive)throw new Error(Ts);t.status===Ds.Pending&&t.update(Ds.Failed,e)}}class RSv1Request{get id(){return this.getId()}get name(){return this.getName()}get version(){return this.getVersion()}get payload(){return this.getPayload()}get aborted(){return this.isAborted()}get completed(){return this.isCompleted()}get failed(){return this.isFailed()}get active(){return this.isActive()}constructor(e){Oe(this,e)}getId(){return Ie(this).id}getName(){return Ie(this).name}getVersion(){return Ie(this).version}getPayload(){return Ie(this).payload}subscribe(e){Ie(this).subscribe(e,this)}exec(e){const t=Ie(this);if(t.isExecuted)throw new Error("Request has already been executed");return t.isExecuted=!0,e&&this.subscribe(e),t.executeRequest(),this}abort(e){Ie(this).abort(e)}isAborted(){return Ie(this).status===Ds.Aborted}isCompleted(){return Ie(this).status===Ds.Complete}isFailed(){return Ie(this).status===Ds.Failed}isActive(){return Ie(this).status===Ds.Pending}}class VizServiceRequestHandle{constructor(e,t,r,n,s,i){Object.defineProperties(this,{id:{enumerable:!0,value:e},name:{enumerable:!0,value:t},version:{enumerable:!0,value:r},payload:{enumerable:!0,value:n},status:{enumerable:!0,writable:!0,value:Ds.Inactive},_hostApi:{value:s},_subscribers:{value:[]},isExecuted:{writable:!0,value:!1},_result:{writable:!0,value:null},_notification:{value:i},_host:{value:new VizServiceRequest(this)},_rs:{value:new RSv1Request(this)}})}toHost(){return this._host}toRSv1(){return this._rs}isActive(){return this.status===Ds.Pending}update(e,t){let r=null,n=null;e===Ds.Pending||e===Ds.Complete?n=t:r=t,e!==Ds.Pending&&e!==Ds.Inactive&&(this._result=t),e!==Ds.Pending&&(this.status=e);for(let e=0,t=this._subscribers;e<t.length;++e)try{t[e](r,n,this._rs)}catch(e){}if(this.status!==Ds.Pending&&(this._subscribers.length=0,this._notification))try{this._notification(this)}catch(e){}}abort(e){this.status!==Ds.Inactive&&this.status!==Ds.Pending||this.update(Ds.Aborted,e)}subscribe(e,t){switch(this.status){case Ds.Inactive:case Ds.Pending:this._subscribers.push(e);break;case Ds.Complete:e(null,this._result,t);break;default:e(this._result,null,t)}}executeRequest(){if(this.status===Ds.Inactive)if(this.status=Ds.Pending,this._hostApi)try{this._hostApi.request(this.toHost())}catch(e){this.update(Ds.Failed,e)}else this.update(Ds.Failed,new Error("The host did not provide a request handler"))}}let Is=0;class RSv1HostApi{constructor(e){Oe(this,e)}requestRender(){Ie(this).requestRender()}request(e,t,r){return Ie(this).request(e,t,r)}setCustomData(e,t){const r=new RSv1CustomDataSet(e,t),n=Array.from(t,(function(t){return Mn(t,new RSv1CustomDataDecorated(t,e))}));return Ie(this).setCustomData(new CustomDataSet(e,n,r)),r}error(e,t,r,n,s){Ie(this).error(e,t,r,n,s)}warn(e,t,r,n,s){Ie(this).warn(e,t,r,n,s)}info(e,t,r,n,s){Ie(this).info(e,t,r,n,s)}}class HostApi{constructor(e,t,r){Object.defineProperties(this,{_hostApi:{value:e},_rsHostApi:{value:new RSv1HostApi(this)},responseReceived:{enumerable:!0,writable:!0,value:!1},_requests:{value:[]},_requestRender:{value:t},_logger:{value:r}})}toRSv1(){return this._rsHostApi}toHost(){return this._hostApi}requestRender(){let e=!0;this._hostApi&&"requestRender"in this._hostApi&&(e=!this._hostApi.requestRender()),e&&this._requestRender()}abortRequests(e){for(let t=this._requests.length-1;t>=0;--t)this._requests[t].toRSv1().abort(e)}request(e,t,r){if("string"!=typeof e||e.length<1)throw new TypeError("IHostAPI::request requires a non empty string name");if("number"!=typeof t||t!=t)throw new TypeError("IHostAPI::request requires a version, which must be a number");const n=new VizServiceRequestHandle(++Is,e,t,r,this._hostApi,(e=>{if(this.responseReceived=!0,!e.isActive()){const t=this._requests.indexOf(e);t>=0&&this._requests.splice(t,1)}}));return this._requests.push(n),n.toRSv1()}setCustomData(e){const t=this._hostApi;return t&&t.setCustomData&&t.setCustomData(e),e}notify(e,r,n,s,i,o){if(!t.Severity.tryParse(e))throw new TypeError(`Invalid Severity: ${e}`);if("string"!=typeof r)throw new TypeError(`Invalid type: ${r}`);if("string"!=typeof n)throw new TypeError(`Invalid id: ${n}`);const a=this._hostApi,l=s||"";if(a){const s=void 0===o?null:o,u=new VizServiceNotification(t.Severity.parse(e),r,n,l,i||"",s);try{a.notify(u)}catch(e){}}else switch(e){case t.Severity.Error:this._logger.error(l,o);break;case t.Severity.Info:this._logger.info(l,o);break;case t.Severity.Warning:this._logger.warn(l,o)}}error(e,r,n,s,i){this.notify(t.Severity.Error,e,r,n,s,i)}warn(e,r,n,s,i){this.notify(t.Severity.Warning,e,r,n,s,i)}info(e,r,n,s,i){this.notify(t.Severity.Info,e,r,n,s,i)}}class InitializationParameters{constructor(e,t,r,n,s,i,o,a,l,u){Object.defineProperties(this,{surface:{enumerable:!0,value:e},hostApi:{enumerable:!0,value:t},resources:{enumerable:!0,value:r||new Map},logger:{enumerable:!0,value:n},displayLocale:{enumerable:!0,value:s},locale:{enumerable:!0,value:i},nls:{enumerable:!0,value:o},properties:{enumerable:!0,value:a},visualItems:{enumarable:!0,value:l},dataContext:{enumerable:!0,value:u}})}getRenderSurface(){return this.surface}getHostApi(){return this.hostApi}getResources(){return this.resources}getLogger(){return this.logger}getDisplayLocale(){return this.displayLocale}getLocale(){return this.locale}getNls(){return this.nls}getProperties(){return this.properties}getVisualItems(){return this.visualItems}getDataContext(){return this.dataContext}}class InitNotification{constructor(){Object.defineProperties(this,{_deffered:{value:new Deferred}})}complete(){this._deffered.complete(null)}fail(e){this._deffered.error(e)}getPromise(){return this._deffered.promise}}class Point{constructor(e=0,t=0){Object.defineProperties(this,{x:{enumerable:!0,value:+e||0},y:{enumerable:!0,value:+t||0}})}getX(){return this.x}getY(){return this.y}equals(e){return this===e||!!e&&this.x===e.x&&this.y===e.y}toString(){return`[ ${this.x}, ${this.y} ]`}}Object.defineProperties(Point.prototype,{0:{get:Point.prototype.getX},1:{get:Point.prototype.getY},length:{value:2}});class VizServiceInterActivity{constructor(e){Oe(this,e)}startInteractivity(e){Ie(this).startInteractivity(e)}canTranslate(){return Ie(this).canTranslate()}translate(e){Ie(this).translate(e)}canZoom(){return Ie(this).canZoom()}zoom(e,t){Ie(this).zoom(e,t)}canZoomIn(){return Ie(this).canZoomIn()}canZoomOut(){return Ie(this).canZoomOut()}canReset(){return Ie(this).canReset()}reset(){Ie(this).reset()}cancelInteractivity(e){Ie(this).cancelInteractivity(e)}endInteractivity(e){Ie(this).endInteractivity(e)}}class Interactivity{constructor(){Object.defineProperties(this,{_rsi:{writable:!0,value:null},_start:{writable:!0,value:null},_active:{writable:!0,value:!0},_host:{value:new VizServiceInterActivity(this)}})}toHost(){return this._host}lock(){this._active=!1,this._start&&this.cancelInteractivity(this._start)}unlock(){this._active=!0}startInteractivity(e){const t=xs(e),r=t.viewPort;this._active&&this._rsi&&(this._start&&this._rsi.endInteractivity(t._vis,r),this._rsi.startInteractivity(t._vis,r)),this._start=t}canTranslate(){return!!(this._active&&this._rsi&&this._rsi.canTranslate())}translate(e){const t=this._start;if(this._active&&this._rsi&&t){const r=xs(e),n=r.viewPort;this._rsi.translate(r._vis,n,new Point(n.x-t.x,n.y-t.y))}}canZoom(){return!!(this._active&&this._rsi&&this._rsi.canZoom())}canZoomIn(){return!!(this._active&&this._rsi&&this._rsi.canZoomIn())}canZoomOut(){return!!(this._active&&this._rsi&&this._rsi.canZoomOut())}canReset(){return!!(this._active&&this._rsi&&this._rsi.canReset())}zoom(e,t){if(this._active&&this._rsi){const r=xs(e);this._rsi.zoom(r._vis,r.viewPort,t)}}reset(){this._active&&this._rsi&&this._rsi.reset()}cancelInteractivity(e){if(this._rsi&&this._start){const t=xs(e);this._rsi.cancelInteractivity(t._vis,t.viewPort)}this._start=null}endInteractivity(e){if(this._rsi&&this._start){const t=xs(e);this._rsi.endInteractivity(t._vis,t.viewPort)}this._start=null}update(e){return this._rsi=e&&e.getInteractivity()||null,this}}class RenderInterrupt{constructor(e){Object.defineProperties(this,{_rsRenderInterrupt:{value:e}})}static fromRSv1(e){return e?new RenderInterrupt(e):null}get supportsPause(){return!!this._rsRenderInterrupt&&this._rsRenderInterrupt.supportsPause()}get supportsAbort(){return!!this._rsRenderInterrupt&&this._rsRenderInterrupt.supportsAbort()}get supportsComplete(){return!!this._rsRenderInterrupt&&this._rsRenderInterrupt.supportsComplete()}pause(e){return this._rsRenderInterrupt.pause(e)}resume(e){return this._rsRenderInterrupt.resume(e)}complete(e){return this._rsRenderInterrupt.complete(e)}abort(e){return this._rsRenderInterrupt.abort(e)}}class RenderInvalidation{constructor(e,t,r,n,s){Object.defineProperties(this,{data:{enumerable:!0,value:!!e},decorations:{enumerable:!0,value:!!t},properties:{enumerable:!0,value:!!r},size:{enumerable:!0,value:!!n},response:{enumerable:!0,value:!!s}})}dataChanged(){return this.data}decorationsChanged(){return this.decorations}propertiesChanged(){return this.properties}sizeChanged(){return this.size}responseReceived(){return this.response}}class RSv1VisualItem{constructor(e,t){Object.defineProperties(this,{_id:{value:e},_properties:{value:t}})}getType(){return"visualItem"}getRSHittableType(){return"visualItem"}getId(){return this._id}getProperties(){return this._properties}}class RSv1VisualItems{constructor(e){Object.defineProperties(this,{_visualItems:{value:e}})}has(e){return this._visualItems.has(e)}get(e){return this._visualItems.get(e)||null}list(){return Array.from(this._visualItems.values())}}class RenderData{constructor(e,t,r,n){Object.defineProperties(this,{width:{enumerable:!0,value:e},height:{enumerable:!0,value:t},data:{enumerable:!0,value:r},decoVer:{enumerable:!0,value:n}})}}const Os=new RenderData(-1,-1,null,-1);function Rs(e,t){let r=null;if(e){const n=e.length||0;r=new Array(n);let s=0;for(let i,o=0;o<n;++o)i=Fn(e[o],t),i&&(r[s++]=i);s<n&&(r.length=s)}return r}function Es(e,t){if(e&&1!==e.nodeType)throw new Error("The provided domNode should be of type ELEMENT");const r=e||document.createElement("div");return r.setAttribute("data-vizbundle",t.id),r}function js(e){const t=Ie(e);if(!t)throw new TypeError("Invalid IVizService provided");return t}class VizServiceImpl extends Destroyable{constructor(e,t,r,n,s,i,o,a,l){super();const u=new Interactivity;Object.defineProperties(this,{vizBundle:{enumerable:!0,value:e},_viprNls:{value:t},_logger:{value:r},_props:{value:n},properties:{enumerable:!0,value:n.toHost()},visualItems:{enumerable:!0,value:n.getVisualItems()},_dataContext:{value:s},surface:{enumerable:!0,value:Es(i,e)},_hostApi:{value:new HostApi(o,this._requestRender.bind(this),r)},userData:{enumerable:!0,value:void 0===a?null:a},_renderer:{value:l},_interactivity:{value:u},_queue:{value:new RenderQueue(this._beforeRender.bind(this),this._executeRender.bind(this),this._afterRender.bind(this),15e3)},truncate:{enumerable:!0,writable:!0,value:!0},_data:{writable:!0,value:null},_lastCapabilities:{writable:!0,value:null},_renderData:{writable:!0,value:Os},_lastRenderData:{writable:!0,value:Os},_destroyPromise:{writable:!0,value:null}})}static getRendererForTest(e){return js(e)._renderer}static getHostApiForTest(e){return js(e)._hostApi}get renderTimeout(){return this._queue.timeout}set renderTimeout(e){this._queue.timeout=e}get vizDef(){return this.vizBundle.vizDef}destroy(){this.destroyAsync()}destroyAsync(){if(this._destroyPromise)return this._destroyPromise;const e=new Error("RenderingService is being destroyed");return this._hostApi.abortRequests(e),this._destroyPromise=new Promise(((t,r)=>{const n=this.surface&&this.surface.parentNode;n&&n.removeChild(this.surface);const s=()=>{this._interactivity&&this._interactivity.update(null),this._renderer.destroy(),this._data=null,this._lastRenderData=this._renderData=Os,super.destroy()};t(this._queue.destroy(e).then(s,s))})),this._destroyPromise}init(e,t,r){return pn(this,void 0,void 0,(function*(){const n=new RSv1DataContext(this._dataContext),s=new RSv1Properties(this._props,n,t),i=function(e,t){const r=new Map;return t.forEach(((t,n)=>{const s=new RSv1VisualItem(n,t);r.set(n,s),t.forEach((t=>{var r;return null===(r=e.get(t.name))||void 0===r?void 0:r.push(s)}))})),new RSv1VisualItems(r)}(this._props.propsToRSVisualItemsMap,this._props.visualItemsToRSProps),o=new InitializationParameters(this.surface,this._hostApi.toRSv1(),e.resources,this._logger,this.vizBundle.getLocale(),r,this.vizBundle.getNls(),s,i,n),a=new InitNotification;return this._renderer.init(o,a),this.own(this._props.on("value",this._properties_onValue.bind(this,s))),a.getPromise().then((()=>{if(Destroyable.isDestroyed(this))throw new Error("VizService destroyed before initialization completed.");return this._props.postInit(),new VizService(this)}))}))}getRenderSurface(){return this.surface}setData(e,t){let r=null;e instanceof VIPRData?r=e:e&&(r=this.vizBundle.processData(e,t));let n=r;if(r&&!VIPRData.isSliced(r)){n=this.sliceData(r,null).slices[0]}return n&&n.initDataContext(this._dataContext),this._data=n,this._renderer.setData(n),this._lastCapabilities=null,r}sliceData(e,t){return this.vizBundle.sliceData(e,t,this.truncate?this._lastCapabilities||this.getCapabilities():null,this._hostApi.toHost())}setProperty(e,t){const r=this.properties.get(e);return r instanceof VizValueProperty&&(r.value=t),r}render(e,t,r){return e?this._queue.add(RenderParameters.fromHost(e),t,r):this._queue.add(new RenderParameters("client",this.surface.offsetWidth,this.surface.offsetHeight),t,r)}_requestRender(){this._queue.add(null)}_beforeRender(e,t){const r=this._renderer.getBlockingRequests()||null;let n;function s(e,r,s){if(!s||!s.isActive()){if(s){const e=n.indexOf(s);if(e<0)return;n.splice(e,1)}n.length<1&&t.complete()}}if(r&&!Array.isArray(r))throw new TypeError("Renderer getBlockingRequests did not return a valid value");let i=0;if(r){i=r.length,n=[];for(let e=0;e<i;++e){const t=r[e];if(!(t&&t instanceof RSv1Request))throw new TypeError("Invalid IRSRequest passed");t.isActive()&&(n.push(t),t.subscribe(s))}i=n.length}i<1&&t.complete()}_executeRender(e,t){const r=this._hostApi.responseReceived;r&&(this._hostApi.responseReceived=!1),this._renderData=new RenderData(e.width||this.surface.offsetWidth,e.height||this.surface.offsetHeight,this._data,this._data?this._data.refreshDecorations():-1);const n=this._renderData.data!==this._lastRenderData.data,s=new RenderInvalidation(n,n||this._renderData.decoVer!==this._lastRenderData.decoVer,this._props.isDirtyLocked(),this._renderData.width!==this._lastRenderData.width||this._renderData.height!==this._lastRenderData.height,r);return this._interactivity.lock(),this._props.lock(),RenderInterrupt.fromRSv1(this._renderer.render(e,s,t))}_afterRender(e){const t="complete"===e.status;t&&(this._lastRenderData=this._renderData),this._renderData=Os,this._interactivity.unlock(),this._props.unlock(t)}_properties_onValue(e,r){const n=r.property.getDef();if(n.type!==t.PropertyType.Group&&!n.deprecated){const t=e.get(n.name);t&&this._renderer.setProperty(n.name,t.peekValue())}}getCapabilities(){const e=this._renderer.getCapabilities(),t=e&&e.length||0,r=new Array(t);if(e)for(let n=0;n<t;++n)r[n]=Gn(e[n]);return this._lastCapabilities=r,r}getEncodings(){const e=this._data;return e&&e.refreshDecorations(),function(e){const r=[];if(!e)return r;const n=e.length;for(let o=0;o<n;++o){const n=e[o];switch(t.EncodingType.parse(n.getRSType())){case t.EncodingType.Cat:r.push(new CatEncoding((i=n).getSlot(),i.getChannel(),i.getCaption(),i.getSubCaption(),Fn(i.getRef()),Object.freeze(Array.from(i.getEntries(),Un))));break;case t.EncodingType.Cont:r.push(Hn(n));break;case t.EncodingType.Custom:r.push(new CustomEncoding((s=n).getSlot(),s.getChannel(),s.getCaption(),s.getSubCaption(),Fn(s.getRef()),s.getPayload()));break;default:throw new TypeError("Unsupported encoding type")}}var s,i;return r}(this._renderer.getEncodings())}getInteractivity(){return this._interactivity.update(this._renderer),this._interactivity.toHost()}getVisCoordinate(e,t,r=1){const n=new Point(e,t),s=this.surface.getBoundingClientRect(),i=new Point((n.x-s.left)/r,(n.y-s.top)/r);return new Coordinate(i,this._renderer.getVisCoordinate(i,n))}getClientPoint(e,t=1){const r=this.surface.getBoundingClientRect();return new Point(e.x*t+r.left,e.y*t+r.top)}getRegionAtPoint(e,t){let r=null;const n=e&&e.viewPort;if(n){const e=this._renderer.getRegionAtPoint(n,t&&t>0?t:0);e&&(r=Kn(e))}return r}getItemsAtPoint(e,t){return Rs(this._renderer.getItemsAtPoint(e._vis,e.viewPort,t&&t>0?t:0),this._props.getVisualItems())}getAxisItemsAtPoint(e,r){return function(e){const r=e&&e.length||0,n=new Array(r);if(!e)return n;let s=0;for(let o,a=0;a<r;++a)o=e[a],o&&(n[s++]=(i=o,new AxisItem(t.DataItemType.parse(i.getType()),i.getSlot(),i.getTuple(),i.getValue(),t.HittableType.parse(i.getRSHittableType()))));var i;return s<r&&(n.length=s),n}(this._renderer.getAxisItemsAtPoint(e._vis,e.viewPort,r&&r>0?r:0))}getItemsInPolygon(e){const t=e&&e.length||0;if(t<2)return[];const r=new Array(t),n=new Array(t);for(let s,i=0;i<t;++i)s=e[i],r[i]=s._vis,n[i]=s.viewPort;return Rs(this._renderer.getItemsInPolygon(r,n))}getState(){return this._renderer.getState()}setState(e){this._renderer.setState(e)}}class VizService{get vizBundle(){return Ie(this).vizBundle}get vizDef(){return Ie(this).vizDef}get domNode(){return Ie(this).getRenderSurface()}get userData(){return Ie(this).userData}get truncate(){return Ie(this).truncate}set truncate(e){Ie(this).truncate=!!e}get renderTimeout(){return Ie(this).renderTimeout}set renderTimeout(e){Ie(this).renderTimeout=+e||0}get properties(){return Ie(this).properties}get visualItems(){return Ie(this).visualItems}constructor(e){Oe(this,e)}destroy(){Ie(this).destroy()}destroyAsync(e){return Ie(this).destroyAsync()}setData(e,t){return Ie(this).setData(e,t)}sliceData(e,t=null){return Ie(this).sliceData(e,t)}setProperty(e,t){return Ie(this).setProperty(e,t)}render(e,t,r){return Ie(this).render(e,t,r)}getCapabilities(){return Ie(this).getCapabilities()}getEncodings(){return Ie(this).getEncodings()}getInteractivity(){return Ie(this).getInteractivity()}getVisCoordinate(e,t,r=1){return Ie(this).getVisCoordinate(e,t,r)}getClientPoint(e,t=1){return Ie(this).getClientPoint(e,t)}getRegionAtPoint(e,t){return Ie(this).getRegionAtPoint(xs(e),t)}getItemsAtPoint(e,t){return Ie(this).getItemsAtPoint(xs(e),t)}getAxisItemsAtPoint(e,t){return Ie(this).getAxisItemsAtPoint(xs(e),t)}getItemsInPolygon(e){return Array.prototype.forEach.call(e,xs),Ie(this).getItemsInPolygon(e)}getState(){return Ie(this).getState()}setState(e){Ie(this).setState(e)}}class PropertyDef{constructor(e,r,n,s,i,o,a,l,u,c){Object.defineProperties(this,{type:{enumerable:!0,value:t.PropertyType.parse(e)},name:{enumerable:!0,value:r},_caption:{value:n},_description:{value:s||null},aliases:{enumerable:!0,value:Object.freeze(i||v)},tags:{enumerable:!0,value:Object.freeze(o||v)},visibility:{enumerable:!0,value:t.PropertyVisibility.parse(a)},deprecated:{enumerable:!0,value:l},affectedBy:{enumerable:!0,value:u||v},visualItems:{enumerable:!0,value:c||v}})}get caption(){return"function"==typeof this._caption?this._caption():this._caption}get description(){return"function"==typeof this._description?this._description():this._description}}class ValuePropertyDef extends PropertyDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f){if(e===t.PropertyType.Group)throw new Error(`A ValuePropertyDef cannot have type ${t.PropertyType.Group}`);super(e,r,n,s,i,o,a,l,u,c),Object.defineProperties(this,{allowNull:{enumerable:!0,value:!!p},defaultValue:{enumerable:!0,value:h},serviceWritable:{enumerable:!0,value:!!l||!!d},requiresData:{enumerable:!0,value:!!f}})}_handleNull(e){return null!==e||this.allowNull?e:this.defaultValue}_validate(){this.allowNull||null!==this.defaultValue||this._nullDefault()}_nullDefault(){throw new TypeError("defaultValue cannot be null, allowNull is false")}}const Vs=/^(?:true|yes|on|1)$/i,ks=/^(?:false|no|off|0)$/i;class BooleanPropertyDef extends ValuePropertyDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d){super(t.PropertyType.Boolean,e,r,n,s,i,o,a,l,u,c,p,h,d),this._validate()}static parse(e,t,r=null){let n=r;return"string"==typeof e&&e.length>0&&(Vs.test(e)?n=!0:ks.test(e)&&(n=!1)),null!==n||t||(n=null!==r&&r),n}_clone(e,t,r,n,s,i){return new BooleanPropertyDef(this.name,e,t,r,n,s,this.deprecated,this.affectedBy,this.visualItems,this.allowNull,i,this.serviceWritable,this.requiresData)}parse(e,t=this.defaultValue){return void 0===e?this.defaultValue:this._handleNull(null===e?null:this._parseImpl(e,t))}_parseImpl(e,t){return"boolean"==typeof e?e:BooleanPropertyDef.parse(e,this.allowNull,t)}}class CapabilityDef{constructor(e){Object.defineProperties(this,{decorations:{enumerable:!0,value:e}})}getDecoration(e){for(let t=0,r=this.decorations.length;t<r;++t){const r=this.decorations[t];if(r.name===e)return r}return null}}const As=/^(?:\s*|auto(?:matic)?|null|inherit)$/i;class ColorPropertyDef extends ValuePropertyDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d){super(t.PropertyType.Color,e,r,n,s,i,o,a,l,u,c,p,h,d),this._validate()}static parse(e,t,r=null){let n=null;return"string"==typeof e&&e.length>0&&!As.test(e)&&(n=Color.fromString(e),n||(n=void 0===r?null:r)),t||null!==n||(n=null===r?Color.Named.black:r),n}parse(e,t=this.defaultValue){return void 0===e?this.defaultValue:this._handleNull(null===e?null:this._parseImpl(e,t))}_parseImpl(e,t){return"string"==typeof e?ColorPropertyDef.parse(e,this.allowNull,t):e instanceof Color||F(e)?Color.fromHost(e):$(e)?Color.fromObject(e):t}}class DataSetDef{constructor(e,t,r,n,s,i,o,a,l){Object.defineProperties(this,{index:{enumerable:!0,value:e},slots:{enumerable:!0,value:t},name:{enumerable:!0,value:r},optional:{enumerable:!0,value:n},suppressMissing:{enumerable:!0,value:s},needsSorted:{enumerable:!0,value:i},requiresValues:{enumerable:!0,value:o},uniqueDataPoints:{enumerable:!0,value:a},caption:{enumerable:!0,value:l}})}hasSlot(e){return null!==this.getSlot(e)}getSlot(e){return this.slots.find((function(t){return t.name===e}))||null}}class DecorationDef{constructor(e,t,r,n,s,i){return Object.defineProperties(this,{name:{enumerable:!0,value:e},type:{enumerable:!0,value:t},target:{enumerable:!0,value:Object.freeze(r)},targetSlot:{enumerable:!0,value:n},referenceSlot:{enumerable:!0,value:s},deprecated:{enumerable:!0,value:i}})}}var Ls;t.DefaultMapping=void 0,(Ls=t.DefaultMapping||(t.DefaultMapping={})).None="none",Ls.Rows="rows";const zs=/^(?:none|rows)$/;!function(e){function t(e){return function(e){return"string"==typeof e&&zs.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid DefaultMapping: ${e}`);return r}}(t.DefaultMapping||(t.DefaultMapping={}));class EnumPropertyDef extends ValuePropertyDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f,g){if(!Array.isArray(f)||!f.every(le))throw new TypeError("_possibleValues must be an Array of EnumValue");if(null!==p&&(!le(p)||f.indexOf(p)<0))throw new TypeError(`Invalid defaultValue: ${p}`);super(t.PropertyType.Enum,e,r,n,s,i,o,a,l,u,c,p,h,d),Object.defineProperties(this,{possibleValues:{enumerable:!0,value:f},dynamic:{enumerable:!0,value:g}}),this._validate()}static parse(e,t,r,n=null){const s=Array.isArray(r)?r.length:0;if(s<1&&!t)throw new TypeError("PossibleValues must have at least 1 value");if(null!=e)for(let t=0;t<s;++t){const n=r[t];if(n.getName()===e)return n}else if(t)return null;return null!=n||t?n||null:r[0]}parse(e,t=this.defaultValue){return void 0===e?this.defaultValue:this._handleNull(null===e?null:this._parseImpl(e,t))}_parseImpl(e,t){return le(e)&&this.possibleValues.indexOf(e)>=0?e:"string"==typeof e?EnumPropertyDef.parse(e,this.allowNull,this.possibleValues,t):t}_nullDefault(){this.dynamic&&this.possibleValues.length<1||super._nullDefault()}}var Ns;t.FieldRole=void 0,(Ns=t.FieldRole||(t.FieldRole={})).Explanatory="explanatory",Ns.Group="group",Ns.Other="other",Ns.Reference="reference",Ns.Repeat="repeat",Ns.Response="response",Ns.Weight="weight";const Ms=/^(?:explanatory|group|other|reference|repeat|response|weight)$/;!function(e){function t(e){return function(e){return"string"==typeof e&&Ms.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid FieldRole: ${e}`);return r}}(t.FieldRole||(t.FieldRole={}));const Fs=Object.freeze(new Font(null,new Length(1,t.LengthUnit.Em),null,null));class FontPropertyDef extends ValuePropertyDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d){super(t.PropertyType.Font,e,r,n,s,i,o,a,l,u,c,p,h,d),this._validate()}static parse(e,t,r=null){let n=null;return e&&(n=Font.parse(e)),t||null!==n||(n=null===r?Fs:r),n}parse(e,t=this.defaultValue){return void 0===e?this.defaultValue:this._handleNull(null===e?null:this._parseImpl(e,t))}_parseImpl(e,t){let r=null;return e instanceof Font?r=e:"string"==typeof e&&(r=FontPropertyDef.parse(e,this.allowNull,t)),r||(r=t),r}}var $s;t.GeoSpatialPart=void 0,($s=t.GeoSpatialPart||(t.GeoSpatialPart={})).Latitude="latitude",$s.Longitude="longitude",$s.FeatureId="featureid",$s.Caption="caption";const qs=/^(?:latitude|longitude|featureid|caption)$/;!function(e){function t(e){return function(e){return"string"==typeof e&&qs.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid GeoSpatialPart: ${e}`);return r}}(t.GeoSpatialPart||(t.GeoSpatialPart={}));class SlotDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f,g){if(e===t.SlotType.Cat&&p!==t.Aggregation.None)throw new TypeError("_aggregation must be Aggregation.None for Cat slots");const m=Math.trunc(c)||0;Object.defineProperties(this,{type:{enumerable:!0,value:e},subType:{enumerable:!0,value:r},subTypeOptional:{enumerable:!0,value:!!n},name:{enumerable:!0,value:s},optional:{enumerable:!0,value:!!i},_caption:{enumerable:!0,value:o},_description:{enumerable:!0,value:a||null},multiDataItem:{enumerable:!0,value:!!l},channels:{enumerable:!0,value:Object.freeze(u||v)},maxLevels:{enumerable:!0,value:c<1?-1:m},aggregation:{enumerable:!0,value:p},suppressMissing:{enumerable:!0,value:!!h},role:{enumerable:!0,value:d},defaultMapping:{enumerable:!0,value:f},hidden:{enumerable:!0,value:!!g}})}get caption(){return"function"==typeof this._caption?this._caption():this._caption}get description(){return"function"==typeof this._description?this._description():this._description}get isValues(){return this.type!==t.SlotType.Cat}get singleMember(){return this.type===t.SlotType.Cont&&!this.multiDataItem}toString(){return this.name}}class GeoSegmentDef extends SlotDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f){super(e,t.SlotSubType.GeoSpatial,!1,r,n,s,i,o,a,l,u,c,p,h,f),Object.defineProperties(this,{part:{enumerable:!0,value:d}})}static create(e,r,n,s,i,o,a,l,u,c){let p=t.SlotType.Cat;c!==t.GeoSpatialPart.Longitude&&c!==t.GeoSpatialPart.Latitude||(p=t.SlotType.Cont);const h=c===t.GeoSpatialPart.Caption?-1:1,d=p!==t.SlotType.Cont&&s;return new GeoSegmentDef(p,`${e}.${c}`,i,o,a,!1,null,h,l||(p===t.SlotType.Cat?t.Aggregation.None:t.Aggregation.Auto),d,u,r,c,n)}}class GeoSegmentRef extends SlotRef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f,g){super(e,t.SlotSubType.GeoSpatial,!1,r,n,s,i,o,a,l,u,c,p,h,d,g),Object.defineProperties(this,{part:{enumerable:!0,value:f}})}static createGeoSegment(e,t){return new GeoSegmentRef(e.type,e.name,e.optional,e.caption,e.description,e.multiDataItem,e.channels,e.maxLevels,e.aggregation,e.suppressMissing,e.role,e.defaultMapping,e.hidden,e.part,t)}static defsToRefs(e,t){let r=[];const n=+(e&&e.length)||0;if(n>0){r=new Array(n);for(let s=0;s<n;++s)r[s]=GeoSegmentRef.createGeoSegment(e[s],t)}return r}}class GeoSlotDef extends SlotDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f){super(t.SlotType.Cat,t.SlotSubType.GeoSpatial,e,r,n,s,i,o,a,l,u,c,p,h,f),Object.defineProperties(this,{segments:{enumerable:!0,value:d}})}}class GeoSlotRef extends SlotRef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f,g){super(t.SlotType.Cat,t.SlotSubType.GeoSpatial,e,r,n,s,i,o,a,l,u,c,p,h,f,g),Object.defineProperties(this,{segments:{enumerable:!0,value:d}})}static createGeo(e,t,r,n){return new GeoSlotRef(e.subTypeOptional,e.name,t,e.caption,e.description,e.multiDataItem,e.channels,e.maxLevels,e.aggregation,e.suppressMissing,e.role,e.defaultMapping,r,e.hidden,n)}}class GroupPropertyDef extends PropertyDef{constructor(e,r,n,s,i,o,a,l,u){super(t.PropertyType.Group,e,r,n,s,i,o,a,null,l),Object.defineProperties(this,{properties:{enumerable:!0,value:u}}),this._validate()}isEmpty(){for(let e=0,t=this.properties.length;e<t;++e)if("excluded"!==this.properties[e].visibility)return!1;return!0}_validate(){}}const Bs=Object.freeze(new Length(0,t.LengthUnit.Pixel));class LengthPropertyDef extends ValuePropertyDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f){super(t.PropertyType.Length,e,r,n,s,i,o,a,l,u,c,p,h,d),Object.defineProperties(this,{allowNegative:{enumerable:!0,value:f}}),this._validate()}static parse(e,t,r=null){let n=null;return"string"!=typeof e&&"number"!=typeof e||(n=Length.parse(String(e)),n||(n=void 0===r?null:r)),t||null!==n||(n=null==r?Bs:r),n}parse(e,t=this.defaultValue){return void 0===e?this.defaultValue:this._handleNull(null===e?null:this._parseImpl(e,t))}_parseImpl(e,t){let r=null;return ue(e)?r=Length.fromHost(e):"string"==typeof e||"number"==typeof e?r=LengthPropertyDef.parse(e,this.allowNull,t):ce(e)&&(r=Length.fromObject(e)),(!r||!this.allowNegative&&r.getValue()<0)&&(r=t),r}valuesEqual(e,t){return e===t||(ue(e)?Length.fromHost(e).equals(t):!!ce(e)&&Length.fromObject(e).equals(t))}}class MetaDataEntryDef{constructor(e,t){Object.defineProperties(this,{name:{enumerable:!0,value:e},value:{enumerable:!0,value:t}})}}function Hs(e){if(null==e)return null;if("number"==typeof e)return e;throw new TypeError(`${e} is not a valid number`)}class NumberPropertyDef extends ValuePropertyDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f,g){super(t.PropertyType.Number,e,r,n,s,i,o,a,l,u,c,p,h,d),Object.defineProperties(this,{minValue:{enumerable:!0,value:Hs(f)},maxValue:{enumerable:!0,value:Hs(g)}}),this._validate()}static parse(e,t,r){let n=null;return"string"==typeof e&&(n=q(e,r)),null!==n||t||(n=null==r?0:r),n}parse(e,t=this.defaultValue){return void 0===e?this.defaultValue:this._handleNull(null===e?null:this._parseImpl(e,t))}_parseImpl(e,t){let r;switch(typeof e){case"number":r=e;break;case"string":r=q(e,t);break;default:r=t}return"number"==typeof r&&(null!==this.minValue&&r<this.minValue&&(r=this.minValue),null!==this.maxValue&&r>this.maxValue&&(r=this.maxValue)),r}_validate(){if(super._validate(),null!==this.minValue&&null!==this.maxValue&&this.maxValue<this.minValue)throw new Error(`Invalid range, minValue ${this.minValue} is greater than maxValue ${this.maxValue}`);if(null!==this.defaultValue){if(null!==this.minValue&&this.defaultValue<this.minValue)throw new Error(`defaultValue ${this.defaultValue} is out of bounds, it is below minValue ${this.minValue}`);if(null!==this.maxValue&&this.defaultValue>this.maxValue)throw new Error(`defaultValue ${this.defaultValue} is out of bounds, it is above maxValue ${this.maxValue}`)}}}class PalettePropertyDef extends ValuePropertyDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f,g,m,y){super(t.PropertyType.Palette,e,r,n,s,i,o,a,l,u,c,p,h,d),Object.defineProperties(this,{slot:{enumerable:!0,value:f},paletteType:{enumerable:!0,value:g},min:{enumerable:!0,value:m},max:{enumerable:!0,value:y}}),this._validate()}static parse(e,r,n,s){if(r)switch(e){case t.PaletteType.Cat:return new CatPaletteResolver(r);case t.PaletteType.CustomCat:return new CustomCatPaletteResolver(r);case t.PaletteType.Cont:return new ContPaletteResolver(r);case t.PaletteType.CustomCont:return new CustomContPaletteResolver(r);default:throw new Error(`Unsupported PaletteType: ${e}`)}else if(!n){if(!s)throw new Error("Invalid fallback resolver provided");return s}return null}parse(e,t=this.defaultValue){return void 0===e?this.defaultValue:this._handleNull(null===e?null:this._parseImpl(e,t))}_parseImpl(e,r){if("string"==typeof e)try{return PalettePropertyDef.parse(this.paletteType,e,this.allowNull,r)}catch(e){}else if(e)switch(this.paletteType){case t.PaletteType.Cat:if("object"==typeof(n=e)&&null!==n&&"getColor"in n&&"getDefaultColor"in n)return e;break;case t.PaletteType.Cont:if(function(e){return"object"==typeof e&&null!==e&&"getColorStops"in e}(e))return e;break;case t.PaletteType.CustomCat:if(function(e){return"object"==typeof e&&null!==e&&"getColor"in e}(e))return e;break;case t.PaletteType.CustomCont:if(function(e){return"object"==typeof e&&null!==e&&"getColorStops"in e}(e))return e;break;default:throw new Error(`Unsupported PaletteType: ${this.paletteType}`)}var n;return r}}class SlotGroupDef{constructor(e,t,r){Object.defineProperties(this,{_caption:{enumerable:!0,value:e},_description:{enumerable:!0,value:t},slots:{enumerable:!0,value:r}})}get caption(){return"function"==typeof this._caption?this._caption():this._caption}get description(){return"function"==typeof this._description?this._description():this._description}toString(){return this.caption}}class StringPropertyDef extends ValuePropertyDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d){super(t.PropertyType.String,e,r,n,s,i,o,a,l,u,c,p,h,d),this._validate()}static parse(e,t,r){return"string"==typeof e?e:w(r)&&!t?y:r}parse(e,t=this.defaultValue){return void 0===e?this.defaultValue:this._handleNull(null===e?null:this._parseImpl(e,t))}_parseImpl(e,t){return StringPropertyDef.parse(null===e?null:String(e),this.allowNull,t)}}class TemporalAttributeDef{constructor(e,t){Object.defineProperties(this,{level:{enumerable:!0,value:e},optional:{enumerable:!0,value:t}})}}var Gs;t.TemporalLevel=void 0,(Gs=t.TemporalLevel||(t.TemporalLevel={})).Year="year",Gs.Month="month",Gs.Day="day",Gs.Hour="hour",Gs.Minute="minute",Gs.Second="second",Gs.Fraction="fraction";const Us=/^(?:year|month|day|hour|minute|second|fraction)$/;!function(e){function t(e){return function(e){return"string"==typeof e&&Us.test(e)}(e)?e:null}e.tryParse=t,e.parse=function(e){const r=t(e);if(null===r)throw new TypeError(`Invalid TemporalLevel: ${e}`);return r}}(t.TemporalLevel||(t.TemporalLevel={}));class TemporalSlotDef extends SlotDef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f){super(t.SlotType.Cat,t.SlotSubType.Temporal,e,r,n,s,i,o,a,l,u,c,p,h,f),Object.defineProperties(this,{attributes:{enumerable:!0,value:d}})}}class TemporalSlotRef extends SlotRef{constructor(e,r,n,s,i,o,a,l,u,c,p,h,d,f,g){super(t.SlotType.Cat,t.SlotSubType.Temporal,e,r,n,s,i,o,a,l,u,c,p,h,f,g),Object.defineProperties(this,{attributes:{enumerable:!0,value:d}})}static createTemporal(e,t,r){return new TemporalSlotRef(e.subTypeOptional,e.name,t,e.caption,e.description,e.multiDataItem,e.channels,e.maxLevels,e.aggregation,e.suppressMissing,e.role,e.defaultMapping,e.attributes,e.hidden,r)}}function Ws(e,t,r=Object.is){if(e===t)return!0;const n=e.length;let s=e.length===t.length;for(let i=0;s&&i<n;++i)s=r(e[i],t[i]);return s}function Ks(e,t){return e.push(...t.slots),e}function Xs(e){return e.type===t.PropertyType.Group}function Js(e,t){const r=t.length;for(let n=0;n<r;++n){const s=t[n];e.set(s.name,s);for(let t=0;t<r;++t)e.set(s.aliases[t],s);Xs(s)&&Js(e,s.properties)}}function Qs(e,t){return Ws(e.properties,t)?e:new GroupPropertyDef(e.name,e.caption,e.description,e.aliases,e.tags,e.visibility,e.deprecated,e.visualItems,t)}function Ys(e,t){throw new Error(`VizDef extend name conflict: ${t} ${e} already exists.`)}function Zs(e,t){for(const r of e)t.has(r.name)&&Ys(r.name,"property"),r instanceof GroupPropertyDef&&Zs(r.properties,t)}function ei(e,t,r){const n=e.slice(0);for(const s of t){const t=r.get(s.name);if(t){Xs(t)&&Xs(s)||Ys(s.name,"property");const i=e.indexOf(t);if(i<0)throw new Error(`VizDef extend hierarchy error. Attempt to merge group ${s.name} in incorrect location.`);n[i]=Qs(t,ei(t.properties,s.properties,r))}else Xs(s)&&Zs(s.properties,r),n.push(s)}return Object.freeze(n)}function ti(e,t,r,n){for(let s=0,i=t.length;s<i;++s){const i=t[s];"group"===i.type?ti(e,i.properties,r,n):r.call(n,i,i.name)&&e.push(i)}return e}function ri(e){return e.visibility===t.PropertyVisibility.Listed}class VizDef{constructor(e,t,r,n,s,i,o,a){const l=new Map;Js(l,s),Js(l,i),Object.defineProperties(this,{slotGroups:{enumerable:!0,value:t},slots:{enumerable:!0,value:r},dataSets:{enumerable:!0,value:n},properties:{enumerable:!0,value:s},configuration:{enumerable:!0,value:i},capabilities:{enumerable:!0,value:o},metaDataEntries:{enumerable:!0,value:a},source:{enumerable:!0,value:e},_propertyMap:{value:Object.freeze(l)}})}extend(e){const t=null!==this.source?this.source:this;let r=t.slotGroups,n=t.slots,s=t.dataSets,i=t.properties,o=t.configuration;if(e.slotGroups){const i=r.concat(e.slotGroups),o=e.slotGroups.reduce(Ks,[]),a=n.concat(o),l=s.slice(0);for(const e of o)t.getSlot(e.name)&&Ys(e.name,"slot");for(let e=0;e<l.length;++e){const t=l[e],r=t.slots.length,n=new Array(r+o.length);let s;for(s=0;s<r;++s)n[s]=t.slots[s];for(const t of o)n[s++]=VizDef.createSlotRef(t,t.optional,e);l[e]=new DataSetDef(t.index,n,t.name,t.optional,t.suppressMissing,t.needsSorted,t.requiresValues,t.uniqueDataPoints,t.caption)}r=Object.freeze(i),n=Object.freeze(a),s=Object.freeze(l)}return e.properties&&(i=ei(i,e.properties,t._propertyMap)),e.configuration&&(o=ei(o,e.configuration,t._propertyMap)),new VizDef(null,r,n,s,i,o,t.capabilities,t.metaDataEntries)}static createSlotRef(e,r,n){switch(e.subType){case t.SlotSubType.GeoSpatial:const s=e;return GeoSlotRef.createGeo(s,r,GeoSegmentRef.defsToRefs(s.segments,n),n);case t.SlotSubType.Temporal:return TemporalSlotRef.create(e,r,n);default:return SlotRef.create(e,r,n)}}static create(e,t,r,n,s,i,o){return new VizDef(null,e,t,r,n,s,i,o)}getSlot(e){const t=this.slots.length;for(let r=0;r<t;++r)if(this.slots[r].name===e)return this.slots[r];return null}getDataSet(e){const t=this.dataSets.length;for(let r=0;r<t;++r)if(this.dataSets[r].name===e)return this.dataSets[r];return null}getProperty(e){const t=this._propertyMap.get(e);return t||null}listProperties(e,t){const r=new Array;let n=null;const s=e||ri;if(e){if(!ye(e))throw new TypeError(`${e} is not callable`);n=t||n,n&&(n=Object(n))}return ti(r,this.properties,s,n)}getMetaDataEntry(e){const t=this.metaDataEntries.length;for(let r=0;r<t;++r)if(this.metaDataEntries[r].name===e)return this.metaDataEntries[r];return null}}const ni=/\{\{|\}\}|\{(\d+)(?:([\+\*])([^\}]+)?)?\}/g;class LogMessage extends Error{constructor(e,t,r,n,s,i){super(n),Error.captureStackTrace&&Error.captureStackTrace(this,i||this.constructor),Object.defineProperties(this,{timeStamp:{enumerable:!0,value:e},level:{enumerable:!0,value:t},context:{enumerable:!0,value:r},cause:{enumerable:!0,value:s}})}static create(e,t,r,n,s,i){let o;const a=i[0]instanceof Error?i[0]:null;return o=ye(s)?s.apply(i[0]||null,i.slice(1)):function(e,...t){return e.replace(ni,(function(e,r,n,s){let i=e;if(r){if(r in t){const e=t[r];switch(n){case"*":{const t=+s;i=JSON.stringify(e,null,Number.isNaN(t)?s:t);break}case"+":i=Array.prototype.join.call(e,s);break;default:i=String(e)}}}else i=i.charAt(0);return i}))}(String(s),i),new LogMessage(t,r,n,o,a,e)}}Object.defineProperty(LogMessage.prototype,"name",{enumerable:!0,value:"LogMessage"});class Logger{constructor(e,t){Object.defineProperties(this,{_appender:{enumerable:!0,value:e},context:{enumerable:!0,value:t}})}isDebugEnabled(){return this._appender.accept(t.LogLevel.debug,this.context)}isInfoEnabled(){return this._appender.accept(t.LogLevel.info,this.context)}isWarnEnabled(){return this._appender.accept(t.LogLevel.warn,this.context)}isErrorEnabled(){return this._appender.accept(t.LogLevel.error,this.context)}log(e,...r){const n=new Date;this._appender.accept(t.LogLevel.log,this.context)&&this._appender.log(LogMessage.create(this.log,n,t.LogLevel.log,this.context,e,r))}debug(e,...r){const n=new Date;this._appender.accept(t.LogLevel.debug,this.context)&&this._appender.log(LogMessage.create(this.debug,n,t.LogLevel.debug,this.context,e,r))}info(e,...r){const n=new Date;this._appender.accept(t.LogLevel.info,this.context)&&this._appender.log(LogMessage.create(this.info,n,t.LogLevel.info,this.context,e,r))}warn(e,...r){const n=new Date;this._appender.accept(t.LogLevel.warn,this.context)&&this._appender.log(LogMessage.create(this.warn,n,t.LogLevel.warn,this.context,e,r))}error(e,...r){const n=new Date;this._appender.accept(t.LogLevel.error,this.context)&&this._appender.log(LogMessage.create(this.error,n,t.LogLevel.error,this.context,e,r))}}function si(e){return e instanceof ConsoleAppender}class LogScope{constructor(){Object.defineProperties(this,{_appenders:{value:[]}})}add(e){const t="console"===e?this._appenders.find(si)||new ConsoleAppender:e;if("object"!=typeof(r=t)||null===r||!("accept"in r)||!("log"in r))throw new TypeError("Appender does not comply with the IAppender interface");var r;return this._appenders.indexOf(t)<0&&this._appenders.push(t),t}remove(e){const t="console"===e?this._appenders.find(si):e,r=t?this._appenders.indexOf(t):-1;return r<0?null:this._appenders.splice(r,1)[0]}accept(e,t){for(const r of this._appenders)if(r.accept(e,t))return!0;return!1}log(e){for(const t of this._appenders)try{t.log(e)}catch(e){}}create(e){return new Logger(this,e)}}const ii=Array.prototype.filter,oi=Array.prototype.find,ai=/\s*,\s*/,li=/^\s*(?:true)\s*$/i;function ui(e){return 1===e.nodeType}function ci(e){return 3===e.nodeType}function pi(e){let t;if(e instanceof RegExp)t=e.test.bind(e);else{if("string"!=typeof e)throw new TypeError("Invalid query type, must be String or RegExp");t=Object.is.bind(Object,e)}return function(e){return ui(e)&&t(e.tagName)}}let hi=null;if("undefined"!=typeof DOMParser)try{hi=new DOMParser}catch(e){hi=null}function di(e){if(!hi)throw new Error("DOMParser or xmldom is required to parse xml.");return hi.parseFromString(e,"text/xml")}function fi(e){let t="";if(ui(e)){const r=e.childNodes.length;for(let n=0;n<r;++n){const r=e.childNodes[n];ci(r)&&r.nodeValue&&(t+=r.nodeValue)}}else ci(e)&&e.nodeValue&&(t=e.nodeValue);return t}function gi(e){return ii.call(e.childNodes,ui)}function mi(e,t){return ii.call(e.childNodes,pi(t))}function yi(e,t){return oi.call(e.childNodes,pi(t))}function vi(e,t,r=null){return function(e,t){return!!e&&(e.hasAttribute?e.hasAttribute(t):null!==e.getAttribute(t))}(e,t)?e.getAttribute(t):r}function bi(e,t,r,n=null,s){const i=e.getAttribute(t);if(null===i)return n;let o=r(i);if(!o){if(s)throw new TypeError(En(s,i));o=n}return o}function wi(e,t,r=null){let n=e.getAttribute(t);return null===n?r:(n=n.trim(),n.length?n.split(ai):v)}function _i(e,t,r=null){const n=e.getAttribute(t);return null===n?r:li.test(n)}function Pi(e,t,r=null,n){const s=e.getAttribute(t);if(null===s)return r;let i=+s;if(Number.isNaN(i)){if(n)throw new Error(En(n,s));i=r}return i}hi||new Promise((function(t,n){e(["@xmldom/xmldom"],(function(e){t(r(e))}),n)})).then((function(e){hi=new e.DOMParser})).catch((function(){}));class LoaderPlugin{constructor(e,t){Object.defineProperties(this,{type:{enumerable:!0,value:e},path:{enumerable:!0,value:t}})}static fromXml(e){const r=bi(e,"type",t.ResourceType.parse,null,"Invalid type: {0}");if(!r)throw new TypeError("The type of a LoaderPlugin is required.");const n=vi(e,"path",null);if(!n)throw new Error("The path of a LoaderPlugin is required.");return new LoaderPlugin(r,n)}toString(){return this.path}}class ServiceDependency{constructor(e,t,r,n){Object.defineProperties(this,{resource:{enumerable:!0,value:e},name:{enumerable:!0,value:t},type:{enumerable:!0,value:r},preload:{enumerable:!0,value:n}})}static fromXml(e){const r=vi(e,"resource",null);if(!r)throw new TypeError("The resource path is mandatory");const n=vi(e,"name",null),s=bi(e,"type",t.ResourceType.parse,t.ResourceType.JavaScript,"Invalid type: {0}"),i=_i(e,"preload",!1);return new ServiceDependency(r,n,s,i)}toString(){return this.resource}}class ServiceDescription{constructor(e,t,r,n,s){Object.defineProperties(this,{formats:{enumerable:!0,value:Object.freeze(e)},lang:{enumerable:!0,value:t},classPath:{enumerable:!0,value:r},apiVersion:{enumerable:!0,value:n},dependencies:{enumerable:!0,value:Object.freeze(s)}})}static fromXml(e){if(!e)throw new Error("Node cannot be null");const t=wi(e,"format",null),r=bi(e,"lang",fr.parse,null,"Service 'lang' attribute contains unknown language: {0}"),n=vi(e,"class",e.className||null),s=Pi(e,"apiversion",null,"Service 'apiversion' invalid: {0}");if(null===t||t.length<1)throw new Error("Service 'format' attribute missing or empty");if(null===n)throw new Error("Service 'class' attribute missing or empty");if(null===r)throw new Error("Service 'lang' attribute missing or empty");if(null===s)throw new Error("Service 'apiversion' attribute missing or empty");const i=mi(e,/^dependency$/i).map(ServiceDependency.fromXml,ServiceDependency);return new ServiceDescription(t,r,n,s,i)}hasType(e){return this.formats.indexOf(e)>=0}}const Ci=/\s*;\s*/g;function Si(e,t,r){return e.get(t)||r}function xi(e){let t=null;if(e){t=e.trim().split(Ci);for(let e=t.length-1;e>=0;--e)t[e].length<1&&t.splice(e,1)}return t||v}class Manifest{constructor(e,t,r){Object.defineProperties(this,{_properties:{value:Object.freeze(e)},services:{enumerable:!0,value:Object.freeze(t)},plugins:{enumerable:!0,value:Object.freeze(r)}})}static fromXml(e){const t=new Map;let r=null,n=null;return Array.prototype.forEach.call(e.childNodes,(function(e,s){if(ui(e)){const s=e.tagName.toLowerCase();"bundle-plugin"===s?n=mi(e,/^plugin$/i).map(LoaderPlugin.fromXml,LoaderPlugin):"servicebindings"===s?r=mi(e,/^service$/i).map(ServiceDescription.fromXml,ServiceDescription):(s.startsWith("bundle-")||"servicedefinition"===s)&&vi(e,"lang",Qr)===Qr&&t.set(s,fi(e).trim())}})),new Manifest(t,r||v,n||v)}static fromXmlDocument(e){const t=yi(e,/^manifest/i);if(!t)throw new Error("Root manifest element not found");return this.fromXml(t)}static fromXmlString(e){return this.fromXmlDocument(di(e))}getName(){return Si(this._properties,"bundle-name",y)}getType(){return Si(this._properties,"bundle-type",y)}getSymbolicName(){return Si(this._properties,"bundle-symbolicname",y)}getManifestVersion(){return Si(this._properties,"bundle-manifestversion",y)}getModuleFormat(){return Si(this._properties,"bundle-module-format",y)}getAmdPath(){return Si(this._properties,"bundle-amd-path",y)}getVersion(){return Si(this._properties,"bundle-version",y)}getPropertyApi(){return Si(this._properties,"bundle-propertyapi",y)}getNls(){return xi(Si(this._properties,"bundle-nls",y))}getPreload(){return xi(Si(this._properties,"bundle-preload",y))}getConfig(){return xi(Si(this._properties,"bundle-config",y))}getContext(){return Si(this._properties,"bundle-context",y)}getServiceDefinition(){return Si(this._properties,"servicedefinition",y)}getProperty(e){return Si(this._properties,e.toLowerCase(),null)}getServiceDescription(){let e=null,t=-1;for(const r of this.services)r.lang===Qr&&r.apiVersion>t&&r.apiVersion<=1&&(t=r.apiVersion,e=r);return e}}const Di=/^(?:\.\/(?!\.{1,2}\/)|\/)?(?:\.\.(?:\/|$))*(?:(?!\.{1,2})[^\/\r\n]+(?:\/|$))*$/,Ti=/^(blob:|file:\/\/|(?:(?:[^\r\n:]+:)?\/\/(?:\[[0-9a-f:]+\]|[^\r\n\/:\[\]\?\#]+)?|\[[0-9a-f:]+\]|[0-9]{1,3}(?:\.[0-9]{1,3}){3}|localhost|[^\r\n:\/\?#]+(?=:[0-9]+))(?::[0-9]+)?(?=$|[\/\?#])|)([^\r\n\?#]*)([?#][^\r\n]*|)$/i,Ii=/^\.\.?(?:$|\/)/,Oi=/^\/|\.[cCmM]?[jJ][sS]$/,Ri=new Array(16);function Ei(e,t){if(Di.test(e)&&(t||e.lastIndexOf("./",0)<0))return e;let r=0;Ri.length=0;let n,s=0;do{n=e.indexOf("/",s);const i=e.substring(s,n<0?e.length:n);i.length<1?(0===s||n<0)&&Ri.push(""):".."===i?(0===r&&1===Ri.length&&"."===Ri[0]&&Ri.pop(),--r,r<0?Ri.push(i):Ri.pop()):"."===i?0===s&&t&&Ri.push(i):(++r,Ri.push(i)),s=n<0?e.length:n+1}while(n>=0);const i=Ri.join("/");return Ri.length=0,i}function ji(e,t){let r=Ti.exec(t||""),n=r[1],s=r[2];const i=r[3];return!n&&e&&(r=Ti.exec(e),r[1]&&(n=r[1]),s.length<1?s=r[2]:s.startsWith("/")||(s=`${r[2]}/${s}`)),n+Ei(s,!n)+i}function Vi(e,t=1,r=!1){if(null===e)return null;const n=Ti.exec(e),s=n[1];let i=Ei(n[2],!s);const o=!(s||0===i.lastIndexOf("/",0)||!0!==r);let a=t;if("number"!=typeof a&&(a=1),a<0)throw new RangeError("url.parent cannot handle a negative depth");for(;--a>=0&&null!==i;){const e=i.lastIndexOf("/");let t=0;if(!s)for(let r=e+1;r<i.length;++r){if(!("."===i.charAt(r)&&t<2)){"/"!==i.charAt(r)&&(t=0);break}++t}i=t<1?e>0?i.substring(0,e):e+1<i.length?o?".":i.substring(0,e+1):null:o?(1===t?".":"../")+i:null}return null===i?i:s+i}function ki(e,t=!1){if(null===e)return!1;if("string"!=typeof e)throw new TypeError("_path must be a string");if(e.lastIndexOf("/",0)>=0||!0===t&&Ii.test(e))return!1;const r=Ti.exec(e);return!(r[1]||r[3]||Oi.test(r[2]))}function Ai(e){return!(!e||!e.normalize)}Ri.length=0;class ModuleEventMap{constructor(){Object.defineProperties(this,{error:{enumerable:!0,writable:!0,value:null},defined:{enumerable:!0,writable:!0,value:null}})}}const Li=Object.freeze({});var zi;function Ni(e,t){return(e&t)===t}function Mi(e,t,r){return r?e|t:e&~t}!function(e){e[e.ignore=1]="ignore",e[e.inited=2]="inited",e[e.fetched=4]="fetched",e[e.enabled=8]="enabled",e[e.enabling=16]="enabling",e[e.defined=32]="defined",e[e.defining=64]="defining",e[e.defineEmitted=128]="defineEmitted",e[e.defineEmitComplete=256]="defineEmitComplete",e[e.undefed=512]="undefed",e[e.usingExports=1024]="usingExports",e[e.skipMap=2048]="skipMap"}(zi||(zi={}));class Module{constructor(e,t){Object.defineProperties(this,{_context:{value:e},_flags:{writable:!0,value:0},map:{enumerable:!0,writable:!0,value:t},shim:{enumerable:!0,value:$r(e.config.shim,t.id)},events:{enumerable:!0,value:e.undefEvents.get(t.id)||new ModuleEventMap},depExports:{enumerable:!0,value:[]},depMaps:{enumerable:!0,value:[]},depMatched:{enumerable:!0,value:[]},pluginMaps:{enumerable:!0,value:{}},depCount:{enumerable:!0,writable:!0,value:0},exports:{enumerable:!0,writable:!0,value:void 0},module:{enumerable:!0,writable:!0,value:null},require:{enumerable:!0,writable:!0,value:null},error:{enumerable:!0,writable:!0,value:null},factory:{enumerable:!0,writable:!0,value:null},errback:{enumerable:!0,writable:!0,value:null}})}get ignore(){return Ni(this._flags,1)}set ignore(e){this._flags=Mi(this._flags,1,e)}get inited(){return Ni(this._flags,2)}set inited(e){this._flags=Mi(this._flags,2,e)}get fetched(){return Ni(this._flags,4)}set fetched(e){this._flags=Mi(this._flags,4,e)}get enabled(){return Ni(this._flags,8)}set enabled(e){this._flags=Mi(this._flags,8,e)}get enabling(){return Ni(this._flags,16)}set enabling(e){this._flags=Mi(this._flags,16,e)}get defined(){return Ni(this._flags,32)}set defined(e){this._flags=Mi(this._flags,32,e)}get defining(){return Ni(this._flags,64)}set defining(e){this._flags=Mi(this._flags,64,e)}get defineEmitted(){return Ni(this._flags,128)}set defineEmitted(e){this._flags=Mi(this._flags,128,e)}get defineEmitComplete(){return Ni(this._flags,256)}set defineEmitComplete(e){this._flags=Mi(this._flags,256,e)}get undefed(){return Ni(this._flags,512)}set undefed(e){this._flags=Mi(this._flags,512,e)}get usingExports(){return Ni(this._flags,1024)}set usingExports(e){this._flags=Mi(this._flags,1024,e)}get skipMap(){return Ni(this._flags,2048)}set skipMap(e){this._flags=Mi(this._flags,2048,e)}init(e,t,r,n=Li){this.inited||(t&&(this.factory=t),r?(this.on("error",r),this.errback=r):this.events.error&&(this.errback=this.emit.bind(this,"error")),e&&this.depMaps.push(...e),this.inited=!0,this.ignore=!!n.ignore,n.enabled||this.enabled?this.enable():this.check())}defineDep(e,t){this.depMatched[e]||(this.depMatched[e]=!0,--this.depCount,this.depExports[e]=t)}fetch(){if(!this.fetched){if(this.fetched=!0,this._context.startTime=Date.now(),!this.shim)return this.map.prefix?this.callPlugin():this.load();this._context.makeRequire(this.map,{enableBuildCallback:!0})(this.shim.deps||v,(()=>this.map.prefix?this.callPlugin():this.load()))}}load(){const e=this._context.urlFetched;null===this.map.url||e[this.map.url]||(e[this.map.url]=!0,this._context.load(this.map.id,this.map.url))}check(){if(this.enabled&&!this.enabling)if(this.inited){if(this.error)this.emit("error",this.error);else if(!this.defining){if(this.defining=!0,this.depCount<1&&!this.defined){let e=this.exports;if(ye(this.factory)){let t;if(this.events.error&&this.map.isDefine||this._context.scope.require.onError!==Wr)try{e=this._context.execCb(this.map.id,this.factory,this.depExports,e)}catch(e){t=e}else e=this._context.execCb(this.map.id,this.factory,this.depExports,e);if(this.map.isDefine&&void 0===e){const t=this.module;t?e=t.exports:this.usingExports&&(e=this.exports)}if(t)return this.error=Ur(this.map.isDefine?"define":"require",t.message,this.map.isDefine?[this.map.id]:null,t),this._context.onError(this.error)}else e=this.factory;this.exports=e,this.map.isDefine&&!this.ignore&&(this._context.defined[this.map.id]=e,this._context.scope.require.onResourceLoad&&this._context.scope.require.onResourceLoad(this._context,this.map,this.depMaps.map((function(e){return e.normalizedMap||e})))),this._context.cleanRegistry(this.map.id),this.defined=!0}this.defining=!1,this.defined&&!this.defineEmitted&&(this.defineEmitted=!0,this.emit("defined",this.exports),this.defineEmitComplete=!0)}}else this._context.isQueued(this.map.id)||this.fetch()}_handlePluginLoad(e){this.init(v,(function(){return e}),null,{enabled:!0})}_handlePluginError(e){const t=this.map.id,r=this._context;this.inited=!0,this.error=e||new Error("AMD plugin error"),this.error.requireModules?this.error.requireModules[0]=t:Object.defineProperties(this.error,{requireModules:{enumerable:!0,value:[t]}}),qr(r.registry,(function(e){0===e.map.id.lastIndexOf(`${t}_unnormalized`,0)&&r.cleanRegistry(e.map.id)})),r.onError(this.error)}callPlugin(){const e=this._context.makeModuleMap(this.map.prefix),t=this._context,r=this.map.id;this.depMaps.push(e),t.on(e,"defined",(e=>{var n;let s=this.map.name;const i=null===(n=this.map.parentMap)||void 0===n?void 0:n.name,o=t.makeRequire(this.map.parentMap,{enableBuildCallback:!0}),a=t.bundlesMap.get(r);if(this.map.unnormalized){Ai(e)&&(s=e.normalize(s,(function(e){return t.normalize(e,i,!0)}))||"");const r=t.makeModuleMap(`${this.map.prefix}!${s}`,this.map.parentMap,!0);t.on(r,"defined",(e=>{this.map.normalizedMap=r,this.init(v,(function(){return e}),null,{enabled:!0,ignore:!0})}));const n=$r(t.registry,r.id);return void(n&&(this.depMaps.push(r),this.events.error&&n.on("error",this.emit.bind(this,"error")),n.enable()))}if(a)return this.map.url=t.nameToUrl(a),void this.load();const l=Object.defineProperties(this._handlePluginLoad.bind(this),{error:{enumerable:!0,value:this._handlePluginError.bind(this)},onUndef:{enumerable:!0,value:this._context.registerPluginUndef.bind(this._context,s)},fromText:{enumerable:!0,value:(e,n)=>{const s=this.map.name,i=t.makeModuleMap(s);n&&(e=n),t.getModule(i),Fr(t.config.config,r)&&(t.config.config[s]=t.config.config[r]);try{this._context.scope.require.exec(e)}catch(e){return t.onError(Ur("fromtexteval",`fromText eval for ${r} failed: ${e}`,[r],e))}this.depMaps.push(i),t.completeLoad(s),o([s],l)}}});e.load(this.map.name,o,l,this._context.config)})),t.enable(e),this.pluginMaps[e.id]=e}enable(){this._context.enabledRegistry[this.map.id]=this,this.enabled=!0,this.enabling=!0;const e=this._context.handlers,t=this._context.registry;for(let r=0;r<this.depMaps.length;++r){let n=this.depMaps[r];if("string"==typeof n){if(n=this._context.makeModuleMap(n,this.map.isDefine?this.map:this.map.parentMap,!1,!this.skipMap),this.depMaps[r]=n,Fr(e,n.id)){this.depExports[r]=e[n.id](this);continue}++this.depCount,this._context.on(n,"defined",(e=>{this.undefed||(this.defineDep(r,e),this.check())})),this.errback?this._context.on(n,"error",this.errback):this.events.error&&this._context.on(n,"error",this.emit.bind(this,"error"))}const s=$r(t,n.id);Fr(e,n.id)||!s||s.enabled||this._context.enable(n)}qr(this.pluginMaps,(function(e){const r=$r(t,e.id);r&&!r.enabled&&r.enable()})),this.enabling=!1,this.check()}on(e,t){let r=this.events[e];r||(r=this.events[e]=[]),r.push(t)}emit(e,t){const r=this.events[e];if(r)for(const e of r)e(t);"error"===e&&(this.events.error=null)}}class ModuleMap{constructor(e,t,r,n,s,i,o,a){Object.defineProperties(this,{prefix:{enumerable:!0,value:e},name:{enumerable:!0,value:t},parentMap:{enumerable:!0,value:r},unnormalized:{enumerable:!0,value:n},url:{enumerable:!0,writable:!0,value:s},originalName:{enumerable:!0,value:i},isDefine:{enumerable:!0,value:o},id:{enumerable:!0,value:a},normalizedMap:{enumerable:!0,writable:!0,value:null}})}}const Fi="data-ref-count",$i=/\.css(?:$|:)/i;function qi(e,t){let r=Number.parseInt(e.getAttribute(Fi)||"0",10);return r+=t?1:-1,e.setAttribute(Fi,r.toString(10)),r}function Bi(e){e&&qi(e,!1)<1&&Kr(e)}class CssPlugin{constructor(e){Object.defineProperties(this,{_document:{value:e}})}normalize(e,t){let r=e;return $i.test(r)||(e.indexOf(":")<0?r+=".css":r=r.replace(":",".css:")),t(r)}load(e,t,r,n){const s=t.toUrl(e),[i,o]=function(e,t){let r,n=function(e,t){return e.querySelector(`link[type="text/css"][href="${t}"]`)}(document,t),s=new Promise((e=>r=e));return n?s=Promise.resolve():(n=document.createElement("link"),n.onload=()=>r(),n.setAttribute("rel","stylesheet"),n.setAttribute("type","text/css"),n.setAttribute("href",t),document.head.appendChild(n)),qi(n,!0),[n,s]}(this._doc(),s);r.onUndef&&r.onUndef(Bi.bind(null,i)),o.then((()=>r(s)))}_doc(){if(!this._document)throw new Error("There is no document, cannot load css");return this._document}}const Hi=/^((\w+)\:)?\/\/([^\/\\]+)/,Gi=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,Ui=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im;const Wi=/[\b\t\n\f\r'\\\u2028\u2029]/g;function Ki(e){switch(e.charCodeAt(0)){case 8:return"\\b";case 9:return"\\t";case 10:return"\\n";case 12:return"\\f";case 13:return"\\r";case 39:return"\\'";case 92:return"\\\\";case 8232:return"\\u2028";case 8233:return"\\u2029"}}function Xi(e){return e.replace(Wi,Ki)}class TextPlugin{constructor(e){Object.defineProperties(this,{_hasLocation:{value:!!e},_defaultProtocol:{value:e&&e.protocol&&e.protocol.replace(":","")},_defaultHostname:{value:e&&e.hostname},_defaultPort:{value:e&&(e.port||void 0)},xdRegExp:{enumerable:!0,writable:!0,value:Hi},jsEscape:{enumerable:!0,value:Xi}})}useXhr(e,t,r,n){const s=this.xdRegExp.exec(e);if(!s)return!0;const i=s[2];let o,a=s[3];const l=a.indexOf(":");return l>=0&&(o=a.substring(l+1),a=a.substring(0,l)),!(i&&i!==t||a&&a.toLowerCase()!==(null==r?void 0:r.toLowerCase())||(o||a)&&(u=o,c=n,u!==c));var u,c}load(t,n,s,i){var o;let a=t,l=!1;const u=a.indexOf("!");u>=0&&(l="strip"===a.substring(u+1),a=a.substring(0,u));const c=n.toUrl(a);if(0===c.lastIndexOf("empty:",0))return void s(void 0);let p=!0;if(this._hasLocation){const e=null===(o=i.config.text)||void 0===o?void 0:o.useXhr;p=e?e(c,this._defaultProtocol,this._defaultHostname,this._defaultPort):this.useXhr(c,this._defaultProtocol,this._defaultHostname,this._defaultPort)}p?function(t){if(Ir||Or)return Sr(t,Er).then((function(e){if(e.ok)return e.response||y;throw new Error(e.statusText)}));if(Rr)return new Promise((function(t,n){e(["fs"],(function(e){t(r(e))}),n)})).then((function(e){return e.readFileSync(t,"utf8").replace(/^\uFEFF/,"")}));throw new Error("VIPR cannot load text in this context")}(c).then((e=>this.finishLoad(t,l,e,s)),s.error):n([a],(e=>{this.finishLoad(a,l,e,s)}))}finishLoad(e,t,r,n){n(t?this.strip(r):r)}strip(e){let t=e;if(t){t=t.replace(Gi,"");const e=Ui.exec(t);e&&(t=e[1])}else t="";return t}}const Ji=/^(.*\/nls(?:\/|$))([^\/]*)\/?([^\/]*)/;function Qi(e,t,r,n,s,i){t[e]&&(r.push(e),!0!==t[e]&&1!==t[e]||n.push(`${s}${e}/${i}`))}class I18nPlugin{constructor(){Object.defineProperties(this,{_mainConfig:{writable:!0,value:null}})}load(e,t,r,n){this._mainConfig||(this._mainConfig=n.config.i18n||{}),n.locale&&(this._mainConfig.locale=n.locale);const s=Ji.exec(e);if(!s)return void r.error(new Error(`Invalid i18n path: ${e}, must contain /nls/`));let i=e;const o=s[1];let a=s[2],l=s[3];l?i=o+l:(l=a,this._mainConfig.locale||(this._mainConfig.locale=(Jr||"root").toLowerCase()),a=this._mainConfig.locale),t([i],(function(e){const n={},s=[],i=[];Qi("root",e,s,i,o,l);let u=0;do{u=a.indexOf("-",u+1);Qi(u<0?a:a.substring(0,u),e,s,i,o,l)}while(u>=0);t(i,(function(...t){for(let r=s.length-1;r>=0;--r){const a=s[r];let u=e[a];if(!0===u||1===u){const e=`${o}${a}/${l}`;u=t[i.indexOf(e)]}u&&Br(n,u,!1,!0)}r(n)}))}))}}const Yi=Object.freeze({}),Zi=Object.freeze({skipMap:!0});var eo;!function(e){e[e.css=1]="css",e[e.i18n=2]="i18n",e[e.text=4]="text"}(eo||(eo={}));const to=Object.freeze(["css","i18n","text"]);function ro(e,t){return(e&t)===t}class Context{constructor(e,t,r=!1){const n={exports:this._exportsHandler.bind(this),module:this._moduleHandler.bind(this),require:this._requireHandler.bind(this)};Object.defineProperties(this,{scope:{enumerable:!0,value:e},config:{enumerable:!0,value:Object.defineProperties({},{waitSeconds:{enumerable:!0,writable:!0,value:7},baseUrl:{enumerable:!0,writable:!0,value:"./"},paths:{enumerable:!0,value:{}},bundles:{enumerable:!0,value:{}},pkgs:{enumerable:!0,value:{}},shim:{enumerable:!0,value:{}},config:{enumerable:!0,value:{}}})},contextName:{enumerable:!0,value:t},require:{enumerable:!0,value:this.makeRequire(null)},nextTick:{enumerable:!0,value:e.require.nextTick},Module:{enumerable:!0,value:Module},registry:{enumerable:!0,value:{}},defined:{enumerable:!0,value:{}},urlFetched:{enumerable:!0,value:{}},defQueue:{enumerable:!0,value:[]},undefEvents:{enumerable:!0,value:new Map},_undefHandlers:{value:new Map},startTime:{enumerable:!0,writable:!0,value:Date.now()},onScriptLoad:{enumerable:!0,value:this._handleScriptLoad.bind(this)},onScriptError:{enumerable:!0,value:this._handleScriptError.bind(this)},enabledRegistry:{enumerable:!0,value:{}},bundlesMap:{enumerable:!0,value:new Map},handlers:{enumerable:!0,value:n},_requireCounter:{writable:!0,value:0},_unnormalizedCounter:{writable:!0,value:0},_inCheckLoaded:{writable:!0,value:!1},_checkLoadedTimeoutId:{writable:!0,value:null},_predefPlugins:{writable:!0,value:0}}),r&&(this._predefPlugins=eo.css|eo.i18n|eo.text,Context.define(this,"css",v,this._createCssPlugin.bind(this)),Context.define(this,"i18n",v,this._createI18nPlugin.bind(this)),Context.define(this,"text",v,this._createTextPlugin.bind(this)))}static define(e,t,r,n){const s=new Array(3);s[0]=t,s[1]=r,s[2]=n,e.defQueue.push(s)}static undefAll(e){const t=Object.keys(e.defined);for(let n=t.length-1;n>=0;--n){const s=t[n];(r=s).length<5&&to.includes(r)&&ro(e._predefPlugins,eo[s])||e.undef(s)}var r}get defQueueMap(){const e={};for(const t of this.defQueue)t[0]&&(e[t[0]]=!0);return e}configure(e){const t=this.config;var r,n,s;if(e.baseUrl&&!/\/$/.test(e.baseUrl)&&(e.baseUrl+="/"),"string"==typeof e.urlArgs&&(e.urlArgs=(r=e.urlArgs,function(e,t){return(t.indexOf("?")<0?"?":"&")+r})),qr(e,(function(e,r){!function(e){return/^(?:paths|bundles|config|map)$/.test(e)}(r)?"shim"!==r&&(t[r]=e):(t[r]||Object.defineProperty(t,r,{enumerable:!0,value:{}}),Br(t[r],e,!0,!0))})),this._predefPlugins&&e.paths)for(const t of to)Fr(e.paths,t)&&ro(this._predefPlugins,eo[t])&&(Fr(this.defined,t)||this.undef(t),this._predefPlugins=(n=this._predefPlugins,s=eo[t],!1?n|s:n&~s));if(e.bundles){const t=this.bundlesMap;qr(e.bundles,(function(e,r){if(Array.isArray(e))for(const n of e)n!==r&&t.set(n,r)}))}if(e.shim&&qr(e.shim,((e,r)=>{const n=Array.isArray(e)?{deps:e}:e;!n.exports&&!n.init||n.exportsFn||(n.exportsFn=this.makeShimExports(n)),t.shim[r]=n})),e.packages)for(const r of e.packages){let e,n="main";"string"==typeof r?e=r:(e=r.name,r.location&&(t.paths[e]=r.location),n=r.main||n),t.pkgs[e]=`${e}/${n}`.replace(zr,"").replace(Lr,"")}qr(this.registry,((e,t)=>{e.inited||e.map.unnormalized||(e.map=this.makeModuleMap(t,null,!0))}))}makeShimExports(e){return(...t)=>{let r;return e.init&&(r=e.init.apply(this.scope.global,t)),r||e.exports&&this.scope.getGlobal(e.exports)}}makeRequire(e,t=Yi){const r=this;function n(s,i,o){if(t.enableBuildCallback&&i&&ye(i)&&(i.__requireJsBuild=!0),"string"==typeof s){if(ye(i))return r.onError(Ur("requireargs","Invalid require call"),o);if(e&&Fr(r.handlers,s))return r.handlers[s](r.registry[e.id]);if(r.scope.require.get)return r.scope.require.get(r,s,e,n);const t=r.makeModuleMap(s,e,!1,!0).id;if(!Fr(r.defined,t)){let n=`Module name "${t}" has not been loaded yet for context: ${r.contextName}`;return e||(n+=". Use require([])"),r.onError(Ur("notloaded",n))}return r.defined[t]}return r._intakeDefines(),r.nextTick((function(){r._intakeDefines();const n=r.getModule(r.makeModuleMap(null,e));n.skipMap=!!t.skipMap,n.init(s,i,o,{enabled:!0}),r._checkLoaded()})),n}return Object.defineProperties(n,{isBrowser:{enumerable:!0,value:Ir},toUrl:{enumerable:!0,value:function(t){return r.toUrl(t,e)}},defined:{enumerable:!0,value:function(t){return Fr(r.defined,r.makeModuleMap(t,e,!1,!0).id)}},specified:{enumerable:!0,value:function(t){const n=r.makeModuleMap(t,e,!1,!0).id;return Fr(r.defined,n)||Fr(r.registry,n)}}}),e||Object.defineProperty(n,"undef",{enumerable:!0,value:this.undef.bind(this)}),n}toUrl(e,t){const r=Math.max(/^\.\.?(?:\/|$)/.test(e)?2:0,e.lastIndexOf("/")+1),n=e.lastIndexOf(".");let s,i=e;return n>=r&&(s=i.substring(n,i.length),i=i.substring(0,n)),this.nameToUrl(this.normalize(i,t&&t.id,!0),s,!0)}undef(e){this._takeGlobalQueue();const t=this.makeModuleMap(e,null,!0),r=$r(this.registry,e);if(r&&(r.undefed=!0),this._removeScript(e),Fr(this.defined,e)){const t=this._undefHandlers.get(e);t&&t(),delete this.defined[e]}t.url&&delete this.urlFetched[t.url],this.undefEvents.delete(e);const n=this.defQueue;for(let t=n.length-1;t>=0;--t)n[t][0]===e&&n.splice(t,1);r&&((r.events.defined||r.events.error)&&this.undefEvents.set(e,r.events),this.cleanRegistry(e))}enable(e){const t=$r(this.registry,e.id);t&&t.enable()}completeLoad(e){this._takeGlobalQueue();let t=!1;for(;this.defQueue.length;){const r=this.defQueue.shift();if(null===r[0]){if(r[0]=e,t)break;t=!0}else r[0]===e&&(t=!0);this._callGetModule(r)}const r=$r(this.registry,e);if(!t&&!Fr(this.defined,e)&&r&&!r.inited){const t=$r(this.config.shim,e)||{},r=t.exports;if(!(!this.config.enforceDefine||r&&this.scope.getGlobal(r))){if(this._hasPathFallback(e))return;return this.onError(Ur("nodefine",`No define call for ${e}`,[e]))}this._callGetModule([e,t.deps||v,t.exportsFn])}this._checkLoaded()}nameToUrl(e,t,r=!1){let n,s=$r(this.config.pkgs,e)||e;if(s=this.bundlesMap.get(s)||s,Mr.test(s))n=s+(t||"");else{n=s;const e=this.config.paths;for(let t=s.length;t>0;t=s.lastIndexOf("/",t-1)){let r=$r(e,s.substring(0,t));if(r){Array.isArray(r)&&(r=r[0]),n=r+s.substring(t);break}}t?n+=t:r||/^(?:blob|data)\:|\?/.test(n)||(n+=".js"),n.lastIndexOf("/",0)<0&&!/^[\w\+\.\-]+:/.test(n)&&(n=this.config.baseUrl+n)}return this.config.urlArgs&&!/^blob\:/.test(n)&&(n+=this.config.urlArgs(s,n)),n}load(e,t){this.scope.require.load(this,e,t)}execCb(e,t,r,n){return t.apply(n,r)}makeModuleMap(e,t,r=!1,n=!1){let s,i,o=!0,a=null;const l=t&&t.name;let u,c=null;e?[i,s]=Gr(e):(o=!1,s="_@r"+ ++this._requireCounter,i=null),i?(i=this.normalize(i,l,n),a=$r(this.defined,i),u=r?s:Ai(a)?a.normalize(s,(e=>this.normalize(e,l,n))):s.indexOf("!")<0?this.normalize(s,l,n):s):Nr.test(s)?(u=s,c=s):(u=this.normalize(s,l,n),[i,u]=Gr(u),r=!0,c=this.nameToUrl(u));const p=!i||a||r?"":"_unnormalized"+ ++this._unnormalizedCounter;return new ModuleMap(i,u,t||null,!!p,c,e,o,(i?`${i}!${u}`:u)+p)}cleanRegistry(e){delete this.registry[e],delete this.enabledRegistry[e]}on(e,t,r){let n=$r(this.registry,e.id);!Fr(this.defined,e.id)||n&&!n.defineEmitComplete?(n=this.getModule(e),n.error&&"error"===t?r(n.error):n.on(t,r)):"defined"===t&&r(this.defined[e.id])}onError(e,t){if(t)t(e);else{const t=e.requireModules;let r=!1;if(t)for(const n of t){const t=$r(this.registry,n);t&&(t.error=e,t.events.error&&(r=!0,t.emit("error",e)))}r||this.scope.require.onError(e)}}normalize(e,t,r=!1){let n=e;const s=this.config.map,i=s&&s["*"];if(this.config.nodeIdCompat&&Lr.test(n)&&(n=n.replace(Lr,"")),n=t&&0===n.lastIndexOf(".",0)?ji(Vi(t),n):Ei(n,!1),r&&s&&(t||i)){let e=-1,r=null,o=-1,a=null;e:for(let l=n.length;l>0;l=n.lastIndexOf("/",l-1)){const u=n.substring(0,l);if(t)for(let n=t.length;n>0;n=t.lastIndexOf("/",n-1)){const i=$r(s,t.substring(0,n));if(r=i&&$r(i,u),r){e=l;break e}}!a&&i&&Fr(i,u)&&(a=i[u],o=l)}!r&&a&&(r=a,e=o),r&&(n=r+n.substring(e,n.length))}return Fr(this.config.pkgs,n)&&(n=this.config.pkgs[n]),n}getModule(e){let t=$r(this.registry,e.id);return t||(t=this.registry[e.id]=new Module(this,e)),t}isQueued(e){for(const t of this.defQueue)if(t[0]===e)return!0;return!1}registerPluginUndef(e,t){this._undefHandlers.set(e,t)}_scripts(e){return this.scope.scripts(this.contextName,e)}_removeScript(e){if(Ir){const t=this._scripts(e);for(let e=t.length-1;e>=0;--e)Kr(t[e])}}_checkLoaded(){if(this._inCheckLoaded)return;const e=1e3*this.config.waitSeconds,t=e>0&&this.startTime+e<Date.now(),r=[],n=[];let s=!1,i=!1,o=!0;if(this._inCheckLoaded=!0,qr(this.enabledRegistry,(e=>{if(!e.enabled)return;const a=e.map;a.isDefine||n.push(e),e.error||(!e.inited&&t?this._hasPathFallback(a.id)?(s=!0,i=!0):(r.push(a.id),this._removeScript(a.id)):!e.inited&&e.fetched&&a.isDefine&&(i=!0,a.prefix||(o=!1)))})),t&&r.length){const e=Ur("timeout",`Load timeout for modules: ${r}`,r);return Object.defineProperty(e,"contextName",{enumerable:!0,value:this.contextName}),this.onError(e)}if(o)for(const e of n)this._breakCycle(e,new Set,new Set);t&&!s||!i||(Ir||Or)&&null===this._checkLoadedTimeoutId&&(this._checkLoadedTimeoutId=setTimeout((()=>{this._checkLoadedTimeoutId=null,this._checkLoaded()}),50)),this._inCheckLoaded=!1}_breakCycle(e,t,r){const n=e.map.id;if(e.error)e.emit("error",e.error);else{t.add(n);const s=e.depMaps.length;for(let n=0;n<s;++n){const s=e.depMaps[n].id,i=$r(this.registry,s);!i||e.depMatched[n]||r.has(s)||(t.has(s)?(e.defineDep(n,this.defined[s]),e.check()):this._breakCycle(i,t,r))}r.add(n)}}_hasPathFallback(e){const t=$r(this.config.paths,e);return!!(t&&Array.isArray(t)&&t.length>1)&&(t.shift(),this.scope.require.undef(e),this.makeRequire(null,Zi)([e]),!0)}_intakeDefines(){for(this._takeGlobalQueue();this.defQueue.length;){const e=this.defQueue.shift();if(null===e[0])return this.onError(Ur("mismatch",`Mismatched anonymous define() module: ${e[e.length-1]}`));this._callGetModule(e)}}_takeGlobalQueue(){const e=this.scope.globalDefQueue;e.length>0&&(this.defQueue.push(...e),e.length=0)}_callGetModule(e){null===e[0]||Fr(this.defined,e[0])||this.getModule(this.makeModuleMap(e[0],null,!0)).init(e[1],e[2])}_getScriptData(e){const t=e.currentTarget||e.srcElement;return t.removeEventListener("load",this.onScriptLoad,!1),t.removeEventListener("error",this.onScriptError,!1),t.getAttribute("data-requiremodule")}_handleScriptLoad(e){this.completeLoad(this._getScriptData(e))}_handleScriptError(e){const t=this._getScriptData(e);if(!this._hasPathFallback(t)){const r=[];qr(this.registry,(function(e,n){if(0!==n.lastIndexOf("_@r",0))for(const s of e.depMaps)if(s.id===t){r.push(n);break}}));let n=`Script error for "${t}"`;return r.length&&(n+=`, needed by: ${r.join(", ")}`),this.onError(Ur("scripterror",n,[t],e))}}_exportsHandler(e){if(e.usingExports=!0,e.map.isDefine)return e.exports||(e.exports={}),this.defined[e.map.id]=e.exports}_moduleHandler(e){if(!e.module){const t=this.config;e.exports||(e.exports={}),e.module={id:e.map.id,uri:e.map.url,config:function(){return $r(t.config,e.map.id)||{}},exports:e.exports}}return e.module}_requireHandler(e){return e.require||(e.require=this.makeRequire(e.map)),e.require}_createCssPlugin(){return new CssPlugin(xr.document)}_createI18nPlugin(){return new I18nPlugin}_createTextPlugin(){return new TextPlugin(xr.location)}}const no=new WeakMap;const so=Object.freeze(["Array","BigInt","Boolean","Date","Function","Number","Object","Promise","RegExp","String","Symbol","Intl","JSON","Math","Map","Set","WeakMap","WeakSet","ArrayBuffer","DataView","Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Uint32Array","Int32Array","Float32Array","Float64Array","BigInt64Array","BigUint64Array"]),io=Object.freeze(["elementFromPoint","elementsFromPoint","querySelector","querySelectorAll","getElementById","getElementsByClassName","getElementsByTagNameNS"]),oo=Object.freeze(["addEventListener","removeEventListener"]),ao=/^(?:(?:Weak)?(?:Map|Set)|Intl|Promise|Function)$/,lo=/^(?:Array|Date|RegExp|String)$/,uo=/^(?:prototype|length|caller|arguments)$/,co=/^(?:constructor)$/;function po(e,t,r){for(const n of Object.getOwnPropertyNames(e))n in t||r&&r.test(n)||Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(e,n));for(const r of Object.getOwnPropertySymbols(e))r in t||Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r))}function ho(e,t,r){Object.defineProperty(t,r,{enumerable:!0,value:(...t)=>e[r](...t)})}function fo(e,t,r){const n=e[r];if(n)if(!(r in t)||ao.test(r))Object.defineProperty(t,r,Object.getOwnPropertyDescriptor(e,r));else{const e=t[r];let s=!1;if(lo.test(r))try{Object.setPrototypeOf(e,n),Object.setPrototypeOf(e.prototype,n.prototype),s=!0}catch(e){}s||(n.prototype&&po(n.prototype,e.prototype,co),po(n,e,ye(n)?uo:null))}}const go="data-vipr-ref";let mo=0;function yo(e,t){const r=t.MutationObserver;if(void 0===r)return;function n(t,r){if(ui(t)&&(/^LINK$/i.test(t.tagName)||function(e){return/^STYLE$/i.test(e.tagName)}(t)))if(r)!function(e){e.getAttribute(go)||e.setAttribute(go,"ref_"+ ++mo)}(t),e.head.appendChild(t.cloneNode(!0));else{const r=function(e){return e.getAttribute(go)}(t),n=r?e.head.querySelector(`${t.tagName}[${go}="${r}"]`):null;n&&e.head.removeChild(n)}}new r((function(e){for(const t of e){if("childList"!==t.type)continue;let e=t.addedNodes.length;for(let r=0;r<e;++r)n(t.addedNodes[r],!0);e=t.removedNodes.length;for(let r=0;r<e;++r)n(t.removedNodes[r],!1)}})).observe(t.document.head,{childList:!0})}function vo(e){return this(e)}class Scope{constructor(e,t){const r=this._define.bind(this),n=this._require.bind(this);Object.defineProperties(this,{global:{enumerable:!0,value:e},document:{enumerable:!0,value:e.document},globalDefQueue:{enumerable:!0,value:[]},version:{enumerable:!0,value:"2.3.6"},jsExtRegExp:{enumerable:!0,value:Mr},isBrowser:{enumerable:!0,value:Ir},define:{enumerable:!0,value:r},require:{enumerable:!0,value:n},contexts:{enumerable:!0,value:{}},_predefPlugins:{value:!!t}}),Object.defineProperties(r,{amd:{enumerable:!0,value:Vr}}),Object.defineProperties(n,{config:{enumerable:!0,value:vo.bind(n)},nextTick:{enumerable:!0,writable:!0,value:Dr},load:{enumerable:!0,writable:!0,value:this.load.bind(this)},createNode:{enumerable:!0,writable:!0,value:this.createNode.bind(this)},onError:{enumerable:!0,writable:!0,value:Wr},exec:{enumerable:!0,writable:!0,value:function(t){return e.eval(t)}},s:{enumerable:!0,value:{contexts:this.contexts,head:this.document&&this.document.head,newContext:this.newContext.bind(this)}}}),this.contexts[jr]=this.newContext(jr);const s=this.contexts[jr].require;Object.defineProperties(n,{toUrl:{enumerable:!0,value:s.toUrl},undef:{enumerable:!0,value:s.undef},defined:{enumerable:!0,value:s.defined},specified:{enumerable:!0,value:s.specified}}),no.set(e,this)}static getFor(e=xr,t=!1){return no.get(e)||new Scope(e,t)}static sandbox(t,n=!0){return pn(this,void 0,void 0,(function*(){let s;if(xr.document)s=yield function(e,t){const r=t.document;if(!r)throw new Error("Cannot create a SandboxFrame without a parent that has a document");const n=r.createElement("iframe");n.src="about:blank",n.style.position="fixed",n.style.left="0px",n.style.top="0px",n.style.width="1px",n.style.height="1px",n.style.borderWidth="0",n.style.pointerEvents="none",n.style.userSelect="none",n.setAttribute("aria-hidden","true"),e&&n.setAttribute("data-sandbox",e);const s=new Promise((e=>{n.onload=()=>{const s=n.contentWindow;!function(e,t){const r=e.createElement("base");r.href=t,e.head.appendChild(r)}(s.document,r.location.href);for(const e of so)fo(t,s,e);for(const e of[...io,...oo])ho(t.document,s.document,e);for(const e of oo)ho(t,s,e);for(const e of oo)ho(t.document.body,s.document.body,e);yo(r,s),e(s)}}));return r.body.appendChild(n),s}(t,xr);else{if(!Rr)throw new Error("Unable to use VIPR in this context");s=new((yield new Promise((function(t,n){e(["jsdom"],(function(e){t(r(e))}),n)}))).JSDOM)("",{url:`file:///${process.cwd()}/`,contentType:"text/html",runScripts:"dangerously",resources:"usable"}).window}return new Scope(s,n).attach()}))}attach(){const e=this.global;return e.require||e.define||Object.defineProperties(this.global,{define:{enumerable:!0,value:this.define},require:{enumerable:!0,value:this.require},requirejs:{enumerable:!0,value:this.require},amdDefine:{enumerable:!0,value:this.define},amdRequire:{enumerable:!0,value:this.require}}),this}scripts(e,t){if(!this.document)throw new Error("Cannot invoke scripts in a scope where isBrowser === false");let r="script";return e&&(r+=`[data-requirecontext="${e}"]`),t&&(r+=`[data-requiremodule="${t}"]`),this.document.querySelectorAll(r)}createNode(e,t,r){if(!this.document)throw new Error("Cannot invoke scripts in a scope where isBrowser === false");const n=e.xhtml?this.document.createElementNS("http://www.w3.org/1999/xhtml","html:script"):this.document.createElement("script");return n.type=e.scriptType||"text/javascript",n.defer=!0,n}load(t,n,s){const i=t&&t.config;if(this.document){const e=this.require.createNode(i,n,s);return e.setAttribute("data-requirecontext",t.contextName),e.setAttribute("data-requiremodule",n),e.addEventListener("load",t.onScriptLoad,!1),e.addEventListener("error",t.onScriptError,!1),e.src=s,i.onNodeCreated&&i.onNodeCreated(e,i,n,s),this.document.head.appendChild(e),e}if(Or)try{setTimeout((function(){}),0),importScripts(s),t.completeLoad(n)}catch(e){t.onError(Ur("importscripts",`importScripts failed for ${n} at ${s}`,[n],e))}else Rr&&(o=s,new Promise((function(t,n){e([o],(function(e){t(r(e))}),n)}))).then((function(){t.completeLoad(n)}),(function(e){t.onError(Ur("importscripts",`import failed for ${n} at ${s}`,[n],e))}));var o}getGlobal(e){let t;if(e){let r=0;t=this.global;do{let n=e.indexOf(".",r);n<0&&(n=e.length),t=t[e.substring(r,n)],r=n+1}while(r<e.length&&t)}return t}undef(e){this.contexts[jr].undef(e)}newContext(e,t=this._predefPlugins){return new Context(this,e,t)}_define(e,t,r){const n=new Array(3);if(n[0]=e,n[1]=t,n[2]=r,"string"!=typeof n[0]&&(n.pop(),n.unshift(null)),Array.isArray(n[1])||(n[2]=n[1],n[1]=null),!n[1]&&ye(n[2])){const e=n[2],t=[];e.length&&(e.toString().replace(kr,Hr).replace(Ar,(function(e,r){return t.push(r),e})),1!==e.length&&t.unshift("exports","module"),t.unshift("require")),n[1]=t}this.globalDefQueue.push(n)}_require(e,t,r,n){let s,i=e,o=t,a=r;Array.isArray(i)||"string"==typeof i||(s=i,Array.isArray(o)?(i=o,o=a,a=n):i=v);const l=s&&s.context?s.context:jr;let u=$r(this.contexts,l);return u||(u=this.contexts[l]=this.newContext(l)),s&&u.configure(s),u.require(i,o,a)}}const bo=function(){const e=/^(?:IRenderingServiceData|IRS(?:(?:Sub)?Captioned|(?:Cat|Cont)?DataItem|ContDomain|Item(?:Class(?:Set)?)?|Data(?:Node|Point|Set)|Datum|Decorated|Formatter|Slot|Tuple|Value|(?:Geo|Reference|Temporal)(?:Attributes|DataItem|Tuple))|RS(?:FormatKind|(?:DataItem|DataSet|Slot|Value)Type)|IRSStructuredDataSet)$/;function t(){return this}const r=new Map,n="com/ibm/vipr/rs/v1/",s=`${n}data/`;for(const i of Object.keys(Dn)){const o=e.test(i)?s:n;r.set(o+i,t.bind(Dn[i]))}return r}();const wo="text!{0}";function _o(e){return"string"==typeof e?JSON.parse(e):e}function Po(e){return"string"==typeof e?di(e):e}const Co=/\.(\w+)$/;function So(){}function xo(e,t){return new Promise((function(r,n){return e([t],r,n)}))}function Do(){const e=new Map;return e.set(t.ResourceType.Css,"css!{0}"),e.set(t.ResourceType.Html,wo),e.set(t.ResourceType.JavaScript,null),e.set(t.ResourceType.Json,wo),e.set(t.ResourceType.Nls,"i18n!{0}"),e.set(t.ResourceType.Svg,wo),e.set(t.ResourceType.Text,wo),e.set(t.ResourceType.Xml,wo),e.set(t.ResourceType.Raw,null),e}class ResourceLoaderAmd{constructor(e,t,r,n,s,i){Object.defineProperties(this,{location:{enumerable:!0,value:e},_manifest:{value:t},_scope:{value:r},_rootAmd:{value:s},_rootUrl:{value:i},_contextName:{value:n},_contexts:{value:new Map},_resolvers:{value:Do()}}),t.plugins.forEach(this.configurePlugin,this)}configurePlugin(e){this._resolvers.set(e.type,e.path)}load(e,r,n){const s=ji(this._rootAmd,r);let i=null;if(n){if(i=t.ResourceType.parse(n),!i)return Promise.reject(new Error(`Unknown resource type: ${n}`))}else{const e=Co.exec(s);if(e&&(i=t.ResourceType.parse(e[1])),!i)return Promise.reject(new Error("Type cannot be inferred"))}if(!this._resolvers.has(i))return Promise.reject(new Error(`No loader for type: ${n||i}`));const o=this._resolvers.get(i);return this._resolveContext(e).then((function(e){let r=xo(e.require,o?En(o,s):s);return i===t.ResourceType.Json?r=r.then(_o):i===t.ResourceType.Xml&&(r=r.then(Po)),r}))}unload(){this._contexts.size>0&&(this._contexts.forEach((function(e){e.then((function(e){Context.undefAll(e)}))}),this),this._contexts.clear())}_resolveContext(e){let t=this._contexts.get(e);return t||this._contexts.set(e,t=this._createContext(e)),t}_createContext(e){return pn(this,void 0,void 0,(function*(){const t=`${this._contextName}[${e}]`;let r,n=this._scope.contexts[t];var s;if(n||(n=this._scope.contexts[t]=this._scope.newContext(t),n.configure(function(e){const t={waitSeconds:30};if(e&&(t.locale=e),Xr){const e=Xr.config;Fr(e,"scriptType")&&(t.scriptType=e.scriptType),Fr(e,"urlArgs")&&(t.urlArgs=e.urlArgs),Fr(e,"waitSeconds")&&(t.waitSeconds=e.waitSeconds),Fr(e,"xhtml")&&(t.xhtml=e.xhtml),e.config&&e.config.text&&(t.config||(t.config={}),t.config.text=Object.assign(t.config.text||{},e.config.text))}return t}(e)),s=n,bo.forEach((function(e,t){Context.define(s,t,v,e)}))),this._rootAmd&&!Fr(n.config.paths,this._rootAmd)){const e={};e[this._rootAmd]=this._rootUrl,n.configure({paths:e})}if(r=this._manifest.getConfig(),r.length>0)for(const e of r){const t=ki(e,!1)?ji(this._rootAmd,e):null,r=ji(this._rootUrl,e),s=Vi(r);if(null!==t&&n.require.defined(t)||n.require.defined(r))continue;if(null!==t){const e=Vi(t),i={};e&&s?i[e]=s:i[t]=r,n.configure({paths:i})}let i=yield xo(n.require,t||r);if("object"==typeof i&&null!==i){if(Fr(i,"baseUrl")||Fr(i,"paths")){i=Object.assign({},i);let e=s;if(Fr(i,"baseUrl")&&(e=ji(e,i.baseUrl),delete i.baseUrl),Fr(i,"paths")){const t=i.paths,r=ji.bind(null,e);i.paths={};for(const e in t)if(Fr(t,e)){const n=t[e];i.paths[e]=Array.isArray(n)?Array.from(n,r):r(n)}}}n.configure(i)}}if(r=this._manifest.getPreload(),r.length>0)for(const e of r)yield xo(n.require,ji(this._rootAmd,e)).catch(So);return n}))}}const To=void 0;class PropertyOverride{constructor(e,t,r,n){Object.defineProperties(this,{caption:{enumerable:!0,value:e},description:{enumerable:!0,value:t},defaultValue:{enumerable:!0,value:n},aliases:{enumerable:!0,value:r}})}static isEmpty(e,t,r,n){return e===To&&t===To&&r===To&&n===To}static create(e,t,r,n){return PropertyOverride.isEmpty(e,t,n,r)?PropertyOverride.Empty:new PropertyOverride(e,t,r,n)}static fromConfig(e){return e?PropertyOverride.create("caption"in e?_(e.caption):To,"description"in e?_(e.description):To,"aliases"in e?e.aliases:To,"defaultValue"in e?e.defaultValue:To):PropertyOverride.Empty}getCaption(e){return this.caption===To?e:this.caption}getDescription(e){return this.description===To?e:this.description}getDefaultValue(e){return this.defaultValue===To?e:this.defaultValue}getAliases(e){return this.aliases===To?e:function(e,t){if(!t||0===t.length||t===e)return e;const r=e?e.slice(0):[];for(let e=0,n=t.length;e<n;++e){const n=t[e];r.indexOf(n)<0&&r.push(n)}return Object.freeze(r)}(this.aliases,e)}isEmpty(){return this===PropertyOverride.Empty||PropertyOverride.isEmpty(this.caption,this.description,this.defaultValue,this.aliases)}merge(e){return!e||e.isEmpty()?this:new PropertyOverride(e.getCaption(this.caption),e.getDescription(this.description),e.getAliases(this.aliases),e.getDefaultValue(this.defaultValue))}group(e,r,n,s){const i=r||e.tags,o=s||e.properties;if(this.isEmpty()&&i===e.tags&&(!n||n===e.visibility)&&Ws(o,e.properties))return e;let a=n;if(!a){a=t.PropertyVisibility.Excluded;for(const e of o)if(e.visibility!==a){a=e.visibility;break}}return new GroupPropertyDef(e.name,this.getCaption(e.caption),this.getDescription(e.description),this.getAliases(e.aliases),i,a,e.deprecated,e.visualItems,o)}value(e,r,n){return this.isEmpty()&&r===e.tags&&n===e.visibility?e:function(e,r,n,s,i,o,a){switch(e.type){case t.PropertyType.Boolean:return new BooleanPropertyDef(e.name,r,n,s,i,o,e.deprecated,e.affectedBy,e.visualItems,e.allowNull,a,e.serviceWritable,e.requiresData);case t.PropertyType.Color:return new ColorPropertyDef(e.name,r,n,s,i,o,e.deprecated,e.affectedBy,e.visualItems,e.allowNull,a,e.serviceWritable,e.requiresData);case t.PropertyType.Enum:return new EnumPropertyDef(e.name,r,n,s,i,o,e.deprecated,e.affectedBy,e.visualItems,e.allowNull,a,e.serviceWritable,e.requiresData,e.possibleValues,e.dynamic);case t.PropertyType.Font:return new FontPropertyDef(e.name,r,n,s,i,o,e.deprecated,e.affectedBy,e.visualItems,e.allowNull,a,e.serviceWritable,e.requiresData);case t.PropertyType.Length:return new LengthPropertyDef(e.name,r,n,s,i,o,e.deprecated,e.affectedBy,e.visualItems,e.allowNull,a,e.serviceWritable,e.requiresData,e.allowNegative);case t.PropertyType.Number:return new NumberPropertyDef(e.name,r,n,s,i,o,e.deprecated,e.affectedBy,e.visualItems,e.allowNull,a,e.serviceWritable,e.requiresData,e.minValue,e.maxValue);case t.PropertyType.Palette:return new PalettePropertyDef(e.name,r,n,s,i,o,e.deprecated,e.affectedBy,e.visualItems,e.allowNull,a,e.serviceWritable,e.requiresData,e.slot,e.paletteType,e.min,e.max);case t.PropertyType.String:return new StringPropertyDef(e.name,r,n,s,i,o,e.deprecated,e.affectedBy,e.visualItems,e.allowNull,a,e.serviceWritable,e.requiresData);default:throw new Error(`Internal error: createOverridden doesn't handle ${e.type}`)}}(e,this.getCaption(e.caption),this.getDescription(e.description),this.getAliases(e.aliases),r,n,e.parse(this.getDefaultValue(e.defaultValue),null))}}PropertyOverride.Empty=new PropertyOverride(To,To,To,To);const Io=void 0;function Oo(e){return e.subType===t.SlotSubType.GeoSpatial}class SlotOverride{constructor(e,t,r,n,s,i,o,a,l){Object.defineProperties(this,{type:{enumerable:!0,value:e},caption:{enumerable:!0,value:t},description:{enumerable:!0,value:r},optional:{enumerable:!0,value:n},hidden:{enumerable:!0,value:s},aggregation:{enumerable:!0,value:i},suppressMissing:{enumerable:!0,value:o},role:{enumerable:!0,value:a},defaultMapping:{enumerable:!0,value:l}})}static isEmpty(e,t,r,n,s,i,o,a,l){return e===Io&&t===Io&&r===Io&&n===Io&&s===Io&&i===Io&&o===Io&&a===Io&&l===Io}static create(e,t,r,n,s,i,o,a,l){return SlotOverride.isEmpty(e,t,r,n,s,i,o,a,l)?SlotOverride.Empty:new SlotOverride(e,t,r,n,s,i,o,a,l)}static fromConfig(e){return e?SlotOverride.create(e.type&&t.SlotType.parse(e.type)||Io,"caption"in e?_(e.caption):Io,"description"in e?_(e.description):Io,"optional"in e?!!e.optional:Io,"hidden"in e?!!e.hidden:Io,e.aggregation&&t.Aggregation.parse(e.aggregation)||Io,"suppressMissing"in e?!!e.suppressMissing:Io,e.role&&t.FieldRole.parse(e.role)||Io,e.defaultMapping&&t.DefaultMapping.parse(e.defaultMapping)||Io):SlotOverride.Empty}getType(e){return this.type===Io?e:this.type}getCaption(e){return this.caption===Io?e:this.caption}getDescription(e){return this.description===Io?e:this.description}getOptional(e){return this.optional===Io?e:this.optional}getHidden(e){return this.hidden===Io?e:this.hidden}getAggregation(e){return this.aggregation===Io?e:this.aggregation}getSuppressMissing(e){return this.suppressMissing===Io?e:this.suppressMissing}getRole(e){return this.role===Io?e:this.role}getDefaultMapping(e){return this.defaultMapping===Io?e:this.defaultMapping}isEmpty(){return this===SlotOverride.Empty||SlotOverride.isEmpty(this.type,this.caption,this.description,this.optional,this.hidden,this.aggregation,this.suppressMissing,this.role,this.defaultMapping)}merge(e){return!e||e.isEmpty()?this:new SlotOverride(e.getType(this.type),e.getCaption(this.caption),e.getDescription(this.description),e.getOptional(this.optional),e.getHidden(this.hidden),e.getAggregation(this.aggregation),e.getSuppressMissing(this.suppressMissing),e.getRole(this.role),e.getDefaultMapping(this.defaultMapping))}overrideSlot(e,r){if(this.isEmpty())return e;const n=this.getType(e.type);if(n!==e.type&&e.type!==t.SlotType.Cat)throw new Error("Only the type of Any slots can be overridden");const s=this.getOptional(e.optional);if(s!==e.optional&&!e.optional)throw new Error("Cannot make a mandatory slot optional");const i=this.getAggregation(e.aggregation);if(i!==e.aggregation){if(n===t.SlotType.Cat)throw new Error("Cannot set an aggregation for a Cat slot");if(i===t.Aggregation.None)throw new Error("Cannot override aggregation to be None")}if(Oo(e)){if(!r)throw new Error("Internal error: segments are required for Geo slots.");return new GeoSlotDef(e.subTypeOptional,e.name,s,this.getCaption(e.caption),this.getDescription(e.description),e.multiDataItem,e.channels,e.maxLevels,i,this.getSuppressMissing(e.suppressMissing),this.getRole(e.role),this.getDefaultMapping(e.defaultMapping),r,this.getHidden(e.hidden))}return function(e){return e.subType===t.SlotSubType.Temporal}(e)?new TemporalSlotDef(e.subTypeOptional,e.name,s,this.getCaption(e.caption),this.getDescription(e.description),e.multiDataItem,e.channels,e.maxLevels,i,this.getSuppressMissing(e.suppressMissing),this.getRole(e.role),this.getDefaultMapping(e.defaultMapping),e.attributes,this.getHidden(e.hidden)):new SlotDef(n,e.subType,e.subTypeOptional,e.name,s,this.getCaption(e.caption),this.getDescription(e.description),e.multiDataItem,e.channels,e.maxLevels,i,this.getSuppressMissing(e.suppressMissing),this.getRole(e.role),this.getDefaultMapping(e.defaultMapping),this.getHidden(e.hidden))}overrideSegment(e){if(this.isEmpty())return e;const t=this.getOptional(e.optional);if(t!==e.optional&&!e.optional)throw new Error("Cannot make a mandatory slot optional");const r=this.getAggregation(e.aggregation);if(r!==e.aggregation)throw new Error("Changing a segment aggregation is not allowed");return new GeoSegmentDef(e.type,e.name,t,this.getCaption(e.caption),this.getDescription(e.description),e.multiDataItem,e.channels,e.maxLevels,r,this.getSuppressMissing(e.suppressMissing),this.getRole(e.role),this.getDefaultMapping(e.defaultMapping),e.part,this.getHidden(e.hidden))}}function Ro(e,t,r){return null!==e&&(e.includes(t)||null!==r&&r.some((t=>e.includes(t))))}function Eo(e){return e?Object.freeze(Array.from(e,String)):null}SlotOverride.Empty=new SlotOverride(Io,Io,Io,Io,Io,Io,Io,Io,Io);let jo=class SlotRefWithReference{constructor(e,t,r){Object.defineProperties(this,{slot:{enumerable:!0,value:e},dataSetName:{enumerable:!0,value:t},slotName:{enumerable:!0,value:r}})}};function Vo(e,t){const r=e.length;for(let n=0;n<r;++n)if(e[n].name===t)return e[n];return null}function ko(e,t){const r=e.length;for(let n=0;n<r;++n)if(e[n].name===t)return e[n];return null}function Ao(e,r,n,s){let i=null===r?e.visibility:r.getPropertyVisibility(e,n);if(null!==r&&e.type===t.PropertyType.Palette){const n=e.slot;if(null!==n){const e=Vo(s,n.name);e&&!r.isSlotListed(e)&&(i=t.PropertyVisibility.Excluded)}}return i}function Lo(e,r,n,s,i){const o=e.length,a=new Array(o);for(let l=0;l<o;++l){const o=e[l],u=zo(s,o.tags),c=r.getPropertyOverride(o),p=Ao(o,r,n,i);if(o.type===t.PropertyType.Group){const e=o;a[l]=c.group(e,u,null,Lo(e.properties,r,p,u,i))}else a[l]=c.value(o,u,p)}return a}function zo(e,t){const r=null===e?0:e.length,n=null===t?0:t.length;if(n<1)return r<1?v:e;const s=new Array(r+n);for(let t=0;t<r;++t)s[t]=e[t];let i=r;for(let e=0;e<n;++e){const r=t[e];(i<1||s.lastIndexOf(r,i-1)<0)&&(s[i++]=r)}return s.length>i&&(s.length=i),Object.freeze(s)}class UserConfig{constructor(e,t,r,n,s,i){Object.defineProperties(this,{includeProps:{enumerable:!0,value:e},excludeProps:{enumerable:!0,value:t},propOverrides:{enumerable:!0,value:r},includeSlots:{enumerable:!0,value:n},excludeSlots:{enumerable:!0,value:s},slotOverrides:{enumerable:!0,value:i}})}static create(e,t,r,n,s,i){return new UserConfig(e,t,r,n,s,i)}static fromConfig(e){let t=null,r=null,n=null,s=null,i=null,o=null;if(e){const a=e.properties;if(a){t=Eo(a.include),r=Eo(a.exclude);const e=a.override||a.defaults;if(e){n=new Map;for(const t in e)if(Fr(e,t)){const r=PropertyOverride.fromConfig(Object(e[t]));r.isEmpty()||n.set(t,r)}Object.freeze(n)}}const l=e.slots;if(l&&(s=Eo(l.include),i=Eo(l.exclude),l.override)){const e=l.override;o=new Map;for(const t in e)if(Fr(e,t)){const r=SlotOverride.fromConfig(Object(e[t]));r.isEmpty()||o.set(t,r)}}}return UserConfig.create(t,r,n,s,i,o)}isEmpty(){return!this.includeProps&&(!this.excludeProps||this.excludeProps.length<1)&&(!this.propOverrides||this.propOverrides.size<1)&&!this.includeSlots&&(!this.excludeSlots||this.excludeSlots.length<1)&&(!this.slotOverrides||this.slotOverrides.size<1)}isSlotListed(e){const t=null===this.includeSlots||this.includeSlots.includes(e.name),r=null!==this.excludeSlots&&this.excludeSlots.includes(e.name);return t&&!r}getImplicitVisibility(){return null===this.includeProps?t.PropertyVisibility.Listed:t.PropertyVisibility.Excluded}getPropertyVisibility(e,r){return e.visibility===t.PropertyVisibility.Configuration?e.visibility:Ro(this.excludeProps,e.name,e.aliases)?t.PropertyVisibility.Excluded:Ro(this.includeProps,e.name,e.aliases)?t.PropertyVisibility.Listed:r===t.PropertyVisibility.Listed&&e.deprecated?e.visibility:r}getPropertyOverride(e){let t=PropertyOverride.Empty;if(!this.propOverrides||this.propOverrides.size<1)return t;if(e.aliases.length>0)for(const r of e.aliases)t=t.merge(this.propOverrides.get(r));return t.merge(this.propOverrides.get(e.name))}getSlotOverride(e){return!this.slotOverrides||this.slotOverrides.size<1?SlotOverride.Empty:this.slotOverrides.get(e.name)||SlotOverride.Empty}applyTo(e,t){const r=null!==e.source?e.source:e;let n=r.slotGroups,s=r.slots,i=r.dataSets,o=r.properties,a=r.configuration;if(o=Lo(e.properties,this,this.getImplicitVisibility(),v,s),a=function(e,t){if(!t)return e;const r=e.length,n=new Array(r);for(let s=0;s<r;++s){const r=e[s];n[s]=t.getPropertyOverride(r).value(r,r.tags,r.visibility)}return Object.freeze(n)}(e.configuration,this),!this.isEmpty()){const e=new Array;n=function(e,t,r,n){let s;const i=new Array(e.length);let o=0;const a=!t||t.isEmpty(),l=e.length;for(let u=0;u<l;++u){const l=e[u],c=new Array(l.slots.length);let p=0;const h=l.slots.length;for(let e=0;e<h;++e){let i=l.slots[e];if(!a){let e;if(Oo(i)){e=new Array(i.segments.length);let r=0;const o=i.segments.length;for(let a=0;a<o;++a){let o=i.segments[a];o=t.getSlotOverride(o).overrideSegment(o),s=t.isSlotListed(o),s||o.optional||(s=!0,n&&n.warn("Configuration attempts to exclude segment {0} on slot {1}, which is required; it will be included anyway.",o.name,i.name)),s&&(e[r++]=o)}r<e.length&&(e.length=r)}i=t.getSlotOverride(i).overrideSlot(i,e)}s=a||t.isSlotListed(i),s||i.optional||(s=!0,n&&n.warn("Configuration attempts to exclude slot {0}, which is required; it will be included anyway.",i.name)),s&&(i.hidden||(c[p++]=i),r.push(i)),p<c.length&&(c.length=p)}c.length>0&&(i[o++]=new SlotGroupDef(l.caption,l.description,c))}return o<i.length&&(i.length=o),Object.freeze(i)}(n,this,e,t),Object.freeze(e),s=e,i=function(e,t){const r=e.length;let n=0;const s=new Array(r),i=new Array;for(let o=0;o<r;++o){const r=e[o];let a=!0;const l=new Array,u=r.slots.length;for(let s=0;s<u;++s){const o=r.slots[s],u=Vo(t,o.name);if(null===u){if(!o.optional){if(!r.optional)throw new Error(`Trying to exclude mandatory slot ref ${o.name} on non-optional data set ${r.name}`);a=!1}}else{const t=VizDef.createSlotRef(u,o.optional,n);l.push(t);const r=o.getReference();null!==r&&i.push(new jo(t,e[r.dataSetIndex].name,r.name))}}a&&l.length>0&&(s[n]=new DataSetDef(n,Object.freeze(l),r.name,r.optional,r.suppressMissing,r.needsSorted,r.requiresValues,r.uniqueDataPoints,r.caption),++n)}n<s.length&&(s.length=n);const o=i.length;for(let e=0;e<o;++e){const t=i[e],r=ko(s,t.dataSetName),n=null===r?null:r.getSlot(t.slotName);if(null===n)throw new Error(`Configuration excluded the slot "${t.slotName}" on data set "${t.dataSetName}", yet slot "${t.slot.name}" references it`);t.slot.setReference(n)}return s}(r.dataSets,s)}return new VizDef(r,n,s,i,o,a,e.capabilities,e.metaDataEntries)}}const No=/^(?:boolean|number|string|array|object)$/i,Mo=/^slot$/i,Fo=/^group$/i,$o=/^dataset$/i,qo=/^metadataentry$/i,Bo=/^segment$/i,Ho=/^attribute$/i,Go=/^possiblevalue$/i,Uo=/^decoration$/i,Wo=/^decorations$/i,Ko=/^ref$/i,Xo=Object.freeze([new CatPaletteResolver("#319bd4;#86c43b;#f5ce22;#cf6c1b;#9380e8;#8555b5;#52d9bc;#24a399;#14665e;#a4bceb;#77a3e0;#396cb3;#1d4273;#c8d119;#acb336;#828a16;#5a610f;#e8b7cb;#e086b6;#b33681;#73154d"),new CatPaletteResolver("#5aaafa;#4178be;#af6ee8;#a6266e;#d74108;#ff7832;#fdd600;#00b4a0;#008571;#264a60;#7cc7ff;#7c1c58;#ff3ca0;#e71d32;#a53725;#efc100;#be9b00;#8cd211;#4b8400"),new CatPaletteResolver("#4d7aad;#86a9d9;#ce202c;#264a60;#5596e6;#959595;#464646;#4178be;#6d120f;#aeaeae;#645a5a;#dec0b2;#4178be;#a53725;#c7c7c7;#8c7300;#734098;#264a60;#739433;#1896bc"),new CatPaletteResolver("#1ec0d7;#0992da;#aeb6b6;#1dcdd8;#72b8f1;#e4ae80;#eccab7;#6b9bb3;#99d0dc;#c5baae;#1eadc8;#de9f5b;#ebac92;#e09085;#a8662d;#0193b8;#417380;#8fcbfd;#148fd3;#00b4a0")]),Jo=Object.freeze([new CustomCatPaletteResolver("#319bd4;#86c43b;#f5ce22;#cf6c1b;#9380e8;#8555b5;#52d9bc;#24a399;#14665e;#a4bceb;#77a3e0;#396cb3;#1d4273;#c8d119;#acb336;#828a16;#5a610f;#e8b7cb;#e086b6;#b33681;#73154d"),new CustomCatPaletteResolver("#5aaafa;#4178be;#af6ee8;#a6266e;#d74108;#ff7832;#fdd600;#00b4a0;#008571;#264a60;#7cc7ff;#7c1c58;#ff3ca0;#e71d32;#a53725;#efc100;#be9b00;#8cd211;#4b8400"),new CustomCatPaletteResolver("#4d7aad;#86a9d9;#ce202c;#264a60;#5596e6;#959595;#464646;#4178be;#6d120f;#aeaeae;#645a5a;#dec0b2;#4178be;#a53725;#c7c7c7;#8c7300;#734098;#264a60;#739433;#1896bc"),new CustomCatPaletteResolver("#1ec0d7;#0992da;#aeb6b6;#1dcdd8;#72b8f1;#e4ae80;#eccab7;#6b9bb3;#99d0dc;#c5baae;#1eadc8;#de9f5b;#ebac92;#e09085;#a8662d;#0193b8;#417380;#8fcbfd;#148fd3;#00b4a0")]),Qo=Object.freeze([new ContPaletteResolver("#c0e6ff;#7cc7ff;#5aaafa;#5596e6;#4178be;#325c80;#264a60","#ce202c;#ff5050;#f79d9d;#e8bfc9;#e9e0e0;#b4d8f0;#7cc7ff;#5596e6;#4178be"),new ContPaletteResolver("#c8f08f;#b4e051;#8cd211;#5aa700;#4b8400;#2d660a;#144d14","#4178be;#5596e6;#7cc7ff;#b4d8f0;#dfe9e9;#bbe085;#8cd211;#5aa700;#4b8400"),new ContPaletteResolver("#a7fae6;#6eedd8;#41d6c3;#00b4a0;#008571;#006d5d;#005448","#008571;#00b4a0;#41d6c3;#65dbc7;#dfe9e9;#d7aaff;#ba8ff7;#af6ee8;#9855d4")]),Yo=Object.freeze([new CustomContPaletteResolver("#c0e6ff;#7cc7ff;#5aaafa;#5596e6;#4178be;#325c80;#264a60","#ce202c;#ff5050;#f79d9d;#e8bfc9;#e9e0e0;#b4d8f0;#7cc7ff;#5596e6;#4178be"),new CustomContPaletteResolver("#c8f08f;#b4e051;#8cd211;#5aa700;#4b8400;#2d660a;#144d14","#4178be;#5596e6;#7cc7ff;#b4d8f0;#dfe9e9;#bbe085;#8cd211;#5aa700;#4b8400"),new CustomContPaletteResolver("#a7fae6;#6eedd8;#41d6c3;#00b4a0;#008571;#006d5d;#005448","#008571;#00b4a0;#41d6c3;#65dbc7;#dfe9e9;#d7aaff;#ba8ff7;#af6ee8;#9855d4")]);class SlotRefWithReference{constructor(e,t,r){Object.defineProperties(this,{slot:{enumerable:!0,value:e},dataSetName:{enumerable:!0,value:t},slotName:{enumerable:!0,value:r}})}}class SlotResolver{constructor(e){Object.defineProperties(this,{slotGroups:{enumerable:!0,value:e}})}resolve(e){for(let t=0,r=this.slotGroups.length;t<r;++t){const r=this.slotGroups[t];for(let t=0,n=r.slots.length;t<n;++t){const n=r.slots[t];if(n.name===e)return n}}return null}}function Zo(e){const r=vi(e,"level",null),n=t.TemporalLevel.tryParse(r);if(!n)throw new Error(`Invalid Level: ${r}`);const s=_i(e,"optional",!1);return new TemporalAttributeDef(n,s)}function ea(e,r,n,s,i,o,a,l){const u=vi(e,"part",null);if(!u)throw new Error("Segment definition is missing the part attribute");const c=t.GeoSpatialPart.tryParse(u);if(!c)throw new Error(`Invalid part "${c}", must be latitude, longitude, featureId or caption`);let p=l.resolve(vi(e,"caption",u));p=p||r;const h=l.resolve(vi(e,"description",null)),d=_i(e,"optional",!1),f=vi(e,"aggregation",null);let g=t.Aggregation.tryParse(f);if(null===g){if(null!==f)throw new Error(`Invalid Aggregation: ${f}`);g=c===t.GeoSpatialPart.Latitude||c===t.GeoSpatialPart.Longitude?t.Aggregation.None:o}const m=vi(e,"role",a),y=t.FieldRole.tryParse(m);if(null===y)throw new Error(`Invalid FieldRole: ${m}`);return GeoSegmentDef.create(r,n,s,i,d,p,h,g,y,c)}function ta(e,r){const n=vi(e,"name",null);if(!n)throw new Error("A slot name is mandatory");const s=vi(e,"type",null);if(null===s)throw new Error(`A slot type is mandatory (slot: ${n})`);const i=t.SlotType.tryParse(s);if(null===i)throw new Error(`Invalid Slot type: ${s} (slot: ${n})`);const o=vi(e,"subType",t.SlotSubType.None),a=t.SlotSubType.tryParse(o);if(null===a)throw new Error(`Invalid SlotSubType: ${o} (slot: ${n})`);if((a===t.SlotSubType.GeoSpatial||a===t.SlotSubType.Temporal)&&i!==t.SlotType.Cat)throw new Error(`SlotSubType ${a} is only valid for SlotType.Cat`);const l=_i(e,"subTypeOptional",!1);let u=r.resolve(vi(e,"caption",n));u=u||n;const c=r.resolve(vi(e,"description",null)),p=_i(e,"optional",i!==t.SlotType.Cont),h=Object.freeze(wi(e,"channel",v)),d=_i(e,"multi",!1),f=i===t.SlotType.Cont?1:+vi(e,"maxLevels","-1")||-1,g=vi(e,"aggregation",null);let m=t.Aggregation.tryParse(g);if(null===m){if(null!==g)throw new Error(`Invalid Aggregation: ${g} (slot: ${n})`);m=i===t.SlotType.Cat?t.Aggregation.None:t.Aggregation.Auto}if(i===t.SlotType.Cat&&m!==t.Aggregation.None)throw new Error(`A Cat slot cannot have an aggregation other than Aggregation.None, found: ${m} (slot: ${n})`);const y=vi(e,"role",null);let b=t.FieldRole.tryParse(y);if(null===b){if(null!==y)throw new Error(`Invalid FieldRole: ${y} (slot: ${n})`);b=t.FieldRole.Other}const w=vi(e,"defaultMapping",t.DefaultMapping.None),_=t.DefaultMapping.tryParse(w);if(null===_)throw new Error(`Invalid DefaultMapping: ${w} (slot: ${n})`);const P=i!==t.SlotType.Cont&&_i(e,"suppressMissing",!1),C=_i(e,"hidden",!1);switch(a){case t.SlotSubType.GeoSpatial:{const t=mi(e,Bo),s=t.length,i=new Array(s);for(let e=0;e<s;++e)i[e]=ea(t[e],n,_,C,P,m,b,r);return new GeoSlotDef(l,n,p,u,c,d,h,f,m,P,b,_,Object.freeze(i),C)}case t.SlotSubType.Temporal:{const t=mi(e,Ho),r=t.length;if(r<1)throw new Error(`No attributes found (slot: ${n})`);const s=new Array(r);for(let e=0;e<r;++e)s[e]=Zo(t[e]);return new TemporalSlotDef(l,n,p,u,c,d,h,f,m,P,b,_,Object.freeze(s),C)}default:return new SlotDef(i,a,l,n,p,u,c,d,h,f,m,P,b,_,C)}}function ra(e,t){let r=vi(e,"caption",null);if(null===r)throw new Error("A SlotGroup must have a caption");r=t.resolve(r);const n=t.resolve(vi(e,"description",null)),s=mi(e,Mo),i=new Array(s.length);for(let e=0,r=s.length;e<r;++e)i[e]=ta(s[e],t);return new SlotGroupDef(r||"",n,i)}function na(e,r,n,s,i,o){const a=_i(e,"optional",!1),l=mi(e,Ko),u=l.length,c=new Array(u);for(let e=0;e<u;++e){const t=l[e];let s=vi(t,"slot",null);if(null===s)throw new Error("Slot reference missing slot property");const i=n.resolve(s);if(null===i)throw new Error(`Could not resolve slot ${s}`);const u=_i(t,"optional",i.optional);if(!a&&!u&&i.optional)throw new Error(`Slot reference "${s}" is not optional and used on a non optional DataSet, yet the referenced slot is marked optional`);const p=VizDef.createSlotRef(i,u,r);if(c[e]=p,s=vi(t,"reference",null),null!==s){const e=s.indexOf(":");if(e<0)throw new Error(`Invalid slot reference: ${s}, syntax is dataSetName:slotName`);o.push(new SlotRefWithReference(p,s.substring(0,e),s.substring(e+1)))}}const p=function(e){switch(e){case"default":case"sorted":case"all":return e;default:throw new Error(`Invalid iterate value: ${e}`)}}(vi(e,"iterate","default").toLowerCase());let h="data";i>1&&(h+=r),h=vi(e,"name",h);const d="all"!==p,f=_i(e,"uniqueDataPoints",!0);if(!d&&!f)throw new Error('DataSets with iterate="all" must have uniqueDataPoints true (the default)');let g=s.resolve(vi(e,"caption",s.get("dataset_defaultName")));return g=g||h,new DataSetDef(r,Object.freeze(c),h,a,d,"default"!==p,_i(e,"requiresValues",function(e){for(let r=0,n=e.length;r<n;++r){const n=e[r];if(!n.optional&&n.type===t.SlotType.Cont)return!0}return!1}(c)),f,g)}function sa(e,r){if(null===e)return null;const n=vi(e,"name",null);if(!n)throw new Error("A slot name is mandatory");let s=vi(e,"type",null),i=null,o=null;if(null===s)throw new Error(`Decoration ${n} is missing a type`);if(!No.test(s))throw new Error(`Decoration ${n} has an unsupported type: ${s}`);s=s.toLowerCase();const a=wi(e,"target"),l=null===a?0:a.length;if(l<1)throw new Error(`Decoration ${n} is missing targets, at least 1 target is required`);const u=vi(e,"targetSlot",null);if(null!==u&&(i=r.resolve(u),!i))throw new Error(`Decoration ${n} references non-existing slot: ${u} in the targetSlot definition`);const c=vi(e,"referenceSlot",null);if(null!==c&&(o=r.resolve(c),!o))throw new Error(`Decoration ${n} references non-existing slot: ${c} in the referenceSlot definition`);const p=new Array(l);p.length=0;for(let e=0;e<l&&a;++e){const r=t.InfoType.tryParse(a[e]);if(null===r)throw new Error(`Invalid decoration target: ${a[e]}`);p[e]=r}const h=_i(e,"deprecated",!1);return new DecorationDef(n,s,Object.freeze(p),i,o,h)}function ia(e,r,n,s,i,o){const a=vi(e,"name","");if(!a)throw new Error("A property or group must have a name");let l=e.nodeName.toLowerCase(),u=null;if("property"===l){if(l=vi(e,"type",null),null===l)throw new Error(`Property ${a} is missing a type`);o&&o.warn('Property {0} is using deprecated xml: replace <property type="{1}" name="{0}" ...> with <{1} name="{0}" ...>',a,u)}if(u=t.PropertyType.tryParse(l),null===u)throw new Error(`Invalid type: ${l}`);let c=s.resolve(vi(e,"caption",a));c=c||a;const p=s.resolve(vi(e,"description",null)),h=Object.freeze(wi(e,"visualItems",v)),d=Object.freeze(wi(e,"alias",v)),f=Object.freeze(wi(e,"tags",v));let g,m=r?t.PropertyVisibility.Configuration:t.PropertyVisibility.Listed;if(u===t.PropertyType.Group){const l=gi(e),u=l.length;if(u<1)throw new Error(`Empty group: ${a}`);g=!0;let y=!r;const v=new Array(u);for(let e=0;e<u;++e){const a=ia(l[e],r,n,s,i,o);g&&a&&!a.deprecated&&(g=!1),y&&a&&a.visibility!==t.PropertyVisibility.Excluded&&(y=!1),v[e]=a}return y&&(m=t.PropertyVisibility.Excluded),new GroupPropertyDef(a,c,p,d,f,m,g,h,Object.freeze(v))}g=_i(e,"deprecated",!1);const y=Object.freeze(wi(e,"affectedBy",v));if(!g&&y.length>0)throw new Error("AffectedBy can only be used on deprecated properties");const b=_i(e,"allowNull",!1),w=vi(e,"defaultValue",null),_=_i(e,"writable",!1);if(g&&_)throw new Error(`Deprecated property ${a} cannot be writable, its value must be updated via the deprecated property API`);const P=_i(e,"requiresData",!1);switch(!r&&g&&(m=t.PropertyVisibility.Excluded),u){case t.PropertyType.Boolean:return new BooleanPropertyDef(a,c,p,d,f,m,g,y,h,b,BooleanPropertyDef.parse(w,b,null),_,P);case t.PropertyType.Color:return new ColorPropertyDef(a,c,p,d,f,m,g,y,h,b,ColorPropertyDef.parse(w,b,null),_,P);case t.PropertyType.Enum:{const t=Object.freeze(mi(e,Go).map((e=>{const t=fi(e);return new EnumValue(t||"",s.resolve(vi(e,"caption",t))||"",s.resolve(vi(e,"description",null)))}))),r=_i(e,"dynamic",!1);return new EnumPropertyDef(a,c,p,d,f,m,g,y,h,b,EnumPropertyDef.parse(w,b||r&&t.length<1,t,null),_,P,t,r)}case t.PropertyType.Font:return new FontPropertyDef(a,c,p,d,f,m,g,y,h,b,FontPropertyDef.parse(w,b,null),_,P);case t.PropertyType.Length:return new LengthPropertyDef(a,c,p,d,f,m,g,y,h,b,LengthPropertyDef.parse(w,b,null),_,P,_i(e,"allowNegative",!1));case t.PropertyType.Number:return new NumberPropertyDef(a,c,p,d,f,m,g,y,h,b,NumberPropertyDef.parse(w,b,null),_,P,NumberPropertyDef.parse(vi(e,"minValue",null),!0,null),NumberPropertyDef.parse(vi(e,"maxValue",null),!0,null));case t.PropertyType.Palette:let r=null;const o=vi(e,"slot",null),v=vi(e,"type",null);let C=t.PaletteType.tryParse(v);if(null!==o){if(r=n.resolve(o),null===r)throw new Error(`Could not resolve slot ${o}`);if(null===C)switch(r.type){case t.SlotType.Cat:C=t.PaletteType.Cat;break;case t.SlotType.Cont:C=t.PaletteType.Cont;break;default:throw new Error("Cannot omit Palette type for a Slot of type any")}}if(null===C)throw new Error(`Invalid PaletteType: ${l}`);let S=i.has(C)?i.get(C):0;S=S||0,i.set(C,S+1);const x=function(e){switch(e){case t.PaletteType.Cat:return Xo;case t.PaletteType.Cont:return Qo;case t.PaletteType.CustomCat:return Jo;case t.PaletteType.CustomCont:return Yo;default:throw new Error(`Invalid PaletteType: ${e}`)}}(C),D=PalettePropertyDef.parse(C,w,b,x[S%x.length]);return new PalettePropertyDef(a,c,p,d,f,m,g,y,h,b,D,_,P,r,C,Pi(e,"min",null),Pi(e,"max",null));case t.PropertyType.String:return new StringPropertyDef(a,c,p,d,f,m,g,y,h,b,StringPropertyDef.parse(w,b,null),_,P);default:throw new Error(`Unhandled type: ${u}`)}}function oa(e){const t=vi(e,"name",null);if(!t)throw new Error("A meta data entry must have a name");return new MetaDataEntryDef(t,vi(e,"value",null))}class VizDefParser{static fromXmlDocument(e,t,r,n){const s=e.documentElement,i=vi(s,"version",null);if(null===i)throw new Error("Invalid VizDef: missing version");if(+i<3)throw new Error(`Invalid VizDef version: ${i}`);let o,a=v,l=v,u=v,c=v,p=v,h=null,d=v;for(let e=s.firstChild;null!==e;e=e.nextSibling)if(ui(e))switch(e.nodeName.toLowerCase()){case"slots":if(a=mi(e,Mo),l=mi(e,Fo),l.length>0){if(a.length>0)throw new Error("VizDef has a slot outside of a group node.");a=v}break;case"datasets":u=mi(e,$o);break;case"properties":c=gi(e);break;case"configuration":p=gi(e);break;case"capabilities":h=e;break;case"metadata":d=mi(e,qo)}const f=l.length;if(a.length>0){if(f>0)throw new Error("Mixing slots and groups is not allowed");const e=new Array;for(let t=0,n=a.length;t<n;++t)e.push(ta(a[t],r));o=Array.of(new SlotGroupDef(t.dataset_defaultName,null,e))}else{o=new Array(f);for(let e=0;e<f;++e)o[e]=ra(l[e],r)}const g=new Map,m=new Array(u.length),y=new Array,b=new SlotResolver(o);for(let e=0,t=u.length;e<t;++e){const n=na(u[e],e,b,r,t,y);if(g.has(n.name))throw new Error(`DataSet name must be unique, found duplicate name: ${n.name}`);g.set(n.name,n),m[e]=n}for(let e=0,t=y.length;e<t;++e){const t=y[e],r=g.get(t.dataSetName);if(!r)throw new Error(`Could not resolve data set ${t.dataSetName}, data sets must be referenced by name.`);const n=r.getSlot(t.slotName);if(!n)throw new Error(`Could not resolve referenced slot ${t.slotName} on data set ${r.name}`);t.slot.setReference(n)}const w=new Map,_=new Array(c.length);for(let e=0,t=c.length;e<t;++e)_[e]=ia(c[e],!1,b,r,w,n);const P=new Array(p.length);for(let e=0,t=p.length;e<t;++e)P[e]=ia(p[e],!0,b,r,w,n);let C=null;null!==h&&(C=function(e,t){if(null===e)return null;let r;const n=yi(e,Wo);if(n){const e=mi(n,Uo);r=new Array(e.length),r.length=0;for(let n=0,s=e.length;n<s;++n){const s=sa(e[n],t);null!==s&&r.push(s)}}else r=new Array(0);return new CapabilityDef(Object.freeze(r))}(h,b)),C||(C=new CapabilityDef(v));const S=new Array(d.length);for(let e=0,t=d.length;e<t;++e)S[e]=oa(d[e]);return VizDef.create(Object.freeze(o),function(e){const t=e.length;if(t<1)return new Array;if(t<2)return e[0].slots;const r=new Array;for(let n=0;n<t;++n)for(let t=0,s=e[n].slots.length;t<s;++t)r.push(e[n].slots[t]);return Object.freeze(r)}(o),Object.freeze(m),Object.freeze(_),Object.freeze(P),C,Object.freeze(S))}}class Item extends Slotted{constructor(e,t,r,n){super(e,t,r),Object.defineProperties(this,{itemClass:{enumerable:!0,value:n}})}get index(){return this.getIndex()}get uniqueName(){return this.getUniqueName()}getInfoType(){return t.InfoType.Item}getItemClass(){return this.itemClass}getItemClassInfo(){return this.itemClass}getUniqueName(){return this.source?this.source.getUniqueName():"(virtual)"}getIndex(){return this.itemClass.index}getCaption(e){return _(this.source&&this.source.getCaption(Slotted.validateFormatKind(e)))}getLegendCaption(){if(this.source&&"function"==typeof this.source.getLegendCaption){const e=this.source.getLegendCaption();if("string"==typeof e)return _(e)}return this.getCaption(t.FormatKind.Label)}clone(e,t){return new Item(this.source,e,t.getSlotRef(),t)}}class ItemClass extends Slotted{constructor(e,t,r,n){super(e,t,r),Object.defineProperties(this,{index:{enumerable:!0,value:n}})}get uniqueName(){return this.getUniqueName()}getInfoType(){return t.InfoType.ItemClass}getUniqueName(){return this.source?this.source.getUniqueName():"(virtual)"}getIndex(){return this.index}getCaption(e){return _(this.source&&this.source.getCaption(Slotted.validateFormatKind(e)))}getLegendCaption(e=!1){if(this.source&&"function"==typeof this.source.getLegendCaption){const e=this.source.getLegendCaption();if("string"==typeof e)return _(e)}return e?this.combineCaptions(t.FormatKind.Label):this.getCaption(t.FormatKind.Label)}getSubCaption(e){return _(this.source&&this.source.getSubCaption(Slotted.validateFormatKind(e)))}combineCaptions(e){let t=this.getCaption(e),r=this.getSubCaption(e);return r.length>0&&(r.startsWith("(")&&r.endsWith(")")||(r=`(${r})`),t.length>0&&(t+=" "),t+=r),t}clone(e,t){return new ItemClass(this.source,e,t,this.index)}applyContext(e,t){t&&DataContext.setOwner(e,this,t)}}class VirtualItem extends Item{constructor(e,t,r,n){super(null,e,t,r),Object.defineProperties(this,{_caption:{value:n}})}getCaption(e){return this._caption}clone(e,t){return new VirtualItem(e,t.getSlotRef(),t,this._caption)}}class VirtualItemClass extends ItemClass{constructor(e,t,r){super(null,e,t,0),Object.defineProperties(this,{_caption:{value:r}})}getCaption(e){return this._caption}getSubCaption(e){return""}clone(e,t){return new VirtualItemClass(e,t,this._caption)}}class CatDataItemFactoryBase{process(e,t,r,n,s,i){const o=+e.getTupleCount()||0,a=m(0,+e.getDataWindowStart(),o),l=m(a,+e.getDataWindowEnd(),o),u=Math.floor(e.getItemClassSetCount())||0,c=new Array(u);for(let n=0;n<u;++n){const s=e.getItemClassSet(n),i=Math.floor(s.getItemClassCount())||0,o=new Array(i);for(let e=0;e<i;++e)o[e]=new ItemClass(s.getItemClass(e),t,r,e);c[n]=new ItemClassSet(s,r,o)}const p=new Array(Math.max(0,l-a));for(let n=a;n<l;++n){const s=e.getTuple(n),i=c[Math.floor(s.getItemClassSetIndex())||0],o=i.itemClasses.length,l=new Array(o);for(let e=0;e<o;++e)l[e]=new Item(s.getItem(e),t,r,i.itemClasses[e]);p[n-a]=this.createTuple(s,t,r,n,i,l)}return this.createDataItem(e,t,r,n,s,l-a>1?i:-1,o,a,l,c,p)}virtual(e,t,r){const n=new Array(1),s=new Array(1),i=new Array(1),o=new Array(1),a=new VirtualItemClass(e,t,r.virtual_item);return n[0]=a,s[0]=new VirtualItem(e,t,a,r.virtual_item),i[0]=new ItemClassSet(null,t,n),o[0]=this.createTuple(null,e,t,0,i[0],s),this.createDataItem(null,e,t,-1,!1,-1,1,0,1,i,o)}}class ContDataItemFactory{process(e,t,r,n,s,i,o,a){const l=e.getItemClass(),u=l?new ItemClass(l,t,r,0):new VirtualItemClass(t,r,a.virtual_value);return this._createDataItem(e,t,r,n,s,i,u,o)}_createDataItem(e,t,r,n,s,i,o,a){return new ContDataItem(e,t,r,n,s,i,o,a)}}Object.defineProperties(ContDataItemFactory,{instance:{enumerable:!0,value:new ContDataItemFactory}});class DataPointContainer{constructor(e){Object.defineProperties(this,{_dp:{value:e}})}static create(e){const t=e.getDataPointIterator(),r=[];for(let e;e=t.nextValue();)r.push(e);return new DataPointContainer(r)}getDataPointCount(){return this._dp.length}getDataPoint(e){return this._dp[e]}}class DataPointDecorationsMap{constructor(e){Object.defineProperties(this,{_dataPoints:{value:e},_map:{value:new Map}})}has(e){let t;if(this._map.has(e))t=this._map.get(e);else{t=!1;for(const r of this._dataPoints)if(r.hasDecoration(e)){t=!0;break}this._map.set(e,t)}return t}clear(){this._map.clear()}}class Aggregator{constructor(e,t){Object.defineProperties(this,{type:{enumerable:!0,value:e},negative:{enumerable:!0,value:t},_min:{writable:!0,value:1},_max:{writable:!0,value:0},_vPos:{writable:!0,value:0},_vNeg:{writable:!0,value:0},_cPos:{writable:!0,value:0},_cNeg:{writable:!0,value:0}})}isEmpty(){return this._cPos<1&&this._cNeg<1}visit(e){if(null===e||"number"!=typeof e||Number.isNaN(e))return;let t=e,r=t<0;if(r)switch(this.negative){case"ignore":return;case"absolute":t=Math.abs(t);case"aggregate":r=!1}let n=!1;switch(this.type){case"accumulate":t=r?this._vNeg+=t:this._vPos+=t;case"fit":n=!0;break;case"average":case"sum":r?this._vNeg+=t:this._vPos+=t}r?++this._cNeg:++this._cPos,n&&this._fit(t)}toContDomain(){return this.isEmpty()?ContDomain.EMPTY:(this._aggregate(),new ContDomain(this._min,this._max))}applyTo(e){this.isEmpty()||(this._aggregate(),e.visit(this._min),e.visit(this._max))}_fit(e){const t=this._min>this._max;(t||e<this._min)&&(this._min=e),(t||e>this._max)&&(this._max=e)}_aggregate(){if("sum"===this.type||"average"===this.type){let e=this._vPos,t=this._vNeg;"average"===this.type&&(this._cNeg>1&&(t/=this._cNeg),this._cPos>1&&(e/=this._cPos)),this._cNeg>0&&this._fit(t),this._cPos>0&&this._fit(e)}}}class DomainResolver{constructor(e,t,r){Object.defineProperties(this,{_dataItems:{value:e},_dataPoints:{value:t},_slots:{value:r},_cache:{value:new Map}})}static buildOffsets(e,t){const r=e.length,n=new Array(r+(t?1:0));let s=1;for(let t=0;t<r;++t){const r=e[t];if(r instanceof CatDataItem){const e=r.end-r.start;1===e?n[t]=0:(n[t]=s,s*=e)}else n[t]=-1}return t&&(n[r]=s),n}resolve(e,r){let n="fit",s=null,i=null;if(r){const e=r.getAttributes();e.has("type")&&(n=e.get("type")),e.has("over")&&(i=e.get("over")),e.has("negative")&&(s=e.get("negative"))}s||(s="fit"===n||"accumulate"===n?"aggregate":"separate");const o=`${e.sourceIndex}[${n}-${s}:${i||""}]`;let a=this._cache.get(o);if(a)return a;let l=null;const u=[];let c,p=null,h=0,d=null;for(const e of this._slots)if(null!==i||!e.forViz)if(e.forViz&&e.name===i)l=e;else for(const r of e.dataItems){if(r.type!==t.DataItemType.Cat||r.sourceIndex<0||r.colIndex<0)continue;const e=this._dataItems[r.sourceIndex];e&&u.indexOf(e)<0&&u.push(e)}if(null!==i&&null===l)throw new Error(`Invalid over slot: ${i}`);for(const e of this._dataItems)e&&!e.mapped&&"cat"===e.type&&e.colIndex>=0&&u.push(e);"fit"!==n&&u.length>0?(p=DomainResolver.buildOffsets(u,!0),h=u.length,d=new Array(p[h]),c=new Aggregator("fit","aggregate")):c=new Aggregator(n,s);for(const r of this._dataPoints){const i=r.datum(e);if(i.valueType===t.ValueType.Numeric&&null!==i.value){const e=+i.value;if(d&&p){let t=0;for(let e=0;e<h;++e){const n=u[e];t+=p[e]*(r.datum(n).index-n.start)}let i=d[t];i||(d[t]=i=new Aggregator(n,s)),i.visit(e)}else c.visit(e)}}if(d)for(const e of d)e&&e.applyTo(c);return a=c.toContDomain(),this._cache.set(o,Object.freeze(a)),a}}class Value extends Slotted{constructor(e,r,n,s){super(e,r,n),Object.defineProperties(this,{valueType:{enumerable:!0,value:e?e.getValueType():t.ValueType.Missing}}),DataContext.setReference(DataContext.vipr,this,s)}get value(){return this.getValue()}get dataItem(){return DataContext.vipr.getReference(this)}getInfoType(){return t.InfoType.Value}getSubInfoType(){return this.subType}getSubType(){return this.subType}getRSType(){return this.type}asCat(){return null}asCont(){return this}getRSValueType(){return this.valueType}getValue(){return this.valueType===t.ValueType.Missing?null:this.source.getValue()}getDataItem(e){return e.getReference(this)}getCaption(e){return Slotted.validateFormatKind(e),this.source?_(this.source.getCaption(e)):DataContext.vipr.getReference(this).missingCaption(e)}valueOf(){return this.getValue()}getValueInfoType(){return this.valueType}getDataItemInfo(){return DataContext.vipr.getReference(this)}getDataItemInfoType(){return this.type}clone(e,t){return new Value(this.source,e,t.getSlotRef(),t)}applyContext(e,t){DataContext.setReference(e,this,t)}}function aa(e,t){if(e)for(const r of e)if("limit"===r.getName()&&r.getSlot()===t)return r;return null}function la(e){return e&&+e.getAttributes().get("n")||0}function ua(e){return!!e&&"getCaption"in e}function ca(e){return e.forViz}Object.defineProperties(Value.prototype,{type:{value:t.DataItemType.Cont},subType:{value:t.SlotSubType.None}});class DataSet extends Decorated{constructor(e,t,r,n,s,i,o,a,l,u){super(e,t),Object.defineProperties(this,{dataSetDef:{value:r},name:{enumerable:!0,value:r.name},caption:{enumerable:!0,value:ua(e)?String(e.getCaption()):r.caption},slotInfos:{value:n},slots:{value:Object.freeze(n.filter(ca))},dataItems:{value:s},dataPoints:{enumerable:!0,value:i},mapping:{value:o},_overflow:{value:!0===a},_emptied:{value:!0===l},_dataPointDecorationMap:{value:u||new DataPointDecorationsMap(i)}})}get type(){return dn.Structured}getName(){return this.name}getCaption(){return this.caption}getRSType(){return dn.Structured}hasSlot(e){return null!==ds(this.slots,e)}getSlot(e){return fs(this.slots,e,!0)}getSlots(){return this.slots}getDataPoints(){return this.dataPoints}hasDecorationOnDataPoints(e){return this._dataPointDecorationMap.has(e)}hasValues(){return this.dataItems.some((function(e){return e.type===t.DataItemType.Cont}))}getMapping(){return this.mapping}getDataSetDef(){return this.dataSetDef}getDataItemInfos(){return this.dataItems}getDataPointInfos(){return this.dataPoints}getSlotInfo(e){return ds(this.slotInfos,e)}getSlotInfos(){return this.slotInfos}[Symbol.iterator](){return this.dataPoints[Symbol.iterator]()}getInfoType(){return t.InfoType.DataSet}setDataPointDecorationsDirty(){this._dataPointDecorationMap.clear()}slice(e,t,r,n){const s=!this.dataSetDef.suppressMissing&&!this._emptied,i=[],o=[];let a=null,l=0,u=1,c=1,p=!1,h=this.slotInfos.slice(0);if(s){a=[];for(const e of this.dataItems)e&&(e instanceof ContDataItem&&!e.mapped&&a.push(e),e.colIndex>=l&&(l=e.colIndex+1))}for(let t=0;t<h.length;++t){let s=h[t],d=null;const f=aa(r,s.name),g=!!e&&e.indexOf(s.name)>=0,m=s.dataItems.length;for(let e=0;e<m;++e){let t=s.dataItems[e];if(t instanceof CatDataItem&&t.sourceIndex>=0){let r=t.end-t.start;if(r>1){const o=la(f);f&&r>o&&(d||(d=s.dataItems.slice(0)),t=t.clone(this._decoFilter,s.slotRef,t.colIndex,o),t.applyContext(DataContext.vipr,this),p=!0,d[e]=t,n.addSlot(f,o,r,s.slotRef,t),r=o),g||i.push(t),s.forViz&&(u*=r),g&&u>0&&(c*=r)}else r<1&&(u=0,c=1);g&&o.push(t)}a&&(t instanceof ContDataItem&&a.push(t),t.colIndex>=l&&(l=t.colIndex+1))}d&&(h[t]=s=s.clone(d))}o.length>0&&t.length<1&&t.push(...o);const d=i.length;for(const e of this.dataItems)if(e instanceof CatDataItem&&!e.mapped){const t=e.end-e.start;t>1?i.push(e):t<1&&(u=0)}const f=DomainResolver.buildOffsets(i,!1),g=i.length,m=DomainResolver.buildOffsets(o,!1),y=o.length;let v=null,b=0;const w=new Array(c),_=this.dataPoints,P=_.length,C=new Array(c),S=aa(r,null);let x=la(S),D=!1;const T=s||this.dataSetDef.uniqueDataPoints;let I=!1;if((1===c||this._emptied)&&!(s||p||this._overflow)){for(let e=0;e<c;++e)C[e]=this;return C}x<1?x=s?u:P:s&&x>u&&(x=u),s&&u>x&&(n.addData(S,x,u),D=!0);for(let e=0;e<c;++e)w[e]=s?new Array(x):[];for(const e of _){let t=!0,r=0,a=0;T&&e.offset>0&&(t=!1,I||(n.addUnaggregated(),I=!0));for(let n=0;t&&n<g;++n){const s=i[n],o=e.datum(s).index;o>=0&&o<s.end?r+=(o-s.start)*f[n]:t=!1}t&&(t=r<(s?x:u));for(let r=0;t&&r<y;++r){const n=o[r],s=e.datum(n).index;s>=0&&s<n.end?a+=(s-n.start)*m[r]:t=!1}if(t){const t=w[a];s?(t[r]=e,++b):t.length<x?(t.push(e),++b):D||(n.addData(S,x,-1),D=!0)}}let O=this.dataItems;if(p||D){h===this.slotInfos&&(h=h.slice(0));const e=new Array(this.dataItems.length);v=new Array(b);const t=new DomainResolver(e,v,h);for(let r=0;r<h.length;++r){const n=h[r];let s=null;const i=n.dataItems.length;for(let r=0;r<i;++r){let o=n.dataItems[r];o instanceof ContDataItem&&(o=o.clone(this._decoFilter,n.slotRef,o.colIndex,t),o.applyContext(DataContext.vipr,this),s||(s=n.dataItems.slice(0,i)),s[r]=o),e[o.sourceIndex]||(e[o.sourceIndex]=o)}s&&(h[r]=n.clone(s))}O=Object.freeze(e)}if(a){const e=a.length,t=[],r=new Array(l);for(let e=d;e<g;++e){const t=i[e];r[t.colIndex]=t.getTupleInfo(t.start)}for(let t=0;t<e;++t){const e=a[t];r[e.colIndex]=new Value(null,this._decoFilter,e.slotRef,e)}for(let e=0,n=0;e<c;n=++e){for(let e=y-1;e>=0;--e){const t=o[e],s=m[e];let i=0;s>1?(i=Math.floor(n/s),n%=s):s>0&&(i=n,n=0),r[t.colIndex]=t.tuples[i]}const s=w[e];for(let e=0,n=0;e<x;n=++e){if(s[e])continue;for(let e=d-1;e>=0;--e){const t=i[e],s=f[e];let o=0;s>1?(o=Math.floor(n/s),n%=s):s>0&&(o=n,n=0),r[t.colIndex]=t.tuples[o]}const o=t.length;t.push(...r),s[e]=new DataPoint(null,this._decoFilter,O,h,-1,e,t,o,0)}}}let R=-1;for(let e=0;e<c;++e){const t=w[e],r=t.length;if(null!==v&&r>0)for(let e=0;e<r;++e)s&&!t[e].source||(v[++R]=t[e]);C[e]=new DataSet(this.source,this._decoFilter,this.dataSetDef,h,O,t,this.mapping,!1,this._emptied,this._dataPointDecorationMap)}return C}empty(){return this._emptied?this:new DataSet(this.source,this._decoFilter,this.dataSetDef,this.slotInfos,this.dataItems,Object.freeze(new Array(0)),this.mapping,!1,!0,this._dataPointDecorationMap)}applyContext(e,t){for(const t of this.slotInfos)for(const r of t.dataItems)r.applyContext(e,this);for(const t of this.dataItems)t&&!t.mapped&&t.applyContext(e,this);for(const t of this.dataPoints)t.applyContext(e,this)}}class GeoAttributes{constructor(e=!1,t=!1,r=!1,n=!1){Object.defineProperties(this,{caption:{enumerable:!0,value:!!e},latitude:{enumerable:!0,value:!!t},longitude:{enumerable:!0,value:!!r},featureId:{enumerable:!0,value:!!n}})}static create(e){return e&&"object"==typeof e?new GeoAttributes(e.hasCaption(),e.hasLatitude(),e.hasLongitude(),e.hasFeatureId()):new GeoAttributes}hasCaption(){return this.caption}hasLatitude(){return this.latitude}hasLongitude(){return this.longitude}hasFeatureId(){return this.featureId}}class GeoDataItem extends CatDataItem{constructor(e,t,r,n,s,i,o,a,l,u,c,p,h){super(e,t,r,n,s,i,o,a,l,u,c,h),Object.defineProperties(this,{attributes:{enumerable:!0,value:p||null}})}getGeoAttributes(){return this.attributes}_createClone(e,t,r,n,s,i,o,a,l,u,c){return new GeoDataItem(e,t,r,n,s,i,o,a,l,u,c,this.attributes,this._listFmt)}}class GeoTuple extends Tuple{constructor(e,t,r,n,s,i,o,a,l,u){super(e,t,r,n,s,i,u),Object.defineProperties(this,{latitude:{enumerable:!0,value:o},longitude:{enumerable:!0,value:a},featureId:{enumerable:!0,value:l}})}getLatitude(){return this.latitude}getLongitude(){return this.longitude}getFeatureId(){return this.featureId}getDataItem(e){return super.getDataItem(e)}getDataItemInfo(){return super.getDataItemInfo()}addKeyParts(e){super.addKeyParts(e),null!==this.featureId&&e.push(`feat:${this.featureId}`),null!==this.latitude&&e.push(`lat:${this.latitude}`),null!==this.longitude&&e.push(`long:${this.longitude}`)}clone(e,t){return new GeoTuple(this.source,e,t.getSlotRef(),this.index,t,this._cloneItems(e,t),this.latitude,this.longitude,this.featureId,this._listFmt)}}function pa(e){if(w(e))return null;const t=+e;return Number.isNaN(t)?null:t}Object.defineProperties(GeoTuple.prototype,{subType:{value:t.SlotSubType.GeoSpatial}});function ha(e){let r=null;return e&&e.getValueType()===t.ValueType.Numeric&&(r=e.getValue(),null!==r&&(void 0===r?r=null:(r=+r,Number.isNaN(r)&&(r=null)))),r}function da(e){throw new Error(`Invalid access: do not access ${e} on GeoSegmentDataItemBuilder`)}class GeoSegmentDataItemBuilder{constructor(e,t,r,n){Object.defineProperties(this,{index:{enumerable:!0,value:e},_decoFilter:{value:t},slotRef:{enumerable:!0,value:r},mapping:{enumerable:!0,value:n},_dataItem:{writable:!0,value:null},_geoAttributes:{writable:!0,value:null}})}build(e,r,n){const s=[],i=[];let o=null,a=null,l=null,u=null,c=null;for(let r=0,n=this.slotRef.segments.length;r<n;++r){const n=this.mapping[r];if(n>=0){const s=e[n];switch(this.slotRef.segments[r].part){case t.GeoSpatialPart.Caption:a=s;break;case t.GeoSpatialPart.FeatureId:l=s;break;case t.GeoSpatialPart.Latitude:u=s;break;case t.GeoSpatialPart.Longitude:c=s;break;default:throw new Error(`Unknown segment part: ${this.slotRef.segments[r].part}`)}}}for(let e=0,n=r.getDataPointCount();e<n;++e){const n=r.getDataPoint(e);let p,h,d=null,f=null,g=null,m=null;if(a&&(d=a.getTuple(n.getTupleIndex(a.sourceIndex))),l){const e=l.getTuple(n.getTupleIndex(l.sourceIndex));e&&(f=e.getCaption(t.FormatKind.Label))}u&&(g=ha(n.getValue(u.sourceIndex))),c&&(m=ha(n.getValue(c.sourceIndex))),d?(p=d.itemClassSet,h=d.items):(o||(o=new ItemClassSet(null,this.slotRef,v)),p=o,h=v),s.indexOf(p)<0&&s.push(p);const y=new GeoTuple(d?d.source:null,this._decoFilter,this.slotRef,i.length,p,h,g,m,f);i.push(y)}this._geoAttributes=new GeoAttributes(null!==a,null!==u,null!==c,null!==l);const p=i.length;return this._dataItem=new GeoDataItem(null,this._decoFilter,this.slotRef,this.index,!0,n,p,0,p,s,i,this._geoAttributes),this._dataItem}resolveTuple(e,t){if(!this._dataItem)throw new Error("resolveTuple can only be called after build has been called.");return this._dataItem.tuples[t]}hasDecoration(e){da("hasDecoration")}getDecoration(e){da("getDecoration")}getType(){return t.DataItemType.Cat}getItemClassSetCount(){da("getItemClassSetCount")}getItemClassSet(e){da("getItemClassSet")}getTupleCount(){da("getTupleCount")}getDataWindowStart(){da("getDataWindowStart")}getDataWindowEnd(){da("getDataWindowEnd")}getTuple(e){da("getTuple")}}class ReferenceDataItem extends CatDataItem{constructor(e,t,r,n,s,i,o,a,l,u,c,p){super(e,t,r,n,s,i,o,a,l,u,c,p)}_createClone(e,t,r,n,s,i,o,a,l,u,c){return new ReferenceDataItem(e,t,r,n,s,i,o,a,l,u,c,this._listFmt)}}class ReferenceTuple extends Tuple{constructor(e,t,r,n,s,i,o,a){super(e,t,r,n,s,i,a),Object.defineProperties(this,{reference:{enumerable:!0,value:o}})}getReference(){return this.reference}getDataItem(e){return super.getDataItem(e)}getDataItemInfo(){return super.getDataItemInfo()}clone(e,t){return new ReferenceTuple(this.source,e,t.getSlotRef(),this.index,t,this._cloneItems(e,t),this.reference,this._listFmt)}}Object.defineProperties(ReferenceTuple.prototype,{subType:{value:t.SlotSubType.Reference}});class Slot{constructor(e,t,r,n){Object.defineProperties(this,{slotRef:{value:e},mapped:{enumerable:!0,value:t},dataItems:{enumerable:!0,value:r},forViz:{value:!!n}})}get name(){return this.getName()}get type(){return this.getRSType()}get channels(){return this.getChannels()}get dataItemCount(){return this.getDataItemCount()}getInfoType(){return t.InfoType.Slot}getRSType(){return this.slotRef.type}getName(){return this.slotRef.name}getChannels(){return this.slotRef.channels}isMapped(){return this.mapped}getDataItems(){return this.dataItems}getDataItemCount(){return this.dataItems.length}getDataItem(e=0){return In(this.dataItems,e)}getSource(){return null}getSlotRef(){return this.slotRef}getSlotType(){return this.slotRef.type}getDataItemInfos(){return this.dataItems}getDataItemInfo(e){return Tn(this.dataItems,e,"DataItem")}getRSHittableType(){return _n.Data}getHittableType(){return t.HittableType.Data}clone(e){return new Slot(this.slotRef,this.mapped,e,this.forViz)}}Object.defineProperties(Slot.prototype,{slotDef:{get:Slot.prototype.getSlotRef}});class SingleCatSlot extends Slot{get start(){return this.getDataItemInfo(0).start}get end(){return this.getDataItemInfo(0).end}get tupleCount(){return this.getDataItemInfo(0).tupleCount}get itemClassSets(){return this.getDataItemInfo(0).itemClassSets}get tuples(){return this.getDataItemInfo(0).tuples}getStart(){return this.getDataItemInfo(0).getStart()}getEnd(){return this.getDataItemInfo(0).getEnd()}getTupleCount(){return this.getDataItemInfo(0).getTupleCount()}getItemClassSets(){return this.getDataItemInfo(0).getItemClassSets()}getItemClassSetCount(){return this.getDataItemInfo(0).getItemClassSetCount()}getItemClassSet(e){return this.getDataItemInfo(0).getItemClassSet(e)}getTuples(){return this.getDataItemInfo(0).getTuples()}getTuple(e){return this.getDataItemInfo(0).getTuple(e)}asCat(){return this}asCont(){return null}hasDecoration(e){return this.getDataItemInfo(0).hasDecoration(e)}getDecoration(e,t){return this.getDataItemInfo(0).getDecoration(e,t)}getSubCaption(e){return this.getDataItemInfo(0).getSubCaption(e)}combineCaptions(e){return this.getDataItemInfo(0).combineCaptions(e)}getCaption(e){return this.getDataItemInfo(0).getCaption(e)}getLegendCaption(){return this.getDataItemInfo(0).getLegendCaption()}clone(e){return new SingleCatSlot(this.slotRef,this.mapped,e,this.forViz)}}class TemporalAttributes{constructor(e,t,r,n,s,i,o){Object.defineProperties(this,{year:{enumerable:!0,value:!!e},month:{enumerable:!0,value:!!t},day:{enumerable:!0,value:!!r},hour:{enumerable:!0,value:!!n},minute:{enumerable:!0,value:!!s},second:{enumerable:!0,value:!!i},fraction:{enumerable:!0,value:!!o}})}static create(e){return e&&"object"==typeof e?new TemporalAttributes(e.hasYear(),e.hasMonth(),e.hasDay(),e.hasHour(),e.hasMinute(),e.hasSecond(),e.hasFraction()):fa}get date(){return this.hasDate()}get time(){return this.hasTime()}hasYear(){return this.year}hasMonth(){return this.month}hasDay(){return this.day}hasHour(){return this.hour}hasMinute(){return this.minute}hasSecond(){return this.second}hasFraction(){return this.fraction}hasDate(){return this.year||this.month||this.day}hasTime(){return this.hour||this.minute||this.second}}const fa=new TemporalAttributes;function ga(e,t){return String(e).padStart(t,"0")}class FallbackDateFormatter{constructor(e){Object.defineProperties(this,{_v:{value:new Date(0)},_attributes:{value:e}})}format(e){if(w(e))return"";let t="";const r=Number(e);if(Number.isNaN(r))throw new RangeError("Invalid time value");return this._v.setTime(r),this._attributes.date&&(this._attributes.year&&(t+=ga(this._v.getFullYear(),4)),this._attributes.month&&(t.length&&(t+="-"),t+=ga(this._v.getMonth()+1,2)),this._attributes.day&&(t.length&&(t+="-"),t+=ga(this._v.getDay(),2))),this._attributes.time&&(t.length&&(t+=" "),this._attributes.hour&&(t+=ga(this._v.getHours(),2)),this._attributes.minute&&(t.length&&(t+=":"),t+=ga(this._v.getMinutes(),2)),this._attributes.second&&(t.length&&(t+=":"),t+=ga(this._v.getSeconds(),2))),this._attributes.fraction&&(t+="."+ga(this._v.getMilliseconds(),3)),this._v.setTime(0),t}}class TemporalDataItem extends CatDataItem{constructor(e,t,r,n,s,i,o,a,l,u,c,p,h,d){super(e,t,r,n,s,i,o,a,l,u,c,h),Object.defineProperties(this,{attributes:{enumerable:!0,value:p||null},_valueFmt:{value:d||new FormatterCache(e,this._fallbackValueFormatter.bind(this))}})}getTemporalAttributes(){return this.attributes}getFormatter(e){return this._valueFmt.get(e)}_createClone(e,t,r,n,s,i,o,a,l,u,c){return new TemporalDataItem(e,t,r,n,s,i,o,a,l,u,c,this.attributes,this._listFmt,this._valueFmt)}_fallbackValueFormatter(e){return new FallbackDateFormatter(this.attributes)}}class TemporalTuple extends Tuple{constructor(e,t,r,n,s,i,o,a){super(e,t,r,n,s,i,a),Object.defineProperties(this,{value:{enumerable:!0,value:o}})}getValue(){return this.value}clone(e,t){return new TemporalTuple(this.source,e,t.getSlotRef(),this.index,t,this._cloneItems(e,t),this.value,this._listFmt)}getDataItem(e){return super.getDataItem(e)}getDataItemInfo(){return super.getDataItemInfo()}addKeyParts(e){super.addKeyParts(e),null!==this.value&&e.push("date:"+ +this.value)}}Object.defineProperties(TemporalTuple.prototype,{subType:{value:t.SlotSubType.Temporal}});class TemporalDataItemFactory extends CatDataItemFactoryBase{createTuple(e,t,r,n,s,i){return new TemporalTuple(e,t,r,n,s,i,(o=e)&&"getValue"in o?function(e){if(!w(e)){if(e instanceof Date)return e;if("number"==typeof e)return new Date(e)}return null}(e.getValue()):null);var o}createDataItem(e,t,r,n,s,i,o,a,l,u,c){const p=TemporalAttributes.create((h=e)&&"getTemporalAttributes"in h?e.getTemporalAttributes():null);var h;return new TemporalDataItem(e,t,r,n,s,i,o,a,l,u,c,p)}}Object.defineProperties(TemporalDataItemFactory,{instance:{enumerable:!0,value:new TemporalDataItemFactory}});class SingleContSlot extends Slot{get itemClass(){return this.getDataItemInfo(0).itemClass}getItemClass(){return this.getDataItemInfo(0).getItemClass()}getFormatter(e){return this.getDataItemInfo(0).getFormatter(e)}getDomain(e){return this.dataItems.length<1?ContDomain.EMPTY:this.getDataItemInfo(0).getDomain(e)}asCat(){return null}asCont(){return this}hasDecoration(e){return this.getDataItemInfo(0).hasDecoration(e)}getDecoration(e,t){return this.getDataItemInfo(0).getDecoration(e,t)}getSubCaption(e){return this.getDataItemInfo(0).getSubCaption(e)}combineCaptions(e){return this.getDataItemInfo(0).combineCaptions(e)}getCaption(e){return this.getDataItemInfo(0).getCaption(e)}getLegendCaption(){return this.getDataItemInfo(0).getLegendCaption()}clone(e){return new SingleContSlot(this.slotRef,this.mapped,e,this.forViz)}}const ma=new ContDataItemFactory,ya=new class CatDataItemFactory extends CatDataItemFactoryBase{createTuple(e,t,r,n,s,i){return new Tuple(e,t,r,n,s,i)}createDataItem(e,t,r,n,s,i,o,a,l,u,c){return new CatDataItem(e,t,r,n,s,i,o,a,l,u,c)}},va=new TemporalDataItemFactory,ba=new class GeoDataItemFactory extends CatDataItemFactoryBase{createTuple(e,t,r,n,s,i){return new GeoTuple(e,t,r,n,s,i,e&&function(e){return"getLatitude"in e}(e)?pa(e.getLatitude()):null,e&&function(e){return"getLongitude"in e}(e)?pa(e.getLongitude()):null,e&&function(e){return"getFeatureId"in e}(e)?"string"==typeof(o=e.getFeatureId())?o:o?String(o):null:null);var o}createDataItem(e,t,r,n,s,i,o,a,l,u,c){let p;if(!e)throw new Error("GeoDataItemFactory must receive a valid IGeoDataItem");if((h=e)&&"getGeoAttributes"in h){const t=e.getGeoAttributes();p=new GeoAttributes(t.hasCaption(),t.hasLatitude(),t.hasLongitude(),t.hasFeatureId())}else{let e=!1;o>0&&(e=c[0].getItemCount()>0),p=new GeoAttributes(e,!1,!1,!1)}var h;return new GeoDataItem(e,t,r,n,s,i,o,a,l,u,c,p)}},wa=new class ReferenceDataItemFactory extends CatDataItemFactoryBase{createTuple(e,t,r,n,s,i){let o=null;if((a=e)&&"getReference"in a){const t=e.getReference();"string"==typeof t?o=t:Array.isArray(t)&&(o=ReferenceTuple.joinKey(t))}var a;return new ReferenceTuple(e,t,r,n,s,i,o)}createDataItem(e,t,r,n,s,i,o,a,l,u,c){return new ReferenceDataItem(e,t,r,n,s,i,o,a,l,u,c)}};function _a(e,r,n){const s=w(e)?-1:Math.trunc(e);if(s<0||Number.isNaN(e))return-1;if(s>=n.length)throw new RangeError(`Invalid DataItem index: ${e}`);const i=n[s];if(!i)throw new Error(`Cannot map to null DataItem at index: ${s}`);if(!function(e,r){return e===t.SlotType.Any||e===r}(r,i.getType()))throw new Error(`Cannot map a ${i.getType()} dataItem to a ${r}  slot`);return s}function Pa(e,r){switch(e){case t.SlotSubType.GeoSpatial:return"getGeoAttributes"in r;case t.SlotSubType.Temporal:return"getTemporalAttributes"in r;default:return!1}}function Ca(e,r){switch(function(e,r){let n=t.SlotSubType.None;for(const t of e)if(!("part"in t)&&(!t.subTypeOptional||Pa(t.subType,r))){n=t.subType;break}return n}(e,r)){case t.SlotSubType.GeoSpatial:return ba;case t.SlotSubType.Temporal:return va;case t.SlotSubType.Reference:return wa;default:return ya}}function Sa(e){return e.type===t.DataItemType.Cat}function xa(e){return e.getType()===t.DataItemType.Cont}function Da(e,r,n,s,i,o,a,l,u){const c=n.length,p=c>0;let h;if(p){const t=new Array(c);for(let a=0;a<c;++a){let l=s[n[a]];(l.slotRef!==r||o&&t.indexOf(l)>=0&&((d=l).colIndex>=0&&Sa(d)&&d.end-d.start>1))&&(l=l.clone(e,r,l.colIndex<0?l.colIndex:i.length),l.colIndex>=0&&i.push(l)),t[a]=l}h=Object.freeze(t)}else h=r.type===t.SlotType.Cat?Object.freeze(Array.of(ya.virtual(e,r,l))):v;var d;if(!r.multiDataItem&&1===u)switch(r.type){case t.SlotType.Cat:return new SingleCatSlot(r,p,h,a);case t.SlotType.Cont:return new SingleContSlot(r,p,h,a)}return new Slot(r,p,h,a)}function Ta(e,t,r){let n=e[t];n||(n=e[t]=[]),n.push(r)}function Ia(e,t){return e.ordinal===t.ordinal?e.offset-t.offset:e.ordinal<t.ordinal?-1:1}class DataSetFactory{process(e,r,n,s,i,o,a){const l=function(e,t){return t.slots.map((function(t){return e.getSlot(t.name)||t})).concat(e.slots.filter((function(e){return!t.hasSlot(e.name)})))}(e,r),u=l.length,c=new Array(u);let p=null,h=-1;const d=+n.getDataItemCount()||0;let f=[];const g=new Array(d+1);g.length=d;for(let e=0;e<d;++e){const t=n.getDataItem(e);if(!t||!("getType"in t))throw new TypeError(`Invalid DataItem at index ${e}`);if(h<0&&(h=1),!R(t.getType()))throw new TypeError(`Unsupported DataItem type: ${t.getType()}`);g[e]=t}const m=new Array(d),y=function(e,t,r,n,s,i){const o=t.length,a=new Array(o);for(let l=0;l<o;++l){const o=t[l],u=o.type;let c=0,p=null,h=null,d=0;if(e.hasSlot(o.name)&&(h=r.getDataItemsFor(o)||h,h&&(d=h.length)),!o.multiDataItem&&d>1)throw new Error(`Multiple DataItems mapped to slot ${o.name}, which is not allowed`);if(d<1&&o instanceof GeoSlotRef){const e=o.segments.length,t=new Array(e);let a=null,l=!1,u=-1;for(let s=0;s<e;++s){const e=o.segments[s];let p=-1;if(h=r.getDataItemsFor(e)||null,d=h?h.length:0,d>1)throw new Error(`Only one dataItem may be mapped to segment ${e.name}`);h&&d>0&&(p=_a(h[0],e.type,n)),p>=0?(t[s]=p,Ta(i,p,e),c<1&&(c=1),"caption"===e.part?u=p:l=!0):(e.optional||a||(a=e),t[s]=-1)}if(p=new Array(c),c>0){if(a&&(l||!o.subTypeOptional))throw new Error(`Cannot leave segment ${a.name} unmapped, it is not optional`);if(l)p[0]=n.length,n.push(new GeoSegmentDataItemBuilder(n.length,s,o,t));else{if(!o.subTypeOptional)throw new Error(`Slot ${o.name} requires at least one non-caption segment to be mapped`);p[0]=u}}}else{if(p=new Array(d),h)for(let e=0;e<d;++e){const t=_a(h[e],u,n);t>=0&&(p[c++]=t,Ta(i,t,o))}c<d&&(p.length=c)}if(c<1&&!o.optional)throw new Error(`Cannot leave slot ${o.name} unmapped, it is not optional`);a[l]=p||new Array(0)}return a}(e,l,s,g,i,m),b=g.length,w=function(e){return"getDataPointCount"in(t=e)&&"getDataPoint"in t?e:DataPointContainer.create(e);var t}(n),_=w.getDataPointCount(),P=new Array(_),C=new Array(b);for(let e=0;e<d;++e){const r=g[e];let n;const s=m[e]||v,a=s.length>0,l=a?s[0]:null;if(r.getType()===t.DataItemType.Cat){n=Ca(s,r).process(r,i,l,e,a,f.length);const t=n.end-n.start;h&&(t>1?h*=t:t<1&&(h=0))}else{if(!xa(r))throw new Error(`Invalid dataItem type ${r.getType()}`);p||(p=new DomainResolver(C,P,c)),n=ma.process(r,i,l,e,a,f.length,p,o)}n.colIndex>=0&&f.push(n),C[e]=n}for(let e=d;e<b;++e){const t=g[e].build(C,w,f.length);C[e]=t,t.colIndex>=0&&f.push(t)}h<0&&(h=0);let S=h>0?1:0;for(let e=0;e<u;++e){const t=l[e],n=Da(i,t,y[e],C,f,!r.suppressMissing,r.hasSlot(t.name),o,a);c[e]=n;for(const e of n.dataItems)if(Sa(e)&&e.sourceIndex>=0){const t=e.end-e.start;t>1&&S>0&&n.forViz?S*=t:t<1&&(S=0)}}f=function(e,t){const r=new Array(e.length);let n=0;for(const e of t)for(const t of e.dataItems)t.colIndex>=0&&r.indexOf(t)<0&&(r[n++]=t);if(n<e.length)for(const t of e)r.indexOf(t)<0&&(r[n++]=t);if(n!==e.length)throw new Error("Data processing error: not all data items are resolved");return r}(f,c);const x=f.length,D=new Array(b),T=new Array(x*_),I=new Map,O=DomainResolver.buildOffsets(f,!1);let E=!1;for(let e=0,t=0;e<_;++e,t+=x){const r=w.getDataPoint(e);let n=0;for(let t=0;t<b;++t){let n;if(t<d){const e=C[t];if(Sa(e)){const s=r.getTupleIndex(t);if(s<e.start||s>=e.end)throw new RangeError(`Invalid tuple index ${s} for DataItem ${e}, must be between ${e.start} and ${e.end}`);n=e.getTupleInfo(s)}else n=new Value(r.getValue(t),i,e.slotRef,e)}else n=g[t].resolveTuple(r,e);D[t]=n}for(let e=0;e<x;++e){const r=f[e];let s=D[r.sourceIndex];if(s.slotRef!==r.slotRef&&(s=Sa(r)?r.getTupleInfo(s.index):s.clone(i,r)),Sa(r)){const t=s.index-r.start,i=O[e];t>0&&i>0&&(n+=t*i)}T[t+r.colIndex]=s}let s=I.get(n);const o=s?s.offset+1:0;!E&&(n>S||o>0)&&(E=!0),s=new DataPoint(r,i,C,c,e,n,T,t,o),I.set(n,s),P[e]=s}return!r.needsSorted&&r.suppressMissing||P.sort(Ia),new DataSet(n,i,e,c,C,P,s,E,!1,null)}}class VizBooleanProperty extends VizValueProperty{constructor(e,t){super(e,t)}}class BooleanProperty extends ValueProperty{constructor(e,t,r){super(e,t,r),Object.defineProperties(this,{_hostView:{value:new VizBooleanProperty(this,e)}})}_normalize(e){return e}toHost(){return this._hostView}}class VizColorProperty extends VizValueProperty{constructor(e,t){super(e,t)}}class ColorProperty extends ValueProperty{constructor(e,t,r){super(e,t,r),Object.defineProperties(this,{_hostView:{value:new VizColorProperty(this,e)}})}toHost(){return this._hostView}_normalize(e){return Color.fromHost(e)}_valuesEqual(e,t){return e===t||!!e&&e.equals(t)}}class PossibleValuesEventArgs extends EventArgs{constructor(e,t){super(),Object.defineProperties(this,{property:{enumerable:!0,value:e},oldValue:{enumerable:!0,value:t}})}}class VizEnumProperty extends VizValueProperty{get defaultValue(){return this.getDefaultValue()}get possibleValues(){return this.getPossibleValues()}get dynamic(){return this.isDynamic()}constructor(e,t){super(e,t)}getDefaultValue(){return Ie(this).getDefaultValue()}getPossibleValues(){return Ie(this).getPossibleValues()}isDynamic(){return this.getDef().dynamic}on(e,t){return super.on(e,t)}}class EnumProperty extends ValueProperty{constructor(e,t,r){super(e,t,r),Object.defineProperties(this,{_hostView:{value:new VizEnumProperty(this,e)},_defaultValue:{writable:!0,value:e.defaultValue},_possibleValues:{writable:!0,value:e.possibleValues},_possibleValuesLocked:{writable:!0,value:e.possibleValues},_renPossibleValues:{writable:!0,value:kn}})}toHost(){return this._hostView}getDefaultValue(){return this._defaultValue}getPossibleValues(){return this._possibleValues}getPossibleValuesLocked(){return this._possibleValuesLocked}setPossibleValues(e,t){if(!this._def.dynamic)throw new Error(`setPossibleValues is not allowed on ${this._def.name}, the enum property is not dynamic`);if(e.length<1&&!this._def.allowNull)throw new Error(`Cannot set empty possibleValues on ${this._def.name}, allowNull is false`);const r=new Set;for(const t of e){if(r.has(t.name))throw new TypeError(`Duplicate enum value name ${t.name}`);r.add(t.name)}const n=this._possibleValues;return this._possibleValues=e,this.isLocked()||(this._possibleValuesLocked=e),this._defaultValue=this.parse(t,null),this.emit("possibleValues",new PossibleValuesEventArgs(this.toHost(),n)),this.setValue(this.parse(this._value,this._defaultValue),this._value,!0),this._possibleValues}isDirty(){return super.isDirty()||this._possibleValues!==this._renPossibleValues}isDirtyLocked(){return super.isDirtyLocked()||this._possibleValuesLocked!==this._renPossibleValues}parse(e,t=this._value){if(void 0===e)return this._defaultValue;let r=null;var n;"string"==typeof e?r=e:e instanceof EnumValue||le(e)?r=e.getName():"object"==typeof(n=e)&&n&&"name"in n&&(r=e.name);const s=EnumPropertyDef.parse(r,this._def.allowNull,this._possibleValues,t);return null===s?null:this._normalize(s)}resetValue(){this.setValue(this._defaultValue,void 0)}postInit(){if(super.postInit(),this.def.dynamic&&!this.def.allowNull&&this._possibleValues.length<1)throw new Error(`The rendering service did not initialize dynamic enum property ${this.def.name}`)}_normalize(e){return EnumValue.fromHost(e)}_markRendered(e){super._markRendered(e),e&&this._renPossibleValues!==this._possibleValues&&(this._renPossibleValues=this._possibleValues),this._possibleValuesLocked!==this._possibleValues&&(this._possibleValuesLocked=this._possibleValues)}}class VizFontProperty extends VizValueProperty{constructor(e,t){super(e,t)}}class FontProperty extends ValueProperty{constructor(e,t,r){super(e,t,r),Object.defineProperties(this,{_hostView:{value:new VizFontProperty(this,e)}})}toHost(){return this._hostView}_normalize(e){return Font.fromHost(e)}_valuesEqual(e,t){return e===t||!!e&&e.equals(t)}}class VizLengthProperty extends VizValueProperty{constructor(e,t){super(e,t)}get allowNegative(){return this.getDef().allowNegative}getAllowNegative(){return this.getDef().allowNegative}}class LengthProperty extends ValueProperty{constructor(e,t,r){super(e,t,r),Object.defineProperties(this,{_hostView:{value:new VizLengthProperty(this,e)}})}toHost(){return this._hostView}_normalize(e){return Length.fromHost(e)}_valuesEqual(e,t){return e===t||!!e&&e.equals(t)}}class VizNumberProperty extends VizValueProperty{constructor(e,t){super(e,t)}get minValue(){return this.getDef().minValue}get maxValue(){return this.getDef().maxValue}getMinValue(){return this.getDef().minValue}getMaxValue(){return this.getDef().maxValue}}class NumberProperty extends ValueProperty{constructor(e,t,r){super(e,t,r),Object.defineProperties(this,{_hostView:{value:new VizNumberProperty(this,e)}})}_normalize(e){return e}toHost(){return this._hostView}}class VizPaletteProperty extends VizValueProperty{constructor(e,t){super(e,t)}get paletteType(){return this.getDef().paletteType}get slot(){return this.getDef().slot}getPaletteType(){return this.getDef().paletteType}getSlot(){return this.getDef().slot}}class PaletteProperty extends ValueProperty{constructor(e,t,r){super(e,t,r),Object.defineProperties(this,{_hostView:{value:new VizPaletteProperty(this,e)}})}_normalize(e){return e}toHost(){return this._hostView}}class VizStringProperty extends VizValueProperty{constructor(e,t){super(e,t)}}class StringProperty extends ValueProperty{constructor(e,t,r){super(e,t,r),Object.defineProperties(this,{_hostView:{enumerable:!0,value:new VizStringProperty(this,e)}})}_normalize(e){return e}toHost(){return this._hostView}}class VizVisualItem{constructor(e,t){Object.defineProperties(this,{_id:{value:e},_properties:{value:t}})}getId(){return this._id}getProperties(){return this._properties}}class VizVisualItems{constructor(e){Object.defineProperties(this,{_visualItems:{value:e,writable:!0}})}has(e){return this._visualItems.has(e)}get(e){return this._visualItems.get(e)||null}list(){return Object.freeze(Array.from(this._visualItems.values()))}getVisualItemsMap(){return this._visualItems}merge(e){return this._visualItems=new Map([...this._visualItems.entries(),...e.entries()]),this}}class PropertyChangeEventArgs extends EventArgs{constructor(e,t,r){super(),Object.defineProperties(this,{change:{enumerable:!0,value:e},property:{enumerable:!0,value:t},previous:{enumerable:!0,value:r}})}}function Oa(e,r,n,s){let i;switch(e.type){case t.PropertyType.Group:i=new GroupProperty(e,Object.freeze(Array.from(e.properties,(e=>Oa(e,r,n,s)))),n,s);break;case t.PropertyType.Boolean:i=new BooleanProperty(e,n,s);break;case t.PropertyType.Color:i=new ColorProperty(e,n,s);break;case t.PropertyType.Enum:i=new EnumProperty(e,n,s);break;case t.PropertyType.Font:i=new FontProperty(e,n,s);break;case t.PropertyType.Length:i=new LengthProperty(e,n,s);break;case t.PropertyType.Number:i=new NumberProperty(e,n,s);break;case t.PropertyType.String:i=new StringProperty(e,n,s);break;case t.PropertyType.Palette:i=new PaletteProperty(e,n,s);break;default:throw new Error(`Unhandled ValuePropertyType: ${e.type}`)}return n.set(e.name,[]),s.set(e.name,[]),e.visualItems.forEach((e=>{r.has(e)?r.get(e).push(i.toHost()):r.set(e,[i.toHost()])})),i}function Ra(e,t){const r=t.length;for(const n of e){let e;for(let s=0;s<r&&!e;++s)t[s].name===n.def.name&&(e=t[s]);if(!e)throw new Error(`Could not resolve property ${n.def.name} at expected position in the property tree`);n.setPropertyDef(e)}}function Ea(e,t){for(const r of t){const t=r.toHost();e.set(r.def.name,t);for(const n of r.def.aliases)e.set(n,t);ys(r)&&Ea(e,r.properties)}}function ja(e,r,n,s,i){for(const o of e)if(i&&o.def.visibility===t.PropertyVisibility.Listed&&i.push(o.toHost()),ys(o))ja(o.properties,r,n,s,i);else if(An(o)){const e=o.toHost();switch(e.getVisibility()){case t.PropertyVisibility.Listed:r.push(e);break;case t.PropertyVisibility.Configuration:n.push(e);break;case t.PropertyVisibility.Excluded:s.push(e)}}}class VizProperties{constructor(e){Oe(this,e);const t=new Map;Ea(t,e.properties),Ea(t,e.configuration),Object.defineProperties(this,{_map:{value:Object.freeze(t)},_tree:{value:[]},_listed:{value:[]},_configuration:{value:[]},_excluded:{value:[]}}),this.update()}get size(){return this._tree.length}get tree(){return this._tree}get listed(){return this._listed}get configuration(){return this._configuration}get excluded(){return this._excluded}update(){const e=Ie(this);this._tree.length=0,this._listed.length=0,this._configuration.length=0,this._excluded.length=0,ja(e.properties,this._listed,this._configuration,this._excluded,this._tree),ja(e.configuration,this._listed,this._configuration,this._excluded,this._tree)}has(e){return this._map.has(e)}get(e){return this._map.get(e)||null}forEach(e,t){for(const r of this._listed)e.call(t,r,r.def.name,this);for(const r of this._configuration)e.call(t,r,r.def.name,this);for(const r of this.excluded)e.call(t,r,r.def.name,this)}on(e,t){if(!ye(t))throw new TypeError(`${t} is not a function`);return"change"===e?function(e,t){const r=Ie(e).on("active",(function(r){t(new PropertyChangeEventArgs("active",r.property,r.oldValue),e)})),n=Ie(e).on("value",(function(r){t(new PropertyChangeEventArgs("value",r.property,r.oldValue),e)}));return n.own(r),n}(this,t):Ie(this).on(e,(e=>t(e,this)))}getGroup(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Group?r:null}getBoolean(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Boolean?r:null}getColor(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Color?r:null}getEnum(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Enum?r:null}getNumber(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Number?r:null}getString(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.String?r:null}getPalette(e){const r=this._map.get(e);return r&&r.getType()===t.PropertyType.Palette?r:null}}Object.defineProperties(VizProperties.prototype,{properties:{get:function(){return this.tree}}});class Properties extends Evented{constructor(e,t,r,n,s){super();const i=this.emit.bind(this,"active"),o=this.emit.bind(this,"value");function a(e){this.own(e,e.on("active",i),e.on("value",o))}e.forEach(a,this),t.forEach(a,this),Object.defineProperties(this,{properties:{enumerable:!0,value:Object.freeze(e)},configuration:{enumerable:!0,value:Object.freeze(t)},propsToRSVisualItemsMap:{enumerable:!0,value:Object.freeze(n)},visualItemsToRSProps:{enumerable:!0,value:new Map},_visualItems:{enumerable:!0,value:s}}),Object.defineProperty(this,"_hostView",{value:new VizProperties(this)})}static create(e){const t=new Map,r=new Map,n=new Map,s=Array.from(e.properties||v,(e=>Oa(e,t,r,n))),i=Array.from(e.configuration||v,(e=>Oa(e,t,r,n))),o=function(e,t){const r=new Map;return t.forEach(((t,n)=>{const s=new VizVisualItem(n,t);r.set(n,s),t.forEach((t=>e.get(t.name).push(s)))})),new VizVisualItems(r)}(r,t);return new Properties(s,i,r,n,o)}updateDefs(e,t){Ra(this.properties,e),Ra(this.configuration,t),this._hostView.update()}toHost(){return this._hostView}lock(){for(const e of this.properties)e.lock();for(const e of this.configuration)e.lock()}unlock(e){for(const t of this.properties)t.unlock(e);for(const t of this.configuration)t.unlock(e)}postInit(){for(const e of this.properties)e.postInit();for(const e of this.configuration)e.postInit()}getVisualItems(){return this._visualItems}isDirtyLocked(){return this.properties.some(Vn)||this.configuration.some(Vn)}}const Va=new class VIPRDataFactory{constructor(){Object.defineProperties(this,{_dataSetFactory:{value:new DataSetFactory}})}process(e,t,r,n,s,i){if(!("getDataSetAt"in e))throw new TypeError("The supplied data does not meet the IVIPRData interface");if(!t)throw new Error("Slot mapping is required");if(!("getDataSetMapping"in t))throw new TypeError("The supplied slot mapping does not meet the ISlotMapping interface");const o=n.source?n.source.dataSets:n.dataSets,a=o.length,l=new Array(a),u=new Set;for(let n=0;n<a;++n){const a=o[n],c=r.getDataSet(a.name);let p=null;if(c){const r=e.getDataSetAt(c.index)||null;if(r){const e=t.getDataSetMapping(c.index);if(!e)throw new Error(`SlotMapping is required for DataSet ${n}, as it is not null`);p=this._dataSetFactory.process(c,a,r,e,u,s,i)}}if(!p&&!a.optional)throw new Error(`DataSet ${n} cannot be null, it is not optional`);l[n]=p}return new VIPRData(e,n,u,t,Object.freeze(l),null)}},ka=new WeakMap;class VizBundle{constructor(e,t,r,n,s,i,o,a,l,u,c,p){Object.defineProperties(this,{id:{enumerable:!0,value:e},location:{enumerable:!0,value:t},locale:{enumerable:!0,value:r},userData:{enumerable:!0,value:s},vizDef:{enumerable:!0,value:a},_bundleVizDef:{enumerable:!0,value:l},_userConfig:{value:n},_serviceLoader:{value:i},_resLoader:{value:o},_viprNls:{value:u},_bundleNls:{value:c},_logger:{value:p},_extensionCache:{writable:!0,value:null}})}getId(){return this.id}getLocation(){return this.location}getVizDef(){return this.vizDef}getUserData(){return this.userData}getLocale(){return this.locale}getNls(){return this._bundleNls}getSupportedFormats(){return this._serviceLoader.serviceDescription.formats}getDependencies(){return this._serviceLoader.serviceDescription.dependencies}loadResource(e,t){return this._resLoader.load(this.locale,e,t)}create(e,t=null,r,n){return this._serviceLoader.load().then((s=>{const i=s.ctor;let o,a=null;try{a=new i}catch(e){throw e.message.includes("Object doesn't support this action")?new TypeError("Your browser doesn't support methods or properties used in this visualization"):e}if(ka.has(i))o=ka.get(i)||null;else{if(!((l=a)&&"init"in l&&"destroy"in l&&"setData"in l&&"setProperty"in l&&"getBlockingRequests"in l&&"render"in l&&"getEncodings"in l&&"getCapabilities"in l&&"getInteractivity"in l&&"getState"in l&&"setState"in l&&"getVisCoordinate"in l&&"getItemsAtPoint"in l&&"getAxisItemsAtPoint"in l&&"getItemsInPolygon"in l&&"getRegionAtPoint"in l))throw new Error("RenderingService does not comply with the IRenderingService interface");o=a.getPropertyApi()||null,ka.set(i,o)}var l;return new VizServiceImpl(this,this._viprNls,this._logger,Properties.create(this._bundleVizDef),new DataContext,e,t,void 0===r?this.userData:r,a).init(s,o,w(n)?this.locale:n)}))}processData(e,t){return Va.process(e,t,this.vizDef,this._bundleVizDef,this._viprNls,this._serviceLoader.serviceDescription.apiVersion)}sliceData(e,t,r,n=null){if(!(e instanceof VIPRData))throw new TypeError("The provided data must be created via ProcessData");if(VIPRData.isSliced(e))throw new Error("The provided data is already sliced");return e.slice(t,r,n,this._viprNls)}extend(e){this._extensionCache||(this._extensionCache=new WeakMap);let t=this._extensionCache.get(e);if(!t){const r=this.vizDef.extend(e);t=new VizBundle(this.id,this.location,this.locale,this._userConfig,this.userData,this._serviceLoader,this._resLoader,this._userConfig.applyTo(r,this._logger),this._bundleVizDef,this._viprNls,this._bundleNls,this._logger),this._extensionCache.set(e,t)}return t}}Object.defineProperty(VizBundle.prototype,"compileData",{value:function(e,t){return e?this.processData(e,t):null}});var Aa={dataset_defaultName:"Data",render_obsolete:"Render obsolete",data_truncation:"The data displayed has been limited.",tuple_truncation:"The {0} field is showing {1} of {2} values.",datapoint_truncation:"Data has been limited to {0} rows.",duplicate_truncation:"Unaggregated data points are not supported by this visualization. Only the first values will be displayed."},La={dataset_defaultName:"Data",render_obsolete:"Vykreslen je zastaral",data_truncation:"Mnostv zobrazovanch dat bylo omezeno.",tuple_truncation:"Pole {0} zobrazuje {1} z {2} hodnot.",datapoint_truncation:"Mnostv dat bylo omezeno na {0} dk.",duplicate_truncation:"Neagregovan datov body nejsou touto vizualizac podporovny. Zobraz se pouze prvn hodnoty."},za={dataset_defaultName:"Data",render_obsolete:"Gengivelse forldet",data_truncation:"De viste data er begrnset.",tuple_truncation:"Feltet {0} viser {1} af {2} vrdier.",datapoint_truncation:"Data er begrnset til {0} rkker.",duplicate_truncation:"Ikke-beregnede datapunkter understttes ikke af denne visualisering. Kun de frste vrdier bliver vist."},Na={dataset_defaultName:"Daten",render_obsolete:"Obsolet machen",data_truncation:"Fr die Anzeige der Daten wurde ein Grenzwert festgelegt.",tuple_truncation:"Das Feld {0} zeigt {1} von {2} Werten.",datapoint_truncation:"Die Daten wurden auf {0} Zeilen begrenzt.",duplicate_truncation:"Nicht aggregierte Datenpunkte werden von dieser Visualisierung nicht untersttzt. Nur die ersten Werte werden angezeigt."},Ma={dataset_defaultName:"Datos",render_obsolete:"Mostrar obsoletos",data_truncation:"Se han limitado los datos visualizados.",tuple_truncation:"El campo {0} est mostrando {1} de {2} valores. ",datapoint_truncation:"Se han limitado los datos a {0} filas.",duplicate_truncation:"Esta visualizacin no da soporte a los puntos de datos no agregados. Solo se mostrarn los primeros valores."},Fa={dataset_defaultName:"Tiedot",render_obsolete:"Hahmonna vanhentuneet tiedot",data_truncation:"Nytettvi tietoja on rajoitettu.",tuple_truncation:"Kentn {0} arvoista on nkyviss {1}/{2}.",datapoint_truncation:"Tiedot on rajoitettu {0} riviin.",duplicate_truncation:"Tm visualisointi ei tue yhdistmttmi tietopisteit. Vain ensimmiset arvot nytetn."},$a={dataset_defaultName:"Donnes",render_obsolete:"Rendre obsolte",data_truncation:"Les donnes affiches ont t limites.",tuple_truncation:"La zone {0} affiche {1} sur {2} valeurs.",datapoint_truncation:"Les donnes ont t limites  {0} lignes.",duplicate_truncation:"Les points de donnes dsagrges ne sont pas pris en charge par cette visualisation. Seules les premires valeurs seront affiches."},qa={dataset_defaultName:"",render_obsolete:" ",data_truncation:"  .",tuple_truncation:"{0}  {1}  {2} .",datapoint_truncation:"  -{0} .",group_miscellaneous:""},Ba={dataset_defaultName:"Podaci",render_obsolete:"Prikaz je zastario",data_truncation:"Prikaz podataka je ogranien.",tuple_truncation:"{0} polje pokazuje {1} od {2} vrijednosti.",datapoint_truncation:"Podaci su ogranieni na {0} reda(ova).",duplicate_truncation:"Neagregriane toke podataka nisu podrane s ovom vizualizacijom. Prikazat e se samo prve vrijednosti."},Ha={dataset_defaultName:"Adatok",render_obsolete:"Elavultak megjelentse",data_truncation:"A megjelentett adatok korltozva vannak.",tuple_truncation:"A(z) {0} mez {1} / {2} rtket jelent meg. ",datapoint_truncation:"Az adatok {0} sorra vannak korltozva.",duplicate_truncation:"Ez a megjelents nem tmogatja a nem sszestett adatpontokat. Csak az els rtkek jelennek meg."},Ga={dataset_defaultName:"Dati",render_obsolete:"Rappresenta elementi obsoleti",data_truncation:"I dati visualizzati sono stati limitati.",tuple_truncation:"Il campo {0} mostra {1} di {2} valori.",datapoint_truncation:"I dati sono stati limitati a {0} righe.",duplicate_truncation:"I punti di dati non aggregati non sono supportati da questa visualizzazione.Verranno visualizzati solo i primi valori."},Ua={dataset_defaultName:"",render_obsolete:"",data_truncation:"",tuple_truncation:"{0}  {2}  {1} ",datapoint_truncation:" {0} ",duplicate_truncation:""},Wa={dataset_defaultName:"",render_obsolete:" ",data_truncation:"  .",tuple_truncation:"{0}  {2}  {1} .",datapoint_truncation:" {0}  .",duplicate_truncation:"      .    ."},Ka={dataset_defaultName:"",render_obsolete:" ",data_truncation:"   .",tuple_truncation:"{0}  {2}   {1}  . ",datapoint_truncation:" {0} .",duplicate_truncation:"       .    ."},Xa={dataset_defaultName:"Data",render_obsolete:"Gjr foreldet",data_truncation:"Dataene som blir vist, har blitt begrenset.",tuple_truncation:"Feltet {0} viser {1} av {2} verdier.",datapoint_truncation:"Data er begrenset til {0} rader.",duplicate_truncation:"Ikke-aggregerte datapunkter stttes ikke av denne visualiseringen. Bare de frste verdiene blir vist."},Ja={dataset_defaultName:"Gegevens",render_obsolete:"Verouderde weergeven",data_truncation:"De afgebeelde gegevens zijn beperkt.",tuple_truncation:"In het veld {0} worden {1} van {2} waarden afgebeeld.",datapoint_truncation:"Gegevens zijn beperkt tot {0} rijen.",duplicate_truncation:"Niet-geaggregeerde gegevenspunten worden niet ondersteund door deze visualisatie. Alleen de eerste waarden worden afgebeeld."},Qa={dataset_defaultName:"Data",render_obsolete:"Gjr foreldet",data_truncation:"Dataene som blir vist, har blitt begrenset.",tuple_truncation:"Feltet {0} viser {1} av {2} verdier.",datapoint_truncation:"Data er begrenset til {0} rader.",duplicate_truncation:"Ikke-aggregerte datapunkter stttes ikke av denne visualiseringen. Bare de frste verdiene blir vist."},Ya={dataset_defaultName:"Dane",render_obsolete:"Prezentacja nieaktualna",data_truncation:"Wywietlane dane s ograniczone.",tuple_truncation:"W polu {0} przedstawiono {1} z {2} wartoci.",datapoint_truncation:"Dane zostay ograniczone do nastpujcej liczby wierszy: {0}.",duplicate_truncation:"Niezagregowane punkty danych nie s obsugiwane przez t wizualizacj. Wywietlone zostan tylko pierwsze wartoci."},Za={dataset_defaultName:"Dados",render_obsolete:"Renderizar obsoletos",data_truncation:"Os dados exibidos foram limitados.",tuple_truncation:"O campo {0} est mostrando {1} de {2} valores.",datapoint_truncation:"Os dados foram limitados a {0} linhas.",duplicate_truncation:"Pontos de dados no agregados no so suportados por essa visualizao. Somente os primeiros valores sero exibidos."},el={dataset_defaultName:"Date",render_obsolete:"Randare perimat",data_truncation:"Datele afiate au fost limitate.",tuple_truncation:"Cmpul {0} afieaz {1} din {2} valori.",datapoint_truncation:"Datele au fost limitate la {0} rnduri.",duplicate_truncation:"Punctele de date neagregate nu sunt acceptate n aceast vizualizare. Vor fi afiate numai primele valori."},tl={dataset_defaultName:"",render_obsolete:" ",data_truncation:"  .",tuple_truncation:"  {0}  {1}  {2} .",datapoint_truncation:"  {0} .",duplicate_truncation:"       .     ."},rl={dataset_defaultName:"Podatki",render_obsolete:"Upodobitev je zastarela",data_truncation:"Prikazani podatki so omejeni.",tuple_truncation:"Polje {0} prikazuje {1} od {2} vrednosti. ",datapoint_truncation:"Podatki so bili omejeni na toliko vrstic: {0}.",duplicate_truncation:"Ta vizualizacija ne podpira neagregiranih podatkovnih tok. Prikazane bodo samo prve vrednosti."},nl={dataset_defaultName:"Data",render_obsolete:"Rendera inaktuell",data_truncation:"Data som visas har begrnsats.",tuple_truncation:"Fltet {0} visar {1} av {2} vrden.",datapoint_truncation:"Data har begrnsats till {0} rader.",duplicate_truncation:"Oaggregerade datapunkter stds inte av visualiseringen. Endast de frsta vrdena visas."},sl={dataset_defaultName:"",render_obsolete:"",data_truncation:"",tuple_truncation:" {0}  {1}  {2}",datapoint_truncation:" {0} ",duplicate_truncation:" "},il={dataset_defaultName:"Veriler",render_obsolete:"Grsel olarak oluturma kullanm d",data_truncation:"Grntlenen veriler snrland.",tuple_truncation:"{0} alan {1} / {2} deer gsteriyor.",datapoint_truncation:"Veriler, {0} satrla snrland.",duplicate_truncation:"Toplanmam veri noktalar bu grselletirme tarafndan desteklenmez. Yalnzca ilk deerler grntlenecektir."},ol={dataset_defaultName:"",render_obsolete:"",data_truncation:"",tuple_truncation:"{0}  {1}  {2} ",datapoint_truncation:" {0} ",duplicate_truncation:""},al={dataset_defaultName:"Dados",render_obsolete:"Renderizar obsoletos",data_truncation:"Os dados exibidos foram limitados.",tuple_truncation:"O campo {0} est mostrando {1} de {2} valores.",datapoint_truncation:"Os dados foram limitados a {0} linhas.",duplicate_truncation:"Pontos de dados no agregados no so suportados por essa visualizao. Somente os primeiros valores sero exibidos."},ll={dataset_defaultName:"",render_obsolete:"",data_truncation:"",tuple_truncation:"{0}  {1}  {2} ",datapoint_truncation:" {0} ",duplicate_truncation:""},ul={dataset_defaultName:"",render_obsolete:"",data_truncation:"",tuple_truncation:"{0}  {1} of {2} ",datapoint_truncation:" {0} ",duplicate_truncation:""},cl={dataset_defaultName:"",render_obsolete:"",data_truncation:"",tuple_truncation:"{0}  {1} of {2} ",datapoint_truncation:" {0} ",duplicate_truncation:""},pl={dataset_defaultName:"",render_obsolete:"",data_truncation:"",tuple_truncation:"{0}  {1}  {2} ",datapoint_truncation:" {0} ",duplicate_truncation:""},hl={dataset_defaultName:"",render_obsolete:"",data_truncation:"",tuple_truncation:"{0}  {1} of {2} ",datapoint_truncation:" {0} ",duplicate_truncation:""};const dl=Object.freeze(Object.assign({virtual_item:"",virtual_value:""},Aa)),fl=new Map;fl.set("cs",Object.freeze(Object.assign({},dl,La))),fl.set("da",Object.freeze(Object.assign({},dl,za))),fl.set("de",Object.freeze(Object.assign({},dl,Na))),fl.set("es",Object.freeze(Object.assign({},dl,Ma))),fl.set("fi",Object.freeze(Object.assign({},dl,Fa))),fl.set("fr",Object.freeze(Object.assign({},dl,$a))),fl.set("he",Object.freeze(Object.assign({},dl,qa))),fl.set("hr",Object.freeze(Object.assign({},dl,Ba))),fl.set("hu",Object.freeze(Object.assign({},dl,Ha))),fl.set("it",Object.freeze(Object.assign({},dl,Ga))),fl.set("ja",Object.freeze(Object.assign({},dl,Ua))),fl.set("kk",Object.freeze(Object.assign({},dl,Wa))),fl.set("ko",Object.freeze(Object.assign({},dl,Ka))),fl.set("nb",Object.freeze(Object.assign({},dl,Xa))),fl.set("nl",Object.freeze(Object.assign({},dl,Ja))),fl.set("no",Object.freeze(Object.assign({},dl,Qa))),fl.set("pl",Object.freeze(Object.assign({},dl,Ya))),fl.set("pt",Object.freeze(Object.assign({},dl,Za))),fl.set("ro",Object.freeze(Object.assign({},dl,el))),fl.set("ru",Object.freeze(Object.assign({},dl,tl))),fl.set("sl",Object.freeze(Object.assign({},dl,rl))),fl.set("sv",Object.freeze(Object.assign({},dl,nl))),fl.set("th",Object.freeze(Object.assign({},dl,sl))),fl.set("tr",Object.freeze(Object.assign({},dl,il))),fl.set("zh",Object.freeze(Object.assign({},dl,ol))),fl.set("pt-br",Object.freeze(Object.assign({},dl,Za,al))),fl.set("zh-cn",Object.freeze(Object.assign({},dl,ol,ll))),fl.set("zh-hk",Object.freeze(Object.assign({},dl,ol,ul))),fl.set("zh-mo",Object.freeze(Object.assign({},dl,ol,cl))),fl.set("zh-sg",Object.freeze(Object.assign({},dl,ol,pl))),fl.set("zh-tw",Object.freeze(Object.assign({},dl,ol,hl)));const gl=/^\$nls\.([^\s]+)/,ml=Object.prototype.hasOwnProperty;class VizBundleNls{constructor(){Object.defineProperties(this,{_bundles:{value:[]}})}addBundle(e){return e&&this._bundles.indexOf(e)<0&&this._bundles.push(e),this}resolve(e){return w(e)?null:e.replace(gl,((e,t)=>this.has(t)?this.get(t):t))}has(e){for(let t=this._bundles.length-1;t>=0;--t)if(ml.call(this._bundles[t],e))return!0;return!1}get(e){for(let t=this._bundles.length-1;t>=0;--t){const r=this._bundles[t];if(ml.call(r,e))return r[e]}throw new RangeError(`No nls with key "${e}"`)}}function yl(e,t,r){for(let n=0;n<t.length;++n){const s=t[n].name;s&&e.set(s,r[n])}}class LoadedService{constructor(e,t){Object.defineProperties(this,{resources:{enumerable:!0,value:e},ctor:{enumerable:!0,value:t}})}}class ServiceLoader{constructor(e,t,r){Object.defineProperties(this,{serviceDescription:{enumerable:!0,value:e},_resLoader:{value:t},_locale:{value:r},_promise:{writable:!0,value:null}})}load(){return this._promise||(this._promise=this._load()),this._promise}_load(){return pn(this,void 0,void 0,(function*(){const e=[],r=[];for(const t of this.serviceDescription.dependencies)(t.preload?e:r).push(t);const n=yield Promise.all(e.map(this._loadDependency,this)),s=yield this._resLoader.load(this._locale,this.serviceDescription.classPath,t.ResourceType.JavaScript),i=yield Promise.all(r.map(this._loadDependency,this)),o=new Map;return yl(o,e,n),yl(o,r,i),new LoadedService(o,s)}))}_loadDependency(e){return this._resLoader.load(this._locale,e.resource,e.type)}}const vl=Object.freeze({responseType:"document"});let bl=null;const wl=Xr&&Xr.require||Scope.getFor(global,!0).require;class VizBundleEntry{constructor(e,t,r,n,s,i){Object.defineProperties(this,{id:{enumerable:!0,value:e},location:{enumerable:!0,value:t},userConfig:{enumerable:!0,value:UserConfig.fromConfig(r)},fileName:{enumerable:!0,value:n},userData:{enumerable:!0,value:s},_bundles:{value:new Map},_logger:{value:i},_manifestPromise:{writable:!0,value:null},_manifestAmd:{writable:!0,value:null},_resLoader:{writable:!0,value:null}})}load(e=Yr){if("string"!=typeof e)throw new TypeError(`${e} is not a valid locale`);const t=this._bundles;let r=t.get(e);return r||(t.set(e,r=this._loadManifest().then(this._loadBundle.bind(this,e))),r.catch((function(){t.delete(e)}))),r}unload(){this._manifestPromise=null,this._manifestAmd&&(wl.undef(this._manifestAmd),wl.undef(`text!${this._manifestAmd}`),this._manifestAmd=null),this._resLoader&&(this._resLoader.unload(),this._resLoader=null),this._bundles.clear()}_loadManifest(){if(this._manifestPromise)return this._manifestPromise;const e=ji(this.location,this.fileName);let t;return ki(e,!0)?(this._manifestAmd=e,t=new Promise((function(t,r){wl([`text!${e}`],(function(e){try{t(di(e))}catch(e){r(e)}}),r)}))):t=Sr(e,vl).then((function(e){return e.ok?e.response:null})),this._manifestPromise=t.then((e=>{if(!e)throw new Error("Failed to load manifest");let t;try{t=Manifest.fromXmlDocument(e)}catch(e){throw new Error("Invalid manifest file")}const r=t.getModuleFormat()||"amd";let n=this.location;if("amd"===r){const e=t.getContext()||t.getSymbolicName()||this.id,r=ki(this.location,!0);r&&(s=wl.toUrl(this.location),n=s.replace(Ti,"$1$2"));let i=null;return t.getAmdPath()?i=t.getAmdPath():r&&(i=this.location),function(){return pn(this,void 0,void 0,(function*(){return bl||(bl=Scope.sandbox("vipr-amd")),bl}))}().then((r=>{var s;return i||(s=this.location,i=s?Ti.exec(s)[2]:"",0===i.lastIndexOf("/",0)&&(i=i.substring(1)),i||(i=t.getSymbolicName())),this._resLoader=new ResourceLoaderAmd(this.location,t,r,e,i,n),t}))}throw"esm"===r?new Error("ES Modules are not supported by this version of VIPR"):new TypeError(`Invalid module format: ${r}, expected amd or esm`);var s})),this._manifestPromise.catch((()=>{this.unload()})),this._manifestPromise}_loadBundle(e,r){return pn(this,void 0,void 0,(function*(){const n=r.getServiceDescription();if(!n)throw new Error("VizBundle's manifest doesn't contain a service with a supported language and apiVersion.");if(!this._resLoader)throw new Error("Internal error: ResourceLoader unavailable");const s=this._resLoader,i=function(e){const t=e.toLowerCase();let r;for(let e=t.length;e>=0&&!r;e=t.lastIndexOf("-",e-1))r=fl.get(t.substring(0,e));return r||dl}(e),o=new VizBundleNls;o.addBundle(i);const a=r.getNls();if(a.length>0){(yield Promise.all(a.map((function(r){return s.load(e,r,t.ResourceType.Nls)}),this))).forEach(o.addBundle,o)}const l=yield s.load(e,r.getServiceDefinition(),t.ResourceType.Xml);if(!l)throw new Error("Invalid vizdef file");const u=VizDefParser.fromXmlDocument(l,i,o,this._logger),c=this.userConfig.applyTo(u,this._logger);return new VizBundle(this.id,this.location,e,this.userConfig,this.userData,new ServiceLoader(n,s,e),s,c,c,i,o,this._logger)}))}}class VizExtendedValueProperty extends ValuePropertyAdapter{constructor(e,t){super(e),Object.defineProperties(this,{_parser:{writable:!0,value:t}})}getType(){return this.type}_parseHost(e,t,r){return this._parser?this._parser.parseValue(e,t,r):e}}class VizExtendedBooleanProperty extends VizExtendedValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return e}}Object.defineProperty(VizExtendedBooleanProperty.prototype,"type",{enumerable:!0,value:t.PropertyType.Boolean});class VizExtendedColorProperty extends VizExtendedValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return Color.fromHost(e)}}Object.defineProperty(VizExtendedColorProperty.prototype,"type",{enumerable:!0,value:t.PropertyType.Color});class VizExtendedEnumProperty extends VizExtendedValueProperty{constructor(e,t){super(e,t)}get possibleValues(){return Ie(this).getPossibleValuesLocked()}getPossibleValues(){return Ie(this).getPossibleValuesLocked()}setPossibleValues(e,t=null){let r=v,n=null;return e&&(r=Object.freeze(Array.from(e,(function(e){const r=EnumValue.fromHost(e);return(t===e||"string"==typeof t&&r.name===t)&&(n=r),r})))),Ie(this).setPossibleValues(r,n)}peekPossibleValues(){return Ie(this).getPossibleValues()}_normalize(e){return e}_parseRenderer(e){return Ie(this).parse(null==e?void 0:e.getName())}}Object.defineProperty(VizExtendedEnumProperty.prototype,"type",{enumerable:!0,value:t.PropertyType.Enum});class VizExtendedFontProperty extends VizExtendedValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return Font.fromHost(e)}}Object.defineProperty(VizExtendedFontProperty.prototype,"type",{enumerable:!0,value:t.PropertyType.Font});class VizExtendedNumberProperty extends VizExtendedValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return e}}Object.defineProperty(VizExtendedNumberProperty.prototype,"type",{enumerable:!0,value:t.PropertyType.Number});class VizExtendedLengthProperty extends VizExtendedValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return Length.fromHost(e)}}Object.defineProperty(VizExtendedLengthProperty.prototype,"type",{enumerable:!0,value:t.PropertyType.Length});class VizExtendedStringProperty extends VizExtendedValueProperty{constructor(e,t){super(e,t)}_normalize(e){return e}_parseRenderer(e){return e}}Object.defineProperty(VizExtendedStringProperty.prototype,"type",{enumerable:!0,value:t.PropertyType.String});class VizExtendedPaletteProperty extends VizExtendedValueProperty{constructor(e,t){super(e,t)}get paletteType(){return this.getPaletteType()}get slot(){return this.getSlot()}getPaletteType(){return Ie(this).def.paletteType}getSlot(){const e=Ie(this).def.slot;return e&&e.name}_normalize(e){return e}_parseRenderer(e){return e}}Object.defineProperty(VizExtendedPaletteProperty.prototype,"type",{enumerable:!0,value:t.PropertyType.Palette});class VizExtendedCatPaletteProperty extends VizExtendedPaletteProperty{getColor(e,t,r){if(!this._value)throw new Error("Cannot resolve color, resolver is null");return this._value.getColor(e,t,r)}getDefaultColor(e){if(!this._value)throw new Error("Cannot resolve default color, resolver is null");return this._value.getDefaultColor(e)}}class VizExtendedContPaletteProperty extends VizExtendedPaletteProperty{getColorStops(e,t){if(!this._value)throw new Error("Cannot resolve color stops, resolver is null");return this._value.getColorStops(e,t)}}class VizExtendedCustomCatPaletteProperty extends VizExtendedPaletteProperty{getColor(e,t,r){if(!this._value)throw new Error("Cannot resolve color, resolver is null");return this._value.getColor(e,t,r)}}class VizExtendedCustomContPaletteProperty extends VizExtendedPaletteProperty{getColorStops(e){if(!this._value)throw new Error("Cannot resolve color stops, resolver is null");return this._value.getColorStops(e)}}class VizExtendedDeprecatedProperty extends DeprecatedAdapter{constructor(e,t,r,n){super(e,t),Object.defineProperties(this,{_rsProperties:{value:r},_api:{value:n}})}_resolveView(e){return this._rsProperties.get(e)}_setValue(e,t){this._api.setValue(this._rsProperties,e,t)}_evaluate(e){return this._api.evaluate(this._rsProperties,e)}}function _l(e,r){const n=r&&r.parser(e.def.name);switch(e.def.type){case t.PropertyType.Boolean:return new VizExtendedBooleanProperty(e,n);case t.PropertyType.Color:return new VizExtendedColorProperty(e,n);case t.PropertyType.Enum:return new VizExtendedEnumProperty(e,n);case t.PropertyType.Font:return new VizExtendedFontProperty(e,n);case t.PropertyType.Length:return new VizExtendedLengthProperty(e,n);case t.PropertyType.Number:return new VizExtendedNumberProperty(e,n);case t.PropertyType.String:return new VizExtendedStringProperty(e,n);case t.PropertyType.Palette:return function(e,r){switch(e.def.paletteType){case t.PaletteType.Cat:return new VizExtendedCatPaletteProperty(e,r);case t.PaletteType.Cont:return new VizExtendedContPaletteProperty(e,r);case t.PaletteType.CustomCat:return new VizExtendedCustomCatPaletteProperty(e,r);case t.PaletteType.CustomCont:return new VizExtendedCustomContPaletteProperty(e,r);default:throw new Error(`Unhandled palette type: ${e.def.paletteType}`)}}(e,n);default:throw new Error(`Unhandled property type: ${e.def.type}`)}}function Pl(e,t,r,n){for(const s of r)if(ys(s))Pl(e,t,s.properties,n);else if(An(s)){const r=_l(s,n);e.push(r),t.set(s.def.name,r);for(const e of s.def.aliases)t.set(e,r)}}class VizExtendedProperties{constructor(e,t){const r=[],n=new Map;Pl(r,n,e.properties,t),Pl(r,n,e.configuration,t),Object.defineProperties(this,{_values:{value:Object.freeze(r)},_map:{value:Object.freeze(n)}}),r.forEach((r=>{const n=Ie(r);let s=null;t&&n.def.deprecated&&(s=t.deprecated(n.def.name)||null),n.init(r,s&&new VizExtendedDeprecatedProperty(e.toHost(),r,this,s))}))}[Symbol.iterator](){return this._map.values()}has(e){return this._map.has(e)}_getTyped(e,t){const r=this._map.get(e);if(!r)throw new RangeError(`There is no "${e}" property`);if(t&&r.getType()!==t)throw new TypeError(`Property "${e}" is not a ${t} property`);return r}_getPaletteTyped(e,r){const n=this._getTyped(e,t.PropertyType.Palette);if(n.paletteType!==r)throw new TypeError(`Palette "${e}" is not a ${r} palette`);return n}get(e){return this._getTyped(e,null)}forEach(e,t){for(const r of this._values)e.call(t,r,r.name,this)}getBoolean(e){return this._getTyped(e,t.PropertyType.Boolean)}getColor(e){return this._getTyped(e,t.PropertyType.Color)}getEnum(e){return this._getTyped(e,t.PropertyType.Enum)}getFont(e){return this._getTyped(e,t.PropertyType.Font)}getLength(e){return this._getTyped(e,t.PropertyType.Length)}getNumber(e){return this._getTyped(e,t.PropertyType.Number)}getString(e){return this._getTyped(e,t.PropertyType.String)}getCatPalette(e){return this._getPaletteTyped(e,t.PaletteType.Cat)}getContPalette(e){return this._getPaletteTyped(e,t.PaletteType.Cont)}getCustomCatPalette(e){return this._getPaletteTyped(e,t.PaletteType.CustomCat)}getCustomContPalette(e){return this._getPaletteTyped(e,t.PaletteType.CustomCont)}}class VizExtendedPropertiesController extends Destroyable{constructor(e,t){super(),Oe(this,e),this._visualItems=e.getVisualItems(),Object.defineProperties(this,{_host:{value:e.toHost()},_renderer:{value:new VizExtendedProperties(e,t)}})}getVisualItems(){return this._visualItems}_destroy(){super._destroy(),Ie(this).destroy(),Re(this)}getHostView(){return this._host}getRenderView(){return this._renderer}lock(){Ie(this).lock()}unlock(e){Ie(this).unlock(e)}update(e){Ie(this).updateDefs(e.properties,e.configuration)}}class VIPR{constructor(){Object.defineProperties(this,{_logScope:{value:new LogScope},_entries:{value:new Map},_cachedIds:{writable:!0,value:null}})}static create(e){const t=new VIPR;return e&&e.bundles&&Array.prototype.forEach.call(e.bundles,t._register,t),t}static applyUserConfig(e,t){return UserConfig.fromConfig(t).applyTo(e)}static createExtendedProperties(e,t=null){return new VizExtendedPropertiesController(Properties.create(e),t)}register(e,t,r,n,s){if("string"==typeof e){if("string"!=typeof t)throw new TypeError("A location is required");return this._register({id:e,location:t,config:r,fileName:n,userData:s})}this._register(e)}_register(e){if(!e.id)throw new Error(`Invalid vizbundle id "${e}" specified`);if(this._entries.has(e.id))throw new Error(`The VizBundle id "${e}" is already registered.`);let t=e.fileName;const r=e.location.replace(/(?:^|\/)([^\/\\\r\n]+\.[xX][mM][lL](?:[\?#][^\r\n]*)?)?$/,(function(e,r){if(r)if(t){if(t!==r)throw new Error("The location contains a fileName which does not match the specified fileName")}else t=r;return""}));t||(t="manifest.xml");const n=new VizBundleEntry(e.id,r,e.config,t,e.userData||e,new Logger(this._logScope,e.id));this._entries.set(n.id,n),this._cachedIds&&(this._cachedIds=null)}unregister(e){if(!e)throw new Error(`Invalid vizbundle id "${e}" specified`);const t=this._entries.get(e);return!!t&&(t.unload(),this._entries.delete(e),this._cachedIds&&(this._cachedIds=null),!0)}isRegistered(e){return this._entries.has(e)}get bundleIds(){return this.getBundleIds()}getBundleIds(){return this._cachedIds||(this._cachedIds=Object.freeze(Array.from(this._entries.keys()))),this._cachedIds}load(e,t){const r=this._entries.get(e);return r?r.load(t):Promise.reject(new Error(`There is no VizBundle with id "${e}" registered.`))}unload(e){const t=this._entries.get(e);return!!t&&(t.unload(),!0)}loadAll(e){return Promise.all(this.getBundleIds().map((function(t){return this.load(t,e)}),this))}newViz(e,t,r,n,s,i){return this.load(e).then((function(e){return e.create(r,n,s,i)}))}addAppender(e){return this._logScope.add(e)}removeAppender(e){return this._logScope.remove(e)}getLogger(e){return new Logger(this._logScope,e)}}t.BooleanPropertyDef=BooleanPropertyDef,t.CapabilityDef=CapabilityDef,t.CatPaletteBase=CatPaletteBase,t.CatPaletteResolver=CatPaletteResolver,t.Color=Color,t.ColorPropertyDef=ColorPropertyDef,t.ColorStop=ColorStop,t.ConsoleAppender=ConsoleAppender,t.ContPaletteBase=ContPaletteBase,t.ContPaletteResolver=ContPaletteResolver,t.ContPaletteStops=ContPaletteStops,t.CustomCatPaletteResolver=CustomCatPaletteResolver,t.CustomContPaletteResolver=CustomContPaletteResolver,t.DataSetDef=DataSetDef,t.DecorationDef=DecorationDef,t.EnumPropertyDef=EnumPropertyDef,t.EnumValue=EnumValue,t.Font=Font,t.FontPropertyDef=FontPropertyDef,t.GeoSegmentDef=GeoSegmentDef,t.GeoSegmentRef=GeoSegmentRef,t.GeoSlotDef=GeoSlotDef,t.GeoSlotRef=GeoSlotRef,t.GroupPropertyDef=GroupPropertyDef,t.Length=Length,t.LengthPropertyDef=LengthPropertyDef,t.LimitTruncation=LimitTruncation,t.MergedProperties=class MergedProperties{constructor(){const e=new MergedPropertiesController;Oe(this,e),Object.defineProperties(this,{view:{enumerable:!0,value:e.host}})}add(e){Ie(this).add(e)}remove(e){Ie(this).remove(e)}update(e){Ie(this).update(e)}destroy(){Ie(this).destroy()}},t.MetaDataEntryDef=MetaDataEntryDef,t.NumberPropertyDef=NumberPropertyDef,t.PaletteBase=PaletteBase,t.PalettePropertyDef=PalettePropertyDef,t.PropertyDef=PropertyDef,t.RenderMessage=RenderMessage,t.RenderQueue=RenderQueue,t.SlotDef=SlotDef,t.SlotGroupDef=SlotGroupDef,t.SlotRef=SlotRef,t.StringPropertyDef=StringPropertyDef,t.TemporalAttributeDef=TemporalAttributeDef,t.TemporalSlotDef=TemporalSlotDef,t.TemporalSlotRef=TemporalSlotRef,t.TestAccess=class TestAccess{static getRenderer(e){return VizServiceImpl.getRendererForTest(e)}static getHostApi(e){return VizServiceImpl.getHostApiForTest(e)}},t.Truncation=Truncation,t.TruncationInfo=TruncationInfo,t.UnaggregatedTruncation=UnaggregatedTruncation,t.VIPR=VIPR,t.ValuePropertyDef=ValuePropertyDef,t.VisualItemInfo=VisualItemInfo,t.VizDef=VizDef,t.nls=nn}));
//# sourceMappingURL=vipr.bundle.js.map
