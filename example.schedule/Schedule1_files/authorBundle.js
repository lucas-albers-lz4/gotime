/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Dashboard
 * (C) Copyright IBM Corp. 2016, 2021
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _extends=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var o in i)Object.prototype.hasOwnProperty.call(i,o)&&(e[o]=i[o])}return e};define("dashboard-core/js/dashboard/layout/authoring/views/feature/CommonAuthoringFeature",["jquery","underscore","../../../../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t,i){return i.extend({init:function(e){this.layoutView=e,this._events=[this.layoutView.content.on("add:child",this.onContentAddItem,this),this.layoutView.model.on("add:item",this.onModelAddItem,this),this.layoutView.model.on("remove:item",this.onModelRemoveItem,this),this.layoutView.model.on("change:parent",this.onModelUpdateParent,this),this.layoutView.model.on("change:style",this.onModelUpdateStyle,this),this.layoutView.model.on("change:css",this.onModelUpdateCSS,this),this.layoutView.model.on("change:fillColor",this.onModelFillColorChange,this),this.layoutView.model.on("change:borderColor",this.onModelBorderColorChange,this)]},_isTypeRegistered:function(e){var t=this.layoutView.dashboardApi.getFeature("ContentTypeRegistry");return!!t&&t.isTypeRegistered(e)},onModelFillColorChange:function(e){e.prevValue&&this.layoutView.$el.removeClass("fill-"+e.prevValue),e.value&&this.layoutView.$el.addClass("fill-"+e.value),t.each(this.layoutView.model.findDescendantsWithType("widget"),function(t){var i=this.layoutView.layoutController.getLayoutView(t.id);i&&i.notifyWidget&&i.notifyWidget("layout:fillColorChange",{data:e.data})}.bind(this))},onModelBorderColorChange:function(e){e.prevValue&&this.layoutView.$el.removeClass("border-"+e.prevValue),e.value&&this.layoutView.$el.addClass("border-"+e.value)},onContentAddItem:function(e){var t=e.info,i=t.newContentId,o=t.parentId,n=t.value,a=n.spec.type||n.type;if(!this._isTypeRegistered(a))return Promise.resolve();var r=this.layoutView.layoutController,s=r.viewsMap[o].view,d=r.createLayoutModule(i,s,{addPayloadData:e.transactionToken});return d.then((function(e){return s.add(e,n.insertBefore),e.renderContent()})),this.layoutView.onItemAddDone&&d.then(this.layoutView.onItemAddDone.bind(this.layoutView,e)),d},onModelAddItem:function(e){var t=this;if(this._isTypeRegistered(e.value.parameter.model.type))return Promise.resolve();var i=e.value.parameter.model,o=this.layoutView.layoutController.createLayoutModule(i.id,this.layoutView,{addPayloadData:e.data});return o.then((function(i){return(i.parentLayout||t.layoutView).add(i,e.value.parameter.insertBefore,e),i.renderContent()})),this.layoutView.onItemAddDone&&o.then(this.layoutView.onItemAddDone.bind(this.layoutView,e)),o},onModelRemoveItem:function(e){var t=e.value.parameter,i=document.getElementById(this.layoutView.getNodeId(t));if(i){var o=i._layout;o&&(o.parentLayout&&o.parentLayout.removeChild(o,e),o.destroy(e))}},onModelUpdateParent:function(i){var o=i.value.parameter,n=o.parentId,a=e(this.layoutView.domNode.parentNode).hasClass("page");if(!a||!this.layoutView.parentLayout||n!==this.layoutView.parentLayout.id||void 0!==o.insertBefore){var r=e(":focus");e(this.layoutView.domNode).detach();var s=function(n){var s=o.insertBefore;if(this.layoutView.parentLayout=n,n.add(this.layoutView,s,i),!a){var d=t.extend({},this.layoutView.model.style),l=e(this.layoutView.domNode);this._updateStyleForNode(l,d)}"UndoRedoController"===i.sender&&this.layoutView.onResize(i),r.focus(),this._onModelUpdateParent&&this._onModelUpdateParent()}.bind(this),d=this.layoutView.layoutController.getLayoutView(n);d?s(d):this.layoutView.layoutController.layoutReady(n).done(s)}},onModelUpdateStyle:function(t){var i=t.value.parameter,o=e(this.layoutView.domNode);this.saveOriginalNodeDimension(),this._updateStyleForNode(o,i,t.sender),(i.height||i.width)&&!1!==t.data.triggerResize&&this.layoutView.onResize(t)},_updateStyleForNode:function(e,t,i){var o;for(var n in t)t.hasOwnProperty(n)&&"function"!=typeof t[n]&&(o=t[n],"height"!==n&&"width"!==n||(o||"UndoRedoController"!==i?o||(this._originalHeight=null,this._originalWidth=null):o=("height"===n?this._originalHeight:this._originalWidth)+"px"),e.css(n,o))},onModelUpdateCSS:function(t){var i=t.value,o=t.prevValue,n=e(this.layoutView.domNode);n.removeClass(o),n.addClass(i)},destroy:function(){if(this._events)for(var e=0;e<this._events.length;e++)this._events[e]&&this._events[e].remove();this._events=null},saveOriginalNodeDimension:function(){if(!this._originalHeight){var t=e(this.layoutView.domNode);this._originalHeight=t.height(),this._originalWidth=t.width()}},onResizeStep:function(){this.saveOriginalNodeDimension()}})})),define("dashboard-core/js/dashboard/layout/authoring/views/LayoutBaseView",["../../../../lib/@waca/core-client/js/core-client/ui/core/Class","../../../../lib/@waca/dashboard-common/dist/ui/interaction/Utils","../../LayoutHelper","jquery","underscore","./feature/CommonAuthoringFeature"],(function(e,t,i,o,n,a){var r=null;return r=e.extend({init:function(e){r.inherited("init",this,arguments),this.consumeView=e.consumeView,this.overridden={},this.added=[],this.domNode=this.consumeView.domNode,this.id=this.consumeView.id,this.layoutController=this.consumeView.layoutController,this.model=this.consumeView.model,this.getNodeId=this.consumeView.getNodeId.bind(this.consumeView),this.specializeConsumeView(["add","removeChild","onResize","onResizeStep","getWidgetPositionUpdate","getMinimumTop","getMinimumLeft","getMaximumHeight","getMaximumWidth","getPhysicalPageSize","onShow"]),this.consumeView.authorHelper=this,this.consumeView.isAuthoringMode=!0,this.commonAuthoringFeature=new a(this.consumeView),this.dashboardApi=e.dashboardApi,this.$el=o(this.domNode)},specializeConsumeView:function(e){n.each(e,function(e){this.consumeView[e]&&-1===this.added.indexOf(e)?this.overridden[e]||(this.overridden[e]=this.consumeView[e].bind(this.consumeView)):this.added.push(e),this.consumeView[e]=this[e].bind(this)}.bind(this))},restoreSpecializedFunc:function(e){this.overridden[e]&&(this.consumeView[e]=this.overridden[e])},restoreAllSpecialized:function(){for(var e in this.overridden)this.overridden.hasOwnProperty(e)&&this.restoreSpecializedFunc(e)},removeAllAddedFuncs:function(){for(var e=0;e<this.added.length;e++)this.consumeView[this.added[e]]&&(this.consumeView[this.added[e]]=null)},renderContent:function(){return this.overridden.renderContent()},onResize:function(e){this.overridden.onResize(e)},onShow:function(){this.overridden.onShow(arguments)},onResizeStep:function(){this.commonAuthoringFeature.onResizeStep()},destroy:function(){r.inherited("destroy",this,arguments),this.restoreAllSpecialized(),this.removeAllAddedFuncs(),this.commonAuthoringFeature.destroy(),this.consumeView.isAuthoringMode=!1},add:function(e,t){this.consumeView._subLayoutViews.push(e);var i=e.domNode;if(i){i.parentNode&&i.parentNode.removeChild(i);var n=t?o("#"+this.getNodeId(t),this.layoutController.$el)[0]:null;this.domNode.insertBefore(i,n)}},removeChild:function(e){this.consumeView._subLayoutViews=this.consumeView._subLayoutViews.filter((function(t){return t!==e})),e&&e.domNode&&o(e.domNode).detach()},getWidgetPositionUpdate:function(e){var i=null;if(e.node._layout){var o=e.dropPosition.before&&e.dropPosition.before._layout?e.dropPosition.before._layout.model.id:null,n=e.dropPosition.x,a=e.dropPosition.y,r=t.widgetSize(e.node),s=n+r.width,d=this.getMaximumWidth();d&&s>d&&(n=d-r.width);var l=a+r.height,h=this.getMaximumHeight();h&&l>h&&(a=h-r.height),i={style:{left:Math.max(this.getMinimumLeft(),n)+"px",top:Math.max(this.getMinimumTop(),a)+"px"},insertBefore:o,parentId:this.model.id,id:e.node._layout.model.id},e.dropPosition.height&&(i.style.height=e.dropPosition.height+"px"),e.dropPosition.width&&(i.style.width=e.dropPosition.width+"px")}return i},getMaximumWidth:function(){var e=this.getPhysicalPageSize();return e?e.width:1/0},getMaximumHeight:function(){var e=this.getPhysicalPageSize();return e?e.height:1/0},getMinimumTop:function(){var e=parseInt(this.$el.css("padding-top"),10);return isNaN(e)?0:e},getMinimumLeft:function(){var e=parseInt(this.$el.css("padding-left"),10);return isNaN(e)?0:e},_addWidget:function(e,t){var i=this,o=this.dashboardApi.getFeature("Transaction"),n=o.startTransaction(),a=e.model,r={containerId:e.parentId,type:"widget."+a.type,spec:a,properties:e.layoutProperties.style};return this.dashboardApi.getCanvas().addContent(r,n).then((function(e){return o.endTransaction(n),i.layoutController.whenWidgetRenderComplete(e.getId()).done((function(e){var o=i.layoutController.interactionController.selectionHandler;o.deselectAll(),o.selectNode(e.domNode,{isTouch:t})}))}))},_getModelToAddFromDragObject:function(e){return this.dashboardApi.getFeature("CanvasDnD").onDrop(e)},_processWidgetSpecForPin:function(e,t){if("boardFragment"===e.contentType){var i={layout:e.content.layout,widgets:e.content.widgets,dataSources:e.content.dataSources,properties:e.content.properties,sourceName:e.sourceName};e.content.drillThrough&&(i.drillThrough=e.content.drillThrough),e.content.episodes&&(i.episodes=e.content.episodes);var o={model:i,parentId:e.parentId},n=this.model.boardModel.addFragment(o,"layoutBaseView_onPinDrop",null);n&&n.value&&n.value.parameter&&n.value.parameter.model.layout&&n.value.parameter.model.layout.id&&this.layoutController.whenWidgetRenderComplete(n.value.parameter.model.layout.id).done(function(e){var i=this.layoutController.interactionController.selectionHandler;i.deselectAll(),i.selectNode(e.domNode,{isTouch:t})}.bind(this))}else this._addWidget(e,t);this.dashboardApi.getFeature("Colors").clearLocalPaletteCache()},getPhysicalPageSize:function(e,t){var i=e||this.model.getLayoutPositioning(!0);return"absolute"===i?this.model.boardModel.layout.get("pageSize"):"relative"===i?this._getRelativePhysicalPageSize(t):{width:this.domNode.offsetWidth,height:this.domNode.offsetHeight}},_getRelativePhysicalPageSize:function(e){var t=void 0,n={};if(this.$el.is(":visible"))n={width:this.$el.width(),height:this.$el.height()};else{if(!(t=o(e?i.getLayoutContentContainer(this.layoutController.topLayoutModel.id,e,this.dashboardApi):this.layoutController.getLayoutContentContainer())).length)return{width:this.domNode.offsetWidth,height:this.domNode.offsetHeight};if("relative"===t[0]._layout.model.getLayoutPositioning(!0))n={width:t.width(),height:t.height()};else{var a=t.parent(),r=this.model.boardModel.layout.get("pageSize");n={width:a.width(),height:a.width()*(r.height/r.width)}}}return n},moveToFitBoundaries:function(e,t,i){i.top+i.height>e&&(i.top=e-i.height),i.left+i.width>t&&(i.left=t-i.width)},updateModel:function(e,t){var i=this,o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e.forEach((function(e){var n=i.dashboardApi.getCanvas().getContent(e.id),a=Object.assign({},t,{validatePropertyValue:!1});Object.keys(e.style).forEach((function(t){n.setPropertyValue(t,e.style[t],a)})),a.validatePropertyValue=o,Object.keys(e.style).forEach((function(t){n.setPropertyValue(t,e.style[t],a)}))}))}})})),define("dashboard-core/js/dashboard/util/PxPercentUtil",[],(function(){var e=function(){function e(){_classCallCheck(this,e)}return e.changePixelPropertiesToPercent=function(e,i,o){var n=new t(o);this._convertUnits(e,i,n)},e.changePercentPropertiesToPixel=function(e,t){var o=new i;this._convertUnits(e,t,o)},e._convertUnits=function(e,t,i){if(!e||!t)throw new Error("Invalid options specified.");this._convertProperty(e,"height",t.height,i),"100%"===e.height?e.top="0%":this._convertProperty(e,"top",t.height,i),this._convertProperty(e,"width",t.width,i),"100%"===e.width?e.left="0%":this._convertProperty(e,"left",t.width,i),this._convertProperty(e,"bottom",t.height,i,!1),this._convertProperty(e,"right",t.width,i,!1)},e._convertProperty=function(e,t,i,o){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4];e&&e[t]&&(e[t]=o.convertValue(e[t],i,n))},e}(),t=function(){function e(t){_classCallCheck(this,e),this.decimalPlaces=t}return e.prototype.convertValue=function(e,t,i){var o=e;if(e&&e.indexOf&&-1!==e.indexOf("px")){var n=100*parseFloat(e)/t;i&&(n=100-n),(o=this.decimalPlaces?Number(n.toFixed(this.decimalPlaces)):n)>100&&(o=100),o+="%"}return o},e}(),i=function(){function e(){_classCallCheck(this,e)}return e.prototype.convertValue=function(e,t,i){var o=e;if(e&&e.indexOf&&-1!==e.indexOf("%")){var n=parseFloat(e);o=i&&0===n?t:Math.round(t*n/100),o+="px"}return o},e}();return e})),define("dashboard-core/js/dashboard/layout/authoring/views/Absolute",["./LayoutBaseView","jquery","underscore","../../../../lib/@waca/core-client/js/core-client/utils/Deferred","../../LayoutHelper","../../../util/PxPercentUtil","../../../glass/util/InstrumentationUtil"],(function(e,t,i,o,n,a,r){var s=null;return s=e.extend({init:function(e){s.inherited("init",this,arguments),this.layoutController.topLayoutModel&&(this.layoutController.topLayoutModel.on("change:showGrid",this.renderGrid,this),this.layoutController.topLayoutModel.on("change:fitPage",this.renderGrid,this),this.layoutController.topLayoutModel.on("change:pageSize",this.onPageSize,this)),this.services=e.services,this._templateHelper=e.templateHelper,this.whenIsReadyDfd=new o,this.specializeConsumeView(["setPreferredLocation"]),this._initialize()},createDropZone:function(){var e=this;this._dropTarget=this._dndManager.addDropTarget(this.domNode,{accepts:this.accepts.bind(this),onDrop:this.onDrop.bind(this),onDragLeave:this.onDragLeave.bind(this),onDragEnd:this.onDragEnd.bind(this),onDragMove:this.onDragMove.bind(this),priority:-100,info:function(t,i){return e._getCoordsRelativeToTarget(t,i)},type:"dropOnCanvas"}),this._dropHandler=this._dndManager.registerDropHandler({accepts:function(e,t){return e.type.match(/content\..*/)&&"dropOnCanvas"===t.type},onDrop:function(t,i){e.onContentDrop(t,i)}})},_getCoordsRelativeToTarget:function(e,i){var o=t(e).offset();return{top:Math.round(i.pageY-o.top+e.scrollTop),left:Math.round(i.pageX-o.left+e.scrollLeft)}},onContentDrop:function(e,t){var i=JSON.parse(JSON.stringify(e.data)),o=i.spec.style||{};if(t&&t.info){var a={width:o.width,height:o.height,top:t.info.top,left:t.info.left};return this._stylePxToInt(a),this._setStyleWithinBounds(a),n.styleIntToPx(a),o.width=a.width,o.height=a.height,o.left=a.left,o.top=a.top,i.spec.style=o,this.dashboardApi.getFeature("Canvas").addContent(i)}this.clearDragState()},onShow:function(){s.inherited("onShow",this,arguments),this.renderGrid()},whenIsReady:function(){return this.whenIsReadyDfd.promise},destroy:function(){this._dropTarget&&(this._dropTarget.remove(),this._dropTarget=null),this._dropHandler&&(this._dropHandler.deregister(),this._dropHandler=null),this._dndManager=null,t.glassdnd&&t.glassdnd.cancelDroppable&&t.glassdnd.cancelDroppable(this.$el),this.$el.find(".absoluteLayoutGrid").remove(),this.layoutController.topLayoutModel.off("change:showGrid",this.renderGrid,this),this.layoutController.topLayoutModel.off("change:pageSize",this.onPageSize,this),s.inherited("destroy",this,arguments)},removeChild:function(){s.inherited("removeChild",this,arguments)},_initialize:function(){this._dndManager=this.dashboardApi.getFeature("DashboardDnd.internal"),this.whenIsReadyDfd.resolve(),this.createDropZone()},_getDragPositionRelativeToTarget:function(e,i){var o=t(i).offset();return{top:Math.round(e.position.y-o.top+i.scrollTop),left:Math.round(e.position.x-o.left+i.scrollLeft)}},_getDragBoxForNewDrop:function(e,t){var i=this._getDragObjectDimensions(e),o=this._getDragPositionRelativeToTarget(e,t),n={top:o.top,left:o.left,ids:[]};return n.right=n.left+parseInt(i.width,10),n.bottom=n.top+parseInt(i.height,10),n.center_x=(n.left+n.right)/2,n.center_y=(n.top+n.bottom)/2,n},_getDragObjectDimensions:function(e){var i=e.data.layoutProperties&&e.data.layoutProperties.style||{},o=t(e.avatar);return 0===o.length&&(o=t(".avatar")),{width:i.width||o.width()||"10px",height:i.height||o.height()||"10px"}},_getDragBox:function(e){var i=e.reduce((function(e,i){var o,n,a,r,s=t(i.node);return i.dropPosition?(o=i.dropPosition.y,n=i.dropPosition.x,a=o+s.outerHeight(),r=n+s.outerWidth()):(o=1/0,n=1/0,a=0,r=0),e.top=Math.min(e.top,o),e.left=Math.min(e.left,n),e.bottom=Math.max(e.bottom,a),e.right=Math.max(e.right,r),e.ids.push(i.node.id),e}),{top:1/0,left:1/0,bottom:0,right:0,ids:[]});return i.center_x=(i.left+i.right)/2,i.center_y=(i.top+i.bottom)/2,i},accepts:function(e){return this.dashboardApi.getFeature("CanvasDnD").accepts(e,{fromCanvas:!0})},onDragMove:function(e,t){this.$el.addClass("layoutDragInProgress");var i=e.data&&e.data.nodeInfoList;i&&i.length?e.dragBox=this._getDragBox(i):e.dragBox=this._getDragBoxForNewDrop(e,t),this.adjustScrollPosition(e)},_moveDrop:function(e){for(var t,o,n=[],a=0,r=e.data.nodeInfoList.length;a<r;a++)t=e.data.nodeInfoList[a],(o=this.getWidgetPositionUpdate(t))&&n.push(o);var s=this.dashboardApi.getFeature("Transaction"),d=s.startTransaction(),l=n.map((function(e){return e.id})),h={};i.reduce(n,(function(e,t){return t.insertBefore&&(e[t.id]=t.insertBefore),e}),h),this.dashboardApi.getCanvas().moveContent(this.model.id,l,d,h),this.updateModel(n,d),s.endTransaction(d)},_newDrop:function(e,i,o){var a=this,s=e.data.layoutProperties||{},d=t(i).offset();return i&&d?this._getModelToAddFromDragObject(e).then((function(t){if(t){s.style||(s.style={});var d=a._getDragPositionRelativeToTarget(e,i),l={width:s.style.width,height:s.style.height,top:d.top,left:d.left};a._stylePxToInt(l),a._setStyleWithinBounds(l),n.styleIntToPx(l),s.style.width=l.width,s.style.height=l.height,s.style.left=l.left,s.style.top=l.top;var h={parentId:a.id,model:t,layoutProperties:s};o&&r.trackWidget("created",a.dashboardApi,h.model),a._addWidget(h,e.isTouch)}})):Promise.resolve()},_onPinDrop:function(e){var t=e.data.pinSpec,i=e.isTouch,o=e.position.x,n=e.position.y,a=Math.round(n-this.$el.offset().top)+"px",r=Math.round(o-this.$el.offset().left)+"px";"boardFragment"===t.contentType&&(t.content.layout.style=this._getWidgetStyleWithDimensions(t.content.layout.style),t.content.layout.style.top=a,t.content.layout.style.left=r,this._resizeToFitBoundaries(this.consumeView.getMaximumHeight(),this.consumeView.getMaximumWidth(),t.content.layout.style)),t.parentId=this.id,this._processWidgetSpecForPin(t,i)},_resizeToFitBoundaries:function(e,t,i){var o=parseInt(i.height,10),n=e/o,a=parseInt(i.width,10),r=t/a;if(r<1||n<1){var s=Math.min(r,n),d=Math.round(o*s),l=Math.round(a*s),h=Math.round((e-d)/2),c=Math.round((t-l)/2);o+h>e&&(h=Math.max(0,e-o)),a+c>t&&(c=Math.max(0,t-a)),i.height=d+"px",i.width=l+"px",i.top=h+"px",i.left=c+"px"}},onDrop:function(e,t){var i=this;return(e.data||t?"move"===e.data.operation?Promise.resolve(this._moveDrop(e)):"pin"===e.type&&"new"===e.data.operation?Promise.resolve(this._onPinDrop(e)):this._newDrop(e,t,!0):this._newDrop(e.originalEvent,e.targetNode)).then((function(){return i.clearDragState()}))},onDragLeave:function(){this.clearDragState(!0)},onDragEnd:function(){this.clearDragState(),this.previousDragBox=null},clearDragState:function(){this.$el.removeClass("layoutDragInProgress")},_changePercentModelToPixel:function(e){var i=this.$el;i.is(":visible")||(i=t(this.layoutController.getLastVisiblePage()));var o={width:i.width(),height:i.height()};a.changePercentPropertiesToPixel(e,o)},setPreferredLocation:function(e){var t=!1;if(this._templateHelper&&!e.layoutProperties.style&&(t=this._templateHelper.setPreferredLocation(e)),!t){var i=e.layoutProperties;i.style||(i.style={});var o=this._getWidgetStyleWithDimensions(i.style);-1===o.width.indexOf("%")&&-1===o.height.indexOf("%")||this._changePercentModelToPixel(o);var n=parseInt(o.width,10),a=parseInt(o.height,10),r=i.style.top||i.style.left?null:this.findAvailableSpace({width:n,height:a});r&&(i.style.top=r.top+"px",i.style.left=r.left+"px",i.style.width=i.style.width||(r.width||n)+"px",i.style.height=i.style.height||(r.height||a)+"px"),e.parentId=this.model.id}},_getWidgetStyleWithDimensions:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={width:e.width||"300px",height:e.height||"300px"};return _extends({},e,t)},getWidgetContainerNode:function(){return this.domNode},findAvailableSpace:function(e){var t,i,o,n=this.getChildrenRectList(),a=n.slice(0).sort((function(e,t){return e.height-t.height==0?e.top-t.top==0?e.left-t.left:e.top-t.top:e.height-t.height})),r={top:0,left:0};for(t=0,i=a.length;t<i&&(o=a[t],!(r=this.findSpaceAdjacentToBottomBorder(o,e,n)));t++);var s={width:e.width,height:e.height,top:r.top,left:r.left};return this._setStyleWithinBounds(s),r.top=s.top,r.left=s.left,r.width=s.width,r.height=s.height,r},_setStyleWithinBounds:function(e){var t=this.consumeView.getMaximumWidth(),i=this.consumeView.getMaximumHeight();isFinite(i)&&isFinite(t)&&(this._resizeToFitBoundaries(i,t,e),this._stylePxToInt(e),e.width||e.height||(i>t?(e.width=Math.floor(.5*t),e.height=Math.floor(3*e.width/4)):(e.height=Math.floor(.5*i),e.width=Math.floor(4*e.height/3))),this.moveToFitBoundaries(i,t,e))},_stylePxToInt:function(e){for(var t in e)if(e.hasOwnProperty(t)){var i=e[t];i&&(e[t]=parseInt(i,10))}},findSpaceAdjacentToBottomBorder:function(e,t,o){var n=i.filter(o,(function(i){return i!==e&&e.top+e.height<i.top+i.height&&e.top+e.height+t.height+5>i.top&&i.left<=e.left+e.width+t.width+5&&i.left+i.width>=e.left-t.width}));return 0===n.length?{top:e.top+e.height+5,left:e.left}:this.findSpaceBetweenRectangles(e,n,t)},findSpaceBetweenRectangles:function(e,i,o){var n=o.width+5;i.sort((function(e,t){return e.left-t.left}));var a=e.top+e.height+5,r=i[0];if(r.left>e.left&&r.left>=n&&r.left-n>e.left-n)return{top:a,left:Math.min(e.left,r.left-n)};for(var s,d,l=t(this.getWidgetContainerNode()).width(),h=0;h<i.length;h++)if(s=i[h],(d=i[h+1])&&s.left+s.width>d.left+d.width)i[h+1]=s;else{var c=d?d.left:l;if(s.left+s.width+n<=c&&e.left+e.width+n>s.left+s.width+n)return{top:a,left:s.left+s.width+5}}return null},getChildrenRectList:function(){var e=[];e.push({top:0,left:0,height:this.getMinimumTop()-5,width:Math.round(t(this.getWidgetContainerNode()).width())}),e.push({top:0,left:0,height:Math.round(t(this.getWidgetContainerNode()).height()),width:this.getMinimumLeft()-5});var i,o,n=t(this.getWidgetContainerNode()).children().not(".relativeLayoutGrid, .absoluteLayoutGrid, .pagetemplateIndicator, .pagetemplateDropZone, .sizeDashboardIndicatorContainer");for(i=0,o=n.length;i<o;i++){var a=t(n[i]);e.push({top:a[0].offsetTop,left:a[0].offsetLeft,height:a.outerHeight(),width:a.outerWidth()})}return e},adjustScrollPosition:function(e){var t=e.dragBox,i=this.getScrollInfo(e);this.scrollToDragBox(t,i)},getScrollInfo:function(e){var t=e.dragBox,i=this.getScrollAreaNode(),o={h:i.height(),w:i.width(),scrollTop:i.scrollTop(),scrollLeft:i.scrollLeft(),$node:i,direction:[]};return this.previousDragBox&&(t.left!==this.previousDragBox.left&&(o.direction[t.left-this.previousDragBox.left>0?"right":"left"]=!0),t.top!==this.previousDragBox.top&&(o.direction[t.top-this.previousDragBox.top>0?"bottom":"top"]=!0)),this.previousDragBox=t,o},getScrollAreaNode:function(){for(var e=this.$el.parents(".page"),t=this.$el,i=0;t&&t.length&&"auto"!==t.css("overflow");)t=e.eq(i),i++;return 0===t.length&&(t=this.$el),t},scrollToDragBox:function(e,t){e.bottom>t.scrollTop+t.h&&t.direction.bottom?t.$node.scrollTop(t.scrollTop+16):t.scrollTop>e.top-2&&t.direction.top&&t.$node.scrollTop(t.scrollTop-16),e.right>t.scrollLeft+t.w&&t.direction.right?t.$node.scrollLeft(t.scrollLeft+16):t.scrollLeft>e.left-2&&t.direction.left&&t.$node.scrollLeft(t.scrollLeft-16)},renderGrid:function(){var e=this.model.getValueFromSelfOrParent("showGrid"),t=void 0!==e&&e,i=this.model.getValueFromSelfOrParent("layoutPositioning");t&&"absolute"===i?this.$el.hasClass("gridCapable")&&(this.$el.find(".absoluteLayoutGrid").remove(),this.$el.prepend("<div class=absoluteLayoutGrid></div>")):this.$el.find(".absoluteLayoutGrid").remove()},onResize:function(){s.inherited("onResize",this,arguments),this.renderGrid()},onPageSize:function(){this.renderGrid()}})})),define("dashboard-core/js/dashboard/layout/authoring/views/ScalingAbsolute",["./Absolute","jquery","underscore","../../../util/PxPercentUtil","../../../../app/util/DeepClone"],(function(e,t,i,o){var n=null;return n=e.extend({init:function(e){if(n.inherited("init",this,arguments),this.model.on("insert:item",this._onNewItem,this),this.model.items)for(var t=0;t<this.model.items.length;t++)this._setChildMonitors(this.model.items[t]);this.specializeConsumeView(["setPreferredLocation"]),this.dashboardApi=e.dashboardApi},destroy:function(){if(this.model.off("insert:item",this._onNewItem,this),this.$el.find(".relativeLayoutGrid").remove(),this.model.items)for(var e=0;e<this.model.items.length;e++)this._setChildMonitors(this.model.items[e],"off");n.inherited("destroy",this,arguments)},_setChildMonitors:function(e,t){var i="off"===t?"off":"on";e[i]("change:style",this._onChildModelStyleChange,this),e[i]("prechange:style",this._onChildModelStylePreChange,this),e[i]("change:parent",this._onChildModelUpdateParent,this)},_onNewItem:function(e){var t=this.model.findModel(e.value.parameter.model.id);this._setChildMonitors(t),this.updateStyleToPercent(t,e.data)},_onChildModelUpdateParent:function(e){if(e.value.parameter.parentId!==this.model.id){var t=this.layoutController.topLayoutModel.findModel(e.modelId);this._setChildMonitors(t,"off")}},_onChildModelStyleChange:function(e){if(e.data&&"updateStyleToPercent"!==e.data.hint&&"UndoRedoController"!==e.sender){var t=this.layoutController.topLayoutModel.findModel(e.modelId);this.updateStyleToPercent(t,e.data)}},_onChildModelStylePreChange:function(e){if("UndoRedoController"!==e.sender){var t=e.value&&e.value.style;this._changePixelModelToPercent(t)}},_changePixelModelToPercent:function(e){var i=this.$el;i.is(":visible")||(i=t(this.layoutController.getLastVisiblePage()));var n={width:i.width(),height:i.height()};o.changePixelPropertiesToPercent(e,n)},updateStyleToPercent:function(e,t){var o=this;return this.layoutController.layoutReady(e.id).then((function(){return new Promise((function(n,a){try{if(e.getParent()&&e.getParent().id===o.model.id&&e.style){var r=i.extend({},e.style);o._changePixelModelToPercent(r);var s=i.deepClone(t);s.hint="updateStyleToPercent",s.triggerResize=!0,e.updateModel({updateArray:[{style:r,id:e.id}]},null,s)}n()}catch(e){a(e)}}))}))},_moveDrop:function(e){var t=e.data.nodeInfoList[0],i=t.node._layout.model,o=i.getParent();if(n.inherited("_moveDrop",this,arguments),o.id!==this.model.id){var a=this.model.findModel(i.id);this._setChildMonitors(a),o.deselect(i.id)}},getMinimumTop:function(){var e=this.consumeView.parentLayout?this.consumeView.parentLayout.getMinimumTop():0;return-1*(this.$el.position().top+this.$el.parent().scrollTop())+e},getMinimumLeft:function(){var e=this.consumeView.parentLayout?this.consumeView.parentLayout.getMinimumLeft():0;return-1*(this.$el.position().left+this.$el.parent().scrollLeft())+e},getScrollAreaNode:function(){return this.consumeView.parentLayout.$el},renderGrid:function(){var e=this.model.getValueFromSelfOrParent("showGrid"),t=void 0!==e&&e,i=this.model.getValueFromSelfOrParent("layoutPositioning");t&&"relative"===i?this.$el.hasClass("gridCapable")&&(this.$el.find(".relativeLayoutGrid").remove(),this.$el.prepend(this._createGridSvg(this.$el[0].id,this.$el.hasClass("infoGraphic")))):this.$el.find(".relativeLayoutGrid").remove()},_createGridSvg:function(e,t){var i=this.model.getValueFromSelfOrParent("layoutPositioning"),o=this.getPhysicalPageSize(i,e),n=0;return n=t?o.width/60:o.width/100,'<div class="relativeLayoutGrid">\t\t\t\t<svg viewBox="0 0 '+o.width+" "+o.height+'" xmlns="http://www.w3.org/2000/svg">\t\t\t\t\t<defs>\t\t\t\t\t\t<pattern id="grid'+e+'" width="'+n+'" height="'+n+'" patternUnits="userSpaceOnUse">\t\t\t\t\t\t\t<path d="M '+n+" 0 L 0 0 0 "+n+'" fill="none" stroke-width="0.5"/>\t\t\t\t\t\t</pattern>\t\t\t\t\t</defs>\t\t\t\t\t<rect width="100%" height="100%" fill="url(#grid'+e+')" />\t\t\t\t</svg>\t\t\t</div>'}})})),define("dashboard-core/js/dashboard/layout/authoring/TemplateHelper",["jquery"],(function(e){return function(){function t(e){if(_classCallCheck(this,t),this._model=e.model,this._layoutController=e.layoutController,this._model.on("insert:item",this._onNewItem,this),this._model.on("remove:item",this._onRemoveItem,this),this._model.items)for(var i=0;i<this._model.items.length;i++)this._setChildMonitors(this._model.items[i])}return t.prototype.destroy=function(){if(this._model.off("insert:item",this._onNewItem,this),this._model.off("remove:item",this._onRemoveItem,this),this._model.items)for(var e=0;e<this._model.items.length;e++)this._setChildMonitors(this._model.items[e],"off")},t.prototype.setPreferredLocation=function(e){var t=!1,i=this._layoutController.getLayoutView(this._model.id).$el.find(".pagetemplateDropZone.empty");return i.length>0&&(i[0]._layout.setPreferredLocation(e),t=!0),t},t.prototype._setChildMonitors=function(e,t){var i="off"===t?"off":"on";e[i]("change:style",this._onChildModelStyleChange,this),e[i]("change:parent",this._onChildModelUpdateParent,this)},t.prototype._onNewItem=function(e){var t=this._model.findModel(e.value.parameter.model.id);this._setChildMonitors(t),this._updateDropZonesState(t,e.data)},t.prototype._onRemoveItem=function(e){for(var t=this._layoutController.getLayoutView(e.modelId).$el.children(".pagetemplateDropZone"),i=e.value.parameter,o=0;o<t.length;o++)t[o]._layout.removeRelatedModel(i,e)},t.prototype._clearDropZoneState=function(e,t){for(var i=this._layoutController.getLayoutView(e.id),o=i&&i.$el?i.$el.children(".pagetemplateDropZone"):[],n=void 0,a=0;a<o.length;a++){if((n=o[a])._layout)n._layout.removeRelatedModel(e.id,t)}e.set({relatedLayouts:""},{payloadData:t.data})},t.prototype._onChildModelUpdateParent=function(e){if(e.data&&"updateStyleToPercent"!==e.data.hint&&"UndoRedoController"!==e.sender){var t=this._layoutController.topLayoutModel.findModel(e.modelId);this._clearDropZoneState(t,e.data),this._setChildMonitors(t,"off")}},t.prototype._onChildModelStyleChange=function(e){var t=this._layoutController.topLayoutModel.findModel(e.modelId);this._updateDropZonesState(t,e.data)},t.prototype._updateDropZonesState=function(t,i){var o=this;setTimeout((function(){o._layoutController.layoutReady(t.id).then((function(){for(var n=o._layoutController.dashboardApi.getCanvas().getContent(t.id),a=o._layoutController.getLayoutView(o._model.id),r=e("#"+o._layoutController.modelIdToNodeId(t.id),a.$el),s=r.siblings(".pagetemplateDropZone"),d=void 0,l=null,h=0;h<s.length;h++)(d=s[h])._layout&&function(){var e=d._layout;if(e.isLayoutRelatedToDropZone(r[0]))(l=e).addRelatedModel(t.id,i);else{var o=n.findContent();o&&0!=o.length&&o.forEach((function(t){e.removeRelatedModel(t.getId(),i)})),e.removeRelatedModel(t.id,i)}}();t.set({relatedLayouts:l?l.model.id:""},{payloadData:i.data})}))}),10)},t}()})),define("dashboard-core/js/dashboard/layout/authoring/views/GenericPage",["jquery","underscore","./Absolute","./ScalingAbsolute","../TemplateHelper","../../../util/PxPercentUtil","../../../../app/util/DeepClone"],(function(e,t,i,o,n,a){return function(){function e(t){_classCallCheck(this,e),this._options=t;var i={model:t.model,layoutController:t.layoutController};this._options.templateHelper=new n(i);var o=t.model.getValueFromSelfOrParent("layoutPositioning");this._switchLayoutView(o),this._setPageLayoutStyling(o),this._delegateView.model.on("change:layoutPositioning",this._onChangeLayoutPositioning,this)}return e.prototype.destroy=function(){this._delegateView.model.off("change:layoutPositioning",this._onChangeLayoutPositioning,this),this._delegateView.destroy(),this._options.templateHelper.destroy(),this._options.templateHelper=null},e.prototype._switchLayoutView=function(e){this._delegateView&&this._delegateView.destroy(),this._delegateView="absolute"===e?new i(this._options):new o(this._options),this._delegateView.consumeView.authorViewManager=this},e.prototype._onChangeLayoutPositioning=function(e){this._switchLayoutView(e.value),this._setPageLayoutStyling(e.value),"UndoRedoController"!==e.sender&&this._convertLayoutPositioning(e)},e.prototype._convertLayoutPositioning=function(e){var i=this._delegateView.getPhysicalPageSize("absolute"),o=this._delegateView.model.findDescendantsWithType(["widget","group"]).map((function(o){var n=t.deepClone(o.style);return"relative"===e.value?a.changePixelPropertiesToPercent(n,i):a.changePercentPropertiesToPixel(n,i),{id:o.id,style:n}})),n=this._delegateView.dashboardApi.getFeature("Transaction"),r=n.startTransactionById(e.data.undoRedoTransactionId),s="change:layoutPositioning"!==e.eventName;"absolute"===e.value&&t.extend(e.data,{hint:"updateStyleToPercent"}),this._delegateView.updateModel(o,r,s),n.endTransaction(r)},e.prototype._setPageLayoutStyling=function(e){var t="relative"===e;this._delegateView.$el.toggleClass("pagescalingAbsolute",t),this._delegateView.$el.toggleClass("pageabsolute",!t)},e}()})),define("dashboard-core/js/dashboard/layout/authoring/views/Group",["./Absolute","jquery"],(function(e,t){var i=null;return i=e.extend({init:function(){i.inherited("init",this,arguments),this.specializeConsumeView(["onResize","onResizeStep","onSelect","onDeselect","getWidgetPositionUpdate","getMinimumTop","getMinimumLeft","getMaximumHeight","getMaximumWidth"])},createDropZone:function(){},getFirstNonGroupAncestorView:function(){var e=t(this.domNode).parents(".pagegroup");return(e.length>0?e[e.length-1]:this.domNode)._layout.parentLayout},onSelect:function(){for(var e,t=this.model.items,i=0;i<t.length;i++)(e=this.layoutController.getLayoutView(t[i].id))&&e.onSelect&&e.onSelect(!0)},onDeselect:function(){for(var e,t=this.model.items,i=0;i<t.length;i++)(e=this.layoutController.getLayoutView(t[i].id))&&e.onDeselect&&e.onDeselect()},getPositionRelativeToPage:function(){for(var e=t(this.domNode),i={x:parseInt(e.css("left"),10),y:parseInt(e.css("top"),10)},o=e.parents(".pagegroup"),n=0;n<o.length;n++)i.x+=parseInt(t(o[n]).css("left"),10),i.y+=parseInt(t(o[n]).css("top"),10);return i},getMinimumLeft:function(){var e=this.getPositionRelativeToPage();return this.getFirstNonGroupAncestorView().getMinimumLeft()-e.x},getMinimumTop:function(){var e=this.getPositionRelativeToPage();return this.getFirstNonGroupAncestorView().getMinimumTop()-e.y},getMaximumWidth:function(){var e=this.getFirstNonGroupAncestorView().getMaximumWidth();e&&(e-=this.getPositionRelativeToPage().x);return e},getMaximumHeight:function(){var e=this.getFirstNonGroupAncestorView().getMaximumHeight();e&&(e-=this.getPositionRelativeToPage().y);return e}})})),define("dashboard-core/js/dashboard/layout/authoring/views/PageCollectionView",["./LayoutBaseView"],(function(e){var t=null;return t=e.extend({init:function(e){t.inherited("init",this,arguments),this._getViewId=this.consumeView._getViewId.bind(this.consumeView),this.htmlTemplate=e.services.getSvcSync("htmlTemplates")},destroy:function(){t.inherited("destroy",this,arguments)}})})),define("dashboard-core/js/dashboard/layout/authoring/views/TabContextMenu",["react","prop-types","@ba/ba-ui-carbon-toolkit","@ba/ba-ui-carbon"],(function(e,t,i,o){var n=i.Flyout,a=o.Button,r=function(t){function i(){return _classCallCheck(this,i),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(i,t),i.prototype._renderItems=function(e){for(var t=[],i=0;i<e.length;++i)t.push(this._renderItem(e[i]));return t},i.prototype._onSelection=function(e,t){e.stopPropagation(),this.props.closeFlyout(),t.action&&t.action()},i.prototype._renderItem=function(t){var i=this;return e.createElement(a,{className:t.className,size:"small",kind:"ghost",disabled:t.isDisabled,onClick:function(e){return i._onSelection(e,t)}},t.label)},i.prototype.render=function(){var t=this.props,i=t.anchorElement,o=t.itemSpecs,a=t.closeFlyout,r=this._renderItems(o);return e.createElement(n,{onClose:a,style:{display:"flex","flex-direction":"column"},placement:"bottomCentred",domNodeToAttachTo:document.body,triggerNode:i,className:"dashboardTabContextMenu"},r)},i}(e.Component);return r.propTypes={anchorElement:t.object.isRequired,itemSpecs:t.arrayOf(t.object).isRequired,closeFlyout:t.func.isRequired},r})),define("dashboard-core/js/app/ui/dnd/DnDHelper",[],(function(){return{_id:null,handleWidgetDrop:function(e,t,i){if(e)if("new"===i.data.operation){var o=this._prepareWidgetContent(t,i);e.addContent(o)}else if("move"===i.data.operation){var n=this._getContentIdList(i);e.moveContent(t,n)}},_prepareWidgetContent:function(e,t){var i=t.data.layoutProperties.style||{},o=t.widgetSpec.model;return{containerId:e,layout:_extends({},i),type:"widget."+o.type,spec:_extends({style:i},o)}},_getContentIdList:function(e){return(e.data&&e.data.nodeInfoList).map((function(e){if(e&&e.node&&e.node._layout)return e.node._layout.model&&e.node._layout.model.id}))}}})),define("dashboard-core/js/dashboard/layout/authoring/views/Tab",["react","react-dom","./PageCollectionView","./TabContextMenu","jquery","../../../../lib/@waca/core-client/js/core-client/utils/BidiUtil","../../../../app/nls/StringResources","../../../../lib/@waca/core-client/js/core-client/utils/dom-utils","../../../../lib/@waca/core-client/js/core-client/utils/Deferred","../../../../app/ui/dnd/DnDHelper","../../../../app/ui/dialogs/TemplateSelectDialog","../../../views/LayoutPicker","../../../TemplateLayoutGenerator","../../../../lib/@waca/dashboard-common/dist/ui/dialogs/MessageDialog","../../../../lib/@waca/core-client/js/core-client/utils/EventHelper"],(function(e,t,i,o,n,a,r,s,d,l,h,c,u,g){var p=null;return p=i.extend({init:function(e){var t=this;p.inherited("init",this,arguments),e=e||{},this._getLabelId=this.consumeView._getLabelId.bind(this.consumeView),this.specializeConsumeView(["showView","renderContent","_attachView","onAddClick","onReorder","_handleKeydown","showContextMenu","deleteView","updateViewLabel","editViewTitle"]),this.services=e.services,this.config=e.config,this.layoutsPath=e.layoutsPath,this.templateListing=e.templateListing,this.whenIsReadyDfd=new d,this.backgroundChangeHandle=this.model.on("change:css",(function(){return t.consumeView.tabWidget.updateTheme()})),this.dashboardApi=e.dashboardApi,this._attachedHandles={},this._icons=this.dashboardApi.getFeature("Icons"),this.contextMenuHolder=document.createElement("div"),this.contextMenuHolder.classList.add("tabContextMenu-holder")},closeContextMenu:function(){this._contextMenu&&(t.unmountComponentAtNode(this.contextMenuHolder),this.$el.find(".tabContextMenu-holder").remove(),this._contextMenu=null)},renderContent:function(){var e=this;return this.overridden.renderContent().then((function(){e.consumeView.tabWidget.setState({addable:!0,deleteable:e.allowTabDeletion(),draggable:!0}),e.model.items&&e.model.items.length&&e.model.items.forEach((function(t){return e._attachView(t)})),e._initializeDnd()}))},whenIsReady:function(){return this.whenIsReadyDfd.promise},destroy:function(){this._tabStripDropZone&&this._tabStripDropZone.remove(),this._tabDropHandler&&(this._tabDropHandler.deregister(),this._tabDropHandler=null),this.backgroundChangeHandle&&this.backgroundChangeHandle.remove(),this.closeContextMenu(),this.model.items.forEach(this._detachView.bind(this)),this.consumeView.updateState({addable:!1,deleteable:!1,draggable:!1}),p.inherited("destroy",this,arguments)},_initializeDnd:function(){this._dndManager=this.dashboardApi.getFeature("DashboardDnd.internal"),this.setupGlobalDropZone(),this.whenIsReadyDfd.resolve()},_attachView:function(e){var t=this;this.services.getSvcSync("TranslationService").registerView({view:this,model:e}),this._attachedHandles[e.id]=e.on("change:title",this.onTabLabelChange.bind(this,e),this),this._attachedHandles[e.id]=e.on("change:tabTextColor",(function(e){return t.consumeView.tabWidget.updateTheme(e)})),this._attachedHandles[e.id]=e.on("change:tabSelectedLineColor",(function(e){return t.consumeView.tabWidget.updateTheme(e)})),this._attachedHandles[e.id]=e.on("change:tabBackgroundColor",(function(e){return t.consumeView.tabWidget.updateTheme(e)})),this._attachedHandles[e.id]=e.on("change:tabIconColor",(function(e){return t.consumeView.tabWidget.updateTheme(e)})),this._attachedHandles[e.id]=e.on("change:tabIcon",(function(i){return t.onTabIconChange(e,i)}))},_detachView:function(e){this._attachedHandles[e.id]&&(this._attachedHandles[e.id].remove(),delete this._attachedHandles[e.id])},addTranslationIcon:function(e){var t=e&&e[0].propertyParentModel;return this.model.get("hideTab")?0:this.consumeView.tabWidget.updateTranslationIcon(t,!0)},removeTranslationIcon:function(e){var t=e&&e[0].propertyParentModel;return this.consumeView.tabWidget.updateTranslationIcon(t,!1)},_handleKeydown:function(e,t,i){var o=t.keyCode;if(this._shouldShowContextMenu(t,o))return this.showContextMenu(e,i),t.preventDefault(),!1;this.overridden._handleKeydown(e,t,i)},_shouldShowContextMenu:function(e,t){return e.shiftKey&&121===t},moveViewBefore:function(e,t){e.id!==t&&e.getNextSiblingId()!==t&&e.updateModel({updateArray:[{id:e.id,parentId:e.getParent().id,insertBefore:t}]})},showView:function(e){this.closeContextMenu(),this.overridden.showView(e)},showContextMenu:function(i,n){if(this._contextMenu)this.closeContextMenu();else{var a=this._getContextMenuItemSpecs(i);this.$el.append(this.contextMenuHolder),this._contextMenu=e.createElement(o,{itemSpecs:a,anchorElement:n,closeFlyout:this.closeContextMenu.bind(this)}),t.render(this._contextMenu,this.contextMenuHolder)}},_getContextMenuItemSpecs:function(e){var t=[];return t.push({label:r.get("toolbarActionEditTitle"),className:"rename",type:"Button",action:this.editViewTitle.bind(this,e)}),t.push({label:r.get("duplicate"),className:"duplicate",type:"Button",action:this.duplicateTab.bind(this,e.id)}),"disabled"!==this.config.changeTabTemplate&&t.push({label:r.get("changeTemplate"),className:"changeTemplate",type:"Button",disabled:"NoTemplate"===e.templateName,action:this.selectTemplate.bind(this,e.id)}),this.allowTabDeletion()&&t.push({className:"deleteTab",label:r.get("delete"),type:"Button",action:this._deletePrompt.bind(this)}),t},_deletePrompt:function(){this.consumeView.onDeletePrompt()},add:function(e,t){for(var i=this,o=e.model,a=this.consumeView.tabWidget.state.tabs,r=void 0,s=!0,d=0;d<a.length;d++)if(this.consumeView._getModelIdFromPanel(a[d].props.id)===o.id){s=!1,r=d;break}if(s){var l=n(this.htmlTemplate.replaceLayoutValues(this.htmlTemplate.getItemTemplate("tab","",o),this.model));l.append(e.domNode),this.$el.children(".tabPageHolder").append(l);var h=[],c=this.consumeView._createTabPanel(o,!1);t?a.forEach((function(e){i.consumeView._getModelIdFromPanel(e.props.id)===t&&h.push(c),h.push(e)})):(h=a.slice()).push(c),this.consumeView.tabWidget.setState({tabs:h}),this.consumeView.canvas.selectContent([o.id]),this.overridden._attachView(o),this._attachView(o)}else{if(!(null===t&&r===a.length-1||a[r+1]&&this.consumeView._getModelIdFromPanel(a[r+1].props.id)===t)){var u=[];a.forEach((function(e){i.consumeView._getModelIdFromPanel(e.props.id)===t?(u.push(a[r]),u.push(e)):i.consumeView._getModelIdFromPanel(e.props.id)!==o.id&&u.push(e)})),null===t&&u.push(a[r]),this.consumeView.tabWidget.setState({tabs:u})}this.$el.find("#"+this._getViewId(o)).append(e.domNode)}!1===this.consumeView.tabWidget.state.deleteable&&this.allowTabDeletion()&&this.consumeView.tabWidget.setState({deleteable:!0})},allowTabDeletion:function(){return this.model.items.length>1},_getDefaultViewLabel:function(){for(var e=this.model.items.length,t=1;t<e+1;t++){for(var i=!0,o=0;o<e;o++)if(this.model.items[o].get("title")===r.get("defaultTabTitle",{index:t})){i=!1;break}if(i)return r.get("defaultTabTitle",{index:t})}return r.get("defaultTabTitle",{index:e+1})},onAddClick:function(){return this._invokeLifeCycleHandlers("tabs.onPressNew",{$el:this.$el}).then(function(){return this._openTemplateSelectDialog()}.bind(this))},onReorder:function(e,t,i){var o=null;t+1<e.length&&(o=this.consumeView._getModelIdFromPanel(e[t+1].props.id));var n=this.consumeView._getModelIdFromPanel(i);this.moveViewBefore(this.model.findModel(n),o),this.consumeView.eventRouter.trigger("properties:refreshPane")},onTabLabelChange:function(e){this.consumeView.tabWidget.updateTabLabel(e);var t="tabIndividualStylingLink"+this.model.items.findIndex((function(t){return t.id===e.id})),i={propertyName:t,subPropertyName:"r_"+t+"0",value:e.get("title")};this.consumeView.eventRouter.trigger("properties:setValue",i),this.consumeView.eventRouter.trigger("properties:setChildValue",{propertyName:"title",value:e.get("title"),contentId:e.id})},onTabIconChange:function(e,t){if(this.consumeView.tabWidget.updateTabIcon(e),t&&"UndoRedoController"===t.sender){var i=this.consumeView.canvas.getContent(e.id);this.consumeView.eventRouter.trigger("properties:refreshChild",{content:i}),this.consumeView.eventRouter.trigger("properties:refreshPane")}},setupGlobalDropZone:function(){var e=this;this._tabStripDropZone&&this._tabStripDropZone.remove(),this._tabStripDropZone=this._dndManager.addDropTarget(n(this.consumeView.tabWidget.tabListNode),"[role=tab]",{accepts:function(e){return"widget"===e.type},onDragEnter:function(t,i){var o=e.consumeView._getPanelFromNode(i);if(o){var a=o.props.hoverColor;n(i).css("background-color",a)}},onDragLeave:function(t,i){var o=e.consumeView._getPanelFromNode(i);if(o){var a=o.props.backgroundColor;n(i).css("background-color",a)}},onDrop:function(t,i){var o=e.consumeView._getPanelFromNode(i);if("widget"===t.type&&o){var n=e.consumeView._getModelIdFromPanel(o.props.id),a={data:{}};return t.data&&(a.data.operation=t.data.operation,a.data.layoutProperties=t.data.layoutProperties,a.data.nodeInfoList=t.data.nodeInfoList,a.widgetSpec=t.widgetSpec),e.consumeView.layoutController.getLayoutViewWhenReady(n).then((function(){l.handleWidgetDrop(e.consumeView.canvas,n,a)}))}return Promise.resolve(!0)},info:function(t){var i=e.consumeView._getPanelFromNode(t);return i?{containerId:e.consumeView._getModelIdFromPanel(i.props.id)}:{}},type:"dropOnTab"}),this._tabDropHandler||(this._tabDropHandler=this._dndManager.registerDropHandler({accepts:function(e,t){return e.type.match(/content\..*/)&&"dropOnTab"===t.type},onDrop:function(t,i){if(i.info.containerId){var o=_extends({},t.data,{containerId:i.info.containerId});e.consumeView.canvas.addContent(o)}}}))},updateViewLabel:function(e,t){this.consumeView.canvas.getContent(e.id).setPropertyValue("title",t)},duplicateTab:function(e){this.model.boardModel.duplicateLayout(e)},deleteView:function(e){this.consumeView.canvas.removeContent(e),this.services.getSvcSync("TranslationService").deregisterView(e)},selectTemplate:function(e){return this._openTemplateSelectDialog(e,!0)},_templateSelectDialogViewOptions:function(){var e=this,t=this.dashboardApi.getCanvas().getPropertyValue("excludedTemplates");return this._templateLayoutGenerator=new u({excludeTemplates:t}),this._templateLayoutGenerator.initialize().then((function(){var t=e._templateLayoutGenerator.getTemplates("tab");return e._selectedTemplateId=e.lastSelectedTemplate||e.model.items.length>0&&e.model.items[0].templateName||t[0].templateId,{action:function(){},templates:t,selectedNavModel:"tab",onSelectedTemplateId:e._onSelectedTemplateId.bind(e),defaultTemplateSelected:e._selectedTemplateId,light:!0}}))},_onSelectedTemplateId:function(e){this._selectedTemplateId=e},_openTemplateSelectDialog:function(i,o){var n=this,a=void 0;return this.$dialogNode=document.createElement("div"),document.body.appendChild(this.$dialogNode),this._templateSelectDialogViewOptions().then((function(s){o?!0===o&&(a=function(e){var t=e.layout;n._updateTemplateDropZones(i,t),n.lastSelectedTemplate=t.templateName,n._closeTemplateSelectDialog()}):a=function(e){var t=e.layout;n._addBoardLayout(t),n._setDefaultLayoutPositioning(),n.lastSelectedTemplate=t.templateName,n._closeTemplateSelectDialog()},s.action=function(){return n._templateLayoutGenerator.getSelectedLayoutSpec(n._selectedTemplateId).then(a).catch((function(e){n._closeTemplateSelectDialog(),n._displayErrorMessage(e)}))},t.render(e.createElement(h,{size:"md",modalHeading:r.get("selectTemplateLabel"),primaryButtonText:r.get("dlg_create"),secondaryButtonText:r.get("dlg_cancel"),className:"selectLayoutDialog",hasScrollingContent:!0,hasForm:!0,onRequestSubmit:s.action,onRequestClose:n._closeTemplateSelectDialog.bind(n)},e.createElement(c,s)),n.$dialogNode)}))},_closeTemplateSelectDialog:function(){this.$dialogNode&&(t.unmountComponentAtNode(this.$dialogNode),document.body.removeChild(this.$dialogNode),this.$dialogNode=null)},_setDefaultLayoutPositioning:function(){var e=this.model.getValueFromSelfOrParent("layoutPositioning")||"relative",t=this.model.findDescendantsWithType("genericPage"),i=Array.isArray(t),o=0;for(t=i?t:t[Symbol.iterator]();;){var n;if(i){if(o>=t.length)break;n=t[o++]}else{if((o=t.next()).done)break;n=o.value}n.layoutPositioning=e}},editViewTitle:function(e){this.consumeView.tabWidget.editTabLabel(!0,e)},_addBoardLayout:function(e){(e=e||{type:"absolute"}).title=this._getDefaultViewLabel(),e.localizedProps=["title"];var t={spec:e,containerId:this.model.id};this.consumeView.canvas.addContent(t)},_updateTemplateDropZones:function(e,t){this.model.boardModel.updateLayoutDropZones({id:e,model:t})},removeChild:function(e){var t=this;if(e){e.model.off("change:title");var i=e.model,o=this.consumeView.tabWidget.state.tabs,a=!1,r=[],s=void 0;if(o.forEach((function(e,o){t.consumeView._getModelIdFromPanel(e.props.id)===i.id?(a=!0,s=o):r.push(e)})),a){var d={tabs:r};if(this.consumeView._getViewId(i)===this.consumeView._currentViewId){var l=Math.max(s-1,0);d.selectedTab=this.consumeView._getPanelId(this.model.items[l].id),d.selectedTabId=this.consumeView._getModelIdFromPanel(this.consumeView._getPanelId(this.model.items[l].id)),this.consumeView._updateSelectedModel(this.model.items[l],!0)}this.consumeView.tabWidget.setState(d)}var h="#"+e.domNode.parentNode.id;n(h).remove(),p.inherited("removeChild",this,arguments),!0!==this.consumeView.tabWidget.state.deleteable||this.allowTabDeletion()||this.consumeView.tabWidget.setState({deleteable:!1})}},_invokeLifeCycleHandlers:function(e,t){return this.services.getSvc(".LifeCycleManager").then((function(i){return i.invokeLifeCycleHandlers(e,t)}))},_displayErrorMessage:function(e){new g({title:r.get("errorMessageTitle"),message:e.toString()}).render()}})})),define("dashboard-core/js/dashboard/layout/authoring/views/TemplateContainer",["jquery","./Absolute"],(function(e,t){var i=null;return i=t.extend({init:function(){i.inherited("init",this,arguments),this.scrollPosition={top:this.domNode.scrollTop,left:this.domNode.scrollLeft},this.$el.on("scroll."+this.id,this._onScroll.bind(this))},destroy:function(){i.inherited("destroy",this,arguments),this.$el.off("scroll."+this.id)},createDropZone:function(){},_onScroll:function(){var e=this.domNode.scrollTop,t=this.domNode.scrollLeft;this._dndManager.scrollChildrenCandidateDropTargets(this.domNode,this.scrollPosition.top-e,this.scrollPosition.left-t),this.scrollPosition.top=e,this.scrollPosition.left=t},_getTemplateLayoutView:function(){var t=null;if(this.model.items&&this.model.items.length>0){var i=this.model.items[0];t=e("#"+this.layoutController.modelIdToNodeId(i.id),this.layoutController.$el)[0]._layout}return t},_addWidget:function(e,t){var i=this._getTemplateLayoutView();if(i){e.parentId=i.model.id;var o=parseInt(e.layoutProperties.style.top,10),n=parseInt(e.layoutProperties.style.left,10),a=i.$el.position(),r=o-a.top-this.domNode.scrollTop,s=n-a.left-this.domNode.scrollLeft;e.layoutProperties.style.top=Math.round(Math.max(r,i.getMinimumTop()))+"px",e.layoutProperties.style.left=Math.round(Math.max(s,i.getMinimumLeft()))+"px",i.authorHelper._addWidget(e,t)}},setPreferredLocation:function(e){var t=this._getTemplateLayoutView();t&&t.setPreferredLocation&&t.setPreferredLocation(e)}})})),define("dashboard-core/js/dashboard/layout/authoring/views/TemplateDropZone",["jquery","underscore","./LayoutBaseView","../../../../lib/@waca/dashboard-common/dist/ui/interaction/Utils","../../../../app/nls/StringResources","../../../../lib/@waca/core-client/js/core-client/utils/Deferred","../../LayoutHelper","../../../glass/util/InstrumentationUtil"],(function(e,t,i,o,n,a,r,s){var d=null;return d=i.extend({init:function(e){d.inherited("init",this,arguments),this.services=e.services,this.specializeConsumeView(["setPreferredLocation","isLayoutRelatedToDropZone","addRelatedModel","removeRelatedModel"]),this.$el.parent().addClass("templateDropZoneContainer"),this.updateRelatedContentState(),this.whenIsReadyDfd=new a,this.initializeDropZones()},initializeDropZones:function(){this._dndManager=this.dashboardApi.getFeature("DashboardDnd.internal"),this.centerDrop||(this.centerDrop=e('<div class="centerDrop"><div class="dropIcon"><svg class="svgIcon" role="img" focusable="false"><use style="pointer-events: none; " xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#dashboard-fullscreen"></use></svg></div><div class="dropLabel">'+n.get("dropZoneLabel")+"</div></div>"),this.centerDrop.hide(),this.$el.append(this.centerDrop));var t=this.centerDrop.find(".dropIcon");this._dndManager.addDropTarget(t[0],{accepts:this.accepts.bind(this),onDrop:this.onCentreDrop.bind(this),onDragEnter:this.onCentreDragEnter.bind(this),onDragLeave:this.onCentreDragLeave.bind(this),priority:-100}),this._dndManager.addDropTarget(this.domNode,{accepts:function(){return!1},onDragEnter:this.onDragZoneEnter.bind(this),onDragLeave:this.onDragZoneLeave.bind(this),onDrop:this.onDropZoneDrop.bind(this),receiveEventsWhenNotAccepting:!0,priority:-99}),this._setupGlassDroppables(t),this.whenIsReadyDfd.resolve()},whenIsReady:function(){return this.whenIsReadyDfd.promise},_setupGlassDroppables:function(e){if(this.$el.glassDroppableV2){var t=this;e.glassDroppableV2({onDrop:this._onPinDrop.bind(this),onEnter:this.onGlassCentreDragEnter.bind(this),onLeave:this.onCentreDragLeave.bind(this),allowOnDropPropagation:!1}),this.$el.glassDroppableV2({onEnter:function(){this.id===t.$el[0].id&&t.onDragZoneEnter()},onLeave:function(){this.id===t.$el[0].id&&t.onDragZoneLeave()},onDrop:function(){return t.onDropZoneDrop(),!0},allowOnDropPropagation:!0})}},_showCenterDrop:function(e,t){var i=null;if(t){var o=e.nodeInfoList[0].node._layout;o&&(i=o.model.id)}(!this.hasMaximizedWidget()||i&&this.isWidgetMaximized(i))&&this.centerDrop.show()},onDragZoneEnter:function(e){this.inDropZone=!0;var t=e&&e.data||{},i=!t.nodeInfoList,o=t.nodeInfoList&&1===t.nodeInfoList.length;if(i||o){this._showCenterDrop(t,o);var n=this._dndManager.getDropTargetFromNode(this.centerDrop.find(".dropIcon")[0]);this._dndManager.reassessDropTarget(n)}},onDragZoneLeave:function(){this.centerDrop.hasClass("active")||this.centerDrop.hide(),this.inDropZone=!1},onDropZoneDrop:function(){this.deactivateAndhideCenterDropZone(),this.inDropZone=!1},deactivateAndhideCenterDropZone:function(){this.centerDrop&&(this.centerDrop.removeClass("active"),this.centerDrop.hide())},destroy:function(){this._dndManager&&(this._dndManager.removeDropTarget(this.centerDrop.find(".dropIcon")[0]),this._dndManager.removeDropTarget(this.domNode),this._dndManager=null),this.centerDrop.remove(),this.centerDrop=null,this.$el.parent().find(".pagetemplateDropZone")<=1&&this.$el.parent().removeClass("templateDropZoneContainer"),e.glassdnd&&e.glassdnd.cancelDroppable&&e.glassdnd.cancelDroppable(this.$el),d.inherited("destroy",this,arguments)},accepts:function(e){return this.dashboardApi.getFeature("CanvasDnD").accepts(e,{fromTemplate:!0})},onCentreDragEnter:function(){this.centerDrop.addClass("active")},onGlassCentreDragEnter:function(){this.centerDrop.show(),this.centerDrop.addClass("active")},onCentreDragLeave:function(){this.centerDrop.removeClass("active"),this.inDropZone||this.centerDrop.hide()},onCentreDrop:function(e){var t=this;return("move"===e.data.operation?Promise.resolve(this._moveDrop(e)):"pin"===e.type&&"new"===e.data.operation?Promise.resolve(this._onPinDrop(e)):this._newDrop(e)).then((function(){return t.deactivateAndhideCenterDropZone()}))},_moveDrop:function(e){for(var t,i,o=[],n=0;n<e.data.nodeInfoList.length;n++)t=e.data.nodeInfoList[n].node._layout.model,i={style:{},parentId:this.model.getParent().id,id:t.id},this.setPreferredLayoutProperties(i),i.insertBefore=this.getWidgetIdForInsertBefore(),o.push(i);var a=this.dashboardApi.getFeature("Transaction"),r=a.startTransaction(),s=o.map((function(e){return e.id}));this.dashboardApi.getCanvas().moveContent(this.model.getParent().id,s,r),this.updateModel(o,r,!1),a.endTransaction(r)},_newDrop:function(e){var t=this;return this._getModelToAddFromDragObject(e).then((function(i){if(i){var o={model:i,parentId:t.id,layoutProperties:e.data.layoutProperties||{}};s.trackWidget("created",t.dashboardApi,o.model),t.setPreferredLocation(o),t._addWidget(o,e.isTouch)}}))},_onPinDrop:function(e){var t=e.data.pinSpec,i=e.isTouch;"boardFragment"===t.contentType&&this.setPreferredLayoutProperties(t.content.layout),t.parentId=this.id,this.setMaximizedStateParentLocation(t),this._processWidgetSpecForPin(t,i),this.deactivateAndhideCenterDropZone()},setPreferredLocation:function(e){this.setPreferredLayoutProperties(e.layoutProperties),this.setMaximizedStateParentLocation(e)},setMaximizedStateParentLocation:function(e){e.parentId=this.model.getParent().id,e.insertBefore=this.getWidgetIdForInsertBefore()},setPreferredLayoutProperties:function(e){if(e.style||(e.style={}),this.$el.is(":visible")){var t=this.$el.offset(),i=this.$el.parent().offset();e.style.top=Math.round(t.top-i.top),e.style.left=Math.round(t.left-i.left),e.style.height=this.$el.outerHeight(),e.style.width=this.$el.outerWidth(),this.moveToFitBoundaries(this.$el.parent().height(),this.$el.parent().width(),e.style),r.styleIntToPx(e.style)}else{var o=this.$el[0],n=this._calculateStylePercentage(o.style);e.style=n}},getWidgetIdForInsertBefore:function(){var i=this.$el.height(),o=this.$el.width(),n=this.$el.siblings(":not(.pagetemplateDropZone)"),a=t.find(n,(function(t){if(t._layout){var n=e(t);return n.outerHeight()<i-5||n.outerWidth()<o-5}return!1}));return a?a._layout.model.id:null},isLayoutRelatedToDropZone:function(e){var t={};this.setPreferredLayoutProperties(t);var i,n,a,r;if(this.$el.is(":visible")){var s=o.position(e),d=o.widgetSize(e);i=this.isNear(Math.round(s.top),t.style.top,5),n=this.isNear(Math.round(s.left),t.style.left,5),a=this.isNear(d.height,t.style.height,10),r=this.isNear(d.width,t.style.width,10)}else i=this.isNear(e.style.top,t.style.top,10),n=this.isNear(e.style.left,t.style.left,10),a=this.isNear(e.style.height,t.style.height,10),r=this.isNear(e.style.width,t.style.width,10);return i&&n&&a&&r},addRelatedModel:function(e,t){var i=this.model.relatedLayouts||"|";-1===i.indexOf("|"+e+"|")&&(i+=e+"|"),this.model.set({relatedLayouts:i},{payloadData:t.data}),this.updateRelatedContentState()},hasMaximizedWidget:function(){return!!this.model.relatedLayouts},isWidgetMaximized:function(e){return-1!==(this.model.relatedLayouts||"|").indexOf("|"+e+"|")},removeRelatedModel:function(e,t){var i=this.model.relatedLayouts;i&&-1!==i.indexOf("|"+e+"|")&&("|"===(i=i.replace("|"+e+"|","|"))&&(i=""),this.model.set({relatedLayouts:i},{payloadData:t.data})),this.updateRelatedContentState()},updateRelatedContentState:function(){this.model.relatedLayouts?this.$el.removeClass("empty"):this.$el.addClass("empty")},isNear:function(e,t,i){return Math.abs(parseInt(e,10)-parseInt(t,10))<=i},_calculateStylePercentage:function(e){var t={};return t.top=e.top,t.left=e.left,t.width=100-parseInt(e.right,10)-parseInt(e.left,10)+"%",t.height=100-parseInt(e.bottom,10)-parseInt(e.top,10)+"%",t}})})),define("dashboard-core/js/dashboard/layout/authoring/views/TemplateIndicator",["./Absolute","../../../../lib/@waca/core-client/js/core-client/utils/Deferred"],(function(e,t){var i=null;return i=e.extend({init:function(e){i.inherited("init",this,arguments),this.services=e.services,this.specializeConsumeView(["setPreferredLocation"]),this.$el.parent().addClass("templateDropZoneContainer"),this.whenIsReadyDfd=new t,this.whenIsReadyDfd.resolve()},_initialize:function(){},destroy:function(){this.$el.parent().removeClass("templateDropZoneContainer"),i.inherited("destroy",this,arguments)},setPreferredLocation:function(e){var t=this.model.getParent().id;i.inherited("setPreferredLocation",this,arguments),e.parentId=t},getWidgetContainerNode:function(){return this.domNode.parentNode}})})),define("dashboard-core/js/dashboard/layout/authoring/views/Widget",["./LayoutBaseView"],(function(e){var t=null;return t=e.extend({init:function(e){t.inherited("init",this,arguments),this.widgetChromeEventRouter=e.widgetChromeEventRouter||this.consumeView.widgetChromeEventRouter,this.specializeConsumeView(["getContextToolbarItems","onSelect","onDeselect","onShow"]),this._aHandles=[],this.widgetChromeEventRouter&&this.widgetChromeEventRouter.trigger("widget:onAuthoringMode")},destroy:function(){this.commonAuthoringFeature.destroy();for(var e=0,i=this._aHandles.length;e<i;e++)this._aHandles[e].off();var o;(this._aHandles=null,t.inherited("destroy",this,arguments),this.widgetChromeEventRouter)&&(o=this.layoutController.isEventGroupMode?"widget:onEventGroupMode":"widget:onConsumeMode",this.widgetChromeEventRouter.trigger(o))},onResizeStep:function(){this.commonAuthoringFeature.onResizeStep()},getContextToolbarItems:function(){return{items:this.consumeView.widgetAPI&&!this.consumeView.widgetAPI.getError()?this.consumeView.widgetAPI.getContextToolbarItems():[]}},onSelect:function(e){this.widgetChromeEventRouter&&this.widgetChromeEventRouter.trigger("widgetchrome:selected",e)},onDeselect:function(){this.widgetChromeEventRouter&&this.widgetChromeEventRouter.trigger("widgetchrome:deselected")},onShow:function(e){this.overridden.onShow(e)}})})),define("dashboard-core/js/dashboard/layout/authoring/views/all",["./Absolute","./GenericPage","./Group","./ScalingAbsolute","./Tab","./TemplateContainer","./TemplateDropZone","./TemplateIndicator","./Widget"],(function(){})),define("dashboard-core/js/dashboard/layout/authoring/interaction/BasePropertyAction",["../../../../lib/@waca/core-client/js/core-client/ui/core/Events"],(function(e){var t=null;return t=e.extend({init:function(e){this.controller=e,this.dashboardApi=e.dashboardApi,t.inherited("init",this,arguments)},refreshProperties:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];setTimeout((function(){var i=t.map((function(e){var t=e.getFeature("state");return t.whenStatusChanges(t.STATUS.RENDERED)}));Promise.all(i).then((function(){e.controller.eventRouter.trigger("properties:refreshPane")}))}),100)},updateModel:function(e,t){var i=this,o=this.dashboardApi.getFeature("Transaction"),n=o.startTransaction(t);e.forEach((function(e){var t=i.dashboardApi.getCanvas().getContent(e.id),o=Object.assign(n||{},{validatePropertyValue:!1});Object.keys(e.style).forEach((function(i){t.setPropertyValue(i,e.style[i],n)})),o=Object.assign(n||{},{validatePropertyValue:!0}),Object.keys(e.style).forEach((function(i){t.setPropertyValue(i,e.style[i],o)}))})),o.endTransaction(n)}})})),define("dashboard-core/js/dashboard/layout/authoring/interaction/BaseStylePropertyAction",["./BasePropertyAction"],(function(e){return e.extend({_getWidgetSize:function(e,t){var i=t[0]._layout.widget?t[0]._layout.widget:t[0]._layout;return this._getSize(e,i.$el)},_getWidgetOffset:function(e,t){var i=t[0]._layout.widget?t[0]._layout.widget:t[0]._layout;return this._getOffset(e,i.$el)-this._getOffset(e,t[0]._layout.parentLayout.$el)},_getParentDim:function(e,t){return this._getSize(e,t[0]._layout.parentLayout.$el)},_getSize:function(e,t){return"width"===e?t.width():t.height()},_getOffset:function(e,t){var i=t.offset();return"width"===e?i.left:i.top},_sanitizePercentSizeOnPage:function(e,t){var i=e;i=Math.max(Math.min(100,i),0);var o=0;return this.propertyNodes.forEach((function(e){o=Math.max(o,parseFloat(e._layout.model.style[t]))})),o+i>100&&(i=100-o),i},_updateInputProperty:function(e,t){this.ignoreOnChange=!0,e.setValue(t),e.onChangeValueHold=t,this.ignoreOnChange=!1},getUnitsFromValue:function(e){return e.replace(/[\d.-]/g,"")},getValueString:function(e,t){return String(Number(e.toFixed("px"===t?0:2)))+" "+t},changeProperty:function(e,t){if(e.ignoreOnChange)e.ignoreOnChange=!1;else{var i=parseFloat(this.getValue());if(isNaN(i))e._updateInputProperty(this,this.onChangeValueHold);else{i=e._processChange.apply(e,[t,i,this.units]);var o=e.getValueString(i,this.units);e._updateInputProperty(this,o)}}},wrapChangeProperty:function(){var e=this;return function(){var t=[e].concat(Array.prototype.slice.call(arguments));e.changeProperty.apply(this,t)}},_getValuesForProperties:function(e){var t=this;if(e.forEach((function(e){e.value=e.getProp(t.propertyNodes[0])})),this.propertyNodes.length>1)for(var i=function(i){return e.forEach((function(e){e.break||e.getProp(t.propertyNodes[i])!==e.value&&(e.value="",e.break=!0)})),"break"},o=1;o<this.propertyNodes.length;o++){if("break"===i(o))break}e.forEach((function(e){""!==e.value&&(e.value=t.getValueString(parseFloat(e.value),e.units))}))},showStyleProperties:function(e){var t=e._layout.parentLayout;return!t||!t.model||"group"!==t.model.type},getProperties:function(){this.propertyNodes=this.selectedNodes}})})),define("dashboard-core/js/app/util/ScreenReaderUtil",["jquery","../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t){var i=null;return i=t.extend({INPUTBOX_ID:"boardScreenReaderInputBox",CLEAR_TIMER_DURATION:500,oCallOutClearTimer:null,init:function(){if(i.inherited("init",this,arguments),0===e("#"+this.INPUTBOX_ID).length){var t=document.createElement("div");t.style.width="0px",t.style.height="0px",t.style.overflow="hidden",t.style.position="absolute",t.style.top="-1px",t.style.left="-1px";var o=document.createElement("input");o.type="text",o.id=this.INPUTBOX_ID,o.setAttribute("aria-selected","false"),o.setAttribute("aria-live","assertive"),o.setAttribute("tabIndex","-1"),e(t).append(o),e("body").append(t)}},callOut:function(t){this.oCallOutClearTimer&&clearInterval(this.oCallOutClearTimer),e("#"+this.INPUTBOX_ID).val(t),this.oCallOutClearTimer=setTimeout(function(){e("#"+this.INPUTBOX_ID).val("")}.bind(this),this.CLEAR_TIMER_DURATION)},destroy:function(){e("#"+this.INPUTBOX_ID).parent().remove(),i.inherited("destroy",this,arguments)}})})),define("text!dashboard-core/js/dashboard/layout/authoring/interaction/MoveEdges.html",[],(function(){return'<div edge="t" action="move" class="resizeEdge top move">\n\t<div class="resizePoint resizeHandle moveHandle">\n\t\t<div class="svgContainer">\n\t\t\t<div class="move">\n\t\t\t\t<svg class="svgIcon" xmlns:xlink="http://www.w3.org/1999/xlink" focusable="false">\n\t\t\t\t\t<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#{{!it.moveIcon}}"></use>\n\t\t\t\t</svg>\n\t\t\t</div>\n\t\t</div>\n\t</div>\n</div>\n'})),define("text!dashboard-core/js/dashboard/layout/authoring/interaction/LayoutIndicator.html",[],(function(){return'<div class="layoutDashboardIndicatorContainer">\n\t<div class="layoutDashboardIndicatorContent">\n\t\t<span class="layoutDashboardIndicatorText"></span>\n\t</div>\n</div>\n'})),define("dashboard-core/js/dashboard/layout/authoring/interaction/LayoutIndicator",["doT","../../../../lib/@waca/core-client/js/core-client/ui/core/View","../../../../lib/@waca/core-client/js/core-client/utils/Deferred","jquery","text!./LayoutIndicator.html"],(function(e,t,i,o,n){var a=null;return a=t.extend({OFFSET:30,init:function(e){a.inherited("init",this,arguments),this.$node=e.node},render:function(){var t=e.template(n)();this.$el=o(t),this.$node.prepend(this.$el),this.$node.is("body")?this.containerSize={width:o(window).width(),height:o(window).height()}:this.containerSize={width:this.$node.width(),height:this.$node.height()},this.$content=o(this.$el.find(".layoutDashboardIndicatorText")[0])},updatePosition:function(e){var t,i,o=0,n=0,a=this.$node.scrollLeft(),r=this.$node.scrollTop(),s=e.left+a,d=e.top+r;t=this.containerSize.width-this.$el.width()-50,i=this.containerSize.height-this.$el.height(),t-e.left<0&&(o=t-e.left),i-e.top<0&&(n=i-e.top);var l=s+this.OFFSET+o;l=l>a?l+"px":a+"px";var h=d+this.OFFSET+n;h=h>r?h+"px":r+"px",this.$el.css({top:h,left:l})},updateContent:function(e){this.$content.text(e)},remove:function(){this.$el.remove()},show:function(){this.$el.show()},hide:function(){this.$el.hide()}})})),define("dashboard-core/js/dashboard/layout/authoring/interaction/LayoutGuidelines",["jquery","underscore","../../../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t,i){return i.extend({THRESHOLD:5,setup:function(i,o,n){this._aGuidelines=[],this.snapGuidelines=n,this.domNode=i;var a=e(this.domNode);t.each(a.children(".widget,.pagegroup,.pagetemplateDropZone"),function(t){if(!(o&&o.dragBox&&o.dragBox.ids.indexOf(t.id)>-1)){var n,a,r=e(t),s=r.position(),d=r.is(".pagetemplateDropZone");n=r.outerHeight(),a=r.outerWidth();var l=Math.round(s.left+i.scrollLeft+0),h=Math.round(l+a),c=Math.round(s.top+i.scrollTop+0),u=Math.round(c+n);this._addGuideline("x",l,c,u,d?"left":null),this._addGuideline("x",h,c,u,d?"right":null),this._addGuideline("x",(l+h)/2,c,u),this._addGuideline("y",c,l,h,d?"top":null),this._addGuideline("y",u,l,h,d?"bottom":null),this._addGuideline("y",(c+u)/2,l,h)}}.bind(this)),this._addGuideline("x",i.scrollWidth/2),this._addGuideline("y",i.scrollHeight/2)},_addGuideline:function(t,i,o,n,a){var r=e(this.domNode),s=this.domNode.scrollHeight-10+"px",d=this.domNode.scrollWidth-10+"px",l="x"===t?{left:i+"px",height:s}:{top:i+"px",width:d},h=e('<div class="guidelineMarker1"></div>'),c=e('<div class="guidelineMarker2"></div>');if(void 0!==o&&h.css("x"===t?"top":"left",o-5+"px"),void 0!==n){var u={bottom:"auto",right:"auto"};u["x"===t?"top":"left"]=n-5+"px",c.css(u)}var g=e('<div class="guideline guideline'+t+'"></div>').css(l).append(h).append(c),p={};a&&(p.restricted=a),p[t]=i,p["axis_"+t]=g,this._aGuidelines.push(p),r.append(g)},calculateSnapPoint:function(e,t){var i=null,o={};this._aGuidelines&&this.snapGuidelines&&this._aGuidelines.forEach(function(n){!isNaN(Math.abs(e-n[t]))&&Math.abs(e-n[t])<this.THRESHOLD?(null===i||i>Math.abs(e-n[t]))&&(i=e-n[t],o=n):n[t]&&Math.abs(e-n[t])<this.THRESHOLD&&(i=e-n[t],o=n)}.bind(this));return{distance:i,show:function(){o["axis_"+t].show()}}},getAll:function(){return this._aGuidelines||[]},clear:function(){e(this.domNode).children(".guideline").remove(),this._aGuidelines=null,this.domNode=null}})})),define("dashboard-core/js/dashboard/layout/authoring/interaction/GridGuidelines",["jquery","underscore","../../../../lib/@waca/core-client/js/core-client/ui/core/Class"],(function(e,t,i){return i.extend({gridSize:0,init:function(t){var i=e(t.page);this.layoutController=t.controller;var o=this.layoutController.boardModel.layout.findModel(t.page.id);o||(o=this.layoutController.boardModel.layout),this.snapGrid=o.getValueFromSelfOrParent("snapGrid"),this.snapGrid=void 0!==this.snapGrid&&this.snapGrid;var n=o.getValueFromSelfOrParent("layoutPositioning");"absolute"===n?this.gridSize=10:"relative"===n&&(this.gridSize=this.getGridSize(i))},getGridSize:function(e){var t=0;if(e){var i=e.width();t=e.hasClass("infoGraphic")?i/60:i/100}return t},calculateSnapPoint:function(e){if(this.snapGrid){var t=e%this.gridSize;return t>this.gridSize-.5&&(t=0),{distance:t}}return{distance:null}}})})),define("dashboard-core/js/dashboard/layout/authoring/interaction/GuidelineManager",["jquery","underscore","../../../../lib/@waca/core-client/js/core-client/ui/core/Class","./LayoutGuidelines","./GridGuidelines"],(function(e,t,i,o,n){return i.extend({LayoutGuidelines:{},init:function(e){this.layoutController=e.layoutController,this.layoutGuidelines=new o},getReady:function(e,t,i){this.domNode=e,this.snapContributions=[];var o=this.layoutController.boardModel.layout.findModel(e.id);o||(o=this.layoutController.boardModel.layout);var a=o.getValueFromSelfOrParent("snapObjects");a=void 0===a||a,this.gridGuidelines=new n({page:e,controller:this.layoutController}),i||(this.layoutGuidelines.setup(e,t,a),this.snapContributions.push(this.layoutGuidelines)),this.snapContributions.push(this.gridGuidelines)},finish:function(){e(this.domNode).children(".guideline").remove(),this.domNode=null},getSnapCoordinates:function(e){var t={top:null,right:null,bottom:null,left:null},i=[],o=[],n=[],a=[];return this.snapContributions&&this.snapContributions.forEach(function(t){i.push(t.calculateSnapPoint(e.right,"x")),o.push(t.calculateSnapPoint(e.left,"x")),n.push(t.calculateSnapPoint(e.top,"y")),a.push(t.calculateSnapPoint(e.bottom,"y"))}.bind(this)),t.right=this._calculateClosestSnapPoint(i,"x"),t.left=this._calculateClosestSnapPoint(o,"x"),t.top=this._calculateClosestSnapPoint(n,"y"),t.bottom=this._calculateClosestSnapPoint(a,"y"),t},_calculateClosestSnapPoint:function(e){var t=null;return e.forEach(function(e){e.distance&&t?t.distance>Math.abs(e.distance)&&(t=e):e.distance&&!t&&(t=e)}.bind(this)),t&&t.distance?(t.show&&t.show(),t.distance):t},hideAll:function(){e(this.domNode).children(".guideline").hide()}})})),define("dashboard-core/js/dashboard/layout/authoring/interaction/Move",["./BaseStylePropertyAction","../../../../lib/@waca/core-client/js/core-client/utils/Deferred","jquery","doT","../EventHelper","../../../../lib/@waca/dashboard-common/dist/ui/interaction/Utils","../../../../lib/@waca/core-client/js/core-client/ui/KeyCodes","../../../../app/util/ScreenReaderUtil","../../../../app/nls/StringResources","text!./MoveEdges.html","./LayoutIndicator","./GuidelineManager","../../../util/PxPercentUtil","../../../../lib/@waca/core-client/js/core-client/i18n/Formatter","../../../../lib/@waca/dashboard-common/dist/utils/EventChainLocal","underscore","bspopover"],(function(e,t,i,o,n,a,r,s,d,l,h,c,u,g,p,f){var m=null;return m=e.extend({_savedSelectedNodes:null,init:function(e){var i=this;m.inherited("init",this,arguments),this.controller=e,this.isDragging=!1,this._isTouch=!1,this.dropInfo={},this._guidelineManager=new c({layoutController:e.layoutController}),this._ScreenReader=new s,this.whenIsReadyDfd=new t,this._createAvatarContainer(),this._layoutIndicator=new h({node:this._$avatarContainer}),this._initialize(),this._updateLayoutIndicatorContent=f.throttle((function(e,t,o,n,a){var r=o.node;if(r&&r._layout&&r._layout.layoutController){var s=a.dropTargetNode,d=r._layout.layoutController.getLayoutContentContainerForDropTarget(s),l=i._convertCoordinates(t,e.clientX-t.offsetx-n.x,e.clientY-t.offsety-n.y,d),h=i._formatPosition(r,l,d);i._layoutIndicator.updateContent("x: "+h.left+"  y: "+h.top)}}),250)},_createAvatarContainer:function(){this._$avatarContainer=i("body").children(".avatarContainer.avatarContainerNotDragging"),0===this._$avatarContainer.length&&(this._$avatarContainer=i('<div class="avatarContainer avatarContainerNotDragging"></div>'),i("body").append(this._$avatarContainer))},getAvatarContainer:function(){return this._$avatarContainer},whenIsReady:function(){return this.whenIsReadyDfd.promise},_initialize:function(){this._dndManager=this.controller.dashboardApi.getFeature("DashboardDnd.internal"),this.whenIsReadyDfd.resolve()},destroy:function(){this._dndManager&&(this._dndManager.resetDragging(),this._dndManager=null),this.resetDraggingState(),this._ScreenReader.destroy(),this._iKeyPressTimer&&clearTimeout(this._iKeyPressTimer),this._$avatarContainer.empty()},setupStartEventHandlers:function(){for(var e,t=this.dragStartMouseEvent.bind(this),i=this.initiateDragging.bind(this),o=0;o<this.selectedNodes.length;o++)(e=this.selectedNodes[o])._events=[],e._events.push(n.on(e,"touchstart",i)),e._events.push(n.on(e,"mousedown",t))},clearStartEventHandlers:function(){for(var e,t=0;t<this.selectedNodes.length;t++)(e=this.selectedNodes[t])._events&&(a.removeEvents(e._events),e._events=null)},newSelection:function(e,t){this._resetSelectionState(),this.selectedNodes=e,this._savedSelectedNode=e,this.dropInfo.nodeInfoList=[];for(var i=0;i<e.length;i++)this.dropInfo.nodeInfoList.push({node:e[i]});this.setupStartEventHandlers(),t&&("mousedown"===t.type||"hold"===t.type||"touchstart"===t.type)&&this.selectedNodes.length>0&&this.initiateDragging(t),e.length>0?this.controller.$el.on("keydown.interactionMoveKey",this.arrowKeyPress.bind(this)):this.controller.$el.off("keydown.interactionMoveKey"),this.addMoveHandle(e)},addMoveHandle:function(e){var t=this.controller.dashboardApi.getFeature("Icons").getIcon("move"),n=o.template(l)({moveIcon:t.id});i(e).append(n).find(".moveHandle").attr("title",d.get("moveHandle"))},saveNodeInfo:function(){for(var e=0,t=this.dropInfo.nodeInfoList.length;e<t;e++)this.setNodePositionInfo(this.dropInfo.nodeInfoList[e])},_iKeyPressTimer:null,_isValidEventForArrowKeyPress:function(e){var t=i(e.target);if(e.keyCode===r.LEFT_ARROW||e.keyCode===r.RIGHT_ARROW||e.keyCode===r.UP_ARROW||e.keyCode===r.DOWN_ARROW){var o=0!==t.closest(".ba-common-tabList").length,n=new p(e),a=i(".dashboardFrameCentre").children(".page").has(e.target).length>0;return!(e.shiftKey||t.hasClass("inlineText")||t.parents().hasClass("widgetFocus")||n.getProperty("preventMoveAction")||o)&&a}return!1},_calculateInitDeltasForArrowKeyPress:function(e){var t=0,i=0,o="",n=!1;switch(e.keyCode){case r.LEFT_ARROW:i=-1,o=d.get("srWidgetMoveLeft");break;case r.UP_ARROW:t=-1,o=d.get("srWidgetMoveUp");break;case r.RIGHT_ARROW:i=1,o=d.get("srWidgetMoveRight"),n=!0;break;case r.DOWN_ARROW:t=1,o=d.get("srWidgetMoveDown"),n=!0}return{iDeltaTop:t,iDeltaLeft:i,farEdge:n,sMessage:o}},_calculatePositionUpdateForNodeWhenArrowKeyPress:function(e,t,o){var n=t.iDeltaTop,a=t.iDeltaLeft,r=t.farEdge,s={left:parseInt(i(e).css("left")),top:parseInt(i(e).css("top"))},d=0,l=0,h={top:s.top,left:s.left,right:s.left+e.clientWidth,bottom:s.top+e.clientHeight},c=o.node._layout.layoutController.getLayoutContentContainer();this._guidelineManager.getReady(c,h,!0);var u=this._getNewCoordinates(h),g=this.getRevisedOffsets(u);return this._guidelineManager.gridGuidelines&&this._guidelineManager.gridGuidelines.snapGrid?(r&&(g.x=this._guidelineManager.gridGuidelines.gridSize-g.x,g.y=this._guidelineManager.gridGuidelines.gridSize-g.y),g.x<=1&&(g.x=0),g.y<=1&&(g.y=0),g.x=null===g.x||0===g.x?this._guidelineManager.gridGuidelines.gridSize:g.x,g.y=null===g.y||0===g.y?this._guidelineManager.gridGuidelines.gridSize:g.y,d=a*g.x,l=n*g.y):(d=a,l=n),o.dropPosition={x:s.left+d,y:s.top+l,before:o.oldValues.nextSibling},o.node._layout.parentLayout.getWidgetPositionUpdate(o)},_updateModelAfterArrowKeyPress:function(e,t){clearTimeout(this._iKeyPressTimer),this._iKeyPressTimer=setTimeout(function(){this.emit("move:end",{currentSelection:this.selectedNodes}),this.updateModel(e),this.refreshProperties(),this._ScreenReader.callOut(t)}.bind(this),500)},_moveNodesForArrowKeyPress:function(e){for(var t=[],i=[],o=this._calculateInitDeltasForArrowKeyPress(e),n=0,a=this.dropInfo.nodeInfoList.length;n<a;n++){var r=this.dropInfo.nodeInfoList[n];if(r.node._layout){var s=this.dropInfo.nodeInfoList[n].node,d=this._calculatePositionUpdateForNodeWhenArrowKeyPress(s,o,r);t.push(d),i.push({node:s,newPosition:{top:parseInt(d.style.top,10),left:parseInt(d.style.left,10)}})}}return this.moveNodesToNewPositions(i),{positionUpdateArray:t,sMessage:o.sMessage}},moveNodesToNewPositions:function(e){for(var t=0;t<e.length;t++){var i=e[t],o=i.node,n=i.newPosition;a.setTopLeft(o,n.top,n.left)}},arrowKeyPress:function(e){if(this._isValidEventForArrowKeyPress(e)){e.preventDefault(),this.emit("move:start",{currentSelection:this.selectedNodes}),this.saveNodeInfo();var t=this._moveNodesForArrowKeyPress(e),i=t.positionUpdateArray,o=t.sMessage;this._updateModelAfterArrowKeyPress(i,o)}},_resetSelectionState:function(){this.selectedNodes&&(this._dndManager&&this._dndManager.resetDragging(),this.dropInfo={},this.clearStartEventHandlers())},dragStopEvent:function(e,t){this.isDragging&&(this._showingLayoutIndicator=!1,this.handleDrop(t),this.resetDraggingState(),this._$avatarContainer[0].className="avatarContainer avatarContainerNotDragging",this.$lastFocus.focus(),this.controller.eventRouter.trigger("widget:stopMove"),this.emit("move:end",{currentSelection:this.selectedNodes}),this.refreshProperties(),this._guidelineManager.hideAll(),this._guidelineManager.finish(),this._layoutIndicator.remove())},resetDraggingState:function(){this.isDragging=!1,i(this.selectedNodes).removeClass("nodeDragging"),this.dropInfo.operation=null},handleDrop:function(){},dragStartMouseEvent:function(e){if(this._isTouch)return!1;("mousedown"!==e.type||1===(e.buttons||e.which)&&!e.ctrlKey)&&this.initiateDragging(e)},initiateDragging:function(e,t){var o=1===i(e.target).closest(".moveHandle").length,n=0===i(e.target).closest(".widgetContent").length;if(!o&&!n)return!0;e.preventDefault(),this.saveNodeInfo(),this._isTouch=e.isTouch,this.$lastFocus=i(":focus");var a,r=null;r=t||this._getTargetWidgetNode(e),!i(r).hasClass("moveDisabled")&&r&&(a=r._layout?r._layout.parentLayout.domNode:null,this._dndManager.startDrag({event:e,type:this.getDragDataType(),data:this.dropInfo,avatar:null,callerCallbacks:{onMove:this.dragMoveEvent.bind(this),onDragDone:this.dragStopEvent.bind(this)},moveXThreshold:3,moveYThreshold:3,currentDropZoneNode:a}))},_getTargetWidgetNode:function(e){var t=i(e.target);if(!t.is(".widget")){var o=t.parents(".widget");t=o.length?o:t.parents(".pagegroup")}return t[0]},getDragDataType:function(){return null},dragMoveEvent:function(e,t){var o=this;n.fixEvent(e);var r=void 0,s=void 0;if(!this.isDragging){this._$avatarContainer[0].className="avatarContainer avatarContainerDragging",this.emit("move:start",{currentSelection:this.selectedNodes}),this.prepareDropInfo(this.dropInfo),this.isDragging=!0;var d=[],l=[];for(r=0,s=this.dropInfo.nodeInfoList.length;r<s;r++){var h=this.dropInfo.nodeInfoList[r];d.push(h.node);var c=h.node.getBoundingClientRect();this.prepareNodeForMove(h.node),l.push(h.node);var u=h.node.parentNode.getBoundingClientRect(),g=a.getRotatedCoordinates(h.node.parentNode,e.clientX,e.clientY,u);i(h.node).addClass("nodeDragging"),a.setTopLeft(h.node,g.y,g.x);var p={top:i(h.node).position().top-h.node.offsetTop,left:i(h.node).position().left-h.node.offsetLeft};h.offsety=t.dragObject.startPosition.y-c.top+p.top,h.offsetx=t.dragObject.startPosition.x-c.left+p.left,h.parentNodeRect=u,h.position=c}if(this.dropInfo.dragBoxSize=this._calculateBoxSize(this.dropInfo.nodeInfoList),t.dragObject&&t.dropTargetNode){t.dropTargetNodeOffset=i(t.dropTargetNode).offset();var f=this._convertCoordinates(this.dropInfo.dragBoxSize,e.clientX-this.dropInfo.dragBoxSize.offsetx,e.clientY-this.dropInfo.dragBoxSize.offsety,t.dropTargetNode,t.dropTargetNodeOffset);t.dragObject.dragBox=f,t.dragObject.dragBox.ids=this.getIds(this.dropInfo.nodeInfoList).ids,this._guidelineManager.getReady(t.dropTargetNode,t.dragObject),this.postNodeForMove(l)}this.controller.eventRouter.trigger("widget:startMove",{selectedNodes:d}),i(".popover").popover("hide"),this.dropInfo.nodeInfoList.length>0&&(this._showingLayoutIndicator=!1,setTimeout((function(){o._layoutIndicator.render(),o._layoutIndicator.show(),o._showingLayoutIndicator=!0}),150))}var m=this._preMoveNode(this.dropInfo.dragBoxSize,t,e,this.dropInfo.nodeInfoList[0]);for(r=0,s=this.dropInfo.nodeInfoList.length;r<s;r++)this.moveNode(this.dropInfo.nodeInfoList[r],e,t,m);return!1},_calculateBoxSize:function(e){var t,i={top:Number.MAX_SAFE_INTEGER,left:Number.MAX_SAFE_INTEGER,bottom:Number.MIN_SAFE_INTEGER,right:Number.MIN_SAFE_INTEGER,offsety:0,offsetx:0,width:0,height:0},o=void 0;for(o=0,t=e.length;o<t;o++){var n=e[o];n.position.top<i.top&&(i.top=n.position.top,i.offsety=n.offsety),n.position.left<i.left&&(i.left=n.position.left,i.offsetx=n.offsetx),n.position.bottom>i.bottom&&(i.bottom=n.position.bottom),n.position.right>i.right&&(i.right=n.position.right)}return i.width=i.right-i.left,i.height=i.bottom-i.top,i},_preMoveNode:function(e,t,o,n){var a={x:0,y:0};if(t.dropTargetNode&&n.node._layout){t.dropTargetNodeOffset=i(t.dropTargetNode).offset();var r=this._convertCoordinates(e,o.clientX-e.offsetx,o.clientY-e.offsety,t.dropTargetNode,t.dropTargetNodeOffset),s=this._getNewCoordinates(r);a=this.getRevisedOffsets(s)}return this._showingLayoutIndicator&&n.node._layout&&(this._layoutIndicator.updatePosition({top:o.clientY,left:o.clientX}),this._updateLayoutIndicatorContent(o,e,n,a,t)),a},prepareDropInfo:function(){},prepareNodeForMove:function(e){return e},postNodeForMove:function(){},getSelectedDomNodes:function(){var e,t,i,o=[];for(e=0,t=this.dropInfo.nodeInfoList.length;e<t;e++)i=this.dropInfo.nodeInfoList[e],o.push(i.node);return o},moveNode:function(e,t,i,o){var n,r=e.node;n=a.getRotatedCoordinates(r.parentNode,t.clientX-e.offsetx-o.x,t.clientY-e.offsety-o.y,e.parentNodeRect),a.setTopLeft(r,n.y,n.x),this.handleMove(e,n,i)},_formatPosition:function(e,t,o){if(e._layout)if("relative"===e._layout.model.getValueFromSelfOrParent("layoutPositioning")){var n={top:t.top+"px",left:t.left+"px"},a={width:i(o).width(),height:i(o).height()};u.changePixelPropertiesToPercent(n,a,1),t.top=g.formatNumber(n.top.replace(/%/g,""))+" %",t.left=g.formatNumber(n.left.replace(/%/g,""))+" %"}else t.top=g.formatNumber(t.top)+" "+d.get("pixelUnit")+" ",t.left=g.formatNumber(t.left)+" "+d.get("pixelUnit")+" ";return t},getIds:function(e){return e.reduce((function(e,t){return e.ids.push(t.node.id),e}),{ids:[]})},getRevisedOffsets:function(e){var t={};return null===e.left?t.x=e.right:null===e.right?t.x=e.left:t.x=Math.abs(e.left)<Math.abs(e.right)?e.left:e.right,null===e.top?t.y=e.bottom:null===e.bottom?t.y=e.top:t.y=Math.abs(e.bottom)<Math.abs(e.top)?e.bottom:e.top,t},_convertCoordinates:function(e,t,o,n,a){var r={};if(n){var s=a||i(n).offset(),d=Math.round(t-s.left+n.scrollLeft),l=Math.round(o-s.top+n.scrollTop);r={top:l,right:d+e.width,bottom:l+e.height,left:d,center_x:d+e.width/2,center_y:l+e.height/2}}return r},_getNewCoordinates:function(e){return this._guidelineManager.hideAll(),this._guidelineManager.getSnapCoordinates(e)},handleMove:function(){},setNodePositionInfo:function(e){var t=e.node;for(e.oldValues={top:t.style.top,left:t.style.left,height:t.style.height,width:t.style.width,parent:t.parentElement,nextSibling:t.nextSibling};e.oldValues.nextSibling&&this.selectedNodes.indexOf(e.oldValues.nextSibling)>-1;)e.oldValues.nextSibling=e.oldValues.nextSibling.nextSibling}})})),define("dashboard-core/js/dashboard/layout/authoring/interaction/MoveWidgets",["./Move","../../../../lib/@waca/dashboard-common/dist/ui/interaction/Utils","jquery","../../../../lib/@waca/core-client/js/core-client/utils/BrowserUtils"],(function(e,t,i,o){var n=e.extend({init:function(){n.inherited("init",this,arguments),this.isIE=o.isIE()},getDragDataType:function(){return"widget"},handleDrop:function(e){e.isDropped||this.restoreOriginalPosition(),e.dragObject&&i(e.dragObject.data.nodeInfoList[0].node).parent().css("overflow","visible")},restoreOriginalPosition:function(){for(var e,t=this.dropInfo.nodeInfoList,i=0,o=t.length;i<o;i++){var n=t[i];e=n.node,n.oldValues.parent?(n.oldValues.parent.insertBefore(e,n.oldValues.nextSibling),e.style.left=n.oldValues.left,e.style.top=n.oldValues.top,e.style.height=n.oldValues.height,e.style.width=n.oldValues.width):e.parentNode.removeChild(e)}},prepareDropInfo:function(e){e.operation="move"},prepareNodeForMove:function(e){var t=i(e);return t.height(t.height()),t.width(t.width()),this._isIpadVersion13orGreater()||(t.parent().css("overflow","hidden"),this.getAvatarContainer().append(e)),e},postNodeForMove:function(e){this.isIE&&this.emit("moveWidgets:start",{nodes:e})},handleMove:function(e,o,n){var a=n.dropTargetNode;if(a){var r=i(e.node),s=void 0;s=this._isIpadVersion13orGreater()?{left:0,top:0}:n.dropTargetNodeOffset||i(a).offset();var d=Math.round(o.x-s.left+a.scrollLeft),l=Math.round(o.y-s.top+a.scrollTop),h=t.widgetSize(r);e.dropPosition={x:d,y:l,height:h.height,width:h.width,center_x:d+r.outerWidth()/2,center_y:l+r.outerHeight()/2,before:a===e.oldValues.parent?e.oldValues.nextSibling:null}}},dragMoveEvent:function(){n.inherited("dragMoveEvent",this,arguments)},dragStopEvent:function(){n.inherited("dragStopEvent",this,arguments),this.isIE&&this.emit("moveWidgets:end",{nodes:this.getSelectedDomNodes()})},_isIpadVersion13orGreater:function(){var e=window.navigator.userAgent.match(/ipad.*os\s((\d+_?){2,3})\s/i),t=e?e[1].split("_"):null;return!!t&&parseInt(t[0],10)>12}});return n})),define("dashboard-core/js/dashboard/layout/authoring/interaction/MoveGroupContent",["./Move","jquery"],(function(e,t){var i=null;return i=e.extend({init:function(){i.inherited("init",this,arguments)},getDragDataType:function(){return"groupContent"},handleDrop:function(){for(var e,i,o=[],n=0,a=this.dropInfo.nodeInfoList.length;n<a;n++)if(i=this.dropInfo.nodeInfoList[n],e=t(i.node),i.node._layout){i.dropPosition={x:parseInt(e.css("left"),10),y:parseInt(e.css("top"),10)};var r=i.node._layout.parentLayout.getWidgetPositionUpdate(i);o.push(r)}var s=this.dashboardApi.getFeature("Transaction"),d=s.startTransaction();this.updateModel(o,d),this.emit("moveGroupContent:done",{currentSelection:this.selectedNodes,undoRedoTransactionId:d.transactionId,transactionToken:d}),s.endTransaction(d)}})})),define("text!dashboard-core/js/dashboard/layout/authoring/interaction/ResizeEdges.html",[],(function(){return'{{?it.hasSelectionBox}}\n<div edge="t" class="resizeEdge top">\n\t<div class="resizePoint resizeHandle"></div>\n</div>\n<div edge="r" class="resizeEdge right">\n\t<div class="resizePoint resizeHandle"></div>\n</div>\n<div edge="b" class="resizeEdge bottom">\n\t<div class="resizePoint resizeHandle"></div>\n</div>\n<div edge="l" class="resizeEdge left">\n\t<div class="resizePoint resizeHandle"></div>\n</div>\n<div edge="tr" class="resizeEdge topRight {{?it.focusModeDisabled}}focusModeDisabled{{?}}">\n\t<div class="resizePoint {{?it.rotateHandle}}resizeHandle{{?}}"></div>\n</div>\n<div edge="br" class="resizeEdge bottomRight">\n\t<div class="resizePoint resizeHandle {{?it.isMobile}}scaleCorner{{?}}">\n\t\t{{?it.isMobile}}\n\t\t<div class="svgContainer">\n\t\t\t<svg class="scale" role="img">\n\t\t\t\t<use style="pointer-events: none;" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#common-scale"></use>\n\t\t\t</svg>\n\t\t</div>\n\t\t{{?}}\n\t</div>\n</div>\n<div edge="bl" class="resizeEdge bottomLeft">\n\t<div class="resizePoint resizeHandle {{?it.isMobile}}rotateCorner{{?}}">\n\t\t{{?it.isMobile}}\n\t\t<div class="svgContainer">\n\t\t\t<svg class="rotate" role="img">\n\t\t\t\t<use style="pointer-events: none;" xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#common-rotate"></use>\n\t\t\t</svg>\n\t\t</div>\n\t\t{{?}}\n\t</div>\n</div>\n<div edge="tl" class="resizeEdge topLeft">\n\t<div class="resizePoint resizeHandle"></div>\n</div>\n{{??}}\n<div edge="r" class="resizeEdge right">\n\t<div class="resizePoint resizeHandle"></div>\n</div>\n<div edge="l" class="resizeEdge left">\n\t<div class="resizePoint resizeHandle"></div>\n</div>\n{{?}}\n<div class="resizeEdge tl"></div>\n<div class="resizeEdge tr"></div>\n<div class="resizeEdge bl"></div>\n<div class="resizeEdge br"></div>\n{{?it.rotateHandle}}\n{{?it.hasSelectionBox}}\n<div edge="tr-r" class="resizeEdge rotateEdge topRight">\n\t<div class="rotateHandle {{?it.isMobile}}large{{?}}"></div>\n</div>\n<div edge="br-r" class="resizeEdge rotateEdge bottomRight">\n\t<div class="rotateHandle {{?it.isMobile}}large{{?}}"></div>\n</div>\n<div edge="bl-r" class="resizeEdge rotateEdge bottomLeft">\n\t<div class="rotateHandle {{?it.isMobile}}large{{?}}"></div>\n</div>\n<div edge="tl-r" class="resizeEdge rotateEdge topLeft">\n\t<div class="rotateHandle {{?it.isMobile}}large{{?}}"></div>\n</div>\n{{??}}\n<div edge="tr-r" class="resizeEdge rotateEdge left">\n\t<div class="rotateHandle rotateLineRight {{?it.isMobile}}large{{?}}"></div>\n</div>\n<div edge="br-r" class="resizeEdge rotateEdge right">\n\t<div class="rotateHandle rotateLineLeft {{?it.isMobile}}large{{?}}"></div>\n</div>\n{{?}}\n{{?}}\n'})),define("text!dashboard-core/js/dashboard/layout/authoring/interaction/SizeIndicator.html",[],(function(){return'<div class="sizeDashboardIndicatorContainer">\n\t<div class="sizeDashboardIndicatorContent">\n\t\t<h2></h2>\n\t\t<span class="sizeDashboardIndicatorText"></span>\n\t\t<h2></h2>\n\t</div>\n</div>\n'})),define("dashboard-core/js/dashboard/layout/authoring/interaction/SizeIndicator",["doT","../../../../lib/@waca/core-client/js/core-client/ui/core/View","../../../../lib/@waca/core-client/js/core-client/utils/Deferred","jquery","text!./SizeIndicator.html"],(function(e,t,i,o,n){var a=null;return a=t.extend({OFFSET:25,init:function(e){a.inherited("init",this,arguments),this.$node=e.node},render:function(){var t=e.template(n)();this.$el=o(t),this.$node.prepend(this.$el),this.$content=o(this.$el.find(".sizeDashboardIndicatorText")[0])},updatePosition:function(e,t,i){var o,n;o=e.top+this.$node.scrollTop()-t.top,n=e.left+this.$node.scrollLeft()-t.left,o-this.OFFSET>=0?i?(this.$el.addClass("vertical"),this.$el.css({top:o,left:n+e.width+this.OFFSET})):this.$el.css({top:o-this.OFFSET,left:n}):i?n>=0?(this.$el.addClass("vertical"),this.$el.css({top:o,left:n+e.width+this.OFFSET})):this.$el.hide():this.$el.css({top:o+e.height+this.OFFSET/2,left:n})},updateContent:function(e,t){this.$content.text(t),this.$el.width(e)},remove:function(){this.$el.remove()},show:function(){this.$el.show()},hide:function(){this.$el.hide()}})})),define("dashboard-core/js/dashboard/layout/authoring/interaction/Resize",["./BaseStylePropertyAction","jquery","../EventHelper","../../../../lib/@waca/dashboard-common/dist/ui/interaction/Utils","./GuidelineManager","underscore","text!./ResizeEdges.html","../../../../app/util/ScreenReaderUtil","../../../../app/nls/StringResources","doT","../../../../lib/@waca/core-client/js/core-client/utils/BrowserUtils","../../../../lib/@waca/core-client/js/core-client/i18n/Formatter","./LayoutIndicator","./SizeIndicator","../../../util/PxPercentUtil","bspopover"],(function(e,t,i,o,n,a,r,s,d,l,h,c,u,g,p){var f={"dashboard-core/js/dashboard/widgets/staticwidget/TextWidget":{minWidth:100,minHeight:40},default:{minWidth:25,minHeight:25}},m=e.extend({sizeIndicators:[],containerOffset:0,init:function(e){m.inherited("init",this,arguments),this.dashboardApi=e.dashboardApi,this.canvas=this.dashboardApi.getFeature("Canvas"),this._isTouch=!1,this.resizingEvents=[],this._guidelineManager=new n({layoutController:e.layoutController}),this._ScreenReader=new s,this._observerUpdateDelay=null,this._observer=new window.MutationObserver(this.rotationMutationObserver.bind(this)),this._focusModeDisabled=e.config&&e.config.focusModeDisabled;var t=this.dashboard&&this.dashboard.getGlassCoreSvc&&this.dashboard.getGlassCoreSvc(".FeatureChecker");this.isPropertiesV2Enabled=t&&t.checkValue("dashboard","PropertiesV2","enabled")},destroy:function(){this._ScreenReader.destroy(),m.inherited("destroy",this,arguments)},addPositionIndicator:function(){this._layoutIndicator.render()},updatePositionIndicator:function(e,t){var i;this._layoutIndicator.updatePosition(e),i=d.get("widthUnit")+": "+t.width+"   "+d.get("heightUnit")+": "+t.height,this._layoutIndicator.updateContent(i)},updatePositionIndicatorRotate:function(e,t){t<0&&(t+=360);var i;this._layoutIndicator.updatePosition(e),i=c.formatNumber(String(t.toFixed(1)))+"",this._layoutIndicator.updateContent(i)},removePositionIndicator:function(){this._layoutIndicator.remove()},newSelection:function(e){this.resizeStopEvent(),this.selectedNodes&&(this.removeResizeBorders(this.selectedNodes),this._destroyResizeIndicators(),this._layoutIndicator&&this._layoutIndicator.remove()),this.selectedNodes=e,e.length>0?this.controller.$el.on("keydown.interactionResizeKey",this.resizeRotateKeyPress.bind(this)):this.controller.$el.off("keydown.interactionResizeKey"),this.addResizeBorders(e),this.addResizeIndicators(e)},_iKeyPressTimer:null,resizeRotateKeyPress:function(e){var t=this;if(e.shiftKey&&(!e.target||"inlineText"!==e.target.className)){var i=this._getNodesForResize();if(!e.altKey||(i=i.filter((function(e){return!t.preventRotate(e)}))).length){var n,a,r,s=0,l=0,h=0,c="",u="";switch(e.keyCode){case 37:s=-1,h=-1,c=d.get("srWidgetResizeSmallerH"),u=d.get("srWidgetRotateCCW");break;case 38:l=-1,h=-1,c=d.get("srWidgetResizeSmallerV"),u=d.get("srWidgetRotateCCW");break;case 39:s=1,h=1,c=d.get("srWidgetResizeBiggerH"),u=d.get("srWidgetRotateCW");break;case 40:l=1,h=1,c=d.get("srWidgetResizeBiggerV"),u=d.get("srWidgetRotateCW");break;default:return}this.emit("resize:start",{currentSelection:this.selectedNodes});var g={},p=[],m="";return i.forEach((function(i){var v=0,y=0;if(e.altKey)r=Math.round(o.getAngleDegree(i)+h),g={rotateAngle:r},o.setRotateTransform(i,r),m=u;else{e.ctrlKey&&(l=s=s||l,c=d.get(s>0?"srWidgetResizeBigger":"srWidgetResizeSmaller"));var b=t._getParentGenericPage(i.id),_={top:i.offsetTop,left:i.offsetLeft,right:i.offsetLeft+i.clientWidth,bottom:i.offsetTop+i.clientHeight};t._guidelineManager.getReady(b.domNode,_,!0);var w=t._guidelineManager.getSnapCoordinates(_),C={};t._guidelineManager.gridGuidelines.snapGrid?(C.x=t._guidelineManager.gridGuidelines.gridSize-w.right,C.y=t._guidelineManager.gridGuidelines.gridSize-w.bottom,C.x<.5&&(C.x=0),C.y<.5&&(C.y=0),C.x=null===C.x||0===C.x?t._guidelineManager.gridGuidelines.gridSize:C.x,C.y=null===C.y||0===C.y?t._guidelineManager.gridGuidelines.gridSize:C.y,v=s*C.x,y=l*C.y):(v=s,y=l);var x=o.widgetSize(i);if(n=x.width+v,a=x.height+y,n<f.default.minWidth||a<f.default.minHeight)return;g={width:n+"px",height:a+"px"},i.style.width=n+"px",i.style.height=a+"px",m=c}i._layout&&p.push({style:g,id:i._layout.model.id})})),this._iKeyPressTimer&&clearTimeout(this._iKeyPressTimer),this._iKeyPressTimer=setTimeout(function(){var e=this.dashboardApi.getFeature("Transaction"),t=e.startTransaction();this.updateModel(p,t),this.refreshProperties(),this.emit("resize:done",{currentSelection:i,undoRedoTransactionId:t.transactionId,transactionToken:t}),e.endTransaction(t),this._ScreenReader.callOut(m)}.bind(this),500),!1}}},preventRotate:function(e){return t(e).hasClass("noRotate")},addResizeBorders:function(e){var i=this,o=l.template(r);a.each(e,(function(e){var n=t(e),a=o({rotateHandle:!i.preventRotate(e),isMobile:h.isIPad(),focusModeDisabled:i._focusModeDisabled,hasSelectionBox:!e.classList.contains("shapesLine")});n.append(a),n.find(".resizeHandle").attr("title",d.get("resize")),n.find(".rotateHandle").attr("title",d.get("rotate")),i.addRotationClass(e),i.attachEventHandlers(e)}))},_showResizeIndicators:function(e,t){var i=this;e.getBoundingClientRect&&this.sizeIndicators.forEach((function(o){if(o.node.id===e.id){var n=e.getBoundingClientRect();o.height.updatePosition(n,i.containerNodeOffset,!0),o.height.updateContent(n.height,t.height),o.height.show(),o.width.updatePosition(n,i.containerNodeOffset,!1),o.width.updateContent(n.width,t.width),o.width.show()}}))},_destroyResizeIndicators:function(){this.sizeIndicators.forEach((function(e){e.height.remove(),e.width.remove()}))},_hideResizeIndicators:function(){this.sizeIndicators.forEach((function(e){e.height.hide(),e.width.hide()}))},addResizeIndicators:function(e){var t=this;Array.isArray(e)&&e.forEach((function(e){var i=t._getParentGenericPage(e.id),o=new g({node:i.$el}),n=new g({node:i.$el});o.render(),n.render(),o.hide(),n.hide(),t.sizeIndicators.push({node:e,height:o,width:n})}))},removeResizeBorders:function(e){var i,o;for(this._observer.disconnect(),this._observerUpdateDelay&&window.clearTimeout(this._observerUpdateDelay),i=0,o=e.length;i<o;i++)e[i]._isTopResizeParent=null;t(e).removeClass("resize").children(".resizeEdge:not(.resizeEdgeBorder)").remove(),this.removeRotationClass(e)},attachEventHandlers:function(e){this._observer.observe(e,{attributes:!0});for(var o=t(e).children(".resizeEdge:not(.resizeEdgeBorder)"),n=this.resizeStartEvent.bind(this),a=0;a<o.length;a++)i.on(o[a],"touchstart",n),i.on(o[a],"mousedown",n),i.on(o[a],"tap",this.onTap.bind(this))},onTap:function(e){t(e.currentTarget).hide();var i=document.elementFromPoint(e.clientX,e.clientY);t(e.currentTarget).show(),i!==e.currentTarget&&t(i).trigger(e)},resizeStartEvent:function(e){if(this.isResizeMouseGesture(e)){this.lastClientX=e.clientX,this.lastClientY=e.clientY;var t=this._getParentGenericPage(e.currentTarget.parentNode.id);this.containerNodeOffset=t.$el.offset(),this.initiateResizing(e),e.stopPropagation(),e.preventDefault()}},isResizeMouseGesture:function(e){var t=this._isTouch&&!e.isTouch,i="mousedown"===e.type&&(1!==(e.buttons||e.which)||e.ctrlKey);return!t&&!i},initiateResizing:function(e){this.lastClientX=e.clientX,this.lastClientY=e.clientY,this._isResizing=!0,this._isTouch=e.isTouch,this.nResizeEdge=e.currentTarget,this.resizePointCenter=o.getCenter(this.nResizeEdge),this.setupResizingEventHandlers(),this.nodeAngle=o.getAngleDegree(this.nResizeEdge.parentNode),t(".popover").popover("hide");for(var i,n=this._getNodesForResize(),a=0;a<n.length;a++){if(i=n[a],n.length>=1){var r=this._getParentGenericPage(i.id);this._layoutIndicator=new u({node:r.$el}),this.addPositionIndicator(),this._layoutIndicator.hide()}t(i).addClass("nodeResizing"),this.saveOldValues(i)}this.lastBox=this._getDragBox(n),this.emit("resize:start",{currentSelection:this.selectedNodes})},redrawResizeBorders:function(e){(e=e||{}).nodes&&(this.removeResizeBorders(e.nodes),this.addResizeBorders(e.nodes))},_findScrollableParent:function(e){var i=null;if(e){var o=t(e.domNode).css("overflow");i="auto"===o||"scroll"===o?e.domNode:this._findScrollableParent(e.parentLayout)}return i},_getScrollInfo:function(){var e=null,i=this._findScrollableParent(this._getParentLayout());if(i){var o=t(i),n=o.height(),a=o.width(),r=o.offset();e={left:r.left,top:r.top,position:o.position(),h:n,w:a,scrollTop:o.scrollTop(),scrollLeft:o.scrollLeft(),$node:o}}return e},_getNodesForResize:function(){return this.nResizeEdge&&this.nResizeEdge.parentNode&&this.nResizeEdge.parentNode._isTopResizeParent?[this.nResizeEdge.parentNode]:this.selectedNodes.filter((function(e){return!e._isTopResizeParent}))},_getParentGenericPage:function(e){var t=this.controller.layout.findTopLevelParentItem(e),i="genericPage"===t.type?[t]:t.findDescendantsWithType("genericPage");return i.length?this.controller.layoutController.getLayoutView(i[0].id):null},saveOldValues:function(e){var i=o.position(e),n=o.widgetSize(e);if(e._oldValues={height:n.height,width:n.width,top:i.top,left:i.left,rotateAngle:o.getAngleDegree(e)},t(e).is(".pagegroup"))for(var a=o.getContentWithoutDecoration(e),r=0,s=a.length;r<s;r++)this.saveOldValues(a[r])},setupResizingEventHandlers:function(){var e=this.resizeMoveEvent.bind(this),t=this.resizeStopEvent.bind(this);this.resizingEvents.push(i.on(window,"touchmove",e),i.on(window,"touchend",t),i.on(window,"mousemove",e),i.on(window,"mouseup",t))},clearResizingEventHandlers:function(){o.removeEvents(this.resizingEvents),this.resizingEvents=[]},resizeStopEvent:function(){var e=this;if(this._guidelineManager.finish(),this._isResizing){this._layoutIndicator&&this._layoutIndicator.hide(),this.sizeIndicators&&this._hideResizeIndicators();var i,o=this._getNodesForResize();this.lastPageX=null,this.lastPageY=null,this._isResizing=!1,this.last=0,this.nodeAngle=null,this.nResizeEdge=null,this.resizePointCenter=null,this.clearResizingEventHandlers();for(var n=[],a=0,r=o.length;a<r;a++)i=o[a],this._addNodeStyleUpdates(i,n);var s=this.dashboardApi.getFeature("Transaction"),d=s.startTransaction();this.updateModel(n,d);var l=o.map((function(t){return e.canvas.getContent(t.id)}));this.refreshProperties(l);for(var h=0,c=o.length;h<c;h++)(i=o[h])._oldValues=null,i._offsetX=null,i._offsetY=null,this._cleanChildNodes(i),t(i).removeClass("nodeResizing nodeResizeMove");this.emit("resize:done",{currentSelection:o,undoRedoTransactionId:d.transactionId,transactionToken:d}),s.endTransaction(d)}},_cleanChildNodes:function(e){if(t(e).is(".pagegroup"))for(var i=o.getContentWithoutDecoration(e),n=0,a=i.length;n<a;n++)i[n]._oldValues=null},_addNodeStyleUpdates:function(e,t){if(e._layout&&e._layout.model){var i={id:e._layout.model.id,style:{}};i.style=a.extend(o.position(e),o.widgetSize(e)),Object.keys(i.style).map((function(e){return i.style[e]+="px"}));var n=o.getAngleDegree(e);e._oldValues.rotateAngle!==n&&(i.style.rotateAngle=n),t.push(i)}},adjustYOrdinate:function(e,t){var i=this.lastClientY-e.clientY;this.lastClientY=e.clientY;var o=t.top+t.h;return e.clientY>=o&&(i<=0&&(i=3,e.clientY=t.top+this.lastBox.bottom-1),e.clientY+=i),i},adjustXOrdinate:function(e,t){var i=this.lastClientX-e.clientX;this.lastClientX=e.clientX;var o=t.left+t.w;e.clientX>o&&(i<=0&&(i=3,e.clientX=t.left+this.lastBox.right),e.clientX+=i)},_canResize:function(e){return this.lastClientX!==e.clientX||this.lastClientY!==e.clientY},resizeMoveEvent:function(e){if(this._canResize(e)){var i=this._getScrollInfo();i&&(this.adjustYOrdinate(e,i),this.adjustXOrdinate(e,i)),this.applyResize(e);for(var o,n=this._getNodesForResize(),a=0,r=n.length;a<r;a++)o=n[a],t(o).addClass("nodeResizeMove");var s=this._getDragBox(n);this.lastBox=s,this.lastClientX=e.clientX,this.lastClientY=e.clientY}return!1},applyResize:function(e){if(this.nResizeEdge){var i=t(this.nResizeEdge),o=this.nResizeEdge.getAttribute("edge"),n=h.isIPad();["br","tr","bl","tl"].indexOf(o)>-1&&e.shiftKey||n&&i.is(".bottomRight")?this.scale(e,o):i.is(".rotateEdge")||n&&i.is(".bottomLeft")?this.rotate(e):this.resizeFromEdge(e)}},_getDragBox:function(e){return e.reduce((function(e,t){var i=t.getBoundingClientRect();return e.top=Math.min(e.top,i.top),e.left=Math.min(e.left,i.left),e.bottom=Math.max(e.bottom,i.bottom),e.right=Math.max(e.right,i.right),e.ids.push(t.id),e}),{top:1/0,left:1/0,bottom:0,right:0,ids:[]})},resizeFromEdge:function(e){var t=this.nResizeEdge.parentNode,i=o.position(t),n=o.getRotatedCoordinates(t,this.resizePointCenter.left,this.resizePointCenter.top),a=o.getRotatedCoordinates(t,e.clientX,e.clientY);this.resizeSelection(n,a,i,e)},_getParentLayout:function(){return this.nResizeEdge&&this.nResizeEdge.parentNode&&this.nResizeEdge.parentNode._layout&&this.nResizeEdge.parentNode._layout.parentLayout?this.nResizeEdge.parentNode._layout.parentLayout:null},resizeSelection:function(e,t,i,o){var n=this.nResizeEdge.getAttribute("edge"),a=null,r=null,s=this._getParentLayout();if(s&&s.domNode!==this._guidelineManager.domNode){var d=this._getNodesForResize().map((function(e){return e.id}));this._guidelineManager.getReady(s.domNode,{dragBox:{ids:d}})}this._guidelineManager.hideAll();var l={top:i.top+t.y,left:i.left+t.x,bottom:i.top+t.y,right:i.left+t.x},h=this._guidelineManager.getSnapCoordinates(l);-1!==n.indexOf("b")?a=t.y-e.y-h.bottom:-1!==n.indexOf("t")&&(a=e.y-(i.top+t.y-h.top-i.top)),-1!==n.indexOf("r")?r=t.x-e.x-h.right:-1!==n.indexOf("l")&&(r=e.x-(i.left+t.x-h.left-i.left)),this.addHeightWidth(a,r,n,o)},getOppositeCornerCoords:function(e){var i={t:".br",tl:".br",r:".bl",tr:".bl",b:".tl",br:".tl",l:".tr",bl:".tr"}[this.nResizeEdge.getAttribute("edge")];i&&(i=t(e).children(i)[0]);var n=i?i.getBoundingClientRect():o.getCenter(e);return o.getRotatedCoordinates(e.parentNode,n.left,n.top)},addHeightWidth:function(e,t,i,o){var n=this._getNodesForResize(),a=this.checkHeight(n,e,i),r=this.checkWidth(n,t,i);n.length>1?this._layoutIndicator.hide():this._layoutIndicator.show();for(var s=0,d=n.length;s<d;s++)this.addHeightWidthToNode(n[s],a,r,o)},_getParentView:function(e){return e._layout&&e._layout.parentLayout||{}},checkHeight:function(e,t,i){if(t){var o,n;if(-1!==i.indexOf("t")){e.sort((function(e,t){return e.offsetTop-t.offsetTop})),o=e[0];var a=(n=this._getParentView(o)).getMinimumTop?n.getMinimumTop():0;t=Math.min(o._oldValues.top-a,t)}if(-1!==i.indexOf("b")){e.sort((function(e,t){return e.offsetTop+e._oldValues.height-t.offsetTop+t._oldValues.height})),o=e[0];var r=(n=this._getParentView(o)).getMaximumHeight?n.getMaximumHeight():1/0,s=o.offsetTop+o._oldValues.height;s+t>r&&(t=r-s)}if(t<0){e.sort((function(e,t){return e._oldValues.height-t._oldValues.height}));var d=e[0],l=f.default.minHeight;d._layout&&d._layout.widgetRegistry&&(l=f[d._layout.widgetRegistry.widget]?f[d._layout.widgetRegistry.widget].minHeight:f.default.minHeight),t=-1*Math.min(Math.abs(t),d._oldValues.height-l)}}return t},checkWidth:function(e,t,i){if(t){var o,n;if(-1!==i.indexOf("l")){e.sort((function(e,t){return e.offsetLeft-t.offsetLeft})),o=e[0];var a=(n=this._getParentView(o)).getMinimumLeft?n.getMinimumLeft():0;t=Math.min(o._oldValues.left-a,t)}if(-1!==i.indexOf("r")){e.sort((function(e,t){return e.offsetLeft+e._oldValues.width-t.offsetLeft+t._oldValues.width})),o=e[0];var r=(n=this._getParentView(o)).getMaximumWidth?n.getMaximumWidth():1/0,s=o.offsetLeft+o._oldValues.width;s+t>=r&&(t=r-s)}if(t<0){e.sort((function(e,t){return e._oldValues.width-t._oldValues.width}));var d=e[0],l=f.default.minWidth;d._layout&&d._layout.widgetRegistry&&(l=f[d._layout.widgetRegistry.widget]?f[d._layout.widgetRegistry.widget].minWidth:f.default.minWidth),t=-1*Math.min(Math.abs(t),d._oldValues.width-l)}}return t},addHeightWidthToNode:function(e,t,i,o){var n={},a=null;isNaN(i)||(a=e._oldValues.width+i);var r=null;if(isNaN(t)||(r=e._oldValues.height+t),r||a){var s=this.getOppositeCornerCoords(e);this.updateSizeValue(e,"height",r),this.updateSizeValue(e,"width",a),n=this._formatHeightWidth(e),this.updatePositionIndicator({left:o.clientX-this.containerNodeOffset.left,top:o.clientY-this.containerNodeOffset.top},n);var d=this.getOppositeCornerCoords(e);this._reAlignNode(e,s,d),this._showResizeIndicators(e,n)}e._layout&&e._layout.onResizeStep&&e._layout.onResizeStep()},_formatHeightWidth:function(e){var t={};if(e.id){var i=this._getParentGenericPage(e.id);if("relative"===e._layout.model.getValueFromSelfOrParent("layoutPositioning")){var o={height:e.getBoundingClientRect().height+"px",width:e.getBoundingClientRect().width+"px"},n={width:i.$el.width(),height:i.$el.height()};p.changePixelPropertiesToPercent(o,n,1),t.height=c.formatNumber(o.height.replace(/%/g,""))+" %",t.width=c.formatNumber(o.width.replace(/%/g,""))+" %"}else t.height=c.formatNumber(String(Number(Math.round(e.getBoundingClientRect().height))))+" "+d.get("pixelUnit"),t.width=c.formatNumber(String(Number(Math.round(e.getBoundingClientRect().width))))+" "+d.get("pixelUnit")}return t},updateSizeValue:function(e,t,i){i&&(e.style[t]=i+"px")},_reAlignNode:function(e,i,n){if(t(e).is(".pageabsolute>*, .pagegroup>*, .pagetemplateDropZone>*, .pagescalingAbsolute>*, .pagegenericPage>*")){var a=o.position(e);n.y!==i.y&&(e.style.top=a.top-n.y+i.y+"px"),n.x!==i.x&&(e.style.left=a.left-n.x+i.x+"px")}},scale:function(e,t){var i=this.nResizeEdge.parentNode,n=o.position(i),a=o.getRotatedCoordinates(i,this.resizePointCenter.left,this.resizePointCenter.top),r=o.getRotatedCoordinates(i,e.clientX,e.clientY),s=this._getParentLayout();if(s&&s.domNode!==this._guidelineManager.domNode){var d=this._getNodesForResize().map((function(e){return e.id}));this._guidelineManager.getReady(s.domNode,{dragBox:{ids:d}})}this._guidelineManager.hideAll();var l={top:n.top+r.y,left:n.left+r.x,bottom:n.top+r.y,right:n.left+r.x},h=this._guidelineManager.getSnapCoordinates(l),c=r.y-a.y-h.top;-1!==t.indexOf("t")&&(c*=-1);var u=r.x-a.x-h.left;-1!==t.indexOf("l")&&(u*=-1),this.applyScale(c,u,t,e)},applyScale:function(e,t,i,o){var n=this._getNodesForResize();e&&(e=this.checkHeight(n,e,i)),t&&(t=this.checkWidth(n,t,i));for(var a=void 0,r=0,s=n.length;r<s;r++){var d=(a=n[r])._oldValues.height,l=a._oldValues.width,h=1,c=this._getParentView(a);if(e&&d<l||!t){var u=l*(h=(d+e)/d),g=c.getMaximumWidth?c.getMaximumWidth():1/0;a.offsetLeft+u>g&&(h=(l+t)/l)}else{var p=d*(h=(l+t)/l),f=c.getMaximumHeight?c.getMaximumHeight():1/0;a.offsetTop+p>f&&(h=(d+e)/d)}if(h>0){var m=this.getOppositeCornerCoords(a);a.style.height=Math.round(d*h)+"px",a.style.width=Math.round(l*h)+"px";var v=this.getOppositeCornerCoords(a);this._reAlignNode(a,m,v),a._layout&&a._layout.onResizeStep&&a._layout.onResizeStep()}this._layoutIndicator.show();var y={height:Math.round(d*h),width:Math.round(l*h)};y=this._formatHeightWidth(a,y),this.updatePositionIndicator({left:o.clientX-this.containerNodeOffset.left,top:o.clientY-this.containerNodeOffset.top},y),this._showResizeIndicators(a,y)}},rotate:function(e){var t=this.nResizeEdge.parentNode,i=o.getCenter(t),n=o.getRotatedCoordinates(t.parentNode,i.left,i.top),a=o.getRotatedCoordinates(t.parentNode,e.clientX,e.clientY),r=o.getRotatedCoordinates(t.parentNode,this.resizePointCenter.left,this.resizePointCenter.top),s=e.shiftKey;this.rotateUsingCoords(n,a,r,s,e)},move:function(){},rotateUsingCoords:function(e,t,i,n,a){for(var r=this.nResizeEdge.parentNode,s=this._getNodesForResize(),d=0,l=s.length;d<l;d++){r=s[d];var h=e.x-t.x,c=e.y-t.y,u=Math.atan2(h,c)*(180/Math.PI)*-1,g=0;i&&(g=Math.atan2(e.x-i.x,e.y-i.y)*(180/Math.PI)*-1-this.nodeAngle);var p=u-this.nodeAngle-g,f=r._oldValues.rotateAngle+p;n&&(f=45*Math.round(f/45)),s.length>1?this._layoutIndicator.hide():(this._layoutIndicator.show(),this.updatePositionIndicatorRotate({left:a.clientX-this.containerNodeOffset.left,top:a.clientY-this.containerNodeOffset.top},f)),o.setRotateTransform(r,f)}},rotationMutationObserver:function(e){var t,i=!1;for(t=0;t<e.length;t++)if("attributes"===e[t].type&&"style"===e[t].attributeName){i=!0;break}i&&(this._observerUpdateDelay&&window.clearTimeout(this._observerUpdateDelay),this._observerUpdateDelay=window.setTimeout(function(){if(this.selectedNodes)for(this.removeRotationClass(this.selectedNodes),t=0;t<this.selectedNodes.length;t++)this.addRotationClass(this.selectedNodes[t])}.bind(this),200))},addRotationClass:function(e){var i=t(e),n=0,a=i;do{n+=o.getAngleDegree(a[0]),a=a.parent()}while(a.length&&a.hasClass("pagegroup"));n=Math.floor(n/22.5%16+16)%16,n=Math.round(n/2)%4,i.addClass("curRotation"+n)},removeRotationClass:function(e){t(e).removeClass("curRotation0 curRotation1 curRotation2 curRotation3")},resizeByProperty:function(e,t,i){var o=t,n=null;n=this.propertyNodes[0]._layout&&this.propertyNodes[0]._layout.widgetRegistry&&f[this.propertyNodes[0]._layout.widgetRegistry.widget]?"width"===e?f[this.propertyNodes[0]._layout.widgetRegistry.widget].minWidth:f[this.propertyNodes[0]._layout.widgetRegistry.widget].minHeight:"width"===e?f.default.minWidth:f.default.minHeight;var a=this._getParentDim(e,this.propertyNodes),r=this._getWidgetOffset(e,this.propertyNodes);if("px"===i)o=Math.max(n,o),o=Math.min(a-r,o);else{o=Math.max(o,n/a*100);var s="width"===e?"left":"top";o=this._sanitizePercentSizeOnPage(o,s)}var d=o+i,l=[];return this.propertyNodes.forEach((function(t){var i={};i[e]=d,l.push({style:i,id:t._layout.model.id})})),this.updateModel(l),o},rotateByProperty:function(e){var t=this,i=(e%360+360)%360,o=[];return this.propertyNodes.forEach((function(e){t.preventRotate(e)||o.push({style:{rotateAngle:i},id:e._layout.model.id})})),this.updateModel(o),i},_processChange:function(e,t,i){return"rotation"===e?this.rotateByProperty(t):this.resizeByProperty("width"===e?"width":"height",t,i)},getProperties:function(){m.inherited("getProperties",this,arguments);var e=this.getUnitsFromValue(this.propertyNodes[0]._layout.model.style.width),t="",i=this.preventRotate(this.propertyNodes[0]),n=[{units:e,getProp:function(e){return e._layout.model.style.width}},{units:e,getProp:function(e){return e._layout.model.style.height}},{units:t,getProp:function(e){return(o.getAngleDegree(e)+360)%360}}];i&&n.push({units:"",getProp:this.preventRotate}),this._getValuesForProperties(n),i&&(i=""!==n[3].value);var a=[{type:"SectionLabel",label:d.get("propResizeLabel"),tabName:d.get("tabName_general"),sectionName:d.get("sectionName_layout"),sectionOpened:!0,order:30},{type:"Split",name:"resizeWidgetSplit",id:"resizeWidgetSplit",tabName:d.get("tabName_general"),sectionName:d.get("sectionName_layout"),order:31,items:[{align:"left",items:[{type:"InputLabel",label:d.get("propResizeWidth_v1"),name:"width",id:"width",tabName:d.get("tabName_general"),sectionName:d.get("sectionName_layout"),readOnly:!1,value:n[0].value,onChangeValueHold:n[0].value,multiline:!0,handleReturnKey:!0,units:e,onChange:this.wrapChangeProperty()}]},{align:"right",items:[{type:"InputLabel",label:d.get("propResizeHeight_v1"),name:"height",id:"height",tabName:d.get("tabName_general"),sectionName:d.get("sectionName_layout"),readOnly:!1,value:n[1].value,onChangeValueHold:n[1].value,multiline:!0,handleReturnKey:!0,units:e,onChange:this.wrapChangeProperty()}]}]}];return i||(a.push({type:"SectionLabel",label:this.isPropertiesV2Enabled?d.get("propRotateLabel"):d.get("propRotateLabel_v1"),tabName:d.get("tabName_general"),sectionName:d.get("sectionName_layout"),order:32}),a.push({type:"InputLabel",label:d.get("propRotateAngle"),name:"rotation",id:"rotation",tabName:d.get("tabName_general"),sectionName:d.get("sectionName_layout"),readOnly:!1,value:n[2].value,onChangeValueHold:n[2].value,handleReturnKey:!0,units:t,onChange:this.wrapChangeProperty(),order:33})),this.showStyleProperties(this.propertyNodes[0])?a:[]}});return m})),define("dashboard-core/js/dashboard/layout/authoring/interaction/AlignAction",["./BasePropertyAction","jquery","underscore","../../../../lib/@waca/dashboard-common/dist/ui/interaction/Utils","../../../../app/nls/StringResources"],(function(e,t,i,o,n){var a=null;return a=e.extend({init:function(e){this.controller=e,a.inherited("init",this,arguments),this.selectedNodes=[]},newSelection:function(e){this.selectedNodes=e},getProperties:function(){var e=this.dashboardApi.getFeature("Icons"),t=this.selectedNodes.length<=1;return[{type:"IconPicker",label:n.get("toolbarActionAlign"),name:"alignWidget",id:"alignWidget",tabName:n.get("tabName_general"),sectionName:n.get("sectionName_layout"),sectionOpened:!0,readOnly:t,items:[{name:"left",label:n.get("alignWidgetLeft"),value:e.getIcon("align-left").id},{name:"center",label:n.get("alignWidgetCenter"),value:e.getIcon("align-horizontally").id},{name:"right",label:n.get("alignWidgetRight"),value:e.getIcon("align-right").id},{name:"top",label:n.get("alignWidgetTop"),value:e.getIcon("align-top").id},{name:"middle",label:n.get("alignWidgetMiddle"),value:e.getIcon("align-vertically").id},{name:"bottom",label:n.get("alignWidgetBottom"),value:e.getIcon("align-bottom").id}],onChange:this.onAlignIconClick.bind(this),order:10}]},onAlignIconClick:function(e,t){if(t&&t.length&&t[0].name&&this.selectedNodes.length>1){var i=t[0].name;this.applyAlignment(i)}},getWidgetBoxes:function(e){var i=o.position(e),n=o.widgetSize(e),a={boundingBox:t(e).position(),widgetBox:{top:i.top,left:i.left,width:n.width,height:n.height}},r=e.getBoundingClientRect();return a.boundingBox.width=r.width,a.boundingBox.height=r.height,a},applyAlignment:function(e){var t={left:this.getLeftAlignmentStyle,center:this.getCenterAlignmentStyle,right:this.getRightAlignmentStyle,top:this.getTopAlignmentStyle,middle:this.getMiddleAlignmentStyle,bottom:this.getBottomAlignmentStyle},i=[],o=this.getWidgetBoxes(this.selectedNodes[0]);i.push(o);for(var n={top:o.boundingBox.top,left:o.boundingBox.left,bottom:o.boundingBox.top+o.boundingBox.height,right:o.boundingBox.left+o.boundingBox.width},a=1;a<this.selectedNodes.length;a++){var r=this.getWidgetBoxes(this.selectedNodes[a]);i.push(r),n.top=Math.min(n.top,r.boundingBox.top),n.left=Math.min(n.left,r.boundingBox.left),n.bottom=Math.max(n.bottom,r.boundingBox.top+r.boundingBox.height),n.right=Math.max(n.right,r.boundingBox.left+r.boundingBox.width)}for(var s=[],d=0;d<this.selectedNodes.length;d++){var l=t[e](n,i[d],this.selectedNodes[d]);l&&s.push({style:l,id:this.selectedNodes[d]._layout.model.id})}s.length&&(this.updateModel(s),this.refreshProperties())},getLeftAlignmentStyle:function(e,t,i){var o=e.left;Math.round(t.boundingBox.left)!==Math.round(t.widgetBox.left)&&(o-=t.boundingBox.left-t.widgetBox.left);return{left:(o=Math.max(o,i._layout.parentLayout.getMinimumLeft()))+"px"}},getCenterAlignmentStyle:function(e,t,i){var o=e.left+(e.right-e.left)/2-t.widgetBox.width/2;Math.round(t.boundingBox.left)!==Math.round(t.widgetBox.left)&&(o-=t.boundingBox.left+t.boundingBox.width/2-(t.widgetBox.left+t.widgetBox.width/2));return{left:(o=Math.max(o,i._layout.parentLayout.getMinimumLeft()))+"px"}},getRightAlignmentStyle:function(e,t,i){var o=e.right-t.widgetBox.width;Math.round(t.boundingBox.width)!==Math.round(t.widgetBox.width)&&(o-=t.boundingBox.left+t.boundingBox.width-(t.widgetBox.left+t.widgetBox.width));return{left:(o=Math.max(o,i._layout.parentLayout.getMinimumLeft()))+"px"}},getTopAlignmentStyle:function(e,t,i){var o=e.top;Math.round(t.boundingBox.top)!==Math.round(t.widgetBox.top)&&(o-=t.boundingBox.top-t.widgetBox.top);return{top:(o=Math.max(o,i._layout.parentLayout.getMinimumTop()))+"px"}},getMiddleAlignmentStyle:function(e,t,i){var o=e.top+(e.bottom-e.top)/2-t.widgetBox.height/2;Math.round(t.boundingBox.top)!==Math.round(t.widgetBox.top)&&(o-=t.boundingBox.top+t.boundingBox.height/2-(t.widgetBox.top+t.widgetBox.height/2));return{top:(o=Math.max(o,i._layout.parentLayout.getMinimumTop()))+"px"}},getBottomAlignmentStyle:function(e,t,i){var o=e.bottom-t.widgetBox.height;Math.round(t.boundingBox.height)!==Math.round(t.widgetBox.height)&&(o-=t.boundingBox.top+t.boundingBox.height-(t.widgetBox.top+t.widgetBox.height));return{top:(o=Math.max(o,i._layout.parentLayout.getMinimumTop()))+"px"}}})})),define("dashboard-core/js/dashboard/layout/authoring/interaction/strategy/Authoring",["../../../../../lib/@waca/core-client/js/core-client/ui/core/Class","./../InteractionFactory","./../MoveWidgets","./../MoveGroupContent","./../Resize","./../ExpandAction","./../AlignAction"],(function(e,t,i,o,n,a,r){var s=e.extend({init:function(e){s.inherited("init",this,arguments),this.logger=e},destroy:function(){if(this._handlers&&this._handlers.forEach((function(e){e.remove&&e.remove()})),this._handlers=null,this._interactions){for(var e in this._interactions)if(this._interactions.hasOwnProperty(e)){var t=this._interactions[e].wrapped;t&&t.destroy&&t.destroy()}this._interactions=null}},getInteraction:function(e){var t=this._interactions[e];return t&&t.wrapped},attachInteractions:function(e){var t=this;return this._getInteractions(e,this.logger).then((function(i){t._interactions=i,t._attachInteractions(e,i)}))},_attachInteractions:function(e,t){var i=t.resize,o=t.expand,n=t.move,a=t.moveGroupContent,r=t.align,s=e.config&&e.config.focusModeDisabled;i&&e.addActionForSelector(i,".page .widget:not(.placeholderWidget)"),o&&!s&&e.addActionForSelector(o,".page .widget:not(.placeholderWidget)"),n&&e.addActionForSelector(n,".page .widget:not(.pagegroup *):not(.placeholderWidget)"),r&&e.addActionForSelector(r,".page .widget:not(.placeholderWidget)"),i&&e.addActionForSelector(i,".page .pagegroup",!0),n&&e.addActionForSelector(n,".page .pagegroup",!0),r&&e.addActionForSelector(r,".page .pagegroup",!0),a&&e.addActionForSelector(a,".pagegroup .widget"),this._handleJointInteractions(e,t)},_handleJointInteractions:function(e,t){var i=t.resize,o=(i=void 0===i?{}:i).wrapped,n=t.move,a=(n=void 0===n?{}:n).wrapped,r=t.moveGroupContent,s=(r=void 0===r?{}:r).wrapped;this._handlers=[],a&&this._handlers.push(a.on("move:end",e.finishMoveSelection,e)),o&&this._handlers.push(o.on("resize:start",e.onSelectionMoveOrResize,e)),a&&this._handlers.push(a.on("move:start",e.onSelectionMoveOrResize,e)),s&&this._handlers.push(s.on("move:start",e.onSelectionMoveOrResize,e))},_getInteractions:function(e,s){var d={resize:n,expand:a,move:i,moveGroupContent:o,align:r};return new t(e,s).getInteractions(d)}});return s})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/align--horizontal-left_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var i=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([1271],{"0664fef626e8ade26988":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("6873601dfe1d9459c1a9"),n=(i.n(o),i("cf62bb6c68cb238826d3"));t.default=n.a},"6873601dfe1d9459c1a9":function(t,i){t.exports=e},cf62bb6c68cb238826d3:function(e,t,i){"use strict";var o=i("9689a9c94ae38b47fa2c"),n=i.n(o),a=i("9ce58a7deea14f49ef01"),r=i.n(a),s=new n.a({id:"align--horizontal-left_32_v7",use:"align--horizontal-left_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="align--horizontal-left_32_v7"><path d="M26 26H11a2.0023 2.0023 0 01-2-2V20a2.0023 2.0023 0 012-2H26a2.0023 2.0023 0 012 2v4A2.0023 2.0023 0 0126 26zm0-6.0012L11 20v4H26zM18 14H11a2.0023 2.0023 0 01-2-2V8a2.0023 2.0023 0 012-2h7a2.0023 2.0023 0 012 2v4A2.0023 2.0023 0 0118 14zm0-6.0012L11 8v4h7zM4 2H6V30H4z" /></symbol>'});r.a.add(s),t.a=s}},["0664fef626e8ade26988"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/align--horizontal-center_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var i=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([1272],{"506bc587879f75bc5dec":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("6873601dfe1d9459c1a9"),n=(i.n(o),i("7999b886c077f4cd7e79"));t.default=n.a},"6873601dfe1d9459c1a9":function(t,i){t.exports=e},"7999b886c077f4cd7e79":function(e,t,i){"use strict";var o=i("9689a9c94ae38b47fa2c"),n=i.n(o),a=i("9ce58a7deea14f49ef01"),r=i.n(a),s=new n.a({id:"align--horizontal-center_32_v7",use:"align--horizontal-center_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="align--horizontal-center_32_v7"><path d="M24,18H17V14h3a2.0025,2.0025,0,0,0,2-2V8a2.0025,2.0025,0,0,0-2-2H17V2H15V6H12a2.0025,2.0025,0,0,0-2,2v4a2.0025,2.0025,0,0,0,2,2h3v4H8a2.0025,2.0025,0,0,0-2,2v4a2.0025,2.0025,0,0,0,2,2h7v4h2V26h7a2.0025,2.0025,0,0,0,2-2V20A2.0025,2.0025,0,0,0,24,18ZM12,8h8v4H12ZM24,24H8V20H24Z" /></symbol>'});r.a.add(s),t.a=s}},["506bc587879f75bc5dec"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/align--horizontal-right_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var i=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([1270],{"6873601dfe1d9459c1a9":function(t,i){t.exports=e},"95119b8b76f979e1cf36":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("6873601dfe1d9459c1a9"),n=(i.n(o),i("f8c19ddb9066d9a49469"));t.default=n.a},f8c19ddb9066d9a49469:function(e,t,i){"use strict";var o=i("9689a9c94ae38b47fa2c"),n=i.n(o),a=i("9ce58a7deea14f49ef01"),r=i.n(a),s=new n.a({id:"align--horizontal-right_32_v7",use:"align--horizontal-right_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="align--horizontal-right_32_v7"><path d="M4 24V20a2.0023 2.0023 0 012-2H21a2.0023 2.0023 0 012 2v4a2.0023 2.0023 0 01-2 2H6A2.0023 2.0023 0 014 24zm2 0H21V20L6 19.9988zM12 12V8a2.0023 2.0023 0 012-2h7a2.0023 2.0023 0 012 2v4a2.0023 2.0023 0 01-2 2H14A2.0023 2.0023 0 0112 12zm2 0h7V8l-7-.0012z" /><path d="M26 2H28V30H26z" transform="rotate(-180 27 16)" /></symbol>'});r.a.add(s),t.a=s}},["95119b8b76f979e1cf36"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/align--vertical-top_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var i=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([1267],{"3271e7fe027fb51b7008":function(e,t,i){"use strict";var o=i("9689a9c94ae38b47fa2c"),n=i.n(o),a=i("9ce58a7deea14f49ef01"),r=i.n(a),s=new n.a({id:"align--vertical-top_32_v7",use:"align--vertical-top_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="align--vertical-top_32_v7"><path d="M24 20H20a2.0023 2.0023 0 01-2-2V11a2.0023 2.0023 0 012-2h4a2.0023 2.0023 0 012 2v7A2.0023 2.0023 0 0124 20zm-4-9v7h4.0012L24 11zM12 28H8a2.0023 2.0023 0 01-2-2V11A2.0023 2.0023 0 018 9h4a2.0023 2.0023 0 012 2V26A2.0023 2.0023 0 0112 28zM8 11V26h4.0012L12 11zM2 4H30V6H2z" /></symbol>'});r.a.add(s),t.a=s},"6873601dfe1d9459c1a9":function(t,i){t.exports=e},"76e5c4808c4084c94a60":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("6873601dfe1d9459c1a9"),n=(i.n(o),i("3271e7fe027fb51b7008"));t.default=n.a}},["76e5c4808c4084c94a60"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/align--vertical-center_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var i=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([1268],{"6873601dfe1d9459c1a9":function(t,i){t.exports=e},c1e14e225f68667de97c:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("6873601dfe1d9459c1a9"),n=(i.n(o),i("f2e70997e82ed8a1492f"));t.default=n.a},f2e70997e82ed8a1492f:function(e,t,i){"use strict";var o=i("9689a9c94ae38b47fa2c"),n=i.n(o),a=i("9ce58a7deea14f49ef01"),r=i.n(a),s=new n.a({id:"align--vertical-center_32_v7",use:"align--vertical-center_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="align--vertical-center_32_v7"><path d="M30,15H26V12a2.0025,2.0025,0,0,0-2-2H20a2.0025,2.0025,0,0,0-2,2v3H14V8a2.0025,2.0025,0,0,0-2-2H8A2.0025,2.0025,0,0,0,6,8v7H2v2H6v7a2.0025,2.0025,0,0,0,2,2h4a2.0025,2.0025,0,0,0,2-2V17h4v3a2.0025,2.0025,0,0,0,2,2h4a2.0025,2.0025,0,0,0,2-2V17h4ZM8,24V8h4l.0012,16Zm12-4V12h4l.0012,8Z" /></symbol>'});r.a.add(s),t.a=s}},["c1e14e225f68667de97c"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/align--vertical-bottom_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var i=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([1269],{"0545acbbaa0eb0f8496f":function(e,t,i){"use strict";var o=i("9689a9c94ae38b47fa2c"),n=i.n(o),a=i("9ce58a7deea14f49ef01"),r=i.n(a),s=new n.a({id:"align--vertical-bottom_32_v7",use:"align--vertical-bottom_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="align--vertical-bottom_32_v7"><path d="M2 26H30V28H2zM24 23H20a2.0023 2.0023 0 01-2-2V14a2.0023 2.0023 0 012-2h4a2.0023 2.0023 0 012 2v7A2.0023 2.0023 0 0124 23zm-4-9v7h4.0012L24 14zM12 23H8a2.0023 2.0023 0 01-2-2V6A2.0023 2.0023 0 018 4h4a2.0023 2.0023 0 012 2V21A2.0023 2.0023 0 0112 23zM8 6V21h4.0012L12 6z" /></symbol>'});r.a.add(s),t.a=s},"48339c3852b77f63ac26":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("6873601dfe1d9459c1a9"),n=(i.n(o),i("0545acbbaa0eb0f8496f"));t.default=n.a},"6873601dfe1d9459c1a9":function(t,i){t.exports=e}},["48339c3852b77f63ac26"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/distribute--horizontal-center_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var i=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([781],{"664332233d027dbef804":function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("6873601dfe1d9459c1a9"),n=(i.n(o),i("b8cd8ce5cf59308a8ac3"));t.default=n.a},"6873601dfe1d9459c1a9":function(t,i){t.exports=e},b8cd8ce5cf59308a8ac3:function(e,t,i){"use strict";var o=i("9689a9c94ae38b47fa2c"),n=i.n(o),a=i("9ce58a7deea14f49ef01"),r=i.n(a),s=new n.a({id:"distribute--horizontal-center_32_v7",use:"distribute--horizontal-center_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="distribute--horizontal-center_32_v7"><path d="M24 10H23V2H21v8H20a2.0023 2.0023 0 00-2 2v8a2.0023 2.0023 0 002 2h1v8h2V22h1a2.0023 2.0023 0 002-2V12A2.0023 2.0023 0 0024 10zm0 10H20V12h4zM12 6H11V2H9V6H8A2.0023 2.0023 0 006 8V24a2.0023 2.0023 0 002 2H9v4h2V26h1a2.0023 2.0023 0 002-2V8A2.0023 2.0023 0 0012 6zm0 18H8V8h4z" /></symbol>'});r.a.add(s),t.a=s}},["664332233d027dbef804"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/distribute--vertical-center_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var i=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var o in i)("object"==typeof exports?exports:e)[o]=i[o]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([780],{"6873601dfe1d9459c1a9":function(t,i){t.exports=e},"688f8106c53a36d64541":function(e,t,i){"use strict";var o=i("9689a9c94ae38b47fa2c"),n=i.n(o),a=i("9ce58a7deea14f49ef01"),r=i.n(a),s=new n.a({id:"distribute--vertical-center_32_v7",use:"distribute--vertical-center_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="distribute--vertical-center_32_v7"><path d="M30 21H26V20a2.0023 2.0023 0 00-2-2H8a2.0023 2.0023 0 00-2 2v1H2v2H6v1a2.0023 2.0023 0 002 2H24a2.0023 2.0023 0 002-2V23h4zm-6 3H8V20l16-.001zM30 9H22V8a2.0023 2.0023 0 00-2-2H12a2.0023 2.0023 0 00-2 2V9H2v2h8v1a2.0023 2.0023 0 002 2h8a2.0023 2.0023 0 002-2V11h8zM20 12H12V8l8-.001z" /></symbol>'});r.a.add(s),t.a=s},e13dfd85cb03198714ab:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=i("6873601dfe1d9459c1a9"),n=(i.n(o),i("688f8106c53a36d64541"));t.default=n.a}},["e13dfd85cb03198714ab"])})),define("dashboard-core/js/features/dashboard/actions/alignAction/impl/AlignDialog",["../../../../../lib/@waca/core-client/js/core-client/ui/core/View","react","react-dom","@ba/ba-ui-carbon-toolkit","jquery","../../../../../app/nls/StringResources","@ba/ba-graphics/dist/icons-js/align--horizontal-left_32","@ba/ba-graphics/dist/icons-js/align--horizontal-center_32","@ba/ba-graphics/dist/icons-js/align--horizontal-right_32","@ba/ba-graphics/dist/icons-js/align--vertical-top_32","@ba/ba-graphics/dist/icons-js/align--vertical-center_32","@ba/ba-graphics/dist/icons-js/align--vertical-bottom_32","@ba/ba-graphics/dist/icons-js/distribute--horizontal-center_32","@ba/ba-graphics/dist/icons-js/distribute--vertical-center_32"],(function(e,t,i,o,n,a,r,s,d,l,h,c,u,g){var p=e.extend({init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};p.inherited("init",this,arguments),this.action=e.actions?e.actions.apply:e.action,this._disableDistribution=e.disableDistribution},preload:function(){return Promise.resolve()},renderCallBack:function(e){this.authoringToolbar=e,this.authoringToolbar.on("flyout:hide",this._unmountReactComponent.bind(this))},remove:function(){this._unmountReactComponent(),this.authoringToolbar.off("flyout:hide",this._unmountReactComponent.bind(this)),this.action=null,this.authoringToolbar=null,this.$container&&(this.$container.remove(),this.$container=null),p.inherited("remove",this,arguments)},_unmountReactComponent:function(){this.$container&&(i.unmountComponentAtNode(this.$container[0]),this.$container=null)},selectItem:function(e){var t=this;return this.action(e),this.onUpdate().then((function(){t.$container&&(i.unmountComponentAtNode(t.$container[0]),t.$container=null)}))},render:function(){var e=this,p=this;return new Promise((function(f){var m=o.Menu,v=o.Menu.List,y=function(e){function i(t){_classCallCheck(this,i);var o=_possibleConstructorReturn(this,e.call(this,t));return o.state={selected:{}},o}return _inherits(i,e),i.prototype._onChange=function(e,t,i){if(!i){var o={},n=this.state.selected;for(var a in n)n.hasOwnProperty(a)&&(o[a]=n[a]);o[e]=t,this.setState({selected:o}),p.selectItem(t)}},i.prototype.render=function(){return t.createElement(m,{onChange:this._onChange.bind(this),selected:this.state.selected},[t.createElement(v,{name:"align",content:[{label:a.get("alignWidgetLeft"),value:"left",icon:r.default},{label:a.get("alignWidgetCenter"),value:"center",icon:s.default},{label:a.get("alignWidgetRight"),value:"right",icon:d.default},{label:a.get("alignWidgetTop"),value:"top",icon:l.default},{label:a.get("alignWidgetMiddle"),value:"middle",icon:h.default},{label:a.get("alignWidgetBottom"),value:"bottom",icon:c.default},{label:a.get("distributeWidgetsHoriz"),value:"horizDistrib",icon:u.default,disabled:p._disableDistribution},{label:a.get("distributeWidgetsVertical"),value:"vertDistrib",icon:g.default,disabled:p._disableDistribution}]})])},i}(t.Component);e.$container=n("<div></div>",{class:"ba-theme-default selectionList"}),e.$el.addClass("content").append(e.$container),i.render(t.createElement(y),e.$container[0],f)}))}});return p})),define("dashboard-core/js/authorBundle",(function(){}));