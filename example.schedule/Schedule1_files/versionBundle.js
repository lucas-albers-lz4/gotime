/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Content Apps
 * (C) Copyright IBM Corp. 2016, 2018
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

define("bi/content_apps/common/ui/list_actions/ViewReportAction",["bacontentnav/common/ui/list_actions/ListAction","bacontentnav/utils/ContentStoreObject","bi/commons/utils/Downloader","lodash"],function(t,c,e,i){"use strict";return t.extend({canExecute:function(t){var e=t.target.activeObject.aSelectedContext;return!(!e||1<e.length)&&c.hasPermissions(e[0],["traverse","read"])},doAction:function(a){var t=a.target.activeObject.aSelectedContext;if(!t||1<t.length)return Promise.reject(new Error("No objects selected"));var l=t[0];return c.getBaseObjectType(l).then(function(r){if(this._isSupportedType(r)){var t={url:c.getSelfLink(l),type:"GET",dataType:"json",data:{fields:"defaultOutputFormat"}};return a.glassContext.getCoreSvc(".Ajax").ajax(t).then(function(t){if((t=t&&t.data).data[0].defaultOutputFormat){var e,n=a.target.activeObject.outputId,i=a.target.activeObject.download,o=i?"/content?download=true":this._getSuffix(r);if(e=n?"v1/disp/repository/sid/cm/oid/"+n+o:"v1/disp/repository/sid/cm/rid/"+l.id+"/oid/default"+o,i){this._getDownloader({url:e,logger:a.glassContext.appController.logger}).doDownload()}else{if(-1!==r.indexOf("powerPlay8Report")){var s=c.getName(l);e=this._getPP8ReportViewerUrl(n,s)}this._openWindow(e)}return Promise.resolve()}return Promise.reject(new Error("No saved output"))}.bind(this))}return Promise.reject(new Error("Not supported type"))}.bind(this))},_getDownloader:function(t){return new e(t)},_openWindow:function(t){window.open(t)},_getSuffix:function(t){var e;switch(t){case"interactiveReport":e="/content/mht/content";break;case"powerPlay8Report":case"powerPlay8ReportView":e="/content?cv.id=_THIS_";break;default:e=""}return e},_isSupportedType:function(t){var e=!1;switch(t){case"interactiveReport":case"powerPlay8Report":case"powerPlay8ReportView":e=!0}return e},_getPP8ReportViewerUrl:function(t,e){var n="v1/disp?b_action=cognosViewer&ui.action=view&ui.format=PDF&ui.object=storeID(%22"+t+"%22)&ui.name="+i.escape(e);return n+="&cv.header=false&ui.backURL=%2fcps4%2fportlets%2fcommon%2fclose.html"}})}),define("bi/content_apps/VersionsTab",["require","jquery","bi/glass/app/ContentView","bi/commons/ui/Slideout","bi/content_apps/nls/StringResource","bacontentnav/utils/UIHelper","bacontentnav/utils/ContentStoreObject","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","bacontentnav/utils/GlassContextHelper","bi/content_apps/common/ui/list_actions/ViewReportAction","bi/commons/utils/BidiUtil","lodash"],function(n,s,t,o,a,i,l,r,c,e,u,p){"use strict";var h={PDF:!0,HTML:!0,CSV:!0,spreadsheetML:!0,xlsxData:!0,XHTML:!0,XLWA:!0,XML:!0,HTMLFragment:!0},d={xlsxdata:"common-excel_icon",spreadsheetml:"common-excel_icon",xlwa:"common-excel_icon",xhtml:"common-html_icon",html:"common-html_icon",csv:"common-csv_icon",pdf:"common-pdf_icon",xml:"common-xml_icon",default:"common-savedoutput_report"},m=t.extend({init:function(t){m.inherited("init",this,arguments),p.extend(this,t),this.noBurstKey="secretIBMNoBurstKey",this.mockableViewInteractiveReportAction=e,this.batchSize=Math.floor(window.innerHeight/18),this.initialEndIndex=this.batchSize,this.renderIndex=this.batchSize},render:function(){return this._id=p.uniqueId("prop_"),this._queryHistoriesVersions().then(function(t){if(t.historiesInfo||t.versionsInfo){this.$el.addClass("versionsTab");var e=this._mergeVersionAndHistory(t.historiesInfo,t.versionsInfo);return e.sort(function(t,e){return t=new Date(l.getRequestedTime(t)),(e=new Date(l.getRequestedTime(e)))<t?-1:t<e?1:0}),this.items=this._getItems(e),this.initialEndIndex>this.items.length&&(this.initialEndIndex=this.items.length),this._oPropertyUIControl=new r({el:this.$el,items:[{name:"showAllHistory",label:a.get("showAllHistory"),checked:!1,type:"CheckBox",onChange:this._showAllHistoryChange.bind(this)},{type:"Separator"}].concat(this.items.slice(0,this.initialEndIndex))}),this._oPropertyUIControl.render()}i.renderInfoMessage(this.$el,a.get("noVersions"))}.bind(this)).then(function(){this._showAllHistoryChange(),this.batchSize*=3,this._scrollNode=this.$el.find(".containerUIControl"),s(this._scrollNode).on("scroll",this._onScroll.bind(this))}.bind(this))},_render:function(t,e){return this.renderIndex=e,this._oPropertyUIControl.renderItems(this.items.slice(t,e))},_onScroll:function(t){if(!0===this._bScrollToBottom(t)){if(this.renderIndex>=this.items.length)return;var e=this.renderIndex+this.batchSize;return e<this.items.length?this._render(this.renderIndex,e):this._render(this.renderIndex,this.items.length)}},_bScrollToBottom:function(t){var e=s(t.target);return e.scrollTop()+e.innerHeight()>=e[0].scrollHeight-20},_queryHistoriesVersions:function(){var t=[];return this.objectInfo&&(t.push(l.getHistories(this.objectInfo,"output")),t.push(l.getVersions(this.objectInfo,"creationTime"))),Promise.all(t).then(function(t){return{historiesInfo:t[0],versionsInfo:t[1]}})},_handleGetOutputsSuccess:function(t){var e=t.data,n=t.index,o=[];return e&&e.forEach(function(t){if(h[t.format]){var e={id:l.getObjectId(t),format:l.getFormat(t),content:l.getOutputContentLink(t),modificationTime:l.getModificationTime(t,!0,"short")};if(e.format&&e.content){var n=l.getBurstKey(t),i=l.getLocale(t);n?(o[n]||(o[n]=[]),o[n][i]||(o[n][i]=[]),o[n][i].push(e)):(o[this.noBurstKey]||(o[this.noBurstKey]=[]),o[this.noBurstKey][i]||(o[this.noBurstKey][i]=[]),o[this.noBurstKey][i].push(e))}}}.bind(this)),{outputsInfo:o,index:n}},_mergeVersionAndHistory:function(e,o){return e=e||[],o=o||[],s.each(o,function(t,n){var i=!1;s.each(e,function(t,e){if(e.output&&e.output.id===n.id)return!(i=!0)}),i||(n[l.REQUESTED_TIME]=l.getCreationDate(n),delete n[l.CREATION_TIME],n[l.STATUS]="succeeded",e.push(n))}),s.each(e,function(t,e){if(e.output&&e.output.id){var n=e.output.id,i=!1;s.each(o,function(t,e){if(e.id===n)return!(i=!0)}),i||(e.output=null)}}),e},_getItems:function(t){this.mergedInfo=t;var r=[];return this.mergedInfo.forEach(function(t,e){var n=l.getRequestedTime(t,!0,"medium"),i="succeeded"===l.getStatus(t),o=null!==l.getDetailsLink(this.mergedInfo[e]),s=null!==this._getOutputsLinkFromIndex(e);r.push({type:"SingleLineLinks",name:e+"_versions",role:"group",items:[{align:"left",items:[{type:"icon",class:i?"versionReport":"versionStatusFailed",svgIcon:i?s?"common-savedoutput_report":"common-savedoutput_reporthistory":"common-failed",value:i?a.get("successful"):a.get("failed"),iconTooltip:a.get("report")},{type:"text",value:n,class:"versionText"+(s?"":" hasNoOutput"),clickCallback:s?this._toggleOutputsSection.bind(this,e):null}]},{align:"right",items:[{type:"icon",class:"versionDetailsLinks"+(o?"":" disabled"),svgIcon:"common-info-moreinfo",clickCallback:o?this._openDetails.bind(this,e):null,iconTooltip:a.get("showDetails"),showRightArrow:!0}]}]}),r.push({type:"CollapsibleSection",name:e+"_outputs",label:n,styleAsSimpleRow:!0,hideSectionTitle:!0,indent:3.3,items:[],onOpenChange:this._openOutputsSection.bind(this,e)}),r.push({type:"Separator"})}.bind(this)),r},_toggleOutputsSection:function(t,e){this._getOutputSection(t).toggleCollapsibleSection()},_showAllHistoryRefresh:function(){var t=this._oPropertyUIControl.getProperty("showAllHistory").isChecked();this._showAllHistoryChange(null,t)},_showItem:function(t,e){s(e).removeClass("hidden")},_selectItem:function(t){var e=s(t).closest(".propertyRow").nextUntil(".separator").addBack();return e=e.add(e.last().next())},_hideItem:function(t,e){this._selectItem(e).addClass("hidden")},_removeItem:function(t){this._selectItem(t).remove()},_showAllHistoryChange:function(t,e){e?s(".itemContainerUIControl > div",this.$el).each(this._showItem.bind(this)):s(".itemContainerUIControl .hasNoOutput",this.$el).each(this._hideItem.bind(this))},_getOutputFromIndex:function(t){var e=this.mergedInfo[t],n={};return p.isObject(e.output)?n[l.OUTPUT]=[e.output]:n[l.OUTPUT]=[e],n},_getOutputsLinkFromIndex:function(t){var e=this._getOutputFromIndex(t);return l.getOutputsLink(e)},_getVersionLinkFromIndex:function(t){var e=this._getOutputFromIndex(t);return l.getVersionLink(e)},_openOutputsSection:function(n,t,e){if(e){var i=this._getOutputsLinkFromIndex(n);this._getOutputs(i,n).then(this._handleGetOutputsSuccess.bind(this)).then(this._getOutputsSectionPayload.bind(this)).done(function(t){var e=this._getItemsSpec(t.outputsInfo,n,t.items);this._getOutputSection(n).refreshProperties(e)}.bind(this))}},_getVersionSection:function(t){var e=t+"_versions";return this._oPropertyUIControl.getProperty(e)},_getOutputSection:function(t){var e=t+"_outputs";return this._oPropertyUIControl.getProperty(e)},_openDetails:function(i){this._getDetails(i).then(function(t){var e=s("<div>");this.parentEl.append(e);var n=new o({glassContext:this.glassContext,position:this.slideout.position,el:e,width:"400",content:{module:"bi/content_apps/VersionsDetailsView",parentView:this,objectInfo:this.objectInfo,historyInfo:this.mergedInfo[i],detailsInfo:t,glassContext:this.glassContext}});n.render().then(n.show())}.bind(this))},_getOutputsSectionPayload:function(t){var i=t.outputsInfo,e=t.index,o=[];return this._canDelete()&&o.push({type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",value:a.get("deleteReportVersion"),class:"versionText",clickCallback:function(){this._onClickDelete(e)}.bind(this)}]}]}),c.getContentLocales(this.glassContext).then(function(t){var e;if(i&&0<Object.keys(i).length){for(var n in i)if(i.hasOwnProperty(n)){for(e in n!==this.noBurstKey&&o.push({type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",class:"wraptext versionText",value:n}]}]}),i[n])i[n].hasOwnProperty(e)&&(o=o.concat(this._getLocaleSectionPayload(e,t[e],i[n][e])));o.push({type:"Separator"})}}else o.push({type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",class:"versionText",value:a.get("noSavedOutputs")}]}]});return Promise.resolve({items:o,outputsInfo:i})}.bind(this))},_getLocaleSectionPayload:function(n,t,e){var i=[],o=[];return o.push({type:"text",class:"versionsLocale",value:n.toUpperCase()}),o.push({type:"text",class:"versionsLocale",value:t,name:n,hidden:!0}),e.forEach(function(t,e){o.push({type:"icon",class:"versionsOutput",name:"outputlink_"+e,svgIcon:this._getOutputIconString(t.format),clickCallback:this._openOutput.bind(this,t,!1),iconTooltip:a.get(t.format),ariaLabelledby:n}),"interactive"===this._getOutputDefaultAction(t.format)&&o.push({type:"icon",class:"versionsOutput",name:"outputlink_"+e,svgIcon:"common-download",clickCallback:this._openOutput.bind(this,t,!0),iconTooltip:a.get("download"),ariaLabelledby:n})}.bind(this)),i.push({type:"SingleLineLinks",items:[{align:"left",items:o}]}),i},_getOutputIconString:function(t){return d[t.toLowerCase()]||d.default},_getOutputDefaultAction:function(t){var e;switch(t.toLowerCase()){case"xhtml":e="interactive";break;default:e="view"}return e},_getDetails:function(t){if(this.mergedInfo&&this.mergedInfo[t]){var e={dataType:"json",type:"GET",url:l.getDetailsLink(this.mergedInfo[t])};return this.glassContext.getCoreSvc(".Ajax").ajax(e).then(function(t){return t&&t.data?Promise.resolve(t.data.data):Promise.reject(new Error("No details data"))})}return Promise.reject(new Error("No details"))},_getOutputs:function(t,e){if(t){var n={dataType:"json",type:"GET",url:t};return this.glassContext.getCoreSvc(".Ajax").ajax(n).then(function(t){return t&&t.data?Promise.resolve({data:t.data.data,index:e}):Promise.reject(new Error("No outputs data"))})}return Promise.resolve({})},_openOutput:function(a,l){return this._handleOutput({output:a,report:this.objectInfo,glassContext:this.glassContext,download:l}).then(function(t){if(!t){var e,n,i=a.id,o=a.modificationTime,s=a.format,r=a.content;switch(this._getOutputDefaultAction(s)){case"interactive":e=new this.mockableViewInteractiveReportAction,n={glassContext:this.glassContext,target:{activeObject:{aSelectedContext:[this.objectInfo],outputId:i,download:!!l},itemId:"com.ibm.bi.contentApps.defaultAction.interactiveReport"}},e.doAction(n);break;case"view":this.objectInfo.type&&-1<this.objectInfo.type.indexOf("powerPlay8Report")?(e=new this.mockableViewInteractiveReportAction,n={glassContext:this.glassContext,target:{activeObject:{aSelectedContext:[this.objectInfo],outputId:i,download:!!l},runOptions:{prompt:!0},itemId:"com.ibm.bi.contentApps.defaultAction.powerPlay8Report"}},e.doAction(n)):this.glassContext.appController.openAppView("savedoutput",this._getReportPayload(i,o,s,r)),this._addToMRU(this.objectInfo);break;default:this.glassContext.appController.openAppView("savedoutput",this._getReportPayload(i,o,s,r)),this._addToMRU(this.objectInfo)}}return Promise.resolve()}.bind(this))},_addToMRU:function(e){return this.glassContext.getSvc(".Content").then(function(t){t.addToMRU(e)})},_getReportPayload:function(t,e,n,i){return{content:{path:i,title:this.objectInfo.defaultName+" - "+e+" - "+n.toUpperCase(),id:t,reportId:l.getObjectId(this.objectInfo),type:l.getType(this.objectInfo),permissions:l.getPermissions(this.objectInfo),runInAdvancedViewer:l.getRunInAdvancedViewer(this.objectInfo)}}},_getItemsSpec:function(t,e,n){if(t&&0<Object.keys(t).length){return[{type:"Split",label:"Split",name:"Split"+this.id,items:[{align:"left",items:n},{align:"right",items:[{type:"SingleLineLinks",name:"sectionRunHistory",items:[]}]}]}]}return n},_canDelete:function(){return!this.objectInfo||!this.objectInfo.permissions||l.hasPermissions(this.objectInfo,["write"])},_onClickDelete:function(e){var t=function(t){"ok"===t.btn&&(this._deleteVersion(e),this.hasReportVersion=!1)}.bind(this);this.glassContext.appController.Glass.showMessage(a.get("confirmDeleteMessage"),a.get("confirmDelete"),"info",["cancel","ok"],void 0,t)},_handleDeleteVersionSuccess:function(t){var e=this._getVersionSection(t).getPropertyNode(),n=this._getOutputSection(t);s(".versionText",e).removeClass("clickable").addClass("hasNoOutput"),this._showAllHistoryRefresh(),s(".versionDetailsLinks",e).hasClass("disabled")&&this._removeItem(e),s(".versionReport .svgIcon use",e).attr("xlink:href","#common-savedoutput_reporthistory"),n.getPropertyNode().remove();var i=a.get("toastDoneDeletingSingular",{nameOfItem:u.enforceTextDirection(a.get("reportOutputVersion"))});this.glassContext.appController.showToast(i)},_deleteVersion:function(t){var e=this._getVersionLinkFromIndex(t);if(e){var n={dataType:"json",type:"DELETE",url:e+"?force=true&recursive=true"};return this.glassContext.getCoreSvc(".Ajax").ajax(n).then(this._handleDeleteVersionSuccess.bind(this,t)).catch(function(t){c.showAjaxServiceError(this.glassContext,t)}.bind(this))}return Promise.resolve()},_initOutputHandlers:function(){return this._outputHandlers?Promise.resolve():this.glassContext.appController.findCollection("com.ibm.bi.contentApps.authoring.outputHandlers").then(function(t){this._outputHandlers=[];var e=[];return p.each(t,function(t){e.push(new Promise(function(e){n([t.outputHandler],function(t){this._outputHandlers.push(new t),e()}.bind(this))}.bind(this)))}.bind(this)),Promise.all(e)}.bind(this))},_handleOutput:function(o){return this._initOutputHandlers().then(function(){if("interactive"===this._getOutputDefaultAction(o.output.format)&&o.download)return Promise.resolve(!1);var n,i=-1;return p.each(this._outputHandlers||[],function(t){var e=t.getPriority();i<e&&t.canExecute(o)&&(n=t,i=e)}),n?(n.execute(o),Promise.resolve(!0)):Promise.resolve(!1)}.bind(this))}});return m}),define("bi/content_apps/ArchivesTab",["bi/glass/app/ContentView","bi/content_apps/nls/StringResource","bi/content_apps/utils/C10Utils","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","lodash"],function(t,e,n,i,o){"use strict";var s=t.extend({init:function(t){s.inherited("init",this,arguments),o.extend(this,t)},_viewArchivedVersion:function(){n.openC10Morphlet(n.morphletMap.archive,this.objectInfo.type,this.objectInfo.id,[{output_tab:"arch"},{m_name:this.objectInfo.defaultName}])},render:function(){return this._id=o.uniqueId("prop_"),this._oPropertyUIControl=new i({el:this.$el,glassContext:this.glassContext,items:[{name:"viewArchivedVersions",type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",value:e.get("viewRunHistory")}]},{align:"right",items:[{type:"text",value:e.get("viewArchivedVersions"),clickCallback:this._viewArchivedVersion.bind(this)}]}]}]}),this._oPropertyUIControl.render()}});return s}),define("bi/content_apps/VersionsView",["bi/glass/app/ContentView","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentStoreObject","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","bi/content_apps/VersionsTab","bi/content_apps/ArchivesTab","lodash"],function(t,e,n,i,o,s,r){"use strict";var a=t.extend({init:function(t){a.inherited("init",this,arguments),r.extend(this,t)},render:function(){return this._containerElement=$("<div>",{class:"propertyUIControl versionsView"}),this.$el.append(this._containerElement),this._getAdditionalInfo().then(function(){return this._oPropertyUIControl=this._getPropertyUIControl({el:this.$el,glassContext:this.glassContext,slideout:this.slideout,animatedSpinner:!0,items:[{name:"versions",value:e.get("versions"),type:"Banner"},{type:"TabControl",items:[{name:e.get("versions"),module:o,objectInfo:this.objectInformation,glassContext:this.glassContext,slideout:this.slideout,parentEl:this.$el},{name:e.get("archives"),module:s,objectInfo:this.objectInformation,glassContext:this.glassContext,slideout:this.slideout}]}]}),this._oPropertyUIControl.render()}.bind(this))},_getPropertyUIControl:function(t){return new i(t)},_getAdditionalInfo:function(){return this.glassContext.getCoreSvc(".Ajax").ajax({dataType:"json",type:"GET",url:n.getSelfLink(this.objectInformation),data:{fields:"permissions,"+n.RUN_IN_ADVANCED_VIEWER}}).then(function(t){var e=t.data&&t.data.data;if(!e)return Promise.reject(new Error("No additional information"));r.extend(this.objectInformation,e[0])}.bind(this))}});return a}),define("bi/content_apps/VersionsDetailsView",["bacontentnav/lib/@waca/core-client/js/core-client/utils/Deferred","jquery","bi/glass/app/ContentView","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentStoreObject","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","bacontentnav/utils/GlassContextHelper","bi/content_apps/utils/C10Utils","lodash"],function(e,i,t,a,l,n,s,o,r){"use strict";var c=t.extend({init:function(t){c.inherited("init",this,arguments),r.extend(this,t)},render:function(){var t=new e;return this._getItems().then(function(t){return this.$el.addClass("versionsDetails"),this._oPropertyUIControl=new n({el:this.$el,glassContext:this.glassContext,slideout:this.slideout,items:t}),this._oPropertyUIControl.render()}.bind(this)).done(t.resolve),t.promise},_getItems:function(){var i=new e,t="succeeded"===l.getStatus(this.historyInfo),o=[{type:"Banner",name:"detailsBanner",value:l.getRequestedTime(this.historyInfo,!0,"medium"),centerLabel:!0,backButton:!0,editable:!1,readOnly:!0,onClose:function(){this.slideout.hide()}.bind(this)},{type:"Separator"},{type:"SingleLineLinks",name:"actionbar",items:[{align:"left",items:[{type:"icon",class:t?"versionStatusSuccessful":"versionStatusFailed",svgIcon:t?"common-successful":"common-failed",value:t?a.get("successful"):a.get("failed"),iconTooltip:t?a.get("successful"):a.get("failed")},{type:"text",class:"versionStatusText",role:"status",value:t?a.get("successful"):a.get("failed")}]}]},{type:"SingleLineLinks",name:"historydetails",items:[{align:"right",items:[{type:"text",value:a.get("runHistoryDetails"),class:"historydetailsText",clickCallback:this._viewRunHistory.bind(this),showRightArrow:!0}]}]}];return l.getMessages(this.detailsInfo)&&o.push({type:"CollapsibleSection",name:"errorMessages",open:!0,label:a.get("errorMessages"),items:this._getMessageItems()}),this._getOptionsItems().then(function(t){var e=this.detailsInfo.IPA&&this.detailsInfo.IPA[0];o=o.concat([{type:"CollapsibleSection",name:"runTime",open:!0,label:a.get("runTime"),items:[{type:"SingleLineValue",name:"requestTime",label:a.get("requestTime"),value:l.getRequestedTime(this.historyInfo,!0,"medium")},{type:"Separator"},{type:"SingleLineValue",name:"startTime",label:a.get("startTime"),value:l.getExecutionTime(this.historyInfo,!0,"medium")},{type:"Separator"},{type:"SingleLineValue",name:"endTime",label:a.get("endTime"),value:l.getCompletionTime(this.historyInfo,!0,"medium")}]}]),e&&o.push({type:"Separator"},{type:"SingleLineLinks",name:"performance",items:[{align:"left",items:[{type:"text",name:"performance",value:a.get("performanceDetails")}]},{align:"right",items:[{type:"text",value:a.get("clickHere"),class:"detailsURLLink",clickCallback:this._getPerformanceURL.bind(this,e)}]}]}),"jupyterNotebook"!==this.objectInfo.type&&o.push({type:"CollapsibleSection",name:"options",open:!0,label:"jobDefinition"===this.objectInfo.type?a.get("job"):a.get("report"),items:t});var n=l.getDetailsReportVersionParameters(this.detailsInfo);n&&(o=o.concat([{type:"CollapsibleSection",name:"promptValues",label:a.get("promptValues"),items:this._getPromptValuesItems(n)}])),i.resolve(o)}.bind(this)),i.promise},_getPerformanceURL:function(t){var e="pathRef=.public_folders/ZIPI/Interactive+Performance+Assistant/ProcessTime&format=HTML&Download=false&prompt=false&action=run&p_zipiid="+encodeURIComponent(t),n=window.location.origin+window.location.pathname.substr(0,window.location.pathname.lastIndexOf("/"))+"/?"+e;window.open(n)},_getMessageItems:function(){var o=[],s="versionMessageIcon ",r="";return l.getMessages(this.detailsInfo).forEach(function(t,e){var n=l.getMessageSeverity(t),i="";switch(n){case"error":case"fatal":i=s+"versionErrorIcon",r="common-close-cancel-error";break;case"warn":i=s+"versionWarningIcon",r="common-warning-hollow";break;case"debug":i=s+"versionDebugIcon",r="common-debug";break;case"info":i=s+"versionInfoIcon",r="common-information"}o.push({type:"SingleLineLinks",name:"messages_"+e,items:[{align:"left",items:[{type:"icon",class:i,svgIcon:r,value:a.get(n),iconTooltip:a.get(n)},{type:"text",class:"wraptext textSelectable",value:l.getMessageDetail(t)}]}]})}),o},_getOptionsItems:function(){var i=l.getDetailsReportVersionOptions(this.detailsInfo),o=new e;return i?this._getReportLanguages(i).then(function(t){var e=[];"jobDefinition"!==this.objectInfo.type&&e.push({type:"TextArea",name:"formats",label:a.get("formats"),value:this._getReportFormats(i),editable:!1,multiline:!1},{type:"Separator"}),e.push({type:"TextArea",name:"languages",label:a.get("languages"),value:t,editable:!1,multiline:!1});var n=l.getLocation(this.objectInfo);n&&(e=e.concat([{type:"Separator"},{type:"SingleLineValue",name:"location",label:a.get("location"),value:n}])),o.resolve(e)}.bind(this)):o.resolve([{type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",class:"wraptext",value:a.get("noReportOptionsAvailable")}]}]}]),o.promise},_getReportFormats:function(t){var e=this._getReportVersionOption(t,"outputFormat"),n=[];return e?(r.isArray(e)?e.forEach(function(t){n.push(a.get(t))}):n.push(a.get(e)),this._getDelimitedStringFromArray(n)):a.get("unavailable")},_getReportLanguages:function(t){var i=this._getReportVersionOption(t,"outputLocale"),o=new e;return i?s.getContentLocales(this.glassContext).then(function(e){var n=[];e=e||{},i.forEach(function(t){n.push(e[t])}),o.resolve(this._getDelimitedStringFromArray(n))}.bind(this)):o.resolve(a.get("unavailable")),o.promise},_getDelimitedStringFromArray:function(t){return t?t.join(", "):null},_getReportVersionOption:function(t,e){var n=i.grep(t,function(t){return t.name===e});return 1===n.length&&n[0].value?n[0].value:null},_getPromptValuesItems:function(t){var e=[];return l.getPromptsDisplayValues(t,!0).forEach(function(t){e.push({type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",class:"promptNameText textSelectable",value:r.escape(t.name+":")}]}]},{type:"SingleLineLinks",items:[{align:"left",items:[{type:"text",class:"wraptext textSelectable",value:r.escape(t.display)}]}]},{type:"Separator"})}),e},_viewRunHistory:function(){var t=[{m_name:this.objectInfo.defaultName}];o.openC10Morphlet(o.morphletMap.viewHistory,this.objectInfo.type,this.historyInfo.id,t)}});return c}),define("js/content_apps/versionBundle",function(){});