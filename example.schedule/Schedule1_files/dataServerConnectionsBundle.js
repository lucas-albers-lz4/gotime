/**
 * IBM Confidential OCO Source Materials IBM Business Platform: CA Admin
 * (C) Copyright IBM Corp. 2017, 2018
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

define("text!bi/admin/common/templates/Menu.html",[],function(){return'<!--\n * Licensed Materials - Property of IBM\n * IBM Cognos Products: BI Cloud (C) Copyright IBM Corp.  2017\n * US Government Users Restricted Rights - Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.\n *-->\n<div class="dropdown-toggle" id="{{=it.id}}_toggle" data-toggle="dropdown" aria-describedby="{{=it.id}}_ddtMenu" aria-label="{{!it.label}}" tabindex="0" role="button" aria-haspopup="true">\n	{{? it.hcLabel}}\n		<span class="hcLabel">{{=it.label}}</span>\n	{{?}}\n	{{? it.labelOnly}}\n		<span id="{{=it.id}}_ddtMenu" class="menu-label">{{=it.label}}</span>\n	{{?}}\n</div>\n<div class="arrow-wrapper">\n	<div class="arrow"></div>\n</div>\n<ul class="dropdown-menu" id="{{=it.id}}_toggle" aria-labelledby="{{=it.id}}_toggle" role="menu">\n		{{? it.showTitle}}\n		<h1 role="presentation" class="dropdown-header header-{{!it.name}}">{{!it.label}}</h1>\n		{{?}}\n		{{~it.items :item :index}}\n			{{? item.disabled && item.icon}}\n				<li role="presentation" class="dropdown-header header-{{!item.name}} {{?item.hidden}}hidden{{?}}" aria-disabled="true"  id="{{=it.id}}_{{=item.name}}">\n					<span class="{{!item.icon}} menuitem-icon"></span>{{!item.label}}</li>\n			{{?? item.disabled}}\n				<li role="presentation" class="dropdown-header header-{{!item.name}} {{?item.hidden}}hidden{{?}}" aria-disabled="true"  id="{{=it.id}}_{{=item.name}}">{{!item.label}}</li>\n			{{?? item.cssStyleClass}}\n				<li class="{{!item.cssStyleClass}} dropdown-menuitem {{=item.name}} {{?item.hidden}}hidden{{?}}" id="{{=it.id}}_{{=item.name}}">\n					<a href="#" aria-label="{{!item.label}}" {{? index=== 0}}class="firstMenuItem"{{?}} {{? index === it.items.length - 1}}class="lastMenuItem"{{?}}>\n						<span class=""></span>&nbsp;{{!item.label}}</a>\n				</li>\n			{{??}}\n				<li class="dropdown-menuitem {{=item.name}} {{?item.hidden}}hidden{{?}}" id="{{=it.id}}_{{=item.name}}">\n				{{? it.showTick && item.icon}}\n					<a role="menuitemcheckbox" href="#" aria-label="{{!item.label}}" aria-checked="false" {{? index=== 0}}class="firstMenuItem"{{?}} {{? index === it.items.length - 1}}class="lastMenuItem"{{?}} >\n						<span class="{{!item.icon}} menuitem-icon"></span><span class="wfg_accept"></span>{{!item.label}}</a>\n				{{?? it.showTick}}\n					<a role="menuitemcheckbox " href="#" aria-label="{{!item.label}}" aria-checked="false" class="textOnly {{? index=== 0}}firstMenuItem{{?}} {{? index === it.items.length - 1}}lastMenuItem{{?}}">{{!item.label}}</a>\n				{{?? item.icon}}\n					<a href="#" aria-label="{{!item.label}}" {{? index=== 0}}class="firstMenuItem"{{?}} {{? index === it.items.length - 1}}class="lastMenuItem"{{?}}>\n						<span class="{{!item.icon}} menuitem-icon"></span><span class="wfg_accept"></span>&nbsp;{{!item.label}}</a>\n				{{??}}\n					<a  role="menuitem" href="#" aria-label="{{!item.label}}" class="textOnly {{? index=== 0}}firstMenuItem{{?}} {{? index === it.items.length - 1}}lastMenuItem{{?}}">{{!item.label}}</a>\n				{{?}}\n		{{?}}\n		</li>\n	{{~}}\n</ul>\n'}),define("bi/admin/common/ui/Menu",["bi/commons/ui/View","jquery","lodash","bi/commons/utils/BidiUtil","text!../templates/Menu.html"],function(e,t,i,n,s){var a=null;return a=e.extend({templateString:s,events:{keydown:"_handleKeyboard","click .dropdown-menuitem":"_handleClick"},itemActions:null,itemSpecMap:null,baseClass:"toolbar",hcLabel:null,showTitle:!0,init:function(e){i.defaults(e,{hcLabel:!0}),i.assign(this,e),this.itemActions={},this.itemSpecMap={},i.forEach(this.items,function(e){this.itemSpecMap[e.name]=e}.bind(this)),a.inherited("init",this,arguments)},_handleClick:function(e){e.preventDefault(),this._performAction(e.currentTarget.id)},_performAction:function(e){var t=this.itemActions[e];t&&setTimeout(function(){t()},10)},removeItem:function(e){var t=this.viewId+"_"+e;this.$menu.children("#"+t).remove(),delete this.itemSpecMap[e],delete this.itemActions[t]},addDivider:function(){var e=t('<li role="presentation" class="divider">');return this.$menu.append(e),e},addItem:function(e){this.itemSpecMap[e.name]=e;var i=t('<li id="'+this._getItemId(e.name)+'">'),n=null;return n=t(e.checked?'<a role="menuitem" href="#" aria-label="'+e.label+'" aria-checked="true" class="menuitem-toggled">'+e.label+"</a>":'<a role="menuitem" href="#" aria-label="'+e.label+'" aria-checked="false">'+e.label+"</a>"),i.append(n),i.addClass("dropdown-menuitem"),i.addClass(e.name),this.$menu.append(i),this._buildMenuItem(e),i},showItem:function(e){this.$menu.find("."+e).removeClass("hidden")},hideItem:function(e){this.$menu.find("."+e).addClass("hidden")},_handleKeyboard:function(e){var n,s=e.which||e.keyCode||e.charCode,a=t(e.target);switch(s){case 9:e.shiftKey?a.hasClass("firstMenuItem")&&(n=a.closest("ul").find("a.lastMenuItem"),n.focus(),e.preventDefault()):a.hasClass("lastMenuItem")&&(n=a.closest("ul").find("a.firstMenuItem"),n.focus(),e.preventDefault());break;case 13:case 32:if(e.preventDefault(),this.$toggle.dropdown("toggle"),t(e.target).hasClass("dropdown-toggle")){var o=this.$el.find(".dropdown-menu a").first();o.focus()}else{var r=this.getTarget(e.target,"dropdown-menuitem");this._performAction(r.id)}break;case 37:case 39:if(t(e.target.parentNode).hasClass("dropdown-menuitem")){var l=i.clone(e);l.keyCode=s+1,t(e.target).trigger(l)}}},_templateParams:function(){return{id:this.viewId,items:this.items,label:this.label,icon:this.icon,hcLabel:this.hcLabel,baseClass:this.baseClass,labelOnly:this.labelOnly,showTitle:this.showTitle}},render:function(){var e=this.dotTemplate(this._templateParams());this.$el.append(e),this.$el.addClass(this.baseClass+"ItemWrapper"),this.$el.addClass("dropdown"),this.$toggle=this.$el.children(".dropdown-toggle"),this.$toggle.addClass(this.baseClass+"Icon"),this.$iconImage=t('<span class="'+this.icon+'"></span>'),this.icon&&this.$toggle.prepend(this.$iconImage),this.$toggle.attr("title",this.label),this.$toggle.addClass(this.baseClass+"Item"),this.$menu=this.$el.children(".dropdown-menu"),this.trailing&&this.$menu.addClass("dropdown-menu-right");var i=this._buildDropDown();return this.$menuLabel=this.$el.find(".menu-label"),i},_buildDropDown:function(){var e=t.Deferred();return require(["bsdropdown"],function(){this.$toggle.dropdown(),this.action&&this.$el.on("show.bs.dropdown",this.action.bind(this)),this._buildMenuItems(),e.resolve(this.$el)}.bind(this)),e.promise()},_buildMenuItems:function(){i.forEach(this.items,function(e){this._buildMenuItem(e)}.bind(this))},_getItemId:function(e){return this.viewId+"_"+e},_buildMenuItem:function(e){var i=this._getItemId(e.name);this.itemActions[i]=e.action;var s=t("#"+i),a=s.get(0);a&&n.initElementForBidi(a)}})}),define("bi/admin/common/ui/MenuWithTick",["./Menu","lodash","text!../templates/Menu.html"],function(e,t,i){var n=null;return n=e.extend({templateString:i,init:function(e){t.assign(this,e),n.inherited("init",this,arguments)},_templateParams:function(){var e=n.inherited("_templateParams",this,arguments);return e.showTick=!0,e},updateMenuItemTick:function(e,t){if(e){var i=e.find("a");t?i.addClass("menuitem-toggled"):i.removeClass("menuitem-toggled"),e.find("a")[0].setAttribute("aria-checked",t?"true":"false")}}})}),define("bi/admin/common/ui/GeminiToggleMenuBar",["./MenuWithTick","lodash"],function(e,t){"use strict";var i=null;return i=e.extend({itemMap:{},sCheckedItemName:null,updateLabel:!1,init:function(e){t.assign(this,e),i.inherited("init",this,arguments)},toggleHandler:function(e){this.updateSelectedItem(e)},updateSelectedItem:function(e){var t=this.itemMap[e];t&&t.children&&(this.sCheckedItemName&&this.updateMenuItemTick(this.itemMap[this.sCheckedItemName],!1),this.sCheckedItemName=e,this.updateMenuItemTick(this.itemMap[this.sCheckedItemName],!0),this.updateLabel&&this.$menuLabel.length>0&&t.children&&this.$menuLabel.text(t.children("a").attr("aria-label")))},render:function(){var e=i.inherited("render",this,arguments);return this.updateLabel&&(t.forEach(this.items,function(e){e.checked&&this.updateSelectedItem(e.name)}.bind(this)),this.sCheckedItemName||this.updateSelectedItem(this.items[0].name)),e},_performAction:function(e){this.updateSelectedItem(this._getItemNameFromID(e)),i.inherited("_performAction",this,arguments)},_getItemNameFromID:function(e){var t=this.viewId+"_";return e.substr(t.length)},_buildDropDown:function(){var e=i.inherited("_buildDropDown",this,arguments);return t.forEach(this.items,function(e){var t=this._getItemId(e.name);this.itemMap[e.name]=this.$menu.find("#"+t),e.checked&&(this.sCheckedItemName=e.name)}.bind(this)),this.updateMenuItemTick(this.itemMap[this.sCheckedItemName],!0),e},remove:function(){t.forEach(this.itemMap,function(e){e.remove&&e.remove()}),i.inherited("remove",this,arguments)}})}),define("bi/admin/common/ui/ToggleMenuBar",["jquery","bi/admin/common/ui/GeminiToggleMenuBar","bi/commons/utils/Utils"],function(e,t,i){var n=null;return n=t.extend({events:{"clicktap .dropdown-toggle":"_handleClick","clicktap .dropdown-menuitem":"_handleClick",keydown:"_handleKeyboard"},render:function(){n.inherited("render",this,arguments),this.icon&&(this.iconRightAlign&&this.$toggle.append(this.$iconImage),this.bSVG&&i.setIcon(this.$iconImage,this.icon))}})}),define("text!bi/admin/common/templates/BasePane.html",[],function(){return'<div class="bi-admin-base-pane bi-admin-vflex bi-admin-fullheight" tabindex="0" style="padding: 0px 18px 12px 18px;">\n	<div class="bi-admin-pane-header bi-admin-hflex">\n	    <div class="bi-admin-leading">\n	        <div class="goback">\n	            <span class="goback-icon wft_chevron_left" tabindex="0"></span>\n	        </div>\n	        <span class="title text-ellipsis"></span>\n	    </div>\n	\n	    <div class="bi-admin-center">\n	    </div>\n	\n	    <div class="bi-admin-trailing">\n	        <div class="bi-admin-buttonbar">\n	        </div>\n	    </div>\n	</div>\n	<div class="bi-admin-pane-body">\n	</div>\n</div>'}),define("bi/admin/common/slideout/BasePane",["lodash","q","doT","bi/commons/utils/BidiUtil","bi/commons/utils/Utils","bi/commons/ui/AccessibleView","bi/admin/common/ui/ToggleMenuBar","text!bi/admin/common/templates/BasePane.html","bi/admin/nls/StringResource"],function(e,t,i,n,s,a,o,r,l){var d=a.extend({title:"",showHeader:!0,showGobackButton:!1,showSwitchViewButton:!1,autoValidate:!1,flexBody:!0,isWideView:!1,init:function(e){d.inherited("init",this,arguments),$.extend(this,e);var t={};t.strings={goback:l.get("goback"),switchViews:l.get("switchViews")};var n=i.template(r)(t);this.$el.append(n),this.$el.addClass("bi-admin-vflex bi-admin-fullheight")},_setTextDirection:function(e){for(var t=0;t<e.length;t++)n.initElementForBidi(e[t])},_autoValidate:function(){var e=this;this.autoValidate&&this.$el.find("[required]").on({blur:this._onBlur.bind(e),invalid:this._onInvalid,focus:this._onFocus})},_onBlur:function(e){this._checkSpace(e.target)&&this._checkScript(e.target)},_onInvalid:function(e){e.target.validity.valueMissing?$(e.target.parentNode).append($("<p class='invalid'> </p>").append($("<label class='invalid'/>").text(l.get("required")))):(e.target.validity.typeMismatch||e.target.validity.patternMismatch)&&$(e.target.parentNode).append($("<p class='invalid'> </p>").append($("<label class='invalid'/>").text(l.get("invalid"))))},_onFocus:function(e){$(e.target.parentNode).find(".invalid").remove()},setFocus:function(){var e=this.$el.find(".bi-admin-base-pane");e.focus()},onHide:function(){},onToggleMenuChanged:function(){},renderToggleMenu:function(t,i,n,s,a){var r=e.map(n,function(e,t){return{name:i+t,icon:"wft_checkmark",label:l.get(e),checked:e===s,action:function(){this.onToggleMenuChanged(i,e)}.bind(this)}}.bind(this)),d={baseClass:"appbar",label:l.get("type"),name:i,labelOnly:!0,hcLabel:!1,supportCustomCollapse:!0,showTitle:!1,updateLabel:!0,icon:"common-titan-arrow-down",iconRightAlign:!!a,bSVG:!0,el:t,items:r},c=new o(d);c.render()},render:function(){var e=t.defer();return this.$header=this.$el.find("div.bi-admin-pane-header"),this.$body=this.$el.find("div.bi-admin-pane-body"),this.isWideView&&this.$body.addClass("bi-admin-widepane"),this.flexBody&&this.$body.addClass("bi-admin-pane-flex"),this.showHeader?this.renderHeader(this.$header):(this.$header.hide(),this.$body.addClass("noheader")),this.renderBody(this.$body).done(function(){this._localize(),this._autoValidate();var t=this.$el.find(".bi-admin-pane-body");t.attr("aria-label",this.title),t.attr("role","group"),e.resolve(this)}.bind(this)),e.promise},onHeaderButtonClicked:function(e){"switchButton"===e&&this._switchView()},onHeaderChecked:function(){},_createCheckbox:function(e,t,i){var n=this,s=$('<div class="bi-admin-checkbox"></div>');s.attr("id",e);var a=$('<input type="checkbox"></input>');a.prop("checked",i),a.attr("aria-label",t),a.on("change",function(){var t=$(this);n.onHeaderChecked(e,t.is(":checked"))});var o=$("<span/>");return o.text(t),s.append(a),s.append(o),s},_createButton:function(e,t,i,n){var a=$("<button />");return a.attr("id",e),a.attr("title",i||""),a.addClass("bi-admin-button"),n&&a.addClass(n),s.setIcon(a,t),a.on("primaryaction",function(){this.onHeaderButtonClicked(e)}.bind(this)),a},renderHeader:function(e){if(e[this.showGobackButton?"addClass":"removeClass"]("show-goback"),this.showGobackButton===!0){var t=e.find(".goback");t.find(".goback-icon").attr("aria-label",l.get("goBack")),t.on("primaryaction",function(){this.slideout.hide()}.bind(this))}var i=this.$header.find("div.bi-admin-trailing .bi-admin-buttonbar");if(this.showSwitchViewButton){var n=this._createButton("switchButton",this.isWideView?"common-left_collapse":"common-right_expand",l.get("switchViews"));i.append(n)}e.find("div.bi-admin-leading .title").text(this.title)},_switchView:function(){var t=this._getSwitchOptions()||{},i=e.assign({showSwitchViewButton:!0,module:this._getSwitchedModuleName()},t);this.glassContext.appController.hideSlideOut(),this.glassContext.appController.showSlideOut({position:"left",width:this._getViewWidth(),closeSlideouts:!0,content:i})},_getSwitchedModuleName:function(){},_getSwitchOptions:function(){},_getViewWidth:function(){var e=450;return this.isWideView||(e=$(window).width()<1370?576:800),e},renderBody:function(){},_localize:function(e){if(this._stringResource){var t=this;e=e||this.$el,e.find("[local_id]").each(function(){var e=$(this),i=e.attr("local_id");e.text(t._stringResource.get(i))}),e.find("[local_title]").each(function(){var e=$(this),i=e.attr("local_title");e.attr("title",t._stringResource.get(i))})}},_checkSpace:function(e){var t=!0,i=/^\s*$/;return $(e.parentNode).find(".invalid").remove(),$(e).val()&&i.test($(e).val())&&($(e.parentNode).append($("<p class='invalid'> </p>").append($("<label class='invalid'/>").text(l.get("invalid")))),t=!1),t},_checkScript:function(e){var t=!0;return $(e.parentNode).find(".invalid").remove(),-1!==$(e).val().indexOf("<script")&&($(e.parentNode).append($("<p class='invalid'> </p>").append($("<label class='invalid'/>").text(l.get("invalid")))),t=!1),t},validate:function(){var e=this,t=!0;return this.$el.find(".invalid").remove(),this.$el.find("[required]").each(function(){return(e._checkSpace(this)&&e._checkScript(this))===!1?(t=!1,!1):void 0}),t},close:function(){this.slideout.hide()},isSysAdmin:function(){return this.glassContext.getCoreSvc(".UserProfile").isSysAdmin()},isTenantAdmin:function(){return this.glassContext.getCoreSvc(".UserProfile").isTenantAdmin()}});return d}),define("bi/admin/common/ui/MagicWand",["jquery","q","bi/commons/ui/core/Class","bi/admin/nls/StringResource"],function(e,t,i,n){"use strict";var s=null,a=i.extend({_types:{searchInput:{query:'input[type="search"]',ariaLabel:n.get("editFilter"),module:"bi/admin/common/ui/input/SearchInput"},radioBox:{query:'input[type="radio"]',module:"bi/admin/common/ui/input/RadioBox"},checkBox:{query:'input[type="checkbox"]',module:"bi/admin/common/ui/input/CheckBox"},button:{query:"button",module:"bi/admin/common/ui/input/Button"},testFlow:{query:"[data-bi-testflow]",module:"bi/admin/common/ui/testflow/TestFlow"}},init:function(t){e.extend(this,t)},searchInput:function(e){var t=this._types.searchInput;return this._doTransform(t,e)},radioBox:function(e){var t=this._types.radioBox;return this._doTransform(t,e)},checkBox:function(e){var t=this._types.checkBox;return this._doTransform(t,e)},button:function(e){var t=this._types.button;return this._doTransform(t,e)},testFlow:function(e){var t=this._types.testFlow;return this._doTransform(t,e)},all:function(e){this.searchInput(e),this.radioBox(e),this.checkBox(e),this.button(e)},_doTransform:function(i,n){var s=t.defer(),a=e(i.query,n);return a.hide(),require([i.module],function(t){var o=[];a.each(function(s,a){var r,l=e(a);i.ariaLabel&&l.attr("aria-label",i.ariaLabel);var d=l.data("widgetName");d?(r=l.data(d),r&&r.refresh&&r.refresh()):r=new t({el:this,scope:n}),o.push(r)}),a.show(),s.resolve(o)}),s.promise},transform:function(){}}),o={getInstance:function(){return s||(s=new a),s}};return o.getInstance()}),define("bi/admin/common/ui/listview/ListDataAdaptor",["doT","q","jquery","lodash","bi/glass/core/Events"],function(e,t,i,n,s){"use strict";var a=s.extend({supportSorting:!0,supportPaging:!1,pageSize:100,filters:null,sortOrder:null,clientFilter:null,init:function(e){if(a.inherited("init",this,arguments),i.extend(this,e),!this.sortOrder){var t=this.getColumnSpecs(),s=n.find(t,function(e){return e.sortable});s&&(this.sortOrder=[n.indexOf(t,s),"asc"])}},isServerSorting:function(){return this.supportSorting&&!this.supportPaging&&!!this.sortOrder},getColumnSpecs:function(){return[]},onConditionChanged:function(){},setOrder:function(e,t){var i=this.getColumnSpecs()[e];i&&i.sortable&&(this.sortOrder=[e,t],this.onConditionChanged())},setFilters:function(e){this.filters=e||{},this.onConditionChanged()},setClientFilter:function(e){this.clientFilter=e},clearClientFilter:function(){this.clientFilter=null},hasMore:function(){return!1},getFilteredRows:function(){},getRows:function(){}});return a}),define("bi/admin/datasource/services/DataSourceListController",["lodash","bi/commons/ui/core/Class","bi/admin/common/utils/AJAXUtils"],function(e,t,i){"use strict";var n=t.extend({init:function(t){n.inherited("init",this,arguments),e.assign(this,t)},_formatDataSourceEntry:function(e){var t=e.permissions&&e.permissions.indexOf("write")>-1?!0:!1;return{id:e.id,connections:e.connections,title:e.defaultName,defaultName:e.defaultName,defaultDescription:e.defaultDescription,connectionString:e.connectionString,toolTip:e.defaultName,owner:e.owner,disabled:e.disabled,hidden:e.hidden,modificationTime:e.modificationTime,creationTime:e.creationTime,writable:t,permissions:e.permissions,ancestors:e.ancestors,type:e.type}},getDataSource:function(e){var t={method:"GET",contentType:"application/json; charset=utf-8",dataType:"json"};return t.url=i.getAJAXURL("datasources")+"/"+e+"?"+encodeURIComponent("fields")+"="+encodeURIComponent("defaultName,disabled,permissions,owner.defaultName,hidden,capabilities,hasChildren,searchPath,modificationTime,creationTime,ancestors,defaultDescription,tenantID,owner.id"),this.glassContext.services.ajax.ajax(t)},_getDataSources:function(){var e={method:"GET",contentType:"application/json; charset=utf-8",dataType:"json"};return e.url=i.getAJAXURL("datasources")+"?"+encodeURIComponent("fields")+"="+encodeURIComponent("defaultName,disabled,permissions,modificationTime,type,hidden"),this.glassContext.services.ajax.ajax(e)},deleteDataSource:function(e){var t={method:"DELETE",contentType:"application/json; charset=utf-8",dataType:"json"};return t.url=i.getAJAXURL("datasources")+"/"+e,this.glassContext.services.ajax.ajax(t)},getDataSourceList:function(){var t;return Promise["try"](function(){return this._getDataSources().fail(function(e,i){t=i}.bind(this))}.bind(this))["catch"](function(e){return t&&(e=t),this.logger.error(e),{data:[]}}.bind(this)).then(function(t){var i=e.sortBy(t.data,function(e){return e.defaultName.toLowerCase()});return e.map(i,this._formatDataSourceEntry.bind(this),function(){this.glassContext.services.logger.error("Could not map data serivces")}.bind(this))}.bind(this))}});return n}),define("bi/admin/datasource/services/DatasourceListAdapter",["jquery","lodash","bi/admin/nls/StringResource","bi/admin/common/ui/listview/ListDataAdaptor","bi/admin/datasource/services/DataSourceListController"],function(e,t,i,n,s){var a=n.extend({supportPaging:!0,pageSize:50,sortChanged:!1,items:[],sortOrder:[1,"asc"],removeSelf:!1,init:function(t){a.inherited("init",this,arguments),e.extend(this,t),this.columnSpecs=this.getColumnSpecs(),this.listController=this._getNewDataSourceListController({glassContext:this.glassContext})},_getNewDataSourceListController:function(e){return new s(e)},getColumnSpecs:function(){var e=[{type:"Icon"},{type:"MultipleProperties",label:i.get("name"),sortable:!0,scope:"row",items:[{type:"Text",label:i.get("name"),propertyName:"defaultName",sortable:!0,scope:"row",clickCallback:function(){}}]},{type:"Time",label:i.get("lastModified"),propertyName:"modificationTime",sortable:!0}];return this.showContextMenu&&e.push({type:"ContextMenu",width:"10%",module:"bacontentnav/common/ui/list_columns/ContextMenu"}),e},locationChanged:function(){},getItems:function(){return this.listController.getDataSourceList()},getFilteredRows:function(){return this.items},setOrder:function(e,t){this.sortChanged=!0;var i=this.getColumnSpecs()[e];this.sortOption=i.type,this.sortOrder=t},getRows:function(){return this.getItems().then(function(e){if(this.sortOption)switch(this.sortOption){case"Time":this.items=this.items=t.sortBy(e,"modificationTime"),"asc"!==this.sortOrder&&this.items.reverse();break;default:this.items=t.sortBy(e,"defaultName"),"asc"!==this.sortOrder&&this.items.reverse()}else this.items=t.sortBy(e,"defaultName");return{rows:this.items,hasMore:!1}}.bind(this))},hasMore:function(){return!1},rowClickHandler:function(t,i){this.showContextMenu&&e(t).trigger("com.ibm.ds.selected",i)}});return a}),define("bi/admin/common/services/ExtensionService",["bi/glass/core/Class","jquery"],function(e,t){"use strict";var i=e.extend({themesUrl:"v1/plugins/themes",extensionsUrl:"v1/plugins/extensions",init:function(e){i.inherited("init",this,arguments),this.logger=e.glassContext.appController.logger,this.ajaxService=e.glassContext.getCoreSvc(".Ajax")},ajax:function(e){var i=t.Deferred();if(this.ajaxService)return this.logDebug(e),this.ajaxService.ajax(e,i);var n="There is no ajax service from glass context.";return this.logError(n),i.reject(n)},"delete":function(e,t,i){var n;"theme"===e||"extension"===e?t?n=this.getUrl(e,t,i,"delete"):this.logError("Missing name for deletion"):this.logError("Incorrect extension type: "+e);var s={dataType:"json",type:"DELETE",url:n};return this.ajax(s)},updateOrUpload:function(e){var i,n;if(e.isUpload)i=this.getUrl(e.type,null),n="POST";else{if(!e.name){var s="Name is not specified for update.";this.logError(s);var a=t.Deferred();return a.reject(s)}i=this.getUrl(e.type,e.name,null,"update"),n="PUT"}var o={headers:{Accept:"application/json","Content-Type":"application/zip"},url:i,type:n,data:e.data,"Content-Length":e.byteLength,processData:!1};return this.ajax(o)},logError:function(e){this.logger&&this.logger.error(e)},logDebug:function(e){this.logger&&this.logger.debug(e)},buildUrl:function(e,t,i,n){var s;return i=i?i:"global",s=t?"update"!==n?e+"/"+i+"/"+t:e+"/"+t:e},getUrl:function(e,t,i,n){var s;return"theme"===e?s=this.buildUrl(this.themesUrl,t,i,n):"extension"===e?s=this.buildUrl(this.extensionsUrl,t,i,n):this.logError("Incorrect extension type: "+e),s||this.logDebug("Empty url"),s}});return i}),define("bi/admin/common/Uploader",["lodash","bi/glass/core/Class","bi/admin/nls/StringResource","bi/glass/common/ui/ProgressToast"],function(e,t,i,n){"use strict";var s=t.extend({includeFileName:!1,init:function(t){s.inherited("init",this,arguments),e.assign(this,t)},_getWindow:function(){return window},_getNavigator:function(){return navigator},doUpload:function(){return new Promise(function(e,t){var n=this.glassContext.appController;if(this._getWindow().File&&this._getWindow().FileReader&&this._getWindow().FileList&&this._getWindow().Blob)if(/^((?!chrome).)*safari\/537/i.test(this._getNavigator().userAgent))n.showErrorMessage(i.get("errorUploadSupport"),i.get("error")),t();else{this._removeInput();var s=this._getInput();this.$el.append(s),s.change(function(i){this._verifyAndUpload(i).then(e,t)}.bind(this)),document.getElementById("skipInvokingFileSelectionAdmin")||s.click()}else n.showErrorMessage(i.get("errorHTML5Support"),i.get("error")),t()}.bind(this))},_getBaseInputOptions:function(){return{type:"file",id:"idUploadUIElement",name:"uploadfiles",style:"display: none;",multiple:!1}},_getInput:function(){var e=this._getBaseInputOptions();return this.fileType&&"csv"===this.fileType?e.accept=".csv":e.accept="application/zip",$("<input>",e)},_verifyAndUpload:function(t){return Promise["try"](function(){var n,s=t.target.files[0],a=500,o=1024*a*1024;if(e.isUndefined(s.size)||s.size>o)n=i.get("msgHardLimitFileUpload",{message:a}),this.glassContext.appController.showErrorMessage(n,i.get("error"));else{if(this._isValidFileName(s.name))return this._uploadProcessor(s);n=this._getInvalidFileNameMessage(),this.glassContext.appController.showErrorMessage(n,i.get("msgFileNameUploadTitle"))}throw new Error(n)}.bind(this))},_isValidFileName:function(e){return"csv"===this.fileType?/^[a-z0-9_ \-\.]{1,200}\.csv$/i.test(e):/^[a-z0-9_ \-\.]{1,200}\.zip$/i.test(e)},_getInvalidFileNameMessage:function(){return i.get("msgFileNameUpload")},_createFileReader:function(){return new FileReader},_createProgressToast:function(){return new n},_uploadProcessor:function(e){return new Promise(function(t,n){this.progressBar=this._createProgressToast();var s=this._createFileReader();this.progressBar.show(i.get("msgUploadStarted")),this.progressBar.progress(),this.progressBar.onCancel(function(){try{s.abort()}catch(e){return}}.bind(this)),s.onerror=function(){this.progressBar.fail(i.get("errorReadingFile")),n()}.bind(this),s.onabort=function(){this.progressBar.fail(i.get("abortReadingFile")),n()}.bind(this),s.onprogress=function(e){var t=Math.round(e.loaded/e.total*100);this.progressBar.setComplete(t)}.bind(this),s.onload=function(i){this._readerOnload(e.name,i).then(t,n)}.bind(this),s.readAsArrayBuffer(e)}.bind(this))},_readerOnload:function(t,n){this.progressBar.indefinite(i.get("msgUploadToServer"));var s={data:n.target.result,byteLength:n.target.result.byteLength};return this.includeFileName&&(s.fileName=this._getFileName(t,n)),e.assign(s,this.ajaxOptions),this.ajax(s).then(function(){this.progressBar.setComplete(100,{isComplete:!0,completeMsg:i.get("msgFileUploadSuccess")})}.bind(this),function(t){if(t.jqXHR){var i=t.jqXHR;if(!e.isUndefined(i.responseJSON)&&!e.isUndefined(i.responseJSON.errors)){var n=i.responseJSON.errors;n.length>0&&this.glassContext.appController.showErrorMessage(n[0].message,n[0].code)}}throw this.progressBar.remove(""),i}.bind(this))},_removeInput:function(){this.$el.find("input#idUploadUIElement").remove()},_getFileName:function(e,t){return e}});return s}),define("bi/admin/common/actions/ListAction",["lodash","jquery","bi/glass/core/Class","bi/admin/common/services/ExtensionService","bi/commons/ui/dialogs/ConfirmationDialog","bi/admin/nls/StringResource","bi/commons/utils/BidiUtil","bi/admin/common/Uploader","bi/commons/utils/Downloader"],function(e,t,i,n,s,a,o,r,l){"use strict";var d=i.extend({ItemIds:["com.ibm.bi.admin.deleteAction","com.ibm.bi.admin.updateAction","com.ibm.bi.admin.downloadAction"],init:function(t){d.inherited("init",this,arguments),e.assign(this,t)},isItemVisible:function(e){if(this.aSelectedContext=this.getSelectedContext(e),!this.aSelectedContext)return!1;if(!this.extensionService){var t={glassContext:e.glassContext};this.extensionService=new n(t)}this.listControl||(this.listControl=this.getListControl(e));var i=e.target.itemId,s=this.ItemIds.indexOf(i);return-1===s?(this._logError("itemId "+i+" is invalid."),!1):!0},onSelectItem:function(e){void 0===this.execute&&this.extensionService.logError("execute() is not defined"),this.execute(e)},getSelectedContext:function(e){return!this.aSelectedContext&&e&&e.target&&e.target.activeObject&&(this.aSelectedContext=e.target.activeObject.aSelectedContext),this.aSelectedContext},getListControl:function(e){return!this.oListControl&&e&&e.target&&e.target.activeObject&&(this.oListControl=e.target.activeObject.oListControl),this.oListControl},_logError:function(e){this.extensionService.logError(e)},_doUpload:function(e,t){e&&e.doUpload().then(function(){this.getListControl(t).contentView.refresh()}.bind(this))},_doDelete:function(i){var n=this.getListControl(i),o=new s("confirmDelete",a.get(i.confirmMessageTitleKey?i.confirmMessageTitleKey:"confirmDelete"),a.get(i.confirmMessageKey?i.confirmMessageKey:"confirmDeleteMessage"));o.ok=function(){n&&o.setLaunchPoint(n.getFirstFocusElement()),s.inherited("ok",this,arguments),e.isFunction(this._confirmCallback)&&this._confirmCallback()},o.cancel=function(){n&&o.setLaunchPoint(t(n.getSelectedRows()[0]).find(".ellipsesButton_cell")[0]),s.inherited("cancel",this,arguments),e.isFunction(this._cancelCallback)&&this._cancelCallback()},o.confirm(function(){var e=this.getSelectedContext(i)[0].defaultName,t=this.getSelectedContext(i)[0].tenantID;this.extensionService["delete"](i.type,e,t).then(this._onDeleteSuccess.bind(this,i)).fail(this._onDeleteFail.bind(this,i))}.bind(this)),o.renderContent(t("<div>")),o._container().addClass("contentDeleteConfirmDialog")},_onDeleteFail:function(e,t,i){var n=this.getSelectedContext(e)[0].defaultName;this._logError(i.responseText),e.glassContext.appController.showToast(a.get(e.failedDeleteMsgId,{name:o.enforceTextDirection(n)}),{type:"warning"})},_onDeleteSuccess:function(e){var i=this.getSelectedContext(e)[0].defaultName;this.getListControl(e).contentView.refresh(),t(".ThemesTabPageView").trigger("com.ibm.bi.admin.updatelist.themes","refresh"),e.glassContext.appController.showToast(a.get(e.deleteMsgId,{name:o.enforceTextDirection(i)}))},_getNewUploader:function(e){return new r(e)},_getNewDownloader:function(e){return new l(e)},_doUpdate:function(e){var t={isUpload:!1,type:e.type,name:this.aSelectedContext[0].defaultName,tenantID:this.aSelectedContext[0].tenantID},i=this._getNewUploader({$el:this.listControl.$el,glassContext:e.glassContext,ajax:this.extensionService.updateOrUpload.bind(this.extensionService),ajaxOptions:t});this._doUpload(i,e)},_doDownload:function(e){var t=this._getDownloader(e);t.doDownload()},_getDownloader:function(e){var t=e.type,i=this.getSelectedContext(e),n=i[0].defaultName,s=this.getSelectedContext(e)[0].tenantID,a=this.extensionService.getUrl(t,n,s,"download ")+"/zip",o=this._getNewDownloader({url:a,name:n,logger:e.glassContext.appController.logger});return o}});return d}),define("bi/admin/common/actions/AddInputRow",["lodash","q","bi/admin/common/actions/ListAction","bi/commons/utils/BidiUtil","bi/admin/nls/StringResource","bacontentnav/utils/UIHelper","bi/admin/common/utils/AJAXUtils","ba-react-admin/ba-react-admin.min"],function(e,t,i,n,s,a,o,r){"use strict";var l=i.extend({init:function(t){l.inherited("init",this,t),e.assign(this,t)},execute:function(e,t){var i=this.getListControl(),n=this._getInputRowProperties(e);i.insertToTable({defaultName:n.defaultName,type:n.type,uid:n.uid}),this._createInput(n.className,n.defaultName,n.ajaxRequestType,t)},_getInputRowProperties:function(t){var i;switch(t){case"namespaceFolder":i={defaultName:s.get("addNewFolder"),type:"folder",uid:e.uniqueId("new_folder_"),className:"newFolderRow",ajaxRequestType:"namespaceFolder"};break;case"group":i={defaultName:s.get("addNewGroup"),type:"group",uid:e.uniqueId("new_group_"),className:"newGroupRow",ajaxRequestType:"group"};break;case"nonBrowsableGroup":i={defaultName:s.get("addNewGroup"),type:"nonBrowsableGroup",uid:e.uniqueId("new_group_"),
className:"newGroupRow",ajaxRequestType:"nonBrowsableGroup"};break;case"role":i={defaultName:s.get("addNewRole"),type:"role",uid:e.uniqueId("new_role_"),className:"newRoleRow",ajaxRequestType:"role"}}return i},_createInput:function(e,t,i,s){var a=this.getListControl();$(".dataTables_scrollBody").scrollTop(0);var o=a.$el.find(".dataTables_scrollBody").find("tbody").find("tr"),r=$(o[o.length-1]).clone(),l=$(r.find(".nameColumnDiv")[0]);l.addClass(e);var d=l.parents("td");d.empty(),r.insertAfter(o[0]),$(o[o.length-1]).remove();var c=$(document.createElement("input"));c.attr("type","text"),c.attr("id","inputBox"),c.attr("value",t),d.append(c),n.initElementForBidi(c[0]),c[0].select(),c[0].focus(),a.removeEmptyTableMessage(),this._addInputHandlers(c,i,s)},_handleBlur:function(e,i,n){var r=t.defer(),l=this.getListControl();l.$el.find(".dataTables_scrollBody").off("scroll",null,this._onScroll);var d={script:!0},c=function(){$(e.currentTarget).select(),$(e.currentTarget).focus()},h=this._getInputText(l,i),u=a.validateInput(h.defaultName,d,c);if(u){var m;switch(this._handledSave=!0,i){case"group":m=o.getPath("createGroup",n);break;case"nonBrowsableGroup":m=o.getPath("createGroup",n);break;case"role":m=o.getPath("createRole",n);break;case"namespaceFolder":m=o.getPath("createNamespaceFolder",n);break;default:m=""}var p={dataType:"json",type:"POST",contentType:"application/json; charset=utf-8",data:JSON.stringify(h),url:m,cache:!1};switch(i){case"groups":this.glassContext.appController.showToast(s.get("groupToastCreateMsg",{name:h.defaultName}));break;case"roles":this.glassContext.appController.showToast(s.get("roleToastCreateMsg",{name:h.defaultName}));break;case"folders":this.glassContext.appController.showToast(s.get("folderToastCreateMsg",{name:h.defaultName}))}return this.glassContext.services.ajax.ajax(p)}return r.promise},_addInputHandlers:function(e,t,i){var n=this;e.on("keydown",function(e){return 13===e.keyCode?($(e.currentTarget).blur(),e.stopPropagation(),!1):void 0}),e.on("blur",function(e){this._handleBlur(e,t,i).then(function(){n._reloadListView()},function(e,t){if(t.responseText){var i=JSON.parse(t.responseText);n.glassContext.appController.showMessage(i.messages)}n._reloadListView()})}.bind(this))},_reloadListView:function(){if(this.accountExplorer.pagingEnabled){var e=this.getListControl();r.PaginationHelper.reloadListViewinPagingContext(this.glassContext,this.accountExplorer,e,this.listAdaptor,!0)}else this._reloadListViewWithouPaging()},_reloadListViewWithouPaging:function(){var e=this.getListControl();e.dataAdaptor.sortChanged=!0,e.reload(!1).done(function(){e.activeInputForm=null})},_generateOriginalName:function(e,t){for(var i=e,n=1;this._duplicatesExist(i,t)===!0;)i=e+" ("+n+")",n++;return i},_duplicatesExist:function(t){var i=e.filter(this.data,function(e){return t.toUpperCase()===e.defaultName.toUpperCase()});return 0!==i.length?!0:!1},_getInputText:function(e,t){var i=e.$el.find("#inputBox").val(),n=this._generateOriginalName(i,t);return"nonBrowsableGroup"===t?{defaultName:n}:{defaultName:n,defaultDescription:""}}});return l}),define("text!bi/admin/common/ui/listview/templates/ListViewTemplate.html",[],function(){return'<div class="ca-listContainer">\n	<table class="listControl bi-admin-table-list" aria-label="{{=it.accessibleLabel}}">\n		<caption style="display: none">{{=it.tableCaption}}</caption>\n		<thead>\n			<tr>\n				{{~it.columns :column:index}}\n					<th role="columnheader" scope="col" {{?column.propertyName}}data="{{=column.propertyName}}"{{?}} class=\'columnHeader\' colindex="{{=index}}" {{? column.sortable }}tabindex="0"{{?}}>\n						<div class="{{? !column.name || column.name!=\'checkBoxes\' }}columnText{{?}}{{?column.headerClass}} {{=column.headerClass}}{{?}} bi-admin-headertext text-ellipsis {{? it.sortable && (!column.name || column.name!=\'checkBoxes\') }}sortable{{?}}">\n                            {{? column.label }}{{=column.label}}{{??}}&nbsp;{{?}}\n						</div>\n						{{? !column.name || column.name!=\'checkBoxes\' }}\n            <div class="sort_underline"></div>\n						<div class="columnSpacer"></div>\n						{{?}}\n					</th>\n				{{~}}\n			</tr>\n		</thead>\n		<tbody>\n		</tbody>\n	</table>\n</div>\n'}),define("text!bi/admin/common/ui/listview/templates/EmptyListViewTemplate.html",[],function(){return'<div class="emptyTableContent{{?it.shortTable == true}} shortTable{{?}}">\n	<div class="emptyTableImage wft_bee"></div>\n	<div class="emptyTableText">{{=it.text}}</div>\n</div>   \n'}),define("bi/admin/common/ui/listview/ListView",["doT","q","jquery","lodash","bi/glass/app/ContentView","bi/commons/utils/BidiUtil","bacontentnav/utils/WidgetNavigator","bi/admin/nls/StringResource","bi/admin/common/actions/AddInputRow","text!bi/admin/common/ui/listview/templates/ListViewTemplate.html","text!bi/admin/common/ui/listview/templates/EmptyListViewTemplate.html","datatables","bi/commons/utils/Utils","bi/glass/utils/ClassFactory"],function(e,t,i,n,s,a,o,r,l,d,c,h,u,m){"use strict";var p=s.extend({aSelectedRows:[],multiSelect:!0,touchMultiSelectEnabled:!1,init:function(e){p.inherited("init",this,arguments),void 0!==e?(this.accessibleLabel=e.accessibleLabel||"",this.formatContent=e.formatContent||!0):(this.accessibleLabel="",this.formatContent=!0),i.extend(this,e),this.aSelectedRows=[]},createColumnObject:function(e,t){return new t(i.extend(e,{listControl:this,glassContext:this.glassContext}))},isMultitouchActive:function(){return this.multiSelect},_createColumns:function(){return Promise.all(n.map(this.dataAdaptor.getColumnSpecs(),function(e,t){if(e.type||e.module){var i=e.module||"bi/content_apps/common/ui/list_columns/"+e.type;return m.instantiate(i,n.assign({},e,{listControl:this,glassContext:this.glassContext})).then(function(i){return delete i.type,i.getSpec().then(function(s){return n.assign(i,s),i.aTargets=[t],i.bSortable=!!e.sortable,e.width&&(i.sWidth=e.width),i})}.bind(this))}return null}.bind(this)))},setFocus:function(){var e=this.$el.find("td[tabindex='0']");return 0===e.length?!1:(e.focus(),!0)},clearShowWorking:function(){this.$el.find("tbody tr[role='row']").remove(),this.showWorking()},showWorking:function(){var e=u.getLoadingAnimation(1),t=i('<div class="emptyTableContent bi-admin-working"></div>');t.append(e),this.$el.append(t)},hideWorking:function(){var e=this.$el.find(".bi-admin-working");i(e).remove()},render:function(){return this.showWorking(),Promise.all([this._createColumns(),this.dataAdaptor.getRows()]).then(function(t){this.$el.empty();var i=t[0],s=t[1].rows;if(this.dataAdaptor.checkboxSelection&&this.contentView.getSearchTerm){var a=this.contentView.getSearchTerm().toLowerCase();s=n.filter(s,function(e){return-1!==(e.defaultName||"").toLowerCase().indexOf(a)})}var l;return this.hideWorking(),s.length>0?(l=e.template(d)({sortable:this.dataAdaptor.supportSorting,accessibleLabel:this.accessibleLabel,tableCaption:r.get("listViewTableCaption"),columns:i}),this.$el.append(l),this._renderTable(i,s).then(function(){this.widgetKeyController=new o({$el:this.$el.find(".listControl"),focusClass:"contentListFocusable",fCallBack:function(){}})}.bind(this))):(l='<div class="bi-admin-empty-activities-list-bee wft_bee"></div><div class="bi-admin-empty-activities-list-text">'+r.get("noEntries")+"</div>",void this.$el.append(l))}.bind(this))},resize:function(){var e=this._calcYBound(),t=this.$el.find(".dataTables_scrollBody");t&&t.height(e)},reload:function(e){var i=t.defer();if(this.showWorking(),this._dTable){if(this._reloading)return;this.waitForReload=!0,this._reloading=!0,e||(this._dTable.clear(),this._dTable.draw()),this.dataAdaptor.getRows().done(function(t){var n=t.rows;if(e||0!==n.length)this.$el.find(".emptyTableContent").remove(),this._dTable.rows.add(t.rows).draw(!1),this._setTextDirection(),this._clearRows(!0),this.resize();else{var s='<div class="emptyTableContent"><div class="bi-admin-empty-activities-list-bee wft_bee"></div><div class="bi-admin-empty-activities-list-text">'+r.get("noEntries")+"</div></div>";this.$el.append(s)}this._reloading=!1,this.hideWorking(),setTimeout(function(){delete this.waitForReload}.bind(this),1e3),i.resolve()}.bind(this))}else this.render().done(function(){this.hideWorking(),i.resolve()}.bind(this));return i.promise},_sortListener:function(){},filter:function(e,t){this.dataAdaptor.checkboxSelection&&this._clearRows(!0),this.removeEmptyTableMessage();var i=this.dataAdaptor.getFilteredRows();if(this._dTable&&i){t=t||"defaultName",e=e.toLowerCase();var s=n.filter(i,function(i){return-1!==(i[t]||"").toLowerCase().indexOf(e)});this._dTable.rows().remove(),this._dTable.rows.add(s).draw(!1),s.length<1?this._noResults():this._setTextDirection()}},_renderTable:function(e,n){var s=t.defer(),a=this.$el.width(),o={data:n,sScrollY:this._calcYBound(),sScrollX:a,sDom:"rtS",bServerSide:!1,bFilter:!1,bInfo:!1,bAutoWidth:!1,bPaginate:!1,bDeferRender:!0,orderClasses:!1,bSort:this.dataAdaptor.isServerSorting(),asStripeClasses:[""],aoColumnDefs:e,fnInitComplete:function(e){this.isInitialized=!0;var t=i(e.nScrollHead).find("table");this._scrollNode=this.$el.find(".dataTables_scrollBody");var n=t.attr("aria-label");t.removeAttr("aria-label"),t.attr("aria-labelledby","adminTab_tableHeaderLab1 adminTab_tableHeaderLab2 ");var a=i('<div style="position: absolute; left: -999px" aria-hidden="true" id="adminTab_tableHeaderLab1">'+n+"</div>"),o=i('<div style="position: absolute; left: -999px" aria-hidden="true" id="adminTab_tableHeaderLab2">'+r.get("listControlColumns")+"</div>");t.parent().append(a),t.parent().append(o),this._scrollNode.bind("scroll",this._onScroll.bind(this)),s.resolve()}.bind(this),fnDrawCallback:function(e){this._drawCallback(e)}.bind(this)},l=this.dataAdaptor.sortOrder;o.bSort&&l&&(o.aaSorting=l);var d=this.$el.find("table.listControl.bi-admin-table-list"),c=this._cachedSelectedRows();this._dTable=d.DataTable(o),d.attr("role","application"),this._reApplySelections(c),this._dTable.on("click","tr",this.handleClick.bind(this)),this._dTable.on("keydown","tr",this._handlekeydown.bind(this)),this._dTable.on("hold",this.handleHoldEvent.bind(this));var h=this;if(this.dataAdaptor.checkboxSelection&&this._renderSelectAllCheckBox(),this.dataAdaptor.supportSorting&&!o.bSort){var u=this.$el.find("thead th");u.each(function(){var t=i(this),n=1*t.attr("colindex"),s=e[n];s&&s.sortable&&(t.removeClass("sorting_disabled"),l&&n===l[0]&&t.addClass("sorting_"+l[1]),t.on("primaryaction",function(){var e=t.hasClass("sorting_asc"),i=e?"desc":"asc";u.removeClass("sorting_asc sorting_desc"),t.addClass("sorting_"+i),h.dataAdaptor.setOrder(n,i),h.reload()}))})}return this.$el.find("div.dataTables_scrollBody").on("scroll",function(){i(this).scrollTop()+i(this).innerHeight()>=this.scrollHeight&&h.dataAdaptor.hasMore()&&h.reload(!0)}),this._setTextDirection(),s.promise},_isClickableCol:function(e){var t=e.relatedTarget||e.toElement||e.target;return i(t).hasClass("nameColumnDiv")},_handlekeydown:function(e){(13===e.which||32===e.which)&&this.handleClick(e)},handleClick:function(e){var t=this._findRowNode(e.currentTarget);if(i(e.currentTarget).hasClass("ellipsesButton")){if(0===this.aSelectedRows.length)this._selectRow(t);else if(1===this.aSelectedRows.length){var s=!1;n.forEach(this.aSelectedRows,function(e){i(e)[0].rowIndex===t.rowIndex&&(s=!0)}),s||(this._clearRows(!0),this._selectRow(t))}return this._isClickableCol(e)?this._handleSingleSelect(t,e):this._handleContextMenu(e),!1}if("click"!==e.type||!this.multiSelectEvent||"hold"!==this.multiSelectEvent.type){if(3===e.which&&(e.shiftKey||e.ctrlKey||e.metaKey||i(t).hasClass("selected")))return!1;if(e.shiftKey&&this.multiSelect){var a=n.last(this.aSelectedRows),o=0;a&&(o=a.rowIndex),this._clearRows(!0);var r,l=Math.max(o,t.rowIndex),d=Math.min(o,t.rowIndex),c=this._dTable.$("tr",{filter:"applied"});for(r=d;l>=r;r+=1)this._handleMultiSelect(i(c[r-1]),e.target)}else if((e.ctrlKey||e.metaKey)&&this.multiSelect||"tap"===e.type&&this.touchMultiSelectEnabled||this.dataAdaptor.checkboxSelection&&e.currentTarget.classList.contains("admin-checkbox"))this._handleMultiSelect(t,e.target);else if(this._handleSingleSelect(t,e)===!1)return!1}},_setTextDirection:function(){var e=this.$el.find("div.nameColumnDiv");e.each(function(){i(this).attr("dir",a.resolveBaseTextDir(this.innerHTML))})},_noResults:function(){var e='<div class="emptyTableContent"><div class="bi-admin-empty-activities-list-bee wft_bee"></div><div class="bi-admin-empty-activities-list-text">'+r.get("noEntries")+"</div></div>";this.$el.append(e)},_handleMultiSelect:function(e,t,n){if((!i(e).hasClass("selected")||!i(t).hasClass("forceRowSelection"))&&(i(e).toggleClass("selected"),this.dataAdaptor.checkboxSelection&&!n)){var s=i(e).find(".admin-checkbox");s.prop("checked",!s.prop("checked"))}var a=this.aSelectedRows.indexOf(e);a>-1?i(t).hasClass("forceRowSelection")||this._updateSelectedRows("-",a):this._updateSelectedRows("+",e)},_handleSingleSelect:function(e,t){1===this.aSelectedRows.length&&e.rowIndex===this.aSelectedRows[0].rowIndex&&(this.deselectCallback&&this.deselectCallback(),i(e).removeClass("selected"),this._checkRow(e,!0),this._updateSelectedRows("c")),this._selectSingleRow(e,t)},getActionPayload:function(){var e=t.defer();return e.reject(),e.promise},_selectSingleRow:function(e,t){this._clearRows(!0),this._selectRow(e),this.$el.trigger("com.ibm.admin.listItemHighlighted",this.getSelectedObjects()[0]),this.singleSelectCallback&&this._isClickableCol(t)&&this.singleSelectCallback(this.getSelectedObjects()[0])},_handleContextMenu:function(e){var t={};void 0===e.pageX||void 0===e.gesture||void 0===e.gesture.center||void 0===e.gesture.center.pageX?t=i(e.target).offset():(t.left=e.pageX||e.gesture.center.pageX,t.top=e.pageY||e.gesture.center.pageY);var n={position:{pageX:t.left,pageY:t.top},selectedObject:this.getSelectedObjects()};this.contextMenuCallback&&this.contextMenuCallback(n)},handleHoldEvent:function(e){this._clearRows(!0),this.touchMultiSelectEnabled=!0;var t=this._findRowNode(e.target.parentNode);i(t).addClass("selected"),this._updateSelectedRows("+",t),this.multiSelectEvent=e},_findRowNode:function(e){for(;"tr"!==e.nodeName.toLowerCase();)e=e.parentNode;return e},_clearRows:function(e){if(e){if(this.dataAdaptor.checkboxSelection){var t=this.$el.find("thead th .admin-header-checkbox input");t.prop("checked",!1)}n.forEach(this.aSelectedRows,function(e){i(e).removeClass("selected"),this._checkRow(e,!1)}.bind(this)),this._updateSelectedRows("c"),this.touchMultiSelectEnabled=!1}},getSelectedObjects:function(){var e,t=[];for(e=0;e<this.aSelectedRows.length;e+=1){var i=this._dTable.row(this.aSelectedRows[e]).data();t.push(i)}return t},_selectRow:function(e){if(i(e).addClass("selected"),this._updateSelectedRows("+",e),this.dataAdaptor.checkboxSelection){var t=i(e).find(".admin-checkbox");t.prop("checked",!0)}},_formatContentHelper:function(e,t,n){if(n.anCells)for(var s=0;s<n.anCells.length;s+=1){var a=i(n.anCells[s]),o=e.aoColumns[s].scope;"row"===o?a.attr("role","rowheader"):a.attr("role","gridcell"),a.attr("tabindex","-1")}this._processColumnWeights(e),this.formatContent&&n.anCells&&n.anCells[t]&&e.aoColumns[t].formatContent(n.anCells[t])},_drawCallback:function(e){for(var t=0;t<e.aoColumns.length;t++)e.aoColumns[t].formatContent&&e.aoData.forEach(this._formatContentHelper.bind(this,e,t));this.widgetKeyController&&this.widgetKeyController.setInitialTabIndex()},_processColumnWeights:function(e){var t=0,i=0;e.aoColumns.forEach(function(e){e.weight?t+=e.weight:e.sWidth&&"%"===e.sWidth.slice(-1)&&(i+=parseInt(e.sWidth.slice(0,-1),10))}),e.aoColumns.forEach(function(e){e.weight&&(e.sWidth=Math.floor(e.weight/t*(100-i))+"%")})},_calcYBound:function(){var e=this.$el.find("th").height();return this.$el.height()-e<e?"70%":this.$el.height()-e},addInput:function(e,t,i,n){null===this.activeInputForm&&(this.activeInputForm=new l({oListControl:this,glassContext:this.glassContext,data:this._dTable.rows().data(),accountExplorer:i,listAdaptor:n}),this.activeInputForm.execute(e,t))},insertToTable:function(e){this._dTable.rows.add([e]).draw(!0)},removeEmptyTableMessage:function(){this.$el.find(".emptyTableContent").remove()},adjustScrollForPageDown:function(){var e=i(this.$el.find(".dataTables_scrollBody"));e.scrollTop(e.scrollTop()+50)},_clearTable:function(){this._dTable.clear().draw()},setPaging:function(e){this.pagingOn=e},_onScroll:function(e){if(!this.scrollIgnore&&!this.waitForReload){var t=i(e.target);t.scrollTop()+t.innerHeight()>=t[0].scrollHeight-20?(i(this).trigger("nextPage",e),this.scrollIgnore=!0,setTimeout(function(){delete this.scrollIgnore}.bind(this),500)):0===t.scrollTop()&&(i(this).trigger("previousPage",e),this.scrollIgnore=!0,setTimeout(function(){delete this.scrollIgnore}.bind(this),500))}},_isShortTable:function(){var e=this.$el.find(".ca-listContainer");return e.height()<200},_updateSelectedRows:function(e,t){switch(e){case"-":var i=this.aSelectedRows.indexOf(t);-1!==i&&this.aSelectedRows.splice(i,1);break;case"+":this.aSelectedRows.push(t);break;case"c":this.aSelectedRows=[];break;case"=":this.aSelectedRows=t}this.onSelectionChange&&this.onSelectionChange()},_cachedSelectedRows:function(){var e=[];if(this._dTable&&this.aSelectedRows.length>0)for(var t=this._dTable.$("tr.selected"),n=0;n<t.length;++n)e.push(i(t[n]).index());return e},_reApplySelections:function(e){this.aSelectedRows=[];for(var t=0;t<e.length;++t){var i=this._dTable.$("tr")[e[t]];i.classList.add("selected"),this._checkRow(i,!0),this._updateSelectedRows("+",i)}},_renderSelectAllCheckBox:function(){var e=this.$el.find("thead th .admin-header-checkbox:not(:has(input))");e.html('<input role="checkbox" tabindex="-1" type="checkbox" class="admin-clickable admin-checkbox"></input>'),e.find("input").click(this._toggleSelectAll.bind(this))},_toggleSelectAll:function(e){if(e.currentTarget.checked)for(var t=this._dTable.$("tr:not(.selected)"),i=0;i<t.length;++i)this._selectRow(t[i]);else this._clearRows(!0)},_deselectRow:function(e){this.deselectCallback&&this.deselectCallback(),i(e).removeClass("selected"),this._checkRow(e,!1),this._updateSelectedRows("-",e)},_checkRow:function(e,t){if(this.dataAdaptor.checkboxSelection){var n=i(e).find(".admin-checkbox");n.prop("checked",t)}}});return p}),define("text!bi/admin/datasource/templates/DataSourceListTemplate.html",[],function(){return'<div class="bi-admin-filterbar folderpane-filterbar bi-admin-datasource-filter">\n    <div class="bi-admin-filterbar-leading">\n        <input type="search">\n    </div>\n    <div class="bi-admin-datasource-list-addBtn">\n        <span id="button_add" class="datasource-addBtn" title="{{=it.strings.addDatasource}}" tabindex="0" role="link">\n  			<svg class="svgIcon bi-admin-add-datasource-svgIcon">\n          		<use xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="#common-add"></use>\n        	</svg>\n  		</span>\n    </div>\n</div>\n\n<div class="bi-admin-datasource-list bi-admin-flexcontent">\n</div>'}),define("bi/admin/common/dialog/SimpleDialog",["bi/commons/ui/dialogs/GenericViewDialog","bi/admin/nls/StringResource"],function(e,t){var i=e.extend({init:function(e){this.options=e;var t={buttons:["ok"],viewClass:e.viewObject,id:"SimpleDialog",title:e.title,viewOptions:{displayMsgList:this.options.displayMsgList,onOpen:this.onOpen.bind(this),glassContext:this.options.glassContext}};i.inherited("init",this,[t])},onOpen:function(){var e=this._container();e.addClass("openDialog"),e.find(".dialogHeader"),e.find(".modalDialog").addClass("contentListDialog"),e.find("footer").attr("role","contentinfo").attr("aria-label",t.get("ok"))},ok:function(){this.hide()},setFocus:function(){this._container().find(".dialogButton.primary")[0].focus()}});return i}),define("bi/admin/datasource/ActionHandler",["lodash","bi/commons/ui/core/Class","bi/admin/datasource/App","bi/admin/nls/StringResource","bi/admin/common/dialog/SimpleDialog"],function(e,t,i,n,s){"use strict";var a=t.extend({init:function(e){a.inherited("init",this,arguments),this._initSchemaStatusMap()},_initSchemaStatusMap:function(){this._schemaStatusMap=[],this._schemaStatusMap.push({context:"schema_load",status:["loaded","not_loaded","error"]}),this._schemaStatusMap.push({context:"schema_clear",status:["loaded","loading","pending","error"]}),this._schemaStatusMap.push({context:"schema_cancel",status:["executing","pending","loading"]}),this._schemaStatusMap.push({context:"schema_options",status:["loaded","not_loaded","error"]}),this._schemaStatusMap.push({context:"schema_history",status:["loaded","error","executing","pending","loading"]})},_determineVisibilitySchemaStatus:function(t,i,n){var s=!1,a=e.find(this._schemaStatusMap,function(e){return e.context===t});return i.forEach(function(t){e.includes(a.status,n._isLoadingStatusCheck(t.id,t.status))&&(s=!0)}.bind(this)),s},isContextMenuItemVisible:function(e,t,i){var n=!0;return"datasource_delete"!==e||t.writable||(n=!1),e.indexOf("schema_")>-1&&(n=this._determineVisibilitySchemaStatus(e,t,i)),"schema_history"===e&&t.length>1&&(n=!1),"cubes_createModule"===e&&t.length>1&&(n=!1),"connection_delete"!==e||t.writable||(n=!1),n},onContextMenu:function(e,t,i){var n;switch(e){case"schema_load":n=i.loadSchemaAction(t);break;case"schema_options":n=i.ShowSchemaLoadOptions(t,"loadOptions");break;case"schema_clear":n=i.confirmClearSchemaAction(t);break;case"schema_cancel":n=i.cancelSchemaAction(t);break;case"cubes_createModule":n=i.createModule(t);break;case"datasource_delete":n=i.doDelete(t);break;case"property":n=i.doSetProperties(t);break;case"connection_delete":i.deleteConnection(t);break;case"connection_property":i.showDataConnectionProperty(t);break;default:this.logger.error("Unexpected context menu id: "+e),n=Promise.resolve()}return n}});return a}),define("bi/admin/datasource/ui/DataSourceListView",["lodash","doT","bi/admin/common/ui/MagicWand","bi/commons/ui/AccessibleView","bi/admin/nls/StringResource","bi/admin/datasource/services/DatasourceListAdapter","bi/admin/common/ui/listview/ListView","text!bi/admin/datasource/templates/DataSourceListTemplate.html","bi/commons/utils/BidiUtil","bi/admin/datasource/ActionHandler"],function(e,t,i,n,s,a,o,r,l,d){"use strict";var c=n.extend({filterTips:s.get("filterTips"),contextMenuTips:s.get("moreInContext"),addButtonTip:s.get("addButtonTip"),init:function(t){c.inherited("init",this,arguments),e.assign(this,t),this.listAdaptor=this._getNewDatasourceListAdapter({glassContext:this.glassContext,objectInfo:{},removeSelf:!1,showContextMenu:!0})},_getNewDatasourceListAdapter:function(e){return new a(e)},_getTemplateOptions:function(e){var t=c.inherited("_getTemplateOptions",this,arguments);return t&&(t.nullOwnerLabel=s.get("unknown")),t},_getNewActionHandler:function(){return new d},_getNewListView:function(e){return new o(e)},_renderListView:function(){var e=this.$el.find(".bi-admin-datasource-list");return e.empty(),this.listView=this._getNewListView({el:e,dataAdaptor:this.listAdaptor,glassContext:this.glassContext,accessibleLabel:this.title,activeInputForm:null,multiSelect:!1}),this.listView.singleSelectCallback=this._rowClickHandler.bind(this),this.listView.contextMenuCallback=function(e){var t=this._getNewActionHandler(),i={position:e.position,menuId:"com.ibm.bi.admin.datasourceMenu",activeObject:{handler:t,data:e.selectedObject[0],parentView:this.parentView}};this.glassContext.appController.showContextMenu(i)}.bind(this),this.listView.render()},render:function(){return this._renderTemplate(),this._renderSearch().then(this._renderListView.bind(this)).then(this._bindEvents.bind(this))},_renderTemplate:function(){var e={strings:{addDatasource:s.get("addDatasource")}},i=t.template(r)(e);this.$el.html(i),l.initElementForBidi(this.$el.find(".bi-admin-input.bi-admin-input-search")[0])},_renderSearch:function(){return i.searchInput(this.$el).then(function(e){1===e.length&&(this._searchInput=e[0],this._searchInput.options.hint=s.get("filterTips"),this._searchInput.on("changed",function(e){var t=e.text.trim();(t.length>0||""===e.text)&&(this.listView.setPaging(!1),this.listView.filter(t,"defaultName"))}.bind(this)))}.bind(this))},_bindEvents:function(){this.showAddButton&&this.$el.find("#button_add").on("primaryaction",function(e){e.stopPropagation(),this.trigger("addItem")}.bind(this))},_rowClickHandler:function(e){this.listAdaptor.rowClickHandler&&this.listAdaptor.rowClickHandler(this,e)}});return c}),define("bi/admin/datasource/slideout/DataSourceListPane",["lodash","bi/admin/common/slideout/BasePane","bi/admin/datasource/App","bi/admin/datasource/ui/DataSourceListView","bi/admin/common/utils/CapabilityHelper","bi/admin/nls/StringResource","bi/admin/datasource/services/DataSourceListController","bi/commons/ui/dialogs/ConfirmationDialog"],function(e,t,i,n,s,a,o,r){var l=t.extend({init:function(e){return l.inherited("init",this,arguments),$.extend(this,e),this.dsController=this._getNewDataSourceListController({glassContext:this.glassContext}),this._bindEvents(),i.getCurrentNameSpace().then(function(e){this.glassContext._currentNameSpace=e}.bind(this))},_bindEvents:function(){$(this.slideout.$el).on("com.ibm.cognos.bi.admin.refreshDataServerList",function(e){this.refresh()}.bind(this))},_getNewDataSourceListController:function(e){return new o(e)},_getNewDataSourceListView:function(e){return new n(e)},renderListView:function(e,t){var i=t&&t.indexOf("traverse")>-1?!0:!1;if(i){var n=t&&t.indexOf("write")>-1?!0:!1,o=s.checkCapabilities("canUseWebBasedModeling")?!0:!1;return this.listView=this._getNewDataSourceListView({el:e,showAddButton:n||o,glassContext:this.glassContext,showListHeader:!0,slideout:this.slideout,parentView:this}),this._bindListViewEvents(),this.listView.render()}return this.$body.html('<div class="bi-admin-access-denied-container">'+a.get("accessDenied")+"</div>"),Promise.resolve()},_bindListViewEvents:function(){$(this.listView).on("com.ibm.ds.selected",function(e,t){this.doSetProperties(t)}.bind(this)),this.listView.on("addItem",function(){this.slideout.child&&this.slideout.child.hide();var e=this.glassContext.appController.showSlideOut({parent:this.slideout,content:{module:"bi/admin/datasource/slideout/VendorListPane",id:"VendorListPane"}});$(e).on("datasourceUpdate",function(e,t){this.reOpenSlideout()}.bind(this))}.bind(this))},reOpenSlideout:function(){this.glassContext.appController.showSlideOut({parent:this.slideout.parent,overlay:!0,width:"400px",label:this.title,content:{module:"bi/admin/datasource/slideout/DataSourceListPane",id:"DataSourcePane",title:this.title,showGobackButton:!0}})},renderBody:function(t){var i="v1/namespaces";return Promise["try"](function(){return this.glassContext.services.ajax.ajax({dataType:"json",type:"GET",url:i}).then(function(i){var n=e.find(i.data,function(e){return":"===e.searchPath.split('"')[1]}).permissions;return this.renderListView(t,n)}.bind(this))}.bind(this))},_getNewConfirmationDialog:function(e,t,i){return new r(e,t,i)},doDelete:function(e){var t=this._getNewConfirmationDialog("confirmDelete",a.get("confirmDelete"),a.get("confirmDeleteMessage"));t.confirm(function(){return this.slideout.child&&this.slideout.child.hide(),this.dsController.deleteDataSource(e.id).then(function(){var t=a.get("deleteDataSourceMsg",{name:e.defaultName});return this.glassContext.appController.showToast(t,{type:"success"}),this.listView.render()}.bind(this),function(e){this._glassContext.appController.showErrorMessage(e.responseJSON.messages.join("\n"),a.get("error"))}.bind(this))}.bind(this)),t.renderContent($("<div>"))},doSetProperties:function(e){var t=this.glassContext.appController.showSlideOut({parent:this.slideout,width:"400px",onHide:function(){return t&&t.contentView&&t.contentView.onHide?t.contentView.onHide().then(function(){t.hide()}.bind(this)):Promise.resolve()}.bind(this),content:{module:"bi/admin/common/PropertiesPageView",parentView:this,listPane:this,objectInfo:e,type:e.type,glassContext:this._glassContext}})},refresh:function(){this.$body.empty(),this.render()}});return l}),define("js/admin/dataServerConnectionsBundle",function(){});