/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Content Apps
 * (C) Copyright IBM Corp. 2016, 2018
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

define("bi/content_apps/CapabilitiesView",["jquery","lodash","bi/glass/app/ContentView","bi/content_apps/nls/StringResource","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","bacontentnav/utils/GlassContextHelper"],function(e,s,t,o,n,i){"use strict";var a=t.extend({init:function(e){a.inherited("init",this,arguments),s.extend(this,e)},render:function(){return this._containerElement=e("<div>",{class:"propertyUIControl capabilitiesView"}),this.$el.append(this._containerElement),this._getCapabilityInformation().then(function(e){var t=[],n=[];this._translateUserCapabilityNames(e,t,n);var i=this._createHierarchicalList(t,n);return this._oPropertyUIControl=this._getPropertyUIControl({el:this.$el,glassContext:this.glassContext,items:[{type:"Banner",name:"detailsBanner",value:o.get("preferencesMyCapabilities"),centerLabel:!0,hintText:o.get("preferencesCapabilitiesHintText"),backButton:!0,editable:!1,readOnly:!0,onClose:function(){this.slideout.hide()}.bind(this)},{type:"HierarchicalList",name:"capabilities",data:s.sortBy(i,"defaultName")}]}),this._oPropertyUIControl.render()}.bind(this),function(){return this.slideout.hide(),Promise.reject()}.bind(this))},_getPropertyUIControl:function(e){return new n(e)},_getCapabilityInformation:function(){return this.glassContext.services.ajax.ajax({dataType:"json",type:"GET",url:"v1/capabilities"}).then(function(e){return e.data?e.data:Promise.reject()}.bind(this),this._handleError.bind(this))},_createHierarchicalList:function(e,t){for(var n=[],i=0;i<e.length;i+=1){for(var o=[],a=0;a<t.length;a+=1)t[a].parent[0].userCapability===e[i].userCapability&&o.push({defaultName:t[a].defaultName});n.push({defaultName:e[i].defaultName,children:s.sortBy(o,"defaultName")})}return n},_translateUserCapabilityNames:function(e,t,n){for(var i=this.glassContext.getCoreSvc(".UserProfile").capabilities,o=0;o<e.length;o+=1){-1!==s.indexOf(i,e[o].userCapability)&&(this._isParentCapability(e[o])?t.push(e[o]):n.push(e[o]))}},_isParentCapability:function(e){if(!e||!e.parent)return!1;var t=e.parent[0];return!t||!t.userCapability},_handleError:function(e,t){return i.showAjaxServiceErrorMessage(this.glassContext,t),Promise.reject()}});return a}),define("bi/content_apps/AccountPickerSlideoutView",["bacontentnav/common/ContentListPageView","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentServiceUrls","bacontentnav/utils/ContentStoreObject","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","bacontentnav/common/ui/BreadcrumbDropDown","bacontentnav/utils/GlassContextHelper","bi/commons/ui/KeyCodes","lodash"],function(e,n,t,i,o,a,s,r,l){"use strict";var c=e.extend({stateId:"AccountPickerSlideoutView",disabledActions:["DeleteAction","ManageContentAction"],init:function(e){this.namespaceMap={},this.searchMode="find",this.events={},this.events["keydown .l_findUser2"]="_handleSearchMenuButtonDown",c.inherited("init",this,arguments),l.extend(this,e)},getRootAncestor:function(){return i.getRootNamespacesAncestors()},_createDropDown:function(t){var e=[{label:n.get("policiesFindMode"),icon:"common-grant_perm",onSelect:this._onMenuSelect.bind(this,"find")},{label:n.get("policiesTypeInMode"),icon:"",onSelect:this._onMenuSelect.bind(this,"typein")}];this.ddMenu=this._getDropDownMenu({dropDownMenuSpec:{title:n.get("optionsMenuLabel"),id:"find",label:"find",icon:"",items:e,actionElement:t,ddMenuPlacement:"bottom"}}),this.ddMenu.render().then(function(e){t.appendChild(e)})},_getDropDownMenu:function(e){return new a(e)},_onMenuSelect:function(e){"find"===(this.searchMode=e)?(this.getListControl().updateDatatable(this._getDefaultRequestURL()),this.ancestors=[],this.initializeAncestors(),this.contentBar.getAddedItem("breadcrumbs").then(function(e){e.updateBreadcrumb(this.ancestors)}.bind(this)),this.ddMenu.items[0].icon="common-grant_perm",this.ddMenu.items[1].icon="",this._oPropertyUIControl.getProperty("TypeInHintText").setVisibility("hidden")):(this.ddMenu.items[0].icon="",this.ddMenu.items[1].icon="common-grant_perm",this._oPropertyUIControl.getProperty("TypeInHintText").setVisibility("visible")),this.setFocus()},_getSearchData:function(){return{currentNamespaceId:this.ancestors[this.ancestors.length-1].id,currentNamespaceType:this.ancestors[this.ancestors.length-1].type,searchValue:this._oPropertyUIControl.getProperty("searchValue").getValue()}},_doSearch:function(){var e=this._getSearchData();if(e.searchValue&&""!==e.searchValue)if("find"!==this.searchMode||"namespace"===e.currentNamespaceType||"namespaceFolder"===e.currentNamespaceType){var t=this.getListControl().getDatatable().api(),a=[];if("find"===this.searchMode)t.clear(),this.getListControl().setShowWorking(!0),t.draw(),a=["v1/users?pid="+e.currentNamespaceId+"&&search=keyword|"+encodeURIComponent(e.searchValue),"v1/groups?pid="+e.currentNamespaceId+"&&search=keyword|"+encodeURIComponent(e.searchValue),"v1/roles?pid="+e.currentNamespaceId+"&&search=keyword|"+encodeURIComponent(e.searchValue)],this._sendSearchRequests(a);else if("typein"===this.searchMode){if(-1===e.searchValue.indexOf("/"))return void s.displayToast(this.glassContext,n.get("policyToastMessageSyntax"),{type:"warning"});e.searchValue=e.searchValue.replace(/;$/,""),t.clear(),this.getListControl().setShowWorking(!0),t.draw(),e.searchValue.split(";").forEach(function(e){var t=e.split("/"),n=t[0].toLowerCase(),i=this.namespaceMap[n];if(i&&void 0!==t[1]){var o=t[1];a.push("v1/users?pid="+i+"&searchFilter="+encodeURIComponent('defaultName="'+o+'"|userName="'+o+'"')),a.push("v1/groups?pid="+i+"&searchFilter="+encodeURIComponent('defaultName="'+o+'"|userName="'+o+'"')),a.push("v1/roles?pid="+i+"&searchFilter="+encodeURIComponent('defaultName="'+o+'"|userName="'+o+'"'))}}.bind(this)),this._sendSearchRequests(a)}this.setFocus()}else s.displayToast(this.glassContext,n.get("policyToastMessageNamespace"),{type:"warning"})},_sendSearchRequests:function(e){var t=[],n=!1;return e.forEach(function(e){t.push(this.glassContext.getCoreSvc(".Ajax").ajax({headers:{Accept:"application/json","Content-Type":"application/json"},type:"GET",url:e}).then(function(e){e.data&&e.data.data&&0<e.data.data.length&&(n=!0,this.getListControl().addRowData(e.data.data))}.bind(this)).catch(function(e){e.message&&s.displayToast(this.glassContext,e.message,{type:"error"})}.bind(this)))}.bind(this)),Promise.all(t).then(function(){n||this.getListControl().showEmptyTableMessage()}.bind(this))},renderContent:function(){return this.$contentBars=this.$el.children().detach(),this._oPropertyUIControl=new o({el:this.$el,glassContext:this.glassContext,closeCallback:this._onCancelClick.bind(this),items:[{name:"AccountPicker",type:"Banner",value:n.get("selectAccountGroupOrRole"),backButton:!!this.slideout.overlay,centerLabel:!!this.slideout.overlay},{type:"HintText",name:"TypeInHintText",visibility:"hidden",label:n.get("typeInHintText")},{name:"findUser",type:"SingleLineLinks",items:[{align:"left",items:[{styles:"width: 80%",type:"Input",inputClass:"policyFindUser",handleReturnKey:!0,enterKeyCallback:this._doSearch.bind(this),value:"",placeHolderText:n.get("policiesFindAUserHint"),ariaLabel:n.get("policiesFindAUserHint"),ellipses:!1,name:"searchValue",editable:!0,highlightTextOnFocus:!0},{type:"icon",svgIcon:"common-search",clickCallback:this._doSearch.bind(this),value:n.get("policiesFindAUserHint"),iconTooltip:n.get("policiesFindAUserHint")},{type:"icon",svgIcon:"common-titan-arrow-down",value:n.get("policiesFindModeMenuTip"),iconTooltip:n.get("policiesFindModeMenuTip"),role:"button"}]}]},{module:"bi/content_apps/ui/RenderCallback",renderCallback:this._renderListControl.bind(this)},{type:"Footer",items:[{type:"Button",label:n.get("policesAddMemberButtonLabel"),onSelect:this._onAddClick.bind(this),primary:!0}]}]}),this._oPropertyUIControl.render().then(function(){return this._renderPostListControls(),this}.bind(this))},setFocus:function(){var e=this.$el.find("input.policyFindUser");e&&e.focus()},_closeCallback:function(){this.close()},_renderListControl:function(e){var t=$("<div>");return $(e).append(t),t.append(this.$contentBars),this.renderContentList({el:t,columns:this._getColumnSpecification(),$container:this.$el,url:this.url||this._getDefaultRequestURL(),dataManipulationCallback:function(e){e&&e.data&&(e.data=l.filter(e.data,function(e){return e.permissions.includes("traverse")}))}}).then(function(){this.getListControl().setIsAccountPickerSlideout(),this.setFocus()}.bind(this))},_onCancelClick:function(){this.slideout.hide()},_onAddClick:function(){var e=this.getListControl().getSelectedObjects();"function"==typeof this.addCallback&&this.addCallback(e),this.setFocus()},_renderPostListControls:function(){var e=this.$el.find(".l_findUser2");e.attr("tabindex","0"),this._createDropDown(e),this.getListControl().getDatatable().fnGetData().forEach(function(e){"namespace"===e.type&&(this.namespaceMap[e.defaultName.toLowerCase()]=e.id)}.bind(this))},_getDefaultRequestURL:function(){return t.getBaseNamespaceURL()},_getDefaultSelfURL:function(){return t.getBaseNamespaceURL()},_getModuleName:function(){return"bi/content_apps/AccountPickerSlideoutView"},contentbarItems:function(){var e="ACCOUNTPICKER_FILTER_",t=window.localStorage.getItem("filterString_"+this.stateId);return[{name:"nameLabel",position:"leading",style:"nameLabel",module:"bacontentnav/common/ui/contentbar_components/HiddenLabel",label:n.get("policiesTableLable")},{name:e+"typeMenu",label:n.get("type"),labelOnly:!0,hcLabel:!1,position:"trailing",supportCustomCollapse:!0,showTitle:!1,updateLabel:!0,icon:"common-filter",bSVG:!0,module:"bacontentnav/common/ui/contentbar_components/ToggleMenuBar",items:[{name:e+"allContent",icon:"wft_checkmark",label:n.get("allGenericItems"),checked:""===t,action:function(){this._filter("")}.bind(this)},{name:e+"accounts",icon:"wft_checkmark",label:n.get("policyFilterAccounts"),checked:"account"===t,action:function(){this._filter("account")}.bind(this)},{name:e+"groups",icon:"wft_checkmark",label:n.get("policyFilterGroups"),checked:"group"===t,action:function(){this._filter("group")}.bind(this)},{name:e+"roles",icon:"wft_checkmark",label:n.get("policyFilterRoles"),checked:"role"===t,action:function(){this._filter("role")}.bind(this)}]}]},getListControlOptions:function(){return{ajaxProp:"data",emptyFolderString:n.get("emptyPolicyList"),showEmptyNewFolderButton:!1,rightClickContextMenu:!1}},getDefaultSort:function(){return[1,"asc"]},_handleSearchMenuButtonDown:function(e){return e.keyCode!==r.SPACE&&e.keyCode!==r.ENTER&&e.keyCode!==r.DOWN_ARROW||!$(e.currentTarget).click||($(e.currentTarget).click(),e.stopPropagation(),!1)},_getColumnSpecification:function(){return[{type:"Icon"},{type:"Name",navigateOnly:!0},{type:"Time",propertyName:"modificationTime"}]},_adjustWidth:function(){this.$el.addClass("pageview-small")},_navigate:function(e){c.inherited("navigate",this,arguments),this.setFocus()}});return c}),define("bi/content_apps/CredentialsView",["bacontentnav/common/ContentListPageView","bi/content_apps/common/ui/permissions/Policy","bi/content_apps/nls/StringResource","bacontentnav/utils/ContentStoreObject","bi/commons/ui/Slideout","bacontentnav/utils/GlassContextHelper","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","bi/content_apps/AccountPickerSlideoutView","lodash"],function(e,d,a,t,n,i,o,s,r){"use strict";var l=e.extend({init:function(e){l.inherited("init",this,arguments),r.extend(this,e),this.contentListFacets={accounts:"account",groups:"group",roles:"role"}},renderContent:function(){this.$el.addClass("policies"),this.$contentBars=this.$el.children().detach();var e=[{module:"bi/content_apps/ui/RenderCallback",renderCallback:this._renderListControl.bind(this)},{type:"Banner",name:"credentialsBanner",value:a.get("preferencesMyCredentials"),centerLabel:!0,hintText:a.get("preferencesCredentialsHintText"),backButton:!0,editable:!1,readOnly:!0,onClose:this._onClose.bind(this)},{type:"Footer",items:[{type:"Button",label:a.get("applyLabel"),onSelect:this._onApplyClick.bind(this),primary:!0},{type:"Button",label:a.get("cancel"),onSelect:this._onCancelClick.bind(this),primary:!1}]}];return this._oPropertyUIControl=this._getPropertyUIControl({el:this.$el,glassContext:this.glassContext,items:e}),this._oPropertyUIControl.render()},_getPropertyUIControl:function(e){return new o(e)},_renderListControl:function(e){var t=$("<div>");return $(e).append(t),t.append(this.$contentBars),this.renderContentList({el:t,columns:this._getColumnSpecification(),$container:this.$el,getJSONDataCallback:this._getCredentialData.bind(this)}).then(function(){this.getListControl().setIsAccountPickerSlideout()}.bind(this))},_getCredentialData:function(){return this._getUserCredentials().then(function(){return this._getPolicies(this.credentialId).then(function(){return{data:this.policyArray.data[0].policies}}.bind(this))}.bind(this)).catch(function(e){return this.slideout.hide(),Promise.reject(e)}.bind(this))},_getUserCredentials:function(){return this._sendRequest({dataType:"json",type:"GET",url:"v1/users/~/credentials"},function(e){if(!e.data||!e.data.id)return Promise.reject(new Error);this.credentialId=e.data.id}.bind(this))},_getPolicies:function(e){return this._sendRequest({dataType:"json",type:"GET",url:"v1/objects/"+e+"?fields=policies{defaultName,id,searchPath}"},function(e){return e.data&&e.data.data[0].policies?(this.policyArray=e.data,this.policyArray):Promise.reject(new Error)}.bind(this))},_onApplyClick:function(){var e={};e.policies=this.policyArray.data[0].policies,e.type="credential";var t=JSON.stringify(e),n={headers:{Accept:"application/json","Content-Type":"application/json"},type:"PUT",url:"v1/objects/"+this.credentialId,data:t};return this._sendRequest(n,function(){})},_onCancelClick:function(){this.slideout.hide()},_sendRequest:function(e,t){return this.glassContext.getCoreSvc(".Ajax").ajax(e).then(t.bind(this)).catch(function(e){return e.message&&this.glassContext.appController.showErrorMessage(e.message,"Error"),Promise.reject(e)}.bind(this))},_getDefaultRequestURL:function(){return this.itemURL},_getModuleName:function(){return"bi/content_apps/CredentialsView"},getDefaultSort:function(){return[1,"asc"]},setFocus:function(){var e=this.$el.find(":tabbable");0<e.length&&e.get(0).focus()},_isDuplicate:function(e,t){var n=!1;return e.forEach(function(e){if(e.securityObject.id===t)return!(n=!0)}),n},removeSelection:function(){setTimeout(function(){var e=this.getListControl().getSelectedObjects(),t=this.policyArray.data[0].policies,n=r.reject(t,function(t){return r.find(e,function(e){return t.securityObject.defaultName===e.securityObject.defaultName})});this.policyArray.data[0].policies=n;var i=this.getListControl().getSelectedRows().length;if(0<i){var o=1===i?a.get("toastItemsWereDeletedSingular",{noOfItems:i}):a.get("toastItemsWereDeleted",{noOfItems:i});this.getListControl().removeSelectedRows(),this.glassContext.appController.showToast(o)}this.setFocus()}.bind(this),100)},addSelection:function(e){var t,r=0,l=0,n=this.getListControl().getDatatable(),c=n.api(),u=n.fnGetData();e.forEach(function(e){var t=e.id,n=e.type,i=e.defaultName,o=e.searchPath,a=this._isDuplicate(u,t);if(r+=1,!a){l+=1;var s=new d(i,t,n,o);this.policyArray.data[0].policies.push(s),c.row.add(s).draw(!0)}}.bind(this)),t=1===l?a.get("toastItemsWereAddedSingular",{noOfItems:l}):0===l&&1===r?a.get("toastItemsAlreadyAddedSingular"):0===l&&1<r?a.get("toastItemsAlreadyAdded"):a.get("toastItemsWereAdded",{noOfItems:l}),this.glassContext.appController.showToast(t)},_onClose:function(){this.slideout.hide()},_openAddMembersSlideout:function(e){var t=$("<div>");this.slideout.$el.append(t);var n=this._getSlideout({glassContext:this.glassContext,position:this.position||"right",el:t,overlay:!0,width:this.slideout.$el.width(),enableTabLooping:!0,content:{module:s,showBreadcrumbs:!0,navigateOnRowSelect:!0,addCallback:function(e){this.addSelection(e)}.bind(this),objectInformation:e,glassContext:this.glassContext}});n.render().then(function(){n.show()})},_getSlideout:function(e){return new n(e)},contentbarItems:function(){var e=window.localStorage.getItem("filterString_"+this.stateId);return[{name:"nameLabel",position:"leading",label:a.get("preferencesCredentialsLabel"),style:"nameLabel",module:"bacontentnav/common/ui/contentbar_components/HiddenLabel"},{name:"typeMenu",label:a.get("type"),labelOnly:!0,hcLabel:!1,position:"trailing",supportCustomCollapse:!0,showTitle:!1,updateLabel:!0,icon:"common-filter",bSVG:!0,module:"bacontentnav/common/ui/contentbar_components/ToggleMenuBar",items:[{name:"allContent",icon:"wft_checkmark",label:a.get("allGenericItems"),checked:"allContent"===e,action:function(){this._filter("allContent")}.bind(this)},{name:"accounts",icon:"wft_checkmark",label:a.get("policyFilterAccounts"),checked:"accounts"===e,action:function(){this._filter("accounts")}.bind(this)},{name:"groups",icon:"wft_checkmark",label:a.get("policyFilterGroups"),checked:"groups"===e,action:function(){this._filter("groups")}.bind(this)},{name:"roles",icon:"wft_checkmark",label:a.get("policyFilterRoles"),checked:"roles"===e,action:function(){this._filter("roles")}.bind(this)}]},{name:"separator",type:"Separator",position:"trailing"},{name:"add",position:"trailing",displayLabel:!1,label:a.get("policesAddMemberButtonLabel"),module:"bacontentnav/common/ui/contentbar_components/Button",className:"addNewFolder",icon:"common-add",_handleClick:function(){this._openAddMembersSlideout()}.bind(this)}]},getListControlOptions:function(){return{ajaxProp:"data",emptyFolderString:a.get("emptyPolicyList"),showEmptyNewFolderButton:!0,multiSelect:!0,rightClickContextMenu:!1}},_getColumnSpecification:function(){return[{type:"Icon",getDataFn:function(e){return"nil"===e.securityObject[t.TYPE]?a.get("unknown"):e.securityObject[t.TYPE]}},{type:"Name",scope:"row",getDataFn:function(e){return void 0===e.securityObject[t.DEFAULT_NAME]?a.get("unavailable"):r.escape(e.securityObject[t.DEFAULT_NAME])}},{type:"ClickableIcon",name:a.get("policesRemove"),icon:"common-remove-delete",clickCallback:this.removeSelection.bind(this)}]},_adjustWidth:function(){this.$el.addClass("pageview-small")},_multiselectbarItems:function(){return Promise.resolve([{name:"removeButton",position:"leading",icon:"common-remove-delete",module:"bacontentnav/common/ui/contentbar_components/Button",className:"policyMulSel",action:this.removeSelection.bind(this)},{name:"selectedLabel",position:"leading",module:"../../lib/gemini/app/ui/toolbar_components/Label",style:"selectedLabel"},{position:"leading",type:"Separator"},{name:"cancelButton",position:"trailing",label:a.get("cancel"),text:a.get("cancel"),labelOnly:!0,module:"bacontentnav/common/ui/contentbar_components/Button",className:"cancelButton",_handleClick:function(){this.getListControl()._clearRows(),this.multiselectBar.hide(),this.contentBar.show()}.bind(this)}])},getFilterSpec:function(){return[{name:"allContent",label:a.get("allContent"),value:"allContent"},{name:"accounts",label:a.get("policyFilterAccounts"),value:"accounts"},{name:"groups",label:a.get("policyFilterGroups"),value:"groups"},{name:"roles",label:a.get("policyFilterRoles"),value:"roles"}]}});return l}),define("bi/content_apps/DataSourceCredentialsView",["jquery","lodash","bacontentnav/common/ContentListPageView","bi/content_apps/nls/StringResource","bacontentnav/utils/GlassContextHelper","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","bacontentnav/lib/@waca/core-client/js/core-client/utils/Deferred"],function(n,t,e,i,o,a,s){"use strict";var r=e.extend({init:function(e){this.itemURL=e.itemURL,r.inherited("init",this,arguments),t.extend(this,e)},renderContent:function(){this.$contentBars=this.$el.children().detach();var e=[];e.push({module:"bi/content_apps/ui/RenderCallback",renderCallback:this._renderListControl.bind(this)},{type:"Banner",name:"credentialsBanner",value:i.get("preferencesDatasourceTitle"),centerLabel:!0,hintText:i.get("preferencesDataSourceCredentialsHintText"),backButton:!0,editable:!1,readOnly:!0,onClose:this._onClose.bind(this)}),this._oPropertyUIControl=new a({el:this.$el,glassContext:this.glassContext,items:e}),this._oPropertyUIControl.render().then(function(){return this})},_renderListControl:function(e){var t=n("<div></div>");return n(e).append(t),t.append(this.$contentBars),this.renderContentList({el:t,columns:this._getColumnSpecification(),$container:this.$el,url:this._getRequestURL()}).then(function(){this.setFocus()}.bind(this))},_getRequestURL:function(){return"v1/objects/"+this.glassContext.profile.account.id+"/items?types=dataSourceCredential&fields=dataSourceName,dataSourceConnectionName,defaultName"},_getDefaultRequestURL:function(){return this.itemURL},_getModuleName:function(){return"bi/content_apps/DataSourceCredentialsView"},_sendRequest:function(e,t){var n=new s;return t||(t=this._handleSuccess),this.glassContext.getCoreSvc(".Ajax").ajax(e).then(t.bind(this,n),this._handleError.bind(this,n)),n.promise},_handleSuccess:function(e){e.resolve()},_handleError:function(e,t,n){o.showAjaxServiceErrorMessage(this.glassContext,n),e.reject()},contentbarItems:function(){return[{name:"nameLabel",position:"leading",style:"nameLabel",label:i.get("preferencesDataSourceCredentialsLabel"),module:"bacontentnav/common/ui/contentbar_components/HiddenLabel"}]},getListControlOptions:function(){return{ajaxProp:"data",emptyFolderString:i.get("emptyPolicyList"),showEmptyNewFolderButton:!1,multiSelect:!0,rightClickContextMenu:!1}},setFocus:function(){var e=this.$el.find(":tabbable");0<e.length&&e.get(0).focus()},_onClose:function(){this.slideout.hide()},getDefaultSort:function(){return[1,"asc"]},removeSelection:function(){return new Promise(function(i){setTimeout(function(){for(var e=this.getListControl().getSelectedObjects(),t=0;t<e.length;t+=1){var n={headers:{Accept:"application/json","Content-Type":"application/json"},type:"DELETE",url:"v1/objects/"+e[t].id};this._sendRequest(n)}this.getListControl().removeSelectedRows(),this.setFocus(),i()}.bind(this),100)}.bind(this))},getListControl:function(){return this._listControl},_getColumnSpecification:function(){return[{type:"Icon"},{type:"Text",propertyName:"dataSourceName",label:i.get("preferencesDatasourceHeader")},{type:"ClickableIcon",name:i.get("policesRemove"),icon:"common-remove-delete",clickCallback:this.removeSelection.bind(this)}]},_adjustWidth:function(){this.$el.addClass("pageview-small")},_multiselectbarItems:function(){return Promise.resolve([{name:"removeButton",position:"leading",icon:"common-remove-delete",module:"bacontentnav/common/ui/contentbar_components/Button",className:"policyMulSel",action:this.removeSelection.bind(this)},{name:"selectedLabel",position:"leading",label:i.get("selected"),module:"../../lib/gemini/app/ui/toolbar_components/Label",style:"selectedLabel"},{name:"cancelButton",position:"trailing",label:i.get("cancel"),text:i.get("cancel"),labelOnly:!0,module:"bacontentnav/common/ui/contentbar_components/Button",className:"cancelButton",_handleClick:function(){this._listControl._clearRows(),this.multiselectBar.hide(),this.contentBar.show()}.bind(this)}])}});return r}),define("bi/content_apps/GroupsAndRolesView",["bacontentnav/lib/@waca/core-client/js/core-client/utils/Deferred","jquery","lodash","bi/glass/app/ContentView","bi/content_apps/nls/StringResource","bacontentnav/lib/@waca/core-client/js/core-client/ui/properties/PropertyUIControl","bacontentnav/utils/GlassContextHelper"],function(e,n,s,t,r,i,o){"use strict";var a=t.extend({init:function(e){a.inherited("init",this,arguments),s.extend(this,e)},render:function(){var t=new e;return this._containerElement=n("<div>",{class:"propertyUIControl"}),this.$el.append(this._containerElement),this._getGroupsAndRoles().then(function(){var e=this._createHierarchicalList();this._oPropertyUIControl=new i({el:this.$el,glassContext:this.glassContext,items:[{type:"Banner",name:"GroupsAndRolesBanner",value:r.get("preferencesGroupsAndRoles"),centerLabel:!0,hintText:r.get("preferencesGroupsAndRolesHintText"),backButton:!0,editable:!1,readOnly:!0,onClose:function(){this.slideout.hide()}.bind(this)},{type:"HierarchicalList",name:"groups_and_roles",data:e}]}),this._oPropertyUIControl.render().done(t.resolve)}.bind(this),function(){this.slideout.hide()}.bind(this)),t.promise},_getGroupsAndRoles:function(){var i=new e;return this.glassContext.services.ajax.ajax({dataType:"json",type:"GET",url:"v1/users/~/identity"}).then(function(e){var t=[],n=[];e.data.forEach(function(e){"role"===e.type?t.push(e):"group"===e.type&&n.push(e)}.bind(this)),0<n.length||0<t.length?(0<n.length&&(this.groups=n),0<t.length&&(this.roles=t),i.resolve()):i.reject()}.bind(this),this._handleError.bind(this,i)),i.promise},_createHierarchicalList:function(){var e=[],t={defaultName:r.get("policyFilterGroups")},n=[];if(this.groups){for(var i=0;i<this.groups.length;i+=1)n.push({defaultName:this.groups[i].defaultName});t.children=s.sortBy(n,"defaultName"),e.push(t)}var o={defaultName:r.get("policyFilterRoles")};if(this.roles){n=[];for(var a=0;a<this.roles.length;a+=1)n.push({defaultName:this.roles[a].defaultName});o.children=s.sortBy(n,"defaultName"),e.push(o)}return e},_handleError:function(e,t,n){o.showAjaxServiceErrorMessage(this.glassContext,n),e.reject()}});return a}),define("js/content_apps/preferencesBundle",function(){});