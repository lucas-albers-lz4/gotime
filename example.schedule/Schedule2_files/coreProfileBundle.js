/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Dashboard
 * (C) Copyright IBM Corp. 2016, 2021
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _extends(){return(_extends=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}function _assertThisInitialized(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _inheritsLoose(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,_setPrototypeOf(t,e)}function _setPrototypeOf(t,e){return(_setPrototypeOf=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,_toPropertyKey(r.key),r)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function _toPropertyKey(t){var e=_toPrimitive(t,"string");return"symbol"==typeof e?e:String(e)}function _toPrimitive(t,e){if("object"!=typeof t||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}define("@dashboard-features/contentStoreReferences/js/ContentStoreReferencesAPI",[],(function(){return function(){function t(){_classCallCheck(this,t)}return t.prototype.getLatestAssetId=function(){},t.prototype.getContentStoreReferences=function(){},t.prototype.registerProvider=function(){},t}()})),define("@dashboard-features/contentStoreReferences/js/ContentStoreReferences",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-core/js/dashboard/loader/DeploymentReferencesUtil","./ContentStoreReferencesAPI"],(function(t,e,n){return function(){function r(e){var i=e.features,s=e.spec;_classCallCheck(this,r),this._features=i,this._references=s||[],this._referenceProviders=[],this._api=t.createAPI(this,[n])}return r.prototype.getAPI=function(){return this._api},r.prototype.destroy=function(){delete this._references,delete this._referenceProviders,delete this._api,delete this._features},r.prototype.getContentStoreReferences=function(){var t=this._features.UserProfile.getContentLocale();return this._referenceProviders.map((function(t){return t.getContentStoreReferences()||[]})).reduce((function(t,e){return t.concat(e)}),[]).filter((function(t,e,n){return n.findIndex((function(e){return e.assetId===t.assetId}))===e})).map((function(e){var n;return{objects:[{type:e.type,searchPath:'storeID("'+e.assetId+'")'}],name:(n={},n[t]=e.assetId,n)}}))},r.prototype.getLatestAssetId=function(t){var n=e.findReference(t,this._references);return n&&n.id},r.prototype.registerProvider=function(t){this._referenceProviders.push(t)},r}()})),define("@dashboard-features/dashboardDnd/js/api/DashboardDndAPI",[],(function(){return function(){function t(){_classCallCheck(this,t)}return t.prototype.startDrag=function(){},t.prototype.registerDropTarget=function(){},t.prototype.deregisterDropTarget=function(){},t.prototype.registerDropHandler=function(){},t.prototype.deregisterDropHandler=function(){},t}()})),define("@dashboard-features/dashboardDnd/js/DashboardDndImpl",["@waca/dashboard-common/js/core/APIFactory","./api/DashboardDndAPI"],(function(t,e){return function(){function n(r){var i=r.features;_classCallCheck(this,n),this._dashboardApi=i.API,this._api=t.createAPI(this,[e])}return n.prototype.initialize=function(){var t=this;return this._dashboardApi.getDashboardSvc(".DndManager").then((function(e){t._privateApi=e}))},n.prototype.getAPI=function(t){return"internal"===t?this._privateApi:this._api},n.prototype.startDrag=function(t){this._privateApi.startDrag(t)},n.prototype.registerDropTarget=function(t){return this._privateApi.registerDropTarget(t)},n.prototype.deregisterDropTarget=function(t){this._privateApi.deregisterDropTarget(t)},n.prototype.registerDropHandler=function(t){return this._privateApi.registerDropHandler(t)},n.prototype.deregisterDropHandler=function(t){this._privateApi.deregisterDropHandler(t)},n}()})),define("@dashboard-features/dssQueryService/js/dataSources/api/DataSourcesMoserAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getNavigationPaths=function(){},e.getDrillGroups=function(){},e.setCustomGroupColumns=function(){},e.getCustomGroupColumns=function(){},e.getCustomGroupData=function(){},e.isConsumerGroupColumn=function(){},e.ensureTemporaryModule=function(){},e.addToUndoStack=function(){},e.getOriginalSourceType=function(){},e.getModule=function(){},e.registerMetadataSubsetIdsProvider=function(){},e.registerLoadMetadataProgressHandler=function(){},e.getMetadataSubsetIds=function(){},e.updateWhatIf=function(){},t}()})),define("@dashboard-features/dssQueryService/js/dataSources/api/CalculationUIAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.editCalculation=function(){},e.createCalculation=function(){},t}()})),define("@dashboard-features/dssQueryService/js/dataSources/api/CustomGroupUIAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.validateCustomGroup=function(){},e.createCustomGroup=function(){},e.removeCustomGroup=function(){},t}()})),define("@dashboard-features/dssQueryService/js/dataSources/api/CustomBinUIAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.createCustomBinning=function(){},e.removeCustomBinning=function(){},e.getCustomBinning=function(){},e.validateCustomBinning=function(){},t}()})),define("@dashboard-features/dssQueryService/js/dataSources/api/TaxonomyAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getFamily=function(){},e.getDomain=function(){},e.getClass=function(){},e.destroy=function(){},t}()})),define("@dashboard-features/dssQueryService/js/dataSources/Taxonomy",["@waca/dashboard-common/js/core/APIFactory","./api/TaxonomyAPI"],(function(t,e){return function(){function n(t){this.taxonomy=t}var r=n.prototype;return r.getAPI=function(){return t.createAPI(this,[e])},r.getFamily=function(){return this.taxonomy.family},r.getDomain=function(){return this.taxonomy.domain},r.getClass=function(){return this.taxonomy.clazz},r.destroy=function(){this.taxonomy=void 0},n}()})),define("@dashboard-features/dssQueryService/js/dataSources/MetadataColumn",["@waca/dashboard-common/js/core/APIFactory","./Taxonomy","@waca/dashboard-livewidget/js/features/dashboard/dataSources/api/MetadataColumnAPI","ca-modeller/shaping"],(function(t,e,n,r){return function(){function i(t){void 0===t&&(t={}),this.metadataColumn=t.metadataColumn,this.sourceModelAPI=t.sourceModelAPI}var s=i.prototype;return s.destroy=function(){this.taxonomyList&&this.taxonomyList.each((function(t){t.destroy()}))},s.getAPI=function(){return this._api||(this._api=t.createAPI(this,[n])),this._api},s.getObjectType=function(){return this.metadataColumn.getObjectType()},s.getId=function(){return this.metadataColumn.getId()},s.getSourceId=function(){return this.metadataColumn.getSourceId()},s.getLabel=function(){return this.metadataColumn.getLabel()},s.setLabel=function(t){this.metadataColumn.setLabel(t)},s.setHidden=function(t){this.metadataColumn.setHidden(t)},s.getType=function(){return this.metadataColumn.getType()},s.getDataType=function(){return this.metadataColumn.getDataType()},s.getDefaultAggregation=function(){return this.metadataColumn.getDefaultAggregation()},s.getAggregationMode=function(){return this.metadataColumn.getAggregateMode()},s.getTaxonomyList=function(){var t=this.metadataColumn.getTaxonomy();return t&&t.length&&(this.taxonomyList=t.map((function(t){return new e(t).getAPI()}))),this.taxonomyList},s.getDefaultSortType=function(){return this.metadataColumn.getDefaultSortType()},s.getFormat=function(){return this.metadataColumn.getFormat()},s.getRootMember=function(){return this.metadataColumn.getRootMember()},s.isLeafMember=function(t){return this.metadataColumn.isLeafMember(t)},s.getCustomGroupData=function(){var t=this.metadataColumn.getMoserObject(),e=r.customGroupUtils.getCustomGroupObjectData(t);return e&&e.data&&0===e.messages.length&&this.isConsumerGroupColumn()?e.data:null},s.isConsumerGroupColumn=function(){var t=this.metadataColumn.getMoserObject();return-1!==(this.sourceModelAPI&&this.sourceModelAPI.getCustomGroupColumns()||[]).indexOf(t.idForExpression)},s.isFacetDefinitionEnabled=function(t){var e=(void 0===t?{}:t).strict,n=void 0===e||e,r=this.metadataColumn.getFacetDefinition();if(!r)return!n;var i=r.enabled&&r.enabled.enumValue;return!(!i||"false"===i)&&("automatic"!==i||!n)},s.getSourceCategory=function(){return this.metadataColumn.getSourceCategory()},s.isHierarchy=function(){return this.metadataColumn.isHierarchy()},s.isNamedSet=function(){return this.metadataColumn.isNamedSet()},s.isProperty=function(){return this.metadataColumn.isProperty()},s.isLevel=function(){return this.metadataColumn.isLevel()},s.isSingleRootHierarchy=function(){return this.metadataColumn.isSingleRootHierarchy()},s.getReferencedHierarchyId=function(){return this.metadataColumn.getRefToHierarchy()},s.isOlapColumn=function(t){return this.metadataColumn.isOlapColumn(t)},s.isNumericDataType=function(){return this.metadataColumn.isNumericDataType()},s.isDateTimeDataType=function(){return this.metadataColumn.isDateTimeDataType()},s.isFilter=function(){return this.metadataColumn.isFilter()},s.isEditableCalculation=function(){return this.metadataColumn.isEditableCalculation()},s.getTableName=function(){return this.metadataColumn.getTableName()},s.getTableId=function(){var t=this.metadataColumn.getTable();return t?t.getIdentifier():""},s.getDeprecatedMetadataColumn=function(){return this.metadataColumn},s.isHidden=function(){var t=this.metadataColumn.isHidden();return t&&(t=!this.isConsumerGroupColumn()),!!t},s.isMissing=function(){return this.metadataColumn.isMissing()},s.getParent=function(){var t=this.metadataColumn.getParent();return t?new i({metadataColumn:t,sourceModelAPI:this.sourceModelAPI}):null},s.getHierarchyLevelIds=function(){return this.metadataColumn.getHierarchyLevelIds()},s.getProperty=function(t){return this.metadataColumn.getProperty(t)},i}()})),define("@dashboard-features/dssQueryService/js/dataSources/DataSource",["underscore","@waca/dashboard-common/js/core/APIFactory","./MetadataColumn","@waca/dashboard-livewidget/js/features/dashboard/dataSources/api/MetadataColumnAPI","@waca/dashboard-livewidget/js/features/dashboard/dataSources/api/DataSourceAPI","@waca/dashboard-livewidget/js/dataSources/utils/ShapingUIUtils","@waca/dashboard-livewidget/js/dataSources/utils/RelinkUtils","@waca/dashboard-livewidget/js/apiHelpers/SlotAPIHelper","bi/moser/moser.min","ca-modeller/shaping"],(function(t,e,n,r,i,s,a,o,u,c){var l="Calling getMetadataColumn before loadMetadata was called",d=function(){function d(t,e,n){this.sourceModelAPI=e,this.sourcesCollectionManager=t,this.dashboardApi=n.API,this._setShapingEventHandler(e),this._initColumns(),this._joinErrorCache=[],this.dashboardApi.on("mode:change",this._onModeChange,this)}var g=d.prototype;return g._setShapingEventHandler=function(t){var e=this;t.getModule().then((function(t){e.shapingEventHandler=t.on("shapingmodel:changed",e._onShapingModelChange.bind(e))}))},g._initMultiMeasureColumn=function(){var t=new r;t.getId=function(){return"_multiMeasuresSeries"},t.getType=function(){return"attribute"},t.isHidden=function(){return!1},this._columnCache._multiMeasuresSeries=t},g._initColumns=function(){this._columnCache={},this._columnsCacheOnType={},this._initMultiMeasureColumn()},g._onModeChange=function(t){t.authoring?this._getModuleAPI().ensureTemporaryModule().then(this._initColumns.bind(this)):this._initColumns()},g._onShapingModelChange=function(t){this._initColumns(),this._joinErrorCache=[],this.dashboardApi.triggerDashboardEvent("shapingmodel:changed",t)},g._getModuleAPI=function(){return this.sourceModelAPI.getModuleAPI()},g.destroy=function(){this.shapingEventHandler&&(this.shapingEventHandler.remove(),this.shapingEventHandler=null),this._columnCache=null,this._columnsCacheOnType=null,this.sourceModelAPI=void 0,this.dashboardApi.off("mode:change",this._onModeChange,this)},g.getId=function(){return this.sourceModelAPI.getId()},g.getAssetId=function(t){if("shaping"===t){var e=this.sourceModelAPI.getModuleAPI();if(e&&e.getShapingId())return e.getEmbeddedModuleId()}return this.sourceModelAPI.getAssetId()},g.getType=function(){return this.sourceModelAPI.getType()},g.getProtocol=function(){return d.PROTOCOL},g.getLocalizedName=function(){return this.sourceModelAPI.getLocalizedName()},g.getSearchPath=function(){return this.sourceModelAPI.getSearchPath()},g.getName=function(){throw new Error("Not implemented yet.")},g.getState=function(){return this.sourceModelAPI.getState()},g.getAPI=function(){return e.createAPI(this,[i])},g.loadMetadata=function(){return this.sourceModelAPI.getModule()},g.getTable=function(t){var e=this._getModuleAPI().getMetadataColumn(t);return e?e.getTable():null},g.getMetadataColumnImpl=function(t){var e=this._getModuleAPI();if(!e)throw new Error(l);if("error"!==e.getState()){var r=e.getMetadataColumn(t);if(r)return new n({metadataColumn:r,sourceModelAPI:this.sourceModelAPI})}return null},g.getMetadataColumn=function(t){if(!this._columnCache[t]){var e=this.getMetadataColumnImpl(t);if(e){var n=e.getAPI();this._columnCache[t]=n||null}else this._columnCache[t]=null}return this._columnCache[t]},g.relink=function(t){return a.relink(this.sourceModelAPI,t,this.dashboardApi)},g.editCalculation=function(t,e){return this._getModuleAPI()?s.renderCalculationDialog(this._getModuleAPI(),t,!0,e).then((function(){return!0})):Promise.reject(l)},g.pickItems=function(e){var n=this,r=t.map(e.initialFieldIds,(function(t){return n._getModuleAPI().getMetadataColumn(t).getMoserObject()})),i=t.map(e.recommendedFieldIds,(function(t){return n._getModuleAPI().getMetadataColumn(t).getMoserObject()}));return this._getModuleAPI().getShapingHelper().openItemPicker({labels:e.labels,initialItems:r,recommendedItems:i,max:e.max,transformDroppedItems:this._transformDroppedItems.bind(this),canDrop:this._canDrop.bind(this)}).then((function(t){return t&&t.map((function(t){return n.getMetadataColumn(t.idForExpression)}))}))},g._transformDroppedItems=function(t){if(void 0===t&&(t=[]),t&&t.length){var e=this.dashboardApi.getCanvas().getSelectedContentList()[0].getId(),n=this.dashboardApi.getCanvas().getContent(e),r=n&&n.getFeature("Visualization"),i=r.getSlots().getSlotList()[0].getId(),s=r.getSlots().getSlot(i).getDataItemList()[0].getColumnId(),a=["QueryItem","Calculation"];t=t.filter((function(t){return-1!==a.indexOf(t.getObjectType())&&t.getIdForExpression()!==s}))}return t},g._canDrop=function(t){return!(!t||0===t.length)},g.getNavigationPaths=function(t,e){var n=this.getMetadataColumnImpl(t),r=n&&n.getCustomGroupData(),i=r&&r.basedOnMoserObjectId;if(i&&e.length){var s=[],a=e[0].columnId,u=this.getMetadataColumnImpl(a).getCustomGroupData();if(u&&u.groupsList&&u.groupsList.forEach((function(t){e.forEach((function(e){e.label!==t.label&&e.label!==t.placeholder||s.push(t)}))})),s.length&&t&&t!==o.MULTI_MEASURES_SERIES){var c=[this._createCustomGroupNavigationPath(t,i)],l=this.getDrillGroups(i);return l&&l.length&&(c=c.concat(l)),c}return this.getDrillGroups(i)}return t&&this.getDrillGroups(t)},g.getDrillGroups=function(t){return t?this._getModuleAPI().getDrillGroupsForColumn(t):this._getModuleAPI().getDrillGroups()},g._createCustomGroupNavigationPath=function(t,e){var n=u.default.createObjectFactory(),r=n.createDrillGroup(),i=n.createDrillGroupSegment(),s=this._getModuleAPI().getMetadataColumn(t).getMoserObject();i.setRef(t),i.setLabel(s.label),i.setIdentifier(s.identifier),r.addSegment(i);var a=n.createDrillGroupSegment(),o=this._getModuleAPI().getMetadataColumn(e).getMoserObject();return a.setRef(e),a.setLabel(o.label),a.setIdentifier(o.identifier),r.addSegment(a),r},g.createCalculation=function(t,e){var n=this;return this._getModuleAPI()?s.renderCalculationDialog(this._getModuleAPI(),t,!1,{forceGlobal:!0},e).then((function(t){if(t&&t.idForExpression){var e=[];return e.push(n._getModuleAPI().getMetadataColumn(t.idForExpression)),e}})):Promise.reject(l)},g.validateCustomGroup=function(t,e,n){return!!this._getModuleAPI()&&0===s.validateCustomGroup(this._getModuleAPI(),t,e,n).length},g.createCustomGroup=function(t,e,n,r,i){var a=this;return this._getModuleAPI()?s.renderCustomGroupDialog(this._getModuleAPI(),t,e,n,r,i).then((function(t){var e=[];return e.push(a.getMetadataColumn(t.element.idForExpression)),e})):Promise.reject(l)},g.removeCustomGroup=function(t,e){return this._getModuleAPI()?s.removeColumnFromModule(this._getModuleAPI(),t,e):Promise.reject(l)},g.getCustomGroupColumns=function(){return this.sourceModelAPI.getCustomGroupColumns()},g.setCustomGroupColumns=function(t,e){var n=this._applyTransactionToken(e);this.sourceModelAPI.setCustomGroupColumns(t,n)},g.createCustomBinning=function(t,e,n,r){var i=this;return this._getModuleAPI()?s.createCustomBinning(this._getModuleAPI(),t,e,n,r).then((function(t){return i.getMetadataColumn(t.element.idForExpression)})):Promise.reject(l)},g.validateCustomBinning=function(t,e){return!!this._getModuleAPI()&&0===s.validateCustomBinning(this._getModuleAPI(),t,e).length},g.removeCustomBinning=function(t,e){return this._getModuleAPI()?s.removeColumnFromModule(this._getModuleAPI(),t,e):Promise.reject(l)},g.getCustomBinning=function(t){return this._getModuleAPI()?s.getCustomBinning(this._getModuleAPI(),t):null},g.registerUsage=function(t){this.sourcesCollectionManager.registerUsage(t,this.getId())},g.deregisterUsage=function(t){this.sourcesCollectionManager.deregisterUsage(t)},g.isDataSourceUsed=function(){return this.sourcesCollectionManager.isSourceUsed(this.getId())},g.isUsedBy=function(t){return this.getId()===this.sourcesCollectionManager.usesSource(t)},g.isOlapPackage=function(){return this.sourceModelAPI.getIsOlapPackage()||!1},g.getModule=function(){return this.sourceModelAPI.getModule()},g.getModificationTime=function(){return this.sourceModelAPI.getModificationTime()},g.hasJoinError=function(t){return this._joinErrorCache.some((function(e){return e.every((function(e){return-1!==t.indexOf(e)}))}))},g.cacheJoinError=function(t){if(!this.hasJoinError(t))return this._joinErrorCache.push(t)},g.hasJoinedTables=function(t,e){return this._getModuleAPI().tablesHaveJointRelationship(t,e)},g._applyTransactionToken=function(t){var e;return t&&t.transactionId&&(e={payloadData:{undoRedoTransactionId:t.transactionId,transactionToken:t}}),e},g.getMetadataColumnList=function(t){return this.findMetadataColumns("",t)},g._escapeRegex=function(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")},g.findMetadataColumns=function(e,r){var i=this;if(!this._getModuleAPI())throw new Error(l);var s=this._columnsCacheOnType[r]?this._columnsCacheOnType[r]:this._getModuleAPI().getMetadataColumns((function(t){return void 0===r||t.type===r}));this._columnsCacheOnType[r]||(this._columnsCacheOnType[r]=s);var a=e?e.trim():"";if(""!==a){var o=new RegExp(this._escapeRegex(a),"i");s=t.filter(s,(function(t){return t.getLabel().match(o)}))}return t.map(s,(function(t){return new n({metadataColumn:t,sourceModelAPI:i.sourceModelAPI}).getAPI()}))},g.updateWhatIf=function(t,e){var n=this._getModuleAPI().getMetadataColumn(t).getMoserObject();return c.whatIfUtils.updateWhatIf(n,e)},d}();return d.PROTOCOL="CA",d})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5QuerySetAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.newQuery=function(){},e.newQueryResultDefinition=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5QueryAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getName=function(){},e.newSelectionDataItem=function(){},e.newDetailFilter=function(){},e.newQueryHint=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5DataItemAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getName=function(){},e.setAggregate=function(){},e.setRollupAggregate=function(){},e.setSolveOrder=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5DataItem",["@waca/dashboard-common/js/core/APIFactory","./api/V5DataItemAPI"],(function(t,e){return function(){function n(t){var e=t.name,n=t.expression,r=t.aggregate,i=t.rollUpAggregate;this.name=e,this.expression=n,this.solveOrder=null,this.setAggregate(r),this.setRollupAggregate(i)}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.getName=function(){return this.name},r.setAggregate=function(t){this.aggregate=t},r.setSolveOrder=function(t){this.solveOrder=t},r.setRollupAggregate=function(t){this.rollupAggregate=t},r.toJSON=function(){var t={"attr:name":this.name,expression:this.expression.toString()};return this.aggregate&&(t["attr:aggregate"]=this.aggregate),this.rollupAggregate&&(t["attr:rollupAggregate"]=this.rollupAggregate),this.solveOrder&&(t["attr:solveOrder"]=this.solveOrder),t},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5DetailFilterAPI",[],(function(){return function(){function t(){}return t.prototype.setPostAutoAggregation=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5DetailFilter",["@waca/dashboard-common/js/core/APIFactory","./api/V5DetailFilterAPI"],(function(t,e){return function(){function n(t){var e=t.expression;this.expression=e}var r=n.prototype;return r.setPostAutoAggregation=function(t){this.postAutoAggregation=t},r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.toJSON=function(){var t={detailFilter:{filterExpression:this.expression.toString()}};return void 0!==this.postAutoAggregation&&(t.detailFilter["attr:postAutoAggregation"]=this.postAutoAggregation),t},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5QueryHintAPI",[],(function(){return function(){function t(){}return t.prototype.getKey=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5QueryHint",["@waca/dashboard-common/js/core/APIFactory","./api/V5QueryHintAPI"],(function(t,e){return function(){function n(t){var e=t.key,n=t.spec;this.key=e,this.spec=n}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.getKey=function(){return this.key},r.toJSON=function(){var t;switch(this.key){case"dashboard":t={dashboard:{"attr:value":this.spec}};break;case"dataCacheExpiry":(t={dataCacheExpiry:{}}).dataCacheExpiry["attr:value"]=this.spec.dataCacheExpiry;break;case"ignoreFiltersNotApplicable":t={ignoreFiltersNotApplicable:{"attr:value":this.spec}};break;case"preferredModelItems":t={preferredModelItems:this.spec.preferredModelItems.map((function(t){var e={modelItemRef:{}};return e.modelItemRef["attr:refModelItem"]=t,e}))};break;case"suppress":(t={suppress:{}}).suppress["attr:value"]=this.spec.suppress;break;case"autoRefreshTime":(t={autoRefreshTime:{}}).autoRefreshTime["attr:value"]=this.spec.autoRefreshTime}return t},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5Query",["@waca/dashboard-common/js/core/APIFactory","./api/V5QueryAPI","./V5DataItem","./V5DetailFilter","./V5QueryHint"],(function(t,e,n,r,i){return function(){function s(t){var e=t.name,n=t.nameGenerator;this.name=e,this.nameGenerator=n,this.selection=[],this.detailFilters=[],this.queryHints=[]}var a=s.prototype;return a.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},a.getName=function(){return this.name},a.newSelectionDataItem=function(t){var e=t.name,r=void 0===e?this.nameGenerator.newName(this.name+"."):e,i=t.expression,s=t.aggregate,a=t.rollUpAggregate,o=new n({name:r,expression:i,aggregate:s,rollUpAggregate:a});return this.selection.push(o),o.getAPI()},a.newDetailFilter=function(t){var e=t.expression,n=new r({expression:e});return this.detailFilters.push(n),n.getAPI()},a.newQueryHint=function(t){var e=t.key,n=t.spec,r=new i({key:e,spec:n});return this.queryHints.push(r),r.getAPI()},a.toJSON=function(){var t={"attr:name":this.name,source:{model:{}},selection:{dataItem:this.selection.map((function(t){return t.toJSON()}))}};return this.detailFilters.length>0&&(t.detailFilters=this.detailFilters.map((function(t){return t.toJSON()}))),this.queryHints.length>0&&(t.queryHints=this.queryHints.map((function(t){return t.toJSON()}))),t},s}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5QueryResultDefinitionAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.newEdge=function(){},e.isMultiEdge=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5EdgeAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.setMemberCache=function(){},e.newEdgeGroup=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5EdgeGroupAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.newValueSet=function(){},e.newEdgeGroup=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5ValueSetAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.setRefDataItem=function(){},e.addPropertyExpression=function(){},e.setGroupSort=function(){},e.getGroupSort=function(){},e.addGroupBody=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5GroupBodyAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getName=function(){},e.addRefDataItem=function(){},e.addPropertyExpression=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5GroupBody",["@waca/dashboard-common/js/core/APIFactory","./api/V5GroupBodyAPI"],(function(t,e){return function(){function n(t){this.name=""+t,this.dataItems=[],this.propertyExpressions=[]}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.getName=function(){return this.name},r.addRefDataItem=function(t){this.dataItems.push(t)},r.addPropertyExpression=function(t){this.propertyExpressions.push(t)},r.toJSON=function(){var t={"attr:name":""+this.name,dataItemRef:this.dataItems.map((function(t){return{"attr:refDataItem":t.getName()}}))};return this.propertyExpressions.length&&(t.propertyExpressions={propertyExpression:this.propertyExpressions.slice()}),t},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5ValueSet",["@waca/dashboard-common/js/core/APIFactory","./api/V5ValueSetAPI","./V5GroupBody"],(function(t,e,n){return function(){function r(t){var e=t.name,n=t.nameGenerator;this.name=e,this.nameGenerator=n,this.propertyExpressions=[],this.groupBody=null,this.groupSort=null}var i=r.prototype;return i.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},i.setRefDataItem=function(t){this.refDataItem=t},i.addGroupBody=function(t){return void 0===t&&(t=this.nameGenerator.newName()),this.groupBody=new n(t),this.groupBody.getAPI()},i.addPropertyExpression=function(t){this.propertyExpressions.push(t)},i.setGroupSort=function(t){this.groupSort=t},i.getGroupSort=function(){return this.groupSort&&this.groupSort.getAPI()},i.toJSON=function(){var t={"attr:name":this.name,propertyExpressions:{propertyExpression:this.propertyExpressions.slice()}};return this.refDataItem&&(t["attr:refDataItem"]=this.refDataItem.getName()),this.groupSort&&(t.groupSort=this.groupSort.toJSON()),this.groupBody&&(t.groupBody=this.groupBody.toJSON()),t},r}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5EdgeGroup",["@waca/dashboard-common/js/core/APIFactory","./api/V5EdgeGroupAPI","./V5ValueSet"],(function(t,e,n){return function(){function r(t){var e=t.nameGenerator;this.valueSets=[],this.edgeGroups=[],this.nameGenerator=e}var i=r.prototype;return i.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},i.newValueSet=function(t){var e=void 0===t?{}:t,r=e.name,i=void 0===r?this.nameGenerator.newName():r,s=e.refDataItem,a=new n({name:i,nameGenerator:this.nameGenerator});return s&&a.setRefDataItem(s),this.valueSets.push(a),a.getAPI()},i.newEdgeGroup=function(){var t=new r({nameGenerator:this.nameGenerator});return this.edgeGroups.push(t),t.getAPI()},i.toJSON=function(){var t={valueSets:{valueSet:this.valueSets.map((function(t){return t.toJSON()}))}};return this.edgeGroups.length&&(t.edgeGroups={edgeGroup:this.edgeGroups.map((function(t){return t.toJSON()}))}),t},r}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5Edge",["@waca/dashboard-common/js/core/APIFactory","./api/V5EdgeAPI","./V5EdgeGroup"],(function(t,e,n){return function(){function r(t){var e=t.name,n=t.edgeID,r=t.nameGenerator,i=t.isSuppressionEnabled;this.name=e,this.edgeID=n,this.nameGenerator=r,this.edgeGroups=[],this.isSuppressionEnabled=i}var i=r.prototype;return i.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},i.setMemberCache=function(t){this.memberCache=t},i.newEdgeGroup=function(){var t=new n({nameGenerator:this.nameGenerator});return this.edgeGroups.push(t),t.getAPI()},i.suppression=function(){return{"attr:divByZero":"false","attr:nulls":""+this.isSuppressionEnabled,"attr:overflow":"false","attr:zero":"false"}},i.toJSON=function(){var t={"attr:name":this.name,"attr:edgeID":this.edgeID,edgeGroups:{edgeGroup:this.edgeGroups.map((function(t){return t.toJSON()}))}};return this.memberCache&&(t["attr:memberCache"]=this.memberCache),t.edgeSuppression=this.suppression(),t},r}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/NameGenerator",[],(function(){return function(){function t(){this.count=0}return t.prototype.newName=function(t){return void 0===t&&(t=""),""+t+this.count++},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5QueryResultDefinition",["@waca/dashboard-common/js/core/APIFactory","./api/V5QueryResultDefinitionAPI","./V5Edge","./NameGenerator"],(function(t,e,n,r){return function(){function i(t){var e=t.name,n=t.refQuery,i=t.nameGenerator,s=t.isSuppressionEnabled;this.name=e,this.refQuery=n,this.nameGenerator=i,this.edgeIdGenerator=new r,this.edges=[],this.isSuppressionEnabled=s}var s=i.prototype;return s.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},s.newEdge=function(t){var e=void 0===t?{}:t,r=e.name,i=void 0===r?this.nameGenerator.newName():r,s=e.edgeID,a=void 0===s?this.edgeIdGenerator.newName():s,o=e.suppress,u=void 0===o?this.isSuppressionEnabled:o,c=new n({name:i,edgeID:a,nameGenerator:this.nameGenerator,isSuppressionEnabled:u});return this.edges.push(c),c.getAPI()},s.isMultiEdge=function(){return this.edges.length>1},s.toJSON=function(){return{"attr:name":this.name,"attr:refQuery":this.refQuery.getName(),edges:{edge:this.edges.map((function(t){return t.toJSON()}))}}},i}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5QuerySet",["@waca/dashboard-common/js/core/APIFactory","./api/V5QuerySetAPI","./V5Query","./V5QueryResultDefinition","./NameGenerator"],(function(t,e,n,r,i){return function(){function s(){this.queries=[],this.queryResultDefinitions=[],this.nameGenerator=new i}var a=s.prototype;return a.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},a.newQuery=function(t){var e=(void 0===t?{}:t).name,r=void 0===e?this.nameGenerator.newName("Query"):e,i=new n({name:r,nameGenerator:this.nameGenerator});return this.queries.push(i),i.getAPI()},a.newQueryResultDefinition=function(t){var e=t.name,n=void 0===e?null:e,i=t.refQuery,s=t.isSuppressionEnabled;n=n||this.nameGenerator.newName(i.getName()+".");var a=new r({name:n,refQuery:i,nameGenerator:this.nameGenerator,isSuppressionEnabled:s});return this.queryResultDefinitions.push(a),a.getAPI()},a.toJSON=function(){return{"attr:expressionLocale":"en-us",queries:{query:this.queries.map((function(t){return t.toJSON()}))},queryResultDefinitions:{queryResultDefinition:this.queryResultDefinitions.map((function(t){return t.toJSON()}))}}},s}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5ExpressionAPI",[],(function(){return function(){function t(){}return t.prototype.toString=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/expression/V5FilterExpression",["@waca/dashboard-common/js/core/APIFactory","../api/V5ExpressionAPI"],(function(t,e){return function(){function n(t){var e=t.filterExpression;this.filterExpression=e}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.toString=function(){return this.filterExpression},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/expression/V5ColumnExpression",["@waca/dashboard-common/js/core/APIFactory","../api/V5ExpressionAPI"],(function(t,e){return function(){function n(t){var e=t.columnId;this.columnId=e}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.toString=function(){return this.columnId},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/expression/V5ExpressionConstant",[],(function(){var t={topcount:"topCount",toppercent:"topPercent",bottomcount:"bottomCount",bottompercent:"bottomPercent"},e={CAPTION:"caption",CHILDREN:"children",COUNT:"count",DESCENDANTS:"descendants",EXCEPT:"except",HEAD:"head",HIERARCHIZE:"hierarchize",MEMBERS:"members",MEMBER:"member",ORDER:"order",PARENT:"parent",ROOTMEMBERS:"rootMembers",SET:"set",UNION:"union",HIERARCHY:"hierarchy",CURRENTMEMBER:"currentmember"},n={none:"none",sum:"total",avg:"average",min:"minimum",max:"maximum",count:"count",countdistinct:"countDistinct"},r="::";return new function(){this.functionNames=e,this.topBottomOperations=t,this.aggregateMap=n,this.generatedIdSeparator=r}})),define("@dashboard-features/dssQueryService/js/query/v2/v5/expression/V5RankFilterExpression",["@waca/dashboard-common/js/core/APIFactory","../api/V5ExpressionAPI"],(function(t,e){return function(){function n(t){var e=t.sortOrder,n=t.rankReference,r=t.number;this.sortOrder=e,this.rankReference=n,this.number=r}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.toString=function(){return"rank(["+this.rankReference+"] "+this.sortOrder+") <= "+this.number},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/dashboardToV5/NoncontextualTopBottomExpressionHelper.v2",["../v5/expression/V5ColumnExpression","../v5/expression/V5RankFilterExpression"],(function(t,e){var n={topcount:"DESC",bottomcount:"ASC"};return function(){function t(t){var e=t.definition,n=t.dataItem,r=t.queryState;this.supportsNonContextualTopBottom=e.getSupportsNonContextualTopBottom(),this.dataItem=n,this.queryState=r}var r=t.prototype;return r.validateAndWarn=function(){if(!this.supportsNonContextualTopBottom&&this._getNonContextualTopBottom()){var t=this.dataItem.getMetadataColumn();return this.queryState.warnings.push({resourceId:"nonCtxTopBottomInvalid",params:{columnName:t.getLabel()}}),!1}return!0},r.getExpression=function(){var t=null,r=this.supportsNonContextualTopBottom&&this._getNonContextualTopBottom();return r&&(t=new e({sortOrder:n[r.type],rankReference:this.dataItem.getId(),number:r.value}).getAPI()),t},r._getNonContextualTopBottom=function(){var t=this.dataItem.getTopBottom();return t&&!t.context?t:null},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/dashboardToV5/FilterHelper.v2",["underscore","./NoncontextualTopBottomExpressionHelper.v2","@waca/dashboard-livewidget/js/filters/FilterSpecHelper"],(function(t,e,n){return function(){function r(t,e){this.definition=t,this.queryState=e,this.dataItemMap=this._initializeDataItemMap()}r.getFilterId=function(t){var e=t.getColumnId(),r=t.getAggregation();return n.getFilterId(e,r)};var i=r.prototype;return i._buildEdgeNullValueExpression=function(t,e,n){if(!t.columnId||!this.definition.getDataSource())return null;var r=this.definition.getDataSource().getMetadataColumn(t.columnId),i=r&&r.isOlapColumn();if(!t.valueDataItem&&"notin"===t.operator&&!i&&this._getValuesExcludingNull(t.values).length===t.values.length){var s=this._buildInOperationExpression(t,e,n);return s?"( "+t.columnId+" is null OR NOT ("+s+") )":s}return null},i._combineUserValuesAndConditions=function(t,e,n){var r=null;return r=t&&e?t+" OR "+e:t||e,n&&(r="("+r+") AND NOT ("+n+")"),r},i._getValueType=function(t){return t.valueType||t.type},i._getColumnId=function(t){var e=t.columnId||t.itemId,n=this.definition.getDataSource().getMetadataColumn(e);return n&&n.isProperty()&&"display"!==this._getValueType(t)&&(e=n.getParent().getId()),e},i._buildInOperationExpression=function(t,e,n){var r=this._filterSupportsSetSelection(t,e),i=null,s=null,a=null;if(t.values&&0===t.values.length&&t.valueDataItem)return this.definition.getDataSource().getMetadataColumn(t.columnId).getReferencedHierarchyId()+" in ("+t.valueDataItem+")";var o=this._getColumnId(t);return t.values&&t.values.length>0&&!r&&(i=this._convertColumnInValuesToV5(t.values,this._getValueType(t),o,e,n)),t.excludedValues&&t.excludedValues.length>0&&!r&&(s=this._convertColumnInValuesToV5(t.excludedValues,this._getValueType(t),o,e,n)),t.conditions&&(a=this._convertConditionsToV5(t,e,n)),this._combineUserValuesAndConditions(i,a,s)},i._convertDiscreteValueFilter=function(t,e,n){var r=null;switch(t.operator){case"in":r=this._buildInOperationExpression(t,e,n);break;case"notin":(r=this._buildEdgeNullValueExpression(t,e,n))||(r=(r=this._buildInOperationExpression(t,e,n))?"NOT ("+r+")":r)}return r},i._isDrilledUpOrDown=function(t){return!!(t&&(t.getDrillDownValue()||t.getDrillUpValue()))},i._filterSupportsSetSelection=function(t,e){var n=t.columnId||t.itemId,r=this.definition.getDataSource().getMetadataColumn(n);if(!r.isOlapColumn()||r.isProperty()||"display"===this._getValueType(t))return!1;if(e>0)return!1;if(t.conditions)return!1;var i=this.definition.getAllDataItemsList();if(i.some((function(t){return t.getUnion().getDataItemList().length})))return!1;var s=i.find((function(e){return e.getColumnId()===t.columnId}));return!this._isDrilledUpOrDown(s)&&!!s},i.convertFiltersToV5=function(){var t=this,n=this.definition.getFilters(),r=this._addDataItemsForNonProjectedRangeFilters(),i=[];n.forEach((function(e){var n=t._addClauseToV5Expression(e);n&&i.push({filterExpression:n,preOrPost:e.preOrPost})}));var s=!0;return this.definition.getAllDataItemsList().forEach((function(n){if(s){var r=new e({definition:t.definition,dataItem:n,queryState:t.queryState});if(s=s&&r.validateAndWarn()){var a=r.getExpression();a&&i.push({filterExpression:a.toString(),preOrPost:"post"})}}})),{detailFilters:i,filterDataItems:r}},i._getValuesExcludingNull=function(e){var n=t.without(e,null,"null");return n=t.filter(n,(function(t){return null!==t.u&&null!==t.d&&"null"!==t.u&&"null"!==t.d})),n=t.pluck(n,"display"===this.type?"d":"u")},i._convertColumnInValuesToV5=function(t,e,n,r,i){var s=null,a=this._getValuesExcludingNull(t);if(a.length<t.length){var o=n+" is null";if(a.length>0)s="("+o+" OR "+this._convertValuesToV5(a,e,n)+")";else s=o}else if(s=this._convertValuesToV5(t,e,n),i){var u=this.definition.getDataSource().getMetadataColumn(n);u&&u.isOlapColumn()||(s="("+n+" is not null AND "+s+")")}return s},i._convertValuesToV5=function(t,e,n){var r=this,i=!1,s=n&&this.definition.getDataSource().getMetadataColumn(n),a=s&&"fact"===s.getType(),o=t.map((function(t){var o;return e&&"display"===e||a?(o=void 0!==t.d?t.d:t,s&&s.isNumericDataType()||(o="lower('"+r._getEscapeSingleQuote(o)+"')",i=!0)):(o=void 0!==t.u?t.u:t,t.d&&t.d===t.u&&t.u!==n&&(s&&s.isNumericDataType()||(o="'"+o+"'"))),o})).join(";"),u="display"===e?this._getCaption(n):n;return i?"lower("+u+") in ("+o+")":u+" in ("+o+")"},i._convertConditionsToV5=function(t,e,n){return t.conditions.or?this._convertOperatorConditionToV5("OR",t.conditions.or,e+1,n):t.conditions.and?this._convertOperatorConditionToV5("AND",t.conditions.and,e+1,n):t.conditions.not?"NOT ("+this._addClauseToV5Expression(t.conditions.not,e+1,n)+")":this._addClauseToV5Expression(t.conditions,e+1,n)},i._convertOperatorConditionToV5=function(t,e,n,r){var i=this;return e.map((function(t){return i._addClauseToV5Expression(t,n,r)})).map((function(t){return"("+t+")"})).join(" "+t+" ")},i._addClauseToV5Expression=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=!1);var r=null;if(t.not)return"NOT "+(r=this._addClauseToV5Expression(t.not,e+1,n));var i=this.definition.getAllDataItemsList().find((function(e){return e.getColumnId()===t.itemId||e.getColumnId()===t.columnId})),s=i&&i.getMetadataColumn();switch(t.operator){case void 0:r=t.columnId;break;case"in":case"notin":r=this._convertDiscreteValueFilter(t,e,n);break;case"between":case"notbetween":case"lt":case"gt":case"lte":case"gte":r=this._convertRangeFilter(t);break;case"and":case"or":case"not":r=this._convertDataPointFilter(t,e,n);break;case"beginswith":case"endswith":case"containsignorecase":if(t.values.length>0){var a;"beginswith"===t.operator?a="starts with":"endswith"===t.operator?a="ends with":"containsignorecase"===t.operator&&(a="contains");var o=t.values[0];s&&s.isNumericDataType()?r="cast("+this._getCaption(t.itemId)+", varchar(50)) "+a+" '"+o+"'":(o=this._getEscapeSingleQuote(o),r=t.ignoreCase?"lower("+this._getCaption(t.itemId)+") "+a+" lower('"+o+"')":this._getCaption(t.itemId)+" "+a+" '"+o+"'")}break;default:throw new Error("operator "+t.operator+" is not supported.")}return r},i._initializeDataItemMap=function(){var e=this,n={};if(this.definition&&this.definition.getDataItemSetList){var i=this.definition.getDataItemSetList();t.each(i,(function(i){t.each(i.getDataItemList(),(function(t){if("fact"===t.getType()){var i=r.getFilterId(t);n[i]||(n[i]=[]),n[i].push({dataItem:t,datasetId:e.definition.getDataSource().getId()})}}))}))}return n},i._addDataItemsForNonProjectedRangeFilters=function(){var t=this,e=[],r={};this.definition.getAllDataItemsList().forEach((function(t){"fact"===t.getType()&&(r[t.getAggregation()+t.getColumnId()]=1)}));var i=this.definition.getFilters(),s=this.definition.getDataSource();return i.forEach((function(i){var a=i.aggregationType+i.columnId;if(i.aggregationType&&!r[a]&&i.aggregationType!==s.getMetadataColumn(i.columnId).getDefaultAggregation()){r[a]=1;var o=n.getFilterId(i.columnId,i.aggregationType),u="_nonProjectedItemForFilter_"+e.length;e.push({id:u,columnId:i.columnId,aggregationType:i.aggregationType}),t.dataItemMap[o]||(t.dataItemMap[o]=[]),t.dataItemMap[o].push({dataItem:{getId:function(){return u},getAggregation:function(){return i.aggregationType}},datasetId:t.definition.getDataSource().getId()})}})),e},i._getAssociatedDataItem=function(e,n){var r=this.dataItemMap,i=null;return r[e.id]&&(i=t.find(r[e.id],(function(t){return t.datasetId===n&&t.dataItem.getAggregation()===e.aggregationType}))),i&&i.dataItem||null},i._convertRangeFilter=function(t){var e=null,n=this._getAssociatedDataItem(t,this.definition.getDataSource().getId()),r=null;switch(r=n?n.getId():t.columnId||t.itemId,t.operator){case"between":e=r+" in_range {"+t.values[0].u+":"+t.values[1].u+"}";break;case"notbetween":e="NOT ("+r+" in_range {"+t.values[0].u+":"+t.values[1].u+"})";break;case"lt":e=r+" < "+t.values[0].u;break;case"lte":e=r+" <= "+t.values[0].u;break;case"gt":e=r+" > "+t.values[0].u;break;case"gte":e=r+" >= "+t.values[0].u}if(null===e)throw new Error("unknown range operator "+t.operator);return e},i._convertDataPointFilter=function(t,e,n){var r=this,i="";return"not"===t.operator?(n=!0,i=this._addClauseToV5Expression(t.values[0],e+1,n),n=!1,"NOT ("+i+")"):(t.values.forEach((function(s,a){var o=r._addClauseToV5Expression(s,e+1,n);if(o){var u=a===t.values.length-1;i+=u?""+o:o+" "+t.operator+" "}})),i?"("+i+")":i)},i._getCaption=function(t){var e=this.definition.getAllDataItemsList().find((function(e){return e.getColumnId()===t}));return e&&e.getMetadataColumn().isLevel()?"caption("+t+")":t},i._getEscapeSingleQuote=function(t){return"string"==typeof t?t.replace(/'/g,"''"):t},i._getRangeFilters=function(t,e){if(t.not)return this._getRangeFilters(t.not,e);switch(t.operator){case"between":case"notbetween":case"lt":case"gt":case"lte":case"gte":e.push(t)}},i.getRangeFilters=function(){var t=this,e=[];return this.definition.getFilters().forEach((function(n){t._getRangeFilters(n,e)})),e},r}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5RoleValueAPI",[],(function(){function t(t){return"RoleValue('"+t+"')"}return function(){function e(){}return _createClass(e,null,[{key:"VALUES",get:function(){return{MEMBER_UNIQUE_NAME:t("_memberUniqueName"),MEMBER_CAPTION:t("_memberCaption"),LEVEL_NUMBER:t("_levelNumber"),LEVEL_UNIQUE_NAME:t("_levelUniqueName"),PARENT_UNIQUE_NAME:t("_parentUniqueName"),HIERARCHY_UNIQUE_NAME:t("_hierarchyUniqueName")}}}]),e}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/expression/V5FunctionExpression",["@waca/dashboard-common/js/core/APIFactory","../api/V5ExpressionAPI"],(function(t,e){return function(){function n(t){var e=t.functionName,n=t.functionParamList;this.functionName=e,this.functionParamList=n}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.toString=function(){return this.functionName+"("+this.functionParamList.join(";")+")"},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5GroupSortAPI",[],(function(){return function(){function t(){}return t.prototype.newSortItem=function(){},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/api/V5SortItemAPI",[],(function(){return function(){}})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5SortItem",["@waca/dashboard-common/js/core/APIFactory","./api/V5SortItemAPI"],(function(t,e){return function(){function n(t){var e=t.sort,n=t.name;this.sort=e,this.name=n}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.toJSON=function(){return{"attr:refDataItem":this.name,"attr:sortOrder":this.sort}},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/V5GroupSort",["@waca/dashboard-common/js/core/APIFactory","./api/V5GroupSortAPI","./V5SortItem"],(function(t,e,n){return function(){function r(){this.sortItems=[]}var i=r.prototype;return i.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},i.newSortItem=function(t){var e=t.name,r=t.sort,i=new n({name:e,sort:r});return this.sortItems.push(i),i.getAPI()},i.toJSON=function(){return{sortItem:this.sortItems.map((function(t){return t.toJSON()}))}},r}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/expression/V5ContextualTopBottomExpression",["@waca/dashboard-common/js/core/APIFactory","../api/V5ExpressionAPI"],(function(t,e){return function(){function n(t){var e=t.topBottomOperation,n=t.setExpression,r=t.number,i=t.contextColumnId;this.topBottomOperation=e,this.setExpression=n,this.number=r,this.contextColumnId=i}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.toString=function(){return this.topBottomOperation+"("+this.setExpression+"; "+this.number+"; "+this.contextColumnId+")"},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/expression/V5CalculationExpression",["@waca/dashboard-common/js/core/APIFactory","../api/V5ExpressionAPI"],(function(t,e){return function(){function n(t){var e=t.operator,n=t.operands;this.operator=e,this.operands=n}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.toString=function(){var t;switch(this.operator){case n.OPERATORS.ROWCOUNT:t="count(all "+this.operands[0]+")";break;case n.OPERATORS.SUMSQUARE:t="variance-pop("+this.operands[0]+") * count(all "+this.operands[0]+")"}return t||""},_createClass(n,null,[{key:"OPERATORS",get:function(){return{ROWCOUNT:"rowCount",SUMSQUARE:"sumSqr"}}}]),n}()})),define("@dashboard-features/dssQueryService/js/query/v2/dashboardToV5/DataItemExpressionHelper.v2",["underscore","../v5/expression/V5ColumnExpression","../v5/expression/V5ContextualTopBottomExpression","../v5/expression/V5FunctionExpression","../v5/expression/V5CalculationExpression","../v5/expression/V5ExpressionConstant"],(function(t,e,n,r,i,s){return function(){function a(t){var e=t.dataItem,n=t.definition,r=t.operator,i=void 0===r?null:r;this.dataItem=e,this.definition=n,this.operator=i,this.expandEnabled=n.getExpandEnabled()}var o=a.prototype;return o.getExpression=function(){var t=this.dataItem.getMetadataColumn(),e=this.dataItem.getDrillDownValue(),r=this.dataItem.getDrillUpValue(),i=this.dataItem.getIsolatedValue(),a=this._getSetExpression(t,e,r,i),o=this.dataItem.getTopBottom();if(o&&o.context&&(a=new n({topBottomOperation:s.topBottomOperations[o.type],setExpression:a,number:o.value,contextColumnId:o.context.itemId}).getAPI()),this.expandEnabled&&this.dataItem.getUnion&&this.dataItem.getUnion().getDataItemList().length){var u=this._getExpandUnionExpression(this.dataItem.getUnion());if(u){var c=this.dataItem.getSort();a=c&&c.type?this._buildOrderExpression(this._buildHierarchizeExpression([a.toString(),u]).toString(),this._buildCaptionExpression(this.dataItem.getColumnId()).toString(),c.type):this._buildHierarchizeExpression([a.toString(),u])}}return a},o._getSetExpression=function(t,e,n,r){var s=null;if(this.operator)s=new i({operator:this.operator,operands:[this.dataItem.getColumnId()]}).getAPI();else if(r)s=this._buildSetExpression([r]);else if(e||n)s=e?this._buildChildrenExpression(e):this._buildDrillUpExpression(n,t);else if(t&&t.isHierarchy()){s=t.isSingleRootHierarchy()?this._buildChildrenExpression(t.getRootMember()):this._buildRootMembersExpression(t.getId());var a=this._buildSetIncludeExcludeExpression(s.toString());s=a||s}else{var o=this.dataItem.getColumnId(),u=this._buildMembersExpression(o);s=this._buildSetIncludeExcludeExpression(u.toString())||this._buildColumnExpression(o)}return s},o._buildColumnExpression=function(t){return new e({columnId:t}).getAPI()},o._getExpandUnionExpression=function(t){var e,n,r=this;return t.getDataItemList().forEach((function(t,i){var s=t.getUnion().getDataItemList().length>0,a=t.getDrillDownValue();s&&(n=r._getExpandUnionExpression(t.getUnion())),a&&(n=n?"union("+n+";children("+a+"))":"children("+a+")"),s||a||(n=t.getColumnId()),e=0===i?n:"union("+e+";"+n+")"})),e},o._buildChildrenExpression=function(t){return new r({functionName:s.functionNames.CHILDREN,functionParamList:[t]}).getAPI()},o._buildRootMembersExpression=function(t){return new r({functionName:s.functionNames.ROOTMEMBERS,functionParamList:[t]}).getAPI()},o._buildDrillUpExpression=function(t,e){var n=new r({functionName:s.functionNames.PARENT,functionParamList:[t]}).getAPI(),i=new r({functionName:s.functionNames.CHILDREN,functionParamList:[""+n]}).getAPI(),a=new r({functionName:s.functionNames.ROOTMEMBERS,functionParamList:[e.getId()]}).getAPI(),o="if(count(1 within set "+i+") = 0)then(count(1 within set "+a+"))else(0)",u=new r({functionName:s.functionNames.HEAD,functionParamList:[""+a,o]}).getAPI();return new r({functionName:s.functionNames.UNION,functionParamList:[""+i,""+u]}).getAPI()},o._buildHierarchizeExpression=function(t){var e=new r({functionName:s.functionNames.UNION,functionParamList:t}).getAPI();return new r({functionName:s.functionNames.HIERARCHIZE,functionParamList:[e.toString()]}).getAPI()},o._buildCaptionExpression=function(t){return new r({functionName:s.functionNames.CAPTION,functionParamList:[t]}).getAPI()},o._buildOrderExpression=function(t,e,n){return new r({functionName:s.functionNames.ORDER,functionParamList:[t.toString(),e.toString(),n]}).getAPI()},o._buildSetExpression=function(t){return new r({functionName:s.functionNames.SET,functionParamList:t}).getAPI()},o._buildMembersExpression=function(t){return new r({functionName:s.functionNames.MEMBERS,functionParamList:[t]}).getAPI()},o._buildExceptExpression=function(t,e){var n=this._buildSetExpression(e);return new r({functionName:s.functionNames.EXCEPT,functionParamList:[t,n.toString()]}).getAPI()},o._buildSetIncludeExcludeExpression=function(e){var n=this.dataItem.getMetadataColumn(),r=this.definition.getAllDataItemsList().some((function(t){return t.getUnion().getDataItemList().length}));if(n.isOlapColumn()&&!n.isProperty()&&!r){var i=this.dataItem.getColumnId(),s=this.definition.getFilters().filter((function(t){var e=t.columnId;return i===e}));if(!s.find((function(t){return!!t.conditions}))){var a=[],o=[];s.forEach((function(t){var e=t.operator,n=t.values;"in"===e?a.push(n.map((function(t){return t.u}))):"notin"===e&&o.push(n.map((function(t){return t.u})))}));var u=t.intersection.apply(t,a),c=t.union.apply(t,o);if(u.length&&c.length&&(u=t.difference(u,c),c=[]),u.length)return this._buildSetExpression(u);if(c.length)return this._buildExceptExpression(e,c)}}},a}()})),define("@dashboard-features/dssQueryService/js/query/v2/dashboardToV5/SortHelper.v2",[],(function(){return function(){function t(t){var e=t.dataItem,n=t.definition;this.dataItem=e,this.definition=n,this.sortItem=""}return t.prototype.determineSort=function(){var t=!this.dataItem.hasDefaultSort(),e=this.dataItem.getTopBottom();if(!t&&e)return null;var n=this.dataItem.getSort(),r=n&&n.type?n.type:null;return r?(this.sortItem="asc"===r?"ascending":"descending",this.sortItem):void 0},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/v5/expression/V5StringExpression",["@waca/dashboard-common/js/core/APIFactory","../api/V5ExpressionAPI"],(function(t,e){return function(){function n(t){var e=t.string;this.string=e}var r=n.prototype;return r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.toString=function(){var t=this.string;return"string"!=typeof t?t:"'"+t.replace(/'/g,"''")+"'"},n.toString=function(t){return new n({string:t}).getAPI().toString()},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/QueryCalculationHelper.v2",["./v5/expression/V5ExpressionConstant","./v5/expression/V5FunctionExpression"],(function(t,e){var n;return(n=function(){function n(){}return n.generateQueryCalculationId=function(e,n){return""+n+t.generatedIdSeparator+e.getId()},n.decodeGeneratedCalculationId=function(e){var n=e.split(t.generatedIdSeparator);return 2===n.length?{dataItemId:n[1],calculationType:n[0]}:{}},n.generateNonMeasureCountExpression=function(n,r){var i=r.getMetadataColumn();i.isProperty()&&(i=i.getParent());var s="["+r.getId()+"]";if(i.isLevel()){var a=i.getParent();if(n.getDataItemSetList().some((function(t){return!t.isMeasureItemSet()&&t.getAllDataItemsList().some((function(t){var e=t.getMetadataColumn();return e.isLevel()&&e.getParent().getId()===a.getId()}))}))){var o=new e({functionName:t.functionNames.HIERARCHY,functionParamList:[a.getId()]}).getAPI(),u=new e({functionName:t.functionNames.CURRENTMEMBER,functionParamList:[o]}).getAPI();s=new e({functionName:t.functionNames.DESCENDANTS,functionParamList:[u,i.getId()]}).getAPI()}}return new e({functionName:t.functionNames.COUNT,functionParamList:["1 within set "+s]})},n}()).COUNT="count",n})),define("@dashboard-features/dssQueryService/js/query/v2/dashboardToV5/DataItemSetHelper.v2",["../v5/api/V5RoleValueAPI","../v5/expression/V5FunctionExpression","../v5/V5GroupSort","./DataItemExpressionHelper.v2","./SortHelper.v2","../v5/expression/V5ExpressionConstant","../v5/expression/V5StringExpression","./FilterHelper.v2","../QueryCalculationHelper.v2"],(function(t,e,n,r,i,s,a,o,u){return function(){function c(t){var e=t.definition,n=t.v5QueryResultDefinition,r=t.v5Query;this._definition=e,this._v5QueryResultDefinition=n,this._v5Query=r,this._summariesEnabled=e.getSummariesEnabled(),this._isMultiEdgeQuery=e.getDataItemSetList().length>1}var l=c.prototype;return l.convertDataItemSetListToV5=function(t){return this._isMultiEdgeQuery?this._convertMultiEdgeDataItemSetListToV5(t):this._convertSingleEdgeDataItemSetListToV5(t)},l._convertSingleEdgeDataItemSetListToV5=function(t){var e=this,n=this._isSummaryNotSupported();t.forEach((function(t){e.convertDataItemSetToV5({dataItemSet:t,summaryNotSupported:n})}))},l._shouldPlaceMeasuresOnOwnEdgeAfterCategories=function(){return 1===this._definition.getMeasureCount({includeCalculations:!0})||!this._definition.getPropertyValue("nestedEdgeMeasuresEnabled")},l._shouldPlaceMeasuresOnOwnEdgeBeforeCategories=function(t,e){return!t&&(1===e.filter((function(t){return!t.isMeasureItemSet()})).length||void 0)},l._convertMultiEdgeDataItemSetListToV5=function(t){var e=this,n=[],r=[],i=[],s=this._shouldPlaceMeasuresOnOwnEdgeAfterCategories(t),a=this._shouldPlaceMeasuresOnOwnEdgeBeforeCategories(s,t);t.forEach((function(t){t.isMeasureItemSet()&&(s?i.push(t):a?r.push(t):n.push(t))}));var o=this._isSummaryNotSupported();r.length>0&&this.convertMeasureItemSetsToV5(r),t.forEach((function(t){t.isMeasureItemSet()||(e.convertDataItemSetToV5({dataItemSet:t,summaryNotSupported:o,measureItemSetsToNest:n}),n=null)})),i.length>0&&this.convertMeasureItemSetsToV5(i)},l._createV5Edge=function(){return this._isMultiEdgeQuery&&!this._definition.getPropertyValue("nestedEdgeMeasuresEnabled")&&this._definition.getMeasureCount({includeCalculations:!0})>1?this._v5QueryResultDefinition.newEdge({suppress:!1}):this._v5QueryResultDefinition.newEdge()},l.convertDataItemSetToV5=function(t){var e=this,n=t.dataItemSet,r=t.summaryNotSupported,i=t.measureItemSetsToNest,s=void 0===i?null:i;!function t(n,i){var a,o=n.getDataItemList(),u=n.getDataItemSetList();if(n.isDetailItemSet()){var c=e._processDetailItemSet({v5EdgeGroupContainer:i,dataItemSet:n}).v5EdgeGroup;a=c}else o.forEach((function(t){var n=(e._isOlapProperty(t)?e._processOlapProperties({v5EdgeGroupContainer:i,dataItem:t}):e._processDataItem({v5EdgeGroupContainer:i,dataItem:t})).v5EdgeGroup;a||(a=n)}));e._summariesEnabled&&!r&&e._dataItemSetSupportsSummary(n)&&e._processSummaryItem({v5EdgeGroupContainer:i,dataItem:o[0],measureItemSetsToNest:s}),u.forEach((function(e){t(e,a)})),s&&s.length>0&&0===n.getDataItemSetList().length&&e._convertMeasureItemSetsToV5(s,a)}(n,this._createV5Edge())},l._dataItemSetSupportsSummary=function(t){return!t.isMeasureItemSet()&&(!this._isExpanded(t)&&(!this._containsNamedSet(t)&&!this._containsHierarchyProperty(t)))},l.convertMeasureItemSetsToV5=function(t){var e=this._v5QueryResultDefinition.newEdge();return this._convertMeasureItemSetsToV5(t,e)},l._convertMeasureItemSetsToV5=function(t,e){var n,r,i=this;r=e,(n=t).forEach((function(t){t.getDataItemList().forEach((function(t){if(i._isOlapNonMeasureAggregate(t)){var e=i._createOlapNonMeasureAggregateItemPair(t),n=r.newEdgeGroup();i._addValueSet(t,e,n)}else i._processDataItem({v5EdgeGroupContainer:r,dataItem:t})}))})),n.forEach((function(t){t.getDataItemList().forEach((function(e){var n=t.getCalculationList(e.getId()).map((function(t){return t.operator}));i._processCalculations(r,e,n)}))}))},l._processSummaryItem=function(t){var e=t.v5EdgeGroupContainer,n=t.dataItem,r=t.measureItemSetsToNest,i=void 0===r?null:r,s=e.newEdgeGroup(),a=this._v5Query.newSelectionDataItem({name:"summary:"+n.getId(),expression:"aggregate(currentMeasure within detail ["+n.getId()+"])"});a.setSolveOrder("1"),s.newValueSet({refDataItem:a}),i&&i.length>0&&this._convertMeasureItemSetsToV5(i,s)},l._processCalculations=function(t,e,n){var r=this;n.forEach((function(n){var i=t.newEdgeGroup(),s=r._v5Query.newSelectionDataItem({name:n+":"+e.getId(),expression:r._generateExpression(e,n),aggregate:"calculated"});i.newValueSet({refDataItem:s})}))},l._isOlapNonMeasureAggregate=function(t){var e=t.getMetadataColumn();return e&&e.isOlapColumn()&&"attribute"===e.getType()&&"fact"===t.getType()},l._isOlapProperty=function(t){var e=t.getMetadataColumn();return e&&e.isProperty()},l._createOlapNonMeasureAggregateItemPair=function(t){var n=this._computeAggregate(t);this._v5Query.newSelectionDataItem({name:""+t.getId(),expression:this._generateExpression(t),aggregate:n});var r=u.generateNonMeasureCountExpression(this._definition,t),i=new e({functionName:s.functionNames.MEMBER,functionParamList:[r.toString(),a.toString(t.getColumnId()),a.toString(t.getLabel())]}).getAPI();return this._v5Query.newSelectionDataItem({name:u.generateQueryCalculationId(t,u.COUNT),aggregate:this._getV5DataItemAggregate("none"),rollUpAggregate:this._getV5DataItemAggregate("none"),expression:i.toString()})},l._getV5DataItemAggregate=function(t){return s.aggregateMap[t]||t},l._computeAggregate=function(t){return"attribute"===t.getType()&&"fact"===t.getMetadataColumn().getType()?"none":this._getV5DataItemAggregate(t.getAggregation())},l._isSummaryNotSupportedForRangeFilter=function(t){var e=this._definition.getAllDataItemsList().find((function(e){return e.getColumnId()===t.itemId||e.getColumnId()===t.columnId}));return e&&"countDistinct"===this._computeAggregate(e)&&"fact"===e.getType()&&"attribute"===e.getMetadataColumn().getType()},l._isOlapColumn=function(t){var e=t.getMetadataColumn();return e&&e.isOlapColumn()},l._isSummaryNotSupported=function(){var t=this;return this._definition.getAllDataItemsList().find((function(e){return t._isOlapColumn(e)}))?this._definition.getAllDataItemsList().some((function(e){return"countDistinct"===t._computeAggregate(e)&&"fact"===e.getType()&&"attribute"===e.getMetadataColumn().getType()})):new o(this._definition,{}).getRangeFilters().some((function(e){return t._isSummaryNotSupportedForRangeFilter(e)}))},l._processDataItem=function(t){var e=t.v5EdgeGroupContainer,n=t.dataItem,r=this._v5Query.newSelectionDataItem({name:n.getId(),expression:this._generateExpression(n),aggregate:this._computeAggregate(n)}),i=e.newEdgeGroup();return this._addValueSet(n,r,i),{v5DataItem:r,v5EdgeGroup:i}},l._processOlapProperties=function(t){var e=t.v5EdgeGroupContainer,n=t.dataItem,r=n.getMetadataColumn(),i=r.getParent().getId(),s=this._v5Query.newSelectionDataItem({name:n.getId(),expression:""+i,aggregate:this._computeAggregate(n)}),a=this._v5Query.newSelectionDataItem({name:r.getLabel(),expression:this._generateExpression(n),aggregate:this._computeAggregate(n)}),o=e.newEdgeGroup();return this._addValueSet(n,s,o,a),{v5DataItem:a,v5EdgeGroup:o}},l._processDetailItemSet=function(t){var e=this,n=t.v5EdgeGroupContainer,r=t.dataItemSet,i=n.newEdgeGroup(),s=i.newValueSet(),a=s.addGroupBody();return r.getDataItemList().forEach((function(t){if(e._isOlapNonMeasureAggregate(t)){var n=e._createOlapNonMeasureAggregateItemPair(t);a.addRefDataItem(n)}else{var r=e._v5Query.newSelectionDataItem({name:t.getId(),expression:e._generateExpression(t),aggregate:e._computeAggregate(t)});a.addRefDataItem(r)}})),this._addSortsOnDataItemSet({dataItemSet:r,v5ValueSet:s}),this._populatePropertyExpressions({v5PropertyExpressionContainer:a}),{v5EdgeGroup:i}},l._addValueSet=function(t,e,n,r){var i=n.newValueSet({refDataItem:e});r&&i.addGroupBody().addRefDataItem(r);this._addSortOnDataItem({dataItem:t,v5ValueSet:i,groupDataItem:r}),this._populatePropertyExpressions({v5PropertyExpressionContainer:i})},l._populatePropertyExpressions=function(e){var n=e.v5PropertyExpressionContainer;n.addPropertyExpression(t.VALUES.MEMBER_UNIQUE_NAME),n.addPropertyExpression(t.VALUES.MEMBER_CAPTION),n.addPropertyExpression(t.VALUES.LEVEL_NUMBER),n.addPropertyExpression(t.VALUES.LEVEL_UNIQUE_NAME),n.addPropertyExpression(t.VALUES.PARENT_UNIQUE_NAME),n.addPropertyExpression(t.VALUES.HIERARCHY_UNIQUE_NAME)},l._addSortsOnDataItemSet=function(t){var e=this,n=t.dataItemSet,r=t.v5ValueSet,i=[],s=[];n.getDataItemList().forEach((function(t){return t.hasDefaultSort()?s.push(t):i.push(t)})),i.forEach((function(t){return e._addSortOnDataItem({dataItem:t,v5ValueSet:r})})),s.forEach((function(t){return e._addSortOnDataItem({dataItem:t,v5ValueSet:r})}))},l._addSortOnDataItem=function(t){var e=t.dataItem,r=t.v5ValueSet,s=t.groupDataItem;if(!(e.getUnion().getDataItemList().length>0)){var a=new i({dataItem:e,definition:this._definition}).determineSort();if(a){var o=this._isOlapProperty(e)&&s&&s.getName(),u=r.getGroupSort();u||(u=new n,r.setGroupSort(u)),u.newSortItem({sort:a,name:o||e.getId()})}}},l._generateExpression=function(t,e){return new r({dataItem:t,definition:this._definition,operator:e}).getExpression()},l._isExpanded=function(t){return this._definition.getExpandEnabled()&&t&&t.getAllDataItemsList().some((function(t){return t.getUnion().getDataItemList().length}))},l._containsNamedSet=function(t){return t.getAllDataItemsList().some((function(t){return t.getMetadataColumn().isNamedSet()}))},l._containsHierarchyProperty=function(t){return t.getAllDataItemsList().some((function(t){var e=t.getMetadataColumn();return e.isProperty()&&e.getParent().isHierarchy()}))},c}()})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/DataQueryResultItemSet",["@waca/dashboard-livewidget/js/features/dashboard/queryService/api/QueryResultAPI","@waca/dashboard-livewidget/js/features/dashboard/queryService/ResultItem","../QueryCalculationHelper.v2"],(function(t,e,n){return function(e){function r(t,n){var r;return(r=e.call(this,t)||this)._queryDataItemSets=n,r.getRowCount=r.getTupleCount.bind(_assertThisInitialized(r)),r}_inheritsLoose(r,e);var i=r.prototype;return i.getDataItemList=function(){var t=this;return this._dataItemList||(this._dataItemList=[],this._queryDataItemSets.forEach((function(e){t._processDataItemSet(e)}))),this._dataItemList},i.getValue=function(n){var r=e.prototype.getValue.call(this,n);if(!r)return null;if(this._dataItem&&this._dataItem.items&&this._dataItem.items[n]&&this._dataItem.items[n].isSummary)r.type=t.VALUE_TYPE.SUMMARY;else{var i=this._dataItem.items[n].icid,s=this._dataItem.itemClasses.find((function(t){return t.h[0].ihId===r[0].ihId&&t.icId===i}));if(s||(s=this._dataItem.itemClasses.find((function(t){return t.h[0].ihId===r[0].ihId}))),s&&r.length<s.h.length){var a=[],o=0;return s.h.forEach((function(t){if(r[o]&&r[o].ihId===t.ihId)a.push(JSON.parse(JSON.stringify(r[o++])));else{var e=a[o-1];e.span=e.span?e.span+1:2}})),a}}return r},i._processDataItemSet=function(t){var e=this,n=t.isMeasureItemSet();t.getDataItemList().forEach((function(t){n&&!e._responseIncludesRequestedMeasureItem(t)||e._dataItemList.push(t)})),t.getDataItemSetList().forEach((function(t){e._processDataItemSet(t)}))},i._responseIncludesRequestedMeasureItem=function(t){var e=this,r=!1;return this._dataItem.items.find((function(i){var s=e._dataItem.itemClasses.find((function(t){return t.icId==i.icid}));return s&&s.h&&s.h.find((function(e){return r=e.di===t.getId()||t.getId()===n.decodeGeneratedCalculationId(e.di).dataItemId})),r})),r},i.sortItems=function(t){var e=this,n=this._dataItem.items.map((function(t,n){return{item:t,itemIndex:n,value:e.getValue(n)}}));n.sort((function(e,n){return t(e.value,n.value,e.itemIndex,n.itemIndex)})),this._dataItem.items=n.map((function(t){return t.item}));var r=[];return n.forEach((function(t,e){var n=t.itemIndex;return r[n]=e})),r},i.deleteDataItems=function(t){t.sort();var e=function(t,e){for(var n=t.length-1;n>=0;n--){var r=t[n];e.splice(r,1)}};this.getDataItemList(),e(t,this._dataItemList),e(t,this._dataItem.itemClasses[0].h),this._dataItem.items.forEach((function(n){return e(t,n.t)}))},r}(e)})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/AbstractDataQueryResult.v2",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/dashboard/queryService/QueryResultData","@waca/dashboard-livewidget/js/features/dashboard/queryService/api/QueryResultAPI","@waca/dashboard-livewidget/js/features/dashboard/queryService/api/WriteableQueryResultAPI","./DataQueryResultItemSet","../QueryCalculationHelper.v2"],(function(t,e,n,r,i,s){return function(e){function a(i,s,a){var o;return(o=e.call(this,i)||this)._queryDefinition=s,o._logger=a,o._writeableApi=t.createAPI(_assertThisInitialized(o),[n,r]),o}_inheritsLoose(a,e);var o=a.prototype;return o.getAPI=function(t){return"writeable"===t?this._writeableApi:e.prototype.getAPI.call(this)},o.getResultDataItems=function(){var t=e.prototype.getResultDataItems.call(this);return t&&t.map((function(t){return t.getAPI()}))},o.getResultDataItem=function(t){var n=e.prototype.getResultDataItem.call(this,t);return n&&n.getAPI()},o._getRawResultDataItems=function(){return e.prototype.getResultDataItems.call(this)},o._addEdgeDataItem=function(t){var e=this._matchResultToDefinition(t.itemClasses);return e&&e.itemClasses&&this._aQueryResultDataItems.push(new i({itemClasses:e.itemClasses,items:this._buildEdgeItems(t,e.dataItemSet),identifiers:t.identifiers},e.dataItemSets)),{edgeResultInfo:e}},o._buildEdgeItems=function(t,e){var n={};t.itemClasses.forEach((function(t){t.h&&t.h.forEach((function(r){r&&e.isSummaryItemId(r.di)&&(n[t.icId]=t)}))}));var r=t.items&&t.items.map((function(e){if(e.hasNext)return e;var r=e.t.map((function(e){return void 0===e.rId?e:t.identifiers[e.rId]}));return{isSummary:void 0!==n[e.icId],icid:e.icId,t:r}}))||[],i=r&&r.length&&r[r.length-1];return i&&i.hasNext&&r.pop(),r},o._getAllDataItemSetItemIds=function(t){var e=this,n=[];return n=n.concat(t.getDataItemList().map((function(t){return t.getId()}))),t.getDataItemSetList().forEach((function(t){n=n.concat(e._getAllDataItemSetItemIds(t))})),n},o._matchResultToDefinition=function(t){var e=this,n=void 0,r=this._queryDefinition.getDataItemSetList().filter((function(r){var i=e._getAllDataItemSetItemIds(r);if(r.isNestedItemSet()){var s=e._matchNestedDefinitionToEdge(i,t);if(s)return n=[s],!0}else if(e._matchDefinitionToEdge(i,t))return n=t,!0}));return{dataItemSet:r&&r[0],dataItemSets:r,itemClasses:n}},o._matchNestedDefinitionToEdge=function(t,e){return e.find((function(e){var n=e.h&&e.h.filter((function(t){return!t.aggregate||"none"===t.aggregate}));if(!(!n||0===n.length||n.find((function(e,n){return e.di!==t[n]}))))return e}))},o._matchDefinitionToEdge=function(t,e){var n=[];e.forEach((function(t){t.h&&t.h.forEach((function(t){return t&&n.push(t.di)}))}));var r=!1;return t&&t.every((function(t){return n.some((function(e){return(r=e===t)||(r=t===s.decodeGeneratedCalculationId(e).dataItemId),r}))}))},a}(e)})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/multiEdge/multiMeasure/MultiMeasureValues.v2",[],(function(){return function(){function t(t){var e=t.dataCells,n=t.resultItemList,r=t.queryDefinition,i=t.resultMeasureCount,s=t.measureEdgeIndex,a=t.measuresOnEdgeResultItemImpl;this._dataCells=e,this._resultItemList=n,this._categoryEdgeCount=1===s?1:2,this._resultMeasureCount=i,this._suppressionEnabled=!!r.getSuppressionEnabled(),this._measureEdgeIndex=s,this._measuresOnEdgeResultItemImpl=a,this._MISSING_VALUE=this._suppressionEnabled?"":null}var e=t.prototype;return e.getValue=function(t,e){var n=this;this._cellMap||this._loadPrivateCellMap();var r=e>=this._categoryEdgeCount,i=this._getPrivateTupleNumbers(t,e),s=i.tupleNum_edge0,a=i.tupleNum_edge1;if(r){var o=this._suppressionEnabled&&0===this._measureEdgeIndex?this._measuresOnEdgeResultItemImpl.getSuppressedCellNumber(s):s,u=this._cellMap[o+","+a];return{value:(u=u||function(t,e){return{tuples:[t,e],v:n._MISSING_VALUE}}(s,a)).v}}return this._measuresOnEdgeResultItemImpl?e===this._measureEdgeIndex?this._measuresOnEdgeResultItemImpl.getValueUsingPrivateTupleNumber(s):this._resultItemList[e].getValue(a):this._resultItemList[e].getValue(s)},e._getPrivateTupleNumbers=function(t,e){if(2===this._categoryEdgeCount){var n=this._resultItemList[1].getRowCount(),r=Math.floor(t/n)*this._resultMeasureCount;return{tupleNum_edge0:r+=e>=this._categoryEdgeCount?e-this._categoryEdgeCount:0,tupleNum_edge1:t%n}}if(1===this._categoryEdgeCount)return{tupleNum_edge0:t,tupleNum_edge1:e>=this._categoryEdgeCount?e-this._categoryEdgeCount:0};throw new Error("More than 2 categorical edges are not currently supported in cell form.")},e._loadPrivateCellMap=function(){var t=this;this._cellMap={},this._dataCells.forEach((function(e){t._cellMap[e.pt[0]+","+e.pt[1]]={tuples:[e.pt[0],e.pt[1]],v:e.pt[e.pt.length-1].v}}))},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/multiEdge/multiMeasure/MultiMeasureEdgeResultInfo.v2",[],(function(){return function(){function t(t){var e=t.resultItem,n=t.queryDefinition;this._privateResultItemAPI=e,this._queryDefinition=n,this._valueSuppressionMap={},this._privateTupleNumbers={}}var e=t.prototype;return e.getTupleCount=function(){return this._getMeasureEdgeInfo().tupleCount},e.getResultMeasureCount=function(){return this.getResultMeasureList().length},e.getResultMeasureList=function(){return this._getMeasureEdgeInfo().measureList},e._getPrivateRowCount=function(){return this._privateResultItemAPI.getRowCount()},e._getPrivateValue=function(t){return this._privateResultItemAPI.getValue(t)},e._getMeasureEdgeInfo=function(){if(!this._measureEdgeInfo)if(this._queryDefinition.getSuppressionEnabled()){for(var t=0,e={},n=void 0,r=0;r<this._getPrivateRowCount();++r){var i=this._getPrivateValue(r),s=i.slice(0,i.length-1).map((function(t){return t.value})).join(",");0!=r&&s===n||(t++,n=s);var a=i[i.length-1];e[a.value]=1}this._measureEdgeInfo={measureList:this._getRequestMeasureList().filter((function(t){return void 0!==e[t.getColumnId()]})),tupleCount:t}}else this._measureEdgeInfo={measureList:this._getRequestMeasureList(),tupleCount:this._getPrivateRowCount()/this.getRequestMeasureCount()};return this._measureEdgeInfo},e._getRequestMeasureList=function(){var t=[];return this._queryDefinition.getDataItemSetList().forEach((function(e){e.isMeasureItemSet()&&(t.push.apply(t,e.getDataItemList()),t.push.apply(t,e.getCalculationList()))})),t},e.getRequestMeasureCount=function(){return this._queryDefinition.getMeasureCount({includeCalculations:!0})},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/multiEdge/multiMeasure/AbstractMeasuresOnEdgeResultItem.v2",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/dashboard/queryService/api/ResultItemAPI"],(function(t,e){return function(){function n(n){this.api=t.createAPI(this,[e]),this._logger=n}var r=n.prototype;return r.getAPI=function(){return this.api},r.getDataItemList=function(){},r.getValue=function(){this._logger.warn("attempted to call getValue on abstract MeasuresOnEdgeResultItem!")},r.getIdentifierList=function(){this._logger.warn("attempted to call getIdentifierList on abstract MeasuresOnEdgeResultItem!")},r.getId=function(){this._logger.warn("attempted to call getId on abstract MeasuresOnEdgeResultItem!")},r.getRowCount=function(){this._logger.warn("attempted to call getRowCount on abstract MeasuresOnEdgeResultItem!")},r.getDecorations=function(){this._logger.warn("attempted to call getDecorations on abstract MeasuresOnEdgeResultItem!")},r.getValueDecorations=function(){this._logger.warn("attempted to call getValueDecorations on abstract MeasuresOnEdgeResultItem!")},r.setDecorations=function(){this._logger.warn("attempted to call setDecorations on abstract MeasuresOnEdgeResultItem!")},r.setValueDecorations=function(){this._logger.warn("attempted to call setValueDecorations on abstract MeasuresOnEdgeResultItem!")},r.clearDecorations=function(){this._logger.warn("attempted to call clearDecorations on abstract MeasuresOnEdgeResultItem!")},n}()})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/multiEdge/multiMeasure/MeasuresOnEdgeSuppressedTupleMapper.v2",[],(function(){return function(){function t(t){var e=t.resultItem,n=t.multiMeasureEdgeResultInfo;this._multiMeasureEdgeResultInfo=n,this._privateResultItem=e,this._valueSuppressionMap=null,this._privateTupleNumbers=null}var e=t.prototype;return e._loadValues=function(){var t=this;if(!this._valueSuppressionMap){this._privateTupleNumbers={},this._valueSuppressionMap={};for(var e={},n=-1,r=void 0,i=-1,s=function(s){var a=t._privateResultItem.getValue(s);if(a){var u=a.map((function(t){return t.value})),c=u.slice(0,u.length-1),l=c.join(",");for(l!==r&&(t._privateTupleNumbers[++i]=s,r=l),t._multiMeasureEdgeResultInfo.getResultMeasureList().forEach((function(t,r){var i=c.slice();i.push(t.getColumnId());var a=r+i.join(",");e[a]||(e[a]={unsuppressedCellNumber:++n,suppressedTupleNumber:s,suppressedCellNumber:-1})})),o=0;o<t._multiMeasureEdgeResultInfo.getResultMeasureList().length;++o){var d=o+u.join(",");e[d]&&(e[d].suppressedCellNumber=s)}}},a=0;a<this._privateResultItem.getRowCount();++a){var o;s(a)}return this._valueSuppressionMap={},Object.keys(e).forEach((function(n){var r=e[n];t._valueSuppressionMap[r.unsuppressedCellNumber]={unsuppressedCellNumber:r.unsuppressedCellNumber,suppressedCellNumber:r.suppressedCellNumber,suppressedTupleNumber:r.suppressedTupleNumber,tuple:n}})),this._valuesInitialized=!0,this._valueSuppressionMap}},e.getSuppressedCellNumber=function(t){return this._loadValues(),this._valueSuppressionMap[t]&&this._valueSuppressionMap[t].suppressedCellNumber},e.getSuppressedTupleNumber=function(t){return this._loadValues(),this._valueSuppressionMap[t]&&this._valueSuppressionMap[t].suppressedTupleNumber},e.getPrivateTupleNumber=function(t){return this._loadValues(),this._privateTupleNumbers[t]},t}()})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/multiEdge/multiMeasure/MeasuresOnEdgeResultItem.v2",["./AbstractMeasuresOnEdgeResultItem.v2","./MeasuresOnEdgeSuppressedTupleMapper.v2"],(function(t,e){return function(t){function n(n){var r,i=n.privateResultItem,s=n.multiMeasureEdgeResultInfo,a=n.queryDefinition,o=n.suppressionEnabled,u=n.logger;return(r=t.call(this,u)||this)._privateResultItem=i,r._multiMeasureEdgeResultInfo=s,r._suppressionEnabled=o,r._queryDefinition=a,r._suppressionEnabled&&(r._measuresOnEdgeSuppressedTupleMapper=new e({resultItem:i,multiMeasureEdgeResultInfo:r._multiMeasureEdgeResultInfo})),r}_inheritsLoose(n,t);var r=n.prototype;return r.getDataItemList=function(){return this._privateResultItem.getDataItemList().filter((function(t){return"fact"!==t.getType()}))},r.getValue=function(t){var e=this._suppressionEnabled?this._measuresOnEdgeSuppressedTupleMapper.getPrivateTupleNumber(t):t*this._queryDefinition.getMeasureCount({includeCalculations:!0});return this._getPublicTuple(this._privateResultItem.getValue(e))},r.getRowCount=function(){return this._multiMeasureEdgeResultInfo.getTupleCount()},r.getIdentifierList=function(){return this._privateResultItem.getIdentifierList()},r._getPublicTuple=function(t){if(t.length>0){var e=t.type,n=t.slice(0,t.length-1);return e&&(n.type=e),n}return t},r.getPrivateValue=function(t){var e=this._suppressionEnabled?this._measuresOnEdgeSuppressedTupleMapper.getSuppressedTupleNumber(t):t;return this._privateResultItem.getValue(e)},r.getValueUsingPrivateTupleNumber=function(t){return this._getPublicTuple(this.getPrivateValue(t))},r.getSuppressedCellNumber=function(t){return this._measuresOnEdgeSuppressedTupleMapper.getSuppressedCellNumber(t)},r.getPrivateRowCount=function(){return this._privateResultItem.getRowCount()},r.sortItems=function(t){return this._privateResultItem.sortItems(t)},n}(t)})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/multiEdge/multiMeasure/MeasuresOnEdgeMeasuresResultItem.v2",["./AbstractMeasuresOnEdgeResultItem.v2"],(function(t){return function(t){function e(e,n){var r;return(r=t.call(this,n)||this)._measureList=e,r}_inheritsLoose(e,t);var n=e.prototype;return n.getDataItemList=function(){return this._measureList},n.getValue=function(t){var e=this.getDataItemList()[t];return[{label:e.getLabel(),value:e.getColumnId()}]},n.getIdentifierList=function(){return null},e}(t)})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/DataQueryResult.v2.multiEdge",["./AbstractDataQueryResult.v2","./multiEdge/multiMeasure/MultiMeasureValues.v2","./multiEdge/multiMeasure/MultiMeasureEdgeResultInfo.v2","./multiEdge/multiMeasure/MeasuresOnEdgeResultItem.v2","./multiEdge/multiMeasure/MeasuresOnEdgeMeasuresResultItem.v2"],(function(t,e,n,r,i){var s={ERROR:"ERROR",SECURITY_VIOLATION:"SECURITY",DIV_BY_ZERO:"DIVBYZERO",NOT_APPLICABLE:"NA",OVERFLOW:"OVERFLOW",UNDERFLOW:"UNDERFLOW",UNKNOWN:"UNKNOWN"};return function(t){function a(e,n,r){var i;return(i=t.call(this,e,n,r)||this)._hasMoreData=!1,i._nestedEdgeMeasuresEnabled=n.getPropertyValue("nestedEdgeMeasuresEnabled"),i._edgeSizes={},i}_inheritsLoose(a,t);var o=a.prototype;return o.getDatapointCount=function(){if(this._nestedEdgeMeasuresEnabled){if(1===this._measureEdgeIndex)return this._getEdgeSize(0);if(0===this._measureEdgeIndex)return this._getEdgeSize(0)*this._getEdgeSize(1)}return this._removeLastItemWithHasNextFlag(t.prototype.getDatapoints.call(this)),t.prototype.getDatapointCount.call(this)},o._getEdgeSize=function(t){var e=this.getResultItemList()[t],n=e.getRowCount(),r=n>0?e.getValue(n-1):null;return r&&r.hasNext?n-1:n},o.hasMoreData=function(){return this._removeLastItemWithHasNextFlag(t.prototype.getDatapoints.call(this)),this._hasMoreData},o._initializeMultiMeasureValues=function(){this._multiMeasureValues=new e({dataCells:this._removeLastItemWithHasNextFlag(this._resultData.data),resultItemList:this.getResultItemList(),queryDefinition:this._queryDefinition,measuresOnEdgeSuppressedTupleMapper:this._measuresOnEdgeSuppressedTupleMapper,resultMeasureCount:this._multiMeasureEdgeResultInfo.getResultMeasureCount(),measureEdgeIndex:this._measureEdgeIndex,measuresOnEdgeResultItemImpl:this._measuresOnEdgeResultItemImpl})},o.getValue=function(e,n){var r=null;return this._nestedEdgeMeasuresEnabled&&this._queryDefinition.getMeasureCount({includeCalculations:!0})>1?this.getDatapointCount()&&(this._multiMeasureValues||this._initializeMultiMeasureValues(),r=this._multiMeasureValues.getValue(e,n)):r=t.prototype.getValue.call(this,e,this._adjustTableColumnToSkipMeasureEdge(n)),r?(r.deco&&r.deco.state&&-1!==Object.values(s).indexOf(r.deco.state)&&(r.value=s.ERROR),r):{value:""}},o._adjustTableColumnToSkipMeasureEdge=function(t){return this._measureEdgeIndex>=0&&t>=this._measureEdgeIndex?t+1:t},o._removeLastItemWithHasNextFlag=function(t){var e=t&&t.length;return e&&e>0&&t[e-1].hasNext&&(this._hasMoreData=!0,t.pop()),t},o._hasNestedAggregates=function(t){return t.some((function(t){var e=t.h&&t.h.length;return e>1&&t.h&&t.h[e-1].aggregate&&"none"!==t.h[e-1].aggregate}))},o._generateDataItemArray=function(){var t=this;this._aQueryResultDataItems=[];var e=!1;if(this._resultData&&this._resultData.edges&&this._resultData.edges.length>0&&(this._removeLastItemWithHasNextFlag(this._resultData.data),this._resultData.edges.forEach((function(n,r){t._removeLastItemWithHasNextFlag(n.items);var i=t._addEdgeDataItem(n).edgeResultInfo;i&&i.dataItemSet&&i.dataItemSet.isMeasureItemSet()?t._measureEdgeIndex=r:t._hasNestedAggregates(i.itemClasses)&&(t._measureEdgeIndex=r,e=!0)}))),this._nestedEdgeMeasuresEnabled&&void 0!==this._measureEdgeIndex&&(this._restoreMeasuresPlacedOnOwnEdgeBefore(e),this._multiMeasureEdgeResultInfo=new n({resultItem:this.getResultItemList()[this._measureEdgeIndex],queryDefinition:this._queryDefinition}),e)){var s=this._getRawResultDataItems()[this._measureEdgeIndex];this._measuresOnEdgeResultItemImpl=new r({privateResultItem:s,multiMeasureEdgeResultInfo:this._multiMeasureEdgeResultInfo,suppressionEnabled:!!this._queryDefinition.getSuppressionEnabled(),queryDefinition:this._queryDefinition,logger:this._logger}),this._aQueryResultDataItems[this._measureEdgeIndex]=this._measuresOnEdgeResultItemImpl,this._aQueryResultDataItems.push(new i(this._multiMeasureEdgeResultInfo.getResultMeasureList(),this._logger))}},o._restoreMeasuresPlacedOnOwnEdgeBefore=function(t){var e=function(t){var e=t[0];t[0]=t[1],t[1]=e};t||0!==this._measureEdgeIndex||2!==this.getResultItemList().length||(e(this._aQueryResultDataItems),this._resultData.data.forEach((function(t){t.pt&&e(t.pt)})),this._measureEdgeIndex=1)},o.sortResultItems=function(t){if(t&&this._resultData.data&&this._resultData.data.length){var e=this._getRawResultDataItems().map((function(e,n){return t[n]&&e.sortItems(t[n])}));this._resultData.data.forEach((function(t){t&&t.pt&&e.forEach((function(e,n){e&&(t.pt[n]=e[t.pt[n]])}))})),this._resultData.data=this._resultData.data.map((function(t,e){return{dataPoint:t,index:e}})).sort((function(t,e){var n=t.dataPoint,r=t.index,i=e.dataPoint,s=e.index;if(n.hasNext||i.hasNext)return n.hasNext&&i.hasNext?0:n.hasNext?1:-1;for(var a=0;a<n.pt.length;a++){var o=n.pt[a],u=i.pt[a];if(!isNaN(o)&&!isNaN(u)&&o!==u)return o-u;if(!isNaN(o.value)&&!isNaN(u.value)&&o.value!==u.value)return r-s}return 0})).map((function(t){return t.dataPoint}))}},o.deleteDataItems=function(){},a}(t)})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/DataQueryResult.v2.singleEdge",["./AbstractDataQueryResult.v2"],(function(t){return function(t){function e(e,n,r){var i;return(i=t.call(this,e,n,r)||this)._edge=e.edges[0],i}_inheritsLoose(e,t);var n=e.prototype;return n.getDatapointCount=function(){return this._edge.items&&this._edge.items.length-(this.hasMoreData()?1:0)},n.hasMoreData=function(){var t=this._edge.items,e=t&&t[t.length-1];return!(!e||!e.hasNext)},n._getResultItem=function(){return this._getRawResultDataItems()[0]},n.getValue=function(t,e){var n=this._getResultItem().getValue(t);return!n||e<0||e>=n.length?{value:null}:n[e]},n._generateDataItemArray=function(){this._aQueryResultDataItems=[],this._edge&&this._addEdgeDataItem(this._edge)},n.sortResultItems=function(t){var e=t[0];e&&this._getResultItem().sortItems(e)},n.deleteDataItems=function(t){this._getResultItem().deleteDataItems(t)},e}(t)})),define("@dashboard-features/dssQueryService/js/query/v2/queryResult/DataQueryResultBuilder.v2",["./DataQueryResult.v2.multiEdge","./DataQueryResult.v2.singleEdge","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/postProcess/PostProcessOlapProperties"],(function(t,e,n){var r=function(){function r(t){var e=t.queryResult,n=t.queryDefinition,r=t.logger;this.queryResult=e,this.queryDefinition=n,this.logger=r}var i=r.prototype;return i.getQueryResult=function(){return this.sanitizeQueryResult(),this.queryResult.edges.length>1?new t(this.queryResult,this.queryDefinition,this.logger):new e(this.queryResult,this.queryDefinition,this.logger)},i.sanitizeQueryResult=function(){this.postProcessOlapProperties()},i.postProcessOlapProperties=function(){var t=new n({queryResultData:this.queryResult,dataItemList:this.queryDefinition.getAllDataItemsList()});t.processData(),t.destroy()},r}();return{build:function(t){var e=t.queryResult,n=t.queryDefinition,i=t.logger;return new r({queryResult:e,queryDefinition:n,logger:i}).getQueryResult()}}})),define("@dashboard-features/dssQueryService/js/query/v2/Query.v2",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/dashboard/queryService/api/QueryAPI2","./v5/V5QuerySet","./v5/expression/V5FilterExpression","./v5/expression/V5ColumnExpression","./v5/expression/V5ExpressionConstant","./dashboardToV5/FilterHelper.v2","./dashboardToV5/DataItemSetHelper.v2","./queryResult/DataQueryResultBuilder.v2"],(function(t,e,n,r,i,s,a,o,u){var c=function(){function c(t){var e=t.dashboard,n=t.internalQueryService,r=t.definitionList;this._dashboard=e,this._internalQueryService=n,this._definitionList=r,this._logger=e.getGlassCoreSvc(".Logger"),this._jsonSpecs=null,this._faultHandler=null,this._postProcessHandlerList=[],this._postProcessHandler2List=[],this._saveRawDataHandler=null,this._queryState={warnings:[]}}var l=c.prototype;return l.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},l.getWarningList=function(){return this._queryState.warnings},l.execute=function(t,e){var n=this;void 0===e&&(e={});var r=(t=t||this._getDefinitionsAndSpecs()).map((function(t){var r=t.definition,i=t.spec;return n._internalQueryService.executeQuery(r.getDataSource().getId(),i,n.constructor.name,e).catch((function(t){return Promise.reject({error:t,definition:r})}))}));return Promise.all(r).then((function(e){return e.map((function(e,r){var i=t[r].definition;n._saveRawData(e.data,i),n._postProcessResult(e.data,i);var s=u.build({queryResult:e.data,queryDefinition:i,logger:n._logger});return s.setPropertyValue("RequestTime.internal",e.requestTime),e.zipiId&&s.setPropertyValue("ZIPI.id",e.zipiId),n._postProcessResult2(s,i),s}))})).catch((function(r){var i=r.error,s=r.definition;if(n._faultHandler&&s)return n._faultHandler({error:i}).then((function(r){var s=r.promptInfoList,a=r.joinError;return s&&s.length?(t.forEach((function(t){t.spec.parameterValues=s})),n.execute(t,e)):a?Promise.reject({error:i,joinError:a}):void 0}));throw i}))},l._saveRawData=function(t,e){"main"===e.getType()&&"function"==typeof this._saveRawDataHandler&&this._saveRawDataHandler(t,e.getId())},l._postProcessResult=function(t,e){return"main"===e.getType()&&this._postProcessHandlerList.forEach((function(n){"function"==typeof n&&(t=n(t,e))})),t},l._postProcessResult2=function(t,e){if("main"===e.getType()){var n=t.getAPI("writeable");this._postProcessHandler2List.forEach((function(t){"function"==typeof t&&t(n)}))}},l._getDefinitionsAndSpecs=function(){for(var t=this.getSpecList(),e=[],n=0;n<t.length;n++)e.push({definition:this._definitionList[n],spec:t[n]});return e},l.getSpecList=function(){var t=this;return this._jsonSpecs||(this._jsonSpecs=this._definitionList.map((function(e){return t._generateV2Query({definition:e})}))),this._jsonSpecs},l._generateV2Query=function(t){var e=t.definition,r=new n,i=r.newQuery();i.newQueryHint({key:"dashboard",spec:"true"}),i.newQueryHint({key:"ignoreFiltersNotApplicable",spec:"true"});var s=r.newQueryResultDefinition({refQuery:i,isSuppressionEnabled:e.getSuppressionEnabled()});this._processDataItemSets({definition:e,v5Query:i,v5QueryResultDefinition:s}),this._processFilters({definition:e,v5Query:i}),this._processQueryHints({definition:e,v5Query:i});var a=this._getLimit({definition:e,v5QueryResultDefinition:s}),o={version:c.VERSION,v5QuerySet:r.toJSON(),limit:a},u=e.getParameterValues();return u&&u.length&&(o.parameterValues=u),o},l._processDataItemSets=function(t){var e=t.definition,n=t.v5Query,r=t.v5QueryResultDefinition;new o({definition:e,v5Query:n,v5QueryResultDefinition:r}).convertDataItemSetListToV5(e.getDataItemSetList())},l._processFilters=function(t){var e=t.definition,n=t.v5Query,o=new a(e,this._queryState).convertFiltersToV5(),u=o.detailFilters;o.filterDataItems.forEach((function(t){n.newSelectionDataItem({name:t.id,expression:new i(t).getAPI(),aggregate:s.aggregateMap[t.aggregationType]})})),u.forEach((function(t){var e=new r({filterExpression:t.filterExpression}).getAPI(),i=n.newDetailFilter({expression:e});"post"===t.preOrPost?i.setPostAutoAggregation(!0):i.setPostAutoAggregation(!1)}))},l._processQueryHints=function(t){var e=t.definition,n=t.v5Query;e.getSuppressionEnabled()||n.newQueryHint({key:"suppress",spec:{suppress:"none"}}),e.getQueryHints().forEach((function(t){n.newQueryHint(t)}))},l._getLimit=function(t){var e=t.definition,n=t.v5QueryResultDefinition,r=e.getPropertyValue("rowLimit");if(n.isMultiEdge()){var i=this._numberOfMeasures(e);if(i>0)return i*r}return r},l._numberOfMeasures=function(t){var e=0;return t.getDataItemSetList().forEach((function(t){t.isMeasureItemSet()&&(e+=t.getDataItemList().length,e+=t.getCalculationList().length)})),e},l.registerFaultHandler=function(t){this._faultHandler=t},l.registerSaveRawDataHandler=function(t){this._saveRawDataHandler=t},l.registerPostProcessor=function(t){this._postProcessHandlerList.push(t)},l.registerPostProcessor2=function(t){this._postProcessHandler2List.push(t)},c}();return c.VERSION="2",c})),define("@dashboard-features/dssQueryService/js/dataSources/DataSources2",["react","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/dashboard/dataSources/api/DataSourcesAPI","@waca/dashboard-livewidget/js/features/dashboard/dataSources/api/DataSourcesUIAPI","./api/DataSourcesMoserAPI","./api/CalculationUIAPI","./api/CustomGroupUIAPI","./api/CustomBinUIAPI","./DataSource","../query/v2/Query.v2","underscore","bi/moser/moser.min","ca-modeller/shaping"],(function(t,e,n,r,i,s,a,o,u,c,l,d,g){return function(){function h(t){this.features=t.features,this.dashboard=this.features.API,this.dataSources={},this.metadataSubsetIdsProviders=[],this._registeredEvents=[this.dashboard.on("widget:selected",this._onWidgetSelection.bind(this))],this.MoserJSInst=t.MoserJS||d,this.features.QueryService2.registerQueryClass(u.PROTOCOL,c)}var f=h.prototype;return f.destroy=function(){this._isDestroyed||(l.values(this.dataSources).forEach((function(t){t.destroy()})),this.dataSources={},this._registeredEvents.forEach((function(t){t.remove()})),this._registeredEvents=[],this._sourcesCollection=null,this.dataSourcesAPI=void 0,this._isDestroyed=!0)},f.getAPI=function(t){return"moser"===t?(this.dataSourcesMoserAPI||(this.dataSourcesMoserAPI=e.createAPI(this,[i])),this.dataSourcesMoserAPI):"UI"===t?(this.dataSourcesUIAPI||(this.dataSourcesUIAPI=e.createAPI(this,[r])),this.dataSourcesUIAPI):"CalculationUI"===t?(this.calculationUIAPI||(this.calculationUIAPI=e.createAPI(this,[s])),this.calculationUIAPI):"CustomGroupUI"===t?(this.customGroupUIAPI||(this.customGroupUIAPI=e.createAPI(this,[a])),this.customGroupUIAPI):"CustomBinUI"===t?(this.customBinUIAPI||(this.customBinUIAPI=e.createAPI(this,[o])),this.customBinUIAPI):(this.dataSourcesAPI||(this.dataSourcesAPI=e.createAPI(this,[n])),this.dataSourcesAPI)},f.pickItems=function(t){if(t.dataSourceId)return this._getDataSource(t.dataSourceId).pickItems(t)},f.addDataSource=function(t,e,n){return void 0===e&&(e=!1),void 0===n&&(n={}),n.allowDuplicateAssetIds=e,this._getSourcesCollection().addSource(t,n)},f.removeDataSource=function(t){this._getSourcesCollection().removeSource(t),t===this._activeDataSourceId&&this.setActiveDataSourceId(null),delete this.dataSources[t]},f._getDataSource=function(t){if(!this.dataSources[t]){var e=this._getSourcesCollection(),n=e.getSource(t);n&&(this.dataSources[t]=new u(e,n,this.features))}return this.dataSources[t]},f.getDataSource=function(t){return this.dataSources[t]||this._getDataSource(t),this.dataSources[t]&&this.dataSources[t].getAPI()},f.getDataSourceList=function(){var t=this,e=this._getSourcesCollection().getSources(),n=[];return e.forEach((function(e){n.push(t.getDataSource(e.getId()))})),n},f._onWidgetSelection=function(t){var e=this._getSourcesCollection().usesSource(t.sender);e&&this.setActiveDataSourceId(e)},f.setActiveDataSourceId=function(t){this._activeDataSourceId=t},f.getActiveDataSourceId=function(){return this._activeDataSourceId||null},f._getSourcesCollection=function(){return this._sourcesCollection||(this._sourcesCollection=this.features["dataSources.deprecated"].getSourcesCollection()),this._sourcesCollection},f.getSourcesInfo=function(){var t=this,e=this.getDataSourceList(),n=this.getActiveDataSourceId();return Promise.all(e.map((function(e){return t._getSourceInfo(e,n)})))},f._getSourceInfo=function(t,e){var n=t.getId()===e;return t.getLocalizedName().then((function(e){return{name:e,assetId:t.getAssetId(),type:t.getType(),active:n}}))},f.addDataSources=function(t,e){var n=this._getSourcesCollection();return l.map(l.isArray(t)?t:[t],(function(t){var r={name:t.name,clientId:t.id,isOlapPackage:t.isOlapPackage};if(t.module){var i="string"==typeof t.module?JSON.parse(t.module):t.module;r.clientId=t.id,r.module=i}else r.assetId=t.cognosAssetId||t.assetId,r.type=t.type,r.searchPath=t.searchPath;return n.addSource(r,e)}))},f.getModule=function(t){return this._getSourcesCollection().getSource(t).getModuleAPI()},f.ensureTemporaryModule=function(t){var e=this._getSourcesCollection().getSource(t);if(e)return e.getModuleAPI().ensureTemporaryModule({forceTemporaryModule:!0})},f.registerLoadMetadataProgressHandler=function(t,e){var n=this._getSourcesCollection().getSource(t);n&&n.registerLoadMetadataProgressHandler(e)},f.addToUndoStack=function(t,e,n){var r=this._getSourcesCollection().getSource(t);r&&r.getModuleAPI().addToUndoStack(e,n)},f.setCustomGroupColumns=function(t,e,n){this._getDataSource(t).setCustomGroupColumns(e,n)},f.getCustomGroupColumns=function(t){return this._getDataSource(t).getCustomGroupColumns()},f.getCustomGroupData=function(t,e){return this._getDataSource(t).getMetadataColumnImpl(e).getCustomGroupData()},f.isConsumerGroupColumn=function(t,e){var n=this._getDataSource(t).getMetadataColumnImpl(e);return n&&n.isConsumerGroupColumn()},f.getNavigationPaths=function(t,e,n){return this._getDataSource(t).getNavigationPaths(e,n)},f.getDrillGroups=function(t,e){return this._getDataSource(t).getDrillGroups(e)},f.editCalculation=function(t,e,n){return this._getDataSource(t).editCalculation(e,n)},f.createCalculation=function(t,e,n){return this._getDataSource(t).createCalculation(e,n)},f.validateCustomGroup=function(t,e,n,r){return this._getDataSource(t).validateCustomGroup(e,n,r)},f.createCustomGroup=function(t,e,n,r,i,s){return this._getDataSource(t).createCustomGroup(e,n,r,i,s)},f.removeCustomGroup=function(t,e,n){return this._getDataSource(t).removeCustomGroup(e,n)},f.createCustomBinning=function(t,e,n,r,i){return this._getDataSource(t).createCustomBinning(e,n,r,i)},f.validateCustomBinning=function(t,e,n){return this._getDataSource(t).validateCustomBinning(e,n)},f.removeCustomBinning=function(t,e,n){return this._getDataSource(t).removeCustomBinning(e,n)},f.getCustomBinning=function(t,e){return this._getDataSource(t).getCustomBinning(e)},f.getOriginalSourceType=function(t,e){var n=this._getDataSource(t).getTable(e);if(!n)return null;var r=this.MoserJSInst.default.ModuleUtils.getObjectUseSpec(n);return r&&r.getType().value()},f.registerMetadataSubsetIdsProvider=function(t){this.metadataSubsetIdsProviders.push(t)},f.getMetadataSubsetIds=function(t){void 0===t&&(t=null);var e=[];return this.metadataSubsetIdsProviders.forEach((function(n){e.push.apply(e,n.getMetadataSubsetIds(t))})),e},f.getColumnSourceTree=function(e,n){var r=this._getSourcesCollection().getSource(e);if(r&&"error"!==r.getState()){var i=r.getModuleAPI(),s=i&&i.getMetadataColumn(n),a=s&&s.moserObject,o=i&&i.getShapingHelper(),u=g.ShapingAncestorTree;if(a)return t.createElement(o.ShapingProvider,null,t.createElement(u,{includeParent:function(){return!0},moserObject:a}))}return null},f.getPickTree=function(e,n,r,i){var s=this;void 0===i&&(i=null);var a=this._getSourcesCollection().getSource(e);if(a&&"error"!==a.getState()){var o=a.getModuleAPI().getShapingHelper(),u=g.ShapingPickTree,c=i?function(t){return s._metadataCondition(t,i)}:null;return t.createElement(o.ShapingProvider,null,t.createElement(u,{filter:n,onSelect:function(t){return s._onPickTreeSelect(t,e,r)},moserObjectFilter:c}))}return null},f._onPickTreeSelect=function(t,e,n){var r=t&&this.getDataSource(e),i=r&&r.getMetadataColumn(t.idForExpression);i&&n(i)},f._metadataCondition=function(t,e){var n=this,r=t.getObjectType();for(var i in e){var s=d.default.UsageType.valueOf(e[i]);if(s?r===d.default.MoserObjectTypes.QUERY_ITEM&&t.usage===s:r===e[i])return!0}return d.default.ModuleUtils.getTreeChildren(t).some((function(t){return n._metadataCondition(t,e)}))},f.updateWhatIf=function(t,e,n){return this._getDataSource(t).updateWhatIf(e,n)},h}()})),define("@dashboard-features/dssQueryService/js/dataSets/api/DataSetsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.create=function(){},e.use=function(){},e.delete=function(){},e.getStatus=function(){},t}()})),define("@dashboard-features/dssQueryService/js/dataSets/api/DataSetsInternalAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getModule=function(){},e.getDataSource=function(){},t}()})),define("@dashboard-features/dssQueryService/js/dataSets/DataSetQueryBase",[],(function(){return function(){function t(t,e,n){void 0===n&&(n=[]),this.SEPARATOR="->",this._activeDataSet=t,this._originalColumnIds=e,this.originalNonProjectedColumnIDs=n,this._datasetColumnIds=this._activeDataSet.getMetadataColumnList().map((function(t){return t.getId()}))}var e=t.prototype;return e.getType=function(){return"main"},e.getDataSetColumnId=function(t){return this._getTargetColumnId(t,this._originalColumnIds,this._datasetColumnIds)},e.getDataSetValueUniqueId=function(t){return this._getTargetValueUniqueId(t,this._originalColumnIds,this._datasetColumnIds)},e.getOriginalColumnId=function(t){return this._getTargetColumnId(t,this._datasetColumnIds,this._originalColumnIds)},e.getOriginalValueUniqueId=function(t){return this._getTargetValueUniqueId(t,this._datasetColumnIds,this._originalColumnIds)},e._doGetTargetColumnId=function(t,e,n){return n[e.indexOf(t)]},e._getTargetColumnId=function(t,e,n){if(!t)return t;var r=this._doGetTargetColumnId(t,e,n);if(!r)throw this._getMissingColumnError();return r},e._getTargetValueUniqueId=function(t,e,n){if(!t)return t;var r=this._doGetTargetColumnId(t,e,n);if(r)return r;if("object"==typeof t){var i=this._getTargetValueUniqueId(t.u,e,n);if(void 0!==i){var s=JSON.parse(JSON.stringify(t));s.u=i,t=s}return t}var a=t.split(this.SEPARATOR),o=a.length>1&&a[0];return o?t.replace(o,this._getTargetColumnId(o,e,n)):t},e._getMissingColumnError=function(){return Object.assign(new Error,{code:"ds-missingColumn"})},e.updateMetadataInSpec=function(t){var e=this;t&&Object.keys(t).forEach((function(n){switch(n){case"itemId":case"columnId":t[n]=e._getTargetColumnId(t[n],e._originalColumnIds,e._datasetColumnIds);break;case"values":for(var r=0;r<t[n].length;r++)t[n][r]=e._getTargetValueUniqueId(t[n][r],e._originalColumnIds,e._datasetColumnIds);break;case"queryHints":break;default:if(Array.isArray(t[n])){"filters"===n&&(t[n]=t[n].filter((function(t){return!(-1!==e.originalNonProjectedColumnIDs.indexOf(t.expression&&(t.expression.itemId||t.expression.columnId||t.expression.filterId)))}))),t[n].forEach((function(t){return e.updateMetadataInSpec(t)}));break}t[n]instanceof Object&&e.updateMetadataInSpec(t[n])}}))},t}()})),define("@dashboard-features/dssQueryService/js/dataSets/DataSetQueryDataItem",[],(function(){return function(){function t(t,e){var n=this;if(this.OVERRIDE_FUNCTION_LIST=["getColumnId","getMetadataColumn","getTopBottom","setTopBottom"],!t)throw new Error("Missing parameter: MetadataColumnAPI");this.metadataColumn=t,e&&Object.keys(e).forEach((function(t){-1===n.OVERRIDE_FUNCTION_LIST.indexOf(t)&&(n[t]=e[t].bind(e))}))}var e=t.prototype;return e.getColumnId=function(){return this.metadataColumn.getId()},e.getMetadataColumn=function(){return this.metadataColumn},e.getTopBottom=function(){return this.topBottom},e.setTopBottom=function(t){this.topBottom=t},t}()})),define("@dashboard-features/dssQueryService/js/dataSets/DataSetQueryModifier",["./DataSetQueryBase","./DataSetQueryDataItem"],(function(t,e){return function(t){function n(e,n,r){return t.call(this,e,n,r)||this}_inheritsLoose(n,t);var r=n.prototype;return r.modifyQuerySpecList=function(t){var e=this;return t.forEach((function(t){t.dataSourceId=e._activeDataSet.getId(),e.updateMetadataInSpec(t.spec)})),t},r.modifyQueryDefinitionList=function(t){for(var e=this,n=0;n<t.length;n++){t[n].setDataSource(this._activeDataSet),t[n].getDataItemSetList().forEach((function(t){return e._modifyDataItemSet(t)})),this._updateMetadataInFilters(t[n])}return t},r._modifyDataItemSet=function(t){var e=this,n=t.getDataItemList(),r=this._createQueryDataItems(n);t.setDataItemList(r),t.getDataItemSetList().forEach((function(t){e._modifyDataItemSet(t)}))},r._createQueryDataItems=function(t){var n=this;return t.map((function(t){var r=t.getMetadataColumn();if(r){var i=n.getDataSetColumnId(r.getId()),s=new e(n._activeDataSet.getMetadataColumn(i),t),a=t.getTopBottom();return n.updateMetadataInSpec(a),s.setTopBottom(a),s}return t}))},r._updateMetadataInFilters=function(t){var e=this,n=t.getFilters(),r=n.filter((function(t){return-1!==e.originalNonProjectedColumnIDs.indexOf(t&&(t.columnId||t.id||t.filterId))}));r.length&&(t.removeFilters(r),n=t.getFilters()),n.forEach((function(t){return e.updateMetadataInSpec(t)}))},n}(t)})),define("@dashboard-features/dssQueryService/js/dataSets/DatasetQueryPostProcessor",["./DataSetQueryBase"],(function(t){return function(t){function e(e,n){return t.call(this,e,n)||this}_inheritsLoose(e,t);var n=e.prototype;return n.process=function(t){"2"===t.version?this._postProcessV2QueryResult(t):this._postProcessResult(t)},n._postProcessResult=function(t){var e=this;t.dataItems.forEach((function(t){t.itemClass.h.forEach((function(t){return t.u=e.getOriginalColumnId(t.u)})),t.items&&t.items.length&&t.items.forEach((function(t){t.t.forEach((function(t){t.u=e.getOriginalValueUniqueId(t.u)}))}))}))},n._postProcessV2QueryResult=function(t){var e=this;t.edges.forEach((function(t){var n=t.identifiers;for(var r in n)n[r]=e.getOriginalValueUniqueId(n[r])}))},e}(t)})),define("@dashboard-features/dssQueryService/js/dataSets/DataSetModel",["@waca/dashboard-livewidget/js/dataSources/models/sources/SourceModel"],(function(t){return function(t){function e(e){var n;return(n=t.call(this,e)||this).whitelistAttrs=["id","assetId","columnIds","type","deploymentReferenceId"],n.assetId=e.id,n}return _inheritsLoose(e,t),e}(t)})),define("@dashboard-features/dssQueryService/js/dataSets/DataSets",["@waca/dashboard-common/js/core/APIFactory","./api/DataSetsAPI","./api/DataSetsInternalAPI","@waca/dashboard-common/js/core/Collection","@waca/dashboard-livewidget/js/dataSources/modelapis/SourceModelAPI","../dataSources/DataSource","./DataSetQueryModifier","./DatasetQueryPostProcessor","./DataSetModel","underscore","@waca/dashboard-livewidget/js/DynamicFileLoader","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,r,i,s,a,o,u,c,l,d){return function(){function g(t){var e=this;this.dashboard=t.features.API;var n=t.spec||{};this.dataSetModels=new r(n.dataSets,{modelClass:u}),this.dataSetDataModules={},this.dataSetDataSources={},this.deregisterHandlers={},this.contentStoreReferences=t.features.ContentStoreReferences,this.contentStoreReferences.registerProvider(this),this.dataSetModels.each((function(t){var n=e.contentStoreReferences.getLatestAssetId(t.deploymentReferenceId);n&&t.deploymentReferenceId!==n&&(t.deploymentReferenceId=n)}))}var h=g.prototype;return h.toJSON=function(){return this.dataSetModels.size()?{dataSets:this.dataSetModels.toJSON()}:{}},h.getAPI=function(r){return"internal"===r?(this.internalAPI||(this.internalAPI=t.createAPI(this,[n])),this.internalAPI):(this._api||(this._api=t.createAPI(this,[e])),this._api)},h.destroy=function(){this.dataSetModels.length=0,this.dataSetDataModules={},this.dataSetDataSources={},this.deregisterHandlers={}},h.create=function(t,e,n){var r=this;void 0===e&&(e=[]),void 0===n&&(n=[]);var i=this.dashboard.getFeature("internal").getBoardModel().id;if(!i){var s="ds-missingDashboardId";return Promise.reject(Object.assign(new Error,{code:s,assetId:t,message:d.get(s)}))}var a=e.map((function(t){return{expression:t}})),o=[],u=[],l=[];return n.forEach((function(t){var n=t.columnId||t.id||t.itemId;if(t.values){var r={dataItem:n,dataType:t.dataType||"string",values:c.pluck(t.values,"d")};"notin"===t.operator&&(r.not=!0),u.push(r)}else o.push({expression:n});t.columnId&&-1===e.indexOf(n)&&l.push(n)})),this.dashboard.findGlassCollection("com.ibm.bi.DatasetService.provider").then((function(n){var s=c.find(n,(function(t){return"com.ibm.bi.datasets.DatasetService"===t.id})),d={};return r.dashboard.prepareGlassOptions(d),r._getNewServiceInstance(s.class,d).then((function(n){return n.setMetadata(t),n.setItems(a),o.length&&n.setDetailFilters(o),u.length&&n.setDetailValuesFilters(u),n.create(i).then((function(t){return d.glassContext.getSvc(".DatasetExecutionService").then((function(e){return e.execute({id:t.id,showToastWhenDone:!1,glassContext:d.glassContext})})).then((function(){var n={id:t.id,type:"dataSet2",columnIds:e,nonProjectedColumnIds:l,deploymentReferenceId:t.id};return r.dataSetModels.add(n,{silent:!0,payloadData:{skipUndoRedo:!0}}),t.id}))}))}))}))},h.getStatus=function(t){var e={};return this.dashboard.prepareGlassOptions(e),e.glassContext.getSvc(".DatasetExecutionService").then((function(e){return e.getStatus(t)}))},h._hasOlap=function(t,e){var n=!1,r=e&&this._getOriginalColumnIds(e.getId());return r&&r.length&&(n=!!t.find((function(t){if("rendered"===t.getFeature("state").getStatus()){var e=t.getFeature("Visualization").getDataSource().getMetadataColumn(r[0]);return e&&e.isOlapColumn()}}))),n},h.use=function(t,e){var n=this;void 0===e&&(e=[]);var r=this.dataSetModels.get(t);if(t&&!r){var i="ds-missingDataSet";return Promise.reject(Object.assign(new Error,{code:i,assetId:t,message:d.get(i)}))}return this._getDataSetDataSource(t).then((function(r){var i=e.map((function(t){return n.dashboard.getCanvas().getContent(t)})).filter(Boolean);if(n._hasOlap(i,r)){var s="ds-unsupportedDataSourceType";return Promise.reject(Object.assign(new Error,{code:s,assetId:t,message:d.get(s,{type:"OLAP"})}))}return n._registerFeatures(i,r),n._renderContents(i)}))},h._removeDataSet=function(t){this.dataSetModels.remove(t,{silent:!0,payloadData:{skipUndoRedo:!0}}),delete this.dataSetDataModules[t],delete this.dataSetDataSources[t]},h._renderContents=function(t){var e=[];t.forEach((function(t){"rendered"===t.getFeature("state").getStatus()?e.push(t.getFeature("RenderSequence.internal").triggerRenderSequence({refreshAll:!0,renderId:0})):e.push(Promise.resolve())}));return Promise.all(e.map((function(t){return t.then((function(t){return{result:t,status:"fulfilled"}}),(function(t){return{error:t,status:"rejected"}})).catch((function(t){return{error:t,status:"rejected"}}))}))).then((function(t){var e=t.filter((function(t){return"rejected"===t.status}));if(e.length)return Promise.reject(e)}))},h._registerFeatures=function(t,e){var n=this,r=e&&this._getOriginalColumnIds(e.getId()),i=e&&this._getOriginalNonProjectedColumnIds(e.getId());t.forEach((function(t){var s=t.getId();if(n.deregisterHandlers[s]?(n.deregisterHandlers[s].forEach((function(t){return t.remove()})),n.deregisterHandlers[s].length=0):n.deregisterHandlers[s]=[],e){var u=t.getFeature("DataQueryExecution"),c=new a(e,r,i);n.deregisterHandlers[s].push(u.registerQueryModifier(c)),n.deregisterHandlers[s].push(u.registerQueryDefinitionModifier(c));var l=new o(e,r);n.deregisterHandlers[s].push(u.registerQueryPostProcessor(l))}}))},h._getOriginalColumnIds=function(t){var e=this.dataSetModels.get(t);return e&&e.get("columnIds")},h._getOriginalNonProjectedColumnIds=function(t){var e=this.dataSetModels.get(t);return e&&e.get("nonProjectedColumnIds")},h._getDataSetDataSource=function(t){var e=this;if(t&&!this.dataSetDataSources[t]){var n=this.dataSetModels.get(t);if(n.id!==n.deploymentReferenceId){var r=n.toJSON();r.id=n.deploymentReferenceId,r.assetId=n.deploymentReferenceId,n=new u(r)}var a=new i({sourceModel:n,dashboardApi:this.dashboard});return a.getModule().then((function(n){e.dataSetDataModules[t]=n;var r=new s(null,a,{API:e.dashboard}).getAPI();return e.dataSetDataSources[t]=r,r}))}return Promise.resolve(this.dataSetDataSources[t])},h.getModule=function(t){return this.dataSetDataModules[t]},h.getDataSource=function(t){return this.dataSetDataSources[t]},h._getNewServiceInstance=function(t,e){var n=this;return this._datasetProvider?Promise.resolve(this._datasetProvider):(this.dynamicFileLoader||l).load([t]).then((function(t){return n._datasetProvider=new t[0](e),n._datasetProvider}))},h.delete=function(t){var e=this,n=[];return this.dashboard.getGlassSvc(".Content").then((function(r){c.each(t,(function(t){var i=r.delete("v1/objects/"+encodeURIComponent(t)+"?force=true&recursive=true",{}).then((function(){return e._removeDataSet(t)}));n.push(i)}));return Promise.all(n.map((function(t){return t.fail((function(){return{status:"rejected"}}))})))})).then((function(e){var n=[];if(e.forEach((function(e,r){e&&"rejected"===e.status&&(e.error=Object.assign(new Error,{code:"ds-deleteError",assetId:t[r]}),n.push(e))})),n.length)return Promise.reject(n)}))},h.getContentStoreReferences=function(){return this.dataSetModels.map((function(t){return{assetId:t.deploymentReferenceId,type:t.type}}))},g}()})),define("@dashboard-features/predictQuery/js/keyDrivers/api/KeyDriversQueryAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.executePossibleKeyDriversRequest=function(){},e.executeFastPatternDetectionRequest=function(){},t}()})),define("@dashboard-features/predictQuery/js/keyDrivers/KeyDriversQuery",["@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","@waca/dashboard-common/js/core/APIFactory","./api/KeyDriversQueryAPI"],(function(t,e,n){var r={DIAG_MSG_TYPE:"FPD Diagnostics",WARN_MSG_TYPE:"FPD Warnings",ERR_MSG_TYPE:"FPD Errors"},i=400,s=500;return function(){function a(t){var r=t.features;this.features=r,this.smartsService=r.SmartsService,this.logger=this.features.Logger,this._api=e.createAPI(this,[n])}var o=a.prototype;return o.destroy=function(){this._api=null},o.getAPI=function(){return this._api},o._getConsoleFuncOutput=function(t){return t?console.error:console.warn},o._logMessagesOfType=function(t,e,n){if(n&&n.length>0){var i=this._getConsoleFuncOutput(e),s=e?this.logger.error.bind(this.logger):this.logger.warn.bind(this.logger);s&&s(r[t]);try{i&&i(r[t])}catch(t){}n.forEach((function(t){var e=t.caption?t.caption:t;s&&s(e);try{i&&i(e)}catch(t){}}))}},o.executePossibleKeyDriversRequest=function(t,e){var n=this;return e.getModule().then((function(e){var r=e.getAssetId(),i={targetId:t,assetId:r,tempModule:e.getTemporarySessionModuleJSON(),hasShaping:!!e.getShapingId()};return e.saveTemporaryModule().then((function(t){return r!==t&&(i.tempModuleId=t),n._executePossibleKeyDriversRequest(i)}))}))},o._executePossibleKeyDriversRequest=function(t){var e=this,n=this._buildQuery(t);return this.smartsService.runQuery({url:"v1/predict/recommendations",querySpec:n}).then((function(t){var n=t.data,r=[],i=n.predictStatus;return i&&"SUCCESS"!==i.state?e._logMessagesOfType("DIAG_MSG_TYPE",!1,i.diagnostics):n.results&&n.results.recommendedFields&&n.results.recommendedFields.fields&&(r=n.results.recommendedFields.fields),e._logMessagesOfType("WARN_MSG_TYPE",!1,i.warnings),e._logMessagesOfType("ERR_MSG_TYPE",!0,i.errors),{result:"SUCCESS",error:null,possibleDrivers:r,fpdWarnings:i.warnings,fpdErrors:i.errors}}),(function(t){return{result:"ERROR",error:e._errorResponseHandler(t),possibleDrivers:[],fpdWarnings:[],fpdErrors:[]}}))},o._errorResponseHandler=function(e){var n,r,a="fpd_data_source_category";switch(e&&e.code?e.code:0){case i:n=t.get("smart_annotation_unauthorized"),r=t.get("fpd_invalid_data_source");break;case s:a="predict_error",n=t.get("smart_annotation_method"),r=t.get("fpd_network_issue");break;default:n=t.get("smart_annotation_generic_error"),r=t.get("fpd_invalid_data_source")}var o=new Error;return o.message=n,o.code=e.code,o.stack=e.stack,o.caption=r,o.categoryId=a,o},o._buildQuery=function(t){var e={moduleId:t.assetId,targetFieldIDForExpression:t.targetId,tuningParams:{allowCategoryTarget:!0,noCorrelationLimit:!0},shapedModule:t.hasShaping};return t.tempModule&&(e.tempModule=JSON.stringify(t.tempModule)),t.tempModuleId&&(e.tempModuleId=t.tempModuleId),e},o.executeFastPatternDetectionRequest=function(t,e){var n=this;return t.getModule().then((function(t){var r=n._querySpecString(e);return t.queryPredictData(r).then((function(t){return t?t.data:null}),(function(t){var e=n.features["QueryService.internal.error"];return Promise.reject({error:t,errorHandler:e})}))}))},o._querySpecString=function(t){return this.isMockServer?"\\Q"+JSON.stringify(t)+"\\E":JSON.stringify(t)},a}()})),define("@dashboard-features/dataFilters/js/api/DataFiltersAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getFilterList=function(){},e.getFilterSpecList=function(){},e.add=function(){},e.remove=function(){},e.edit=function(){},e.filterExists=function(){},t}()})),define("@dashboard-features/dataFilters/js/DataFiltersAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){var t=this;return this.apiSpec||(this.apiSpec={name:"local filter API",events:{serializeActions:!0,propagationInfo:{namespace:"dataFilters",callStack:{name:"dataFilters",params:[]},info:{supportsUndoRedo:!0,refresh:{dataIfQueryChanged:!0}}},actions:{add:{eventName:"add",isResolvePostResponse:!0,transactionAPI:this.features["Dashboard.Transaction"],transactionParamIndex:2,autoCreateTransaction:!0,getUndoActions:function(e,n){var r=n.id;return t._isLocalFilterType(e[0])?[{name:"remove",params:[{id:r},{}]}]:[]}},edit:{eventName:"edit",transactionAPI:this.features["Dashboard.Transaction"],transactionParamIndex:2,autoCreateTransaction:!0,getUndoActions:function(e){return t._isLocalFilterType(e[0])?[{name:"edit",params:[e[0],t._getExistingFilterValueContext(e[0])]}]:[]}},remove:{eventName:"remove",transactionAPI:this.features["Dashboard.Transaction"],transactionParamIndex:2,autoCreateTransaction:!0,getUndoActions:function(e){var n=[];if(t._isLocalFilterType(e[0])&&t.filterExists(e[0])){var r=t.features.Visualization.getDataSource();r&&n.push({callStack:[{name:".."}],name:"setDataSource",params:[r.getId()]});var i=t._getExistingFilterItemContext(e[0]);n.push({name:"add",params:[i,t._getExistingFilterValueContext(i)]})}return n}}}}}),this.apiSpec},t}()})),define("@dashboard-features/dataFilters/js/DataFilters",["@waca/dashboard-common/js/core/APIFactory","./api/DataFiltersAPI","./DataFiltersAPISpec"],(function(t,e,n){return function(n){function r(t){var e,r=t.content,i=t.dashboardAPI,s=t.features;return(e=n.call(this)||this).content=r,e.dashboard=i,e.features=s,e.dataFiltersInternal=s["DataFilters.internal"],e}_inheritsLoose(r,n);var i=r.prototype;return i.destroy=function(){this.dashboard=null},i.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},i.add=function(t,e,n){return this.dataFiltersInternal.add(t,e,n)},i.edit=function(t,e,n){return this.dataFiltersInternal.edit(t,e,n)},i.remove=function(t,e,n){return this.dataFiltersInternal.remove(t,e,n)},i.getFilterList=function(t){return void 0===t&&(t={contentType:"self"}),this.dataFiltersInternal.getFilterList(t)},i.getFilterSpecList=function(t){return void 0===t&&(t={contentType:"self"}),this.dataFiltersInternal.getFilterSpecList(t)},i._isLocalFilterType=function(t){return!("widget.live"!==this.content.getType()||t&&t.contentType&&"self"!==t.contentType)},i.filterExists=function(t){return void 0===t&&(t={contentType:"self"}),this.dataFiltersInternal.filterExists(t)},i._getExistingFilterItemContext=function(t){return this.dataFiltersInternal.getExistingFilterContextHelper()&&this.dataFiltersInternal.getExistingFilterContextHelper().getExistingFilterItemContext(t)},i._getExistingFilterValueContext=function(t){return this.dataFiltersInternal.getExistingFilterContextHelper()&&this.dataFiltersInternal.getExistingFilterContextHelper().getExistingFilterValueContext(t)},r}(n)})),define("@dashboard-features/dataFilters/js/api/DataFiltersInternalAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getFilterList=function(){},e.getFilterSpecList=function(){},e.add=function(){},e.remove=function(){},e.edit=function(){},e.getExistingFilterContextHelper=function(){},e.filterExists=function(){},t}()})),define("@dashboard-features/dataFilters/js/api/DataFilterAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getContentType=function(){},e.getDataSource=function(){},e.getMetadataColumnList=function(){},e.getColumnIdList=function(){},e.getValueList=function(){},e.isExclude=function(){},t}()})),define("@dashboard-features/dataFilters/js/DataFilter",["@waca/dashboard-common/js/core/APIFactory","./api/DataFilterAPI"],(function(t,e){return function(){function n(t){this.contentType=t.contentType,this.columnIds=t.columnIds,this.dataSource=t.dataSource,this.values=t.values||[],this.exclude=!!t.exclude}var r=n.prototype;return r.destroy=function(){this.dashboard=null},r.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},r.getContentType=function(){return this.contentType},r.getColumnIdList=function(){return this.columnIds},r.getValueList=function(){return this.values},r.getDataSource=function(){return this.dataSource},r.getMetadataColumnList=function(){var t=this;return this.dataSource&&this.columnIds?this.columnIds.map((function(e){return t.dataSource.getMetadataColumn(e)})):[]},r.isExclude=function(){return this.exclude},n}()})),define("@dashboard-features/dataFilters/js/legacy/PageContextHelper",["@waca/dashboard-livewidget/js/filters/Filters","@waca/dashboard-livewidget/js/filters/VisFilterProxy","../DataFilter","underscore"],(function(t,e,n,r){return function(){function i(t){var e=t.content,n=t.features;this.content=e,this.features=n,this.pageContext=this.features["Dashboard.PageContextService"].getPageContext(),this.dataSources=this.features["Dashboard.DataSources"]}var s=i.prototype;return s._isFilterContent=function(t){if(t){var e=t.getContainer().getFeature("FiltersUI");return!(!e||!e.getFilterContent(t.getId()))}return!0},s.getFilterList=function(t){var e=this,r=t.includeVisible?[]:this._buildVisibleColumnIdsMap(t.sourceContext),i=this._getSelectorsFromItemContext(t,!1,!!t.brushingFilters),s=this._getPageContextItemsByTableRelation(i),a=[];return s.forEach((function(i){if("filter"===i.getOrigin()&&!1!==t.includeVisible||!r||!i.getItemIds().every((function(t){return r[t]}))){var s=i.isRange()?e._normalizeRanges(i):e._normalizeTuples(i),o=new n({contentType:e.content.getType(),dataSource:e.dataSources.getDataSource(i.getSourceId()),columnIds:i.getItemIds(),exclude:i.getExclude(),values:s}).getAPI();a.push(o)}})),a},s._normalizeRanges=function(t){var e={};return void 0!==t.getFrom()&&(e.from=t.getFrom()||0),void 0!==t.getTo()&&(e.to=t.getTo()||0),t.getInvert()&&(e.invert=t.getInvert()),[e]},s._normalizeTuplePart=function(t){return t.value=t.value||t.u,t.label=t.label||t.d,t},s._normalizeTuples=function(t){var e=this,n=t.getValues();return n&&n.map((function(t){var n=JSON.parse(JSON.stringify(t));return Array.isArray(n)?n.map((function(t){return e._normalizeTuplePart(t)})):[e._normalizeTuplePart(n)]}))},s._getPageContextTuple=function(t){var e=[];return t.categories&&t.categories.forEach((function(t){return e.push({u:t.value,d:t.label})})),e.length>1?[e]:e},s._getPageContextRanges=function(t){var e=[],n={};return t.ranges&&t.ranges.forEach((function(t){t.range.from&&(n.from=t.range.from),t.range.to&&(n.to=t.range.to),t.range.invert&&(n.invert=t.range.invert)})),e.push(n),e},s.getFilterSpecList=function(t){var e=this._convertToFilterCollection(t);return e&&e.toJSON()},s.add=function(t,e,n,r){var i=this;void 0===r&&(r={}),r=this._applyTransactionToken(n,r);var s=this._getSelectorsFromItemContext(t),a=null;return e.values.forEach((function(t){if(t.categories){var n={command:"update",values:i._getPageContextTuple(t)};void 0!==e.exclude&&(n.exclude=e.exclude),a=i.pageContext.updateFilterContext(s,n,r)}else t.range&&(a=i.pageContext.updateFilterContext(s,{command:"update",condition:t.range},r))})),{id:a&&a.getId()}},s.edit=function(){},s.remove=function(t,e,n){var r=this,i=this._applyTransactionToken(n,i),s=this._getSelectorsFromItemContext(t);if(e&&!1!==e.valuesOnly){if(e.valuesOnly)return this.pageContext.clearPageContextItemValues(s,i);var a=!1;return e.values.forEach((function(t){var e=r.pageContext.updateFilterContext(s,{command:"remove",values:r._getPageContextTuple(t)},i);a=!a||e})),a}return this.pageContext.deletePageContextItems(s,i)},s.clearAll=function(t,e){var n=this._applyTransactionToken(e),r=this._getSelectorsFromItemContext(t);return this.pageContext.clearPageContextItemValues(r,n)},s.filterExists=function(t){var e=this._getSelectorsFromItemContext(t);return!!this.pageContext.getPageContextItem(e)},s._convertToFilterCollection=function(e){var n=e.sourceContext,r=e.includeVisible?[]:n&&this._getMappedSlotList(n),i=new t,s=this._getSelectorsFromItemContext(e,!1,!!e.brushingFilters);return this._getFilterProxy({selectors:s,pageContextItems:this._getPageContextItemsByTableRelation(s,r),input:i,output:i,logger:this.logger}).convertFilters(r,{content:n&&n.content}),i},s._getFilterProxy=function(t){return new e(t)},s._buildVisibleColumnIdsMap=function(t){var e={};t&&this._getMappedSlotList(t).forEach((function(t){t.getDataItemList().forEach((function(t){e[t.getColumnId()]=!0}))}));return e},s._getMappedSlotList=function(t){var e=t&&t.visualization&&t.visualization.getSlots();return e?e.getMappedSlotList():[]},s._getSelectorsFromItemContext=function(t,e,n){void 0===e&&(e=!0);var i={};if(t.includeEmptyFilters&&(i.includeEmptyFilters=!0),t.columnIds){var s=Array.isArray(t.columnIds)?t.columnIds:[t.columnIds];if(e){var a=r.map(s,(function(t){return{hierarchyUniqueName:t}}));i.hierarchies=a}i.hierarchyUniqueNames=s}return i.sourceId=t.dataSourceId,(void 0===(n=void 0===n?t.brushingFilters:n)?!this._isFilterContent(t.sourceContext&&t.sourceContext.content):n)?this._addBrushingSelectors(i,t.sourceContext):this._addFilterSelectors(i,t.sourceContext)},s._addFilterSelectors=function(t,e){if(t.origin="filter",delete t.hierarchies,t.scope="page"===this.content.getType()?this.content.getId():"global",e&&0===e.content.getType().indexOf("widget.live")){var n=e.visualization.getDataSource();t.eventSourceId=e.content.getId(),t.sourceId=t.sourceId||n&&n.getId()}return t},s._addBrushingSelectors=function(t,e,n,r){if(void 0===e&&(e=null),void 0===n&&(n=!1),void 0===r&&(r=null),e&&0===e.content.getType().indexOf("widget.live")){var i=e.visualization.getDataSource();t.eventSourceId=e.content.getId(),t.sourceId=i&&i.getId(),t.eventGroupId=this.features["Dashboard.EventGroups"].getGroupId(e.content.getId())}return t.origin="visualization",t.scope="page"===this.content.getType()?this.content.getId():"global",n&&delete t.eventGroupId,r&&(r.synchDataId&&(t.synchDataId=r.synchDataId),r.isSynchronizedEntry&&(t.isSynchronizedEntry=r.isSynchronizedEntry)),t},s._getPageContextItemsByTableRelation=function(t){var e=this.pageContext.getNetPageContextItems(t)||[];return"page"===this.content.getType()?e.filter((function(t){return"global"!==t.getScope()})):(e.length&&t.sourceId&&t.origin,e)},s._applyTransactionToken=function(t,e){return t&&t.transactionId&&((e=e||{}).payloadData={undoRedoTransactionId:t.transactionId,transactionToken:t}),e},i}()})),define("@dashboard-features/dataFilters/js/legacy/ExistingLocalFilterContextHelper",["underscore","@waca/dashboard-livewidget/js/filters/FilterSpecHelper"],(function(t,e){return function(){function t(t){var e=t.localFiltersCollection,n=t.localFiltersHelper;this._localFiltersCollection=e,this._localFiltersHelper=n}var n=t.prototype;return n.getKey=function(t){if(t.id)return t;if(t.columnIds){if(t.columnIds.length>1)return{id:this._localFiltersCollection.getDataPointFilterKey(t.columnIds)};var e=t.aggregationType?this._localFiltersCollection.FILTERTYPE_ORDINAL:this._localFiltersCollection.FILTERTYPE_CATEGORY;return this._localFiltersCollection.getKey(t.columnIds[0],e,t.aggregationType)}return null},n.getExistingFilterItemContext=function(t){var e=this._getExtraFilterAttributes(t),n=JSON.parse(JSON.stringify(t));return n.columnIds=e.columnIds,e.isModelFilter&&(n.filterType="filter"),n},n.getExistingFilterValueContextByFilterId=function(t){return this._localFiltersHelper.getFilterSpecList().find((function(e){return e.id===t.id}))},n.getExistingFilterValueContext=function(t){var n=this.getExistingFilterValueContextByFilterId(t);if(!n){if(!(n=this._localFiltersHelper.getFilterSpecList().find((function(e){return e.columnId===t.columnIds[0]&&e.aggregationType===t.aggregationType}))))return null;t.id=n.id}if(this._getExtraFilterAttributes(t).isDatapointFilter)return this._datapointFilterSpecToValueContext(n);var r={values:[]};(n.operator&&n.operator.indexOf("not")>=0&&(r.exclude=!0),e.isRange(n))?r=this._buildRangeFromExistingFilter(r,n):n.valueDataItem&&n.values&&0===n.values.length?(delete r.values,r.valueDataItem=n.valueDataItem):n.values.forEach((function(t){r.values.push({categories:[{value:t.u,label:t.d,columnId:n.columnId}]})}));return r},n._buildRangeFromExistingFilter=function(t,e){var n={};switch(n.invert=0===e.operator.indexOf("not"),n.aggregationType=e.aggregationType,e.operator){case"between":case"notbetween":n.from=e.values[0].u||e.values[0].d,n.to=e.values[1].u||e.values[1].d;break;case"lt":case"lte":n.to=e.values[0].u||e.values[0].d;break;case"gt":case"gte":n.from=e.values[0].u||e.values[0].d}return t.values.push({range:n}),t},n._getExtraFilterAttributes=function(t){var e={isDatapointFilter:!1,isModelFilter:!1};if(this._localFiltersCollection){var n=this._localFiltersCollection.get(this.getKey(t).id);n&&(n.isCompound()&&(e.isDatapointFilter=!0),e.columnIds=n.getColumnIds(),e.isModelFilter=n.isModelFilter)}return e},n._datapointFilterSpecToValueContext=function(t){var e={},n=!1,r=function(t){var e=[];return t.forEach((function(t){var n=JSON.parse(JSON.stringify(t));e.push(n),t.values.forEach((function(t){t.u&&(n.value=t.u),t.d&&(n.label=t.d)})),delete n.operator,delete n.values})),{categories:e}};return"not"===t.operator||"or"===t.operator?(e.exclude=!("not"!==t.operator),function t(i){i.forEach((function(i){"or"===i.operator?t(i.values||[]):"and"===i.operator?e.values?e.values.push(r(i.values)):e.values=[r(i.values)]:n=!0}))}(t.values)):"and"===t.operator?e.values=[r(t.values)]:n=!0,n?null:e},t}()})),define("@dashboard-features/dataFilters/js/legacy/LocalFiltersHelper",["underscore","../DataFilter","./ExistingLocalFilterContextHelper","@waca/dashboard-livewidget/js/filters/VisFilterProxy"],(function(t,e,n,r){return function(){function i(t){var e=t.content,n=t.features;this.content=e,this.features=n,this._internal={}}var s=i.prototype;return s._getFilterProxy=function(){return this._internal.filterProxy||(this._internal.filterProxy=new r({input:this._getLocalFiltersCollection(),output:this._getLocalFiltersCollection()})),this._internal.filterProxy},s.getExistingFilterContextHelper=function(){return this._internal.existingFilterContextHelper||(this._internal.existingFilterContextHelper=new n({localFiltersCollection:this._getLocalFiltersCollection(),localFiltersHelper:this})),this._internal.existingFilterContextHelper},s.getFilterList=function(t){var n=this,r=[];if(!t.brushingFilters){var i=this.features.Visualization.getDataSource();this._getLocalFiltersCollection().models.forEach((function(s){var a=!t.columnIds||t.columnIds.every((function(t){return-1!==s.getColumnIds().indexOf(t)})),o=!t.aggregationType||t.aggregationType===s.aggregationType;if(a&&o){var u=new e({contentType:n.content.getType(),columnIds:s.getColumnIds(),dataSource:i,values:n._normalizeValues(s),exclude:0===s.operator.indexOf("not")}).getAPI();r.push(u)}}))}return r},s._normalizeValues=function(t){var e={columnIds:t.getColumnIds(),aggregationType:t.aggregationType},n=this.getExistingFilterContextHelper().getExistingFilterValueContext(e);return n.values&&n.values[0]&&n.values[0].range?[n.values[0].range]:n.values.map((function(t){return t.categories.map((function(t){return{value:t.value,label:t.label}}))}))},s.getFilterSpecList=function(t){var e=this;void 0===t&&(t={contentType:"self"});var n=[];return t.brushingFilters||this._getLocalFiltersCollection().models.forEach((function(r){var i=!t.columnIds||t.columnIds.every((function(t){return-1!==r.getColumnIds().indexOf(t)})),s=!t.aggregationType||t.aggregationType===r.aggregationType;if(i&&s){var a=r.toJSON(["isMissing"]);a.readOnly=!e._isFilterEditable(r),n.push(a)}})),n},s.add=function(e,n,r){t.defaults(n,{action:"keepexclude",exclude:!1});var i=this._updateFilter(e,n,r);return{id:i&&i.id}},s.edit=function(t,e,n){if(this.filterExists(t)){var r=this._updateFilter(t,e,n);return{id:r&&r.id}}},s.remove=function(t,e,n){var r,i=this._applyTransactionToken(n);i&&(i.isApiUndoRedoEvent=!0),t.id?r={id:t.id}:this.filterExists(t)&&(r=this.getExistingFilterContextHelper().getKey(t));var s=this._getLocalFiltersCollection();return!(!r||!s.removeFilterEntry(r))&&(s.allFilterModificationComplete(i),this._onAfterFilterModification(),!0)},s._getLocalFiltersCollection=function(){return this.localFiltersCollection||(this.localFiltersCollection=this.features["Visualization.legacy"].getLegacyManagers().visFilterSupport.getLocalFilters()),this.localFiltersCollection},s._isFilterEditable=function(t){return!t.isAdditionalFilter()&&!t.getIsModelFilter()&&(!t.isRangeOperator()||"pre"!==t.preOrPost||!("fact"===this.features.Visualization.getDataSource().getMetadataColumn(t.columnId).getType()))},s._applyTransactionToken=function(t,e){return t&&t.transactionId&&((e=e||{}).payloadData={undoRedoTransactionId:t.transactionId,transactionToken:t}),e},s.filterExists=function(t){var e=this.getExistingFilterContextHelper().getKey(t);return!!this._getLocalFiltersCollection().getFilterEntry(e)},s._updateFilter=function(e,n,r){var i=this._applyTransactionToken(r),s=this._toLegacyItemContext(e),a=this._toLegacyValueContext(n,!!s.itemId);if(i&&(i.isApiUndoRedoEvent=!0),a.from||a.to){var o=this._getFilterProxy().updateRangeFilter(s,a,i);return this._onAfterFilterModification(),o}var u=null;return!s.itemId&&t.isArray(s.itemIds)?u=this._getFilterProxy().addDataPoints(s,a,i):(a.conditionsInfo&&a.conditionsInfo.conditions&&this._updateFilterDefaults(s,a.conditionsInfo.conditions),u=this._getFilterProxy().updateFilter(s,a,i),this._onAfterFilterModification()),u},s._toLegacyItemContext=function(t){var e=JSON.parse(JSON.stringify(t));return t.columnIds.length>1?e.itemIds=t.columnIds:1===t.columnIds.length&&(e.itemId=t.columnIds[0]),e},s._toLegacyValueContext=function(t,e){var n=JSON.parse(JSON.stringify(t)),r=null;return n.valueDataItem?n:(n.values=e?t.values.map((function(t){if(!t.range)return{u:t.categories[0].value,d:t.categories[0].label};r={exclude:t.range.invert,from:t.range.from,to:t.range.to,aggregationType:t.range.aggregationType,preOrPost:t.range.preOrPost||"post"}})):t.values.map((function(t){return t.categories.map((function(t){return{u:t.value,d:t.label}}))})),r||n)},s._updateFilterDefaults=function(e,n){var r=this,i=n.and||n.or;i?t.each(i,(function(t){r._updateFilterDefaults(e,t)})):n.not?this._defaultConditions(e,n.not):this._defaultConditions(e,n)},s._defaultConditions=function(e,n){t.defaults(n,{itemId:e.itemId,operator:i.CONDITIONS_OPERATORS.CONTAINS,valueType:"display"})},s._onAfterFilterModification=function(){this._getFilterSupport()&&this._getFilterSupport().updateMissingFilters()},s._getFilterSupport=function(){return this.filterSupport||(this.filterSupport=this.features["Visualization.legacy"].getLegacyManagers().visFilterSupport),this.filterSupport},_createClass(i,null,[{key:"CONDITIONS_OPERATORS",get:function(){return{EQUALS:"in",CONTAINS:"containsignorecase",STARTS_WITH:"beginswith",ENDS_WITH:"endswith"}}}]),i}()})),define("@dashboard-features/dataFilters/js/DataFiltersInternal",["@waca/dashboard-common/js/core/APIFactory","./api/DataFiltersInternalAPI","./legacy/PageContextHelper","./legacy/LocalFiltersHelper"],(function(t,e,n,r){return function(){function i(t){var e=t.content,i=t.dashboardAPI,s=t.features,a=t.spec;this.content=e,this.dashboard=i,this.features=s,this.featureModel=a||{},"widget.live"===this.content.getType()?this._legacyFilterHelper=new r({content:this.content,features:this.features}):this._legacyFilterHelper=new n({content:this.content,features:this.features})}var s=i.prototype;return s.destroy=function(){this.dashboard=null},s.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},s.getFilterList=function(t){void 0===t&&(t={contentType:"self"});var e=[],n=this._getPhysicalContentType(t.contentType);if(this.content.getType()!==n&&"all"!==n||(e=this._legacyFilterHelper.getFilterList(t)||[]),n!==this.content.getType()){var r=JSON.parse(JSON.stringify(t));r.sourceContext=t.sourceContext||this._getSourceContext();var i,s=this._getClosestFilterAncestor(this.content.getType());if(s)r.contentType="selection"===t.contentType||"ancestor"===t.contentType?"self":n,(i=e).unshift.apply(i,s.getFilterList(r))}return e},s.getFilterSpecList=function(t){void 0===t&&(t={contentType:"self"});var e=[],n=this._getPhysicalContentType(t.contentType);if(this.content.getType()!==n&&"all"!==n||(e=this._legacyFilterHelper.getFilterSpecList(t)||[]),n!==this.content.getType()){t.sourceContext=t.sourceContext||this._getSourceContext();var r,i=this._getClosestFilterAncestor(this.content.getType());if(i)t.contentType="selection"===t.contentType||"ancestor"===t.contentType?"self":n,(r=e).unshift.apply(r,i.getFilterSpecList(t))}return e},s.add=function(t,e,n){if(!t.contentType||"self"===t.contentType)return this._legacyFilterHelper.add(t,e,n);var r=this._getAncestorInfo(t);return r?r.dataFilters.add(r.itemContext,e,n):void 0},s.edit=function(t,e,n){if(!t.contentType||"self"===t.contentType)return this._legacyFilterHelper.edit(t,e,n);var r=this._getAncestorInfo(t);return r?r.dataFilters.edit(r.itemContext,e,n):void 0},s.remove=function(t,e,n){if(!t.contentType||"self"===t.contentType)return this._legacyFilterHelper.remove(t,e,n);var r=this._getAncestorInfo(t);return r?r.dataFilters.remove(r.itemContext,e,n):void 0},s._getAncestorInfo=function(t){var e=this._getClosestFilterAncestor(this.content.getType()),n=this._getClosestFilterAncestorType(this.content.getType());if(e){var r=JSON.parse(JSON.stringify(t));return r.sourceContext=t.sourceContext,"selection"!==r.contentType&&"ancestor"!==r.contentType&&r.contentType!==n||delete r.contentType,r.sourceContext||(r.sourceContext=this._getSourceContext(),"selection"===t.contentType?r.brushingFilters=void 0===t.brushingFilters?!this._isFilterContent(this.content):t.brushingFilters:r.brushingFilters=void 0!==t.brushingFilters&&t.brushingFilters),{itemContext:r,dataFilters:e}}return null},s._getPhysicalContentType=function(t){return"ancestor"===t?this._getClosestFilterAncestorType(this.content.getType()):"global"===t?"tab":"self"!==t&&t?t:this.content.getType()},s._getClosestFilterAncestorType=function(t){switch(t){case"tab":return null;case"page":return"tab";default:return this._isFilterContent(this.content)?this.content.getContainer().getType():"page"}},s._isFilterContent=function(t){var e=t.getContainer(),n=e&&e.getFeature("FiltersUI");return!(!n||!n.getFilterContent(t.getId()))},s._getClosestFilterAncestor=function(t){for(var e=this._getClosestFilterAncestorType(t),n=e&&this.content.getContainer();n&&e&&n.getType()!==e;)n=n.getContainer();return n&&n.getFeature("DataFilters.internal")},s._getSourceContext=function(){var t={content:this.content};return"widget.live"===this.content.getType()&&(t.visualization=this.features.Visualization),t},s.getExistingFilterContextHelper=function(){return this._legacyFilterHelper.getExistingFilterContextHelper&&this._legacyFilterHelper.getExistingFilterContextHelper()},s.filterExists=function(t){if(void 0===t&&(t={contentType:"self"}),!t.contentType||"self"===t.contentType)return this._legacyFilterHelper.filterExists(t);var e=this._getAncestorInfo(t);return e?e.dataFilters.filterExists(e.itemContext):void 0},i}()})),define("@dashboard-features/dataFilters/js/query/DataFiltersQueryUtils",["underscore"],(function(t){return function(){function e(){}return e.convertExcludeEmptyValuesFilters=function(e,n){var r=[],i=t.filter(e,(function(t){var e=!("notin"!==t.operator||t.values&&t.values.length||t.conditions);return e||r.push(t),e}));return i&&i.forEach((function(t){if(!n.getMetadataColumn(t.columnId).isOlapColumn()){var e={id:t.id||t.columnId,itemId:t.columnId},i={operator:"in",columnId:e.itemId};i.values=[{u:e.itemId,d:e.itemId}],r.push(i)}})),r},e.findFirstKeyOfMap=function(t){var e=[];return t.forEach((function(t,n){e.push(n)})),e[0]},e.shouldExcludeNonProjectedRangeFilters=function(t,n){if(!t.size)return!1;var r=e.findFirstKeyOfMap(t),i=e._getCategoryItemsForLayer(t.get(r))||[],s=e._getCategoryItemsForLayer(t.get(n))||[];return e._categoriesAreDifferent(i,s)},e._categoriesAreDifferent=function(e,n){return t.difference(e||[],n||[]).length>0||t.difference(n||[],e||[]).length>0},e._getCategoryItemsForLayer=function(e){var n=[];return e&&e.forEach((function(e){n.push.apply(n,t.map(e.getDataItemList(),(function(t){return t.getColumnId()})))})),n},e.removeForecastFilters=function(t){var e=new RegExp('"__ibm_ba_forecast__[0-9]*"',"g");return JSON.parse(JSON.stringify(t).replace(e,'""'))},e.getFilterSpecListByVisualization=function(t,e,n){var r=[];if(n.getDataSource()){r.push.apply(r,t.getFilterSpecList({contentType:"all"}));var i=e.getPropertyValue("brushing");!1!==n.getDefinition().getProperty("reactToExternalBrushing")&&"ignoreFilter"!==i&&r.push.apply(r,t.getFilterSpecList({contentType:"all",brushingFilters:!0,includeVisible:"alwaysFilter"===i}))}return r},e}()})),define("@dashboard-features/dataFilters/js/query/DataFiltersQueryModifier",["underscore","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryModifierAPI","./DataFiltersQueryUtils","@waca/dashboard-livewidget/js/filters/FilterQuerySpec"],(function(t,e,n,r,i){return function(){function s(t){var e=t.content,n=t.features;this.content=e,this.visualization=n.Visualization,this.dataFilters=n.DataFilters,this.queryExecution=n.DataQueryExecution,this.queryExecution.registerQueryModifier(this.getAPI())}var a=s.prototype;return a.getAPI=function(){return this.api||(this.api=e.createAPI(this,[n])),this.api},a.getType=function(){return"main"},a.modifyQuerySpecList=function(t){return t=this.modifyQuerySpecListForFilters(t)},a.modifyQuerySpecListForFilters=function(e){var n=this,i=this._getFilterSpecList(),s=r.convertExcludeEmptyValuesFilters(i,this.visualization.getDataSource()),a=this._getFilterQuerySpecList(s,this.visualization);return a&&a.length&&t.each(e,(function(t){var e;t.type===n.getType()&&(t.spec.filters||(t.spec.filters=[]),(e=t.spec.filters).push.apply(e,a))})),e},a._getFilterSpecList=function(){return r.getFilterSpecListByVisualization(this.dataFilters,this.content,this.visualization)},a._getFilterQuerySpecList=function(t,e){var n=new i(e);return n.addFiltersToSpec(t),n.hasFilterSpec()?n.getFilterSpec():[]},s}()})),define("@dashboard-features/dataFilters/js/query/DataFiltersQueryDefinitionModifier",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryDefinitionModifierAPI","./DataFiltersQueryUtils"],(function(t,e,n){return function(){function r(t){var e=t.content,n=t.dashboardAPI,r=t.features;this.content=e,this.dashboard=n,this.queryExecution=r.DataQueryExecution,this.queryExecution.registerQueryDefinitionModifier(this.getAPI()),this.visualization=r.Visualization,this.dataFilters=r.DataFilters}var i=r.prototype;return i.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},i.getType=function(){return"main"},i._getFilterSpecList=function(){return n.getFilterSpecListByVisualization(this.dataFilters,this.content,this.visualization)},i.modifyQueryDefinitionList=function(t){for(var e=this._getFilterSpecList(),r=n.convertExcludeEmptyValuesFilters(e,this.visualization.getDataSource()),i=0;i<t.length;i++){t[i].addFilters(r)}return t},r}()})),define("@dashboard-features/dataFilters/js/query/FilterContentQueryModifier",["./DataFiltersQueryModifier"],(function(t){return function(t){function e(e){var n;return(n=t.call(this,e)||this).isGlobalFilter=e.isGlobalFilter,n}_inheritsLoose(e,t);var n=e.prototype;return n.modifyQuerySpecList=function(t){return this.modifyQuerySpecListForMinAndMax(t),this.isGlobalFilter||(t=this.modifyQuerySpecListForFilters(t)),t},n.modifyQuerySpecListForMinAndMax=function(t){var e=this,n=this.visualization.getSlots().getMappingInfoList().map((function(t){return t.dataItem})),r=n&&n.every((function(t){return"fact"===t.getType()})),i=n&&1===n.length&&n[0].isDateOrTimeType();return(r||i)&&n.forEach((function(n){var r=n.getId()+"_min",s=n.getId()+"_max",a=[{id:r,itemId:n.getColumnId(),aggregate:"min"},{id:s,itemId:n.getColumnId(),aggregate:"max"}];t.forEach((function(t){var n,r;t.type===e.getType()&&(t.spec.dataItems||(t.spec.dataItems=[]),(n=t.spec.dataItems).push.apply(n,a),t.spec.projections||(t.spec.projections=[]),(r=t.spec.projections).push.apply(r,a.map((function(t){return t.id}))),i&&(t.spec.dataItems[0].aggregate="min"))}))})),t},n._getFilterSpecList=function(){return this.visualization.getDataSource()&&this.dataFilters.getFilterSpecList({contentType:"tab",includeVisible:!0,columnIds:this._getVisualizationColumnIds()})||[]},n._getVisualizationColumnIds=function(){return this.visualization.getSlots().getMappingInfoList().filter((function(t){return"attribute"===t.dataItem.getType()})).map((function(t){return t.dataItem.getColumnId()}))},e}(t)})),define("@dashboard-features/dataFilters/js/query/FilterContentQueryDefinitionModifier",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryDefinitionModifierAPI","./DataFiltersQueryDefinitionModifier","./DataFiltersQueryUtils"],(function(t,e,n,r){return function(n){function i(t){var e;return(e=n.call(this,t)||this).isGlobalFilter=t.isGlobalFilter,e}_inheritsLoose(i,n);var s=i.prototype;return s.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},s.modifyQueryDefinitionList=function(t){if(!this.isGlobalFilter)for(var e=this._getFilterSpecList(),n=r.convertExcludeEmptyValuesFilters(e,this.visualization.getDataSource()),i=0;i<t.length;i++){t[i].addFilters(n)}return t},s._getFilterSpecList=function(){return this.visualization.getDataSource()&&this.dataFilters.getFilterSpecList({contentType:"tab",includeVisible:!0,columnIds:this._getVisualizationColumnIds()})||[]},s._getVisualizationColumnIds=function(){return this.visualization.getSlots().getMappingInfoList().filter((function(t){return"attribute"===t.dataItem.getType()})).map((function(t){return t.dataItem.getColumnId()}))},i}(n)})),define("@dashboard-features/dataFilters/js/query/CrosstabQueryDefinitionModifier",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-common/js/utils/ContentUtil","@waca/dashboard-livewidget/js/filters/FilterSpecHelper","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryDefinitionModifierAPI"],(function(t,e,n,r){return function(){function i(t){var e=t.content,n=t.dashboardAPI,r=t.features;this.content=e,this.dashboard=n,r.DataQueryExecution.registerQueryDefinitionModifier(this.getAPI()),this.dataFilters=r.DataFilters,this.visualization=r.Visualization}var s=i.prototype;return s.getAPI=function(){return this.api||(this.api=t.createAPI(this,[r])),this.api},s.getType=function(){return"main"},s.modifyQueryDefinitionList=function(t){var e=this;return"Crosstab"===this.visualization.getType()&&t.forEach((function(t){t.setSupportsNonContextualTopBottom(!1),e._modifyFilters(t)})),t},s._modifyFilters=function(t){var e=this,r=this.visualization.getDataSource(),i=this._getUnionedDataItemList(this.visualization);i.length>0&&this._getBrushedFiltersByVisualization().forEach((function(s){for(var a=s.columnId?[s.columnId]:n.getSelectedCompoundFilterColumnIds([s]),o=function(){var n=e._getHierarchyMetadatColumn(r,r.getMetadataColumn(a[u]));if(n&&i.find((function(t){var i=e._getHierarchyMetadatColumn(r,t.getMetadataColumn());return i&&n.getId()===i.getId()})))return t.removeFilters([s]),"break"},u=0;u<a.length;u++){if("break"===o())break}}))},s._getBrushedFiltersByVisualization=function(){var t=this.dashboard.getFeature("EventGroups"),n=this.dashboard.getFeature("GlobalFilters"),r=[],i=this.visualization.getDataSource(),s=this.dashboard.getAppConfig("pageContainerType"),a=e.getPageContent(this.content,s),o=a&&a.getId();if(i&&!1!==this.visualization.getDefinition().getProperty("reactToExternalBrushing")){var u=t.getGroupId(this.content.getId());r.push.apply(r,n.getFilterList({origin:"visualization",sourceId:i.getId(),scope:o,eventGroupId:u},this.content.getId()))}return r.filter((function(t){return!t.filterBins}))},s._getHierarchyMetadatColumn=function(t,e){return!e||e.isHierarchy()?e:this._getHierarchyMetadatColumn(t,e.getParent())},s._getUnionedDataItemList=function(t){var e=[];return t.getSlots().getDataItemList().forEach((function(t){e.push.apply(e,t.getUnion().getDataItemList())})),e},i}()})),define("@dashboard-features/dataFilters/js/DataFilterProviders",["./query/DataFiltersQueryModifier","./query/DataFiltersQueryDefinitionModifier","./query/FilterContentQueryModifier","./query/FilterContentQueryDefinitionModifier","./query/CrosstabQueryDefinitionModifier"],(function(t,e,n,r,i){return function(){function s(s){var a=s.content,o=s.dashboardAPI,u=s.features;this.content=a,this.dashboard=o,this.features=u,this.featureChecker=this.dashboard.getGlassCoreSvc(".FeatureChecker");var c=this._isFilterContent(this.content);this.isDataFiltersEnabled()&&(c?(this.queryModifier=new n({content:a,features:u,isGlobalFilter:this._isGlobalFilter(this.content)}),this.queryDefinitionModifier=new r({content:a,features:u,isGlobalFilter:this._isGlobalFilter(this.content)})):(this.queryModifier=new t({content:a,features:u}),this.queryDefinitionModifier=new e({content:a,features:u}))),c||(this.crosstabQueryDefinitionModifier=new i({content:a,dashboardAPI:o,features:u}))}var a=s.prototype;return a._isFilterContent=function(t){var e=t.getContainer(),n=e&&e.getFeature("FiltersUI");return!(!n||!n.getFilterContent(t.getId()))},a._isGlobalFilter=function(t){return"tab"===t.getContainer().getType()},a.isDataFiltersEnabled=function(){return this.featureChecker.checkValue("dashboard","DataFilters","enabled")},a.destroy=function(){this.dashboard=null},a.getAPI=function(){return{}},s}()})),define("@dashboard-features/dssQueryService/js/poweredBy/PoweredByProvider",["underscore","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryModifierAPI","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryDefinitionModifierAPI"],(function(t,e,n,r){var i={qfb:"dbtypes"};return function(){function t(t){var e=t.content,n=t.features;this.content=e,this._features=n,this.queryExecution=n.DataQueryExecution,this.queryExecution.registerQueryModifier(this.getAPI()),this.queryExecution.registerQueryDefinitionModifier(this.getAPI()),this.queryExecution.registerQueryPostProcessor(this),this.content.on("change:state:status",this.onStateChange,this)}var s=t.prototype;return s.getAPI=function(){return this.api||(this.api=e.createAPI(this,[n,r])),this.api},s.getType=function(){return"main"},s.modifyQuerySpecList=function(t){return this.queryExecution.addRequestOptions(i),t},s.modifyQueryDefinitionList=function(t){return this.queryExecution.addRequestOptions(i),t},s.process=function(t){var e=this.content.getId();this._features["Dashboard.PoweredBy"].set(e,[]);var n=this._getDataSourceTypeInfo(t);n&&this._features["Dashboard.PoweredBy"].set(e,n.split(","))},s._getDataSourceTypeInfo=function(t){var e=t.meta.messages,n=(void 0===e?[]:e).find((function(t){return"dbtypes"===t.type}));return n&&n.message},s.onStateChange=function(t){if("rendered"===t.info.value){var e=this._features.RenderSequence,n=e&&e.getTaskResult("data")||{};if(!Object.keys(n).length){var r=this.content.getId();this._features["Dashboard.PoweredBy"].set(r,[])}}},t}()})),define("@dashboard-features/forecast/js/Forecast",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/forecast/api/ForecastAPI","underscore","@waca/dashboard-common/js/utils/CommonUtil","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,r,i){"use strict";return function(){function s(t){var e=t.content,n=t.features;this.features=n,this.content=e,this.visualization=n["Visualization.internal"],this.logger=n["Dashboard.Logger"],this.forecastResponse=null,this.executionServiceMessages={},this.statisticalDetails=[],this.dateItemCache=new Map,this._forecasting=void 0,this._registerEvents()}var a=s.prototype;return a.getAPI=function(){return this.api||(this.api=t.createAPI(this,[e])),this.api},a.isForecastEnabled=function(){return!!this._getForecastOptionsFromModel().toggleEnabled},a.areThereValidForecastSettings=function(){var t=!this.visualization.hasUnavailableMetadataColumns()&&this.visualization.getSlots().isMappingComplete()&&this._getCurrentForecastSettings();return!!t&&!n.isEmpty(t)},a.setForecastMessages=function(t){if(this.executionServiceMessages=t,this.messageListener&&this.messageListener.setForecastMessages){var e=this._getCurrentForecastState(),n=this._getMessagesForForecasts(e);this.messageListener.setForecastMessages(n)}},a.clearForecastIndicatorMessages=function(){this.executionServiceMessages={},this.messageListener&&this.messageListener.clearForecastIndicatorMessages&&this.messageListener.clearForecastIndicatorMessages()},a.removeMessageListener=function(){this.messageListener=null},a.addMessageListener=function(t){this.messageListener=t},a.getForecastDisplayState=function(){var t={toggleEnabled:this._getCurrentToggleEnabledState(),settings:this._getCurrentForecastSettings()},e=this.getMultivariatesState();return e&&(t.multivariates=e),t},a.getForecastInfo=function(){var t={annotations:[],captions:{}};return this._getCurrentToggleEnabledState()&&(t=JSON.parse(JSON.stringify(this.forecastResponse)),this._appendModelOptions(t)),t},a.getForecastSettings=function(){return this._getCurrentToggleEnabledState()?this._getCurrentForecastSettings():[]},a.resetForecastSettings=function(){this.forecastResponse=null},a.toggleStateChanged=function(t){var e=n.clone(this._getForecastOptionsFromModel());e.toggleEnabled=t,this._updateForecastState(e)},a._isSettingValueDefined=function(t){return void 0!==t.value&&null!==t.value},a.applyStateChange=function(t){var e=this,n={toggleEnabled:t.toggleEnabled,settings:this._forecasting&&this._forecasting.settings?r.deepClone(this._forecasting.settings):{},multivariates:this._forecasting&&this._forecasting.multivariates};t.multivariates&&(n.multivariates=t.multivariates);var i={"forecast.isShown":n.toggleEnabled,"forecast.numOptionalFactors":n.multivariates?n.multivariates.length:0};t.settings.forEach((function(t){e._isSettingValueDefined(t)?n.settings[t.id]=t.value:delete n.settings[t.id]})),this._trackInfo(t.settings,i),this._updateForecastState(n)},a.whenForecastSuggestionsReady=function(t,e){if(e)try{this.forecastResponse=this._parseForecastSuggestions(t)}catch(t){this.logger.error(t),this.forecastResponse={annotations:[],captions:{}}}else this.forecastResponse={annotations:[],captions:{}};return Promise.resolve(this.forecastResponse)},a.setQueryResult=function(t){this.queryResult=t},a.getQueryResult=function(){return this.queryResult},a.preQueryExecution=function(t,e){var n=this;this.setQueryResult(null),e&&(this.dateItemCache.clear(),t.dataset.forEach((function(t){t.dataItems.forEach((function(t){t.items&&t.items.length&&t.itemClass.h.forEach((function(e,r){n._isRepresentDate(e.u)&&t.items.forEach((function(t){var e=n._getISOValue(t.t[r].label);n.dateItemCache.set(t.t[r].u,t.t[r].label),t.t[r].d=e}))}))}))})))},a._onChangePropertyForecasting=function(t){void 0===t&&(t={});var e=t.info||{};this._forecasting=e.value},a._getISOValue=function(t){if(n.isNull(t))return t;var e=new Date(t);return isNaN(e.getTime())?t:e.toISOString()},a._isRepresentDate=function(t){var e=this.visualization.getDataSource().getMetadataColumn(t);if(!e)return!1;var n=e.getTaxonomyList()||[],r=!1;return!e.isDateTimeDataType()&&n.length&&"cTime"===n[0].getClass()&&"cDate"===n[0].getFamily()&&(r=!0),r},a.postQueryExecution=function(t){var e=this;this.setQueryResult(t),t.getResult(t.getQueryResultIdList()[0]).getResultItemList().forEach((function(t){var r=t.getRowCount();r&&t.getDataItemList().forEach((function(i,s){if(e._isRepresentDate(i.getColumnId()))for(var a=0;a<r;a++){var o=t.getValue(a),u=e.dateItemCache.get(o[s].u);n.isUndefined(u)||(o[s].d=u)}}))})),this.dateItemCache.clear()},a.hasForecastData=function(){if(!this.supportsForecasts())return!1;var t=this.getForecastInfo(),e=t&&t.annotations;return!(!e||!e.length)},a._getForecastResponseAnnotationSettings=function(){var t=this.forecastResponse&&this.forecastResponse.annotations||[];return t.length?t[0].modelParameters:[]},a._getCurrentForecastSettings=function(){var t=this._getForecastOptionsFromModel(),e=this._getForecastResponseAnnotationSettings();return e.forEach((function(e){var n=e.id;t&&t.settings&&void 0!==t.settings[n]&&null!==t.settings[n]?e.value=t.settings[n]:"confidenceLevel"===e.id||"ignoreLastNPeriods"===e.id?e.value=e.default:delete e.value})),e},a._appendModelOptions=function(t){var e=this._getForecastOptionsFromModel(),r=t.annotations.find((function(t){return"TIME_SERIES"===t.type}));r&&!n.isEmpty(e.settings)&&(r.modelOptions=e.settings)},a._getMessagesForForecasts=function(t){var e={},r=this.executionServiceMessages;return n.forEach(Object.keys(t),(function(t){e[t]=r[t]})),e},a._updateForecastState=function(t,e){var r=this._getForecastOptionsFromModel();n.isEqual(r,t)||(this._forecasting=t,this.content.setPropertyValue("forecasting",t,e))},a._getForecastOptionsFromModel=function(){return this._forecasting||(this._forecasting=this.content.getPropertyValue("forecasting")||{settings:{}}),this._forecasting},a._getCurrentToggleEnabledState=function(){var t=this._getForecastOptionsFromModel();return!!t.toggleEnabled&&!(!t.toggleEnabled||!this.forecastResponse)},a._parseForecastSuggestions=function(t){var e={},r=["TIME_SERIES"];return t.captions&&r.forEach((function(n){t.captions[n]&&(e[n]=t.captions[n])})),t?{annotations:t.annotations?n.filter(t.annotations,(function(t){return-1!==r.indexOf(t.type)})):[],captions:t.captions?e:{}}:{annotations:[],captions:{}}},a._registerEvents=function(){this.content.on("change:property:forecasting",this._onChangePropertyForecasting,this)},a._deregisterEvents=function(){this.content.off("change:property:forecasting",this._onChangePropertyForecasting,this)},a.supportsForecasts=function(){var t=!this.visualization.isPreview()||this.visualization.isPredictPreview();return!!t&&this.visualization.getDefinition().getProperty("supportsForecasts")},a.destroy=function(){this._deregisterEvents(),this.content=null,this.logger=null,this.forecastResponse=null,this.executionServiceMessages=null},a._trackInfo=function(t,e){void 0===e&&(e={});var n=_extends({},{"forecast.isShown":!1,"forecast.isForecastPeriodsAuto":!0,"forecast.isSeasonalPeriodAuto":!0},e);0==t.length&&(t=this._getCurrentForecastSettings()),t.forEach((function(t){"forecastPeriods"===t.id&&t.value?(n["forecast.numForecastPeriods"]=t.value,n["forecast.isForecastPeriodsAuto"]=!1):"ignoreLastNPeriods"===t.id?n["forecast.numLastPeriodsIgnored"]=t.value:"confidenceLevel"===t.id?n["forecast.confidenceLevel"]=t.value:"seasonalityPeriod"===t.id&&t.value&&(n["forecast.numSeasonalPeriod"]=t.value,n["forecast.isSeasonalPeriodAuto"]=!1)}));var r=this.features.LiveWidgetSegment;r&&r.track({visualization:this.visualization,info:n,category:"forecast"})},a.hasStatisticalDetails=function(){var t=this.getQueryResult();return!(!t||!t.getStatisticalDetails().length)},a.getMultivariatesState=function(){return this._getForecastOptionsFromModel().multivariates},a.getMultivariatesInfoList=function(){var t=this._getForecastOptionsFromModel(),e=r.deepClone(t.multivariates||[]),n=this.visualization.getDataSource();return e.forEach((function(t){var e=n.getMetadataColumn(t.columnId);t.isMissing=!e,t.label=e?e.getLabel():i.get("missingColumn",{columnLabel:t.columnId})})),e},s}()})),define("@dashboard-features/forecast/js/ForecastQueryModifier",["underscore","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryModifierAPI","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/DataQueryUtils"],(function(t,e,n,r){return function(){function t(t){var e=t.content,n=t.features;this.content=e,n.DataQueryExecution.registerQueryModifier(this.getAPI())}var i=t.prototype;return i.getAPI=function(){return this.api||(this.api=e.createAPI(this,[n])),this.api},i.getType=function(){return"main"},i.modifyQuerySpecList=function(t){return r.removeForecastFilters(t)},t}()})),define("@dashboard-features/insightsNarrator/js/DataVisInsightsQueryParams",[],(function(){return function(){function t(t,e){this.datasetId=t,this.version=e,this.dataItems=[],this.dataItemLabels=[],this.roles=[],this.dataItemsTypes=[],this.moduleAssetId=null,this.isShapedModule=!1,this.tempModuleJSON=null}var e=t.prototype;return e.addParam=function(t,e,n,r,i,s){void 0===s&&(s=null),r=r||t.getDefinition().getRole();var a=!1;i&&i.isOlapPackage&&(a=i.isOlapPackage());var o=!!s&&!!s.getShapingId(),u=s&&s.getTemporarySessionModuleJSON(),c=n&&t.isStacked()?t.getDefinition().getId():e.getId();if(!n&&e.getMetadataColumn()&&e.getMetadataColumn().isOlapColumn(a))return!1;if("response"===r){if(n||!e.getBinning())return this.dataItems.push(c),this.dataItemLabels.push(e.getLabel()),this.dataItemsTypes.push(this._getDataItemType(e)),this.moduleAssetId=i&&i.getAssetId(),this.roles.push(r),!0}else if(n)return this.isShapedModule=o,this.dataItems.push(c),this.dataItemLabels.push(e.getLabel()),this.dataItemsTypes.push(this._getDataItemType(e)),this.moduleAssetId=i&&i.getAssetId(),this.roles.push(r),this.tempModuleJSON=u,!0;return!1},e.addDSSRowCountCalculation=function(t,e,n){return this.addParam(t,e,!1,"response",n)?this.getParams(["rowCount"]):null},e.hasParams=function(){return this.dataItems.length>0&&this.roles.length>0||!1},e._getDataItemType=function(t){var e=t.getMetadataColumn(),n=e&&e.getTaxonomyList(),r=t.getType();return["datetime","time","date"].indexOf(r)>-1||n&&n.length&&"cTime"===n[0].getClass()?"datetime":"attribute"===r?"categorical":"fact"===r?"continuous":""},e.getParams=function(t){var e={shapedModule:this.isShapedModule,datasetId:this.datasetId,dataItems:this.dataItems,dataItemsTypes:this.dataItemsTypes,roles:this.roles,moduleAssetId:this.moduleAssetId,reqStats:t||["rowCount","sumSqr"],type:"chartInsights"};return this.isShapedModule&&(e.tempModule=JSON.stringify(this.tempModuleJSON)),"2"===this.version&&(e.dataItemLabels=this.dataItemLabels),e},t}()})),define("@dashboard-features/insightsNarrator/js/DataVisInsightsQuerySpec",["./DataVisInsightsQueryParams"],(function(t){return function(){function e(t,e,n){this.dashboard=t,this.content=e,this.visualization=n,this._previousDssQuerySpecs={}}var n=e.prototype;return n.queryChanged=function(t){var e=this,n={};t.getQueryResultIdList().forEach((function(r){var i=t.getResult(r),s=i&&i.getPropertyValue("QuerySpec.internal");n[r]=!e._previousDssQuerySpecs[r]||s!==e._previousDssQuerySpecs[r]}));var r=Object.values(n).some((function(t){return!0===t}));return r},n._getInsightsNarratorQuerySpecs=function(t){var e=this,n=[];return this._previousDssQuerySpecs={},t&&t.getResult&&t.getQueryResultIdList().forEach((function(r){var i=t.getResult(r),s=i&&i.getPropertyValue("RawData.internal"),a=i&&i.getPropertyValue("QuerySpec.internal");e._previousDssQuerySpecs[r]=a;var o=a&&JSON.parse(a),u=s&&JSON.parse(s),c=e._buildQuerySpecFromUnprocessedDSSResponse(u,o,r);c&&n.push(c)})),n},n._buildQuerySpecFromUnprocessedDSSResponse=function(t,e,n){if(t&&t.data&&n){var r,i,s=this._getChartInsightsDictionary(n,t.version),a=this.visualization.getDataSource(),o=this.dashboard.getFeature("DataSources.moser").getModule(a.getId());if(!!o&&!!o.getShapingId()){r="module";var u=o&&o.getTemporarySessionModuleJSON();i=u&&u.use&&u.use[0]}else r=a.getType(),i=s.moduleAssetId;var c=this.content.getFeature("InsightsNarrator").getPinIdList(),l={data:{data:t.data,dataItems:this._getExecutionDataItemsDef(t.dataItems),hasNext:t.hasNext,version:t.version},params:{dictionary:s,savedInsightsIds:c,queryContext:{queryDatasetsId:i,querySpec:e,type:r}}};return t.edges&&(delete l.data.dataItems,l.data.edges=t.edges),l}return null},n._getExecutionDataItemsDef=function(t){var e=this;return t&&t.map((function(t){return e._processResultDataItem(t)}))},n._processResultDataItem=function(t){return t.itemClass.h.length>1?this._processNestedResultDataItem(t):t},n._processNestedResultDataItem=function(t){var e=this.visualization.getSlots();return e?{itemClass:{h:t.itemClass.h.map((function(t){return{id:e.getDataItemList().filter((function(e){return e.getId()===t.id}))[0].getId(),u:t.u,d:t.d}})),id:t.itemClass.id},items:t.items}:t},n._containsOlap=function(){var t=this.content.getFeature("Visualization.olapContentHelper");return t&&t.likelyContainsOlap()},n.getInsightsCalculations=function(e){var n=this;if(void 0===e&&(e=[]),this._buildRolesById(e),this._containsOlap())return[];var r={},i={},s=this.visualization.getDataSource(),a=this.visualization.getSlots().getMappingInfoList();a.forEach((function(e){e.slot.getDefinition().getDatasetIdList().forEach((function(a){i[a]=i[a]||new t(a);var o=n.roleById[e.dataItem.getId()]||e.slot.getDefinition().getRole(),u="response"===e.slot.getDefinition().getRole()?"response":o;i[a].addParam(e.slot,e.dataItem,!1,u,s)&&(r[e.dataItem.getId()]=1)}))}));var o=[];for(var u in o=o.concat(e),i)i[u].hasParams()&&o.push(i[u].getParams());return o=o.concat(this._addRowCountCalculationsForAverages(r,a,s))},n._addRowCountCalculationsForAverages=function(e,n,r){var i=[];return n.forEach((function(n){n.slot.getDefinition().getDatasetIdList().forEach((function(s){var a=new t(s),o=n.slot.getDefinition().getType(),u=n.dataItem.getType(),c=n.dataItem.getAggregation();if(("ordinal"===o||"fact"===u&&"any"===o)&&"avg"===c&&!e[n.dataItem.getId()]){var l=a.addDSSRowCountCalculation(n.slot,n.dataItem,r);l&&i.push(l)}}))})),i},n._buildRolesById=function(t){var e=this;this.roleById={},t&&t.forEach((function(t){t.dataItems.forEach((function(n,r){e.roleById[n]=t.roles[r]}))}))},n._isMultiMeasureSlot=function(t){return!!t.getDataItemList().find((function(t){return"_multiMeasuresSeries"==t.getColumnId()}))},n._getChartInsightsDictionary=function(e,n){var r=this,i=new t(e,n),s=this.visualization.getSlots().getMappingInfoList(),a=this.visualization.getDataSource(),o=a&&a.getId(),u=this.dashboard.getFeature("DataSources.moser").getModule(o);return s.forEach((function(t){var n=t.slot;-1===n.getDefinition().getDatasetIdList().indexOf(e)||r._isMultiMeasureSlot(n)||i.addParam(t.slot,t.dataItem,!0,void 0,a,u)})),i.getParams()},e}()})),define("@dashboard-features/insightsNarrator/js/BaseInsightsProvider",[],(function(){return function(){function t(t){var e=t.content,n=t.features,r=t.insightsNarrator;this.dashboard=n.API,this.visualization=n.Visualization,this.content=e,this._insightsNarrator=r}var e=t.prototype;return e.destroy=function(){this.content=null,this.dashboard=null,this.visualization=null,this._insightsNarrator=null},e.getCurrentInsights=function(){return this._insightsNarrator.getCurrentInsights()},e.updateInsightsFromSmartsResponse=function(t){var e,n=(void 0===(e=t)&&(e=[]),{insights:e});return this.updateCNSInsights(n),n},e.updateCNSInsights=function(t){void 0===t&&(t=this.getCurrentInsights()),this._insightsNarrator.updateCNSInsights(t)},e._getUniqueInsights=function(t){var e={};return t.forEach((function(t){e[t.id]||(e[t.id]=t)})),Object.values(e)},e.executeQuerySpecs=function(t){var e=this;void 0===t&&(t=[]);var n=[],r=this.dashboard.getFeature("SmartsService");return t.forEach((function(t){return n.push(e._runSmartsQuery(t,r))})),n.length>0?Promise.all(n).then((function(t){var n=[];return t.forEach((function(t){t.data&&t.data.insights&&(n=n.concat(t.data.insights))})),e._getUniqueInsights(n)})):Promise.resolve([])},e._getNLT=function(){var t=this.content.getFeature("WidgetAPI.deprecated");return t&&t.getFeature("vis-chart-insights")},e._runSmartsQuery=function(t,e){var n="v1/predict/chart-insights-v2";this._getNLT()&&(n="v1/predict/explore/chart-insights");var r={url:n,querySpec:t,sender:"getInsights"};return e.runQuery(r).catch((function(){return[]}))},e.insightsNarratorQuerySupported=function(){return!1!==(this.visualization&&this.visualization.getDefinition()).getProperty("supportsNarrativeInsights")},e.getInsightsCalculations=function(){return null},e.getInsights=function(){throw new Error("getInsights must be overridden in the provider subclasses!")},t}()})),define("@dashboard-features/insightsNarrator/js/DataVisInsightsProvider",["./DataVisInsightsQuerySpec","./BaseInsightsProvider"],(function(t,e){return function(e){function n(n){var r,i=n.content,s=n.features,a=n.insightsNarrator;(r=e.call(this,{content:i,features:s,insightsNarrator:a})||this).content=i,r._insightsNarrator=a;var o=s.API;return r.visualization=s.Visualization,r._dataQueryExecution=s["DataQueryExecution.internal"],r._insightsQuerySpecHelper=new t(o,r.content,r.visualization),r}_inheritsLoose(n,e);var r=n.prototype;return r.destroy=function(){this.content=null,this._insightsQuerySpecHelper=null,this._insightsNarrator=null,this._dataQueryExecution=null},r.insightsNarratorQuerySupported=function(){return!!this.visualization&&(!this.visualization.getDefinition().getProperty("noDataQuery")&&(!!this.visualization.getSlots().getMappedSlotList().some((function(t){return t.getDefinition().getRole()}))&&e.prototype.insightsNarratorQuerySupported.call(this)))},r.getInsightsCalculations=function(t){return this.insightsNarratorQuerySupported()?this._insightsQuerySpecHelper.getInsightsCalculations(t):t},r.getInsights=function(){var t=this,e=this._dataQueryExecution.getCurrentQueryResults();return this._insightsQuerySpecHelper.queryChanged(e)||!e?this._dataQueryExecution.executeQueries().then((function(e){return t.executeInsightsNarratorQueryUsingDataQueryResults(e)})):this.getCurrentInsights()?(this.updateCNSInsights(),Promise.resolve(this.getCurrentInsights())):this.executeInsightsNarratorQueryUsingDataQueryResults(e)},r.executeInsightsNarratorQueryUsingDataQueryResults=function(t){var e=this,n=this._insightsQuerySpecHelper._getInsightsNarratorQuerySpecs(t);return this.executeQuerySpecs(n).then((function(t){return e.updateInsightsFromSmartsResponse(t)}))},n}(e)})),define("@dashboard-features/insightsNarrator/js/DriverVisInsightsProvider",["./BaseInsightsProvider"],(function(t){return function(t){function e(e){var n,r=e.content,i=e.features,s=e.insightsNarrator;return(n=t.call(this,{content:r,features:i,insightsNarrator:s})||this).content=r,n._insightsNarrator=s,n._fnFPDUpdateHandler=n.onFPDResponseBuildQuerySpecs.bind(_assertThisInitialized(n)),n._registerFPDUpdateHandler(n._fnFPDUpdateHandler),n}_inheritsLoose(e,t);var n=e.prototype;return n.destroy=function(){this._deregisterFPDUpdateHandler(),this.content=null,this._insightsNarrator=null,this._fnFPDUpdateHandler=null,this._lastChartInsightsResponse=null,this._querySpecs=null,this._prevQuerySpecsJSON=null},n.getInsights=function(){return this._querySpecsChanged()||!this.getCurrentInsights()?(this._setQuerySpecs(this._querySpecs),this.executeInsightsNarratorQueryUsingDrivers()):(this.updateCNSInsights(),Promise.resolve(this.getCurrentInsights()))},n.executeInsightsNarratorQueryUsingDrivers=function(){var t=this;return this._prevQuerySpecsJSON=JSON.stringify(this._querySpecs||{}),this.executeQuerySpecs(this._querySpecs).then((function(e){return t._lastChartInsightsResponse=e,t.updateInsightsFromSmartsResponse(e)}))},n.getKeyDriversAPI=function(){var t=this.content.getFeature("VisKeyDrivers");return t&&t.isVisKeyDriversFeatureEnabled()?t:null},n._registerFPDUpdateHandler=function(){var t=this.getKeyDriversAPI();return t&&t.registerUpdateHandler&&t.registerUpdateHandler(this._fnFPDUpdateHandler)},n._deregisterFPDUpdateHandler=function(){var t=this.getKeyDriversAPI();t&&t.deregisterUpdateHandler&&t.deregisterUpdateHandler(this._fnFPDUpdateHandler)},n.onFPDResponseBuildQuerySpecs=function(t,e){if(e&&"FPD"===e.type&&(this._setQuerySpecs(t),this._insightsNarrator.shouldRequestInsights())){if(this._querySpecsChanged())return this.executeInsightsNarratorQueryUsingDrivers();this.updateInsightsFromSmartsResponse(this._lastChartInsightsResponse)}return Promise.resolve()},n._setQuerySpecs=function(t){void 0===t&&(t=[]),this._querySpecs=Array.isArray(t)?t:[t]},n._querySpecsChanged=function(){return JSON.stringify(this._querySpecs)!==this._prevQuerySpecsJSON},e}(t)})),define("@dashboard-features/insightsNarrator/js/InsightsNarratorAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){var t=this;return this.apiSpec||(this.apiSpec={name:"insights narrator API",events:{serializeActions:!0,propagationInfo:{namespace:"insightsNarrator",callStack:{name:"insightsNarrator",params:[]},info:{supportsUndoRedo:!0}},actions:{updateCNSInsights:{eventName:"updateCNSInsights",getInfo:function(t){return{value:t[0],supportsUndoRedo:!1}}},setPinIdList:{eventName:"setPinIdList",getInfo:function(t){return{value:t[0],supportsUndoRedo:!0}},getUndoActions:function(){return[{name:"setPinIdList",params:[t.getPinIdList()]}]}},pin:{eventName:"pin",getInfo:function(t){return{value:t[0],supportsUndoRedo:!1}}},unPin:{eventName:"unPin",getInfo:function(t){return{value:t[0],supportsUndoRedo:!1}}},reOrderPinned:{eventName:"reOrderPinned",getInfo:function(t){return{value:t,supportsUndoRedo:!1}}}}}}),this.apiSpec},t}()})),define("@dashboard-features/insightsNarrator/js/InsightsNarratorTask",["@waca/dashboard-livewidget/js/visualizations/renderer/sequence/BaseTask"],(function(t){return function(t){function e(e,n){var r;return(r=t.call(this,e)||this)._shouldRequestInsights=n.shouldRequestInsights,r._executeInsightsNarratorQuery=n.executeInsightsNarratorQuery,r}return _inheritsLoose(e,t),e.prototype.process=function(t){var e=this;return this._shouldRequestInsights&&this._shouldRequestInsights()&&t&&t.data&&this._executeInsightsNarratorQuery(t.data).catch((function(t){var n=t&&t.message;e.logger.log("Execution of insights-narrator query failed",n)})),Promise.resolve(t)},e}(t)})),define("@dashboard-features/insightsNarrator/js/api/InsightsNarratorAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.shouldShowInsightsNarrator=function(){},e.shouldShowVisIndicatorForInsightsNarrator=function(){},e.shouldRequestInsights=function(){},e.getInsights=function(){},e.getCurrentInsights=function(){},e.updateCNSInsights=function(){},e.getInsightsCalculations=function(){},e.getToggleState=function(){},e.setToggleState=function(){},e.setPinIdList=function(){},e.on=function(){},e.off=function(){},e.getPinIdList=function(){},e.reOrderPinned=function(){},e.pin=function(){},e.unPin=function(){},t}()})),define("@dashboard-features/insightsNarrator/js/InsightsNarrator",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-common/js/utils/CommonUtil","./DataVisInsightsProvider","./DriverVisInsightsProvider","./InsightsNarratorAPISpec","./InsightsNarratorTask","./api/InsightsNarratorAPI","@waca/dashboard-livewidget/js/features/widget/renderSequence/api/RenderStepProviderAPI"],(function(t,e,n,r,i,s,a,o){return function(i){function u(e){var s,u=e.content,c=e.features,l=e.spec;return(s=i.call(this)||this).dashboard=c.API,s.visualization=c.Visualization,s.content=u,s._featureModel=l||{},s._api=t.createAPIFromSpec([{implementation:_assertThisInitialized(s),interface:a},{implementation:_assertThisInitialized(s),interface:o}]),c.RenderSequence.registerRenderStepProvider(s.getAPI()),s._dataVisInsightsProvider=new n({content:u,features:c,insightsNarrator:s.getAPI()}),s._driverVisInsightsProvider=new r({content:u,features:c,insightsNarrator:s.getAPI()}),s._getInsightsProvider(),s}_inheritsLoose(u,i);var c=u.prototype;return c.destroy=function(){this.dashboard=null,this.content=null,this.visualization=null,this._insightsProvider=null,this._featureModel=null,this._dataVisInsightsProvider.destroy(),this._driverVisInsightsProvider.destroy(),this._api=null},c.getAPI=function(){return this._api},c.getInsights=function(){return this.shouldRequestInsights()?this._getInsightsProvider().getInsights():Promise.resolve({})},c.getCurrentInsights=function(){return this._cnsInsightsResponse},c.updateCNSInsights=function(t){this._cnsInsightsResponse=t},c._getNLT=function(){var t=this.content.getFeature("WidgetAPI.deprecated");return t&&t.getFeature("vis-chart-insights")},c._isFeatureEnabled=function(){return!this.dashboard.getGlassCoreSvc(".FeatureChecker").checkValue("dashboard","InsightsNarrator","disabled")},c._hasContentSelected=function(){var t=this.dashboard.getCanvas(),e=t&&t.getSelectedContentList();return!(!this.content||!e||1!==e.length)&&this.content.getId()===e[0].getId()},c.useFPDAsInsightsInput=function(){var t=this.visualization&&this.visualization.getDefinition();return t&&(this._useFPDAsInsightsInput=t.getProperty("useFPDAsInsightsInput")),this._useFPDAsInsightsInput},c._getInsightsProvider=function(){return this._insightsProvider=this.useFPDAsInsightsInput()?this._driverVisInsightsProvider:this._dataVisInsightsProvider,this._insightsProvider},c.getInsightsCalculations=function(t){return this.shouldRequestInsights()?this._getInsightsProvider().getInsightsCalculations(t):[]},c.shouldShowInsightsNarrator=function(){return this._hasContentSelected()&&this.shouldShowVisIndicatorForInsightsNarrator()},c.shouldShowVisIndicatorForInsightsNarrator=function(){return!(!this._isFeatureEnabled()||this._getNLT())&&(!this.visualization.hasUnavailableMetadataColumns()&&this.visualization.getSlots().isMappingComplete()&&this._getInsightsProvider().insightsNarratorQuerySupported())},c.shouldRequestInsights=function(){return this.getToggleState()&&this.shouldShowInsightsNarrator()},c.getToggleState=function(){return!!this._featureModel.toggleEnabled},c.setToggleState=function(t){this._featureModel.toggleEnabled=t},c.toJSON=function(){return this._featureModel},c.setPinIdList=function(t){this._featureModel.pinIdList=t},c.getPinIdList=function(){return this._featureModel.pinIdList||[]},c.executeInsightsNarratorQuery=function(t){return!this.useFPDAsInsightsInput()&&this._dataVisInsightsProvider.executeInsightsNarratorQueryUsingDataQueryResults(t)||Promise.resolve({})},c.getRenderStepList=function(){return[{id:"insightsNarrator",module:s,throwOnError:!0,dependencies:["data"],moduleOptions:{shouldRequestInsights:this.shouldRequestInsights.bind(this),executeInsightsNarratorQuery:this.executeInsightsNarratorQuery.bind(this)}}]},c.reOrderPinned=function(t,n){var r=function(t,e){return 0<=t&&t<e.length},i=e.clone(this.getPinIdList());if(r(t,i)&&r(n,i)){var s=i[t];i[t]=i[n],i[n]=s,this.getAPI().setPinIdList(i)}},c.pin=function(t){-1===this.getPinIdList().indexOf(t)&&this.getAPI().setPinIdList([t].concat(this.getPinIdList()))},c.unPin=function(t){this.getAPI().setPinIdList(this.getPinIdList().filter((function(e){return t!==e})))},u}(i)})),define("@dashboard-features/predictQuery/js/keyDrivers/api/VisKeyDriversAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.isVisKeyDriversFeatureEnabled=function(){},e.setPossibleKeyDrivers=function(){},t}()})),define("@dashboard-features/predictQuery/js/keyDrivers/api/VisPossibleKeyDriversAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.refreshPossibleKeyDrivers=function(){},e.getPossibleKeyDrivers=function(){},e.getPossibleKeyDriversErrorState=function(){},e.getEnabledPossibleKeyDrivers=function(){},t}()})),define("@dashboard-features/predictQuery/js/keyDrivers/api/VisFastPatternDetectionAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.executeFastPatternDetectionRequest=function(){},e.registerUpdateHandler=function(){},e.deregisterUpdateHandler=function(){},t}()})),define("@dashboard-features/predictQuery/js/keyDrivers/api/VisKeyDriversScopingAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getKeyDriversScopingInfo=function(){},e.possibleKeyDriverSelectionStateChanged=function(){},t}()})),define("@dashboard-features/predictQuery/js/keyDrivers/VisPossibleKeyDrivers",["@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources","underscore"],(function(t,e){return function(){function n(t,e,n,r,i,s){this.content=t,this.dashboard=e,this.visualization=n,this.features=s,this.keyDriversQuery=r,this.logger=e.getGlassCoreSvc(".Logger"),this.possibleDriversCache={},this.cacheDirty=!1,this.featureModel=i,this.hasSpec=!!this.featureModel.possibleKeyDrivers}var r=n.prototype;return r.destroy=function(){this._shapingModelEventHandler&&(this._shapingModelEventHandler.remove(),this._shapingModelEventHandler=null)},r.getMaxPossibleKeyDrivers=function(){return 250},r.refreshPossibleKeyDrivers=function(t,e,n){if(void 0===e&&(e=!0),void 0===n&&(n=!1),n&&!this.infoIndicator&&(this.infoIndicator=this.features.InfoIndicator),n&&this._clearWarningsAndErrorsFromIndicator(),this.visualization.getSlots().isMappingComplete()){if(this.errorState&&this.errorState.inErrorState)return this.errorState={},this._getKeyDrivers({targetId:t,useModelData:e,useInfoIndicator:n});if(this.cacheDirty)return this._getKeyDrivers({targetId:t,useModelData:e,useInfoIndicator:n});if(this._useCache(t))return n&&this._addWarningsAndErrorsToInfoIndicator(this.possibleDriversCache[t].messages),Promise.resolve(this.possibleDriversCache[t]);var r=this.getPossibleKeyDrivers();if(e&&r&&r[t]){var i=r[t],s=i.messages;return this._cacheKeyDrivers(t,i),n&&this._addWarningsAndErrorsToInfoIndicator(s),Promise.resolve(this.possibleDriversCache[t])}return this._getKeyDrivers({targetId:t,useModelData:e,useInfoIndicator:n})}return Promise.resolve({})},r._getKeyDrivers=function(t){var e=this,n=t.targetId,r=t.useModelData,i=void 0===r||r,s=t.useInfoIndicator,a=void 0!==s&&s;return this._queryForPossibleKeyDriversForTargetId(n).then((function(t){var r=t.possibleKeyDrivers,s=t.messages,o=r.length>250?r.splice(0,250):r;a&&e._addWarningsAndErrorsToInfoIndicator(s);var u=e._getFormattedDriversDescription(o,null,s);return e._saveKeyDriversInModelAndCache(u,n,i),Promise.resolve(e.possibleDriversCache[n])}))},r.getPossibleKeyDriversErrorState=function(){return{inErrorState:!(!this.errorState||void 0===this.errorState.inErrorState)&&this.errorState.inErrorState,caption:this.errorState&&this.errorState.error?this.errorState.error.caption:""}},r.getCurrentResponse=function(t){return this.possibleDriversCache[t]},r.getEnabledPossibleKeyDrivers=function(t){var n=[],r=this.getCurrentResponse([t]);if(r){var i=e.filter(r.recommendedDrivers,(function(t){return t.selected})),s=e.filter(r.nonRecommendedDrivers,(function(t){return t.selected})),a=i.concat(s);n=e.pluck(a,"fieldIDForExpression")}return{possibleKeyDrivers:n,errorState:this.errorState}},r._useCache=function(t){var e=this.possibleDriversCache&&this.possibleDriversCache[t],n=e&&e.recommendedDrivers;return n&&n.length>0},r._cacheKeyDrivers=function(t,e){var n=this;this._shapingModelEventHandler||this.visualization.getDataSource().getModule().then((function(t){return n._shapingModelEventHandler=t.on("shapingmodel:changed",n._onShapingModelChanged.bind(n))})),this.possibleDriversCache[t]=JSON.parse(JSON.stringify(e)),this.cacheDirty=!1},r._onShapingModelChanged=function(t){"REMOVE"===t.action&&(this.cacheDirty=!0)},r.setPossibleKeyDrivers=function(t){var e=this;return Object.keys(t).forEach((function(n){e._cacheKeyDrivers(n,t[n])})),this._setPossibleKeyDrivers(t),!0},r._setPossibleKeyDrivers=function(t){this.featureModel.possibleKeyDrivers=t},r._saveKeyDriversInModelAndCache=function(t,e,n){if(this._cacheKeyDrivers(e,t),n){var r={};r[e]=t,this._setPossibleKeyDrivers(r)}},r._queryForPossibleKeyDriversForTargetId=function(t){var e=this;return this.keyDriversQuery.executePossibleKeyDriversRequest(t,this.visualization.getDataSource()).then((function(t){var n=[];return"SUCCESS"===t.result?(e.errorState={},n=t.possibleDrivers):(e.errorState={inErrorState:!0,error:t.error},e.logger.error(t.error)),n&&n.forEach((function(t){t.selected=!0})),{possibleKeyDrivers:n,messages:{fpdWarnings:t.fpdWarnings,fpdErrors:t.fpdErrors}}}))},r._getFormattedDriversDescription=function(t,e,n){return{recommendedDrivers:t||[],nonRecommendedDrivers:e||[],messages:n||{}}},r._getMessagesForInfoIndicator=function(t,e,n){var r=[];return n.forEach((function(t){r.push({id:t.id,label:t.caption})})),{id:t,label:e,items:r}},r._addWarningsAndErrorsToInfoIndicator=function(e){if(e&&(e.fpdWarnings||e.fpdErrors)&&this.infoIndicator){var n=e.fpdWarnings,r=e.fpdErrors,i=[];i.push(this._getMessagesForInfoIndicator("fpd_response_errors",t.get("fpd_response_errors"),r)),i.push(this._getMessagesForInfoIndicator("fpd_response_warnings",t.get("fpd_response_warnings"),n)),this.infoIndicator.update(i)}},r._clearWarningsAndErrorsFromIndicator=function(){this.infoIndicator&&this.infoIndicator.clearMessagesWithIds(["fpd_response_warnings","fpd_response_errors"])},r.getPossibleKeyDrivers=function(){if(!this.featureModel.possibleKeyDrivers&&!this.hasSpec){var t=this.content.getFeature("WidgetAPI.deprecated"),e=t&&t.getVisApi();e&&(this.featureModel.possibleKeyDrivers=e.getPossibleKeyDrivers(),e&&e.setPossibleKeyDrivers(void 0,{silent:!0})),this.hasSpec=!0}return this.featureModel.possibleKeyDrivers},_createClass(n,null,[{key:"FPD_RESPONSE_ERRORS",get:function(){return"fpd_response_errors"}},{key:"FPD_RESPONSE_WARNINGS",get:function(){return"fpd_response_warnings"}}]),n}()})),define("@dashboard-features/predictQuery/js/keyDrivers/VisFastPatternDetection",["@waca/dashboard-livewidget/js/features/content/dataQueryExecution/DataQueryUtils","@waca/dashboard-livewidget/js/filters/FilterQuerySpec","@waca/dashboard-livewidget/js/features/dashboard/prompts/PromptsState"],(function(t,e,n){return function(){function r(t,e,n){this.content=t,this.dashboard=e,this.visualization=n.Visualization,this.keyDriversQuery=n.KeyDriversQuery,this._promptStateByTarget={},this._updateHandlers=[]}var i=r.prototype;return i.destroy=function(){var t=this;Object.keys(this._promptStateByTarget).forEach((function(e){delete t._promptStateByTarget[e]})),this._promptStateByTarget=null},i.executeFastPatternDetectionRequest=function(t,e,r,i,s,a){var o=this;void 0===i&&(i=null),void 0===s&&(s=!1),void 0===a&&(a=!0);var u={version:"1.1",targetId:t,inputs:e,filters:this._getPredictFilters(),dataFilters:this._getDataFilters(),methods:r||["drivers"]};return i&&(u.parameterValues=i),this._promptStateByTarget[t]||(this._promptStateByTarget[t]=new n),this.keyDriversQuery.executeFastPatternDetectionRequest(this.visualization.getDataSource(),u).then((function(e){return o._resetPromptState(t,a),a&&o._callUpdateHandlers(e,{type:"FPD"}),e}),(function(n){var i=n.error;return n.errorHandler.handleQueryError({error:i,promptsState:o._promptStateByTarget[t],visualization:o.visualization,content:o.content,isPreview:s,primary:a}).then((function(n){var u=n.promptInfoList;return u&&u.length?o.executeFastPatternDetectionRequest(t,e,r,u,s,a):(o._resetPromptState(t,a),Promise.reject(i))}))}))},i.registerUpdateHandler=function(t){var e=this;return this._updateHandlers.find((function(e){return e===t}))||this._updateHandlers.push(t),{remove:function(){return e.deregisterUpdateHandler(t)}}},i.deregisterUpdateHandler=function(t){var e=this;return this._updateHandlers.find((function(n,r){if(n===t)return e._updateHandlers.splice(r,1),!0}))===t},i._callUpdateHandlers=function(t,e){this._updateHandlers.forEach((function(n){n(t,e)}))},i._getPredictFilters=function(){var t=[],e=this.visualization.getSlots().getSlotList()[0].getDataItemList(),n=e&&e.length?e[0].getTopBottom():null;return n&&"topcount"===n.type&&t.push({topcount:n.value}),t},i._getDataFilters=function(){var n=this.visualization.getLocalFilters().getFilterList(),r=t.convertExcludeEmptyValuesFilters(n,this.visualization.getDataSource()),i=t.getFilterSpecListByVisualization(this.content,this.dashboard),s=t.convertExcludeEmptyValuesFilters(i,this.visualization.getDataSource()),a=new e(this.visualization);return a.addFiltersToSpec(r),a.addFiltersToSpec(s),a.hasFilterSpec()?a.getFilterSpec():[]},i._resetPromptState=function(t,e){var n=this;if(this._promptStateByTarget[t].hasInProgressPrompts())this._promptStateByTarget[t].reset();else if(e){Object.keys(this._promptStateByTarget).some((function(t){return n._promptStateByTarget[t].hasInProgressPrompts()}))||this.visualization.getSavedPrompts().reset()}},r}()})),define("@dashboard-features/predictQuery/js/keyDrivers/VisKeyDriversScoping",["underscore"],(function(t){return function(){function e(t,e,n,r){this.content=t,this.dashboard=e,this.visualization=n,this.possibleKeyDrivers=r}var n=e.prototype;return n.destroy=function(){},n.setAPI=function(t){this._api=t},n.getKeyDriversScopingInfo=function(t){var e=t.getColumnId(),n=this.getPossibleKeyDriversDisplayState(e),r=n.recommendedDrivers,i=n.nonRecommendedDrivers,s=[].concat(r,i).filter((function(t){return!0===t.selected})),a=r.map((function(t){return t.fieldIDForExpression})),o=s.map((function(t){return t.fieldIDForExpression}));return{initialFieldIds:o.length?o:a,recommendedFieldIds:a,recommendedDrivers:r}},n.getPossibleKeyDriversDisplayState=function(t){var e=this.possibleKeyDrivers.getCurrentResponse(t);return this._getFormattedDisplayStateFromDriverDescription(t,e)},n.possibleKeyDriverSelectionStateChanged=function(t,e){this._removeColumnLabelsFromDisplayStates(e);var n=this.possibleKeyDrivers.getPossibleKeyDrivers(),r=JSON.parse(JSON.stringify(n[t]||this.possibleKeyDrivers.getCurrentResponse(t)));if(this._haveSelectedKeyDriversChanged(e.recommendedDrivers,r.recommendedDrivers)||this._haveSelectedKeyDriversChanged(e.nonRecommendedDrivers,r.nonRecommendedDrivers)){r.recommendedDrivers=e.recommendedDrivers,r.nonRecommendedDrivers=e.nonRecommendedDrivers;var i={};i[t]=r,this._api.setPossibleKeyDrivers(i),this.possibleKeyDrivers.getCurrentResponse(t).recommendedDrivers=e.recommendedDrivers,this.possibleKeyDrivers.getCurrentResponse(t).nonRecommendedDrivers=e.nonRecommendedDrivers}},n._haveSelectedKeyDriversChanged=function(e,n){void 0===n&&(n=[]);var r=null;return e.length!==n.length&&(r=!0),0===e.length&&0===n.length&&(r=!1),null===r&&(r=t.find(n,(function(n){var r;return!((r=t.find(e,(function(t){return t.fieldIDForExpression===n.fieldIDForExpression||t.selected===n.selected})))&&t.isEqual(r,n))}))),!!r},n._getFormattedDisplayStateFromDriverDescription=function(t,e){var n=this._addColumnLabelsToTheDriverDesc(e),r=n.recommendedDrivers||[],i=n.nonRecommendedDrivers||[],s=[].concat(r,i).filter((function(t){return!0===t.selected})),a=this._getUnrecommendedColumns(t);return{recommendedDrivers:r,searchableColumns:a,nonRecommendedDrivers:i,maxPossibleDrivers:this._getMaxPossibleDrivers(r,a),selectedDrivers:s,formattedDriverDesc:e}},n._removeColumnLabelsFromDisplayStates=function(t){t.recommendedDrivers&&t.recommendedDrivers.forEach((function(t){t.label&&delete t.label}))},n._addColumnLabelsToTheDriverDesc=function(t){var e=this,n=t?{}:null;return t&&t.recommendedDrivers&&(n=JSON.parse(JSON.stringify(t))).recommendedDrivers.forEach((function(t){var n=e.visualization.getDataSource().getMetadataColumn(t.fieldIDForExpression);n&&(t.label=n.getLabel())})),n},n._getUnrecommendedColumns=function(t){var e=this,n=this.visualization.getDataSource(),r=[];return n.getMetadataColumnList().filter((function(n){e._isMetadataColumnNonRecommended(t,n)&&r.push({fieldIDForExpression:n.getId(),label:n.getLabel()})})),r},n._getMaxPossibleDrivers=function(t,e){var n=t.length+e.length,r=this.possibleKeyDrivers.getMaxPossibleKeyDrivers();return n>r?r:n},n._isMetadataColumnNonRecommended=function(t,e){var n=!1,r=e.getType();if(("fact"===r||"attribute"===r)&&!e.isHidden()){var i=e.getId(),s=this.possibleKeyDrivers.getCurrentResponse(t);s&&s.recommendedDrivers&&s.recommendedDrivers.find((function(t){return t.fieldIDForExpression===i}))||i===t||(n=!0)}return n},e}()})),define("@dashboard-features/predictQuery/js/keyDrivers/KeyDriversTask",["@waca/dashboard-livewidget/js/visualizations/renderer/sequence/BaseTask","@waca/dashboard-livewidget/js/visualizations/vipr/VIPRUtils"],(function(t,e){"use strict";var n=t.extend({init:function(t,e){n.inherited("init",this,arguments),this.visKeyDrivers=e.visKeyDrivers,this.visualization=e.visualization},process:function(t){var e=this;return this._isStepComplete(t,"keyDrivers")?Promise.resolve(t):this._getPossibleDrivers().then((function(n){return e._completeStep(t,"keyDrivers",n),t})).catch((function(){return t}))},_getPossibleDrivers:function(){return this.visualization.getSlots().isMappingComplete()&&e.doesConfigPropertyMatchExpected(this.visualization.getDefinition().getId(),"supportsPossibleKeyDrivers",!0)?this.visKeyDrivers.refreshPossibleKeyDrivers(this._getTargetId(),!0,!0):Promise.resolve([])},_getTargetId:function(){return this.visualization.getSlots().getMappedSlotList()[0].getDataItemList()[0].getColumnId()}});return n})),define("@dashboard-features/predictQuery/js/keyDrivers/VisKeyDriversAPISpec",[],(function(){return function(){function t(){}return t.prototype.getAPISpec=function(){var t=this;return this.apiSpec||(this.apiSpec={name:"possibleKeyDrivers API",events:{propagationInfo:{namespace:"possibleKeyDrivers",callStack:{name:"visKeyDrivers"},info:{supportsUndoRedo:!0,refresh:{predictSuggestions:!0,keyDrivers:!0,data:!0}}},actions:{setPossibleKeyDrivers:{eventName:"setPossibleKeyDrivers",getInfo:function(t){return{possibleKeyDrivers:t?t[0]:void 0}},getUndoActions:function(){var e=t.featureModel.possibleKeyDrivers;return[{name:"setPossibleKeyDrivers",params:[e?JSON.parse(JSON.stringify(e)):void 0]}]},isTriggerEvent:function(t,e){return!e||1!==e.length||JSON.stringify(t)!==JSON.stringify(e[0])}}}}}),this.apiSpec},t}()})),define("@dashboard-features/predictQuery/js/keyDrivers/VisKeyDrivers",["@waca/dashboard-common/js/core/APIFactory","./api/VisKeyDriversAPI","./api/VisPossibleKeyDriversAPI","./api/VisFastPatternDetectionAPI","./api/VisKeyDriversScopingAPI","./VisPossibleKeyDrivers","./VisFastPatternDetection","./VisKeyDriversScoping","@waca/dashboard-livewidget/js/features/widget/renderSequence/api/RenderStepProviderAPI","./KeyDriversTask","./VisKeyDriversAPISpec"],(function(t,e,n,r,i,s,a,o,u,c,l){return function(l){function d(c){var d,g=c.content,h=c.dashboardAPI,f=c.features,p=c.spec;return(d=l.call(this)||this).content=g,d.dashboard=h,d.featureModel=p||{},d.visualization=f.Visualization,d.possibleKeyDrivers=new s(g,d.dashboard,d.visualization,f.KeyDriversQuery,d.featureModel,f),d.fastPatternDetection=new a(g,d.dashboard,f),d.keyDriversScoping=new o(g,d.dashboard,d.visualization,d.possibleKeyDrivers),d._api=t.createAPIFromSpec([{implementation:_assertThisInitialized(d),interface:e},{implementation:d.possibleKeyDrivers,interface:n},{implementation:d.fastPatternDetection,interface:r},{implementation:d.keyDriversScoping,interface:i}]),d.keyDriversScoping.setAPI(d._api),d._renderTaskApi=t.createAPI(_assertThisInitialized(d),[u]),f.RenderSequence.registerRenderStepProvider(d._renderTaskApi),d}_inheritsLoose(d,l);var g=d.prototype;return g.destroy=function(){this.possibleKeyDrivers.destroy(),this.fastPatternDetection.destroy(),this.keyDriversScoping.destroy(),this.possibleKeyDrivers=null,this.fastPatternDetection=null,this.keyDriversScoping=null,this._api=null,this._renderTaskApi=null},g.getAPI=function(){return this._api},g.toJSON=function(){return this.featureModel},g.setPossibleKeyDrivers=function(t){return this.possibleKeyDrivers.setPossibleKeyDrivers(t)},g.getRenderStepList=function(){return[{id:"keyDrivers",dependencies:["visSpec"],blocks:["data"],throwOnError:!0,module:c,moduleOptions:{visKeyDrivers:this.getAPI(),visualization:this.visualization}}]},g.isVisKeyDriversFeatureEnabled=function(){return!0},d}(l)})),define("@dashboard-features/smartAnnotations/js/api/SmartSuggestionsAPI",[],(function(){return function(){function t(){}return t.prototype.whenReady=function(){},t}()})),define("@dashboard-features/smartAnnotations/js/SuggestionTask",["@waca/dashboard-livewidget/js/visualizations/renderer/sequence/BaseTask"],(function(t){return function(t){function e(e,n){var r;return(r=t.call(this,e)||this).visualization=n.visualization,r.smartAnnotations=n.smartAnnotations,r.executeSuggestions=n.executeSuggestions,r}return _inheritsLoose(e,t),e.prototype.process=function(t){var e=this;if(this._isStepComplete(t,"predictSuggestions"))return Promise.resolve(t);if(this.visualization.getDataSource()&&this.visualization.getSlots().isMappingComplete()){var n=this.smartAnnotations.supportsAnnotations();return this.executeSuggestions(t).then((function(r){return n||e.smartAnnotations.resetAnnotations(),e._completeStep(t,"predictSuggestions",r),t})).catch((function(n){return e.logger.error("An error occurred while waiting for the annotation suggestions to be ready",n,e.visAPI),t}))}return Promise.resolve(t)},e}(t)})),define("@dashboard-features/smartAnnotations/js/AnnotationTask",["underscore","@waca/dashboard-livewidget/js/visualizations/renderer/sequence/BaseTask"],(function(t,e){return function(e){function n(t,n){var r;return(r=e.call(this,t)||this).visualization=n.visualization,r.forecast=n.forecast,r.smartAnnotations=n.smartAnnotations,r.infoIndicator=n.infoIndicator,r.executeAnnotations=n.executeAnnotations,r.getNonAnnotatableReasons=n.getNonAnnotatableReasons,r}_inheritsLoose(n,e);var r=n.prototype;return r._requiresAnnotationRender=function(t){return t.extraInfo&&t.extraInfo.annotationRequest||this.smartAnnotations.getEnabledAnnotations().length>0},r._requiresForecastRender=function(t){return t.extraInfo&&t.extraInfo.forecastRequest||this._getForecastAnnotations().length>0},r._getForecastAnnotations=function(){return this.forecast.getForecastInfo&&this.forecast.getForecastInfo().annotations||[]},r.process=function(e){var n=this;if(this._isStepComplete(e,"annotation"))return Promise.resolve(e);var r=this.getNonAnnotatableReasons();if(r.descriptions.length>0){var i=t.flatten(r.descriptions);-1!==r.nonAnnotatableFeatures.indexOf("forecast")&&this.forecast.setQueryResult(null),this._clearAnnotationErrorsAndWarnings(),this.infoIndicator&&this.infoIndicator.update(i)}return this.isSameQuery(e)?Promise.resolve(e):!this._requiresAnnotationRender(e)&&!this._requiresForecastRender(e)||r.allLayers?(e.extraInfo&&e.extraInfo.annotationRequest&&this._completeStep(e,"annotation",null),Promise.resolve(e)):this.visualization.getSlots().isMappingComplete()&&!this.visualization.hasUnavailableMetadataColumns()&&(this.smartAnnotations.supportsAnnotations()||this.forecast.supportsForecasts())?this.executeAnnotations(this.getRenderState().getFullRenderContext()).then((function(t){return n._completeStep(e,"annotation",t),e})).catch((function(t){return n._handleAnnotationServiceFailure(e,t)})):Promise.resolve(e)},r._handleAnnotationServiceFailure=function(t,e){return this.logger.error("An error occured while waiting for the annotation to be ready",e,this.visAPI),this._completeStep(t,"annotation",e),t.extraInfo.annotationRequest?Promise.resolve(t):Promise.reject(t)},r._clearAnnotationErrorsAndWarnings=function(){this.infoIndicator&&this.infoIndicator.clearMessagesWithIds(["smart_errors","smart_warnings","smart_exec_support_warnings","annotation_service_error"])},n}(e)})),define("@dashboard-features/smartAnnotations/js/SmartAnnotationProvider",["@waca/dashboard-livewidget/js/features/widget/renderSequence/api/RenderStepProviderAPI","./api/SmartSuggestionsAPI","@waca/dashboard-common/js/core/APIFactory","./SuggestionTask","./AnnotationTask"],(function(t,e,n,r,i){return function(){function s(t){var e=t.dashboardAPI,n=t.content,r=t.features,i=t.options;r.RenderSequence.registerRenderStepProvider(this.getAPI()),this.dashboard=e,this.features=r,this.content=n,this.options=i||{},this.canvas=r["Dashboard.Canvas"],this.smartsExecution=r.SmartsExecution,this.smartAnnotations=r["SmartAnnotations.deprecated"],this.insightsNarrator=r.InsightsNarrator,this.forecast=r.Forecast,this.visualization=r.Visualization,this.olapContentHelper=r["Visualization.olapContentHelper"];var s=r["Dashboard.DashboardSettings"];this.preExecuteOnLoad=!1!==this.options.preExecuteOnLoad&&!s.get("disableQueryPreExecution"),this.moserDataSources=r["DataSources.moser"]}var a=s.prototype;return a.initialize=function(){if(this._isEnabled())return this.preExecuteOnLoad&&this._preloadSuggestions();this._setCachedResult({})},a._isEnabled=function(){return this.smartAnnotations.isAnnotationsEnabled()||this.forecast.isForecastEnabled()||this.insightsNarrator&&this.insightsNarrator.shouldRequestInsights()},a._isNLTEnabled=function(){var t=this.features["WidgetAPI.deprecated"];return!(!t||!t.getFeature("vis-chart-insights"))},a._preloadSuggestions=function(){var t=this.canvas.getContent().getChildren(),e=t.length&&this.canvas.getSelectedContentList({type:t[0].getType()});return!!(e&&e.length&&e[0].getContent(this.content.getId()))?this.executeSuggestions({},!0):Promise.resolve(this._setCachedResult(null))},a._setCachedResult=function(t){return this._cachedResult=t},a._getCachedResult=function(){var t=this._cachedResult;return this._cachedResult=null,t&&!Object.keys(t).length&&this._isNLTEnabled()&&(t=null),t},a.getAPI=function(r){return"suggestions"===r?(this.internalApi||(this.internalApi=n.createAPI(this,[e])),this.internalApi):(this.api||(this.api=n.createAPI(this,[t])),this.api)},a.getRenderStepList=function(){return[{id:"predictSuggestions",dependencies:["visView"],blocks:["data"],throwOnError:!0,module:r,moduleOptions:{smartAnnotations:this.smartAnnotations,visualization:this.visualization,executeSuggestions:this.executeSuggestions.bind(this)}},{id:"annotation",dependencies:["render"],throwOnError:!0,module:i,moduleOptions:{forecast:this.forecast,smartAnnotations:this.smartAnnotations,visualization:this.visualization,executeAnnotations:this.executeAnnotations.bind(this),infoIndicator:this.features.InfoIndicator,featureChecker:this.dashboard.getGlassCoreSvc(".FeatureChecker"),getNonAnnotatableReasons:this.smartsExecution.getNonAnnotatableReasons.bind(this)}}]},a.whenReady=function(){return this._ready?this._ready:this.executeSuggestionsWhenReady()},a.executeSuggestions=function(t,e){var n=this;void 0===e&&(e=!1);var r={},i=this._getCachedResult();return i?(r=i,Promise.resolve(r)):this.executeSuggestionsWhenReady(t).then((function(t){return e?n._setCachedResult(t):t}))},a.executeSuggestionsWhenReady=function(t){var e=this;if(this.visualization.getSlots().isMappingComplete()){var n=this.visualization.getDataSource();if(n)return this._ready=n.loadMetadata().then((function(){return e._executeSuggestions(t)})),this._ready}return Promise.resolve({})},a._executeSuggestions=function(t){void 0===t&&(t={});var e=this.smartAnnotations.supportsAnnotations(),n=this.forecast.supportsForecasts();if(e||n){var r=[];return this.olapContentHelper.containsOlap()&&r.push("olap"),e&&r.push("annotatable"),n&&r.push("forecasting"),this.smartsExecution.execute({renderContext:t,target:this.smartsExecution.TARGETS.SUGGESTIONS,sender:"executeSuggestions",tags:r})}return Promise.resolve({})},a.executeAnnotations=function(t){var e=this,n=this.visualization.getDataSource(),r=this.moserDataSources.getModule(n.getId()),i=n.getAssetId(),s={renderContext:t,target:this.smartsExecution.TARGETS.EXECUTIONS,sender:"executeAnnotations",moduleId:i,tempModule:r.getTemporarySessionModuleJSON(),shapedModule:!!r.getShapingId()};return r.saveTemporaryModule().then((function(t){return i!==t&&(s.tempModuleId=t),e.smartsExecution.execute(s)}))},s}()})),define("@dashboard-features/smartAnnotations/js/SmartAnnotations",["underscore","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/smartAnnotations/api/SmartAnnotationsAPI","@waca/dashboard-livewidget/js/features/content/smartAnnotations/api/DeprecatedSmartAnnotationsAPI"],(function(t,e,n,r){return function(){function i(t){var i=t.content,s=t.features;this.content=i,this.visualization=s["Visualization.internal"],this.widgetModel=s["Models.internal"].getWidgetModel(),this._api=e.createAPI(this,[n]),this._deprecated=e.createAPI(this,[n,r]),this._annotationRenderDeferred=null}var s=i.prototype;return s.getAPI=function(t){return"deprecated"===t?this._deprecated:this._api},s.isAnnotationsEnabled=function(){return!!this._getCurrentAnnotationState().toggleEnabled},s.supportsAnnotations=function(){var t=!this.visualization.isPreview()||this.visualization.isPredictPreview();return!!t&&this.visualization.getDefinition().getProperty("supportsAnnotations")},s.getEnabledAnnotations=function(){var t=[];if(this._getCurrentToggleEnabledState()){var e=this._getCurrentEnabledAnnotationIds();this.annotationResponse.annotations.forEach(function(n){-1!==e.indexOf(n.type)&&t.push(n)}.bind(this))}return t},s.hasAnnotations=function(){return!!this.supportsAnnotations()&&!!this.getEnabledAnnotations().length},s.getAllSuggestedAnnotations=function(){return this.annotationResponse&&this.annotationResponse.annotations||[]},s.areThereValidInsights=function(){if(this.visualization.hasUnavailableMetadataColumns()||!this.visualization.getSlots().isMappingComplete())return!1;var t=!(!this.annotationResponse||!this.annotationResponse.annotations)&&this.annotationResponse.annotations.length>0,e=!!this.fpdMessages;return t||e},s.addFPDInsightMessages=function(t){this.fpdMessages=t,this.messageListener&&this.messageListener.setFPDMessages&&this.messageListener.setFPDMessages(t)},s.areThereValidFPDMessages=function(){return!!this.fpdMessages},s.setAnnotationMessages=function(t){if(this.exectutionServiceMessages=t,this.messageListener&&this.messageListener.setSmartAnnotationMessages){var e=this._getDisplayableAnnotations(),n=this._getMessagesForEnabledAnnotations(e);this.messageListener.setSmartAnnotationMessages(n)}},s.clearInsightsIndicatorMessages=function(){this.exectutionServiceMessages={},this.fpdMessages=null,this.messageListener&&this.messageListener.clearInsightsIndicatorMessages&&this.messageListener.clearInsightsIndicatorMessages()},s._getMessagesForEnabledAnnotations=function(t){var e={},n=this.exectutionServiceMessages;return t.forEach((function(t){t.checked&&n&&n[t.id]&&(e[t.id]=n[t.id])})),e},s.removeMessageListener=function(){this.messageListener=null},s.addMessageListener=function(t){this.messageListener=t},s.getAnnotationDisplayState=function(){var t=this._getDisplayableAnnotations();return{toggleChecked:this._getCurrentToggleEnabledState(),annotations:t,messages:this._getMessagesForEnabledAnnotations(t),fpdMessages:this.fpdMessages}},s.resetAnnotations=function(){this.annotationResponse=null},s.toggleStateChanged=function(e){var n=t.clone(this._getCurrentAnnotationState());n.toggleEnabled=e,this._updateAnnotationState(n)},s.annotationSelectionStateChanged=function(e){var n=t.clone(this._getCurrentAnnotationState()),r=e.id,i=n.selectedAnnotations?n.selectedAnnotations.slice():[];if(e.checked)-1===i.indexOf(r)&&i.push(r);else{var s=i.indexOf(r);s>-1&&i.splice(s,1)}n.selectedAnnotations=i,this._updateAnnotationState(n)},s._setInitialAnnotationState=function(){var e=t.clone(this._getCurrentAnnotationState());e&&e.hasOwnProperty("toggleEnabled")||(e.selectedAnnotations=this.annotationResponse.annotations?t.pluck(this.annotationResponse.annotations,"type"):[],this._updateAnnotationState(e,{silent:!0}))},s.whenAnnotationSuggestionsReady=function(t,e){if(e)try{this.annotationResponse=this._parseAnnotationSuggestions(t)}catch(t){this.annotationResponse={annotations:[],captions:{}}}finally{this._setInitialAnnotationState()}else this.annotationResponse={annotations:[],captions:{}};return Promise.resolve(this.annotationResponse)},s._parseAnnotationSuggestions=function(e){var n=["AVERAGE","MEANINGFUL_DIFFERENCES","PREDICTIVE_STRENGTH","FIT_LINE","MODE"],r={};return e.captions&&n.forEach((function(t){e.captions[t]&&(r[t]=e.captions[t])})),e?{annotations:e.annotations?t.filter(e.annotations,(function(t){return-1!==n.indexOf(t.type)})):[],captions:e.captions?r:{}}:{annotations:[],captions:{}}},s._updateAnnotationState=function(t,e){this.widgetModel.set({annotations:t},e||{})},s._getCurrentAnnotationState=function(){return this.widgetModel.get("annotations")||{}},s._getDisplayableAnnotations=function(){var e=this,n=[],r=this._getCurrentEnabledAnnotationIds();return this.getAllSuggestedAnnotations().forEach((function(i){var s=i.type;if(!t.find(n,(function(t){return t.id===s}))){var a={caption:e.annotationResponse.captions[s],id:s,checked:-1!==r.indexOf(s)};n.push(a)}})),n},s._getCurrentEnabledAnnotationIds=function(){var t=this._getCurrentAnnotationState();return t.selectedAnnotations&&t.selectedAnnotations.length>0?t.selectedAnnotations:[]},s._getCurrentToggleEnabledState=function(){var t=this._getCurrentAnnotationState();return!!t.toggleEnabled&&!(!t.toggleEnabled||!this.annotationResponse)},s._createAnnotationRenderDeferred=function(){var t={};t.promise=new Promise((function(e,n){t.resolve=e,t.reject=n})),t.isSettled=!1,t.promise.finally((function(){return t.isSettled=!0})),this._annotationRenderDeferred=t},s._getAnnotationRenderDeferred=function(){return this._annotationRenderDeferred||this._createAnnotationRenderDeferred(),this._annotationRenderDeferred},s.resetAnnotationRenderState=function(){this._getAnnotationRenderDeferred().isSettled&&this._createAnnotationRenderDeferred()},s.annotationRenderComplete=function(){this._getAnnotationRenderDeferred().resolve()},s.annotationRenderError=function(t){this._getAnnotationRenderDeferred().reject(t)},s.getAnnotationRenderPromise=function(){return this._getAnnotationRenderDeferred().promise},i}()})),define("@dashboard-features/smartAnnotations/js/StatsQueryModifier",["underscore","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryModifierAPI","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryDefinitionModifierAPI"],(function(t,e,n,r){return function(){function i(t){var e=t.content,n=t.features;this.content=e,this.smartAnnotations=n.SmartAnnotations,this.forecast=n.Forecast,this.visualization=n.Visualization,n.DataQueryExecution.registerQueryModifier(this.getAPI()),n.DataQueryExecution.registerQueryDefinitionModifier(this.getAPI())}var s=i.prototype;return s.getAPI=function(){return this.api||(this.api=e.createAPI(this,[n,r])),this.api},s.getType=function(){return"main"},s.modifyQuerySpecList=function(e){var n=this;return t.each(e,(function(e){var r=n._createAnnotationUniqueStats();t.isEmpty(r)||t.each(r,(function(t){e.id===t.dataset&&e.type===n.getType()&&(n._addStatsQueryDataItem(e,t),n._addStatsQueryProjection(e,t))}));var i,s,a=n._getMultivariateItems();a&&((i=e.spec.dataItems).push.apply(i,a),(s=e.spec.projections).push.apply(s,a.map((function(t){return t.id}))))})),e},s._getMultivariateItems=function(){var e=this.forecast.getMultivariatesState();if(e){var n=t.pluck(e,"columnId"),r=this.visualization.getDataSource();return n.map((function(t){return r.getMetadataColumn(t)})).filter((function(t){return t})).map((function(t){var e=t.getId();return{id:"var:other:"+e,itemId:e,aggregate:t.getDefaultAggregation()}}))}},s.modifyQueryDefinitionList=function(e){var n=this;return t.each(e,(function(e){var r=n._createAnnotationUniqueStats();t.isEmpty(r)||t.each(r,(function(t){if(e.getId()===t.dataset&&e.getType()===n.getType()){var r=n._findDataItemSetFromList(t.dataItems[0],e.getDataItemSetList());r&&r.addCalculation(t.stat,t.dataItems)}}))})),e},s._findDataItemSetFromList=function(e,n){var r=this;return t.find(n,(function(t){return r._findDataItemSetFromSet(e,t)}))},s._findDataItemSetFromSet=function(e,n){return t.find(n.getDataItemList(),(function(t){return t.getId()===e}))?n:this._findDataItemSetFromList(e,n.getDataItemSetList())},s._addStatsQueryDataItem=function(e,n){e.spec.dataItems.push({id:n.id,calculation:{operation:n.stat,operands:t.map(n.dataItems,(function(t){return{dataItem:t}}))}})},s._addStatsQueryProjection=function(t,e){t.spec.projections.push(e.id)},s._getNLT=function(){var t=this.content.getFeature("WidgetAPI.deprecated");return t&&t.getFeature("vis-chart-insights")},s._getInsightsNarrator=function(){return this.content.getFeature("InsightsNarrator")},s._createAnnotationUniqueStats=function(){var e=this,n={},r=[],i=this._getNLT(),s=this._getInsightsNarrator(),a=s&&s.shouldRequestInsights();return r=i||a?this.smartAnnotations.getAllSuggestedAnnotations():this.smartAnnotations.getEnabledAnnotations(),i?r=i.getNLTData(!0,r):a&&(r=s.getInsightsCalculations(r)),r&&r.length>0&&t.each(r,(function(r){!e.content.getFeature("SmartsExecution").getNonAnnotatableReasons(r.datasetId).descriptions.length&&t.each(r.dataItems,(function(e,i){"response"===r.roles[i]&&t.each(r.reqStats,(function(t){var i=t+":"+e;n[i]={id:i,stat:t,dataItems:[e],dataset:r.datasetId}}))}))})),n},i}()})),define("@dashboard-features/smartAnnotations/js/api/AnnotatedResultsAPI",[],(function(){return function(){function t(){}var e=t.prototype;return e.getStatus=function(){},e.getErrorList=function(){},e.getMessageList=function(){},e.getPredictTitle=function(){},e.getStatisticalDetails=function(){},t}()})),define("@dashboard-features/smartAnnotations/js/AnnotatedResults",["@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/DataQueryResult","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/QueryResults","@waca/dashboard-livewidget/js/features/content/dataQueryExecution/api/QueryResultsAPI","./api/AnnotatedResultsAPI"],(function(t,e,n,r,i){return function(n){function s(t,r){var i;return(i=n.call(this)||this)._predictStatus=t.predictStatus,i._predictResults=t.predictResults,i._dataset=t.dataset,i._dataset&&Array.isArray(i._dataset)&&i._dataset.forEach((function(t){i._predictStatus&&i._predictStatus.reordered&&i._reorderForecastDatapoints(t),i.addResult(new e(t,r),t.datasetId)})),i}_inheritsLoose(s,n);var a=s.prototype;return a._reorderForecastDatapoints=function(t){var e=t.data,n=t.dataItems.length;e.sort((function(t,e){for(var r=0;r<n;r++){var i=t.pt[r],s=e.pt[r];if(!isNaN(i)&&!isNaN(s)&&i!==s)return i<s?-1:1}return 0}))},a.getAPI=function(){return this._api||(this._api=t.createAPI(this,[r,i])),this._api},a.getStatus=function(){return this._predictStatus?this._predictStatus.state:null},a.getErrorList=function(){return this._predictStatus?this._predictStatus.errors:null},a.getWarningList=function(){return this._predictStatus?this._predictStatus.warnings:null},a.getMessageList=function(){return this._predictStatus?this._predictStatus.messages:null},a.getPredictTitle=function(){return this._predictStatus?this._predictStatus.title:null},a.getStatisticalDetails=function(){return this._predictResults&&this._predictResults.statisticalDetails||[]},s}(n)})),define("@dashboard-features/smartAnnotations/js/SmartsExecution",["underscore","@waca/dashboard-common/js/core/APIFactory","@waca/dashboard-livewidget/js/features/content/smartsExecution/api/SmartsExecutionAPI","./AnnotatedResults","@waca/dashboard-livewidget/js/apiHelpers/SlotAPIHelper","@waca/dashboard-livewidget/js/widgets/livewidget/nls/StringResources"],(function(t,e,n,r,i,s){"use strict";var a=function(){function a(t){var r=t.content,i=t.features;this._dataQueryExecution=i["DataQueryExecution.internal"],this._annotationService=i["Dashboard.AnnotationService"],this._exploreService=i["Dashboard.ExploreAnnotationService"],this.content=r,this._api=e.createAPI(this,[n])}var o=a.prototype;return o.getAPI=function(){return this._api},o.execute=function(t){var e=this,r=t.tags,i=t.target||n.TARGETS.SUGGESTIONS,s=i===n.TARGETS.SUGGESTIONS,a=this.content.getFeature("Forecast");if(s||0!==(this.content.getFeature("SmartAnnotations").getEnabledAnnotations()||[]).length||0!==(a.getForecastInfo().annotations||[]).length){var o=s?this._annotationService:this._exploreService,u=s?this._buildSuggestionQuery(t):this._buildExecutionQuery(t);return a.preQueryExecution(u,!s),o.runQuery({querySpec:u,target:i,sender:t.sender}).then((function(i){var s=i.data;if(t.target===n.TARGETS.EXECUTIONS){t.renderContext.isDecorated=!0;var o=e._buildAnnotationResults(s);return a.postQueryExecution(o),e.annotatedResults=o,o}var u=[e.content.getFeature("SmartAnnotations.deprecated").whenAnnotationSuggestionsReady(s,r.indexOf("annotatable")>-1),a.whenForecastSuggestionsReady(s,r.indexOf("forecasting")>-1)];return Promise.all(u).then((function(t){return t}))}),(function(t){throw e._errorResponseHandler(t)}))}return this.content.getFeature("Visualization").getDefinition().getDatasetList().forEach((function(t){for(var n=e.annotatedResults&&e.annotatedResults.getResult(t.id),r=n&&n.getResultItemList()||[],i=0;i<r.length;i++)r[i].clearDecorations()})),Promise.resolve(this._buildAnnotationResults({}))},o._errorResponseHandler=function(t){var e;switch(t&&t.code?t.code:0){case a.HTTP_RESPONSE_STATUS.UNAUTHORIZED:e=s.get("smart_annotation_unauthorized");break;case a.HTTP_RESPONSE_STATUS.METHOD_NOT_ALLOWED:e=s.get("smart_annotation_method");break;case a.HTTP_RESPONSE_STATUS.UNSUPPORTED_MEDIA_TYPE:e=s.get("smart_annotation_media");break;case a.HTTP_RESPONSE_STATUS.INPUT_INVALID:e=s.get("smart_annotation_input");break;case a.HTTP_RESPONSE_STATUS.INTERNAL_SYSTEM:e=s.get("smart_annotation_internal");break;default:e=s.get("smart_annotation_generic_error")}var n=new Error;return n.message=e,n.code=t.code,n.stack=t.stack,n},o._buildAnnotationResults=function(t){var e=this.content.getFeature("Visualization");return new r(t,e.getSlots()).getAPI()},o._buildSuggestionQuery=function(t){return{version:a.SUGGESTIONS_VERSION,data:this._getSuggestionDataDef(t),use:this._getSuggestionUseDef(),tags:t.tags}},o._getSuggestionDataDef=function(e){var n=this,r={},i=this.content.getFeature("Visualization").getSlots();return t.each(i.getMappedSlotList(),(function(t){t.getDefinition().getDatasetIdList().forEach((function(e){var n=r[e];n||(r[e]={datasetId:e,slots:[]},n=r[e]),n.slots.push(t)}))})),t.map(r,(function(r){return{id:r.datasetId,dataItems:t.chain(r.slots).map((function(t){return n._getSuggestionDataItemsDef(t,e)})).flatten().value()}}))},o._getSuggestionDataItemsDef=function(e,n){var r=this,s=t.map(e.getDataItemList(),(function(t){var s={id:i.isMultiMeasuresSeriesSlot(e)&&1===e.getDataItemList().length?e.getId():t.getId(),type:r._getDataType(t),itemId:t.getColumnId()};if(n&&n.tags&&-1!==n.tags.indexOf("forecasting")){var a=t.getMetadataColumn(),o=a&&a.getTaxonomyList();(["datetime","time","date"].indexOf(t.getDataType())>-1||o&&o.length&&"cTime"===o[0].getClass())&&(s.type="datetime")}return"fact"===t.getType()&&(s.aggregate=t.getAggregation()),s}));return s.length>1&&(s=this._getSuggestionStackedDataItemsDef(s,e)),s},o._getSuggestionStackedDataItemsDef=function(e,n){return!e||e.length<2||e.push({id:n.getId(),type:i.isMultiMeasuresValueSlot(n)?"continuous":"categorical",nest:t.pluck(e,"id")}),e},o._getSuggestionUseDef=function(){var e=this,n=this.content.getFeature("Visualization").getSlots().getMappedSlotList();return t.map(n,(function(t){var n=t.getDefinition();return{name:n.getCaption(),role:n.getRole(),type:e._getUseType(n),dataItems:e._getSuggestionUseDataitemIds(t)}}))},o._getSuggestionUseDataitemIds=function(e){return e.getDataItemList().length>1||i.isMultiMeasuresSeriesSlot(e)||i.isMultiMeasuresValueSlot(e)?[e.getId()]:t.map(e.getDataItemList(),(function(t){return t.getId()}))},o._getUseType=function(t){switch(t.getType()){case"category":return"categorical";case"ordinal":return"continuous";default:return"any"}},o._getDataType=function(t){switch(t.getType()){case"attribute":return"categorical";case"fact":return"continuous";default:return null}},o._buildExecutionQuery=function(e){var n=this,r=e.renderContext.data,i={dataset:t.map(r.getQueryResultIdList(),(function(t){var e=n._dataQueryExecution.getRawResult(t);return{datasetId:t,data:n._getExecutionDatapointsDef(e.data),dataItems:n._getExecutionDataItemsDef(e.dataItems),hasNext:!(!e.hasPrev&&!e.hasNext),version:e.version}})),params:{annotations:this.content.getFeature("SmartAnnotations").getEnabledAnnotations().concat(this.content.getFeature("Forecast").getForecastInfo().annotations)},moduleId:e.moduleId,shapedModule:e.shapedModule};return e.tempModuleId&&(i.tempModuleId=e.tempModuleId),e.tempModule&&(i.tempModule=JSON.stringify(e.tempModule)),i},o._getExecutionDatapointsDef=function(e){return t.map(e,(function(t){return{pt:t.pt,deco:t.deco}}))},o._getExecutionDataItemsDef=function(e){var n=this.content.getFeature("Visualization").getSlots();return t.map(e,(function(e){if(e.itemClass.h.length>1){var r=t.find(n.getMappedSlotList(),(function(t){return t.getId()===e.itemClass.id})).getDataItemList();return{itemClass:{h:t.map(e.itemClass.h,(function(t,e){return{id:r[e].getId(),u:t.u,d:t.d}})),id:e.itemClass.id},items:e.items}}return e}))},o.getNonAnnotatableReasons=function(t){var e=this,n=[],r={allLayers:!1,nonAnnotatableFeatures:n,descriptions:[]},i=this.content.getFeature("Visualization").getDefinition(),s=i&&i.getDatasetList().map((function(t){return t.id})),a=s&&s.length?s:["data"];return(t?[t]:a).forEach((function(t){var i=e._getNonAnnotatableReasons(t,n);i.length&&r.descriptions.push(i)})),r.allLayers=r.descriptions.length===a.length,r},o._getNonAnnotatableReasons=function(e,n){var r=[this._topBottomPercentApplied.bind(this),this._topBottomAppliedWithNestedDataItems.bind(this)],i=[],s=[];return t.each(r,(function(t){return s.push(t(e,n))})),(s=t.without(s,null)).length&&i.push({id:"smart_exec_support_warnings",label:"Annotation warning:",items:t.flatten(s)}),i},o._topBottomPercentApplied=function(e,n){var r=null,i=this.content.getFeature("Visualization").getSlots().getMappingInfoList();return!!t.find(i,(function(t){if(-1!==t.slot.getDefinition().getDatasetIdList().indexOf(e)){var n=t.dataItem.getTopBottom();return n&&-1!==["toppercent","bottompercent"].indexOf(n.type)}}))&&(r=[],this.content.getFeature("SmartAnnotations").getEnabledAnnotations().length>0&&(r.push({id:"UNSUPPORTED_TOPBOTTOM_PERCENT_INSIGHTS",label:s.get("smart_annotation_insight_topBottom_percent_unsupported")}),n.push("insights")),this._getForecastAnnotations().length>0&&(r.push({id:"UNSUPPORTED_TOPBOTTOM_PERCENT_FORECAST",label:s.get("smart_annotation_forecast_topBottom_percent_unsupported")}),n.push("forecast"))),r},o._topBottomAppliedWithNestedDataItems=function(e,n){var r=null,i=this.content.getFeature("Visualization").getSlots().getMappingInfoList();return!!t.find(i,(function(t){if(-1!==t.slot.getDefinition().getDatasetIdList().indexOf(e))return t.dataItem.getTopBottom()&&t.slot.getDataItemList().length>1}))&&(r=[],this.content.getFeature("SmartAnnotations").getEnabledAnnotations().length>0&&(r.push({id:"UNSUPPORTED_TOPBOTTOM_NESTED_DATAITEM_INSIGHTS",label:s.get("smart_annotation_insight_topBottom_nested_dataItem_unsupported")}),n.push("insights")),this._getForecastAnnotations().length>0&&(r.push({id:"UNSUPPORTED_TOPBOTTOM_NESTED_DATAITEM_FORECAST",label:s.get("smart_annotation_forecast_topBottom_nested_dataItem_unsupported")}),n.push("forecast"))),r},o._getForecastAnnotations=function(){var t=this.content.getFeature("Forecast");return t&&t.getForecastInfo().annotations||[]},_createClass(a,null,[{key:"RESPONSE_STATUS",get:function(){return{SUCCESS:"SUCCESS"}}},{key:"HTTP_RESPONSE_STATUS",get:function(){return{UNAUTHORIZED:401,METHOD_NOT_ALLOWED:405,UNSUPPORTED_MEDIA_TYPE:415,INPUT_INVALID:422,INTERNAL_SYSTEM:500}}}]),a}();return a.SUGGESTIONS_VERSION="0.0.1",a})),define("@dashboard-features/coreProfileBundle",(function(){}));