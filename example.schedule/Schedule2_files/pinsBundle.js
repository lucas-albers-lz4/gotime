/**
 * IBM Confidential OCO Source Materials IBM Business Platform: Dashboard
 * (C) Copyright IBM Corp. 2016, 2021
 *
 * The source code for this program is not published or otherwise divested of
 * its trade secrets, irrespective of what has been deposited with the U.S.
 * Copyright Office
 */

function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/illustrations-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/illustrations-js/no-pins_128",["@ba/ba-graphics/dist/illustrations-js/ba-graphics-icons-commons.js"],t);else{var n=t("object"==typeof exports?require("@ba/ba-graphics/dist/illustrations-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/illustrations-js/ba-graphics-icons-commons.js"]);for(var a in n)("object"==typeof exports?exports:e)[a]=n[a]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([65],{"16cac1a528649ec3cc7a":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("6873601dfe1d9459c1a9"),i=(n.n(a),n("bfc9896040c5d0dd7ad7"));t.default=i.a},"6873601dfe1d9459c1a9":function(t,n){t.exports=e},bfc9896040c5d0dd7ad7:function(e,t,n){"use strict";var a=n("9689a9c94ae38b47fa2c"),i=n.n(a),s=n("9ce58a7deea14f49ef01"),r=n.n(s),o=new i.a({id:"no-pins_128_v7",use:"no-pins_128_v7-usage",viewBox:"0 0 200 200",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" id="no-pins_128_v7"><circle class="ba-graphics-neutral-white4" cx="100" cy="100" r="100" /><path class="ba-graphics-white" d="M14.97 170.08L150.63 170.08" /><path class="ba-graphics-gray60" d="M150.63,172.08H15a2,2,0,1,1,0-4H150.63a2,2,0,0,1,0,4Z" /><path class="ba-graphics-white" d="M2 170.08L6.97 170.08" /><path class="ba-graphics-gray60" d="M7,172.08H2a2,2,0,0,1,0-4H7a2,2,0,0,1,0,4Z" /><path class="ba-graphics-white" d="M179.03 170.08L198 170.08" /><path class="ba-graphics-gray60" d="M198,172.08H179a2,2,0,0,1,0-4h19a2,2,0,0,1,0,4Z" /><path class="ba-graphics-white" d="M158.63 170.08L171.03 170.08" /><path class="ba-graphics-gray60" d="M171,172.08h-12.4a2,2,0,0,1,0-4H171a2,2,0,0,1,0,4Z" /><circle class="ba-graphics-gray60" cx="57.91" cy="54.07" r="2" /><circle class="ba-graphics-gray60" cx="167.91" cy="112.07" r="2" /><path class="ba-graphics-gray60" d="M35.33,68.91a4,4,0,0,0,4-4,1,1,0,0,1,2,0,4,4,0,0,0,4,4,1,1,0,0,1,0,2,4,4,0,0,0-4,4,1,1,0,0,1-2,0,4,4,0,0,0-4-4,1,1,0,0,1,0-2Z" /><rect class="ba-graphics-white" x="65.93" y="81.86" width="67.78" height="67.98" rx="2" /><path class="ba-graphics-gray60" d="M70,83.84h0m0,2,59.79,0,0,60-59.79,0,0-60m-2-4a2,2,0,0,0-2,2l0,64a2,2,0,0,0,2,2l63.79,0h0a2,2,0,0,0,2-2l0-64a2,2,0,0,0-2-2L68,81.84Z" /><path class="ba-graphics-gray60" d="M83.65 101.73H91.61V130.78H83.65z" /><path class="ba-graphics-gray60" d="M96.08 113.91H104.03999999999999V130.78H96.08z" /><path class="ba-graphics-gray60" d="M108.51 108.76H116.47V130.78H108.51z" /><path class="ba-graphics-white" d="M120.54 73.65L87.33 67.51 98.79 27.8 122.18 31.55 120.54 73.65z" /><path class="ba-graphics-gray60" d="M107.37 72.21L101.56 84.57 100.21 70.89 107.37 72.21z" /><path class="ba-graphics-gray60" d="M124.45,34.06a1.83,1.83,0,0,1-.33,0l-28.6-4.63a2,2,0,1,1,.64-3.95l28.6,4.63a2,2,0,0,1-.31,4Z" /><path class="ba-graphics-gray60" d="M87.05,69.45a2,2,0,0,1-.58-.09,2,2,0,0,1-1.33-2.5L97.29,27.39a2,2,0,1,1,3.83,1.17L89,68A2,2,0,0,1,87.05,69.45Z" /><path class="ba-graphics-gray60" d="M120.15,74.81h-.05a2,2,0,0,1-1.95-2l.93-41.3a2,2,0,0,1,4,.09l-.93,41.3A2,2,0,0,1,120.15,74.81Z" /><path class="ba-graphics-gray60" d="M123.42,75.92l-.32,0L83.28,69.44a2,2,0,1,1,.64-4l39.82,6.45a2,2,0,0,1-.32,4Z" /><path class="ba-graphics-gray60" d="M100.43,93.49h-.05a2,2,0,0,1-1.95-2L99,70.23a2,2,0,0,1,2.05-2A2,2,0,0,1,103,70.34l-.56,21.2A2,2,0,0,1,100.43,93.49Z" /><path class="ba-graphics-gray60" d="M100.43,93.49a2.32,2.32,0,0,1-.58-.08,2,2,0,0,1-1.33-2.5l6.16-20.3a2,2,0,0,1,3.83,1.16l-6.17,20.3A2,2,0,0,1,100.43,93.49Z" /></symbol>'});r.a.add(o),t.a=o}},["16cac1a528649ec3cc7a"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/subtract--alt_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var n=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var a in n)("object"==typeof exports?exports:e)[a]=n[a]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([171],{"6873601dfe1d9459c1a9":function(t,n){t.exports=e},"82643bc22d9c0e1c5ba8":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("6873601dfe1d9459c1a9"),i=(n.n(a),n("c6598a91630cabba5cb6"));t.default=i.a},c6598a91630cabba5cb6:function(e,t,n){"use strict";var a=n("9689a9c94ae38b47fa2c"),i=n.n(a),s=n("9ce58a7deea14f49ef01"),r=n.n(s),o=new i.a({id:"subtract--alt_32_v7",use:"subtract--alt_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="subtract--alt_32_v7"><path d="M16,4c6.6,0,12,5.4,12,12s-5.4,12-12,12S4,22.6,4,16S9.4,4,16,4 M16,2C8.3,2,2,8.3,2,16s6.3,14,14,14s14-6.3,14-14\tS23.7,2,16,2z" /><path d="M8 15H24V17H8z" /></symbol>'});r.a.add(o),t.a=o}},["82643bc22d9c0e1c5ba8"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/edit_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var n=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var a in n)("object"==typeof exports?exports:e)[a]=n[a]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([755],{"0cf81c9f35da7b643d3a":function(e,t,n){"use strict";var a=n("9689a9c94ae38b47fa2c"),i=n.n(a),s=n("9ce58a7deea14f49ef01"),r=n.n(s),o=new i.a({id:"edit_32_v7",use:"edit_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="edit_32_v7"><path d="M2 26H30V28H2zM25.4 9c.8-.8.8-2 0-2.8 0 0 0 0 0 0l-3.6-3.6c-.8-.8-2-.8-2.8 0 0 0 0 0 0 0l-15 15V24h6.4L25.4 9zM20.4 4L24 7.6l-3 3L17.4 7 20.4 4zM6 22v-3.6l10-10 3.6 3.6-10 10H6z" /></symbol>'});r.a.add(o),t.a=o},"2e7827860057c685d5b7":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("6873601dfe1d9459c1a9"),i=(n.n(a),n("0cf81c9f35da7b643d3a"));t.default=i.a},"6873601dfe1d9459c1a9":function(t,n){t.exports=e}},["2e7827860057c685d5b7"])})),function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"));else if("function"==typeof define&&define.amd)define("js/gemini/lib/@waca/dashboard-common/dist/lib/@ba/ba-graphics/dist/icons-js/checkmark_32",["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"],t);else{var n=t("object"==typeof exports?require("@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"):e["@ba/ba-graphics/dist/icons-js/ba-graphics-icons-commons.js"]);for(var a in n)("object"==typeof exports?exports:e)[a]=n[a]}}("undefined"!=typeof self?self:this,(function(e){return webpackJsonPBaGraphics([993],{"6873601dfe1d9459c1a9":function(t,n){t.exports=e},"950424113b819a289ca3":function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("6873601dfe1d9459c1a9"),i=(n.n(a),n("c73d48f52efa3761ec07"));t.default=i.a},c73d48f52efa3761ec07:function(e,t,n){"use strict";var a=n("9689a9c94ae38b47fa2c"),i=n.n(a),s=n("9ce58a7deea14f49ef01"),r=n.n(s),o=new i.a({id:"checkmark_32_v7",use:"checkmark_32_v7-usage",viewBox:"0 0 32 32",content:'<symbol xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" id="checkmark_32_v7"><path d="M13 24L4 15 5.414 13.586 13 21.171 26.586 7.586 28 9 13 24z" /></symbol>'});r.a.add(o),t.a=o}},["950424113b819a289ca3"])})),define("dashboard-core/js/pinning/PinsListView",["react","prop-types","@ba/ba-ui-carbon-toolkit","@ba/ba-ui-carbon","../app/nls/StringResources","../lib/@waca/core-client/js/core-client/utils/BidiUtil","@ba/ba-graphics/dist/illustrations-js/no-pins_128","@ba/ba-graphics/dist/icons-js/subtract--alt_32","@ba/ba-graphics/dist/icons-js/edit_32","@ba/ba-graphics/dist/icons-js/checkmark_32","@ba/ba-graphics/dist/icons-js/close_32"],(function(e,t,n,a,i,s,r,o,c,l,d){var p=n.List,u=n.Label,h=n.TruncatedText,m=n.FlexItem,b=n.FlexLayout,f=n.Button,g=n.SVGIcon,v=n.Container,y=a.ClickableTile,P=a.TextInput,w=n.keyboardUtils.keyNames,_=function(t){function n(e){_classCallCheck(this,n);var a=_possibleConstructorReturn(this,t.call(this,e));return a.state={nameIsInvalid:!1},a._disableInputBlur=!1,a.disableRenameInputBlurEvent=a.disableRenameInputBlurEvent.bind(a),a.enableRenameInputBlurEvent=a.enableRenameInputBlurEvent.bind(a),a}return _inherits(n,t),n.prototype.pinMatches=function(e){return-1!==this._getSearchableFieldValue(e).toLowerCase().indexOf(this.props.searchText.toLowerCase())},n.prototype._getSearchableFieldValue=function(e){var t=this,n=e.displayName+"___"+e.sourceName;return"boardFragment"===e.contentType&&e.content.widgets&&e.content.widgets.forEach((function(e){n=n+"___"+t.props.smartNamingSvc.getLocalizedWidgetType(e),e.mapping&&e.mapping.forEach((function(e){n=n+"___"+e.label}));var a=e.data&&e.data.dataViews&&e.data.dataViews[0]&&e.data.dataViews[0].dataItems;a&&a.forEach((function(e){n=n+"___"+e.itemLabel}))})),n},n.prototype.onPinRenameButtonClick=function(e,t){this.setState({currEditingPin:t}),this._newName=t.displayName,e.stopPropagation()},n.prototype.onPinRenameButtonKeyDown=function(e){e.key.toUpperCase()===w.ENTER&&e.stopPropagation()},n.prototype.disablePinRenameMode=function(e){this.setState({currEditingPin:void 0,nameIsInvalid:!1}),delete this._newName,e.target.blur(),e.stopPropagation()},n.prototype.onCancelRenameButtonClick=function(e){this.disablePinRenameMode(e)},n.prototype.onConfirmRenameButtonClick=function(e){this._hasPinNameChanged()&&this.props.onPinRename(this.state.currEditingPin.id,this._newName),this.disablePinRenameMode(e)},n.prototype.onPinRenameInputKeyPress=function(e){"Enter"===e.key?(this._hasPinNameChanged()&&this.props.onPinRename(this.state.currEditingPin.id,this._newName),this.disablePinRenameMode(e)):"Escape"===e.key&&this.disablePinRenameMode(e),e.stopPropagation()},n.prototype.onPinNameChange=function(e){this._newName=e.target.value,""===this._newName?this.setState({nameIsInvalid:!0}):this.setState({nameIsInvalid:!1})},n.prototype.disableRenameInputBlurEvent=function(){this._disableInputBlur=!0},n.prototype.enableRenameInputBlurEvent=function(){this._disableInputBlur=!1},n.prototype._hasPinNameChanged=function(){return this._newName&&this._newName!==this.state.currEditingPin.displayName},n.prototype.onPinRenameInputBlur=function(e){this._disableInputBlur||(this._hasPinNameChanged()&&this.props.onPinRename(this.state.currEditingPin.id,this._newName),this.disablePinRenameMode(e))},n.prototype.renderNameEditor=function(){var t=this;return e.createElement(m,{className:"pinRenameContainer"},e.createElement(P,{autoFocus:!0,onKeyDown:function(e){return t.onPinRenameInputKeyPress(e)},onChange:function(e){return t.onPinNameChange(e)},onBlur:function(e){return t.onPinRenameInputBlur(e)},className:"pinRenameInput",defaultValue:this.state.currEditingPin.displayName,placeholder:i.get("renamePinTooltip"),invalid:this.state.nameIsInvalid,invalidText:i.get("renamePinInvalidText"),size:"sm"}),e.createElement(m,{className:"buttonContainer",onMouseOver:this.disableRenameInputBlurEvent,onMouseOut:this.enableRenameInputBlurEvent},e.createElement(f,{onClick:function(e){return t.onConfirmRenameButtonClick(e)},tooltipPosition:"top",tooltipAlignment:"center",title:i.get("confirmRenamePin"),className:"confirmNameButton",disabled:this.state.nameIsInvalid,icon:l.default.id,focusable:!0,smartNamingSvc:this.props.smartNamingSvc,size:"small",variant:"icon"}),e.createElement(f,{onClick:function(e){return t.onCancelRenameButtonClick(e)},tooltipPosition:"top",tooltipAlignment:"end",title:i.get("cancelRenamePin"),className:"cancelRenameButton",icon:d.default.id,focusable:!0,smartNamingSvc:this.props.smartNamingSvc,size:"small",variant:"icon"})))},n.prototype.renderThumbnail=function(t){var n=this.state.currEditingPin&&this.state.currEditingPin.id===t.id;return e.createElement(m,{className:"pinThumb "+(n?"disableHighlight":"")},e.createElement("img",{src:t.thumbUri}))},n.prototype.renderPinInfo=function(t){return e.createElement(m,null,e.createElement(u,{className:"pinSource","aria-label":t.sourceName,label:""+t.sourceName+i.get("listSeparator")+" "+t.pinAge}))},n.prototype.renderPinTitle=function(t){var n=this;return e.createElement(m,{className:"pinTitle"},e.createElement(m,{className:"pinNameContainer"},e.createElement(h,{className:"pinName","aria-label":t.displayName,value:t.displayName})),e.createElement(m,null,e.createElement(f,{tooltipPosition:"top",tooltipAlignment:"center",title:i.get("renamePin"),className:"renamePinButton",icon:c.default.id,focusable:!0,onClick:function(e){return n.onPinRenameButtonClick(e,t)},onKeyDown:function(e){return n.onPinRenameButtonKeyDown(e)},smartNamingSvc:this.props.smartNamingSvc,size:"small",variant:"icon"}),e.createElement(f,{tooltipPosition:"top",tooltipAlignment:"end",title:i.get("pinRemove"),className:"removePinButton",icon:o.default.id,focusable:!0,onKeyDown:function(e){return n.onKeyDownRemove(e,t.id)},onClick:function(e){return n.props.onPinDeleted(t.id,e)},smartNamingSvc:this.props.smartNamingSvc,size:"small",variant:"icon"})))},n.prototype.onKeyDownRemove=function(e,t){e.key.toUpperCase()===w.ENTER&&(e.preventDefault(),e.stopPropagation(),this.props.onPinDeleted(t,e))},n.prototype.itemRenderer=function(t){var n=this._renderedPins[t];return this.state.currEditingPin&&this.state.currEditingPin.id===n.id?e.createElement(y,{className:"pinTile pinItem","data-index":t,selectable:"true","data-id":n.id,tabIndex:0},e.createElement(b,{fullHeight:!0,direction:"column",alignItems:"flex-start",className:"pinTileLayout",role:"button"},this.renderThumbnail(n),this.renderNameEditor(n),this.renderPinInfo(n))):e.createElement(y,{handleKeyDown:this.props.onKeyDown.bind(this,n.id),handleClick:this.props.handleClick.bind(this,n.id),className:"pinTile pinItem","data-index":t,selectable:"true","data-id":n.id,tabIndex:0},e.createElement(b,{fullHeight:!0,direction:"column",alignItems:"flex-start",className:"pinTileLayout",role:"button"},this.renderThumbnail(n),this.renderPinTitle(n),this.renderPinInfo(n)))},n.prototype.renderPinsCount=function(t){var n=s.enforceNumericShaping(t);return e.createElement(u,{className:"pinCount",label:i.get("pinCount",{smart_count:n,count:n})})},n.prototype.render=function(){this._renderedPins=this.props.items.filter(this.pinMatches.bind(this));var t=this._renderedPins.length;return t>0?e.createElement(v,{className:"pinsList"},this.renderPinsCount(t),e.createElement(p,{className:"list",length:t,itemRenderer:this.itemRenderer.bind(this),selectionMode:"single",style:{"overflow-y":"hidden"}})):e.createElement(b,{className:"emptyTableContent",direction:"column",alignItems:"center"},e.createElement(g,{iconId:r.default.id,className:"customVisInfoIcon",role:"img",size:"xxlarge"}),e.createElement(u,{className:"noPinsLabel",label:i.get("NoPinsCollected")}))},n}(e.Component);return _.propTypes={items:t.array,onKeyDown:t.function,onPinDeleted:t.function,onPinRename:t.function,searchText:t.string,smartNamingSvc:t.object,handleClick:t.function},_})),define("dashboard-core/js/pinning/PinsPanelView",["react","prop-types","@ba/ba-ui-carbon-toolkit","@ba/ba-ui-carbon","../app/nls/StringResources","./PinsListView"],(function(e,t,n,a,i,s){var r=n.SearchInput,o=n.TruncatedText,c=n.Container,l=n.FlexItem,d=a.Dropdown,p=n.keyboardUtils.keyNames,u=function(t){function n(a){_classCallCheck(this,n);var s=_possibleConstructorReturn(this,t.call(this,a));return s.state={searchText:"",pins:s.props.dashboardPinningService.getCachedPins("all")},s.searchInput=e.createRef(),s.triggerButton=e.createRef(),s.filterOptions=[{value:"all",text:i.get("pinDateFilterAll")},{value:"today",text:i.get("pinDateFilterToday")},{value:"yesterday",text:i.get("pinDateFilterYesterday")},{value:"pastWeek",text:i.get("pinDateFilterPastWeek")},{value:"pastMonth",text:i.get("pinDateFilterPastMonth")},{value:"earlier",text:i.get("pinDateFilterEarlier")}],s.filterItem=s.filterOptions[0],s}return _inherits(n,t),n.prototype.componentDidMount=function(){this.addHandler=this.props.dashboardPinningService.on("pin:created",this.updatePinsState.bind(this)),this.searchInput.current.focus()},n.prototype.componentWillUnmount=function(){this.addHandler.remove()},n.prototype.updatePinsState=function(){this.setState({pins:this.props.dashboardPinningService.getCachedPins(this.filterItem.value)})},n.prototype.updateFilterText=function(e){this.filterItem=e.selectedItem,this.updatePinsState()},n.prototype.onPinDeleted=function(e,t){var n=this;this.props.dashboardPinningService.deletePin(e,(function(){n.updatePinsState()})).catch((function(){n.updatePinsState()})),this.updatePinsState(),t.stopPropagation()},n.prototype.onPinRename=function(e,t){var n=this;t&&this.props.dashboardPinningService.renamePin(e,t,(function(){n.updatePinsState()})).then((function(){n.updatePinsState()}))},n.prototype.getPinById=function(e,t){return t.filter((function(t){return t.id===e}))[0]},n.prototype.onKeyDown=function(e,t){t.key.toUpperCase()===p.ENTER?this.props.addPinToCanvas(e,t):t.key.toUpperCase()===p.BACKSPACE&&this.onPinDeleted(e,t)},n.prototype.renderList=function(){var t=this;return e.createElement(s,{items:this.state.pins,onKeyDown:this.onKeyDown.bind(this),onPinDeleted:function(e,n){return t.onPinDeleted(e,n)},onPinRename:function(e,n){return t.onPinRename(e,n)},searchText:this.state.searchText,smartNamingSvc:this.props.smartNamingSvc,handleClick:this.props.addPinToCanvas})},n.prototype.renderSearchView=function(){var t=this;return e.createElement(r,{className:"searchArea",value:this.state.searchText,hideLeftIcon:!1,placeholder:i.get("searchPanel"),onChange:function(e){t.setState({searchText:e})},ref:this.searchInput,size:"sm"})},n.prototype.renderFilter=function(){return e.createElement(d,{ariaLabel:i.get("dropdownAriaLabel"),className:"filterPinsDropdown",id:"filter-pins-dropdown",items:this.filterOptions,itemToString:function(e){return e?e.text:""},onChange:this.updateFilterText.bind(this),selectedItem:this.filterItem,width:180})},n.prototype.render=function(){return e.createElement(c,{className:"pinView"},e.createElement(l,{className:"pinHeaderContainer"},e.createElement(o,{className:"pinHeader",value:i.get("pinsOld"),style:{width:120}}),this.renderFilter()),e.createElement(c,{className:"pinListView"},this.renderSearchView(),this.renderList()))},n}(e.Component);return u.propTypes={addPinToCanvas:t.function,smartNamingSvc:t.object,dashboardPinningService:t.object},u})),define("dashboard-core/js/pinning/PinsPanel",["../lib/@waca/core-client/js/core-client/ui/core/View","jquery","underscore","../lib/@waca/dashboard-common/dist/ui/CenterLoadingSpinner","./PinsPanelView","../app/nls/StringResources","../app/util/CapabilityUtils","react","react-dom"],(function(e,t,n,a,i,s,r,o,c){var l=e.extend({events:{"mousedown .pinItem :not(button)":"onDragStart","mouseup .pinItem :not(button)":"onMouseUp"},init:function(e){if(l.inherited("init",this,arguments),this.ajaxSvc=e.ajaxSvc,this.glassContext=e.glassContext,this.canvasController=e.canvasController,this.dashboardApi=this.canvasController.dashboardApi,this.logger=this.glassContext.getCoreSvc(".Logger"),this.dndManager=e.dndManager,this.dashboardPinningService=e.dashboardPinningService,this.smartNamingSvc=e.smartNamingSvc,this.viewMode=e.viewMode,this.dateFilterString="all",!this.dashboardPinningService)throw new Error("Pinning service not provided to PinsPanel constructor")},accepts:function(e){return"pin"===e.type},onDragStart:function(e){var n=this;this._mouseUp=!1,this._mouseSession={};var a=this._mouseSession;if(this.dashboardApi.getMode()!==this.dashboardApi.MODES.EDIT)return Promise.resolve(!0);if(this._shouldPreventPinDrag(e))return Promise.resolve();var i=t(e.currentTarget).parents(".pinItem")[0],s=i&&i.getAttribute("data-id");return s?this.getPin(s).then((function(e){if(!n._mouseUp)return JSON.parse(JSON.stringify(e))})).then((function(t){return n._canAddPin(a,t).then((function(t){t&&n.dndManager.startDrag({event:e,type:"pin",data:n._buildDropInfo(t),avatar:n._buildAvatar(t),moveXThreshold:20,moveYThreshold:20})}))})).catch((function(e){throw n.dashboardApi.getFeature("Logger").error("Fail to drag pin into canvas",e),e})):Promise.resolve()},_canAddPin:function(e,t){return e.capabilityIsChecked||(e.capabilityIsChecked=r.checkAuthoringCapability(this.dashboardApi,t.content,s.get("noCapabilityForPin"))),e.capabilityIsChecked.then((function(e){if(e&&!n.isEmpty(t))return t}))},onMouseUp:function(){this._mouseUp=!0},_shouldPreventPinDrag:function(e){return t(e.target).closest("button").length||"INPUT"===e.target.tagName},getPin:function(e){return this.dashboardPinningService.getPin(e)},_buildAvatar:function(e){var n=t("<img>",{class:"avatar pin"});return n.attr("src",e.thumbUri),n},_buildDropInfo:function(e){return{operation:"new",pinSpec:e}},onKeyDownToCreatePin:function(e,t){var n=this;t.key&&13===t.keycode&&(this._mouseSession={});var a=this._mouseSession;return e?this.getPin(e).then((function(e){return JSON.parse(JSON.stringify(e))})).then((function(e){return n._canAddPin(a,e)})).then((function(e){e&&n._addPin(e,t)})).catch((function(e){throw n.dashboardApi.getFeature("Logger").error("Fail to create pin from keyboard navigation",e),e})):Promise.resolve()},_addPin:function(e,t){var a=e.content,i={layout:a.layout,widgets:a.widgets,dataSources:a.dataSources,drillThrough:a.drillThrough,version:e.version?a.specVersion:6,sourceName:e.sourceName};a.episodes&&(i.episodes=a.episodes);var s={model:i};a.layout&&a.layout.style&&(s.layoutProperties={style:n.omit(a.layout.style,"top","left")});var r="tap"===t.type;this._addPinToLayout(s,r)},_addPinToLayout:function(e,t){this.canvasController.addPin(e,t)},render:function(){var e=this;return this._renderSpinner().then((function(){e.dndManager.addDropTarget(e.el,{accepts:e.accepts}),c.render(o.createElement(i,{addPinToCanvas:function(t,n){e.onKeyDownToCreatePin(t,n)},smartNamingSvc:e.smartNamingSvc,dashboardPinningService:e.dashboardPinningService}),e.$el[0])}))},_renderSpinner:function(){var e=document.createElement("div");this.$el.append(e);return c.render(a({variant:"circle",size:"normal"}),e),this.dashboardPinningService.getPins(this.dateFilterString).then((function(){return c.unmountComponentAtNode(e)}))},remove:function(){c.unmountComponentAtNode(this.$el[0]),l.inherited("remove",this,arguments)}});return l})),define("dashboard-core/js/pinning/PinView",["../lib/@waca/core-client/js/core-client/ui/core/View","./PinsPanel"],(function(e,t){var n=e.extend({init:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n.inherited("init",this,arguments);var t=e.params?e.params:window.location.search;this.viewMode=this.isViewMode(t),this.glassContext=e.glassContext,this.canvasController=e.canvasController,this.dashboardApi=this.canvasController.dashboardApi,this.slideout=e.slideout},isViewMode:function(e){var t=!1,n=decodeURIComponent((new RegExp("[?|&]"+"mode"+"=([^&;]+?)(&|#|;|$)").exec(e)||["",""])[1].replace(/\+/g,"%20"))||null;return n&&"view"===n&&(t=!0),t},getUrl:function(){return"/pins"},render:function(){var e=this;return Promise.all([this.dashboardApi.getGlassSvc(".DashboardPinning"),this._getDndManager()]).then((function(t){var n=t[0],a=e._getPinsPanelClass();e._pinListView=new a({el:e.$el,appController:e.appController,viewMode:e.viewMode,glassContext:e.glassContext,canvasController:e.canvasController,dndManager:e.dndManager,dashboardPinningService:n,smartNamingSvc:e.dashboardApi.getDashboardCoreSvc(".SmartNamingSvc")}),e._pinListView.render()}))},_getPinsPanelClass:function(){return t},remove:function(){return this._pinListView.remove(),n.inherited("remove",this,arguments)},shouldUpdateGlass:function(){return!1},_getDndManager:function(){return this.dndManager?Promise.resolve():this.dndManager=this.dashboardApi.getFeature("DashboardDnd.internal")}});return n})),define("dashboard-core/js/pinsBundle",(function(){}));